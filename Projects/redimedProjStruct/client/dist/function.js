angular.module("app.loggedIn.function",["app.loggedIn.function.controller","app.loggedIn.function.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.function",{url:"/functions",templateUrl:"modules/function/views/function.html",controller:"FunctionController"})}),angular.module("app.loggedIn.function.services",[]).factory("FunctionService",function(Restangular){var functionService={},api=Restangular.all("api");return functionService.getList=function(){var list=api.one("function/list");return list.get()},functionService.saveFunction=function(f){var saveApi=api.all("function/edit");return saveApi.post({f:f})},functionService.insertFunction=function(f){var insertApi=api.all("function/new");return insertApi.post({f:f})},functionService.delFunction=function(id){var del=api.all("function/delete");return del.post({id:id})},functionService.getFunctionInfo=function(id){var info=api.all("function/id");return info.post({id:id})},functionService}),angular.module("app.loggedIn.function.controller",[]).controller("FunctionController",function($scope,$state,$modal,$filter,ngTableParams,FunctionService,$http,toastr){$scope.data=[],$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.tableParams=new ngTableParams({page:1,count:10},{total:response.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.editFunction=function(f){var modalInstance=$modal.open({templateUrl:"modules/function/views/functionDetails.html",controller:"EditFunctionController",size:"md",resolve:{functionId:function(){return f.function_id}}});modalInstance.result.then(function(){$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})},$scope.deleteFunction=function(f){FunctionService.delFunction(f.function_id).then(function(data){"success"===data.status?($scope.rs=[],toastr.success("Delete Function Successfully!","Success"),FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})):toastr.error("Delete Function Failed!","Error")})},$scope.addNewFunction=function(){var modalInstance=$modal.open({templateUrl:"modules/function/views/functionDetails.html",controller:"NewFunctionController",size:"md"});modalInstance.result.then(function(){$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})}}).controller("NewFunctionController",function($scope,$filter,$state,$modalInstance,FunctionService,toastr){$scope.info={decription:null,definition:null,isWeb:"1",isMobile:"0"},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submitFunction=function(){$scope.showClickedValidation=!0,$scope.functionForm.$invalid?toastr.error("Please Input All Required Information!","Error"):FunctionService.insertFunction($scope.info).then(function(response){"success"===response.status?(toastr.success("Insert New Function Successfully!","Success"),$modalInstance.close()):toastr.error("Insert New Function Failed!","Error")})}}).controller("EditFunctionController",function($scope,$filter,$state,$modalInstance,FunctionService,functionId,toastr){$scope.info={function_id:functionId,decription:null,definition:null,isWeb:null,isMobile:null},FunctionService.getFunctionInfo(functionId).then(function(data){console.log(data),$scope.info=data,$scope.info.isWeb=1==data.isWeb?"1":"0",$scope.info.isMobile=1==data.isMobile?"1":"0"}),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submitFunction=function(){$scope.showClickedValidation=!0,$scope.functionForm.$invalid?toastr.error("Please Input All Required Information!","Error"):FunctionService.saveFunction($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit Function Successfully!","Success"),$modalInstance.close()):toastr.error("Edit Function Failed!","Error")})}});