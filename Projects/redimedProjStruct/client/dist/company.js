angular.module("app.loggedIn.company",["app.loggedIn.company.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.company",{url:"/company",views:{"main-content@loggedIn.patient":{templateUrl:"modules/company/views/list.html",controller:"CompanyListController"}}}).state("loggedIn.patient.company.add",{url:"/add",views:{"@loggedIn":{templateUrl:"modules/company/views/add.html",controller:"CompanyAddController"}}}).state("loggedIn.patient.company.addCompanyNotFollow",{url:"/addCompany",views:{"@loggedIn":{templateUrl:"modules/company/views/addCompanyNotFollow.html"}}}).state("loggedIn.patient.company.addParent",{url:"/addParent",views:{"@loggedIn":{templateUrl:"modules/company/dialogs/addParent.html",controller:"CompanyAddParentDialgosController"}}}).state("loggedIn.patient.company.addInsurer",{url:"/addParent",views:{"@loggedIn":{templateUrl:"modules/company/dialogs/addInsurer.html",controller:"CompanyInsurerDialgosController"}}}).state("loggedIn.patient.company.listParent",{url:"/listParent",views:{"@loggedIn":{templateUrl:"modules/company/views/listParent.html",controller:"CompanyListParentController"}}}).state("loggedIn.patient.company.listInsurer",{url:"/listInsurer",views:{"@loggedIn":{templateUrl:"modules/company/views/listInsurer.html",controller:"CompanylistInsurerController"}}}).state("loggedIn.patient.company.edit",{url:"/:companyId/edit",views:{"@loggedIn":{templateUrl:"modules/company/views/edit.html",controller:"CompanyEditController"}}})}),angular.module("app.loggedIn.company.include",["app.loggedIn.company.directives.list","app.loggedIn.company.controllers.list","app.loggedIn.company.models","app.loggedIn.company.controllers.add","app.loggedIn.company.directives.add","app.loggedIn.company.controllers.edit","app.loggedIn.company.directives.edit","app.loggedIn.company.controllers.listParent","app.loggedIn.company.directives.listParent","app.loggedIn.company.controllers.listInsurer","app.loggedIn.company.directives.listInsurer","app.loggedIn.company.dialog.addParent","app.loggedIn.company.dialog.addInusrer","app.loggedIn.company.dialog.remove","app.loggedIn.company.services","app.loggedIn.company.directives.listNotFollow","app.loggedIn.company.controllers.listNotFollow","app.loggedIn.company.dialog.listNoFollow","app.loggedIn.company.directives.addCompanyNotFollow","app.loggedIn.company.dialog.addNewInusrer"]),angular.module("app.loggedIn.company.models",[]).factory("CompanyModel",function(Restangular){var instanceService={},mainApi=Restangular.all("api/meditek/v1/company");return instanceService.detail=function(data){var instanceApi=mainApi.all("detail");return instanceApi.post({data:data})},instanceService.list=function(data){var instanceApi=mainApi.all("list");return instanceApi.post({data:data})},instanceService.add=function(data){var instanceApi=mainApi.all("add");return instanceApi.post({data:data})},instanceService.addCompanyNotFollow=function(data){var instanceApi=mainApi.all("addCompanyNotFollow");return instanceApi.post({data:data})},instanceService.insertPatientCompanies=function(company_id,patient_id){var instanceApi=mainApi.all("insertPatientCompanies");return instanceApi.post({company_id:company_id,patient_id:patient_id})},instanceService.listParent=function(data){var instanceApi=mainApi.all("listParent");return instanceApi.post({data:data})},instanceService.byCompanyId=function(data){var instanceApi=mainApi.all("byCompanyId");return instanceApi.post({data:data})},instanceService.listInsurer=function(data){var instanceApi=mainApi.all("listInsurer");return instanceApi.post({data:data})},instanceService.edit=function(data){var instanceApi=mainApi.all("edit");return instanceApi.post({data:data})},instanceService.remove=function(data){var instanceApi=mainApi.all("remove");return instanceApi.post({data:data})},instanceService.removeInsurer=function(data){var instanceApi=mainApi.all("removeInsurer");return instanceApi.post({data:data})},instanceService.upCompanyPatient=function(data){var instanceApi=mainApi.all("upCompanyPatient");return instanceApi.post({data:data})},instanceService.disableInsurer=function(data){var instanceApi=mainApi.all("disableInsurer");return instanceApi.post({data:data})},instanceService.disableCompany=function(data){var instanceApi=mainApi.all("disableCompany");return instanceApi.post({data:data})},instanceService.updateInsurer=function(data){var instanceApi=mainApi.all("updateInsurer");return instanceApi.post({data:data})},instanceService.listNotFollow=function(data){var instanceApi=mainApi.all("listNotFollow");return instanceApi.post({data:data})},instanceService.AddlistNotFollow=function(data){var instanceApi=mainApi.all("AddlistNotFollow");return instanceApi.post({data:data})},instanceService.selectInsurer=function(data){var instanceApi=mainApi.all("selectInsurer");return instanceApi.post({data:data})},instanceService.getFromTime=function(data){var instanceApi=mainApi.all("getFromTime");return instanceApi.post({data:data})},instanceService}),angular.module("app.loggedIn.company.services",[]).factory("CompanyService",function(Restangular){var companyService={},companyApi=Restangular.all("api/erm"),mdtApi=Restangular.all("api/meditek/v1/company/"),restApi=Restangular.all("api/restful/Company");return companyService.mdtSearch=function(options){var funcApi=mdtApi.all("search");return funcApi.post(options)},companyService.mdtById=function(company_id){var funcApi=mdtApi.all("byId");return funcApi.post({company_id:company_id})},companyService.detail=function(id){var instanceApi=companyApi.one("v2/companies/detail");return instanceApi.get({id:id})},companyService.insert=function(data){var instanceApi=companyApi.all("v2/companies/insert");return instanceApi.post({data:data})},companyService.update=function(id,data){var instanceApi=companyApi.all("v2/companies/update");return instanceApi.post({id:id,data:data})},companyService["delete"]=function(id){var instanceApi=companyApi.all("v2/companies/delete");return instanceApi.post({id:id})},companyService.get=function(id){return restApi.one(""+id).get()},companyService}),angular.module("app.loggedIn.company.directives.list",[]).directive("listCompany",function(CompanyModel,$filter,$state,$stateParams,$modal,toastr){return{restrict:"EA",templateUrl:"modules/company/directives/templates/list.html",scope:{options:"=",limit:"@",onRowClick:"&",actionCenter:"="},link:function(scope,elem,attrs){var search={page:1,offset:0,limit:parseInt(scope.limit),company_id:$stateParams.companyId,patient_id:$stateParams.patient_id,Company_name:"",Industry:"",Addr:"",from_date:"",to_date:""};scope.onRowClick=function(row){scope.updateCompany.id=row.id,scope.updateCompany.to_date=null,scope.updateCompany.patient_id=$stateParams.patient_id;var postData=angular.copy(scope.updateCompany);CompanyModel.upCompanyPatient(postData).then(function(response){toastr.success("Change Company Active Successfully"),scope.company.load(),scope.actionCenter.runWhenFinish()},function(error){scope.company.errors=angular.copy(error.data.errors)})};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.remove(row).then(function(response){toastr.success("Delete Successfully"),scope.company.load()},function(error){})})};scope.clickEdit=function(row){$state.go("loggedIn.patient.company.edit",{companyId:row.id})};var load=function(){scope.company.loading=!0,CompanyModel.list(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count,scope.company.search.page=1,scope.company.company_idActive=response.data1[0].company_id},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.addClick=function(){$state.go("loggedIn.patient.company.add")},scope.addNewCompany=function(){$modal.open({templateUrl:"modules/company/views/add.html",controller:"CompanyAddController",size:"lg",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){scope.company.load()})};var onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value;break;case"country":scope.company.search.country=option.value}scope.company.load(),loadPage(1)},loadPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()};scope.disableCompany=function(row){var postData={patient_id:$stateParams.patient_id,company_id:row.id,isEnable:row.checkisEnable};CompanyModel.disableCompany(postData).then(function(response){scope.company.load()},function(error){})},scope.SelectCompany=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listNotFollowPatient.html",controller:"CompanyListNoFollowDialog",size:"",resolve:{listId:function(){return scope.company.list}}}).result.then(function(row){var postData={patient_id:$stateParams.patient_id,company_id:row.id};CompanyModel.AddlistNotFollow(postData).then(function(response){scope.company.load()})})},scope.company={search:search,error:"",count:0,loading:!1,list:[],company_idActive:"",load:function(){load()},loadPage:function(page){loadPage(page)},onSearch:function(option){onSearch(option)},remove:function(size){remove(size)}},scope.updateCompany={id:"",patient_id:""},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.list",[]).controller("CompanyListController",function($scope,$state){$scope.actionCenter={runWhenFinish:function(){$scope.getPatientInfo()}}}),angular.module("app.loggedIn.company.directives.listParent",[]).directive("listParent",function(CompanyModel,$filter,$state){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listParent.html",scope:{options:"=",limit:"@",onRowClick:"&",companyId:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",Company_id:scope.companyId,Industry:"",Addr:"",country:""},load=function(){scope.company.loading=!0,CompanyModel.listParent(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.addClick=function(){$state.go("loggedIn.patient.company.add")};var onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value}scope.company.load(),setPage(1)};scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listParent",[]).controller("CompanyListParentController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.listInsurer",[]).directive("listInsurer",function(CompanyModel,$filter,$state,$modal,toastr){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listInsurer.html",scope:{options:"=",limit:"@",onRowClick:"&",insurerArray:"=",responsedata:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",insurerArray:scope.insurerArray,insurer_name:"",address:""},load=function(){scope.company.loading=!0,CompanyModel.listInsurer(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})},onSearch=function(option){switch(option.field){case"insurer_name":scope.company.search.insurer_name=option.value;break;case"address":scope.company.search.address=option.value}scope.company.load(),setPage(1)};scope.addNewInsurer=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/addNewInsurer.html",controller:"CompanyAddNewInsurerDialgosController",size:""}).result.then(function(response){"success"===response.status&&CompanyModel.selectInsurer(response.data.insertId).then(function(response){scope.responsedata=response.data[0]})})},scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listInsurer",[]).controller("CompanylistInsurerController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.addCompanyNotFollow",[]).directive("addCompanyNotFollow",function(CompanyModel,$filter,$state,$modal,$stateParams,toastr,$cookieStore,ConfigService,$q){return{restrict:"EA",templateUrl:"modules/company/directives/templates/add.html",scope:{options:"=",onRowClick:"&",success:"=",actionCenter:"="},link:function(scope,elem,attrs){var actionCenter=scope.actionCenter,form={Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,Site_medic:null,User_id:$cookieStore.get("userInfo").id,isPO:null,isExtra:null,parent_id:null,listInsurerid:[]};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.clickDisable=function(row){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1))};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){toastr.success("Delete Successfully")},function(error){})})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return-1}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row));var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){},function(error){})})},save=function(){ConfigService.beforeSave(scope.company.errors);var postData=angular.copy(scope.company.form);postData.Insurer=""===scope.company.InsurerTemp?null:scope.company.InsurerTemp,postData.listInsurerid=scope.company.listTemp,CompanyModel.addCompanyNotFollow(postData).then(function(response){toastr.success("Add Company Successfully"),actionCenter.saveModal(postData.Company_name,response.data[0].id)},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})};scope.company={form:form,listInsurer:[],listTemp:[],errors:[],Company_name_Parent:"",InsurerTemp:"",checkColor:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)}},scope.cancel=function(){actionCenter.closeModal()}}}}),angular.module("app.loggedIn.company.directives.add",[]).directive("addCompany",function(CompanyModel,$filter,$state,$modal,$stateParams,toastr,$cookieStore,ConfigService){return{restrict:"EA",templateUrl:"modules/company/directives/templates/add.html",scope:{options:"=",onRowClick:"&",actionCenter:"="},link:function(scope,elem,attrs){var parent=document.getElementsByClassName("un_tn_modal_remove_background")[0].parentNode;parent.style.background="none",console.log(parent.style.background);var form={Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,Site_medic:[],User_id:$cookieStore.get("userInfo").id,isPO:null,isExtra:null,parent_id:null,listInsurerid:[],from_date:null,to_date:null,patient_id:$stateParams.patient_id,suburb:null};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.clickDisable=function(row){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1))};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){toastr.success("Delete Successfully")},function(error){})})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return-1}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row))})},save=function(){ConfigService.beforeSave(scope.company.errors),_.forEach(form.Site_medic,function(n){delete n.$$hashKey}),scope.company.form.Site_medic=form.Site_medic;var postData=angular.copy(scope.company.form);postData.Insurer=""===scope.company.InsurerTemp?null:scope.company.InsurerTemp,postData.listInsurerid=scope.company.listTemp,postData.from_date&&(postData.from_date=ConfigService.convertToDB(postData.from_date)),postData.to_date&&(postData.to_date=ConfigService.convertToDB(postData.to_date)),CompanyModel.add(postData).then(function(response){toastr.success("Add Company Successfully"),scope.actionCenter.closeModal()},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})},showListCompanyRep=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listCompanyRep.html",controller:function($scope,$modalInstance){$scope.list=form.Site_medic,$scope.onRowClick=function(data){swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Company Rep?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){form.Site_medic.splice(data,1)})},$scope.addlist=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance,toastr){$scope.formAdd=!0,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.submitItem=function(){form.Site_medic.push({name:$scope.listInfo.name}),console.log(form.Site_medic),toastr.success("Add Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.editItem=function(name,index){{var name=name,index=index;$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance){$scope.formAdd=!1,$scope.listInfo={name:name},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.saveItem=function(){form.Site_medic[index].name=$scope.listInfo.name,console.log(form.Site_medic),toastr.success("Edit Company Rep Successfully"),$scope.close()}},size:"sm"})}},$scope.close=function(){$modalInstance.dismiss("cancel")}},size:"md"})};scope.company={form:form,listInsurer:[],listTemp:[],errors:[],Company_name_Parent:"",InsurerTemp:"",checkColor:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)},showListCompanyRep:function(){showListCompanyRep()}},scope.cancel=function(){scope.actionCenter.closeModal()}}}}),angular.module("app.loggedIn.company.controllers.add",[]).controller("CompanyAddController",function($scope,$state,$modalInstance){$scope.actionCenter={closeModal:function(){$modalInstance.close("success")}}}),angular.module("app.loggedIn.company.directives.edit",[]).directive("editCompany",function($filter,$state,$stateParams,CompanyModel,$modal,toastr,$cookieStore,ConfigService){return{restrict:"EA",templateUrl:"modules/company/directives/templates/edit.html",scope:{options:"="},link:function(scope,elem,attrs){var form={id:$stateParams.companyId,patient_id:$stateParams.patient_id,Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,User_id:null,isPO:null,isExtra:null,parent_id:null,listInsurerid:[],from_date:null,to_date:null,suburb:null},load=function(row){scope.company.loading=!0,CompanyModel.byCompanyId(form).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.form=response.data[0],scope.company.form.User_id=$cookieStore.get("userInfo").id,scope.company.listInsurer=response.data1,scope.company.checkColor=scope.company.form.Insurer,_.forEach(scope.company.listInsurer,function(id){scope.company.listTemp.push(id.id)}),scope.company.Company_name_Parent=response.data2[0].Company_name,scope.company.form.from_date=ConfigService.convertToDate(scope.company.form.from_date),scope.company.form.to_date=ConfigService.convertToDate(scope.company.form.to_date),console.log(response.data[0].Site_medic),form.Site_medic=null==response.data[0].Site_medic||void 0==response.data[0].Site_medic||""==response.data[0].Site_medic?[]:JSON.parse(response.data[0].Site_medic),console.log(form.Site_medic)},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.disableInsurer=function(row){var postData={company_id:$stateParams.companyId,insurer_id:row.id,isEnable:row.checkisEnable};CompanyModel.disableInsurer(postData).then(function(response){},function(error){});for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listInsurer[i].checkisEnable=0==scope.company.listInsurer[i].checkisEnable?1:0)};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1));toastr.success("Delete Successfully")},function(error){})})},save=function(){ConfigService.beforeSave(scope.company.errors),scope.company.form.patient_id=$stateParams.patient_id,_.forEach(form.Site_medic,function(n){delete n.$$hashKey}),scope.company.form.Site_medic=form.Site_medic;var postData=angular.copy(scope.company.form);console.log("chiennn",postData),postData.from_date&&(postData.from_date=ConfigService.convertToDB(postData.from_date)),postData.to_date&&(postData.to_date=ConfigService.convertToDB(postData.to_date)),postData.listInsurerid=scope.company.listInsurer,CompanyModel.edit(postData).then(function(response){toastr.success("Edit Company Successfully"),$state.go("loggedIn.patient.company")},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return $stateParams.companyId}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){row.checkisEnable=1;for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row))})},showListCompanyRep=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listCompanyRep.html",controller:function($scope,$modalInstance){$scope.list=form.Site_medic,$scope.onRowClick=function(data){swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Company Rep?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){form.Site_medic.splice(data,1)})},$scope.addlist=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance,toastr){$scope.formAdd=!0,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.submitItem=function(){form.Site_medic.push({name:$scope.listInfo.name}),console.log(form.Site_medic),toastr.success("Add Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.editItem=function(name,index){{var name=name,index=index;$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance){$scope.formAdd=!1,$scope.listInfo={name:name},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.saveItem=function(){form.Site_medic[index].name=$scope.listInfo.name,console.log(form.Site_medic),toastr.success("Edit Company Rep Successfully"),$scope.close()}},size:"sm"})}},$scope.close=function(){$modalInstance.dismiss("cancel")}},size:"md"})};scope.company={form:form,error:"",loading:!1,load:function(){load()},save:function(){save()},listInsurer:[],checkColor:"",listTemp:[],Company_name_Parent:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)},showListCompanyRep:function(){showListCompanyRep()}},scope.cancel=function(){$state.go("loggedIn.patient.company")},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.edit",[]).controller("CompanyEditController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.listNotFollow",[]).directive("listCompanyNotfollow",function(CompanyModel,$filter,$state,$stateParams){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listNotFollowPatient.html",scope:{options:"=",limit:"@",onRowClick:"&",listId:"=",actionCenter:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",Industry:"",Addr:"",country:"",listId:scope.listId},load=function(){scope.company.loading=!0,CompanyModel.listNotFollow(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})},onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value;break;case"country":scope.company.search.country=option.value}scope.company.load(),setPage(1)};scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listNotFollow",[]).controller("CompanyListNotFollowController",function($scope,$state){}),angular.module("app.loggedIn.company.dialog.addParent",[]).controller("CompanyAddParentDialgosController",function($scope,CompanyModel,$modalInstance,companyId){$scope.companyId=companyId,$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.addNewInusrer",[]).controller("CompanyAddNewInsurerDialgosController",function($scope,CompanyModel,$modalInstance){$scope.responsedata=null,$scope.success=!1,$scope.$watch("success",function(success){success&&$scope.$watch("responsedata",function(success){$modalInstance.close($scope.responsedata)})}),$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.addInusrer",[]).controller("CompanyInsurerDialgosController",function($scope,CompanyModel,$modalInstance,insurerArray){$scope.insurerArray=insurerArray,$scope.responsedata=null,$scope.$watch("responsedata",function(success){success&&$modalInstance.close($scope.responsedata)}),$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.listNoFollow",[]).controller("CompanyListNoFollowDialog",function($scope,CompanyModel,$modalInstance,listId){$scope.listId=listId,$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.remove",[]).controller("CompanyRemoveDialog",function($scope,$modalInstance,row){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(row);

}});