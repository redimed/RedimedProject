angular.module("app.loggedIn.mdtrecall",["app.loggedIn.mdtrecall.directives","app.loggedIn.mdtrecall.services"]),angular.module("app.loggedIn.mdtrecall.services",[]).factory("mdtRecallService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtrecall/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtrecall.directives",["app.loggedIn.mdtrecall.detail.directive","app.loggedIn.mdtrecall.search.directive"]),angular.module("app.loggedIn.mdtrecall.detail.directive",[]).directive("mdtrecallDetail",function(mdtRecallModel,ConfigService,mdtRecallService,toastr){return{restrict:"EA",scope:{options:"=",params:"=",onsuccess:"=",actionCenter:"="},templateUrl:"modules/mdtrecall/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.mdtRecallMap=angular.copy(mdtRecallModel),scope.isSubmit=!1,scope.params.permission.edit===!0?mdtRecallService.byId(scope.params.id).then(function(response){if("error"==response.status)return void toastr.error("Error Get Detail","Error");angular.extend(scope.mdtRecallMap,response.data);for(var key in scope.mdtRecallMap)scope.mdtRecallMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtRecallMap[key]=scope.mdtRecallMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtRecallMap[key]=new Date(scope.mdtRecallMap[key])))}):(scope.mdtRecallMap.transaction_date=new Date,scope.mdtRecallMap.patient_id=scope.params.patient_id,scope.mdtRecallMap.created_by=scope.params.created_by)};init(),scope.setRecallDate=function(){scope.mdtRecallMap.recall_period&&(scope.recall_date_temp=moment(scope.mdtRecallMap.transaction_date).add(scope.mdtRecallMap.recall_period,"months"),scope.mdtRecallMap.recall_date=new Date(scope.recall_date_temp))},scope.actionCenter.updateRecall=function(){mdtRecallService.byId(scope.params.id).then(function(response){if("error"==response.status)return void toastr.error("Error Get Detail","Error");angular.extend(scope.mdtRecallMap,response.data);for(var key in scope.mdtRecallMap)scope.mdtRecallMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtRecallMap[key]=scope.mdtRecallMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtRecallMap[key]=new Date(scope.mdtRecallMap[key])))})},console.log(scope.onsuccess),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtrecallForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtRecallMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtRecallService.edit(scope.params.id,postData).then(function(response){return"error"==response.status?void toastr.error("Error Get Detail","Error"):(scope.onsuccess&&scope.onsuccess(),void toastr.success("Update Successfully !!!","Success"))}):(mdtRecallService.add(postData).then(function(response){return"error"==response.status?void toastr.error("Error Get Detail","Error"):(scope.onsuccess&&scope.onsuccess(),void toastr.success("Insert Successfully !!!","Success"))}),init())}}}}}),angular.module("app.loggedIn.mdtrecall.search.directive",[]).directive("mdtrecallSearch",function(mdtRecallService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtrecall/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"patient_id",value:""},{type:"text",name:"notes",value:""},{type:"text",name:"transaction_date",value:""}],select:["patient_id","notes","transaction_date"]}},loadList=function(){mdtRecallService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}});