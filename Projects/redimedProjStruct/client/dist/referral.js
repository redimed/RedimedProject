angular.module("app.loggedIn.referral",["app.loggedIn.referral.controller","app.loggedIn.referral.directives","app.loggedIn.referral.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.referral",{"abstract":!0,views:{"main-content@loggedIn.patient":{templateUrl:"modules/referral/views/structure.html",controller:"ReferralController"}}}).state("loggedIn.patient.referral.list",{url:"/referral",views:{"main-content":{templateUrl:"modules/referral/views/referral-list.html",controller:"ReferralListController"}}})}),angular.module("app.loggedIn.referral.directives",["app.loggedIn.referral.detail.directive"]),angular.module("app.loggedIn.referral.detail.directive",[]).directive("referralDetail",function(ReferralModel,ReferralService,DoctorService,ConfigService,toastr,$stateParams){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/referral/directives/templates/detail.html",link:function(scope,element,attrs){var loadData=function(id){ReferralService.referralDetail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ReferralModel),scope.mode={type:"add",text:"Add referral"},scope.modelObjectMap.APPOINTMENT_DATE=new Date,scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit referral"})}var addProcess=function(postData){postData.Patient_id=$stateParams.patient_id,postData.CAL_ID=$stateParams.cal_id,ReferralService.referralInsert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a referral","Success"),scope.modelObjectMap=angular.copy(ReferralModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){postData.id;delete postData.id,ReferralService.referralUpdate(postData).then(function(response){"success"===response.status&&(toastr.success("Edit referral Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.referral.controller",["app.loggedIn.referral.list.controller"]).controller("ReferralController",function(){}),angular.module("app.loggedIn.referral.list.controller",[]).controller("ReferralListController",function($scope,$stateParams){$scope.referral_panel={},$scope.referral={},$scope.referrals={select:0,"class":function(referral){return{selected:referral.ID==$scope.referral.select}},scope:$scope.referral_panel,options:{api:"api/erm/v2/referral/search",method:"post",scope:$scope.referral_panel,columns:[{field:"ID",is_hide:!0},{field:"CAL_ID",label:"Calendar ID",width:"10%"},{field:"CLINICAL_DETAILS",label:"Clinical details",width:"40%"},{field:"REQUESTING_PRACTITIONER",label:"Requesting practitioner",width:"40%"}],use_filters:!0,filters:{CAL_ID:{type:"text"},CLINICAL_DETAILS:{type:"text"},REQUESTING_PRACTITIONER:{type:"text"}},search:{Patient_id:$stateParams.patient_id},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.referral.id=item.ID,$scope.referralEditForm.open()}},{"class":"fa fa-print",title:"Print",callback:function(item){console.log("this is selected item",item),alert(item),window.open("http://testapp.redimed.com.au:3003/RedimedJavaREST/api/document/referral/"+item.ID)}}]}},$scope.referralAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.referral_panel.reload(),$scope.referralAddForm.close()}},$scope.loadDataAddMakeReferral.load=function(){$scope.referral_panel.reload()},$scope.referralEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.referral_panel.reload(),$scope.referralEditForm.close()}}}),angular.module("app.loggedIn.referral.services",[]).factory("ReferralService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/erm/");return mdtService.referralInsert=function(postData){var detailApi=mdtApi.all("v2/referral/insert");return detailApi.post(postData)},mdtService.referralDetail=function(postData){var detailApi=mdtApi.all("v2/referral/detail");return detailApi.post({ID:postData})},mdtService.referralUpdate=function(postData){var detailApi=mdtApi.all("v2/referral/update");return detailApi.post(postData)},mdtService});