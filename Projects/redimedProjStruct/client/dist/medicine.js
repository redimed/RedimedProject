angular.module("app.loggedIn.medicine",["app.loggedIn.medicine.controller","app.loggedIn.medicine.service","app.loggedIn.medicine.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.medicine",{url:"/medicine","abstract":!0,templateUrl:"modules/medicine/views/structure.html",controller:"MedicineController"}).state("loggedIn.medicine.list",{url:"/list",views:{"main-content":{templateUrl:"modules/medicine/views/list.html",controller:"MedicineListController"}}})}),angular.module("app.loggedIn.medicine.controller",["app.loggedIn.medicine.list.controller"]).controller("MedicineController",function(){}),angular.module("app.loggedIn.medicine.list.controller",[]).controller("MedicineListController",function($scope){$scope.medicine_panel={};$scope.medicine={select:0,scope:$scope.patient_panel,options:{api:"api/erm/v2/medicine/search",method:"post",scope:$scope.medicine_panel,columns:[{field:"medicine_id",is_hide:!0},{field:"medicine_name",label:"Medicine Name"},{field:"medicine_price",label:"Price per unit"}],use_filters:!0,filters:{medicine_name:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.medicine.id=item.medicine_id,$scope.medicineEditForm.open()}}]}},$scope.medicineAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.medicine_panel.reload(),$scope.medicineAddForm.close()}},$scope.medicineEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.medicine_panel.reload(),$scope.medicineEditForm.close()}}}),angular.module("app.loggedIn.medicine.service",[]).factory("MedicineService",function(Restangular,ConfigService,$state){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insert=function(postData){var detailApi=v2_api.all("medicine/insert");return detailApi.post(postData)},instanceService.detail=function(postData){var detailApi=v2_api.all("medicine/detail");return detailApi.post({ID:postData})},instanceService.update=function(postData){var detailApi=v2_api.all("medicine/update");return detailApi.post(postData)},instanceService}),angular.module("app.loggedIn.medicine.directive",["app.loggedIn.medicine.detail.directive"]),angular.module("app.loggedIn.medicine.detail.directive",[]).directive("medicineDetail",function(MedicineModel,MedicineService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/medicine/directives/templates/detail.html",link:function(scope,element,attrs){scope.medicine_unit_options=ConfigService.medicine_unit_option();var loadData=function(id){MedicineService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(MedicineModel),scope.mode={type:"add",text:"Add medicine"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit referral"})}var addProcess=function(postData){MedicineService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Medicine added","Success"),scope.modelObjectMap=angular.copy(MedicineModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){MedicineService.update(postData).then(function(response){"success"===response.status&&(toastr.success("Edit referral Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}});