angular.module("app.loggedIn.insurer",["app.loggedIn.insurer.controller","app.loggedIn.insurer.services","app.loggedIn.insurer.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.insurer",{"abstract":!0,templateUrl:"modules/insurer/views/structure.html",controller:"InsurerController"}).state("loggedIn.insurer.list",{url:"/insurer/list",views:{"main-content":{templateUrl:"modules/insurer/views/list.html",controller:"InsurerListController"}}}).state("loggedIn.insurer.detail",{url:"/insurer/detail",views:{"main-content":{templateUrl:"modules/insurer/views/detail.html",controller:"InsurerDetailController"}}}).state("loggedIn.insurer.add",{url:"/insurer/add",views:{"main-content":{templateUrl:"modules/insurer/views/add.html",controller:"InsurerAddController"}}})}),angular.module("app.loggedIn.insurer.services",[]).factory("InsurerService",function(Restangular){var instanceService={},appApi=Restangular.all("api/erm"),insurerApi=Restangular.all("api/meditek/v1/insurer");return instanceService.detail=function(id){var instanceApi=appApi.one("v2/insurers/detail");return instanceApi.get({id:id})},instanceService.insert=function(data){var instanceApi=appApi.all("v2/insurers/insert");return instanceApi.post({data:data})},instanceService.update=function(id,data){var instanceApi=appApi.all("v2/insurers/update");return instanceApi.post({id:id,data:data})},instanceService["delete"]=function(id){var instanceApi=appApi.all("v2/insurer/delete");return instanceApi.post({id:id})},instanceService.oneFollowPatient=function(data){var instanceApi=insurerApi.all("oneFollowPatient");return instanceApi.post({data:data})},instanceService.getFeeGroup=function(data){var instanceApi=insurerApi.all("getFeeGroup");return instanceApi.post({data:data})},instanceService.oneFollowCompany=function(data){var instanceApi=insurerApi.all("oneFollowCompany");return instanceApi.post({data:data})},instanceService.insurerByPatient=function(patient_id){return insurerApi.all("getByPatient").post({patient_id:patient_id})},instanceService}),angular.module("app.loggedIn.insurer.directives",["app.loggedIn.insurer.detail.directive"]),angular.module("app.loggedIn.insurer.detail.directive",[]).directive("insurerDetail",function(InsurerModel,InsurerService,ConfigService,toastr,InvoiceService,InvoiceService){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess",success:"=",responsedata:"="},templateUrl:"modules/insurer/directives/templates/detail.html",link:function(scope,element,attrs){scope.getFeegrouptype=function(){var postData={FEE_GROUP_TYPE:"private_fund"};InsurerService.getFeeGroup(postData).then(function(response){scope.feeGroupType=response.data})},scope.getFeegrouptype();var loadData=function(id){InsurerService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.row),InvoiceService.getFeegroupbyid({FEE_GROUP_ID:data.row.FEE_GROUP_ID}).then(function(response){scope.modelObjectMap.FEE_GROUP_ID=response.data[0].FEE_GROUP_ID}),scope.modelObjectMap.isenable+="",ConfigService.autoConvertData(scope.modelObjectMap)})};if(ConfigService.countries_option().then(function(result){scope.country_options=result.data}),scope.modelObjectMap=angular.copy(InsurerModel),scope.mode={type:"add",text:"Add Company"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Insurer"})}var addProcess=function(postData){InsurerService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a new Insurer","Success"),scope.modelObjectMap=angular.copy(InsurerModel),scope.isSubmit=!1,scope.success=!0,scope.responsedata=response,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){var id=postData.id;delete postData.id,InsurerService.update(id,postData).then(function(response){"success"===response.status&&(toastr.success("Edit Insurer Successfully","Success"),scope.isSubmit=!1,scope.success=!0,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.insurer.controller",["app.loggedIn.insurer.list.controller","app.loggedIn.insurer.detail.controller","app.loggedIn.insurer.add.controller"]).controller("InsurerController",function($scope){}),angular.module("app.loggedIn.insurer.list.controller",[]).controller("InsurerListController",function($scope,$state,localStorageService,$modal){$scope.insurer_panel={};$scope.data_options={api:"api/erm/v2/insurers/search",method:"post",scope:$scope.insurer_panel,search:{},columns:[{field:"id",is_hide:!0},{field:"insurer_name",label:"Company Name"},{field:"address",label:"Address"},{field:"suburb",label:"Suburb"},{field:"isenable"}]},$scope.add_forminsurer=function(){$modal.open({templateUrl:"add_forminsurer",controller:function($scope,$modalInstance,add_form){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.add_form={success:!1},$scope.$watch("add_form.success",function(success){success&&$modalInstance.close("success")})},resolve:{add_form:function(){return $scope.add_form}}}).result.then(function(response){"success"===response&&$scope.insurer_panel.reload()})},$scope.edit_forminsurer=function(){$modal.open({templateUrl:"edit_forminsurer",controller:function($scope,$modalInstance,edit_form,id){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.edit_form={success:!1,id:id},$scope.$watch("edit_form.success",function(success){success&&$modalInstance.close("success")})},resolve:{edit_form:function(){return $scope.edit_form},id:function(){return $scope.insurerInfo.id}}}).result.then(function(response){"success"===response&&$scope.insurer_panel.reload()})},$scope.add_form={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){$scope.insurer_panel.reload()}},$scope.edit_form={is_show:!1,open:function(){$scope.edit_forminsurer()},close:function(){this.is_show=!1},success:function(response){console.log("edit reloading"),$scope.insurer_panel.reload()}},$scope.clickRow=function(item){$scope.add_form.is_show&&$scope.add_form.close(),$scope.insurerInfo=item,$scope.edit_form.open()},$scope.reload=function(){console.log($scope.data_options.search.SHOW_ALL),$scope.insurer_panel.reload()}}),angular.module("app.loggedIn.insurer.detail.controller",[]).controller("InsurerDetailController",function($scope,$state,localStorageService){$scope.insurerInfo=localStorageService.get("tempInsurerInfo"),$scope.insurerInfo||$state.go("loggedIn.insurer.list")}),angular.module("app.loggedIn.insurer.add.controller",[]).controller("InsurerAddController",function($scope,$state){});