function isPhoneGap(){return(window.cordova||window.PhoneGap||window.phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent)}function MyDatePaginator(selector,momentDate,callBackFunc){var options={selectedDate:momentDate.format("DD-MM-YYYY"),selectedDateFormat:"DD-MM-YYYY",onSelectedDateChanged:function(event,date){callBackFunc(date)}};$(selector).datepaginator(options)}if(function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=Z.type(e);return"function"===n||Z.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,n){if(Z.isFunction(t))return Z.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return Z.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(ae.test(t))return Z.filter(t,e,n);t=Z.filter(t,e)}return Z.grep(e,function(e){return q.call(t,e)>=0!==n})}function o(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function r(e){var t=fe[e]={};return Z.each(e.match(pe)||[],function(e,n){t[n]=!0}),t}function s(){X.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1),Z.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+a.uid++}function l(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(we,"-$1").toLowerCase(),n=e.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:ye.test(n)?Z.parseJSON(n):n}catch(o){}be.set(e,t,n)}else n=void 0;return n}function c(){return!0}function u(){return!1}function d(){try{return X.activeElement}catch(e){}}function h(e,t){return Z.nodeName(e,"table")&&Z.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function p(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function f(e){var t=Ne.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var n=0,i=e.length;i>n;n++)ve.set(e[n],"globalEval",!t||ve.get(t[n],"globalEval"))}function m(e,t){var n,i,o,r,s,a,l,c;if(1===t.nodeType){if(ve.hasData(e)&&(r=ve.access(e),s=ve.set(t,r),c=r.events)){delete s.handle,s.events={};for(o in c)for(n=0,i=c[o].length;i>n;n++)Z.event.add(t,o,c[o][n])}be.hasData(e)&&(a=be.access(e),l=Z.extend({},a),be.set(t,l))}}function v(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&Z.nodeName(e,t)?Z.merge([e],n):n}function b(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Se.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function y(t,n){var i,o=Z(n.createElement(t)).appendTo(n.body),r=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(o[0]))?i.display:Z.css(o[0],"display");return o.detach(),r}function w(e){var t=X,n=je[e];return n||(n=y(e,t),"none"!==n&&n||(Ue=(Ue||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Ue[0].contentDocument,t.write(),t.close(),n=y(e,t),Ue.detach()),je[e]=n),n}function C(e,t,n){var i,o,r,s,a=e.style;return n=n||Be(e),n&&(s=n.getPropertyValue(t)||n[t]),n&&(""!==s||Z.contains(e.ownerDocument,e)||(s=Z.style(e,t)),We.test(s)&&He.test(t)&&(i=a.width,o=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=i,a.minWidth=o,a.maxWidth=r)),void 0!==s?s+"":s}function _(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function x(e,t){if(t in e)return t;for(var n=t[0].toUpperCase()+t.slice(1),i=t,o=Ke.length;o--;)if(t=Ke[o]+n,t in e)return t;return i}function S(e,t,n){var i=ze.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function k(e,t,n,i,o){for(var r=n===(i?"border":"content")?4:"width"===t?1:0,s=0;4>r;r+=2)"margin"===n&&(s+=Z.css(e,n+_e[r],!0,o)),i?("content"===n&&(s-=Z.css(e,"padding"+_e[r],!0,o)),"margin"!==n&&(s-=Z.css(e,"border"+_e[r]+"Width",!0,o))):(s+=Z.css(e,"padding"+_e[r],!0,o),"padding"!==n&&(s+=Z.css(e,"border"+_e[r]+"Width",!0,o)));return s}function T(e,t,n){var i=!0,o="width"===t?e.offsetWidth:e.offsetHeight,r=Be(e),s="border-box"===Z.css(e,"boxSizing",!1,r);if(0>=o||null==o){if(o=C(e,t,r),(0>o||null==o)&&(o=e.style[t]),We.test(o))return o;i=s&&(Q.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+k(e,t,n||(s?"border":"content"),i,r)+"px"}function $(e,t){for(var n,i,o,r=[],s=0,a=e.length;a>s;s++)i=e[s],i.style&&(r[s]=ve.get(i,"olddisplay"),n=i.style.display,t?(r[s]||"none"!==n||(i.style.display=""),""===i.style.display&&xe(i)&&(r[s]=ve.access(i,"olddisplay",w(i.nodeName)))):(o=xe(i),"none"===n&&o||ve.set(i,"olddisplay",o?n:Z.css(i,"display"))));for(s=0;a>s;s++)i=e[s],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?r[s]||"":"none"));return e}function E(e,t,n,i,o){return new E.prototype.init(e,t,n,i,o)}function D(){return setTimeout(function(){Qe=void 0}),Qe=Z.now()}function I(e,t){var n,i=0,o={height:e};for(t=t?1:0;4>i;i+=2-t)n=_e[i],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function M(e,t,n){for(var i,o=(nt[t]||[]).concat(nt["*"]),r=0,s=o.length;s>r;r++)if(i=o[r].call(n,t,e))return i}function A(e,t,n){var i,o,r,s,a,l,c,u,d=this,h={},p=e.style,f=e.nodeType&&xe(e),g=ve.get(e,"fxshow");n.queue||(a=Z._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,d.always(function(){d.always(function(){a.unqueued--,Z.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],c=Z.css(e,"display"),u="none"===c?ve.get(e,"olddisplay")||w(e.nodeName):c,"inline"===u&&"none"===Z.css(e,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",d.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t)if(o=t[i],Je.exec(o)){if(delete t[i],r=r||"toggle"===o,o===(f?"hide":"show")){if("show"!==o||!g||void 0===g[i])continue;f=!0}h[i]=g&&g[i]||Z.style(e,i)}else c=void 0;if(Z.isEmptyObject(h))"inline"===("none"===c?w(e.nodeName):c)&&(p.display=c);else{g?"hidden"in g&&(f=g.hidden):g=ve.access(e,"fxshow",{}),r&&(g.hidden=!f),f?Z(e).show():d.done(function(){Z(e).hide()}),d.done(function(){var t;ve.remove(e,"fxshow");for(t in h)Z.style(e,t,h[t])});for(i in h)s=M(f?g[i]:0,i,d),i in g||(g[i]=s.start,f&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function O(e,t){var n,i,o,r,s;for(n in e)if(i=Z.camelCase(n),o=t[i],r=e[n],Z.isArray(r)&&(o=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),s=Z.cssHooks[i],s&&"expand"in s){r=s.expand(r),delete e[i];for(n in r)n in e||(e[n]=r[n],t[n]=o)}else t[i]=o}function R(e,t,n){var i,o,r=0,s=tt.length,a=Z.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var t=Qe||D(),n=Math.max(0,c.startTime+c.duration-t),i=n/c.duration||0,r=1-i,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(r);return a.notifyWith(e,[c,r,n]),1>r&&l?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:Z.extend({},t),opts:Z.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Qe||D(),duration:n.duration,tweens:[],createTween:function(t,n){var i=Z.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var n=0,i=t?c.tweens.length:0;if(o)return this;for(o=!0;i>n;n++)c.tweens[n].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),u=c.props;for(O(u,c.opts.specialEasing);s>r;r++)if(i=tt[r].call(c,e,u,c.opts))return i;return Z.map(u,M,c),Z.isFunction(c.opts.start)&&c.opts.start.call(e,c),Z.fx.timer(Z.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function P(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,o=0,r=t.toLowerCase().match(pe)||[];if(Z.isFunction(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function N(e,t,n,i){function o(a){var l;return r[a]=!0,Z.each(e[a]||[],function(e,a){var c=a(t,n,i);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),o(c),!1)}),l}var r={},s=e===yt;return o(t.dataTypes[0])||!r["*"]&&o("*")}function L(e,t){var n,i,o=Z.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:i||(i={}))[n]=t[n]);return i&&Z.extend(!0,e,i),e}function F(e,t,n){for(var i,o,r,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in a)if(a[o]&&a[o].test(i)){l.unshift(o);break}if(l[0]in n)r=l[0];else{for(o in n){if(!l[0]||e.converters[o+" "+l[0]]){r=o;break}s||(s=o)}r=r||s}return r?(r!==l[0]&&l.unshift(r),n[r]):void 0}function U(e,t,n,i){var o,r,s,a,l,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(r=u.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=u.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(s=c[l+" "+r]||c["* "+r],!s)for(o in c)if(a=o.split(" "),a[1]===r&&(s=c[l+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[o]:c[o]!==!0&&(r=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(d){return{state:"parsererror",error:s?d:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}function j(e,t,n,i){var o;if(Z.isArray(t))Z.each(t,function(t,o){n||St.test(e)?i(e,o):j(e+"["+("object"==typeof o?t:"")+"]",o,n,i)});else if(n||"object"!==Z.type(t))i(e,t);else for(o in t)j(e+"["+o+"]",t[o],n,i)}function H(e){return Z.isWindow(e)?e:9===e.nodeType&&e.defaultView}var W=[],B=W.slice,V=W.concat,z=W.push,q=W.indexOf,Y={},G=Y.toString,K=Y.hasOwnProperty,Q={},X=e.document,J="2.1.3",Z=function(e,t){return new Z.fn.init(e,t)},ee=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,te=/^-ms-/,ne=/-([\da-z])/gi,ie=function(e,t){return t.toUpperCase()};Z.fn=Z.prototype={jquery:J,constructor:Z,selector:"",length:0,toArray:function(){return B.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:B.call(this)},pushStack:function(e){var t=Z.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return Z.each(this,e,t)},map:function(e){return this.pushStack(Z.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(B.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:z,sort:W.sort,splice:W.splice},Z.extend=Z.fn.extend=function(){var e,t,n,i,o,r,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||Z.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],i=e[t],s!==i&&(c&&i&&(Z.isPlainObject(i)||(o=Z.isArray(i)))?(o?(o=!1,r=n&&Z.isArray(n)?n:[]):r=n&&Z.isPlainObject(n)?n:{},s[t]=Z.extend(c,r,i)):void 0!==i&&(s[t]=i));return s},Z.extend({expando:"jQuery"+(J+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===Z.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!Z.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==Z.type(e)||e.nodeType||Z.isWindow(e)?!1:e.constructor&&!K.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Y[G.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=Z.trim(e),e&&(1===e.indexOf("use strict")?(t=X.createElement("script"),t.text=e,X.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(te,"ms-").replace(ne,ie)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var o,r=0,s=e.length,a=n(e);if(i){if(a)for(;s>r&&(o=t.apply(e[r],i),o!==!1);r++);else for(r in e)if(o=t.apply(e[r],i),o===!1)break}else if(a)for(;s>r&&(o=t.call(e[r],r,e[r]),o!==!1);r++);else for(r in e)if(o=t.call(e[r],r,e[r]),o===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ee,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?Z.merge(i,"string"==typeof e?[e]:e):z.call(i,e)),i},inArray:function(e,t,n){return null==t?-1:q.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,o=e.length;n>i;i++)e[o++]=t[i];return e.length=o,e},grep:function(e,t,n){for(var i,o=[],r=0,s=e.length,a=!n;s>r;r++)i=!t(e[r],r),i!==a&&o.push(e[r]);return o},map:function(e,t,i){var o,r=0,s=e.length,a=n(e),l=[];if(a)for(;s>r;r++)o=t(e[r],r,i),null!=o&&l.push(o);else for(r in e)o=t(e[r],r,i),null!=o&&l.push(o);return V.apply([],l)},guid:1,proxy:function(e,t){var n,i,o;return"string"==typeof t&&(n=e[t],t=e,e=n),Z.isFunction(e)?(i=B.call(arguments,2),o=function(){return e.apply(t||this,i.concat(B.call(arguments)))},o.guid=e.guid=e.guid||Z.guid++,o):void 0},now:Date.now,support:Q}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Y["[object "+t+"]"]=t.toLowerCase()});var oe=function(e){function t(e,t,n,i){var o,r,s,a,l,c,d,p,f,g;if((t?t.ownerDocument||t:j)!==A&&M(t),t=t||A,n=n||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return n;if(!i&&R){if(11!==a&&(o=be.exec(e)))if(s=o[1]){if(9===a){if(r=t.getElementById(s),!r||!r.parentNode)return n;if(r.id===s)return n.push(r),n}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(s))&&F(t,r)&&r.id===s)return n.push(r),n}else{if(o[2])return J.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&C.getElementsByClassName)return J.apply(n,t.getElementsByClassName(s)),n}if(C.qsa&&(!P||!P.test(e))){if(p=d=U,f=t,g=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=k(e),(d=t.getAttribute("id"))?p=d.replace(we,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=c.length;l--;)c[l]=p+h(c[l]);f=ye.test(e)&&u(t.parentNode)||t,g=c.join(",")}if(g)try{return J.apply(n,f.querySelectorAll(g)),n}catch(m){}finally{d||t.removeAttribute("id")}}}return $(e.replace(le,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>_.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[U]=!0,e}function o(e){var t=A.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var n=e.split("|"),i=e.length;i--;)_.attrHandle[n[i]]=t}function s(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return i(function(t){return t=+t,i(function(n,i){for(var o,r=e([],n.length,t),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function d(){}function h(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function p(e,t,n){var i=t.dir,o=n&&"parentNode"===i,r=W++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var a,l,c=[H,r];if(s){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,s))return!0}else for(;t=t[i];)if(1===t.nodeType||o){if(l=t[U]||(t[U]={}),(a=l[i])&&a[0]===H&&a[1]===r)return c[2]=a[2];if(l[i]=c,c[2]=e(t,n,s))return!0}}}function f(e){return e.length>1?function(t,n,i){for(var o=e.length;o--;)if(!e[o](t,n,i))return!1;return!0}:e[0]}function g(e,n,i){for(var o=0,r=n.length;r>o;o++)t(e,n[o],i);return i}function m(e,t,n,i,o){for(var r,s=[],a=0,l=e.length,c=null!=t;l>a;a++)(r=e[a])&&(!n||n(r,i,o))&&(s.push(r),c&&t.push(a));return s}function v(e,t,n,o,r,s){return o&&!o[U]&&(o=v(o)),r&&!r[U]&&(r=v(r,s)),i(function(i,s,a,l){var c,u,d,h=[],p=[],f=s.length,v=i||g(t||"*",a.nodeType?[a]:a,[]),b=!e||!i&&t?v:m(v,h,e,a,l),y=n?r||(i?e:f||o)?[]:s:b;if(n&&n(b,y,a,l),o)for(c=m(y,p),o(c,[],a,l),u=c.length;u--;)(d=c[u])&&(y[p[u]]=!(b[p[u]]=d));if(i){if(r||e){if(r){for(c=[],u=y.length;u--;)(d=y[u])&&c.push(b[u]=d);r(null,y=[],c,l)}for(u=y.length;u--;)(d=y[u])&&(c=r?ee(i,d):h[u])>-1&&(i[c]=!(s[c]=d))}}else y=m(y===s?y.splice(f,y.length):y),r?r(null,s,y,l):J.apply(s,y)})}function b(e){for(var t,n,i,o=e.length,r=_.relative[e[0].type],s=r||_.relative[" "],a=r?1:0,l=p(function(e){return e===t},s,!0),c=p(function(e){return ee(t,e)>-1},s,!0),u=[function(e,n,i){var o=!r&&(i||n!==E)||((t=n).nodeType?l(e,n,i):c(e,n,i));return t=null,o}];o>a;a++)if(n=_.relative[e[a].type])u=[p(f(u),n)];else{if(n=_.filter[e[a].type].apply(null,e[a].matches),n[U]){for(i=++a;o>i&&!_.relative[e[i].type];i++);return v(a>1&&f(u),a>1&&h(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(le,"$1"),n,i>a&&b(e.slice(a,i)),o>i&&b(e=e.slice(i)),o>i&&h(e))}u.push(n)}return f(u)}function y(e,n){var o=n.length>0,r=e.length>0,s=function(i,s,a,l,c){var u,d,h,p=0,f="0",g=i&&[],v=[],b=E,y=i||r&&_.find.TAG("*",c),w=H+=null==b?1:Math.random()||.1,C=y.length;for(c&&(E=s!==A&&s);f!==C&&null!=(u=y[f]);f++){if(r&&u){for(d=0;h=e[d++];)if(h(u,s,a)){l.push(u);break}c&&(H=w)}o&&((u=!h&&u)&&p--,i&&g.push(u))}if(p+=f,o&&f!==p){for(d=0;h=n[d++];)h(g,v,s,a);if(i){if(p>0)for(;f--;)g[f]||v[f]||(v[f]=Q.call(l));v=m(v)}J.apply(l,v),c&&!i&&v.length>0&&p+n.length>1&&t.uniqueSort(l)}return c&&(H=w,E=b),g};return o?i(s):s}var w,C,_,x,S,k,T,$,E,D,I,M,A,O,R,P,N,L,F,U="sizzle"+1*new Date,j=e.document,H=0,W=0,B=n(),V=n(),z=n(),q=function(e,t){return e===t&&(I=!0),0},Y=1<<31,G={}.hasOwnProperty,K=[],Q=K.pop,X=K.push,J=K.push,Z=K.slice,ee=function(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",ie="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",oe=ie.replace("w","w#"),re="\\["+ne+"*("+ie+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+oe+"))|)"+ne+"*\\]",se=":("+ie+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+re+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),le=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ce=new RegExp("^"+ne+"*,"+ne+"*"),ue=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),de=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),he=new RegExp(se),pe=new RegExp("^"+oe+"$"),fe={ID:new RegExp("^#("+ie+")"),CLASS:new RegExp("^\\.("+ie+")"),TAG:new RegExp("^("+ie.replace("w","w*")+")"),ATTR:new RegExp("^"+re),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},ge=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,be=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,we=/'|\\/g,Ce=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),_e=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},xe=function(){M()};try{J.apply(K=Z.call(j.childNodes),j.childNodes),K[j.childNodes.length].nodeType}catch(Se){J={apply:K.length?function(e,t){X.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}C=t.support={},S=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},M=t.setDocument=function(e){var t,n,i=e?e.ownerDocument||e:j;return i!==A&&9===i.nodeType&&i.documentElement?(A=i,O=i.documentElement,n=i.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",xe,!1):n.attachEvent&&n.attachEvent("onunload",xe)),R=!S(i),C.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),C.getElementsByTagName=o(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),C.getElementsByClassName=ve.test(i.getElementsByClassName),C.getById=o(function(e){return O.appendChild(e).id=U,!i.getElementsByName||!i.getElementsByName(U).length}),C.getById?(_.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&R){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},_.filter.ID=function(e){var t=e.replace(Ce,_e);return function(e){return e.getAttribute("id")===t}}):(delete _.find.ID,_.filter.ID=function(e){var t=e.replace(Ce,_e);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),_.find.TAG=C.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):C.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],o=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},_.find.CLASS=C.getElementsByClassName&&function(e,t){return R?t.getElementsByClassName(e):void 0},N=[],P=[],(C.qsa=ve.test(i.querySelectorAll))&&(o(function(e){O.appendChild(e).innerHTML="<a id='"+U+"'></a><select id='"+U+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&P.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||P.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+U+"-]").length||P.push("~="),e.querySelectorAll(":checked").length||P.push(":checked"),e.querySelectorAll("a#"+U+"+*").length||P.push(".#.+[+~]")}),o(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&P.push("name"+ne+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(C.matchesSelector=ve.test(L=O.matches||O.webkitMatchesSelector||O.mozMatchesSelector||O.oMatchesSelector||O.msMatchesSelector))&&o(function(e){C.disconnectedMatch=L.call(e,"div"),L.call(e,"[s!='']:x"),N.push("!=",se)}),P=P.length&&new RegExp(P.join("|")),N=N.length&&new RegExp(N.join("|")),t=ve.test(O.compareDocumentPosition),F=t||ve.test(O.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=t?function(e,t){if(e===t)return I=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!C.sortDetached&&t.compareDocumentPosition(e)===n?e===i||e.ownerDocument===j&&F(j,e)?-1:t===i||t.ownerDocument===j&&F(j,t)?1:D?ee(D,e)-ee(D,t):0:4&n?-1:1)}:function(e,t){if(e===t)return I=!0,0;var n,o=0,r=e.parentNode,a=t.parentNode,l=[e],c=[t];if(!r||!a)return e===i?-1:t===i?1:r?-1:a?1:D?ee(D,e)-ee(D,t):0;if(r===a)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;l[o]===c[o];)o++;return o?s(l[o],c[o]):l[o]===j?-1:c[o]===j?1:0},i):A},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==A&&M(e),n=n.replace(de,"='$1']"),!(!C.matchesSelector||!R||N&&N.test(n)||P&&P.test(n)))try{var i=L.call(e,n);if(i||C.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(o){}return t(n,A,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==A&&M(e),F(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==A&&M(e);var n=_.attrHandle[t.toLowerCase()],i=n&&G.call(_.attrHandle,t.toLowerCase())?n(e,t,!R):void 0;return void 0!==i?i:C.attributes||!R?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,o=0;if(I=!C.detectDuplicates,D=!C.sortStable&&e.slice(0),e.sort(q),I){for(;t=e[o++];)t===e[o]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return D=null,e},x=t.getText=function(e){var t,n="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=x(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i++];)n+=x(t);return n},_=t.selectors={cacheLength:50,createPseudo:i,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Ce,_e),e[3]=(e[3]||e[4]||e[5]||"").replace(Ce,_e),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&he.test(n)&&(t=k(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Ce,_e).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=B[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&B(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(o){var r=t.attr(o,e);return null==r?"!="===n:n?(r+="","="===n?r===i:"!="===n?r!==i:"^="===n?i&&0===r.indexOf(i):"*="===n?i&&r.indexOf(i)>-1:"$="===n?i&&r.slice(-i.length)===i:"~="===n?(" "+r.replace(ae," ")+" ").indexOf(i)>-1:"|="===n?r===i||r.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,n,i,o){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,l){var c,u,d,h,p,f,g=r!==s?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),b=!l&&!a;if(m){if(r){for(;g;){for(d=t;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&b){for(u=m[U]||(m[U]={}),c=u[e]||[],p=c[0]===H&&c[1],h=c[0]===H&&c[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(h=p=0)||f.pop();)if(1===d.nodeType&&++h&&d===t){u[e]=[H,p,h];break}}else if(b&&(c=(t[U]||(t[U]={}))[e])&&c[0]===H)h=c[1];else for(;(d=++p&&d&&d[g]||(h=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++h||(b&&((d[U]||(d[U]={}))[e]=[H,h]),d!==t)););return h-=o,h===i||h%i===0&&h/i>=0}}},PSEUDO:function(e,n){var o,r=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[U]?r(n):r.length>1?(o=[e,e,"",n],_.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,o=r(e,n),s=o.length;s--;)i=ee(e,o[s]),e[i]=!(t[i]=o[s])}):function(e){return r(e,0,o)}):r}},pseudos:{not:i(function(e){var t=[],n=[],o=T(e.replace(le,"$1"));return o[U]?i(function(e,t,n,i){for(var r,s=o(e,null,i,[]),a=e.length;a--;)(r=s[a])&&(e[a]=!(t[a]=r))}):function(e,i,r){return t[0]=e,o(t,null,r,n),t[0]=null,!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return e=e.replace(Ce,_e),function(t){return(t.textContent||t.innerText||x(t)).indexOf(e)>-1}}),lang:i(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(Ce,_e).toLowerCase(),function(t){var n;do if(n=R?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===O},focus:function(e){return e===A.activeElement&&(!A.hasFocus||A.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return ge.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:c(function(e,t,n){for(var i=0>n?n+t:n;++i<t;)e.push(i);return e})}},_.pseudos.nth=_.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[w]=a(w);for(w in{submit:!0,reset:!0})_.pseudos[w]=l(w);return d.prototype=_.filters=_.pseudos,_.setFilters=new d,k=t.tokenize=function(e,n){var i,o,r,s,a,l,c,u=V[e+" "];if(u)return n?0:u.slice(0);for(a=e,l=[],c=_.preFilter;a;){(!i||(o=ce.exec(a)))&&(o&&(a=a.slice(o[0].length)||a),l.push(r=[])),i=!1,(o=ue.exec(a))&&(i=o.shift(),r.push({value:i,type:o[0].replace(le," ")}),a=a.slice(i.length));for(s in _.filter)!(o=fe[s].exec(a))||c[s]&&!(o=c[s](o))||(i=o.shift(),r.push({value:i,type:s,matches:o}),a=a.slice(i.length));if(!i)break}return n?a.length:a?t.error(e):V(e,l).slice(0)},T=t.compile=function(e,t){var n,i=[],o=[],r=z[e+" "];if(!r){for(t||(t=k(e)),n=t.length;n--;)r=b(t[n]),r[U]?i.push(r):o.push(r);r=z(e,y(o,i)),r.selector=e}return r},$=t.select=function(e,t,n,i){var o,r,s,a,l,c="function"==typeof e&&e,d=!i&&k(e=c.selector||e);if(n=n||[],1===d.length){if(r=d[0]=d[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&C.getById&&9===t.nodeType&&R&&_.relative[r[1].type]){if(t=(_.find.ID(s.matches[0].replace(Ce,_e),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(o=fe.needsContext.test(e)?0:r.length;o--&&(s=r[o],!_.relative[a=s.type]);)if((l=_.find[a])&&(i=l(s.matches[0].replace(Ce,_e),ye.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(o,1),e=i.length&&h(r),!e)return J.apply(n,i),n;break}}return(c||T(e,d))(i,t,!R,n,ye.test(e)&&u(t.parentNode)||t),n},C.sortStable=U.split("").sort(q).join("")===U,C.detectDuplicates=!!I,M(),C.sortDetached=o(function(e){return 1&e.compareDocumentPosition(A.createElement("div"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),C.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||r(te,function(e,t,n){var i;return n?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);Z.find=oe,Z.expr=oe.selectors,Z.expr[":"]=Z.expr.pseudos,
Z.unique=oe.uniqueSort,Z.text=oe.getText,Z.isXMLDoc=oe.isXML,Z.contains=oe.contains;var re=Z.expr.match.needsContext,se=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ae=/^.[^:#\[\.,]*$/;Z.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?Z.find.matchesSelector(i,e)?[i]:[]:Z.find.matches(e,Z.grep(t,function(e){return 1===e.nodeType}))},Z.fn.extend({find:function(e){var t,n=this.length,i=[],o=this;if("string"!=typeof e)return this.pushStack(Z(e).filter(function(){for(t=0;n>t;t++)if(Z.contains(o[t],this))return!0}));for(t=0;n>t;t++)Z.find(e,o[t],i);return i=this.pushStack(n>1?Z.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&re.test(e)?Z(e):e||[],!1).length}});var le,ce=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ue=Z.fn.init=function(e,t){var n,i;if(!e)return this;if("string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ce.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||le).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof Z?t[0]:t,Z.merge(this,Z.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:X,!0)),se.test(n[1])&&Z.isPlainObject(t))for(n in t)Z.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return i=X.getElementById(n[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=X,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):Z.isFunction(e)?"undefined"!=typeof le.ready?le.ready(e):e(Z):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),Z.makeArray(e,this))};ue.prototype=Z.fn,le=Z(X);var de=/^(?:parents|prev(?:Until|All))/,he={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(e,t,n){for(var i=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&Z(e).is(n))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),Z.fn.extend({has:function(e){var t=Z(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(Z.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,i=0,o=this.length,r=[],s=re.test(e)||"string"!=typeof e?Z(e,t||this.context):0;o>i;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&Z.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?Z.unique(r):r)},index:function(e){return e?"string"==typeof e?q.call(Z(e),this[0]):q.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Z.unique(Z.merge(this.get(),Z(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Z.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Z.dir(e,"parentNode")},parentsUntil:function(e,t,n){return Z.dir(e,"parentNode",n)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return Z.dir(e,"nextSibling")},prevAll:function(e){return Z.dir(e,"previousSibling")},nextUntil:function(e,t,n){return Z.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return Z.dir(e,"previousSibling",n)},siblings:function(e){return Z.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return Z.sibling(e.firstChild)},contents:function(e){return e.contentDocument||Z.merge([],e.childNodes)}},function(e,t){Z.fn[e]=function(n,i){var o=Z.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=Z.filter(i,o)),this.length>1&&(he[e]||Z.unique(o),de.test(e)&&o.reverse()),this.pushStack(o)}});var pe=/\S+/g,fe={};Z.Callbacks=function(e){e="string"==typeof e?fe[e]||r(e):Z.extend({},e);var t,n,i,o,s,a,l=[],c=!e.once&&[],u=function(r){for(t=e.memory&&r,n=!0,a=o||0,o=0,s=l.length,i=!0;l&&s>a;a++)if(l[a].apply(r[0],r[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,l&&(c?c.length&&u(c.shift()):t?l=[]:d.disable())},d={add:function(){if(l){var n=l.length;!function r(t){Z.each(t,function(t,n){var i=Z.type(n);"function"===i?e.unique&&d.has(n)||l.push(n):n&&n.length&&"string"!==i&&r(n)})}(arguments),i?s=l.length:t&&(o=n,u(t))}return this},remove:function(){return l&&Z.each(arguments,function(e,t){for(var n;(n=Z.inArray(t,l,n))>-1;)l.splice(n,1),i&&(s>=n&&s--,a>=n&&a--)}),this},has:function(e){return e?Z.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=c=t=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,t||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return!l||n&&!c||(t=t||[],t=[e,t.slice?t.slice():t],i?c.push(t):u(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!n}};return d},Z.extend({Deferred:function(e){var t=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return Z.Deferred(function(n){Z.each(t,function(t,r){var s=Z.isFunction(e[t])&&e[t];o[r[1]](function(){var e=s&&s.apply(this,arguments);e&&Z.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r[0]+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?Z.extend(e,i):i}},o={};return i.pipe=i.then,Z.each(t,function(e,r){var s=r[2],a=r[3];i[r[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),o[r[0]]=function(){return o[r[0]+"With"](this===o?i:this,arguments),this},o[r[0]+"With"]=s.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,i,o=0,r=B.call(arguments),s=r.length,a=1!==s||e&&Z.isFunction(e.promise)?s:0,l=1===a?e:Z.Deferred(),c=function(e,n,i){return function(o){n[e]=this,i[e]=arguments.length>1?B.call(arguments):o,i===t?l.notifyWith(n,i):--a||l.resolveWith(n,i)}};if(s>1)for(t=new Array(s),n=new Array(s),i=new Array(s);s>o;o++)r[o]&&Z.isFunction(r[o].promise)?r[o].promise().done(c(o,i,r)).fail(l.reject).progress(c(o,n,t)):--a;return a||l.resolveWith(i,r),l.promise()}});var ge;Z.fn.ready=function(e){return Z.ready.promise().done(e),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(e){e?Z.readyWait++:Z.ready(!0)},ready:function(e){(e===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,e!==!0&&--Z.readyWait>0||(ge.resolveWith(X,[Z]),Z.fn.triggerHandler&&(Z(X).triggerHandler("ready"),Z(X).off("ready"))))}}),Z.ready.promise=function(t){return ge||(ge=Z.Deferred(),"complete"===X.readyState?setTimeout(Z.ready):(X.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1))),ge.promise(t)},Z.ready.promise();var me=Z.access=function(e,t,n,i,o,r,s){var a=0,l=e.length,c=null==n;if("object"===Z.type(n)){o=!0;for(a in n)Z.access(e,t,a,n[a],!0,r,s)}else if(void 0!==i&&(o=!0,Z.isFunction(i)||(s=!0),c&&(s?(t.call(e,i),t=null):(c=t,t=function(e,t,n){return c.call(Z(e),n)})),t))for(;l>a;a++)t(e[a],n,s?i:i.call(e[a],a,t(e[a],n)));return o?e:c?t.call(e):l?t(e[0],n):r};Z.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},a.uid=1,a.accepts=Z.acceptData,a.prototype={key:function(e){if(!a.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=a.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(i){t[this.expando]=n,Z.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var i,o=this.key(e),r=this.cache[o];if("string"==typeof t)r[t]=n;else if(Z.isEmptyObject(r))Z.extend(this.cache[o],t);else for(i in t)r[i]=t[i];return r},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,n){var i;return void 0===t||t&&"string"==typeof t&&void 0===n?(i=this.get(e,t),void 0!==i?i:this.get(e,Z.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i,o,r=this.key(e),s=this.cache[r];if(void 0===t)this.cache[r]={};else{Z.isArray(t)?i=t.concat(t.map(Z.camelCase)):(o=Z.camelCase(t),t in s?i=[t,o]:(i=o,i=i in s?[i]:i.match(pe)||[])),n=i.length;for(;n--;)delete s[i[n]]}},hasData:function(e){return!Z.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var ve=new a,be=new a,ye=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,we=/([A-Z])/g;Z.extend({hasData:function(e){return be.hasData(e)||ve.hasData(e)},data:function(e,t,n){return be.access(e,t,n)},removeData:function(e,t){be.remove(e,t)},_data:function(e,t,n){return ve.access(e,t,n)},_removeData:function(e,t){ve.remove(e,t)}}),Z.fn.extend({data:function(e,t){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(o=be.get(r),1===r.nodeType&&!ve.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=Z.camelCase(i.slice(5)),l(r,i,o[i])));ve.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof e?this.each(function(){be.set(this,e)}):me(this,function(t){var n,i=Z.camelCase(e);if(r&&void 0===t){if(n=be.get(r,e),void 0!==n)return n;if(n=be.get(r,i),void 0!==n)return n;if(n=l(r,i,void 0),void 0!==n)return n}else this.each(function(){var n=be.get(this,i);be.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&be.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){be.remove(this,e)})}}),Z.extend({queue:function(e,t,n){var i;return e?(t=(t||"fx")+"queue",i=ve.get(e,t),n&&(!i||Z.isArray(n)?i=ve.access(e,t,Z.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=Z.queue(e,t),i=n.length,o=n.shift(),r=Z._queueHooks(e,t),s=function(){Z.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===t&&n.unshift("inprogress"),delete r.stop,o.call(e,s,r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ve.get(e,n)||ve.access(e,n,{empty:Z.Callbacks("once memory").add(function(){ve.remove(e,[t+"queue",n])})})}}),Z.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?Z.queue(this[0],e):void 0===t?this:this.each(function(){var n=Z.queue(this,e,t);Z._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&Z.dequeue(this,e)})},dequeue:function(e){return this.each(function(){Z.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,o=Z.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=ve.get(r[s],e+"queueHooks"),n&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(t)}});var Ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_e=["Top","Right","Bottom","Left"],xe=function(e,t){return e=t||e,"none"===Z.css(e,"display")||!Z.contains(e.ownerDocument,e)},Se=/^(?:checkbox|radio)$/i;!function(){var e=X.createDocumentFragment(),t=e.appendChild(X.createElement("div")),n=X.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),Q.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",Q.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var ke="undefined";Q.focusinBubbles="onfocusin"in e;var Te=/^key/,$e=/^(?:mouse|pointer|contextmenu)|click/,Ee=/^(?:focusinfocus|focusoutblur)$/,De=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(e,t,n,i,o){var r,s,a,l,c,u,d,h,p,f,g,m=ve.get(e);if(m)for(n.handler&&(r=n,n=r.handler,o=r.selector),n.guid||(n.guid=Z.guid++),(l=m.events)||(l=m.events={}),(s=m.handle)||(s=m.handle=function(t){return typeof Z!==ke&&Z.event.triggered!==t.type?Z.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(pe)||[""],c=t.length;c--;)a=De.exec(t[c])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p&&(d=Z.event.special[p]||{},p=(o?d.delegateType:d.bindType)||p,d=Z.event.special[p]||{},u=Z.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&Z.expr.match.needsContext.test(o),namespace:f.join(".")},r),(h=l[p])||(h=l[p]=[],h.delegateCount=0,d.setup&&d.setup.call(e,i,f,s)!==!1||e.addEventListener&&e.addEventListener(p,s,!1)),d.add&&(d.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,u):h.push(u),Z.event.global[p]=!0)},remove:function(e,t,n,i,o){var r,s,a,l,c,u,d,h,p,f,g,m=ve.hasData(e)&&ve.get(e);if(m&&(l=m.events)){for(t=(t||"").match(pe)||[""],c=t.length;c--;)if(a=De.exec(t[c])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p){for(d=Z.event.special[p]||{},p=(i?d.delegateType:d.bindType)||p,h=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=h.length;r--;)u=h[r],!o&&g!==u.origType||n&&n.guid!==u.guid||a&&!a.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(h.splice(r,1),u.selector&&h.delegateCount--,d.remove&&d.remove.call(e,u));s&&!h.length&&(d.teardown&&d.teardown.call(e,f,m.handle)!==!1||Z.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)Z.event.remove(e,p+t[c],n,i,!0);Z.isEmptyObject(l)&&(delete m.handle,ve.remove(e,"events"))}},trigger:function(t,n,i,o){var r,s,a,l,c,u,d,h=[i||X],p=K.call(t,"type")?t.type:t,f=K.call(t,"namespace")?t.namespace.split("."):[];if(s=a=i=i||X,3!==i.nodeType&&8!==i.nodeType&&!Ee.test(p+Z.event.triggered)&&(p.indexOf(".")>=0&&(f=p.split("."),p=f.shift(),f.sort()),c=p.indexOf(":")<0&&"on"+p,t=t[Z.expando]?t:new Z.Event(p,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:Z.makeArray(n,[t]),d=Z.event.special[p]||{},o||!d.trigger||d.trigger.apply(i,n)!==!1)){if(!o&&!d.noBubble&&!Z.isWindow(i)){for(l=d.delegateType||p,Ee.test(l+p)||(s=s.parentNode);s;s=s.parentNode)h.push(s),a=s;a===(i.ownerDocument||X)&&h.push(a.defaultView||a.parentWindow||e)}for(r=0;(s=h[r++])&&!t.isPropagationStopped();)t.type=r>1?l:d.bindType||p,u=(ve.get(s,"events")||{})[t.type]&&ve.get(s,"handle"),u&&u.apply(s,n),u=c&&s[c],u&&u.apply&&Z.acceptData(s)&&(t.result=u.apply(s,n),t.result===!1&&t.preventDefault());return t.type=p,o||t.isDefaultPrevented()||d._default&&d._default.apply(h.pop(),n)!==!1||!Z.acceptData(i)||c&&Z.isFunction(i[p])&&!Z.isWindow(i)&&(a=i[c],a&&(i[c]=null),Z.event.triggered=p,i[p](),Z.event.triggered=void 0,a&&(i[c]=a)),t.result}},dispatch:function(e){e=Z.event.fix(e);var t,n,i,o,r,s=[],a=B.call(arguments),l=(ve.get(this,"events")||{})[e.type]||[],c=Z.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=Z.event.handlers.call(this,e,l),t=0;(o=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(r.namespace))&&(e.handleObj=r,e.data=r.data,i=((Z.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,i,o,r,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(i=[],n=0;a>n;n++)r=t[n],o=r.selector+" ",void 0===i[o]&&(i[o]=r.needsContext?Z(o,this).index(l)>=0:Z.find(o,this,null,[l]).length),i[o]&&i.push(r);i.length&&s.push({elem:l,handlers:i})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,o,r=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||X,i=n.documentElement,o=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)),e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e}},fix:function(e){if(e[Z.expando])return e;var t,n,i,o=e.type,r=e,s=this.fixHooks[o];for(s||(this.fixHooks[o]=s=$e.test(o)?this.mouseHooks:Te.test(o)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,e=new Z.Event(r),t=i.length;t--;)n=i[t],e[n]=r[n];return e.target||(e.target=X),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==d()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===d()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return Z.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var o=Z.extend(new Z.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?Z.event.trigger(o,null,t):Z.event.dispatch.call(t,o),o.isDefaultPrevented()&&n.preventDefault()}},Z.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},Z.Event=function(e,t){return this instanceof Z.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?c:u):this.type=e,t&&Z.extend(this,t),this.timeStamp=e&&e.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(e,t)},Z.Event.prototype={isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=c,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=c,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=c,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Z.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,o=e.relatedTarget,r=e.handleObj;return(!o||o!==i&&!Z.contains(i,o))&&(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),Q.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){Z.event.simulate(t,e.target,Z.event.fix(e),!0)};Z.event.special[t]={setup:function(){var i=this.ownerDocument||this,o=ve.access(i,t);o||i.addEventListener(e,n,!0),ve.access(i,t,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this,o=ve.access(i,t)-1;o?ve.access(i,t,o):(i.removeEventListener(e,n,!0),ve.remove(i,t))}}}),Z.fn.extend({on:function(e,t,n,i,o){var r,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],o);return this}if(null==n&&null==i?(i=t,n=t=void 0):null==i&&("string"==typeof t?(i=n,n=void 0):(i=n,n=t,t=void 0)),i===!1)i=u;else if(!i)return this;return 1===o&&(r=i,i=function(e){return Z().off(e),r.apply(this,arguments)},i.guid=r.guid||(r.guid=Z.guid++)),this.each(function(){Z.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,Z(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=u),this.each(function(){Z.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){Z.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?Z.event.trigger(e,t,n,!0):void 0}});var Ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Me=/<([\w:]+)/,Ae=/<|&#?\w+;/,Oe=/<(?:script|style|link)/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,Pe=/^$|\/(?:java|ecma)script/i,Ne=/^true\/(.*)/,Le=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Fe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Fe.optgroup=Fe.option,Fe.tbody=Fe.tfoot=Fe.colgroup=Fe.caption=Fe.thead,Fe.th=Fe.td,Z.extend({clone:function(e,t,n){var i,o,r,s,a=e.cloneNode(!0),l=Z.contains(e.ownerDocument,e);if(!(Q.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Z.isXMLDoc(e)))for(s=v(a),r=v(e),i=0,o=r.length;o>i;i++)b(r[i],s[i]);if(t)if(n)for(r=r||v(e),s=s||v(a),i=0,o=r.length;o>i;i++)m(r[i],s[i]);else m(e,a);return s=v(a,"script"),s.length>0&&g(s,!l&&v(e,"script")),a},buildFragment:function(e,t,n,i){for(var o,r,s,a,l,c,u=t.createDocumentFragment(),d=[],h=0,p=e.length;p>h;h++)if(o=e[h],o||0===o)if("object"===Z.type(o))Z.merge(d,o.nodeType?[o]:o);else if(Ae.test(o)){for(r=r||u.appendChild(t.createElement("div")),s=(Me.exec(o)||["",""])[1].toLowerCase(),a=Fe[s]||Fe._default,r.innerHTML=a[1]+o.replace(Ie,"<$1></$2>")+a[2],c=a[0];c--;)r=r.lastChild;Z.merge(d,r.childNodes),r=u.firstChild,r.textContent=""}else d.push(t.createTextNode(o));for(u.textContent="",h=0;o=d[h++];)if((!i||-1===Z.inArray(o,i))&&(l=Z.contains(o.ownerDocument,o),r=v(u.appendChild(o),"script"),l&&g(r),n))for(c=0;o=r[c++];)Pe.test(o.type||"")&&n.push(o);return u},cleanData:function(e){for(var t,n,i,o,r=Z.event.special,s=0;void 0!==(n=e[s]);s++){if(Z.acceptData(n)&&(o=n[ve.expando],o&&(t=ve.cache[o]))){if(t.events)for(i in t.events)r[i]?Z.event.remove(n,i):Z.removeEvent(n,i,t.handle);ve.cache[o]&&delete ve.cache[o]}delete be.cache[n[be.expando]]}}}),Z.fn.extend({text:function(e){return me(this,function(e){return void 0===e?Z.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?Z.filter(e,this):this,o=0;null!=(n=i[o]);o++)t||1!==n.nodeType||Z.cleanData(v(n)),n.parentNode&&(t&&Z.contains(n.ownerDocument,n)&&g(v(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(Z.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return Z.clone(this,e,t)})},html:function(e){return me(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!Fe[(Me.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ie,"<$1></$2>");try{for(;i>n;n++)t=this[n]||{},1===t.nodeType&&(Z.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(o){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,Z.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=V.apply([],e);var n,i,o,r,s,a,l=0,c=this.length,u=this,d=c-1,h=e[0],g=Z.isFunction(h);if(g||c>1&&"string"==typeof h&&!Q.checkClone&&Re.test(h))return this.each(function(n){var i=u.eq(n);g&&(e[0]=h.call(this,n,i.html())),i.domManip(e,t)});if(c&&(n=Z.buildFragment(e,this[0].ownerDocument,!1,this),i=n.firstChild,1===n.childNodes.length&&(n=i),i)){for(o=Z.map(v(n,"script"),p),r=o.length;c>l;l++)s=n,l!==d&&(s=Z.clone(s,!0,!0),r&&Z.merge(o,v(s,"script"))),t.call(this[l],s,l);if(r)for(a=o[o.length-1].ownerDocument,Z.map(o,f),l=0;r>l;l++)s=o[l],Pe.test(s.type||"")&&!ve.access(s,"globalEval")&&Z.contains(a,s)&&(s.src?Z._evalUrl&&Z._evalUrl(s.src):Z.globalEval(s.textContent.replace(Le,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Z.fn[e]=function(e){for(var n,i=[],o=Z(e),r=o.length-1,s=0;r>=s;s++)n=s===r?this:this.clone(!0),Z(o[s])[t](n),z.apply(i,n.get());return this.pushStack(i)}});var Ue,je={},He=/^margin/,We=new RegExp("^("+Ce+")(?!px)[a-z%]+$","i"),Be=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",o.appendChild(r);var t=e.getComputedStyle(s,null);n="1%"!==t.top,i="4px"===t.width,o.removeChild(r)}var n,i,o=X.documentElement,r=X.createElement("div"),s=X.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",Q.clearCloneStyle="content-box"===s.style.backgroundClip,r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",r.appendChild(s),e.getComputedStyle&&Z.extend(Q,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==i&&t(),i},reliableMarginRight:function(){var t,n=s.appendChild(X.createElement("div"));return n.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",s.style.width="1px",o.appendChild(r),t=!parseFloat(e.getComputedStyle(n,null).marginRight),o.removeChild(r),s.removeChild(n),t}}))}(),Z.swap=function(e,t,n,i){var o,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];o=n.apply(e,i||[]);for(r in t)e.style[r]=s[r];return o};var Ve=/^(none|table(?!-c[ea]).+)/,ze=new RegExp("^("+Ce+")(.*)$","i"),qe=new RegExp("^([+-])=("+Ce+")","i"),Ye={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"},Ke=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=C(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,r,s,a=Z.camelCase(t),l=e.style;return t=Z.cssProps[a]||(Z.cssProps[a]=x(l,a)),s=Z.cssHooks[t]||Z.cssHooks[a],void 0===n?s&&"get"in s&&void 0!==(o=s.get(e,!1,i))?o:l[t]:(r=typeof n,"string"===r&&(o=qe.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(Z.css(e,t)),r="number"),void(null!=n&&n===n&&("number"!==r||Z.cssNumber[a]||(n+="px"),Q.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,i))||(l[t]=n))))}},css:function(e,t,n,i){var o,r,s,a=Z.camelCase(t);return t=Z.cssProps[a]||(Z.cssProps[a]=x(e.style,a)),s=Z.cssHooks[t]||Z.cssHooks[a],s&&"get"in s&&(o=s.get(e,!0,n)),void 0===o&&(o=C(e,t,i)),"normal"===o&&t in Ge&&(o=Ge[t]),""===n||n?(r=parseFloat(o),n===!0||Z.isNumeric(r)?r||0:o):o}}),Z.each(["height","width"],function(e,t){Z.cssHooks[t]={get:function(e,n,i){return n?Ve.test(Z.css(e,"display"))&&0===e.offsetWidth?Z.swap(e,Ye,function(){return T(e,t,i)}):T(e,t,i):void 0},set:function(e,n,i){var o=i&&Be(e);return S(e,n,i?k(e,t,i,"border-box"===Z.css(e,"boxSizing",!1,o),o):0)}}}),Z.cssHooks.marginRight=_(Q.reliableMarginRight,function(e,t){return t?Z.swap(e,{display:"inline-block"},C,[e,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(e,t){Z.cssHooks[e+t]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];4>i;i++)o[e+_e[i]+t]=r[i]||r[i-2]||r[0];return o}},He.test(e)||(Z.cssHooks[e+t].set=S)}),Z.fn.extend({css:function(e,t){return me(this,function(e,t,n){var i,o,r={},s=0;if(Z.isArray(t)){for(i=Be(e),o=t.length;o>s;s++)r[t[s]]=Z.css(e,t[s],!1,i);return r}return void 0!==n?Z.style(e,t,n):Z.css(e,t)},e,t,arguments.length>1)},show:function(){return $(this,!0)},hide:function(){return $(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){xe(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=E,E.prototype={constructor:E,init:function(e,t,n,i,o,r){this.elem=e,this.prop=n,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(Z.cssNumber[n]?"":"px")},cur:function(){var e=E.propHooks[this.prop];return e&&e.get?e.get(this):E.propHooks._default.get(this)},run:function(e){var t,n=E.propHooks[this.prop];return this.pos=t=this.options.duration?Z.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):E.propHooks._default.set(this),this}},E.prototype.init.prototype=E.prototype,E.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=Z.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){Z.fx.step[e.prop]?Z.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[Z.cssProps[e.prop]]||Z.cssHooks[e.prop])?Z.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},E.propHooks.scrollTop=E.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Z.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},Z.fx=E.prototype.init,Z.fx.step={};var Qe,Xe,Je=/^(?:toggle|show|hide)$/,Ze=new RegExp("^(?:([+-])=|)("+Ce+")([a-z%]*)$","i"),et=/queueHooks$/,tt=[A],nt={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),o=Ze.exec(t),r=o&&o[3]||(Z.cssNumber[e]?"":"px"),s=(Z.cssNumber[e]||"px"!==r&&+i)&&Ze.exec(Z.css(n.elem,e)),a=1,l=20;if(s&&s[3]!==r){r=r||s[3],o=o||[],s=+i||1;do a=a||".5",s/=a,Z.style(n.elem,e,s+r);while(a!==(a=n.cur()/i)&&1!==a&&--l)}return o&&(s=n.start=+s||+i||0,n.unit=r,n.end=o[1]?s+(o[1]+1)*o[2]:+o[2]),n}]};Z.Animation=Z.extend(R,{tweener:function(e,t){Z.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,o=e.length;o>i;i++)n=e[i],nt[n]=nt[n]||[],nt[n].unshift(t)},prefilter:function(e,t){t?tt.unshift(e):tt.push(e)}}),Z.speed=function(e,t,n){var i=e&&"object"==typeof e?Z.extend({},e):{complete:n||!n&&t||Z.isFunction(e)&&e,duration:e,easing:n&&t||t&&!Z.isFunction(t)&&t};return i.duration=Z.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in Z.fx.speeds?Z.fx.speeds[i.duration]:Z.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){Z.isFunction(i.old)&&i.old.call(this),i.queue&&Z.dequeue(this,i.queue)},i},Z.fn.extend({fadeTo:function(e,t,n,i){return this.filter(xe).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var o=Z.isEmptyObject(e),r=Z.speed(t,n,i),s=function(){var t=R(this,Z.extend({},e),r);(o||ve.get(this,"finish"))&&t.stop(!0)};return s.finish=s,o||r.queue===!1?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",r=Z.timers,s=ve.get(this);

if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&et.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(n),t=!1,r.splice(o,1));(t||!n)&&Z.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=ve.get(this),i=n[e+"queue"],o=n[e+"queueHooks"],r=Z.timers,s=i?i.length:0;for(n.finish=!0,Z.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;s>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),Z.each(["toggle","show","hide"],function(e,t){var n=Z.fn[t];Z.fn[t]=function(e,i,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(I(t,!0),e,i,o)}}),Z.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){Z.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),Z.timers=[],Z.fx.tick=function(){var e,t=0,n=Z.timers;for(Qe=Z.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||Z.fx.stop(),Qe=void 0},Z.fx.timer=function(e){Z.timers.push(e),e()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Xe||(Xe=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Xe),Xe=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(e,t){return e=Z.fx?Z.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},function(){var e=X.createElement("input"),t=X.createElement("select"),n=t.appendChild(X.createElement("option"));e.type="checkbox",Q.checkOn=""!==e.value,Q.optSelected=n.selected,t.disabled=!0,Q.optDisabled=!n.disabled,e=X.createElement("input"),e.value="t",e.type="radio",Q.radioValue="t"===e.value}();var it,ot,rt=Z.expr.attrHandle;Z.fn.extend({attr:function(e,t){return me(this,Z.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){Z.removeAttr(this,e)})}}),Z.extend({attr:function(e,t,n){var i,o,r=e.nodeType;return e&&3!==r&&8!==r&&2!==r?typeof e.getAttribute===ke?Z.prop(e,t,n):(1===r&&Z.isXMLDoc(e)||(t=t.toLowerCase(),i=Z.attrHooks[t]||(Z.expr.match.bool.test(t)?ot:it)),void 0===n?i&&"get"in i&&null!==(o=i.get(e,t))?o:(o=Z.find.attr(e,t),null==o?void 0:o):null!==n?i&&"set"in i&&void 0!==(o=i.set(e,n,t))?o:(e.setAttribute(t,n+""),n):void Z.removeAttr(e,t)):void 0},removeAttr:function(e,t){var n,i,o=0,r=t&&t.match(pe);if(r&&1===e.nodeType)for(;n=r[o++];)i=Z.propFix[n]||n,Z.expr.match.bool.test(n)&&(e[i]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!Q.radioValue&&"radio"===t&&Z.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),ot={set:function(e,t,n){return t===!1?Z.removeAttr(e,n):e.setAttribute(n,n),n}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(e,t){var n=rt[t]||Z.find.attr;rt[t]=function(e,t,i){var o,r;return i||(r=rt[t],rt[t]=o,o=null!=n(e,t,i)?t.toLowerCase():null,rt[t]=r),o}});var st=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(e,t){return me(this,Z.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[Z.propFix[e]||e]})}}),Z.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,o,r,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(r=1!==s||!Z.isXMLDoc(e),r&&(t=Z.propFix[t]||t,o=Z.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:e[t]=n:o&&"get"in o&&null!==(i=o.get(e,t))?i:e[t]):void 0},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||st.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),Q.optSelected||(Z.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var at=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(e){var t,n,i,o,r,s,a="string"==typeof e&&e,l=0,c=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(pe)||[];c>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(at," "):" ")){for(r=0;o=t[r++];)i.indexOf(" "+o+" ")<0&&(i+=o+" ");s=Z.trim(i),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,i,o,r,s,a=0===arguments.length||"string"==typeof e&&e,l=0,c=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(pe)||[];c>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(at," "):"")){for(r=0;o=t[r++];)for(;i.indexOf(" "+o+" ")>=0;)i=i.replace(" "+o+" "," ");s=e?Z.trim(i):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(Z.isFunction(e)?function(n){Z(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,i=0,o=Z(this),r=e.match(pe)||[];t=r[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(n===ke||"boolean"===n)&&(this.className&&ve.set(this,"__className__",this.className),this.className=this.className||e===!1?"":ve.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(at," ").indexOf(t)>=0)return!0;return!1}});var lt=/\r/g;Z.fn.extend({val:function(e){var t,n,i,o=this[0];return arguments.length?(i=Z.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,Z(this).val()):e,null==o?o="":"number"==typeof o?o+="":Z.isArray(o)&&(o=Z.map(o,function(e){return null==e?"":e+""})),t=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))})):o?(t=Z.valHooks[o.type]||Z.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(lt,""):null==n?"":n)):void 0}}),Z.extend({valHooks:{option:{get:function(e){var t=Z.find.attr(e,"value");return null!=t?t:Z.trim(Z.text(e))}},select:{get:function(e){for(var t,n,i=e.options,o=e.selectedIndex,r="select-one"===e.type||0>o,s=r?null:[],a=r?o+1:i.length,l=0>o?a:r?o:0;a>l;l++)if(n=i[l],!(!n.selected&&l!==o||(Q.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&Z.nodeName(n.parentNode,"optgroup"))){if(t=Z(n).val(),r)return t;s.push(t)}return s},set:function(e,t){for(var n,i,o=e.options,r=Z.makeArray(t),s=o.length;s--;)i=o[s],(i.selected=Z.inArray(i.value,r)>=0)&&(n=!0);return n||(e.selectedIndex=-1),r}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(e,t){return Z.isArray(t)?e.checked=Z.inArray(Z(e).val(),t)>=0:void 0}},Q.checkOn||(Z.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){Z.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),Z.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var ct=Z.now(),ut=/\?/;Z.parseJSON=function(e){return JSON.parse(e+"")},Z.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&Z.error("Invalid XML: "+e),t};var dt=/#.*$/,ht=/([?&])_=[^&]*/,pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,gt=/^(?:GET|HEAD)$/,mt=/^\/\//,vt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,bt={},yt={},wt="*/".concat("*"),Ct=e.location.href,_t=vt.exec(Ct.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct,type:"GET",isLocal:ft.test(_t[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?L(L(e,Z.ajaxSettings),t):L(Z.ajaxSettings,e)},ajaxPrefilter:P(bt),ajaxTransport:P(yt),ajax:function(e,t){function n(e,t,n,s){var l,u,v,b,w,_=t;2!==y&&(y=2,a&&clearTimeout(a),i=void 0,r=s||"",C.readyState=e>0?4:0,l=e>=200&&300>e||304===e,n&&(b=F(d,C,n)),b=U(d,b,C,l),l?(d.ifModified&&(w=C.getResponseHeader("Last-Modified"),w&&(Z.lastModified[o]=w),w=C.getResponseHeader("etag"),w&&(Z.etag[o]=w)),204===e||"HEAD"===d.type?_="nocontent":304===e?_="notmodified":(_=b.state,u=b.data,v=b.error,l=!v)):(v=_,(e||!_)&&(_="error",0>e&&(e=0))),C.status=e,C.statusText=(t||_)+"",l?f.resolveWith(h,[u,_,C]):f.rejectWith(h,[C,_,v]),C.statusCode(m),m=void 0,c&&p.trigger(l?"ajaxSuccess":"ajaxError",[C,d,l?u:v]),g.fireWith(h,[C,_]),c&&(p.trigger("ajaxComplete",[C,d]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,o,r,s,a,l,c,u,d=Z.ajaxSetup({},t),h=d.context||d,p=d.context&&(h.nodeType||h.jquery)?Z(h):Z.event,f=Z.Deferred(),g=Z.Callbacks("once memory"),m=d.statusCode||{},v={},b={},y=0,w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===y){if(!s)for(s={};t=pt.exec(r);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===y?r:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=b[n]=b[n]||e,v[e]=t),this},overrideMimeType:function(e){return y||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>y)for(t in e)m[t]=[m[t],e[t]];else C.always(e[C.status]);return this},abort:function(e){var t=e||w;return i&&i.abort(t),n(0,t),this}};if(f.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,d.url=((e||d.url||Ct)+"").replace(dt,"").replace(mt,_t[1]+"//"),d.type=t.method||t.type||d.method||d.type,d.dataTypes=Z.trim(d.dataType||"*").toLowerCase().match(pe)||[""],null==d.crossDomain&&(l=vt.exec(d.url.toLowerCase()),d.crossDomain=!(!l||l[1]===_t[1]&&l[2]===_t[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(_t[3]||("http:"===_t[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=Z.param(d.data,d.traditional)),N(bt,d,t,C),2===y)return C;c=Z.event&&d.global,c&&0===Z.active++&&Z.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!gt.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(ut.test(o)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=ht.test(o)?o.replace(ht,"$1_="+ct++):o+(ut.test(o)?"&":"?")+"_="+ct++)),d.ifModified&&(Z.lastModified[o]&&C.setRequestHeader("If-Modified-Since",Z.lastModified[o]),Z.etag[o]&&C.setRequestHeader("If-None-Match",Z.etag[o])),(d.data&&d.hasContent&&d.contentType!==!1||t.contentType)&&C.setRequestHeader("Content-Type",d.contentType),C.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+wt+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)C.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(h,C,d)===!1||2===y))return C.abort();w="abort";for(u in{success:1,error:1,complete:1})C[u](d[u]);if(i=N(yt,d,t,C)){C.readyState=1,c&&p.trigger("ajaxSend",[C,d]),d.async&&d.timeout>0&&(a=setTimeout(function(){C.abort("timeout")},d.timeout));try{y=1,i.send(v,n)}catch(_){if(!(2>y))throw _;n(-1,_)}}else n(-1,"No Transport");return C},getJSON:function(e,t,n){return Z.get(e,t,n,"json")},getScript:function(e,t){return Z.get(e,void 0,t,"script")}}),Z.each(["get","post"],function(e,t){Z[t]=function(e,n,i,o){return Z.isFunction(n)&&(o=o||i,i=n,n=void 0),Z.ajax({url:e,type:t,dataType:o,data:n,success:i})}}),Z._evalUrl=function(e){return Z.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Z.fn.extend({wrapAll:function(e){var t;return Z.isFunction(e)?this.each(function(t){Z(this).wrapAll(e.call(this,t))}):(this[0]&&(t=Z(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(Z.isFunction(e)?function(t){Z(this).wrapInner(e.call(this,t))}:function(){var t=Z(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=Z.isFunction(e);return this.each(function(n){Z(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},Z.expr.filters.visible=function(e){return!Z.expr.filters.hidden(e)};var xt=/%20/g,St=/\[\]$/,kt=/\r?\n/g,Tt=/^(?:submit|button|image|reset|file)$/i,$t=/^(?:input|select|textarea|keygen)/i;Z.param=function(e,t){var n,i=[],o=function(e,t){t=Z.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(e)||e.jquery&&!Z.isPlainObject(e))Z.each(e,function(){o(this.name,this.value)});else for(n in e)j(n,e[n],t,o);return i.join("&").replace(xt,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Z.prop(this,"elements");return e?Z.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Z(this).is(":disabled")&&$t.test(this.nodeName)&&!Tt.test(e)&&(this.checked||!Se.test(e))}).map(function(e,t){var n=Z(this).val();return null==n?null:Z.isArray(n)?Z.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Et=0,Dt={},It={0:200,1223:204},Mt=Z.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Dt)Dt[e]()}),Q.cors=!!Mt&&"withCredentials"in Mt,Q.ajax=Mt=!!Mt,Z.ajaxTransport(function(e){var t;return Q.cors||Mt&&!e.crossDomain?{send:function(n,i){var o,r=e.xhr(),s=++Et;if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)r[o]=e.xhrFields[o];e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)r.setRequestHeader(o,n[o]);t=function(e){return function(){t&&(delete Dt[s],t=r.onload=r.onerror=null,"abort"===e?r.abort():"error"===e?i(r.status,r.statusText):i(It[r.status]||r.status,r.statusText,"string"==typeof r.responseText?{text:r.responseText}:void 0,r.getAllResponseHeaders()))}},r.onload=t(),r.onerror=t("error"),t=Dt[s]=t("abort");try{r.send(e.hasContent&&e.data||null)}catch(a){if(t)throw a}},abort:function(){t&&t()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return Z.globalEval(e),e}}}),Z.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Z.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,o){t=Z("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),X.head.appendChild(t[0])},abort:function(){n&&n()}}}});var At=[],Ot=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=At.pop()||Z.expando+"_"+ct++;return this[e]=!0,e}}),Z.ajaxPrefilter("json jsonp",function(t,n,i){var o,r,s,a=t.jsonp!==!1&&(Ot.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ot.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=Z.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Ot,"$1"+o):t.jsonp!==!1&&(t.url+=(ut.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||Z.error(o+" was not called"),s[0]},t.dataTypes[0]="json",r=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=r,t[o]&&(t.jsonpCallback=n.jsonpCallback,At.push(o)),s&&Z.isFunction(r)&&r(s[0]),s=r=void 0}),"script"):void 0}),Z.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||X;var i=se.exec(e),o=!n&&[];return i?[t.createElement(i[1])]:(i=Z.buildFragment([e],t,o),o&&o.length&&Z(o).remove(),Z.merge([],i.childNodes))};var Rt=Z.fn.load;Z.fn.load=function(e,t,n){if("string"!=typeof e&&Rt)return Rt.apply(this,arguments);var i,o,r,s=this,a=e.indexOf(" ");return a>=0&&(i=Z.trim(e.slice(a)),e=e.slice(0,a)),Z.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(o="POST"),s.length>0&&Z.ajax({url:e,type:o,dataType:"html",data:t}).done(function(e){r=arguments,s.html(i?Z("<div>").append(Z.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){s.each(n,r||[e.responseText,t,e])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Z.fn[t]=function(e){return this.on(t,e)}}),Z.expr.filters.animated=function(e){return Z.grep(Z.timers,function(t){return e===t.elem}).length};var Pt=e.document.documentElement;Z.offset={setOffset:function(e,t,n){var i,o,r,s,a,l,c,u=Z.css(e,"position"),d=Z(e),h={};"static"===u&&(e.style.position="relative"),a=d.offset(),r=Z.css(e,"top"),l=Z.css(e,"left"),c=("absolute"===u||"fixed"===u)&&(r+l).indexOf("auto")>-1,c?(i=d.position(),s=i.top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(l)||0),Z.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(h.top=t.top-a.top+s),null!=t.left&&(h.left=t.left-a.left+o),"using"in t?t.using.call(e,h):d.css(h)}},Z.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){Z.offset.setOffset(this,e,t)});var t,n,i=this[0],o={top:0,left:0},r=i&&i.ownerDocument;return r?(t=r.documentElement,Z.contains(t,i)?(typeof i.getBoundingClientRect!==ke&&(o=i.getBoundingClientRect()),n=H(r),{top:o.top+n.pageYOffset-t.clientTop,left:o.left+n.pageXOffset-t.clientLeft}):o):void 0},position:function(){if(this[0]){var e,t,n=this[0],i={top:0,left:0};return"fixed"===Z.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),Z.nodeName(e[0],"html")||(i=e.offset()),i.top+=Z.css(e[0],"borderTopWidth",!0),i.left+=Z.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-Z.css(n,"marginTop",!0),left:t.left-i.left-Z.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Pt;e&&!Z.nodeName(e,"html")&&"static"===Z.css(e,"position");)e=e.offsetParent;return e||Pt})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var i="pageYOffset"===n;Z.fn[t]=function(o){return me(this,function(t,o,r){var s=H(t);return void 0===r?s?s[n]:t[o]:void(s?s.scrollTo(i?e.pageXOffset:r,i?r:e.pageYOffset):t[o]=r)},t,o,arguments.length,null)}}),Z.each(["top","left"],function(e,t){Z.cssHooks[t]=_(Q.pixelPosition,function(e,n){return n?(n=C(e,t),We.test(n)?Z(e).position()[t]+"px":n):void 0})}),Z.each({Height:"height",Width:"width"},function(e,t){Z.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){Z.fn[i]=function(i,o){var r=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||o===!0?"margin":"border");return me(this,function(t,n,i){var o;return Z.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?Z.css(t,n,s):Z.style(t,n,i,s)},t,r?i:void 0,r,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var Nt=e.jQuery,Lt=e.$;return Z.noConflict=function(t){return e.$===Z&&(e.$=Lt),t&&e.jQuery===Z&&(e.jQuery=Nt),Z},typeof t===ke&&(e.jQuery=e.$=Z),Z}),function(e,t){function n(t,n){var o,r,s,a=t.nodeName.toLowerCase();return"area"===a?(o=t.parentNode,r=o.name,t.href&&r&&"map"===o.nodeName.toLowerCase()?(s=e("img[usemap=#"+r+"]")[0],!!s&&i(s)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var o=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,i){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),i&&i.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,o,r=e(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function o(t,n,i,o){return e.each(r,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?a["inner"+i].call(this):this.each(function(){e(this).css(s,o(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?a["outer"+i].call(this,t):this.each(function(){e(this).css(s,o(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var o,r=e.ui[t].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([n,i[o]])},call:function(e,t,n){var i,o=e.plugins[t];if(o&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;i<o.length;i++)e.options[o[i][0]]&&o[i][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[i]>0?!0:(t[i]=1,o=t[i]>0,t[i]=0,o)}})}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(r){}o(t)},e.widget=function(t,n,i){var o,r,s,a,l={},c=t.split(".")[0];t=t.split(".")[1],o=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[c]=e[c]||{},r=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new n,a.options=e.widget.extend({},a.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=o,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()):void(l[t]=i)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||t:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:o}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete r._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(n){for(var o,r,s=i.call(arguments,1),a=0,l=s.length;l>a;a++)for(o in s[a])r=s[a][o],s[a].hasOwnProperty(o)&&r!==t&&(n[o]=e.isPlainObject(r)?e.isPlainObject(n[o])?e.widget.extend({},n[o],r):e.widget.extend({},r):r);return n},e.widget.bridge=function(n,o){var r=o.prototype.widgetFullName||n;e.fn[n]=function(s){var a="string"==typeof s,l=i.call(arguments,1),c=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,this.each(a?function(){var i,o=e.data(this,r);return o?e.isFunction(o[s])&&"_"!==s.charAt(0)?(i=o[s].apply(o,l),i!==o&&i!==t?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+s+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+s+"'")}:function(){var t=e.data(this,r);t?t.option(s||{})._init():e.data(this,r,new o(s,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var o,r,s,a=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(a={},o=n.split("."),n=o.shift(),o.length){for(r=a[n]=e.widget.extend({},this.options[n]),s=0;s<o.length-1;s++)r[o[s]]=r[o[s]]||{},r=r[o[s]];if(n=o.pop(),1===arguments.length)return r[n]===t?null:r[n];r[n]=i}else{if(1===arguments.length)return this.options[n]===t?null:this.options[n];a[n]=i}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var o,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=o=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),e.each(i,function(i,s){function a(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,u=l[2];u?o.delegate(u,c,a):n.bind(c,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var o,r,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(e.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,r){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),s&&e.effects&&e.effects.effect[a]?i[t](o):a!==t&&i[a]?i[a](o.duration,o.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!n){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,o=1===t.which,r="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;

return o&&!r&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?n/100:1)]}function i(t,n){return parseInt(e.css(t,n),10)||0}function o(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var r,s=Math.max,a=Math.abs,l=Math.round,c=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(r!==t)return r;var n,i,o=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=o.children()[0];return e("body").append(o),n=s.offsetWidth,o.css("overflow","scroll"),i=s.offsetWidth,n===i&&(i=o[0].clientWidth),o.remove(),r=n-i},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),o="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,r="scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight;return{width:r?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]),o=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:o,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return f.apply(this,arguments);t=e.extend({},t);var r,p,g,m,v,b,y=e(t.of),w=e.position.getWithinInfo(t.within),C=e.position.getScrollInfo(w),_=(t.collision||"flip").split(" "),x={};return b=o(y),y[0].preventDefault&&(t.at="left top"),p=b.width,g=b.height,m=b.offset,v=e.extend({},m),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),n=d.exec(i[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?v.left+=p:"center"===t.at[0]&&(v.left+=p/2),"bottom"===t.at[1]?v.top+=g:"center"===t.at[1]&&(v.top+=g/2),r=n(x.at,p,g),v.left+=r[0],v.top+=r[1],this.each(function(){var o,c,u=e(this),d=u.outerWidth(),h=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),S=d+f+i(this,"marginRight")+C.width,k=h+b+i(this,"marginBottom")+C.height,T=e.extend({},v),$=n(x.my,u.outerWidth(),u.outerHeight());"right"===t.my[0]?T.left-=d:"center"===t.my[0]&&(T.left-=d/2),"bottom"===t.my[1]?T.top-=h:"center"===t.my[1]&&(T.top-=h/2),T.left+=$[0],T.top+=$[1],e.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),o={marginLeft:f,marginTop:b},e.each(["left","top"],function(n,i){e.ui.position[_[n]]&&e.ui.position[_[n]][i](T,{targetWidth:p,targetHeight:g,elemWidth:d,elemHeight:h,collisionPosition:o,collisionWidth:S,collisionHeight:k,offset:[r[0]+$[0],r[1]+$[1]],my:t.my,at:t.at,within:w,elem:u})}),t.using&&(c=function(e){var n=m.left-T.left,i=n+p-d,o=m.top-T.top,r=o+g-h,l={target:{element:y,left:m.left,top:m.top,width:p,height:g},element:{element:u,left:T.left,top:T.top,width:d,height:h},horizontal:0>i?"left":n>0?"right":"center",vertical:0>r?"top":o>0?"bottom":"middle"};d>p&&a(n+i)<p&&(l.horizontal="center"),h>g&&a(o+r)<g&&(l.vertical="middle"),l.important=s(a(n),a(i))>s(a(o),a(r))?"horizontal":"vertical",t.using.call(this,e,l)}),u.offset(e.extend(T,{using:c}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,r=i.width,a=e.left-t.collisionPosition.marginLeft,l=o-a,c=a+t.collisionWidth-r-o;t.collisionWidth>r?l>0&&0>=c?(n=e.left+l+t.collisionWidth-r-o,e.left+=l-n):e.left=c>0&&0>=l?o:l>c?o+r-t.collisionWidth:o:l>0?e.left+=l:c>0?e.left-=c:e.left=s(e.left-a,e.left)},top:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,r=t.within.height,a=e.top-t.collisionPosition.marginTop,l=o-a,c=a+t.collisionHeight-r-o;t.collisionHeight>r?l>0&&0>=c?(n=e.top+l+t.collisionHeight-r-o,e.top+=l-n):e.top=c>0&&0>=l?o:l>c?o+r-t.collisionHeight:o:l>0?e.top+=l:c>0?e.top-=c:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var n,i,o=t.within,r=o.offset.left+o.scrollLeft,s=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,c=e.left-t.collisionPosition.marginLeft,u=c-l,d=c+t.collisionWidth-s-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(n=e.left+h+p+f+t.collisionWidth-s-r,(0>n||n<a(u))&&(e.left+=h+p+f)):d>0&&(i=e.left-t.collisionPosition.marginLeft+h+p+f-l,(i>0||a(i)<d)&&(e.left+=h+p+f))},top:function(e,t){var n,i,o=t.within,r=o.offset.top+o.scrollTop,s=o.height,l=o.isWindow?o.scrollTop:o.offset.top,c=e.top-t.collisionPosition.marginTop,u=c-l,d=c+t.collisionHeight-s-l,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,g=-2*t.offset[1];0>u?(i=e.top+p+f+g+t.collisionHeight-s-r,e.top+p+f+g>u&&(0>i||i<a(u))&&(e.top+=p+f+g)):d>0&&(n=e.top-t.collisionPosition.marginTop+p+f+g-l,e.top+p+f+g>d&&(n>0||a(n)<d)&&(e.top+=p+f+g))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,i,o,r,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in i)t.style[r]=i[r];t.appendChild(a),n=s||document.documentElement,n.insertBefore(t,n.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",o=e(a).offset().left,e.support.offsetFractions=o>10&&11>o,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e,t){var n=0,i={},o={};i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="hide",o.height=o.paddingTop=o.paddingBottom=o.borderTopWidth=o.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?void this._activate(t):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),void("disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)))},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var n=e.ui.keyCode,i=this.headers.length,o=this.headers.index(t.target),r=!1;switch(t.keyCode){case n.RIGHT:case n.DOWN:r=this.headers[(o+1)%i];break;case n.LEFT:case n.UP:r=this.headers[(o-1+i)%i];break;case n.SPACE:case n.ENTER:this._eventHandler(t);break;case n.HOME:r=this.headers[0];break;case n.END:r=this.headers[i-1]}r&&(e(t.target).attr("tabIndex",-1),e(r).attr("tabIndex",0),r.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var t,i=this.options,o=i.heightStyle,r=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++n);this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(t){var n=e(this),i=n.attr("id"),o=n.next(),r=o.attr("id");i||(i=s+"-header-"+t,n.attr("id",i)),r||(r=s+"-panel-"+t,o.attr("id",r)),n.attr("aria-controls",r),o.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===o?(t=r.height(),this.element.siblings(":visible").each(function(){var n=e(this),i=n.css("position");"absolute"!==i&&"fixed"!==i&&(t-=n.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===o&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var n=this._findActive(t)[0];n!==this.active[0]&&(n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var n={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,n),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var n=this.options,i=this.active,o=e(t.currentTarget),r=o[0]===i[0],s=r&&n.collapsible,a=s?e():o.next(),l=i.next(),c={oldHeader:i,oldPanel:l,newHeader:s?e():o,newPanel:a};t.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",t,c)===!1||(n.active=s?!1:this.headers.index(o),this.active=r?e():o,this._toggle(c),i.removeClass("ui-accordion-header-active ui-state-active"),n.icons&&i.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header),r||(o.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),n.icons&&o.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader),o.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var n=t.newPanel,i=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=n,this.prevHide=i,this.options.animate?this._animate(n,i,t):(i.hide(),n.show(),this._toggleComplete(t)),i.attr({"aria-hidden":"true"}),i.prev().attr("aria-selected","false"),n.length&&i.length?i.prev().attr({tabIndex:-1,"aria-expanded":"false"}):n.length&&this.headers.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),n.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(e,t,n){var r,s,a,l=this,c=0,u=e.length&&(!t.length||e.index()<t.index()),d=this.options.animate||{},h=u&&d.down||d,p=function(){l._toggleComplete(n)};return"number"==typeof h&&(a=h),"string"==typeof h&&(s=h),s=s||h.easing||d.easing,a=a||h.duration||d.duration,t.length?e.length?(r=e.show().outerHeight(),t.animate(i,{duration:a,easing:s,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(o,{duration:a,easing:s,complete:p,step:function(e,n){n.now=Math.round(e),"height"!==n.prop?c+=n.now:"content"!==l.options.heightStyle&&(n.now=Math.round(r-t.outerHeight()-c),c=0)}})):t.animate(i,a,s,p):e.animate(o,a,s,p)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e,t){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,n,i,o=this.element[0].nodeName.toLowerCase(),r="textarea"===o,s="input"===o;this.isMultiLine=r?!0:s?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[r||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(o){if(this.element.prop("readOnly"))return t=!0,i=!0,void(n=!0);t=!1,i=!1,n=!1;var r=e.ui.keyCode;switch(o.keyCode){case r.PAGE_UP:t=!0,this._move("previousPage",o);break;case r.PAGE_DOWN:t=!0,this._move("nextPage",o);break;case r.UP:t=!0,this._keyEvent("previous",o);break;case r.DOWN:t=!0,this._keyEvent("next",o);break;case r.ENTER:case r.NUMPAD_ENTER:this.menu.active&&(t=!0,o.preventDefault(),this.menu.select(o));break;case r.TAB:this.menu.active&&this.menu.select(o);break;case r.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(o),o.preventDefault());break;default:n=!0,this._searchTimeout(o)}},keypress:function(i){if(t)return t=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&i.preventDefault());if(!n){var o=e.ui.keyCode;switch(i.keyCode){case o.PAGE_UP:this._move("previousPage",i);break;case o.PAGE_DOWN:this._move("nextPage",i);break;case o.UP:this._keyEvent("previous",i);break;case o.DOWN:this._keyEvent("next",i)}}},input:function(e){return i?(i=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(i){i.target===t.element[0]||i.target===n||e.contains(n,i.target)||t.close()})})},menufocus:function(t,n){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});var i=n.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:i})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item"),i=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i,this.selectedItem=n})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,n,i=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,i){i(e.ui.autocomplete.filter(t,n.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(t,o){i.xhr&&i.xhr.abort(),i.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){o(e)},error:function(){o([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty();this._renderMenu(n,t),this.isNewMenu=!0,this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var i=this;e.each(n,function(e,n){i._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var i=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return i.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e,t){var n,i="ui-button ui-widget ui-state-default ui-corner-all",o="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",r=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},s=function(t){var n=t.name,i=t.form,o=e([]);return n&&(n=n.replace(/'/g,"\\'"),o=i?e(i).find("[name='"+n+"']"):e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),o};e.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,r),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,o=this.options,a="checkbox"===this.type||"radio"===this.type,l=a?"":"ui-state-active";null===o.label&&(o.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(i).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){o.disabled||this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){o.disabled||e(this).removeClass(l)}).bind("click"+this.eventNamespace,function(e){o.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),a&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return o.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(o.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];s(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return o.disabled?!1:(e(this).addClass("ui-state-active"),n=this,void t.document.one("mouseup",function(){n=null}))}).bind("mouseup"+this.eventNamespace,function(){return o.disabled?!1:void e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){return o.disabled?!1:void((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",o.disabled),this._resetButton()},_determineButtonType:function(){var e,t,n;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(i+" ui-state-active "+o).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.element.prop("disabled",!!t),void(t&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?s(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var t=this.buttonElement.removeClass(o),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),i=this.options.icons,r=i.primary&&i.secondary,s=[];i.primary||i.secondary?(this.options.text&&s.push("ui-button-text-icon"+(r?"s":i.primary?"-primary":"-secondary")),i.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+i.primary+"'></span>"),i.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+i.secondary+"'></span>"),this.options.text||(s.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(n)))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,
duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=i(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function i(t){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(n,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(n,"mouseover",function(){e.datepicker._isDisabledDatepicker(r.inline?t.parent()[0]:r.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))})}function o(t,n){e.extend(t,n);for(var i in n)null==n[i]&&(t[i]=n[i]);return t}e.extend(e.ui,{datepicker:{version:"1.10.4"}});var r,s="datepicker";e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return o(this._defaults,e||{}),this},_attachDatepicker:function(t,n){var i,o,r;i=t.nodeName.toLowerCase(),o="div"===i||"span"===i,t.id||(this.uuid+=1,t.id="dp"+this.uuid),r=this._newInst(e(t),o),r.settings=e.extend({},n||{}),"input"===i?this._connectDatepicker(t,r):o&&this._inlineDatepicker(t,r)},_newInst:function(t,n){var o=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:o,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?i(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,n){var i=e(t);n.append=e([]),n.trigger=e([]),i.hasClass(this.markerClassName)||(this._attachments(i,n),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(n),e.data(t,s,n),n.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,n){var i,o,r,s=this._get(n,"appendText"),a=this._get(n,"isRTL");n.append&&n.append.remove(),s&&(n.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[a?"before":"after"](n.append)),t.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),i=this._get(n,"showOn"),("focus"===i||"both"===i)&&t.focus(this._showDatepicker),("button"===i||"both"===i)&&(o=this._get(n,"buttonText"),r=this._get(n,"buttonImage"),n.trigger=e(this._get(n,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:r,alt:o,title:o}):e("<button type='button'></button>").addClass(this._triggerClass).html(r?e("<img/>").attr({src:r,alt:o,title:o}):o)),t[a?"before":"after"](n.trigger),n.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,n,i,o,r=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(t=function(e){for(n=0,i=0,o=0;o<e.length;o++)e[o].length>n&&(n=e[o].length,i=o);return i},r.setMonth(t(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),r.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-r.getDay())),e.input.attr("size",this._formatDate(e,r).length)}},_inlineDatepicker:function(t,n){var i=e(t);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(n.dpDiv),e.data(t,s,n),this._setDate(n,this._getDefaultDate(n),!0),this._updateDatepicker(n),this._updateAlternate(n),n.settings.disabled&&this._disableDatepicker(t),n.dpDiv.css("display","block"))},_dialogDatepicker:function(t,n,i,r,a){var l,c,u,d,h,p=this._dialogInst;return p||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},e.data(this._dialogInput[0],s,p)),o(p.settings,r||{}),n=n&&n.constructor===Date?this._formatDate(p,n):n,this._dialogInput.val(n),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(c=document.documentElement.clientWidth,u=document.documentElement.clientHeight,d=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[c/2-100+d,u/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],s,p),this},_destroyDatepicker:function(t){var n,i=e(t),o=e.data(t,s);i.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),e.removeData(t,s),"input"===n?(o.append.remove(),o.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===n||"span"===n)&&i.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var n,i,o=e(t),r=e.data(t,s);o.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),"input"===n?(t.disabled=!1,r.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===n||"span"===n)&&(i=o.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var n,i,o=e(t),r=e.data(t,s);o.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),"input"===n?(t.disabled=!0,r.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===n||"span"===n)&&(i=o.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,s)}catch(n){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(n,i,r){var s,a,l,c,u=this._getInst(n);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):u?"all"===i?e.extend({},u.settings):this._get(u,i):null:(s=i||{},"string"==typeof i&&(s={},s[i]=r),void(u&&(this._curInst===u&&this._hideDatepicker(),a=this._getDateDatepicker(n,!0),l=this._getMinMaxDate(u,"min"),c=this._getMinMaxDate(u,"max"),o(u.settings,s),null!==l&&s.dateFormat!==t&&s.minDate===t&&(u.settings.minDate=this._formatDate(u,l)),null!==c&&s.dateFormat!==t&&s.maxDate===t&&(u.settings.maxDate=this._formatDate(u,c)),"disabled"in s&&(s.disabled?this._disableDatepicker(n):this._enableDatepicker(n)),this._attachments(e(n),u),this._autoSize(u),this._setDate(u,a),this._updateAlternate(u),this._updateDatepicker(u))))},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(t){var n,i,o,r=e.datepicker._getInst(t.target),s=!0,a=r.dpDiv.is(".ui-datepicker-rtl");if(r._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return o=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",r.dpDiv),o[0]&&e.datepicker._selectDay(t.target,r.selectedMonth,r.selectedYear,o[0]),n=e.datepicker._get(r,"onSelect"),n?(i=e.datepicker._formatDate(r),n.apply(r.input?r.input[0]:null,[i,r])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var n,i,o=e.datepicker._getInst(t.target);return e.datepicker._get(o,"constrainInput")?(n=e.datepicker._possibleChars(e.datepicker._get(o,"dateFormat")),i=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">i||!n||n.indexOf(i)>-1):void 0},_doKeyUp:function(t){var n,i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{n=e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i)),n&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(o){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var n,i,r,s,a,l,c;n=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==n&&(e.datepicker._curInst.dpDiv.stop(!0,!0),n&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),i=e.datepicker._get(n,"beforeShow"),r=i?i.apply(t,[t,n]):{},r!==!1&&(o(n.settings,r),n.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(n),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return s|="fixed"===e(this).css("position"),!s}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(n),a=e.datepicker._checkOffset(n,a,s),n.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),n.inline||(l=e.datepicker._get(n,"showAnim"),c=e.datepicker._get(n,"duration"),n.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?n.dpDiv.show(l,e.datepicker._get(n,"showOptions"),c):n.dpDiv[l||"show"](l?c:null),e.datepicker._shouldFocusInput(n)&&n.input.focus(),e.datepicker._curInst=n))}},_updateDatepicker:function(t){this.maxRows=4,r=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n,i=this._getNumberOfMonths(t),o=i[1],s=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),o>1&&t.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",s*o+"em"),t.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(n=t.yearshtml,setTimeout(function(){n===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),n=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,n,i){var o=t.dpDiv.outerWidth(),r=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(i?0:e(document).scrollLeft()),c=document.documentElement.clientHeight+(i?0:e(document).scrollTop());return n.left-=this._get(t,"isRTL")?o-s:0,n.left-=i&&n.left===t.input.offset().left?e(document).scrollLeft():0,n.top-=i&&n.top===t.input.offset().top+a?e(document).scrollTop():0,n.left-=Math.min(n.left,n.left+o>l&&l>o?Math.abs(n.left+o-l):0),n.top-=Math.min(n.top,n.top+r>c&&c>r?Math.abs(r+a):0),n},_findPos:function(t){for(var n,i=this._getInst(t),o=this._get(i,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[o?"previousSibling":"nextSibling"];return n=e(t).offset(),[n.left,n.top]},_hideDatepicker:function(t){var n,i,o,r,a=this._curInst;!a||t&&a!==e.data(t,s)||this._datepickerShowing&&(n=this._get(a,"showAnim"),i=this._get(a,"duration"),o=function(){e.datepicker._tidyDialog(a)},e.effects&&(e.effects.effect[n]||e.effects[n])?a.dpDiv.hide(n,e.datepicker._get(a,"showOptions"),i,o):a.dpDiv["slideDown"===n?"slideUp":"fadeIn"===n?"fadeOut":"hide"](n?i:null,o),n||o(),this._datepickerShowing=!1,r=this._get(a,"onClose"),r&&r.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var n=e(t.target),i=e.datepicker._getInst(n[0]);(n[0].id!==e.datepicker._mainDivId&&0===n.parents("#"+e.datepicker._mainDivId).length&&!n.hasClass(e.datepicker.markerClassName)&&!n.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||n.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==i)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,n,i){var o=e(t),r=this._getInst(o[0]);this._isDisabledDatepicker(o[0])||(this._adjustInstDate(r,n+("M"===i?this._get(r,"showCurrentAtPos"):0),i),this._updateDatepicker(r))},_gotoToday:function(t){var n,i=e(t),o=this._getInst(i[0]);this._get(o,"gotoCurrent")&&o.currentDay?(o.selectedDay=o.currentDay,o.drawMonth=o.selectedMonth=o.currentMonth,o.drawYear=o.selectedYear=o.currentYear):(n=new Date,o.selectedDay=n.getDate(),o.drawMonth=o.selectedMonth=n.getMonth(),o.drawYear=o.selectedYear=n.getFullYear()),this._notifyChange(o),this._adjustDate(i)},_selectMonthYear:function(t,n,i){var o=e(t),r=this._getInst(o[0]);r["selected"+("M"===i?"Month":"Year")]=r["draw"+("M"===i?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(o)},_selectDay:function(t,n,i,o){var r,s=e(t);e(o).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(r=this._getInst(s[0]),r.selectedDay=r.currentDay=e("a",o).html(),r.selectedMonth=r.currentMonth=n,r.selectedYear=r.currentYear=i,this._selectDate(t,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear)))},_clearDate:function(t){var n=e(t);this._selectDate(n,"")},_selectDate:function(t,n){var i,o=e(t),r=this._getInst(o[0]);n=null!=n?n:this._formatDate(r),r.input&&r.input.val(n),this._updateAlternate(r),i=this._get(r,"onSelect"),i?i.apply(r.input?r.input[0]:null,[n,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],"object"!=typeof r.input[0]&&r.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var n,i,o,r=this._get(t,"altField");r&&(n=this._get(t,"altFormat")||this._get(t,"dateFormat"),i=this._getDate(t),o=this.formatDate(n,i,this._getFormatConfig(t)),e(r).each(function(){e(this).val(o)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1},parseDate:function(t,n,i){if(null==t||null==n)throw"Invalid arguments";if(n="object"==typeof n?n.toString():n+"",""===n)return null;var o,r,s,a,l=0,c=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),d=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,h=(i?i.dayNames:null)||this._defaults.dayNames,p=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,f=(i?i.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,b=-1,y=!1,w=function(e){var n=o+1<t.length&&t.charAt(o+1)===e;return n&&o++,n},C=function(e){var t=w(e),i="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,o=new RegExp("^\\d{1,"+i+"}"),r=n.substring(l).match(o);if(!r)throw"Missing number at position "+l;return l+=r[0].length,parseInt(r[0],10)},_=function(t,i,o){var r=-1,s=e.map(w(t)?o:i,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(s,function(e,t){var i=t[1];return n.substr(l,i.length).toLowerCase()===i.toLowerCase()?(r=t[0],l+=i.length,!1):void 0}),-1!==r)return r+1;throw"Unknown name at position "+l},x=function(){if(n.charAt(l)!==t.charAt(o))throw"Unexpected literal at position "+l;l++};for(o=0;o<t.length;o++)if(y)"'"!==t.charAt(o)||w("'")?x():y=!1;else switch(t.charAt(o)){case"d":v=C("d");break;case"D":_("D",d,h);break;case"o":b=C("o");break;case"m":m=C("m");break;case"M":m=_("M",p,f);break;case"y":g=C("y");break;case"@":a=new Date(C("@")),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"!":a=new Date((C("!")-this._ticksTo1970)/1e4),g=a.getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"'":w("'")?x():y=!0;break;default:x()}if(l<n.length&&(s=n.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=g?0:-100)),b>-1)for(m=1,v=b;r=this._getDaysInMonth(g,m-1),!(r>=v);)m++,v-=r;if(a=this._daylightSavingAdjust(new Date(g,m-1,v)),a.getFullYear()!==g||a.getMonth()+1!==m||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var i,o=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,r=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,a=(n?n.monthNames:null)||this._defaults.monthNames,l=function(t){var n=i+1<e.length&&e.charAt(i+1)===t;return n&&i++,n},c=function(e,t,n){var i=""+t;if(l(e))for(;i.length<n;)i="0"+i;return i},u=function(e,t,n,i){return l(e)?i[t]:n[t]},d="",h=!1;if(t)for(i=0;i<e.length;i++)if(h)"'"!==e.charAt(i)||l("'")?d+=e.charAt(i):h=!1;else switch(e.charAt(i)){case"d":d+=c("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),o,r);break;case"o":d+=c("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=c("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),s,a);break;case"y":d+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?d+="'":h=!0;break;default:d+=e.charAt(i)}return d},_possibleChars:function(e){var t,n="",i=!1,o=function(n){var i=t+1<e.length&&e.charAt(t+1)===n;return i&&t++,i};for(t=0;t<e.length;t++)if(i)"'"!==e.charAt(t)||o("'")?n+=e.charAt(t):i=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":o("'")?n+="'":i=!0;break;default:n+=e.charAt(t)}return n},_get:function(e,n){return e.settings[n]!==t?e.settings[n]:this._defaults[n]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var n=this._get(e,"dateFormat"),i=e.lastVal=e.input?e.input.val():null,o=this._getDefaultDate(e),r=o,s=this._getFormatConfig(e);try{r=this.parseDate(n,i,s)||o}catch(a){i=t?"":i}e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),e.currentDay=i?r.getDate():0,e.currentMonth=i?r.getMonth():0,e.currentYear=i?r.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,n,i){var o=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},r=function(n){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),n,e.datepicker._getFormatConfig(t))}catch(i){}for(var o=(n.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,r=o.getFullYear(),s=o.getMonth(),a=o.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,c=l.exec(n);c;){switch(c[2]||"d"){case"d":case"D":a+=parseInt(c[1],10);break;case"w":case"W":a+=7*parseInt(c[1],10);break;case"m":case"M":s+=parseInt(c[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(r,s));break;case"y":case"Y":r+=parseInt(c[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(r,s))}c=l.exec(n)}return new Date(r,s,a)},s=null==n||""===n?i:"string"==typeof n?r(n):"number"==typeof n?isNaN(n)?i:o(n):new Date(n.getTime());return s=s&&"Invalid Date"===s.toString()?i:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var i=!t,o=e.selectedMonth,r=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),o===e.selectedMonth&&r===e.selectedYear||n||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(i?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var n=this._get(t,"stepMonths"),i="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(i,-n,"M")},next:function(){e.datepicker._adjustDate(i,+n,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(i)},selectDay:function(){return e.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(i,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,n,i,o,r,s,a,l,c,u,d,h,p,f,g,m,v,b,y,w,C,_,x,S,k,T,$,E,D,I,M,A,O,R,P,N,L,F,U,j=new Date,H=this._daylightSavingAdjust(new Date(j.getFullYear(),j.getMonth(),j.getDate())),W=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),V=this._get(e,"hideIfNoPrevNext"),z=this._get(e,"navigationAsDateFormat"),q=this._getNumberOfMonths(e),Y=this._get(e,"showCurrentAtPos"),G=this._get(e,"stepMonths"),K=1!==q[0]||1!==q[1],Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),J=this._getMinMaxDate(e,"max"),Z=e.drawMonth-Y,ee=e.drawYear;if(0>Z&&(Z+=12,ee--),J)for(t=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-q[0]*q[1]+1,J.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)Z--,0>Z&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,n=this._get(e,"prevText"),n=z?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,Z-G,1)),this._getFormatConfig(e)):n,i=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"e":"w")+"'>"+n+"</span></a>":V?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"e":"w")+"'>"+n+"</span></a>",o=this._get(e,"nextText"),o=z?this.formatDate(o,this._daylightSavingAdjust(new Date(ee,Z+G,1)),this._getFormatConfig(e)):o,r=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"w":"e")+"'>"+o+"</span></a>":V?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+o+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"w":"e")+"'>"+o+"</span></a>",s=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?Q:H,s=z?this.formatDate(s,a,this._getFormatConfig(e)):s,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",c=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(W?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(W?"":l)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),h=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),g=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),b=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),w="",_=0;_<q[0];_++){for(x="",this.maxRows=4,S=0;S<q[1];S++){if(k=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),T=" ui-corner-all",$="",K){if($+="<div class='ui-datepicker-group",q[1]>1)switch(S){case 0:$+=" ui-datepicker-group-first",T=" ui-corner-"+(W?"right":"left");break;case q[1]-1:$+=" ui-datepicker-group-last",T=" ui-corner-"+(W?"left":"right");break;default:$+=" ui-datepicker-group-middle",T=""}$+="'>"}for($+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&0===_?W?r:i:"")+(/all|right/.test(T)&&0===_?W?i:r:"")+this._generateMonthYearHeader(e,Z,ee,X,J,_>0||S>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",E=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",C=0;7>C;C++)D=(C+u)%7,E+="<th"+((C+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+h[D]+"'>"+p[D]+"</span></th>";for($+=E+"</tr></thead><tbody>",I=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,I)),M=(this._getFirstDayOfMonth(ee,Z)-u+7)%7,A=Math.ceil((M+I)/7),O=K&&this.maxRows>A?this.maxRows:A,this.maxRows=O,R=this._daylightSavingAdjust(new Date(ee,Z,1-M)),P=0;O>P;P++){for($+="<tr>",N=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(R)+"</td>":"",C=0;7>C;C++)L=m?m.apply(e.input?e.input[0]:null,[R]):[!0,""],F=R.getMonth()!==Z,U=F&&!b||!L[0]||X&&X>R||J&&R>J,N+="<td class='"+((C+u+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(R.getTime()===k.getTime()&&Z===e.selectedMonth&&e._keyEvent||y.getTime()===R.getTime()&&y.getTime()===k.getTime()?" "+this._dayOverClass:"")+(U?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!v?"":" "+L[1]+(R.getTime()===Q.getTime()?" "+this._currentClass:"")+(R.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(F&&!v||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(U?"":" data-handler='selectDay' data-event='click' data-month='"+R.getMonth()+"' data-year='"+R.getFullYear()+"'")+">"+(F&&!v?"&#xa0;":U?"<span class='ui-state-default'>"+R.getDate()+"</span>":"<a class='ui-state-default"+(R.getTime()===H.getTime()?" ui-state-highlight":"")+(R.getTime()===Q.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+R.getDate()+"</a>")+"</td>",R.setDate(R.getDate()+1),R=this._daylightSavingAdjust(R);$+=N+"</tr>"}Z++,Z>11&&(Z=0,ee++),$+="</tbody></table>"+(K?"</div>"+(q[0]>0&&S===q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=$}w+=x}return w+=c,e._keyEvent=!1,w},_generateMonthYearHeader:function(e,t,n,i,o,r,s,a){var l,c,u,d,h,p,f,g,m=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),b=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",w="";if(r||!m)w+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(l=i&&i.getFullYear()===n,c=o&&o.getFullYear()===n,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=i.getMonth())&&(!c||u<=o.getMonth())&&(w+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+a[u]+"</option>");w+="</select>"}if(b||(y+=w+(!r&&m&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",r||!v)y+="<span class='ui-datepicker-year'>"+n+"</span>";else{for(d=this._get(e,"yearRange").split(":"),h=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?n+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10);return isNaN(t)?h:t},f=p(d[0]),g=Math.max(f,p(d[1]||"")),f=i?Math.max(f,i.getFullYear()):f,g=o?Math.min(g,o.getFullYear()):g,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===n?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),b&&(y+=(!r&&m&&v?"":"&#xa0;")+w),y+="</div>"},_adjustInstDate:function(e,t,n){var i=e.drawYear+("Y"===n?t:0),o=e.drawMonth+("M"===n?t:0),r=Math.min(e.selectedDay,this._getDaysInMonth(i,o))+("D"===n?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(i,o,r)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"===n||"Y"===n)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),i=this._getMinMaxDate(e,"max"),o=n&&n>t?n:t;return i&&o>i?i:o},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay();

},_canAdjustMonth:function(e,t,n,i){var o=this._getNumberOfMonths(e),r=this._daylightSavingAdjust(new Date(n,i+(0>t?t:o[0]*o[1]),1));return 0>t&&r.setDate(this._getDaysInMonth(r.getFullYear(),r.getMonth())),this._isInRange(e,r)},_isInRange:function(e,t){var n,i,o=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),s=null,a=null,l=this._get(e,"yearRange");return l&&(n=l.split(":"),i=(new Date).getFullYear(),s=parseInt(n[0],10),a=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(s+=i),n[1].match(/[+\-].*/)&&(a+=i)),(!o||t.getTime()>=o.getTime())&&(!r||t.getTime()<=r.getTime())&&(!s||t.getFullYear()>=s)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,i){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var o=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(i,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),o,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(n)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.4"}(jQuery),function(e,t){var n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;0>n&&e(this).css("top",t.top-n)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var n,i=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{n=this.document[0].activeElement,n&&"body"!==n.nodeName.toLowerCase()&&e(n).blur()}catch(o){}this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var n=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return n&&!t&&this._trigger("focus",e),n},open:function(){var t=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function n(){var t=this.document[0].activeElement,n=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);n||this._focusTabbable()}t.preventDefault(),n.call(this),this._delay(n)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB){var n=this.uiDialog.find(":tabbable"),i=n.filter(":first"),o=n.filter(":last");t.target!==o[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==i[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(o.focus(1),t.preventDefault()):(i.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,n=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(n)||e.isArray(n)&&!n.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(n,function(n,i){var o,r;i=e.isFunction(i)?{click:i,text:n}:i,i=e.extend({type:"button"},i),o=i.click,i.click=function(){o.apply(t.element[0],arguments)},r={icons:i.icons,text:i.showText},delete i.icons,delete i.showText,e("<button></button>",i).button(r).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var n=this,i=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,o){e(this).addClass("ui-dialog-dragging"),n._blockFrames(),n._trigger("dragStart",i,t(o))},drag:function(e,i){n._trigger("drag",e,t(i))},stop:function(o,r){i.position=[r.position.left-n.document.scrollLeft(),r.position.top-n.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),n._unblockFrames(),n._trigger("dragStop",o,t(r))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var n=this,i=this.options,o=i.resizable,r=this.uiDialog.css("position"),s="string"==typeof o?o:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:s,start:function(i,o){e(this).addClass("ui-dialog-resizing"),n._blockFrames(),n._trigger("resizeStart",i,t(o))},resize:function(e,i){n._trigger("resize",e,t(i))},stop:function(o,r){i.height=e(this).height(),i.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),n._unblockFrames(),n._trigger("resizeStop",o,t(r))}}).css("position",r)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var o=this,r=!1,s={};e.each(t,function(e,t){o._setOption(e,t),e in n&&(r=!0),e in i&&(s[e]=t)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(e,t){var n,i,o=this.uiDialog;"dialogClass"===e&&o.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(n=o.is(":data(ui-draggable)"),n&&!t&&o.draggable("destroy"),!n&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(i=o.is(":data(ui-resizable)"),i&&!t&&o.resizable("destroy"),i&&"string"==typeof t&&o.resizable("option","handles",t),i||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,n,i=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),i.minWidth>i.width&&(i.width=i.minWidth),e=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),t=Math.max(0,i.minHeight-e),n="number"==typeof i.maxHeight?Math.max(0,i.maxHeight-e):"none","auto"===i.height?this.element.css({minHeight:t,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,i.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,n=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(i){t._allowInteraction(i)||(i.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(n)._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,n=this.options.position,i=[],o=[0,0];n?(("string"==typeof n||"object"==typeof n&&"0"in n)&&(i=n.split?n.split(" "):[n[0],n[1]],1===i.length&&(i[1]=i[0]),e.each(["left","top"],function(e,t){+i[e]===i[e]&&(o[e]=i[e],i[e]=t)}),n={my:i[0]+(o[0]<0?o[0]:"+"+o[0])+" "+i[1]+(o[1]<0?o[1]:"+"+o[1]),at:i.join(" ")}),n=e.extend({},e.ui.dialog.prototype.options.position,n)):n=e.ui.dialog.prototype.options.position,t=this.uiDialog.is(":visible"),t||this.uiDialog.show(),this.uiDialog.position(n),t||this.uiDialog.hide()}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;return o.containment?"window"===o.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),n=e(o.containment),i=n[0],void(i&&(t="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n))):void(this.containment=null)},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(t){var n,i,o,r,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,c=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),s.grid&&(o=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=n?o-this.offset.click.top>=n[1]||o-this.offset.click.top>n[3]?o:o-this.offset.click.top>=n[1]?o-s.grid[1]:o+s.grid[1]:o,r=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=n?r-this.offset.click.left>=n[0]||r-this.offset.click.left>n[2]?r:r-this.offset.click.left>=n[0]?r-s.grid[0]:r+s.grid[0]:r)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var i=e(this).data("ui-draggable"),o=i.options,r=e.extend({},n,{item:i.element});i.sortables=[],e(o.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,r))})},stop:function(t,n){var i=e(this).data("ui-draggable"),o=e.extend({},n,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,o))})},drag:function(t,n){var i=e(this).data("ui-draggable"),o=this;e.each(i.sortables,function(){var r=!1,s=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(o).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",t),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",t),i.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("opacity")&&(o._opacity=i.css("opacity")),i.css("opacity",o.opacity)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._opacity&&e(n.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),i=n.options,o=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(t.pageY-e(document).scrollTop()<i.scrollSensitivity?o=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(o=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?o=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(o=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),o!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),i=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(t,n){var i,o,r,s,a,l,c,u,d,h,p=e(this).data("ui-draggable"),f=p.options,g=f.snapTolerance,m=n.offset.left,v=m+p.helperProportions.width,b=n.offset.top,y=b+p.helperProportions.height;for(d=p.snapElements.length-1;d>=0;d--)a=p.snapElements[d].left,l=a+p.snapElements[d].width,c=p.snapElements[d].top,u=c+p.snapElements[d].height,a-g>v||m>l+g||c-g>y||b>u+g||!e.contains(p.snapElements[d].item.ownerDocument,p.snapElements[d].item)?(p.snapElements[d].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(i=Math.abs(c-y)<=g,o=Math.abs(u-b)<=g,r=Math.abs(a-v)<=g,s=Math.abs(l-m)<=g,i&&(n.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),h=i||o||r||s,"outer"!==f.snapMode&&(i=Math.abs(c-b)<=g,o=Math.abs(u-y)<=g,r=Math.abs(a-m)<=g,s=Math.abs(l-v)<=g,i&&(n.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[d].snapping&&(i||o||r||s||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=i||o||r||s||h)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,i=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});i.length&&(t=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("zIndex")&&(o._zIndex=i.css("zIndex")),i.css("zIndex",o.zIndex)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._zIndex&&e(n.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&t+n>e}e.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,n=this.options,i=n.accept;

this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},e.ui.ddmanager.droppables[n.scope]=e.ui.ddmanager.droppables[n.scope]||[],e.ui.ddmanager.droppables[n.scope].push(this),n.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,n=e.ui.ddmanager.droppables[this.options.scope];t<n.length;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){"accept"===t&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var i=n||e.ui.ddmanager.current,o=!1;return i&&(i.currentItem||i.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===i.options.scope&&t.accept.call(t.element[0],i.currentItem||i.element)&&e.ui.intersect(i,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],i.currentItem||i.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(i)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,i){if(!t.offset)return!1;var o,r,s=(e.positionAbs||e.position.absolute).left,a=(e.positionAbs||e.position.absolute).top,l=s+e.helperProportions.width,c=a+e.helperProportions.height,u=t.offset.left,d=t.offset.top,h=u+t.proportions().width,p=d+t.proportions().height;switch(i){case"fit":return s>=u&&h>=l&&a>=d&&p>=c;case"intersect":return u<s+e.helperProportions.width/2&&l-e.helperProportions.width/2<h&&d<a+e.helperProportions.height/2&&c-e.helperProportions.height/2<p;case"pointer":return o=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,r=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,n(r,d,t.proportions().height)&&n(o,u,t.proportions().width);case"touch":return(a>=d&&p>=a||c>=d&&p>=c||d>a&&c>p)&&(s>=u&&h>=s||l>=u&&h>=l||u>s&&l>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var i,o,r=e.ui.ddmanager.droppables[t.options.scope]||[],s=n?n.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<r.length;i++)if(!(r[i].options.disabled||t&&!r[i].accept.call(r[i].element[0],t.currentItem||t.element))){for(o=0;o<a.length;o++)if(a[o]===r[i].element[0]){r[i].proportions().height=0;continue e}r[i].visible="none"!==r[i].element.css("display"),r[i].visible&&("mousedown"===s&&r[i]._activate.call(r[i],n),r[i].offset=r[i].element.offset(),r[i].proportions({width:r[i].element[0].offsetWidth,height:r[i].element[0].offsetHeight}))}},drop:function(t,n){var i=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(i=this._drop.call(this,n)||i),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)))}),i},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var i,o,r,s=e.ui.intersect(t,this,this.options.tolerance),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(o=this.options.scope,r=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===o}),r.length&&(i=e.data(r[0],"ui-droppable"),i.greedyChild="isover"===a)),i&&"isover"===a&&(i.isover=!1,i.isout=!0,i._out.call(i,n)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,n),i&&"isout"===a&&(i.isout=!1,i.isover=!0,i._over.call(i,n)))}})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function n(e,t,n){var i=d[t.type]||{};return null==e?n||!t.def?null:t.def:(e=i.floor?~~e:parseFloat(e),isNaN(e)?t.def:i.mod?(e+i.mod)%i.mod:0>e?0:i.max<e?i.max:e)}function i(t){var n=c(),i=n._rgba=[];return t=t.toLowerCase(),f(l,function(e,o){var r,s=o.re.exec(t),a=s&&o.parse(s),l=o.space||"rgba";return a?(r=n[l](a),n[u[l].cache]=r[u[l].cache],i=n._rgba=r._rgba,!1):void 0}),i.length?("0,0,0,0"===i.join()&&e.extend(i,r.transparent),n):r[t]}function o(e,t,n){return n=(n+1)%1,1>6*n?e+(t-e)*n*6:1>2*n?t:2>3*n?e+(t-e)*(2/3-n)*6:e}var r,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],c=e.Color=function(t,n,i,o){return new e.Color.fn.parse(t,n,i,o)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=c.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),c.fn=e.extend(c.prototype,{parse:function(o,s,a,l){if(o===t)return this._rgba=[null,null,null,null],this;(o.jquery||o.nodeType)&&(o=e(o).css(s),s=t);var d=this,h=e.type(o),p=this._rgba=[];return s!==t&&(o=[o,s,a,l],h="array"),"string"===h?this.parse(i(o)||r._default):"array"===h?(f(u.rgba.props,function(e,t){p[t.idx]=n(o[t.idx],t)}),this):"object"===h?(o instanceof c?f(u,function(e,t){o[t.cache]&&(d[t.cache]=o[t.cache].slice())}):f(u,function(t,i){var r=i.cache;f(i.props,function(e,t){if(!d[r]&&i.to){if("alpha"===e||null==o[e])return;d[r]=i.to(d._rgba)}d[r][t.idx]=n(o[e],t,!0)}),d[r]&&e.inArray(null,d[r].slice(0,3))<0&&(d[r][3]=1,i.from&&(d._rgba=i.from(d[r])))}),this):void 0},is:function(e){var t=c(e),n=!0,i=this;return f(u,function(e,o){var r,s=t[o.cache];return s&&(r=i[o.cache]||o.to&&o.to(i._rgba)||[],f(o.props,function(e,t){return null!=s[t.idx]?n=s[t.idx]===r[t.idx]:void 0})),n}),n},_space:function(){var e=[],t=this;return f(u,function(n,i){t[i.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var i=c(e),o=i._space(),r=u[o],s=0===this.alpha()?c("transparent"):this,a=s[r.cache]||r.to(s._rgba),l=a.slice();return i=i[r.cache],f(r.props,function(e,o){var r=o.idx,s=a[r],c=i[r],u=d[o.type]||{};null!==c&&(null===s?l[r]=c:(u.mod&&(c-s>u.mod/2?s+=u.mod:s-c>u.mod/2&&(s-=u.mod)),l[r]=n((c-s)*t+s,o)))}),this[o](l)},blend:function(t){if(1===this._rgba[3])return this;var n=this._rgba.slice(),i=n.pop(),o=c(t)._rgba;return c(e.map(n,function(e,t){return(1-i)*o[t]+i*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===n[3]&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===n[3]&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),i=n.pop();return t&&n.push(~~(255*i)),"#"+e.map(n,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,n,i=e[0]/255,o=e[1]/255,r=e[2]/255,s=e[3],a=Math.max(i,o,r),l=Math.min(i,o,r),c=a-l,u=a+l,d=.5*u;return t=l===a?0:i===a?60*(o-r)/c+360:o===a?60*(r-i)/c+120:60*(i-o)/c+240,n=0===c?0:.5>=d?c/u:c/(2-u),[Math.round(t)%360,n,d,null==s?1:s]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,n=e[1],i=e[2],r=e[3],s=.5>=i?i*(1+n):i+n-i*n,a=2*i-s;return[Math.round(255*o(a,s,t+1/3)),Math.round(255*o(a,s,t)),Math.round(255*o(a,s,t-1/3)),r]},f(u,function(i,o){var r=o.props,s=o.cache,l=o.to,u=o.from;c.fn[i]=function(i){if(l&&!this[s]&&(this[s]=l(this._rgba)),i===t)return this[s].slice();var o,a=e.type(i),d="array"===a||"object"===a?i:arguments,h=this[s].slice();return f(r,function(e,t){var i=d["object"===a?e:t.idx];null==i&&(i=h[t.idx]),h[t.idx]=n(i,t)}),u?(o=c(u(h)),o[s]=h,o):c(h)},f(r,function(t,n){c.fn[t]||(c.fn[t]=function(o){var r,s=e.type(o),l="alpha"===t?this._hsla?"hsla":"rgba":i,c=this[l](),u=c[n.idx];return"undefined"===s?u:("function"===s&&(o=o.call(this,u),s=e.type(o)),null==o&&n.empty?this:("string"===s&&(r=a.exec(o),r&&(o=u+parseFloat(r[2])*("+"===r[1]?1:-1))),c[n.idx]=o,this[l](c)))})})}),c.hook=function(t){var n=t.split(" ");f(n,function(t,n){e.cssHooks[n]={set:function(t,o){var r,s,a="";if("transparent"!==o&&("string"!==e.type(o)||(r=i(o)))){if(o=c(r||o),!h.rgba&&1!==o._rgba[3]){for(s="backgroundColor"===n?t.parentNode:t;(""===a||"transparent"===a)&&s&&s.style;)try{a=e.css(s,"backgroundColor"),s=s.parentNode}catch(l){}o=o.blend(a&&"transparent"!==a?a:"_default")}o=o.toRgbaString()}try{t.style[n]=o}catch(l){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=c(t.elem,n),t.end=c(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},c.hook(s),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(n,i){t["border"+i+"Color"]=e}),t}},r=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(t){var n,i,o=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,r={};if(o&&o.length&&o[0]&&o[o[0]])for(i=o.length;i--;)n=o[i],"string"==typeof o[n]&&(r[e.camelCase(n)]=o[n]);else for(n in o)"string"==typeof o[n]&&(r[n]=o[n]);return r}function i(t,n){var i,o,s={};for(i in n)o=n[i],t[i]!==o&&(r[i]||(e.fx.step[i]||!isNaN(parseFloat(o)))&&(s[i]=o));return s}var o=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,n,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,r,s,a){var l=e.speed(r,s,a);return this.queue(function(){var r,s=e(this),a=s.attr("class")||"",c=l.children?s.find("*").addBack():s;c=c.map(function(){var t=e(this);return{el:t,start:n(this)}}),r=function(){e.each(o,function(e,n){t[n]&&s[n+"Class"](t[n])})},r(),c=c.map(function(){return this.end=n(this.el[0]),this.diff=i(this.start,this.end),this}),s.attr("class",a),c=c.map(function(){var t=this,n=e.Deferred(),i=e.extend({},l,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,i),n.promise()}),e.when.apply(e,c.get()).done(function(){r(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(s[0])})})},e.fn.extend({addClass:function(t){return function(n,i,o,r){return i?e.effects.animateClass.call(this,{add:n},i,o,r):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(n,i,o,r){return arguments.length>1?e.effects.animateClass.call(this,{remove:n},i,o,r):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(n){return function(i,o,r,s,a){return"boolean"==typeof o||o===t?r?e.effects.animateClass.call(this,o?{add:i}:{remove:i},r,s,a):n.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},o,r,s)}}(e.fn.toggleClass),switchClass:function(t,n,i,o,r){return e.effects.animateClass.call(this,{add:n,remove:t},i,o,r)}})}(),function(){function i(t,n,i,o){return e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},null==n&&(n={}),e.isFunction(n)&&(o=n,i=null,n={}),("number"==typeof n||e.fx.speeds[n])&&(o=i,i=n,n={}),e.isFunction(i)&&(o=i,i=null),n&&e.extend(t,n),i=i||n.duration,t.duration=e.fx.off?0:"number"==typeof i?i:i in e.fx.speeds?e.fx.speeds[i]:e.fx.speeds._default,t.complete=o||n.complete,t}function o(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data(n+t[i],e[0].style[t[i]])},restore:function(e,i){var o,r;for(r=0;r<i.length;r++)null!==i[r]&&(o=e.data(n+i[r]),o===t&&(o=""),e.css(i[r],o))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,i;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":i=0;break;case"center":i=.5;break;case"right":i=1;break;default:i=e[1]/t.width}return{x:i,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},i=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),o={width:t.width(),height:t.height()},r=document.activeElement;try{r.id}catch(s){r=document.body}return t.wrap(i),(t[0]===r||e.contains(t[0],r))&&e(r).focus(),i=t.parent(),"static"===t.css("position")?(i.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,i){n[i]=t.css(i),isNaN(parseInt(n[i],10))&&(n[i]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(o),i.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,i,o){return o=o||{},e.each(n,function(e,n){var r=t.cssUnit(n);r[0]>0&&(o[n]=r[0]*i+r[1])}),o}}),e.fn.extend({effect:function(){function t(t){function i(){e.isFunction(r)&&r.call(o[0]),e.isFunction(t)&&t()}var o=e(this),r=n.complete,a=n.mode;(o.is(":hidden")?"hide"===a:"show"===a)?(o[a](),i()):s.call(o[0],n,i)}var n=i.apply(this,arguments),o=n.mode,r=n.queue,s=e.effects.effect[n.effect];return e.fx.off||!s?o?this[o](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):r===!1?this.each(t):this.queue(r||"fx",t)},show:function(e){return function(t){if(o(t))return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(o(t))return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(o(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var n=this.css(t),i=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(i=[parseFloat(n),t])}),i}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?n(2*e)/2:1-n(-2*e+2)/2}})}()}(jQuery),function(e,t){var n=/up|down|vertical/,i=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,o){var r,s,a,l=e(this),c=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(l,t.mode||"hide"),d=t.direction||"up",h=n.test(d),p=h?"height":"width",f=h?"top":"left",g=i.test(d),m={},v="show"===u;l.parent().is(".ui-effects-wrapper")?e.effects.save(l.parent(),c):e.effects.save(l,c),l.show(),r=e.effects.createWrapper(l).css({overflow:"hidden"}),s=r[p](),a=parseFloat(r.css(f))||0,m[p]=v?s:0,g||(l.css(h?"bottom":"right",0).css(h?"top":"left","auto").css({position:"absolute"}),m[f]=v?a:s+a),v&&(r.css(p,0),g||r.css(f,a+s)),r.animate(m,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&l.hide(),e.effects.restore(l,c),e.effects.removeWrapper(l),o()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,n){var i,o,r,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"effect"),c="hide"===l,u="show"===l,d=t.direction||"up",h=t.distance,p=t.times||5,f=2*p+(u||c?1:0),g=t.duration/f,m=t.easing,v="up"===d||"down"===d?"top":"left",b="up"===d||"left"===d,y=s.queue(),w=y.length;for((u||c)&&a.push("opacity"),e.effects.save(s,a),s.show(),e.effects.createWrapper(s),h||(h=s["top"===v?"outerHeight":"outerWidth"]()/3),u&&(r={opacity:1},r[v]=0,s.css("opacity",0).css(v,b?2*-h:2*h).animate(r,g,m)),c&&(h/=Math.pow(2,p-1)),r={},r[v]=0,i=0;p>i;i++)o={},o[v]=(b?"-=":"+=")+h,s.animate(o,g,m).animate(r,g,m),h=c?2*h:h/2;c&&(o={opacity:0},o[v]=(b?"-=":"+=")+h,s.animate(o,g,m)),s.queue(function(){c&&s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),n()}),w>1&&y.splice.apply(y,[1,0].concat(y.splice(w,f+1))),s.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,n){var i,o,r,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"hide"),c="show"===l,u=t.direction||"vertical",d="vertical"===u,h=d?"height":"width",p=d?"top":"left",f={};e.effects.save(s,a),s.show(),i=e.effects.createWrapper(s).css({overflow:"hidden"}),o="IMG"===s[0].tagName?i:s,r=o[h](),c&&(o.css(h,0),o.css(p,r/2)),f[h]=c?r:0,f[p]=c?0:r/2,o.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){c||s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),n()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,n){var i,o=e(this),r=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(o,t.mode||"hide"),a="show"===s,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",u="up"===l||"left"===l?"pos":"neg",d={opacity:a?1:0};e.effects.save(o,r),o.show(),e.effects.createWrapper(o),i=t.distance||o["top"===c?"outerHeight":"outerWidth"](!0)/2,a&&o.css("opacity",0).css(c,"pos"===u?-i:i),d[c]=(a?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+i,o.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),n()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,n){function i(){y.push(this),y.length===d*h&&o()}function o(){p.css({visibility:"visible"}),e(y).remove(),g||p.hide(),n()}var r,s,a,l,c,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,h=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/h),b=Math.ceil(p.outerHeight()/d),y=[];for(r=0;d>r;r++)for(l=m.top+r*b,u=r-(d-1)/2,s=0;h>s;s++)a=m.left+s*v,c=s-(h-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*v,top:-r*b}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:b,left:a+(g?c*v:0),top:l+(g?u*b:0),opacity:g?0:1}).animate({left:a+(g?0:c*v),top:l+(g?0:u*b),opacity:g?1:0},t.duration||500,t.easing,i)}}(jQuery),function(e,t){e.effects.effect.fade=function(t,n){var i=e(this),o=e.effects.setMode(i,t.mode||"toggle");i.animate({opacity:o},{queue:!1,duration:t.duration,easing:t.easing,complete:n})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,n){var i,o,r=e(this),s=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(r,t.mode||"hide"),l="show"===a,c="hide"===a,u=t.size||15,d=/([0-9]+)%/.exec(u),h=!!t.horizFirst,p=l!==h,f=p?["width","height"]:["height","width"],g=t.duration/2,m={},v={};e.effects.save(r,s),r.show(),i=e.effects.createWrapper(r).css({overflow:"hidden"}),o=p?[i.width(),i.height()]:[i.height(),i.width()],d&&(u=parseInt(d[1],10)/100*o[c?0:1]),l&&i.css(h?{height:0,width:u}:{height:u,width:0}),m[f[0]]=l?o[0]:u,v[f[1]]=l?o[1]:0,i.animate(m,g,t.easing).animate(v,g,t.easing,function(){c&&r.hide(),e.effects.restore(r,s),e.effects.removeWrapper(r),n()})}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,n){var i=e(this),o=["backgroundImage","backgroundColor","opacity"],r=e.effects.setMode(i,t.mode||"show"),s={backgroundColor:i.css("backgroundColor")};"hide"===r&&(s.opacity=0),e.effects.save(i,o),i.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===r&&i.hide(),e.effects.restore(i,o),n()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,n){var i,o=e(this),r=e.effects.setMode(o,t.mode||"show"),s="show"===r,a="hide"===r,l=s||"hide"===r,c=2*(t.times||5)+(l?1:0),u=t.duration/c,d=0,h=o.queue(),p=h.length;for((s||!o.is(":visible"))&&(o.css("opacity",0).show(),d=1),i=1;c>i;i++)o.animate({opacity:d},u,t.easing),d=1-d;o.animate({opacity:d},u,t.easing),o.queue(function(){a&&o.hide(),n()}),p>1&&h.splice.apply(h,[1,0].concat(h.splice(p,c+1))),o.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,n){var i=e(this),o=e.effects.setMode(i,t.mode||"hide"),r="hide"===o,s=parseInt(t.percent,10)||150,a=s/100,l={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:o,complete:n,percent:r?s:100,from:r?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),i.effect(t)},e.effects.effect.scale=function(t,n){var i=e(this),o=e.extend(!0,{},t),r=e.effects.setMode(i,t.mode||"effect"),s=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===r?0:100),a=t.direction||"both",l=t.origin,c={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()},u={y:"horizontal"!==a?s/100:1,x:"vertical"!==a?s/100:1};o.effect="size",o.queue=!1,o.complete=n,"effect"!==r&&(o.origin=l||["middle","center"],o.restore=!0),o.from=t.from||("show"===r?{height:0,width:0,outerHeight:0,outerWidth:0}:c),o.to={height:c.height*u.y,width:c.width*u.x,outerHeight:c.outerHeight*u.y,outerWidth:c.outerWidth*u.x},o.fade&&("show"===r&&(o.from.opacity=0,o.to.opacity=1),"hide"===r&&(o.from.opacity=1,o.to.opacity=0)),i.effect(o)},e.effects.effect.size=function(t,n){var i,o,r,s=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],c=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(s,t.mode||"effect"),f=t.restore||"effect"!==p,g=t.scale||"both",m=t.origin||["middle","center"],v=s.css("position"),b=f?a:l,y={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&s.show(),i={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===t.mode&&"show"===p?(s.from=t.to||y,s.to=t.from||i):(s.from=t.from||("show"===p?y:i),s.to=t.to||("hide"===p?y:i)),r={from:{y:s.from.height/i.height,x:s.from.width/i.width},to:{y:s.to.height/i.height,x:s.to.width/i.width}},("box"===g||"both"===g)&&(r.from.y!==r.to.y&&(b=b.concat(d),s.from=e.effects.setTransition(s,d,r.from.y,s.from),s.to=e.effects.setTransition(s,d,r.to.y,s.to)),r.from.x!==r.to.x&&(b=b.concat(h),s.from=e.effects.setTransition(s,h,r.from.x,s.from),s.to=e.effects.setTransition(s,h,r.to.x,s.to))),("content"===g||"both"===g)&&r.from.y!==r.to.y&&(b=b.concat(u).concat(c),s.from=e.effects.setTransition(s,u,r.from.y,s.from),s.to=e.effects.setTransition(s,u,r.to.y,s.to)),e.effects.save(s,b),s.show(),e.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),m&&(o=e.effects.getBaseline(m,i),s.from.top=(i.outerHeight-s.outerHeight())*o.y,s.from.left=(i.outerWidth-s.outerWidth())*o.x,s.to.top=(i.outerHeight-s.to.outerHeight)*o.y,s.to.left=(i.outerWidth-s.to.outerWidth)*o.x),s.css(s.from),("content"===g||"both"===g)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),h=h.concat(["marginLeft","marginRight"]),c=a.concat(d).concat(h),s.find("*[width]").each(function(){var n=e(this),i={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};f&&e.effects.save(n,c),n.from={height:i.height*r.from.y,width:i.width*r.from.x,outerHeight:i.outerHeight*r.from.y,outerWidth:i.outerWidth*r.from.x},n.to={height:i.height*r.to.y,width:i.width*r.to.x,outerHeight:i.height*r.to.y,outerWidth:i.width*r.to.x},r.from.y!==r.to.y&&(n.from=e.effects.setTransition(n,d,r.from.y,n.from),n.to=e.effects.setTransition(n,d,r.to.y,n.to)),r.from.x!==r.to.x&&(n.from=e.effects.setTransition(n,h,r.from.x,n.from),n.to=e.effects.setTransition(n,h,r.to.x,n.to)),n.css(n.from),n.animate(n.to,t.duration,t.easing,function(){f&&e.effects.restore(n,c)})})),s.animate(s.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===p&&s.hide(),e.effects.restore(s,b),f||("static"===v?s.css({position:"relative",top:s.to.top,left:s.to.left}):e.each(["top","left"],function(e,t){s.css(t,function(t,n){var i=parseInt(n,10),o=e?s.to.left:s.to.top;return"auto"===n?o+"px":i+o+"px"})})),e.effects.removeWrapper(s),n()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,n){var i,o=e(this),r=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(o,t.mode||"effect"),a=t.direction||"left",l=t.distance||20,c=t.times||3,u=2*c+1,d=Math.round(t.duration/u),h="up"===a||"down"===a?"top":"left",p="up"===a||"left"===a,f={},g={},m={},v=o.queue(),b=v.length;for(e.effects.save(o,r),o.show(),e.effects.createWrapper(o),f[h]=(p?"-=":"+=")+l,g[h]=(p?"+=":"-=")+2*l,m[h]=(p?"-=":"+=")+2*l,o.animate(f,d,t.easing),i=1;c>i;i++)o.animate(g,d,t.easing).animate(m,d,t.easing);o.animate(g,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===s&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),n()}),b>1&&v.splice.apply(v,[1,0].concat(v.splice(b,u+1))),o.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,n){var i,o=e(this),r=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(o,t.mode||"show"),a="show"===s,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",u="up"===l||"left"===l,d={};e.effects.save(o,r),o.show(),i=t.distance||o["top"===c?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(o).css({overflow:"hidden"}),a&&o.css(c,u?isNaN(i)?"-"+i:-i:i),d[c]=(a?u?"+=":"-=":u?"-=":"+=")+i,o.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),n()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,n){var i=e(this),o=e(t.to),r="fixed"===o.css("position"),s=e("body"),a=r?s.scrollTop():0,l=r?s.scrollLeft():0,c=o.offset(),u={top:c.top-a,left:c.left-l,height:o.innerHeight(),width:o.innerWidth()},d=i.offset(),h=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-a,left:d.left-l,height:i.innerHeight(),width:i.innerWidth(),position:r?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){h.remove(),n()})}}(jQuery),function(e,t){e.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var n=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),n.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{
click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,o,r,s,a,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,o=this.previousFilter||"",r=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),r===o?s=!0:r=o+r,a=new RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())}),i=s&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(t.keyCode),a=new RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())})),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,i=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),i.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev("a"),o=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(o),t.attr("aria-labelledby",i.attr("id"))}),t=i.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var n,i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&e&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,i,o,r,s,a;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,o=t.offset().top-this.activeMenu.offset().top-n-i,r=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.height(),0>o?this.activeMenu.scrollTop(r+o):o+a>s&&this.activeMenu.scrollTop(r+o-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(t),this.activeMenu=i},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(n,i)},nextPage:function(t){var n,i,o;return this.active?void(this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i-o<0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var n,i,o;return this.active?void(this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i+o>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return e===t?this.options.value:(this.options.value=this._constrainedValue(e),void this._refreshValue())},_constrainedValue:function(e){return e===t&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,n=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(n.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e,t){function n(e){return parseInt(e,10)||0}function i(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,i,o,r,s=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;n<t.length;n++)i=e.trim(t[n]),r="ui-resizable-"+i,o=e("<div class='ui-resizable-handle "+r+"'></div>"),o.css({zIndex:a.zIndex}),"se"===i&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(o);this._renderAxis=function(t){var n,i,o,r;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(i=e(this.handles[n],this.element),r=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),o=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(o,r),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,i,o=!1;for(n in this.handles)i=e(this.handles[n])[0],(i===t.target||e.contains(i,t.target))&&(o=!0);return!this.options.disabled&&o},_mouseStart:function(t){var i,o,r,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),i=n(this.helper.css("left")),o=n(this.helper.css("top")),s.containment&&(i+=e(s.containment).scrollLeft()||0,o+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:o},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:i,top:o},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),l.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,i=this.helper,o={},r=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,c=this.size.width,u=this.size.height,d=t.pageX-r.left||0,h=t.pageY-r.top||0,p=this._change[s];return p?(n=p.apply(this,[t,d,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==a&&(o.top=this.position.top+"px"),this.position.left!==l&&(o.left=this.position.left+"px"),this.size.width!==c&&(o.width=this.size.width+"px"),this.size.height!==u&&(o.height=this.size.height+"px"),i.css(o),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(o)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,i,o,r,s,a,l,c=this.options,u=this;return this._helper&&(n=this._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),o=i&&e.ui.hasScroll(n[0],"left")?0:u.sizeDiff.height,r=i?0:u.sizeDiff.width,s={width:u.helper.width()-r,height:u.helper.height()-o},a=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,l=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,c.animate||this.element.css(e.extend(s,{top:l,left:a})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,o,r,s,a=this.options;s={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:1/0,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,o=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),o>s.minHeight&&(s.minHeight=o),n<s.maxWidth&&(s.maxWidth=n),r<s.maxHeight&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,o=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===o&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===o&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,o=i(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=i(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=i(e.width)&&t.minWidth&&t.minWidth>e.width,a=i(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,u=/sw|nw|w/.test(n),d=/nw|ne|n/.test(n);return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),o&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),s&&u&&(e.left=l-t.minWidth),o&&u&&(e.left=l-t.maxWidth),a&&d&&(e.top=c-t.minHeight),r&&d&&(e.top=c-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,i,o,r=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(o=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[o.css("borderTopWidth"),o.css("borderRightWidth"),o.css("borderBottomWidth"),o.css("borderLeftWidth")],i=[o.css("paddingTop"),o.css("paddingRight"),o.css("paddingBottom"),o.css("paddingLeft")],t=0;t<n.length;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(i[t],10)||0);o.css({height:r.height()-this.borderDif[0]-this.borderDif[2]||0,width:r.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,i=this.originalPosition;return{left:i.left+t,width:n.width-t}},n:function(e,t,n){var i=this.originalSize,o=this.originalPosition;return{top:o.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},sw:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,i]))},ne:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},nw:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,i]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),i=n.options,o=n._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),s=r&&e.ui.hasScroll(o[0],"left")?0:n.sizeDiff.height,a=r?0:n.sizeDiff.width,l={width:n.size.width-a,height:n.size.height-s},c=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,u=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(l,u&&c?{top:u,left:c}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};o&&o.length&&e(o[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,o,r,s,a,l,c=e(this).data("ui-resizable"),u=c.options,d=c.element,h=u.containment,p=h instanceof e?h.get(0):/parent/.test(h)?d.parent().get(0):h;p&&(c.containerElement=e(p),/document/.test(h)||h===document?(c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,o){i[e]=n(t.css("padding"+o))}),c.containerOffset=t.offset(),c.containerPosition=t.position(),c.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},o=c.containerOffset,r=c.containerSize.height,s=c.containerSize.width,a=e.ui.hasScroll(p,"left")?p.scrollWidth:s,l=e.ui.hasScroll(p)?p.scrollHeight:r,c.parentData={element:p,left:o.left,top:o.top,width:a,height:l}))},resize:function(t){var n,i,o,r,s=e(this).data("ui-resizable"),a=s.options,l=s.containerOffset,c=s.position,u=s._aspectRatio||t.shiftKey,d={top:0,left:0},h=s.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(d=l),c.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-d.left),u&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),c.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),u&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,n=Math.abs((s._helper?s.offset.left-d.left:s.offset.left-d.left)+s.sizeDiff.width),i=Math.abs((s._helper?s.offset.top-d.top:s.offset.top-l.top)+s.sizeDiff.height),o=s.containerElement.get(0)===s.element.parent().get(0),r=/relative|absolute/.test(s.containerElement.css("position")),o&&r&&(n-=Math.abs(s.parentData.left)),n+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-n,u&&(s.size.height=s.size.width/s.aspectRatio)),i+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-i,u&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.containerOffset,o=t.containerPosition,r=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,c=s.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(r.css("position"))&&e(this).css({left:a.left-o.left-i.left,width:l,height:c}),t._helper&&!n.animate&&/static/.test(r.css("position"))&&e(this).css({left:a.left-o.left-i.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,i=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?i(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],i(n.alsoResize)):e.each(n.alsoResize,function(e){i(e)})},resize:function(t,n){var i=e(this).data("ui-resizable"),o=i.options,r=i.originalSize,s=i.originalPosition,a={height:i.size.height-r.height||0,width:i.size.width-r.width||0,top:i.position.top-s.top||0,left:i.position.left-s.left||0},l=function(t,i){e(t).each(function(){var t=e(this),o=e(this).data("ui-resizable-alsoresize"),r={},s=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var n=(o[t]||0)+(a[t]||0);n&&n>=0&&(r[t]=n||null)}),t.css(r)})};"object"!=typeof o.alsoResize||o.alsoResize.nodeType?l(o.alsoResize):e.each(o.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.size,o=t.originalSize,r=t.originalPosition,s=t.axis,a="number"==typeof n.grid?[n.grid,n.grid]:n.grid,l=a[0]||1,c=a[1]||1,u=Math.round((i.width-o.width)/l)*l,d=Math.round((i.height-o.height)/c)*c,h=o.width+u,p=o.height+d,f=n.maxWidth&&n.maxWidth<h,g=n.maxHeight&&n.maxHeight<p,m=n.minWidth&&n.minWidth>h,v=n.minHeight&&n.minHeight>p;n.grid=a,m&&(h+=l),v&&(p+=c),f&&(h-=l),g&&(p-=c),/^(se|s|e)$/.test(s)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(s)?(t.size.width=h,t.size.height=p,t.position.top=r.top-d):/^(sw)$/.test(s)?(t.size.width=h,t.size.height=p,t.position.left=r.left-u):(p-c>0?(t.size.height=p,t.position.top=r.top-d):(t.size.height=c,t.position.top=r.top+o.height-c),h-l>0?(t.size.width=h,t.position.left=r.left-u):(t.size.width=l,t.position.left=r.left+o.width-l))}})}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,n=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(n.options.filter,n.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var n=this,i=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(i.filter,this.element[0]),this._trigger("start",t),e(i.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=e.data(this,"selectable-item");i.startselected=!0,t.metaKey||t.ctrlKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",t,{unselecting:i.element}))}),e(t.target).parents().addBack().each(function(){var i,o=e.data(this,"selectable-item");return o?(i=!t.metaKey&&!t.ctrlKey||!o.$element.hasClass("ui-selected"),o.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),o.unselecting=!i,o.selecting=i,o.selected=i,i?n._trigger("selecting",t,{selecting:o.element}):n._trigger("unselecting",t,{unselecting:o.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var n,i=this,o=this.options,r=this.opos[0],s=this.opos[1],a=t.pageX,l=t.pageY;return r>a&&(n=a,a=r,r=n),s>l&&(n=l,l=s,s=n),this.helper.css({left:r,top:s,width:a-r,height:l-s}),this.selectees.each(function(){var n=e.data(this,"selectable-item"),c=!1;n&&n.element!==i.element[0]&&("touch"===o.tolerance?c=!(n.left>a||n.right<r||n.top>l||n.bottom<s):"fit"===o.tolerance&&(c=n.left>r&&n.right<a&&n.top>s&&n.bottom<l),c?(n.selected&&(n.$element.removeClass("ui-selected"),n.selected=!1),n.unselecting&&(n.$element.removeClass("ui-unselecting"),n.unselecting=!1),n.selecting||(n.$element.addClass("ui-selecting"),n.selecting=!0,i._trigger("selecting",t,{selecting:n.element}))):(n.selecting&&((t.metaKey||t.ctrlKey)&&n.startselected?(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.$element.addClass("ui-selected"),n.selected=!0):(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.startselected&&(n.$element.addClass("ui-unselecting"),n.unselecting=!0),i._trigger("unselecting",t,{unselecting:n.element}))),n.selected&&(t.metaKey||t.ctrlKey||n.startselected||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element})))))}),!1}},_mouseStop:function(t){var n=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var i=e.data(this,"selectable-item");i.$element.removeClass("ui-unselecting"),i.unselecting=!1,i.startselected=!1,n._trigger("unselected",t,{unselected:i.element})}),e(".ui-selecting",this.element[0]).each(function(){var i=e.data(this,"selectable-item");i.$element.removeClass("ui-selecting").addClass("ui-selected"),i.selecting=!1,i.selected=!0,i.startselected=!0,n._trigger("selected",t,{selected:i.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,i=this.options,o=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(n=i.values&&i.values.length||1,o.length>n&&(o.slice(n).remove(),o=o.slice(0,n)),t=o.length;n>t;t++)s.push(r);this.handles=o.add(e(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),
this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(n+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,i,o,r,s,a,l,c,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(n),o=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(i-u.values(t));(o>n||o===n&&(t===u._lastChangedValue||u.values(t)===d.min))&&(o=n,r=e(this),s=t)}),a=this._start(t,s),a===!1?!1:(this._mouseSliding=!0,this._handleIndex=s,r.addClass("ui-state-active").focus(),l=r.offset(),c=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,i,o,r;return"horizontal"===this.orientation?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),i=n/t,i>1&&(i=1),0>i&&(i=0),"vertical"===this.orientation&&(i=1-i),o=this._valueMax()-this._valueMin(),r=this._valueMin()+i*o,this._trimAlignValue(r)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var i,o,r;this.options.values&&this.options.values.length?(i=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&n>i||1===t&&i>n)&&(n=i),n!==this.values(t)&&(o=this.values(),o[t]=n,r=this._trigger("slide",e,{handle:this.handles[t],value:n,values:o}),i=this.values(t?0:1),r!==!1&&this.values(t,n))):n!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:n}),r!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,n){var i,o,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(i=this.options.values,o=arguments[0],r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(o[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,n){var i,o=0;switch("range"===t&&this.options.range===!0&&("min"===n?(this.options.value=this._values(0),this.options.values=null):"max"===n&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(o=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;o>i;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n,i;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(n=this.options.values.slice(),i=0;i<n.length;i+=1)n[i]=this._trimAlignValue(n[i]);return n}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,i=e-n;return 2*Math.abs(n)>=t&&(i+=n>0?t:-t),parseFloat(i.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,i,o,r,s=this.options.range,a=this.options,l=this,c=this._animateOff?!1:a.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(i){n=(l.values(i)-l._valueMin())/(l._valueMax()-l._valueMin())*100,u["horizontal"===l.orientation?"left":"bottom"]=n+"%",e(this).stop(1,1)[c?"animate":"css"](u,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===i&&l.range.stop(1,1)[c?"animate":"css"]({left:n+"%"},a.animate),1===i&&l.range[c?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:a.animate})):(0===i&&l.range.stop(1,1)[c?"animate":"css"]({bottom:n+"%"},a.animate),1===i&&l.range[c?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:a.animate}))),t=n}):(i=this.value(),o=this._valueMin(),r=this._valueMax(),n=r!==o?(i-o)/(r-o)*100:0,u["horizontal"===this.orientation?"left":"bottom"]=n+"%",this.handle.stop(1,1)[c?"animate":"css"](u,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:n+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:n+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(t){var i,o,r,s,a=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,a),i===!1))return}switch(s=this.options.step,o=r=this.options.values&&this.options.values.length?this.values(a):this.value(),t.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(o+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(o-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===this._valueMax())return;r=this._trimAlignValue(o+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===this._valueMin())return;r=this._trimAlignValue(o-s)}this._slide(t,a,r)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&t+n>e}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var i=null,o=!1,r=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,r.widgetName+"-item")===r?(i=e(this),!1):void 0}),e.data(t.target,r.widgetName+"-item")===r&&(i=e(t.target)),i&&(!this.options.handle||n||(e(this.options.handle,i).find("*").addBack().each(function(){this===t.target&&(o=!0)}),o))?(this.currentItem=i,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(t,n,i){var o,r,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(r=this.document.find("body"),this.storedCursor=r.css("cursor"),r.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(r)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,i,o,r,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(i=this.items[n],o=i.item[0],r=this._intersectsWithPointer(i),r&&i.instance===this.currentContainer&&o!==this.currentItem[0]&&this.placeholder[1===r?"next":"prev"]()[0]!==o&&!e.contains(this.placeholder[0],o)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],o):!0)){if(this.direction=1===r?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(t,i),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var i=this,o=this.placeholder.offset(),r=this.options.axis,s={};r&&"x"!==r||(s.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),r&&"y"!==r||(s.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&i.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},n.each(function(){i.push(e(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,i=this.positionAbs.top,o=i+this.helperProportions.height,r=e.left,s=r+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||i+c>a&&l>i+c,h="y"===this.options.axis||t+u>r&&s>t+u,p=d&&h;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:r<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<s&&a<i+this.helperProportions.height/2&&o-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||n(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||n(this.positionAbs.left+this.offset.click.left,e.left,e.width),o=t&&i,r=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return o?this.floating?s&&"right"===s||"down"===r?2:1:r&&("down"===r?2:1):!1},_intersectsWithSides:function(e){var t=n(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=n(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&i||"left"===r&&!i:o&&("down"===o&&t||"up"===o&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function n(){a.push(this)}var i,o,r,s,a=[],l=[],c=this._connectWith();if(c&&t)for(i=c.length-1;i>=0;i--)for(r=e(c[i]),o=r.length-1;o>=0;o--)s=e.data(r[o],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=l.length-1;i>=0;i--)l[i][0].each(n);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,i,o,r,s,a,l,c,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(o=e(h[n]),i=o.length-1;i>=0;i--)r=e.data(o[i],this.widgetFullName),r&&r!==this&&!r.options.disabled&&(d.push([e.isFunction(r.options.items)?r.options.items.call(r.element[0],t,{item:this.currentItem}):e(r.options.items,r.element),r]),this.containers.push(r));for(n=d.length-1;n>=0;n--)for(s=d[n][1],a=d[n][0],i=0,c=a.length;c>i;i++)l=e(a[i]),l.data(this.widgetName+"-item",s),u.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,i,o,r;for(n=this.items.length-1;n>=0;n--)i=this.items[n],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?e(this.options.toleranceElement,i.item):i.item,t||(i.width=o.outerWidth(),i.height=o.outerHeight()),r=o.offset(),i.left=r.left,i.top=r.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)r=this.containers[n].element.offset(),this.containers[n].containerCache.left=r.left,this.containers[n].containerCache.top=r.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,i=t.options;i.placeholder&&i.placeholder.constructor!==String||(n=i.placeholder,i.placeholder={element:function(){var i=t.currentItem[0].nodeName.toLowerCase(),o=e("<"+i+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===i?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(o)}):"img"===i&&o.attr("src",t.currentItem.attr("src")),n||o.css("visibility","hidden"),o},update:function(e,o){(!n||i.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var o,r,s,a,l,c,u,d,h,p,f=null,g=null;for(o=this.containers.length-1;o>=0;o--)if(!e.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(f&&e.contains(this.containers[o].element[0],f.element[0]))continue;f=this.containers[o],g=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",t,this._uiHash(this)),this.containers[o].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",t,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(s=1e4,a=null,p=f.floating||i(this.currentItem),l=p?"left":"top",c=p?"width":"height",u=this.positionAbs[l]+this.offset.click[l],r=this.items.length-1;r>=0;r--)e.contains(this.containers[g].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(!p||n(this.positionAbs.top+this.offset.click.top,this.items[r].top,this.items[r].height))&&(d=this.items[r].item.offset()[l],h=!1,Math.abs(d-u)>Math.abs(d+this.items[r][c]-u)&&(h=!0,d+=this.items[r][c]),Math.abs(d-u)<s&&(s=Math.abs(d-u),a=this.items[r],this.direction=h?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[g].element,!0),this._trigger("change",t,this._uiHash()),this.containers[g]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",t,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!i[0].style.width||n.forceHelperSize)&&i.width(this.currentItem.width()),(!i[0].style.height||n.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(t=e(o.containment)[0],n=e(o.containment).offset(),i="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(i?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(i?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(o[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:o.scrollTop())*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:o.scrollLeft())*i}},_generatePosition:function(t){var n,i,o=this.options,r=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),o.grid&&(n=this.originalPageY+Math.round((s-this.originalPageY)/o.grid[1])*o.grid[1],s=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-o.grid[1]:n+o.grid[1]:n,i=this.originalPageX+Math.round((r-this.originalPageX)/o.grid[0])*o.grid[0],r=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-o.grid[0]:i+o.grid[0]:i)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,n,i){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!i)})},_clear:function(e,t){function n(e,t,n){return function(i){n._trigger(e,i,t._uiHash(t))}}this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&o.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(o.push(function(e){this._trigger("remove",e,this._uiHash())}),o.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||o.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),
this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},n=this.element;return e.each(["min","max","step"],function(e,i){var o=n.attr(i);void 0!==o&&o.length&&(t[i]=o)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",e)))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function n(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}var i;i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),n.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,n.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var n=this.options,i=e.ui.keyCode;switch(t.keyCode){case i.UP:return this._repeat(null,1,t),!0;case i.DOWN:return this._repeat(null,-1,t),!0;case i.PAGE_UP:return this._repeat(null,n.page,t),!0;case i.PAGE_DOWN:return this._repeat(null,-n.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,n){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,n)},e),this._spin(t*this.options.step,n)},_spin:function(e,t){var n=this.value()||0;this.counter||(this.counter=1),n=this._adjustValue(n+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:n})===!1||(this._value(n),this.counter++)},_increment:function(t){var n=this.options.incremental;return n?e.isFunction(n)?n(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),n=t.indexOf(".");return-1===n?0:t.length-n-1},_adjustValue:function(e){var t,n,i=this.options;return t=null!==i.min?i.min:0,n=e-t,n=Math.round(n/i.step)*i.step,e=t+n,e=parseFloat(e.toFixed(this._precision())),null!==i.max&&e>i.max?i.max:null!==i.min&&e<i.min?i.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var n=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(n))}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var n;""!==e&&(n=this._parse(e),null!==n&&(t||(n=this._adjustValue(n)),e=this._format(n))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?void t(this._value).call(this,e):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){function n(){return++o}function i(e){return e=e.cloneNode(!1),e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}var o=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(n.active):e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var t=this.options.active,n=this.options.collapsible,i=location.hash.substring(1);return null===t&&(i&&this.tabs.each(function(n,o){return e(o).attr("aria-controls")===i?(t=n,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=n?!1:0)),!n&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),i=this.tabs.index(n),o=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:i++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:o=!1,i--;break;case e.ui.keyCode.END:i=this.anchors.length-1;break;case e.ui.keyCode.HOME:i=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(i);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(i===this.options.active?!1:i);default:return}t.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,o),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,n){function i(){return t>o&&(t=0),0>t&&(t=o),t}for(var o=this.tabs.length-1;-1!==e.inArray(i(),this.options.disabled);)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,o){var r,s,a,l=e(o).uniqueId().attr("id"),c=e(o).closest("li"),u=c.attr("aria-controls");i(o)?(r=o.hash,s=t.element.find(t._sanitizeSelector(r))):(a=t._tabId(c),r="#"+a,s=t.element.find(r),s.length||(s=t._createPanel(a),s.insertAfter(t.panels[n-1]||t.tablist)),s.attr("aria-live","polite")),s.length&&(t.panels=t.panels.add(s)),u&&c.data("ui-tabs-aria-controls",u),c.attr({"aria-controls":r.substring(1),"aria-labelledby":l}),s.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n,i=0;n=this.tabs[i];i++)t===!0||-1!==e.inArray(i,t)?e(n).addClass("ui-state-disabled").attr("aria-disabled","true"):e(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,i=this.element.parent();"fill"===t?(n=i.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),i=t.css("position");"absolute"!==i&&"fixed"!==i&&(n-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,i=this.active,o=e(t.currentTarget),r=o.closest("li"),s=r[0]===i[0],a=s&&n.collapsible,l=a?e():this._getPanelForTab(r),c=i.length?this._getPanelForTab(i):e(),u={oldTab:i,oldPanel:c,newTab:a?e():r,newPanel:l};t.preventDefault(),r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||s&&!n.collapsible||this._trigger("beforeActivate",t,u)===!1||(n.active=a?!1:this.tabs.index(r),this.active=s?e():r,this.xhr&&this.xhr.abort(),c.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(r),t),this._toggle(t,u))},_toggle:function(t,n){function i(){r.running=!1,r._trigger("activate",t,n)}function o(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&r.options.show?r._show(s,r.options.show,i):(s.show(),i())}var r=this,s=n.newPanel,a=n.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),o()),a.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),s.length&&a.length?n.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,i=this._findActive(t);i[0]!==this.active[0]&&(i.length||(i=this.active),n=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(n){var i=this.options.disabled;i!==!1&&(n===t?i=!1:(n=this._getIndex(n),i=e.isArray(i)?e.map(i,function(e){return e!==n?e:null}):e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(i))},disable:function(n){var i=this.options.disabled;if(i!==!0){if(n===t)i=!0;else{if(n=this._getIndex(n),-1!==e.inArray(n,i))return;i=e.isArray(i)?e.merge([n],i).sort():[n]}this._setupDisabled(i)}},load:function(t,n){t=this._getIndex(t);var o=this,r=this.tabs.eq(t),s=r.find(".ui-tabs-anchor"),a=this._getPanelForTab(r),l={tab:r,panel:a};i(s[0])||(this.xhr=e.ajax(this._ajaxSettings(s,n,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(r.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){a.html(e),o._trigger("load",n,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&o.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===o.xhr&&delete o.xhr},1)})))},_ajaxSettings:function(t,n,i){var o=this;return{url:t.attr("href"),beforeSend:function(t,r){return o._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:r},i))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(jQuery),function(e){function t(t,n){var i=(t.attr("aria-describedby")||"").split(/\s+/);i.push(n),t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(i.join(" ")))}function n(t){var n=t.data("ui-tooltip-id"),i=(t.attr("aria-describedby")||"").split(/\s+/),o=e.inArray(n,i);-1!==o&&i.splice(o,1),t.removeData("ui-tooltip-id"),i=e.trim(i.join(" ")),i?t.attr("aria-describedby",i):t.removeAttr("aria-describedby")}var i=0;e.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,n){var i=this;return"disabled"===t?(this[n?"_disable":"_enable"](),void(this.options[t]=n)):(this._super(t,n),void("content"===t&&e.each(this.tooltips,function(e,t){i._updateContent(t)})))},_disable:function(){var t=this;e.each(this.tooltips,function(n,i){var o=e.Event("blur");o.target=o.currentTarget=i[0],t.close(o,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var n=this,i=e(t?t.target:this.element).closest(this.options.items);i.length&&!i.data("ui-tooltip-id")&&(i.attr("title")&&i.data("ui-tooltip-title",i.attr("title")),i.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&i.parents().each(function(){var t,i=e(this);i.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,n.close(t,!0)),i.attr("title")&&(i.uniqueId(),n.parents[this.id]={element:this,title:i.attr("title")},i.attr("title",""))}),this._updateContent(i,t))},_updateContent:function(e,t){var n,i=this.options.content,o=this,r=t?t.type:null;return"string"==typeof i?this._open(t,e,i):(n=i.call(e[0],function(n){e.data("ui-tooltip-open")&&o._delay(function(){t&&(t.type=r),this._open(t,e,n)})}),void(n&&this._open(t,e,n)))},_open:function(n,i,o){function r(e){c.of=e,s.is(":hidden")||s.position(c)}var s,a,l,c=e.extend({},this.options.position);if(o){if(s=this._find(i),s.length)return void s.find(".ui-tooltip-content").html(o);i.is("[title]")&&(n&&"mouseover"===n.type?i.attr("title",""):i.removeAttr("title")),s=this._tooltip(i),t(i,s.attr("id")),s.find(".ui-tooltip-content").html(o),this.options.track&&n&&/^mouse/.test(n.type)?(this._on(this.document,{mousemove:r}),r(n)):s.position(e.extend({of:i},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){s.is(":visible")&&(r(c.of),clearInterval(l))},e.fx.interval)),this._trigger("open",n,{tooltip:s}),a={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=i[0],this.close(n,!0)}},remove:function(){this._removeTooltip(s)}},n&&"mouseover"!==n.type||(a.mouseleave="close"),n&&"focusin"!==n.type||(a.focusout="close"),this._on(!0,i,a)}},close:function(t){var i=this,o=e(t?t.currentTarget:this.element),r=this._find(o);this.closing||(clearInterval(this.delayedShow),o.data("ui-tooltip-title")&&o.attr("title",o.data("ui-tooltip-title")),n(o),r.stop(!0),this._hide(r,this.options.hide,function(){i._removeTooltip(e(this))}),o.removeData("ui-tooltip-open"),this._off(o,"mouseleave focusout keyup"),o[0]!==this.element[0]&&this._off(o,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,n){e(n.element).attr("title",n.title),delete i.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:r}),this.closing=!1)},_tooltip:function(t){var n="ui-tooltip-"+i++,o=e("<div>").attr({id:n,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(o),o.appendTo(this.document[0].body),this.tooltips[n]=t,o},_find:function(t){var n=t.data("ui-tooltip-id");return n?e("#"+n):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(n,i){var o=e.Event("blur");o.target=o.currentTarget=i[0],t.close(o,!0),e("#"+n).remove(),i.data("ui-tooltip-title")&&(i.attr("title",i.data("ui-tooltip-title")),i.removeData("ui-tooltip-title"))})}})}(jQuery),function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,o=i._mouseInit,r=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)}}}(jQuery),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one("bsTransitionEnd",function(){n=!0});var o=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(o,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var n=e(this),o=n.data("bs.alert");o||n.data("bs.alert",o=new i(this)),"string"==typeof t&&o[t].call(n)})}var n='[data-dismiss="alert"]',i=function(t){e(t).on("click",n,this.close)};i.VERSION="3.2.0",i.prototype.close=function(t){function n(){r.detach().trigger("closed.bs.alert").remove()}var i=e(this),o=i.attr("data-target");o||(o=i.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var r=e(o);t&&t.preventDefault(),r.length||(r=i.hasClass("alert")?i:i.parent()),r.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(r.removeClass("in"),e.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",n).emulateTransitionEnd(150):n())};var o=e.fn.alert;e.fn.alert=t,e.fn.alert.Constructor=i,e.fn.alert.noConflict=function(){return e.fn.alert=o,this},e(document).on("click.bs.alert.data-api",n,i.prototype.close)}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.button"),r="object"==typeof t&&t;o||i.data("bs.button",o=new n(this,r)),"toggle"==t?o.toggle():t&&o.setState(t)})}var n=function(t,i){this.$element=e(t),this.options=e.extend({},n.DEFAULTS,i),this.isLoading=!1};n.VERSION="3.2.0",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var n="disabled",i=this.$element,o=i.is("input")?"val":"html",r=i.data();t+="Text",null==r.resetText&&i.data("resetText",i[o]()),i[o](null==r[t]?this.options[t]:r[t]),setTimeout(e.proxy(function(){"loadingText"==t?(this.isLoading=!0,i.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,i.removeClass(n).removeAttr(n))},this),0)},n.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}e&&this.$element.toggleClass("active")};var i=e.fn.button;e.fn.button=t,e.fn.button.Constructor=n,e.fn.button.noConflict=function(){return e.fn.button=i,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(n){var i=e(n.target);i.hasClass("btn")||(i=i.closest(".btn")),t.call(i,"toggle"),n.preventDefault()})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.carousel"),r=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t),s="string"==typeof t?t:r.slide;o||i.data("bs.carousel",o=new n(this,r)),"number"==typeof t?o.to(t):s?o[s]():r.interval&&o.pause().cycle()})}var n=function(t,n){this.$element=e(t).on("keydown.bs.carousel",e.proxy(this.keydown,this)),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.2.0",n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},n.prototype.keydown=function(e){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.to=function(t){var n=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(this.$items[t]))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){return this.sliding?void 0:this.slide("next")},n.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},n.prototype.slide=function(t,n){var i=this.$element.find(".item.active"),o=n||i[t](),r=this.interval,s="next"==t?"left":"right",a="next"==t?"first":"last",l=this;if(!o.length){if(!this.options.wrap)return;o=this.$element.find(".item")[a]()}if(o.hasClass("active"))return this.sliding=!1;var c=o[0],u=e.Event("slide.bs.carousel",{relatedTarget:c,direction:s});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var d=e(this.$indicators.children()[this.getItemIndex(o)]);d&&d.addClass("active")}var h=e.Event("slid.bs.carousel",{relatedTarget:c,direction:s});return e.support.transition&&this.$element.hasClass("slide")?(o.addClass(t),o[0].offsetWidth,i.addClass(s),o.addClass(s),i.one("bsTransitionEnd",function(){o.removeClass([t,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(h)},0)}).emulateTransitionEnd(1e3*i.css("transition-duration").slice(0,-1))):(i.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(h)),r&&this.cycle(),this}};var i=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=i,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(n){var i,o=e(this),r=e(o.attr("data-target")||(i=o.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""));if(r.hasClass("carousel")){var s=e.extend({},r.data(),o.data()),a=o.attr("data-slide-to");a&&(s.interval=!1),t.call(r,s),a&&r.data("bs.carousel").to(a),n.preventDefault()}}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.collapse"),r=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);!o&&r.toggle&&"show"==t&&(t=!t),o||i.data("bs.collapse",o=new n(this,r)),"string"==typeof t&&o[t]()})}var n=function(t,i){
this.$element=e(t),this.options=e.extend({},n.DEFAULTS,i),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};n.VERSION="3.2.0",n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var n=e.Event("show.bs.collapse");if(this.$element.trigger(n),!n.isDefaultPrevented()){var i=this.$parent&&this.$parent.find("> .panel > .in");if(i&&i.length){var o=i.data("bs.collapse");if(o&&o.transitioning)return;t.call(i,"hide"),o||i.data("bs.collapse",null)}var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("collapse in")[r](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var a=e.camelCase(["scroll",r].join("-"));this.$element.one("bsTransitionEnd",e.proxy(s,this)).emulateTransitionEnd(350)[r](this.$element[0][a])}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(350):i.call(this)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var i=e.fn.collapse;e.fn.collapse=t,e.fn.collapse.Constructor=n,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var i,o=e(this),r=o.attr("data-target")||n.preventDefault()||(i=o.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""),s=e(r),a=s.data("bs.collapse"),l=a?"toggle":o.data(),c=o.attr("data-parent"),u=c&&e(c);a&&a.transitioning||(u&&u.find('[data-toggle="collapse"][data-parent="'+c+'"]').not(o).addClass("collapsed"),o[s.hasClass("in")?"addClass":"removeClass"]("collapsed")),t.call(s,l)})}(jQuery),+function(e){"use strict";function t(t){t&&3===t.which||(e(o).remove(),e(r).each(function(){var i=n(e(this)),o={relatedTarget:this};i.hasClass("open")&&(i.trigger(t=e.Event("hide.bs.dropdown",o)),t.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",o))}))}function n(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&e(n);return i&&i.length?i:t.parent()}function i(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new s(this)),"string"==typeof t&&i[t].call(n)})}var o=".dropdown-backdrop",r='[data-toggle="dropdown"]',s=function(t){e(t).on("click.bs.dropdown",this.toggle)};s.VERSION="3.2.0",s.prototype.toggle=function(i){var o=e(this);if(!o.is(".disabled, :disabled")){var r=n(o),s=r.hasClass("open");if(t(),!s){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t);var a={relatedTarget:this};if(r.trigger(i=e.Event("show.bs.dropdown",a)),i.isDefaultPrevented())return;o.trigger("focus"),r.toggleClass("open").trigger("shown.bs.dropdown",a)}return!1}},s.prototype.keydown=function(t){if(/(38|40|27)/.test(t.keyCode)){var i=e(this);if(t.preventDefault(),t.stopPropagation(),!i.is(".disabled, :disabled")){var o=n(i),s=o.hasClass("open");if(!s||s&&27==t.keyCode)return 27==t.which&&o.find(r).trigger("focus"),i.trigger("click");var a=" li:not(.divider):visible a",l=o.find('[role="menu"]'+a+', [role="listbox"]'+a);if(l.length){var c=l.index(l.filter(":focus"));38==t.keyCode&&c>0&&c--,40==t.keyCode&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var a=e.fn.dropdown;e.fn.dropdown=i,e.fn.dropdown.Constructor=s,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=a,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",r,s.prototype.toggle).on("keydown.bs.dropdown.data-api",r+', [role="menu"], [role="listbox"]',s.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,i){return this.each(function(){var o=e(this),r=o.data("bs.modal"),s=e.extend({},n.DEFAULTS,o.data(),"object"==typeof t&&t);r||o.data("bs.modal",r=new n(this,s)),"string"==typeof t?r[t](i):s.show&&r.show(i)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.2.0",n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var n=this,i=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var i=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),i&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var o=e.Event("shown.bs.modal",{relatedTarget:t});i?n.$element.find(".modal-dialog").one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(o)}).emulateTransitionEnd(300):n.$element.trigger("focus").trigger(o)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var n=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=e.support.transition&&i;if(this.$backdrop=e('<div class="modal-backdrop '+i+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;o?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(150):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){n.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(150):r()}else t&&t()},n.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var i=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var i=e(this),o=i.attr("href"),r=e(i.attr("data-target")||o&&o.replace(/.*(?=#[^\s]+$)/,"")),s=r.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(o)&&o},r.data(),i.data());i.is("a")&&n.preventDefault(),r.one("show.bs.modal",function(e){e.isDefaultPrevented()||r.one("hidden.bs.modal",function(){i.is(":visible")&&i.trigger("focus")})}),t.call(r,s,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.tooltip"),r="object"==typeof t&&t;(o||"destroy"!=t)&&(o||i.data("bs.tooltip",o=new n(this,r)),"string"==typeof t&&o[t]())})}var n=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};n.VERSION="3.2.0",n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,i){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&e(this.options.viewport.selector||this.options.viewport);for(var o=this.options.trigger.split(" "),r=o.length;r--;){var s=o[r];if("click"==s)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,i){n[e]!=i&&(t[e]=i)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void(n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show()},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void(n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var n=e.contains(document.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!n)return;var i=this,o=this.tip(),r=this.getUID(this.type);this.setContent(),o.attr("id",r),this.$element.attr("aria-describedby",r),this.options.animation&&o.addClass("fade");var s="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,a=/\s?auto?\s?/i,l=a.test(s);l&&(s=s.replace(a,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(s).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element);var c=this.getPosition(),u=o[0].offsetWidth,d=o[0].offsetHeight;if(l){var h=s,p=this.$element.parent(),f=this.getPosition(p);s="bottom"==s&&c.top+c.height+d-f.scroll>f.height?"top":"top"==s&&c.top-f.scroll-d<0?"bottom":"right"==s&&c.right+u>f.width?"left":"left"==s&&c.left-u<f.left?"right":s,o.removeClass(h).addClass(s)}var g=this.getCalculatedOffset(s,c,u,d);this.applyPlacement(g,s);var m=function(){i.$element.trigger("shown.bs."+i.type),i.hoverState=null};e.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",m).emulateTransitionEnd(150):m()}},n.prototype.applyPlacement=function(t,n){var i=this.tip(),o=i[0].offsetWidth,r=i[0].offsetHeight,s=parseInt(i.css("margin-top"),10),a=parseInt(i.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),t.top=t.top+s,t.left=t.left+a,e.offset.setOffset(i[0],e.extend({using:function(e){i.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),i.addClass("in");var l=i[0].offsetWidth,c=i[0].offsetHeight;"top"==n&&c!=r&&(t.top=t.top+r-c);var u=this.getViewportAdjustedDelta(n,t,l,c);u.left?t.left+=u.left:t.top+=u.top;var d=u.left?2*u.left-o+l:2*u.top-r+c,h=u.left?"left":"top",p=u.left?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(d,i[0][p],h)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(){function t(){"in"!=n.hoverState&&i.detach(),n.$element.trigger("hidden.bs."+n.type)}var n=this,i=this.tip(),o=e.Event("hide.bs."+this.type);return this.$element.removeAttr("aria-describedby"),this.$element.trigger(o),o.isDefaultPrevented()?void 0:(i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?i.one("bsTransitionEnd",t).emulateTransitionEnd(150):t(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],i="BODY"==n.tagName;return e.extend({},"function"==typeof n.getBoundingClientRect?n.getBoundingClientRect():null,{scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop(),width:i?e(window).width():t.outerWidth(),height:i?e(window).height():t.outerHeight()},i?{top:0,left:0}:t.offset())},n.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,i){var o={top:0,left:0};if(!this.$viewport)return o;var r=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(e)){var a=t.top-r-s.scroll,l=t.top+r-s.scroll+i;a<s.top?o.top=s.top-a:l>s.top+s.height&&(o.top=s.top+s.height-l)}else{var c=t.left-r,u=t.left+r+n;c<s.left?o.left=s.left-c:u>s.width&&(o.left=s.left+s.width-u)}return o},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var i=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=i,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.popover"),r="object"==typeof t&&t;(o||"destroy"!=t)&&(o||i.data("bs.popover",o=new n(this,r)),"string"==typeof t&&o[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.2.0",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").empty()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},n.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var i=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=i,this}}(jQuery),+function(e){"use strict";function t(n,i){var o=e.proxy(this.process,this);this.$body=e("body"),this.$scrollElement=e(e(n).is("body")?window:n),this.options=e.extend({},t.DEFAULTS,i),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",o),this.refresh(),this.process()}function n(n){return this.each(function(){var i=e(this),o=i.data("bs.scrollspy"),r="object"==typeof n&&n;o||i.data("bs.scrollspy",o=new t(this,r)),"string"==typeof n&&o[n]()})}t.VERSION="3.2.0",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t="offset",n=0;e.isWindow(this.$scrollElement[0])||(t="position",n=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var i=this;this.$body.find(this.selector).map(function(){var i=e(this),o=i.data("target")||i.attr("href"),r=/^#./.test(o)&&e(o);return r&&r.length&&r.is(":visible")&&[[r[t]().top+n,o]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){i.offsets.push(this[0]),i.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),i=this.options.offset+n-this.$scrollElement.height(),o=this.offsets,r=this.targets,s=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),t>=i)return s!=(e=r[r.length-1])&&this.activate(e);if(s&&t<=o[0])return s!=(e=r[0])&&this.activate(e);for(e=o.length;e--;)s!=r[e]&&t>=o[e]&&(!o[e+1]||t<=o[e+1])&&this.activate(r[e])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=e(n).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")};var i=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=i,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.tab");o||i.data("bs.tab",o=new n(this)),"string"==typeof t&&o[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.2.0",n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var o=n.find(".active:last a")[0],r=e.Event("show.bs.tab",{relatedTarget:o});if(t.trigger(r),!r.isDefaultPrevented()){var s=e(i);this.activate(t.closest("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:o})})}}},n.prototype.activate=function(t,n,i){function o(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),i&&i()}var r=n.find("> .active"),s=i&&e.support.transition&&r.hasClass("fade");s?r.one("bsTransitionEnd",o).emulateTransitionEnd(150):o(),r.removeClass("in")};var i=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=i,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(n){n.preventDefault(),t.call(e(this),"show")})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.affix"),r="object"==typeof t&&t;o||i.data("bs.affix",o=new n(this,r)),"string"==typeof t&&o[t]()})}var n=function(t,i){this.options=e.extend({},n.DEFAULTS,i),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(t),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};n.VERSION="3.2.0",n.RESET="affix affix-top affix-bottom",n.DEFAULTS={offset:0,target:window},n.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(n.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},n.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},n.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=e(document).height(),i=this.$target.scrollTop(),o=this.$element.offset(),r=this.options.offset,s=r.top,a=r.bottom;"object"!=typeof r&&(a=s=r),"function"==typeof s&&(s=r.top(this.$element)),"function"==typeof a&&(a=r.bottom(this.$element));var l=null!=this.unpin&&i+this.unpin<=o.top?!1:null!=a&&o.top+this.$element.height()>=t-a?"bottom":null!=s&&s>=i?"top":!1;if(this.affixed!==l){null!=this.unpin&&this.$element.css("top","");var c="affix"+(l?"-"+l:""),u=e.Event(c+".bs.affix");this.$element.trigger(u),u.isDefaultPrevented()||(this.affixed=l,this.unpin="bottom"==l?this.getPinnedOffset():null,this.$element.removeClass(n.RESET).addClass(c).trigger(e.Event(c.replace("affix","affixed"))),"bottom"==l&&this.$element.offset({top:t-this.$element.height()-a}))}}};var i=e.fn.affix;e.fn.affix=t,e.fn.affix.Constructor=n,e.fn.affix.noConflict=function(){return e.fn.affix=i,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var n=e(this),i=n.data();i.offset=i.offset||{},i.offsetBottom&&(i.offset.bottom=i.offsetBottom),i.offsetTop&&(i.offset.top=i.offsetTop),t.call(n,i)})})}(jQuery);var webrtcDetectedBrowser=null,webrtcDetectedVersion=null;navigator.mozGetUserMedia?(console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t,e.play()},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return console.log("MediaStream.prototype.getVideoTracks"),[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return console.log("MediaStream.prototype.getAudioTracks"),[]})):navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),RTCPeerConnection=webkitRTCPeerConnection,RTCSessionDescription=RTCSessionDescription,RTCIceCandidate=RTCIceCandidate,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(e,t){console.log("Attaching media stream for Chrome"),"undefined"!=typeof e.srcObject?e.srcObject=t:"undefined"!=typeof e.mozSrcObject?e.mozSrcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return remoteStreams})):console.log("Browser does not appear to be WebRTC-capable");var videoCall=!1,rtcReady=!1,rtcStarted=!1,phonertc=null;if(isPhoneGap()){var localvideo=document.createElement("div"),remotevideo=document.createElement("div");RTCPeerConnection=function(e,t){"undefined"==typeof e&&(e=[]),"undefined"==typeof t&&(t=[]),this.configuration=e,this.constraints=t,this.createOfferSuccessCallback=function(){},this.createAnswerSuccessCallback=function(){},this.isInitator=!1;var n=[],i=[];this.createOffer=function(e,t,n){console.log("adapt.js create offer"),this.isInitator=!0,this.createOfferSuccessCallback=e,this.init_call()},this.createAnswer=function(e,t,n){console.log("adapt.js create answer"),this.createAnswerSuccessCallback=e},this.setLocalDescription=function(e,t,n){console.log("adapt.js setLocalDescription"),"function"==typeof t&&t()},this.setRemoteDescription=function(e,t,n){console.log("adapt.js setRemoteDescription"),-1==e.sdp.sdp.indexOf("VP8")&&(videoCall=!1),i.push({type:e.sdp.type,sdp:e.sdp.sdp}),"function"==typeof t&&t(),this.isInitator||this.init_call(),this.flushMessages(),this.drainCandidates()},this.updateIce=function(e,t){console.log("adapt.js updateIce")},this.addIceCandidate=function(e,t,n){console.log("adapt.js addIceCandidate"),"undefined"==typeof e.sdpMid&&(e.sdpMid=""),null==e.sdpMid&&(e.sdpMid=""),i.push({type:"candidate",label:e.sdpMLineIndex,id:e.sdpMid,candidate:e.candidate}),this.flushMessages()},this.rtcready=function(){console.log("adapt.js rtcready"),rtcReady=!0,this.flushMessages()},this.flushMessages=function(){var e=0;if(console.log("adapt.js flushMessages"),rtcReady)for(e in i)i.hasOwnProperty(e)&&(console.log("phonertc push"+JSON.stringify(i[e])),phonertc.receiveMessage(i[e]),i.shift())},this.getLocalStreams=function(){console.log("adapt.js getLocalStreams")},this.getRemoteStreams=function(){console.log("adapt.js getRemoteStreams")},this.getStreamById=function(e){console.log("adapt.js getStreamById")},this.addStream=function(e,t){console.log("adapt.js addStream")},this.close=function(){console.log("adapt.js close"),phonertc.disconnect()},this.createDataChannel=function(e,t){},this.drainCandidates=function(){if(console.log("adapt.js drainCandidates "+JSON.stringify(n)),"function"==typeof this.onicecandidate){var e=0;for(e in n)n.hasOwnProperty(e)&&(console.log("context.onicecandidate "+JSON.stringify(n[e])),this.onicecandidate(n[e]),n.shift())}},this.init_call=function(){var e=!1;videoCall&&(e={localVideo:localvideo,remoteVideo:remotevideo});var t=this;rtcStarted||(phonertc.call({isInitator:t.isInitator,turn:{host:"turn:46.105.45.162:443?transport=udp",username:"anonymous",password:"password"},sendMessageCallback:function(e){switch(console.log("data from native:"+JSON.stringify(e)),e.type){case"offer":t.createOfferSuccessCallback(e);break;case"answer":t.createAnswerSuccessCallback(e);break;case"candidate":n.push({candidate:{sdpMLineIndex:e.label,sdpMid:e.id,candidate:e.candidate}}),t.isInitator||t.drainCandidates()}},readyCallback:function(){t.rtcready()},answerCallback:function(){"function"==typeof t.onaddstream&&t.onaddstream({stream:new fakeStream(!1)})},disconnectCallback:function(){console.log("adapt.js disconnectCallback"),rtcReady=!1,rtcStarted=!1,videoCall=!1,t.close()},video:e}),rtcStarted=!0)}},RTCSessionDescription=function(e,t){return this.sdp=e,this.type=t,this},RTCIceCandidate=function(e){this.candidate=e.candidate,this.sdpMLineIndex=e.sdpMLineIndex,this.sdpMid=e.sdpMid},fakeStream=function(e){this.getAudioTracks=function(){return[{label:"ARDAMSa0",stream:null}]},this.getVideoTracks=function(){return[{label:"ARDAMSv0",stream:null}]},e?this.isLocalStream=!0:this.isRemoteStream=!0,this.stop=function(){}},getUserMedia=function(e,t,n){console.log("adapt.js getUserMedia"),e.video&&(videoCall=!0);var i=new fakeStream(!0);t(i)},attachMediaStream=function(e,t){"undefined"!=typeof t.isLocalStream?(localvideo=e,console.log("adapt.js localvideo id= "+e.id)):(remotevideo=e,console.log("adapt.js remotevideo id= "+e.id)),rtcStarted&&phonertc.setVideoElements(localvideo,remotevideo)},reattachMediaStream=function(e,t){}}!function(e){function t(e){return"[object Function]"==Object.prototype.toString.call(e)}function n(e){return"[object Array]"==Object.prototype.toString.call(e)}function i(e,t){var n=/^\w+\:\/\//;return/^\/\/\/?/.test(e)?e=location.protocol+e:n.test(e)||"/"==e.charAt(0)||(e=(t||"")+e),n.test(e)?e:("/"==e.charAt(0)?v:m)+e}function o(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function r(e){for(var t=!1,n=0;n<e.scripts.length;n++)e.scripts[n].ready&&e.scripts[n].exec_trigger&&(t=!0,e.scripts[n].exec_trigger(),e.scripts[n].exec_trigger=null);return t}function s(e,t,n,i){e.onload=e.onreadystatechange=function(){e.readyState&&"complete"!=e.readyState&&"loaded"!=e.readyState||t[n]||(e.onload=e.onreadystatechange=null,i())}}function a(e){e.ready=e.finished=!0;for(var t=0;t<e.finished_listeners.length;t++)e.finished_listeners[t]();e.ready_listeners=[],e.finished_listeners=[]}function l(e,t,n,i,o){setTimeout(function(){var r,a,l=t.real_src;if("item"in b){if(!b[0])return void setTimeout(arguments.callee,25);b=b[0]}r=document.createElement("script"),t.type&&(r.type=t.type),t.charset&&(r.charset=t.charset),o?_?(n.elem=r,C?(r.preload=!0,r.onpreload=i):r.onreadystatechange=function(){"loaded"==r.readyState&&i()},r.src=l):o&&0==l.indexOf(v)&&e[d]?(a=new XMLHttpRequest,a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},n.text=a.responseText+"\n//@ sourceURL="+l,i())},a.open("GET",l),a.send()):(r.type="text/cache-script",
s(r,n,"ready",function(){b.removeChild(r),i()}),r.src=l,b.insertBefore(r,b.firstChild)):x?(r.async=!1,s(r,n,"finished",i),r.src=l,b.insertBefore(r,b.firstChild)):(s(r,n,"finished",i),r.src=l,b.insertBefore(r,b.firstChild))},0)}function c(){function m(e,t,n){function i(){null!=o&&(o=null,a(n))}var o;T[t.src].finished||(e[p]||(T[t.src].finished=!0),o=n.elem||document.createElement("script"),t.type&&(o.type=t.type),t.charset&&(o.charset=t.charset),s(o,n,"finished",i),n.elem?n.elem=null:n.text?(o.onload=o.onreadystatechange=null,o.text=n.text):o.src=t.real_src,b.insertBefore(o,b.firstChild),n.text&&i())}function v(e,t,n,o){var r,s,c=function(){t.ready_cb(t,function(){m(e,t,r)})},u=function(){t.finished_cb(t,n)};t.src=i(t.src,e[g]),t.real_src=t.src+(e[f]?(/\?.*$/.test(t.src)?"&_":"?_")+~~(1e9*Math.random())+"=":""),T[t.src]||(T[t.src]={items:[],finished:!1}),s=T[t.src].items,e[p]||0==s.length?(r=s[s.length]={ready:!1,finished:!1,ready_listeners:[c],finished_listeners:[u]},l(e,t,r,o?function(){r.ready=!0;for(var e=0;e<r.ready_listeners.length;e++)r.ready_listeners[e]();r.ready_listeners=[]}:function(){a(r)},o)):(r=s[0],r.finished?u():r.finished_listeners.push(u))}function y(){function e(e,t){e.ready=!0,e.exec_trigger=t,s()}function i(e,t){e.ready=e.finished=!0,e.exec_trigger=null;for(var n=0;n<t.scripts.length;n++)if(!t.scripts[n].finished)return;t.finished=!0,s()}function s(){for(;p<d.length;)if(t(d[p]))try{d[p++]()}catch(e){}else{if(!d[p].finished){if(r(d[p]))continue;break}p++}p==d.length&&(f=!1,c=!1)}function a(){c&&c.scripts||d.push(c={scripts:[],finished:!0})}var l,c,u=o(C,{}),d=[],p=0,f=!1;return l={script:function(){for(var r=0;r<arguments.length;r++)!function(r,s){var d;n(r)||(s=[r]);for(var p=0;p<s.length;p++)a(),r=s[p],t(r)&&(r=r()),r&&(n(r)?(d=[].slice.call(r),d.unshift(p,1),[].splice.apply(s,d),p--):("string"==typeof r&&(r={src:r}),r=o(r,{ready:!1,ready_cb:e,finished:!1,finished_cb:i}),c.finished=!1,c.scripts.push(r),v(u,r,c,x&&f),f=!0,u[h]&&l.wait()))}(arguments[r],arguments[r]);return l},wait:function(){if(arguments.length>0){for(var e=0;e<arguments.length;e++)d.push(arguments[e]);c=d[d.length-1]}else c=!1;return s(),l}},{script:l.script,wait:l.wait,setOptions:function(e){return o(e,u),l}}}var w,C={},x=_||S,k=[],T={};return C[d]=!0,C[h]=!1,C[p]=!1,C[f]=!1,C[g]="",w={setGlobalDefaults:function(e){return o(e,C),w},setOptions:function(){return y().setOptions.apply(null,arguments)},script:function(){return y().script.apply(null,arguments)},wait:function(){return y().wait.apply(null,arguments)},queueScript:function(){return k[k.length]={type:"script",args:[].slice.call(arguments)},w},queueWait:function(){return k[k.length]={type:"wait",args:[].slice.call(arguments)},w},runQueue:function(){for(var e,t=w,n=k.length,i=n;--i>=0;)e=k.shift(),t=t[e.type].apply(null,e.args);return t},noConflict:function(){return e.$LAB=u,w},sandbox:function(){return c()}}}var u=e.$LAB,d="UseLocalXHR",h="AlwaysPreserveOrder",p="AllowDuplicates",f="CacheBust",g="BasePath",m=/^[^?#]*\//.exec(location.href)[0],v=/^\w+\:\/\/\/?[^\/]+/.exec(m)[0],b=document.head||document.getElementsByTagName("head"),y=e.opera&&"[object Opera]"==Object.prototype.toString.call(e.opera)||"MozAppearance"in document.documentElement.style,w=document.createElement("script"),C="boolean"==typeof w.preload,_=C||w.readyState&&"uninitialized"==w.readyState,x=!_&&w.async===!0,S=!_&&!x&&!y;e.$LAB=c(),function(e,t,n){null==document.readyState&&document[e]&&(document.readyState="loading",document[e](t,n=function(){document.removeEventListener(t,n,!1),document.readyState="complete"},!1))}("addEventListener","DOMContentLoaded")}(this),function(e,t){function n(e){var t=new RegExp("^[0-9-.]*$","g");return t.test(e)}function i(){return"https:"==e.location.protocol}function o(){return"http:"==e.location.protocol}function r(){var e,t=navigator.appName,n=navigator.userAgent,i=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return i&&null!=(e=n.match(/version\/([\.\d]+)/i))&&(i[2]=e[1]),i=i?[i[1],i[2]]:[t,navigator.appVersion,"-?"],i[0]}function s(){var e,t=navigator.appName,n=navigator.userAgent,i=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return i&&null!=(e=n.match(/version\/([\.\d]+)/i))&&(i[2]=e[1]),i=i?[i[1],i[2]]:[t,navigator.appVersion,"-?"],i[1]}e.Prototype&&delete Array.prototype.toJSON,console.log("Starting APIRTC_MODULE");var a=null,l=null,c=null,u=null,d=null,h=null,p=null,f=null,g=null,m=null,v=null,b=null,y="notTested",w=null,C=null;return m=r(),v=s(),console.log("Browser : "+m),console.log("Browser version : "+v),a=function(){if(console.log("WebRTC_Event"),"notTested"===y)try{new CustomEvent("test",{detail:"test",bubbles:!0,cancelable:!0}),y=!0}catch(n){y=!1,console.log("customEvent error :"+n)}("MSIE"===m&&v>8||"Netscape"===m)&&(console.log("polyfill the CustomEvent()"),function(){function n(e,n){n=n||{bubbles:!1,cancelable:!1,detail:t};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),i}n.prototype=e.CustomEvent.prototype,e.CustomEvent=n}(),y=!0),this.eventDispatchMgr=function(e,t){if(y===!1)"undefined"!=typeof $jqApz?(console.log("CustomEvent not supported by Browser, using $jqApz "),$jqApz.event.trigger({type:e,detail:t})):"undefined"!=typeof jQuery?(console.log("CustomEvent not supported by Browser, using jQuery "),jQuery.event.trigger({type:e,detail:t})):console.warn("Custom Events not supported on this browser : eventDispatchMgr()");else{var n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(n)}},this.createIncomingCallEvent=function(e,t,n,i,o,r,s,a){var l="incomingCall",c={eventType:"incomingCall",time:new Date,clientId:e,callerId:t,callId:i,autoAnswerActivated:o,callNumber:r,callerNickname:n,audioOnly:s,callType:a};this.eventDispatchMgr(l,c)},this.createCallAttemptEvent=function(e,t,n,i){var o="callAttempt",r={eventType:"callAttempt",time:new Date,clientId:e,callerId:t,callId:i,callerNickname:n};this.eventDispatchMgr(o,r)},this.createCallEstablishedEvent=function(e,t){var n="callEstablished",i={eventType:"callEstablished",time:new Date,calleeId:e,callType:t};this.eventDispatchMgr(n,i)},this.createHangupEvent=function(e,t,n,i,o){var r="hangup",s={eventType:"hangup",time:new Date,hangupType:e,clientId:t,remoteId:n,lastEstablishedCall:i,reason:o};this.eventDispatchMgr(r,s)},this.createRemoteHangupEvent=function(e,t,n,i){var o="remoteHangup",r={eventType:"remoteHangup",time:new Date,clientId:e,remoteId:t,lastEstablishedCall:n,reason:i};this.eventDispatchMgr(o,r)},this.createUserMediaSuccessEvent=function(e,t,n,i,o,r){var s="userMediaSuccess",a={eventType:"userMediaSuccess",time:new Date,onCallEstablishment:e,audioIsAvailable:t,audioDeviceLabel:n,videoIsAvailable:i,videoDeviceLabel:o,callType:r};this.eventDispatchMgr(s,a)},this.createUserMediaErrorEvent=function(e,t){var n="userMediaError",i={eventType:"userMediaError",time:new Date,onCallEstablishment:e,callType:t};this.eventDispatchMgr(n,i)},this.createErrorEvent=function(e,t){var n="error",i={eventType:"error :",time:new Date,errorInfo:e,errorCode:t};this.eventDispatchMgr(n,i)},this.createReceiveIMMessageEvent=function(e,t,n,i){var o="receiveIMMessage",r={eventType:"receiveIMMessage",time:new Date,senderId:e,senderNickname:t,senderPhotoURL:n,message:i};this.eventDispatchMgr(o,r)},this.createChannelEvent=function(e){var t="channelEvent",n={eventType:"channelEvent :",time:new Date,channelEvent:e};this.eventDispatchMgr(t,n)},this.createSessionReadyEvent=function(e){console.log("createSessionReadyEvent");var t="sessionReady",n={eventType:"sessionReady",time:new Date,apiCCId:e};this.eventDispatchMgr(t,n)},this.createWebRTCClientCreatedEvent=function(){var e="webRTCClientCreated",t={eventType:"webRTCClientCreated",time:new Date};this.eventDispatchMgr(e,t)},this.createUpdatePresenceEvent=function(e,t,n){var i="updatePresence",o={eventType:"updatePresence",time:new Date,connectedUsersList:e,connectedUsersListWithStatus:n,state:t};this.eventDispatchMgr(i,o)},this.createUpdateUserStatusEvent=function(e){var t="updateUserStatus",n={eventType:"updateUserStatus",time:new Date,message:e};this.eventDispatchMgr(t,n)},this.createGroupChatCreationEvent=function(e,t,n,i,o,r){var s="groupChatCreation",a={eventType:"groupChatCreation",time:new Date,status:e,groupChatId:t,initialDestId:n,invitationSendedToInitialDestId:i,newContactId:o,invitationSendedToNewContactId:r};this.eventDispatchMgr(s,a)},this.createGroupChatInvitationEvent=function(e,t,n,i,o){var r="groupChatInvitation",s={eventType:"groupChatInvitation",time:new Date,groupChatId:e,contactList:o,senderId:t,senderNickname:n,senderPhotoURL:i};this.eventDispatchMgr(r,s)},this.createGroupChatMemberUpdateEvent=function(e,t,n){var i="groupChatMemberUpdate",o={eventType:"groupChatMemberUpdate",time:new Date,groupChatId:e,contactList:t,status:n};this.eventDispatchMgr(i,o)},this.createAddUserInGroupChatEvent=function(e,t,n){var i="addUserInGroupChatAnswer",o={eventType:"addUserInGroupChatAnswer",time:new Date,invitationSended:e,groupChatId:t,contactId:n};this.eventDispatchMgr(i,o)},this.createReceiveGroupChatMessageEvent=function(e,t,n,i){var o="receiveGroupChatMessage",r={eventType:"receiveGroupChatMessage",time:new Date,groupChatId:e,senderId:t,senderNickname:n,message:i};this.eventDispatchMgr(o,r)},this.createReceiveConversationListAnswerEvent=function(e){var t="receiveConversationList",n={eventType:"receiveConversationList",time:new Date,convList:e};this.eventDispatchMgr(t,n)},this.createReceiveContactOccurrencesFromConversationListAnswerEvent=function(e){var t="receiveContactOccurrencesFromConversationList",n={eventType:"receiveContactOccurrencesFromConversationList",time:new Date,occurrencesList:e};this.eventDispatchMgr(t,n)},this.createReceiveConversationDetailReportAnswerEvent=function(e){var t="receiveConversationDetailReport",n={eventType:"receiveConversationDetailReport",time:new Date,CDR:e};this.eventDispatchMgr(t,n)},this.createReceiveConversationHistoryEvent=function(e,t,n){var i="receiveConversationHistory",o={eventType:"receiveConversationHistory",time:new Date,convId:e,convHistory:t,status:n};this.eventDispatchMgr(i,o)},this.createUserDataAnswerEvent=function(e,t,n,i){var o="userDataAnswer",r={eventType:"userDataAnswer",time:new Date,userFound:e,contactId:t,nickname:n,photoURL:i};this.eventDispatchMgr(o,r)},this.createReceiveDataEvent=function(e,t,n){var i="receiveData",o={eventType:"receiveData",time:new Date,senderId:e,dstRoomId:t,data:n};this.eventDispatchMgr(i,o)},this.createMCUSessionCreationEvent=function(e,t){var n="MCUSessionCreation",i={eventType:"MCUSessionCreation",time:new Date,sessionId:e,token:t};this.eventDispatchMgr(n,i)},this.createJoinMCUSessionAnswerEvent=function(e,t,n,i){var o="joinMCUSessionAnswer",r={eventType:"joinMCUSessionAnswer",time:new Date,sessionId:e,token:t,groupChatId:n,initiator:i};this.eventDispatchMgr(o,r)},this.createReceiveMCUSessionInvitationEvent=function(e,n,i,o){i===t&&(i=0);var r="receiveMCUSessionInvitation",s={eventType:"receiveMCUSessionInvitation",time:new Date,sessionId:e,token:n,groupChatId:i,initiatorId:o};this.eventDispatchMgr(r,s)},this.createMCUSessionConnectionEvent=function(e){var t="MCUSessionConnection",n={eventType:"MCUSessionConnection",time:new Date,userIdList:e};this.eventDispatchMgr(t,n)},this.createMCUUserConnectionEvent=function(e){var t="MCUUserConnection",n={eventType:"MCUUserConnection",time:new Date,userIdList:e};this.eventDispatchMgr(t,n)},this.createMCUUserDisconnectionEvent=function(e){var t="MCUUserDisconnection",n={eventType:"MCUUserDisconnection",time:new Date,userIdList:e};this.eventDispatchMgr(t,n)},this.createMCUEvent=function(e,t){var n="mcu",i={eventType:e,time:new Date,event:t};this.eventDispatchMgr(n,i)},this.createCanPlayRemoteVideoEvent=function(e,t,n){var i="canPlayRemoteVideo",o={eventType:"canPlayRemoteVideo",time:new Date,videoDivId:e,callType:t,destId:n};this.eventDispatchMgr(i,o)},this.createRecordedFileAvailableEvent=function(e){var t="recordedFileAvailable",n={eventType:"recordedFileAvailable",time:new Date,fileName:e};this.eventDispatchMgr(t,n)},this.createStopRecordEvent=function(){var e="stopRecord",t={eventType:"stopRecord",time:new Date};this.eventDispatchMgr(e,t)},this.createSnapShotPhotoUploaded=function(e){var t="snapShotPhotoUploaded",n={eventType:"snapShotPhotoUploaded",time:new Date,fileName:e};this.eventDispatchMgr(t,n)},this.createRoomCreationEvent=function(e,t,n){var i="roomCreation",o={eventType:"roomCreation",time:new Date,status:e,roomId:t,roomType:n};this.eventDispatchMgr(i,o)},this.createRoomInvitationEvent=function(e,t,n,i,o,r){var s="roomInvitation",a={eventType:"roomInvitation",time:new Date,roomId:e,contactList:o,senderId:t,senderNickname:n,senderPhotoURL:i,roomType:r};this.eventDispatchMgr(s,a)},this.createRoomMemberUpdateEvent=function(e,t,n,i){var o="roomMemberUpdate",r={eventType:"roomMemberUpdate",time:new Date,roomId:e,contactList:t,status:n,roomType:i};this.eventDispatchMgr(o,r)},this.createReceiveRoomMessageEvent=function(e,t,n,i,o){var r="receiveRoomMessage",s={eventType:"receiveRoomMessage",time:new Date,roomId:e,senderId:t,senderNickname:n,message:i,roomType:o};this.eventDispatchMgr(r,s)},this.createDesktopCaptureEvent=function(e){var t="desktopCapture",n={eventType:"desktopCapture",time:new Date,event:e};this.eventDispatchMgr(t,n)}},l=new a,c={version:"2.7.4",description:"Apizee Cloud Communication Library",session:null,jsLoaded:!1,initApiKey:null,initApiCCId:null},c.init=function(n){console.log("apiRTC initialization, version is :"+c.version);var i="";i="https:"!=e.location.protocol?"http":"https",n.ccsServer===t&&(n.ccsServer="https:"!=e.location.protocol?"ccs2.apizee.com:80":"ccs2.apizee.com:443"),n.userData!==t&&console.log("userData :",n.userData),this.jsLoaded===!1?(c.initApiKey=n.apiKey,c.initApiCCId=n.apiCCId,$LAB.script(function(){return i+"://"+n.ccsServer+"/socket.io/socket.io.js"}).script(function(){return n.ApiDBActivated===!0?i+"://cloud.apizee.com/apiRTC-DB/v1.0/apiRTC-DB-1.0.7.min.js":null}).script(function(){return n.recordActivated===!0?i+"://cloud.apizee.com/apiRTC/lib/RecordRTC.js":null}).wait(function(){console.log("End of .js loading in head"),c.jsLoaded=!0,c.session=new c.ApiCCSession(n)})):(console.log("apiRTC JS Librairies already loaded"),(c.initApiKey!==n.apiKey||c.initApiCCId!==n.apiCCId)&&(console.log("initParameters have changed, need to reload session connection"),n.apiCCId===t&&(console.log("keeping apiCCId defined by apiRTC :"+n.apiCCId),n.apiCCId=c.session.apiCCId),c.session.reOpenChannel(n.apiCCId,n.apiKey),c.initApiKey=n.apiKey,c.initApiCCId=n.apiCCId))},c.disconnect=function(){null!==c.session&&c.session!==t&&(c.setCookie("apiCCId",c.session.apiCCId,5e3),null!==c.session.sessionId&&c.setCookie("sessionId",c.session.sessionId,5e3),null!==c.session.apiCCWebRTCClient&&c.session.apiCCWebRTCClient!==t&&(0!==c.session.apiCCWebRTCClient.webRTCClient.callsTable.length&&console.log("Call is still established and will be disconnected"),null!==c.session.apiCCWebRTCClient.webRTCClient.MCUClient.sessionMCU&&console.log("MCU session is still established and will be disconnected"),c.session.apiCCWebRTCClient.hangUp(),console.log("Disconnecting from Server"),c.session.channel.socket.disconnect(),null!==c.session.apiCCWebRTCClient.webRTCClient.localStream&&(c.session.apiCCWebRTCClient.webRTCClient.localStream.stop(),c.session.apiCCWebRTCClient.webRTCClient.localStream=null),c.session.apiCCWebRTCClient=null))},c.myEventTable=[],c.addEventListener=function(e,t){if("sessionReady"==e||"incomingCall"==e||"callEstablished"==e||"remoteHangup"==e||"userMediaSuccess"==e||"userMediaError"==e||"error"==e||"receiveIMMessage"==e||"updatePresence"==e||"webRTCClientCreated"==e||"updateUserStatus"==e||"channelEvent"==e||"groupChatCreation"==e||"groupChatInvitation"==e||"groupChatMemberUpdate"==e||"addUserInGroupChatAnswer"==e||"receiveGroupChatMessage"==e||"userDataAnswer"==e||"receiveConversationList"==e||"receiveConversationHistory"==e||"receiveConversationDetailReport"==e||"receiveContactOccurrencesFromConversationList"==e||"receiveMCUSessionInvitation"==e||"MCUSessionCreation"==e||"MCUSessionConnection"==e||"MCUUserConnection"==e||"MCUUserDisconnection"==e||"canPlayRemoteVideo"==e||"recordedFileAvailable"==e||"receiveData"==e||"roomCreation"==e||"roomInvitation"==e||"roomMemberUpdate"==e||"receiveRoomMessage"==e||"snapShotPhotoUploaded"==e||"stopRecord"==e||"mcu"==e||"callAttempt"==e||"joinMCUSessionAnswer"==e||"hangup"==e||"desktopCapture"==e){console.log("Adding listener on type :"+e),document.addEventListener&&y===!0?document.addEventListener(e,t,!1):"undefined"!=typeof $jqApz?(console.log("using $jqApz"),$jqApz(document).on(e,t)):"undefined"!=typeof jQuery?(console.log("using jQuery"),jQuery(document).on(e,t)):console.warn("Custom Events not supported on this browser : addEventListener()");var n={type:e,listener:t},i=c.myEventTable.push(n);n=null,console.log("number of myEventTable:"+i)}else l.createErrorEvent("ERROR: Trying to add a listener on an unknow event","UNKNOWN_EVENT_ON_ADDLISTENER"),console.log("ERROR: Trying to add a listener on an unknow event :"+e)},c.removeEventListener=function(e,t){console.log("Removing listener on type :"+e),document.removeEventListener?document.removeEventListener(e,t,!1):"undefined"!=typeof jQuery?jQuery(document).off(e,t):console.log("Custom Events not supported on this browser")},c.setCookie=function(e,t,n){console.log("setCookie"),n=n||36e5;var i=new Date,o=new Date;o.setTime(i.getTime()+n),document.cookie=e+"="+encodeURIComponent(t)+";expires="+o.toGMTString()},e.onbeforeunload=function(){console.log("User has refreshed or left the page");try{if(mailClicked!==t&&null!==mailClicked&&(console.log("mailClicked variable is defined"),mailClicked===!0))return console.log("mailClicked is true : leaving onbeforeunload"),void(mailClicked=!1)}catch(e){console.log("Catch error on PATCH/WORKAROUND to avoid reload of page in chrome when mailto :"+e)}null!==c&&c.disconnect();var n=0,i=0;if(null!==c&&(n=c.myEventTable.length),0!==n){for(console.log("number of myEventTable:"+n),i=0;n>i;i+=1)c.removeEventListener(c.myEventTable[i].type,c.myEventTable[i].listener);this.apiCC.myEventTable.splice(0,n),n=c.myEventTable.length,console.log("number of myEventTable after splice:"+n),c.myEventTable=null}null!==c&&(c.session=null),a=null,l=null,u=null,d=null,h=null,p=null,f=null,null!==c&&(c.ApiCCSession=null,c.ApiCCIMClient=null,c=null)},u=function(n){this.channelReady=!1,this.socket=null,this.channelId=n.apiCCId,this.callURLDestRoom=0,this.myWebRTC_Event=new a,this.initialize=function(){console.log("ApiCC_Channel::initialize()"),this.openChannel()},this.openChannel=function(){var i="",o=null,r=null;console.log("openChannel channelId :"+this.channelId),console.log("session.apiKey :"+n.apiKey),console.log("session.sessionId :"+n.sessionId),n.xhrPolling=!0,console.log("CCSserver used : "+n.ccsServer),n.userData!==t&&(console.log("Defined userData : "+n.userData),o=JSON.stringify(n.userData),console.log("stringUserData.length :"+o.length),o.length<=500?(r=encodeURIComponent(o),i="&userData="+r):console.warn("userData length is too long :"+o.length+" .Need to be <= 500")),n.xhrPolling===!0?(console.log("xhrPolling connexion type"),this.socket="https:"!=e.location.protocol?io.connect("http://"+n.ccsServer+"/?channelId="+this.channelId+"&apiKey="+n.apiKey+"&apiVersion="+c.version+"&sessionId="+n.sessionId+i,{transports:["xhr-polling"],"force new connection":!0}):io.connect("https://"+n.ccsServer+"/?channelId="+this.channelId+"&apiKey="+n.apiKey+"&apiVersion="+c.version+"&sessionId="+n.sessionId+i,{transports:["xhr-polling"],"force new connection":!0,secure:!0,port:"443"})):this.socket="https:"!=e.location.protocol?io.connect("http://"+n.ccsServer+"/?channelId="+this.channelId+"&apiKey="+n.apiKey+"&apiVersion="+c.version+"&sessionId="+n.sessionId+i,{"force new connection":!0}):io.connect("https://"+n.ccsServer+"/?channelId="+this.channelId+"&apiKey="+n.apiKey+"&apiVersion="+c.version+"&sessionId="+n.sessionId+i,{"force new connection":!0,secure:!0,port:"443"}),this.socket.on("connect",this.callback(this,"onChannelOpened")).on("message",this.callback(this,"onChannelMessage")).on("error",this.callback(this,"onChannelError")).on("bye",this.callback(this,"onChannelBye")).on("close",this.callback(this,"onChannelClosed")).on("connecting",this.callback(this,"onChannelConnecting")).on("disconnect",this.callback(this,"onChannelDisconnect")).on("connect_failed",this.callback(this,"onChannelConnect_failed")).on("reconnect_failed",this.callback(this,"onChannelReconnect_failed")).on("reconnect",this.callback(this,"onChannelReconnect")).on("reconnecting",this.callback(this,"onChannelReconnecting"))},this.onChannelConnecting=function(){console.log("onChannelConnecting"),this.myWebRTC_Event.createChannelEvent("onChannelConnecting")},this.onChannelDisconnect=function(){console.log("onChannelDisconnect"),this.myWebRTC_Event.createChannelEvent("onChannelDisconnect")},this.onChannelConnect_failed=function(){console.log("onChannelConnect_failed"),this.myWebRTC_Event.createChannelEvent("onChannelConnect_failed")},this.onChannelReconnect_failed=function(){console.log("onChannelReconnect_failed"),this.myWebRTC_Event.createChannelEvent("onChannelReconnect_failed")},this.onChannelReconnect=function(){if(console.log("onChannelReconnect"),null!==c.session.apiCCIMClient)if(c.session.apiCCIMClient.userDataSetted===!0){var e={photoURL:c.session.apiCCIMClient.photoURL};c.session.apiCCIMClient.setUserData(e)}else console.log("apiCC.session.apiCCIMClient.userDataSetted !== true");else console.log("apiCC.session.apiCCIMClient === null");this.myWebRTC_Event.createChannelEvent("onChannelReconnect")},this.onChannelReconnecting=function(){console.log("onChannelReconnecting"),this.myWebRTC_Event.createChannelEvent("onChannelReconnecting")},this.onChannelOpened=function(){console.log("Channel opened"),console.log("this.channelId :"+this.channelId),this.channelReady=!0,n.onChannelOpened(),this.myWebRTC_Event.createChannelEvent("onChannelOpened")},this.onChannelMessage=function(e){console.log("S->C: "+e),n.processSignalingMessage(e)},this.onChannelError=function(){console.log("Channel error."),this.myWebRTC_Event.createChannelEvent("onChannelError")},this.onChannelClosed=function(){console.log("Channel closed."),this.myWebRTC_Event.createChannelEvent("onChannelClosed")},this.onChannelBye=function(e){var t=JSON.parse(e);console.log("bye message from:"+t.clientId+" for call Id"+t.callId)},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler}},d=function(e){this.sendInvite=function(n,i,o,r,s,a,l){(l===t||null===l)&&(l="media"),console.log("WebRTC_Stack::sendInvite()");var c=null,u=null;c={type:"invite",callId:n,callerId:i,callerNickname:o,calleeId:r,roomId:s,sdpoffer:a,callType:l},u=JSON.stringify(c),console.log("C->S: "+u),e.emit("invite",u)},this.sendInviteBroadcast=function(t,n,i,o,r,s){console.log("WebRTC_Stack::sendInviteBroadcast()");var a=null,l=null;a={type:"invite",callId:t,callerId:n,callerNickname:i,calleeId:o,roomId:r,sdpoffer:s},l=JSON.stringify(a),console.log("C->S: "+l),e.emit("invite_broadcast",l)},this.send200OK=function(t,n,i,o,r,s){console.log("WebRTC_Stack::send200OK()");var a=null,l=null;a={type:"200OK",callId:t,callerId:n,calleeId:i,calleeNickname:o,roomId:r,sdpanswer:s},l=JSON.stringify(a),console.log("C->S: "+l),e.emit("200OK",l)},this.sendCandidate=function(t,n,i,o,r,s,a,l){var c=null,u=null;c={type:"candidate",callId:t,callerId:n,calleeId:i,roomId:o,dst:r,label:s,id:a,candidate:l},u=JSON.stringify(c),console.log("C->S: "+u),e.emit("candidate",u)},this.sendBye=function(t,n,i,o,r){console.log("WebRTC_Stack::sendBye()");var s=null,a=null;s={type:"bye",callId:t,clientId:n,roomId:i,dst:o,reason:r},a=JSON.stringify(s),console.log("C->S: "+a),e.emit("bye",a)},this.sendUpdate=function(t,n,i,o,r,s){console.log("WebRTC_Stack::sendUpdate()");var a=null,l=null;a={type:"update",callId:t,callerId:n,calleeId:i,roomId:o,dst:r,sdpoffer:s},l=JSON.stringify(a),console.log("C->S: "+l),e.emit("update",l)},this.send200Update=function(t,n,i,o,r,s){console.log("WebRTC_Stack::send200Update()");var a=null,l=null;a={type:"200update",callId:t,callerId:n,calleeId:i,roomId:o,dst:r,sdpanswer:s},l=JSON.stringify(a),console.log("C->S: "+l),e.emit("200update",l)},this.sendDebugCommand=function(t,n,i){console.log("WebRTC_Stack::sendDebugCommand :"+t);var o=null,r=null;o={type:"debugCommand",command:t,apiKey:n,clientId:i},r=JSON.stringify(o),console.log("C->S: "+r),e.emit("debugCommand",r)}},h=function(){this.webrtcDetectedBrowser=webrtcDetectedBrowser,this.webrtcDetectedVersion=webrtcDetectedVersion,this.RTCPeerConnection=RTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,this.getUserMedia=getUserMedia,this.attachMediaStream=attachMediaStream},b=function(e){console.log("ApiCCMCUClient creation"),this.apiMCUKey="22934082",this.publisher=null,this.sessionMCU=null,this.localDivId=null,this.remoteDivId=null,this.TBLibIsLoaded=!1,this.subIdTable=[],this.initDivElements=function(e,t){this.localDivId=e,this.remoteDivId=t},this.createSession=function(){console.log("ApiMCU::createSession()");var e=null,t=null;e={type:"createMCUSession"},t=JSON.stringify(e),console.log("C->S: "+t),c.session.channel.socket.emit("createMCUSession",t)},this.receiveSessionId=function(e){console.log("ApiMCU::receiveSessionId()"),l.createMCUSessionCreationEvent(e.sessionId,e.token),this.publish(e.sessionId,e.token)},this.sendSessionInvitation=function(n,i,o){if(console.log("ApiMCU::sendSessionInvitation()"),null!==i&&i!==t){var r=null,s=null;o===t&&(o=0),r={type:"MCUSessionInvitation",srcId:e,destId:n,sessionId:i,groupChatId:o},s=JSON.stringify(r),console.log("C->S: "+s),c.session.channel.socket.emit("MCUSessionInvitation",s)}else console.log("Session is null or undefined, MCU Session invitation is not sended")},this.sendSessionInvitationToGroupChat=function(n,i){if(console.log("ApiMCU::sendSessionInvitationToGroupChat()"),null!==n&&n!==t)if(null!==i&&i!==t){var o=null,r=null;o={type:"MCUSessionInvitationToGroupChat",srcId:e,groupChatId:n,sessionId:i},r=JSON.stringify(o),console.log("C->S: "+r),c.session.channel.socket.emit("MCUSessionInvitationToGroupChat",r)}else console.log("Session is null or undefined, MCU Session invitation is not sended");else console.log("groupChatId is null or undefined, MCU Session invitation is not sended")},this.receiveSessionInvitation=function(e){console.log("ApiMCU::receiveSessionInvitation()"),console.log("msg.sessionId :"+e.sessionId),console.log("msg.token :"+e.token),console.log("msg.groupChatId :"+e.groupChatId),l.createReceiveMCUSessionInvitationEvent(e.sessionId,e.token,e.groupChatId,e.srcId)},this.acceptSessionInvitation=function(e,t){console.log("ApiMCU::acceptSessionInvitation()"),console.log("sessionId :"+e),console.log("token :"+t),this.publish(e,t)},this.leaveSession=function(){console.log("ApiMCU::leaveSession()");var e=0,t=null,n=null,i=null,o=0;for(null!==this.sessionMCU&&(this.sessionMCU.unpublish(this.publisher),this.sessionMCU.disconnect()),o=this.subIdTable.length,console.log("subDivTable length : "+o),e=0;o>e;e+=1)console.log("i = "+e),console.log("this.subIdTable[i] = "+this.subIdTable[e].subDivId),t="subDiv"+this.subIdTable[e].subDivId,i=document.getElementById(t),null!==i&&(console.log("Removing subDiv with Id : "+t),console.log("this.remoteDivId : "+this.remoteDivId),n=document.getElementById(this.remoteDivId),n.removeChild(i));this.subIdTable.splice(0,this.subIdTable.length)},this.joinSession=function(e){console.log("ApiMCU::joinSession()");var t=null,n=null;t={type:"joinMCUSession",roomId:e},n=JSON.stringify(t),console.log("C->S: "+n),c.session.channel.socket.emit("joinMCUSession",n)},this.joinSessionAnswer=function(e){console.log("ApiMCU::joinSessionAnswer()"),l.createJoinMCUSessionAnswerEvent(e.sessionId,e.token,e.groupChatId,e.initiator),this.publish(e.sessionId,e.token)},this.takeSnapshot=function(e){var t=null,n=0,i=null,o=0;if(0===e)t=this.publisher.getImgData();else for(n=this.subIdTable.length,i=null,o=0;n>o;o+=1)console.debug("this.subIdTable[i].subDivId :"+this.subIdTable[o].subDivId),console.debug("remoteId :"+e),this.subIdTable[o].subDivId==e&&(console.log("subscriber found"),i=this.subIdTable[o].subObj,t=i.getImgData());return t},this.sessionDisconnectHandler=function(e){console.log("ApiMCU::sessionDisconnectHandler()"),"networkDisconnected"==e.reason&&console.log("Your MCU connection is terminated."),console.log("this.sessionMCU :"+this.sessionMCU),this.sessionMCU=null,this.publisher=null,l.createMCUEvent("sessionDisconnected",e)},this.sessionConnectedHandler=function(e){console.log("ApiMCU::sessionConnectedHandler()");var t=[];this.sessionMCU.publish(this.publisher),l.createMCUSessionConnectionEvent(t),t.splice(0,t.length)},this.subscribeToStreams=function(e){console.log("ApiMCU::subscribeToStreams()");var t=0,n=0,i=null,o=null,r=null;for(t=0;t<e.length;t+=1)console.log("streams.length :"+e.length),n=e[t],n.connection.connectionId!=this.sessionMCU.connection.connectionId&&(i=document.getElementById("subDiv"+n.connection.data),null===i?(console.log("Adding SubDiv"),i=document.createElement("div"),i.id="subDiv"+n.connection.data,o=document.getElementById(this.remoteDivId),o.appendChild(i),r=this.sessionMCU.subscribe(n,"subDiv"+n.connection.data,{width:240,height:180}),r.setStyle({nameDisplayMode:"off"}),this.subIdTable.push({subDivId:n.connection.data,subObj:r})):console.log("Sub Div already exist, no new div creation"));setTimeout(function(){var e=0,t=document.getElementsByClassName("OT_opentok OT_mode-auto"),n=0;for(n=t.length,e=0;n>e;e+=1)console.log("i : "+e),t[0].className=""},5e3)},this.streamCreatedHandler=function(e){this.subscribeToStreams(e.streams);var t=[],n=0,i=0;for(console.log("event.streams.length"+e.streams.length),n=0;n<e.streams.length;n++)i=e.streams[n],console.log("stream.connection.data"+i.connection.data),t.push(i.connection.data);l.createMCUUserConnectionEvent(t),t.splice(0,t.length)},this.streamDestroyedHandler=function(e){console.log("ApiMCU::streamDestroyedHandler()");var t=0,n=null,i=[];for(t=0;t<e.streams.length;t++)n=e.streams[t],console.log("Stream "+n.name+" ended. "+e.reason),this.unsubscribe(n),i.push(n.connection.data);l.createMCUUserDisconnectionEvent(i),i.splice(0,i.length),l.createMCUEvent("streamDestroyed",e)},this.unsubscribe=function(e){console.log("ApiMCU::unsubscribe()");var t=this.sessionMCU.getSubscribersForStream(e),n=0,i=null,o=null,r=null,s=0,a=0;for(n=0;n<t.length;n++)this.sessionMCU.unsubscribe(t[n]);for(i="subDiv"+e.connection.data,r=document.getElementById(i),null!==r&&(console.log("Removing subDiv with Id : "+i),o=document.getElementById(this.remoteDivId),o.removeChild(r)),s=this.subIdTable.length,n=0;s>n;n+=1)if(console.debug("this.subIdTable[i].subDivId :"+this.subIdTable[n].subDivId),this.subIdTable[n-a].subDivId==e.connection.data){this.subIdTable.splice(n-a,1),a+=1;break}},this.exceptionHandler=function(e){(1006===e.code||1008===e.code||1014===e.code)&&console.warn("Connexion error with MCU"),l.createMCUEvent("exception",e)},this.accessAllowedHandler=function(e){console.log("user has granted access to the camera and microphone"),setTimeout(function(){var e=0,t=document.getElementsByClassName("OT_opentok OT_mode-auto"),n=0;for(n=t.length,e=0;n>e;e+=1)console.log("i : "+e),t[0].className=""},300);var t=!0,n="Unknown",i=!0,o="Unknown";l.createUserMediaSuccessEvent(!0,t,n,i,o,"media")},this.accessDeniedHandler=function(e){console.warn("user has denied access to the camera and microphone"),l.createUserMediaErrorEvent(!0,"media")},this.streamPropertyChangedHandler=function(e){l.createMCUEvent("streamPropertyChanged",e)},this.publish=function(e,t){null===this.sessionMCU?(this.publisher=TB.initPublisher(this.apiMCUKey,this.localDivId,{
name:c.session.nickname,style:{nameDisplayMode:"off"},width:240,height:180}).on("streamCreated",function(e){l.createMCUEvent("publisher-streamCreated",e)}).on("streamDestroyed",function(e){l.createMCUEvent("publisher-streamDestroyed",e)}),this.publisher.setStyle({nameDisplayMode:"off"}),this.publisher.on("accessAllowed",this.callback(this,"accessAllowedHandler")),this.publisher.on("accessDenied",this.callback(this,"accessDeniedHandler")),this.sessionMCU=TB.initSession(e),this.sessionMCU.on("sessionDisconnected",this.callback(this,"sessionDisconnectHandler")),TB.on("exception",this.callback(this,"exceptionHandler")),this.sessionMCU.on("sessionConnected",this.callback(this,"sessionConnectedHandler")),this.sessionMCU.on("streamCreated",this.callback(this,"streamCreatedHandler")),this.sessionMCU.on("streamDestroyed",this.callback(this,"streamDestroyedHandler")),this.sessionMCU.on("streamPropertyChanged",this.callback(this,"streamPropertyChangedHandler")),this.sessionMCU.connect(this.apiMCUKey,t)):console.warn("MCU Session is already connected, leave it before connecting a new session")},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler}},g=function(){console.log("SDPManager"),this.getSDPLines=function(e){console.log("SDPManager::getSDPLines");var t=e.split("\r\n"),n=0;for(n=0;n<t.length;n+=1)console.log("sdpLines[i] : "+t[n]);return t},this.getVideoMediaDescriptionPart=function(e){console.log("SDPManager::getVideoMediaDescriptionPart");var t=e.split("m=video"),n=0;for(n=0;n<t.length;n+=1)console.log("sdpMediaPart[i] : "+t[n]);return t[1]},this.searchMediaDescriptionForRecvOnly=function(e){return console.log("searchMediaDescriptionForRecvOnly"),-1!==e.search("a=recvonly")?(console.log("recvonly found in media description"),!0):(console.log("recvonly not found in media description"),!1)},this.searchSDPForVideoRecvOnly=function(e){return e!==t?(console.log("sdpVideoPart !== undefined"),this.searchMediaDescriptionForRecvOnly(e)):(console.log("recvonly not found in SDP for video"),!1)},this.stripVideoMediaDescriptionFromSDP=function(e){console.log("SDPManager::stripVideoMediaDescriptionFromSDP"),e=e.replace("a=group:BUNDLE audio video","a=group:BUNDLE audio");var t=e.split("m=video"),n=0;for(n=0;n<t.length;n+=1)console.log("sdpMediaPart[i] : "+t[n]);return t[0]}},w=function(e,n){console.log("RecordManager creation"),this.recordAudio=null,this.recordVideo=null,this.recordOngoing=!1,this.uploadServerAddress=n,this.sessionIdForRecord=null,this.timerRef=0,this.setUploadServerAddress=function(e){this.uploadServerAddress=e},this.record=function(n,i,o,r){return console.log("record"),console.log("duration :"+o),this.sessionIdForRecord=r,"local"!==n?void console.log("streamType incorrect"):"audio"!==i&&"video"!==i&&"videoOnly"!==i?void console.log("recordType incorrect :"+i):(console.log(null===e.localStream||e.localStream===t?"webRTCClient.localVideo issue":"webRTCClient.localVideo OK"),void(this.recordStream(e.localStream,i)===!0?(console.log("Recording started"),this.timerRef=setTimeout(this.callback(this,"stopRecord"),o)):console.log("Recording not started")))},this.stop=function(){console.log("record"),clearTimeout(this.timerRef),this.timerRef=0,this.stopRecord()},this.xhr=function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&n(i.responseText)},i.open("POST",e),i.send(t)},this.recordStream=function(e,t){if(console.log("recordStream : "),this.recordOngoing===!0)return console.log("one recording is already ongoing : leaving recordStream"),!1;if(this.recordOngoing=!0,this.recordType=t,"videoOnly"!==this.recordType&&(this.recordAudio=new RecordRTC(e,{bufferSize:16384,sampleRate:44100})),"audio"!==this.recordType){var n={type:"video",video:{width:320,height:240},canvas:{width:320,height:240}};this.recordVideo=new RecordRTC(e,n)}return"videoOnly"!==this.recordType&&this.recordAudio.startRecording(),"audio"!==this.recordType&&this.recordVideo.startRecording(),!0},this.postBlob=function(e,t,n){var i=new FormData;i.append("destFileName",n),i.append("fichier",e),i.append("sessionId",this.sessionIdForRecord),this.xhr(this.uploadServerAddress,i,function(e){console.log("files loaded, filename :"+e),console.log("JSON.parse(fileName).fileUrl :"+JSON.parse(e).fileUrl),l.createRecordedFileAvailableEvent(JSON.parse(e).fileUrl)})},this.stopRecord=function(){console.log("stopRecord : ");var t=new Date,n=t.toJSON(),i=n.replace(new RegExp(":","g"),"-");l.createStopRecordEvent(),this.fileName=e.clientId+"-"+i,"videoOnly"!==this.recordType&&this.recordAudio.stopRecording(),"audio"!==this.recordType&&this.recordVideo.stopRecording(),"videoOnly"!==this.recordType?(this.postBlob(this.recordAudio.getBlob(),"audio",this.fileName+".wav"),"audio"!==this.recordType&&this.postBlob(this.recordVideo.getBlob(),"video",this.fileName+".webm")):this.postBlob(this.recordVideo.getBlob(),"video",this.fileName+".webm"),null!==e.localStream&&(console.log("Stopping localStream on stopRecord"),e.localStream.stop(),e.localStream=null),this.recordOngoing=!1},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler}},p=function(t){this.dest_roomId="",this.pc=null,this.callId=0,this.callee=!1,this.callerId=0,this.calleeId=0,this.started=!1,this.sendedSdpOfferMessage=null,this.receivedSdpOfferMessage=null,this.myWebRTC_Stack=new d(t.socket),this.mediaConstraintsAudioOnly={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},this.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this.callLocalStream=null,this.generatedLocalStream=!1,this.audioOnly=!1,this.inviteSended=!1,this.callCancelled=!1,this.screenSharing=!1,this.desktopId=0,this.pc_config=t.pc_config,this.pc_constraints=t.pc_constraints,this.trickleIce=t.trickleIce,this.audioFileMediaElement=null,this.getStatsInterval=5e3,this.qm=null,this.statisticId=null,console.log("New Call for client with Id :"+t.clientId),this.generateCallId=function(){this.callId=Math.floor(1000001*Math.random()).toString(),console.log("new call with callId :"+this.callId)},this.onSetLocalDescriptionSuccess=function(){console.log("onSetLocalDescriptionSuccess")},this.onSetLocalDescriptionFailure=function(e){console.log("onSetLocalDescriptionFailure"+e)},this.onSetRemoteDescriptionSuccess=function(){console.log("onSetRemoteDescriptionSuccess")},this.onSetRemoteDescriptionFailure=function(e){console.log("onSetRemoteDescriptionFailure :"+e)},this.getUserMediaOnCall=function(){console.log("getUserMediaOnCall, audio Only :"+this.audioOnly),console.log("getUserMediaOnCall, screenSharing activated :"+this.screenSharing),t.getUserMediaOnGoing=!0;var e={mandatory:{},optional:[]},n=null;try{this.screenSharing===!0?(console.log("getScreenMedia"),navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.desktopId,maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},this.callback(this,"onUserMediaSuccessOnCall"),this.callback(this,"onUserMediaErrorOnCall"))):this.audioOnly===!0?(n=null===t.audioSourceId?{audio:!0,video:!1}:{audio:{optional:[{sourceId:t.audioSourceId}]},video:!1},t.myWebRTC_Adapter.getUserMedia(n,this.callback(this,"onUserMediaSuccessOnCall"),this.callback(this,"onUserMediaErrorOnCall"))):(null===t.audioSourceId&&null===t.videoSourceId?n={audio:!0,video:e}:(e={mandatory:{},optional:[{sourceId:t.videoSourceId}]},n={audio:{optional:[{sourceId:t.audioSourceId}]},video:e}),t.myWebRTC_Adapter.getUserMedia(n,this.callback(this,"onUserMediaSuccessOnCall"),this.callback(this,"onUserMediaErrorOnCall"))),console.log("Requested access to local media with new syntax.")}catch(i){alert("getUserMedia() failed. Is this a WebRTC capable browser?"),console.log("getUserMedia failed with exception: "+i.message)}},this.onUserMediaSuccessOnCall=function(e){console.log("onUserMediaSuccessOnCall"),console.log("isHTTPS()"+i());var n=!1,r="Unknown",s=!1,a="Unknown",l="media";t.getUserMediaOnGoing=!1,console.log("User has granted access to local media."),t.accessToLocalMedia=!0,t.displayHangUpButtonInCommand(),t.setStatus(this.callee===!0?"You are connected to :"+this.callerId:"You are connected to :"+this.calleeId),e.getAudioTracks().length>0&&(n=!0,e.getAudioTracks()[0].label&&(r=e.getAudioTracks()[0].label),console.log("Using audio device: "+r)),e.getVideoTracks().length>0&&(s=!0,e.getVideoTracks()[0].label&&(a=e.getVideoTracks()[0].label),console.log("Using video device: "+a)),this.screenSharing===!0&&(l="screenSharing"),t.myWebRTC_Event.createUserMediaSuccessEvent(!0,n,r,s,a,l),t.addingUserMedia===!1?(t.miniVideo&&(console.log("webRTCClient.miniVideo.src :"+t.miniVideo.src),console.log("document.URL :"+document.URL),t.myWebRTC_Adapter.attachMediaStream(t.miniVideo,e)),t.localVideo&&(console.log("webRTCClient.localVideo.src :"+t.localVideo.src),console.log("document.URL :"+document.URL),t.myWebRTC_Adapter.attachMediaStream(t.localVideo,e),t.localVideo.style.opacity=1)):t.miniVideo&&t.myWebRTC_Adapter.attachMediaStream(t.miniVideo,e),this.callLocalStream=e,o()?(console.log("isHTTP true"),this.establishCall()):t.userAcceptOnIncomingCall===!0&&this.callee===!0?console.log("TEMP wait for establishCall"):this.establishCall()},this.establishCall=function(){console.log("establishCall()"),this.maybeStart();var e=null;this.callee&&t.addingUserMedia===!1?(e=new t.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),console.log("Avant setRemote pour le callee"+e),null!==this.pc?this.pc.setRemoteDescription(e,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")):console.log("Error : PC is null"),this.doAnswer()):t.addingUserMedia===!0&&(console.log("Adding local stream."),null!==this.pc?null!==this.callLocalStream?(console.log("Add Stream of callLocalStream"),this.pc.addStream(this.callLocalStream)):(console.log("Add Stream of client.localStream"),this.pc.addStream(t.localStream),this.callLocalStream=t.localStream):console.log("Error : PC is null"),this.updateMedia()),console.log("End of establishCall()")},this.onUserMediaSuccessTestUni=function(){t.getUserMediaOnGoing=!1,console.log("onUserMediaSuccessTestUni : User has not granted access to local media.");var e=null;t.accessToLocalMedia=!0,this.maybeStart(),this.callee&&(e=new t.myWebRTC_Adapter.RTCSessionDescription(this.receivedSdpOfferMessage),console.log("Avant setRemote pour le callee"+e),this.pc.setRemoteDescription(e,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")),this.doAnswer())},this.onUserMediaErrorOnCall=function(n){var i="media";t.getUserMediaOnGoing=!1,console.log("Failed to get access to local media. Error code was "+n.code),t.setStatus("<div>Your phone is registered, you can be joigned with this number : "+t.clientId+"</div>"),this.screenSharing===!0&&(i="screenSharing","https:"!=e.location.protocol?(console.log("You need to be connected using HTTPS for screenSharing"),l.createDesktopCaptureEvent("UserMediaError_HTTPS_needed")):(console.log("screenSharing UserMediaError"),l.createDesktopCaptureEvent("UserMediaError"))),t.myWebRTC_Event.createUserMediaErrorEvent(!0,i),this.callee?(this.myWebRTC_Stack.sendBye(this.callId,this.calleeId,this.dest_roomId,this.callerId,"User_Media_Error"),t.removeCallFromTableWithCallIdandRemoteId(this.callId,this.callerId,"User_Media_Error")):t.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"User_Media_Error")},this.maybeStart=function(){console.log("maybeStart"),!this.started&&t.channelReady&&t.accessToLocalMedia&&(console.log("Creating PeerConnection."),this.createPeerConnection(),t.unidirectionelCallOnly?this.callee===!1&&(console.log("Adding local stream."),null!==this.callLocalStream?(console.log("Add Stream of callLocalStream"),this.pc.addStream(this.callLocalStream)):(console.log("Add Stream of client.localStream"),this.pc.addStream(t.localStream),this.callLocalStream=t.localStream)):(console.log("Adding local stream."),null!==this.callLocalStream?(this.pc.addStream(this.callLocalStream),console.log("Add Stream of callLocalStream")):(console.log("Add Stream of client.localStream"),this.pc.addStream(t.localStream),this.callLocalStream=t.localStream)),this.started=!0,this.callee===!1&&(console.log("Before doCall()"),this.doCall())),console.log("End of maybeStart")},this.createPeerConnection=function(){console.log("createPeerConnection");try{console.log("createPeerConnection with pc_config:"+this.pc_config),console.log("and pc_constraints:"+this.pc_constraints),this.pc=new t.myWebRTC_Adapter.RTCPeerConnection(this.pc_config,this.pc_constraints),this.pc.onicecandidate=this.callback(this,"onIceCandidate")}catch(e){return console.log("Failed to create PeerConnection, exception: "+e.message),void alert("Cannot create RTCPeerConnection object; WebRTC is not supported by this browser.")}this.pc.onaddstream=this.callback(this,"onRemoteStreamAdded"),this.pc.onremovestream=this.callback(this,"onRemoteStreamRemoved"),this.pc.onnegotiationneeded=this.callback(this,"onNegotiationNeeded"),this.pc.onsignalingstatechange=this.callback(this,"onSignalingStateChange"),this.pc.oniceconnectionstatechange=this.callback(this,"onIceConnectionStateChange"),t.qosEnable&&(this.statisticId=setInterval(this.callback(this,"getStatistics"),this.getStatsInterval))},this.statisticsAnswer=function(e){var n=e.result();this.qm||(this.qm=new qosMonitor(this.getStatsInterval/1e3,this.onQosChange,this.onQosAudioChange,this.onQosVideoChange,this.callId,t.apiKey,t.clientId,t.socket)),n&&this.qm.insertStats(n,this.sendedSdpOfferMessage,this.receivedSdpOfferMessage,t.remoteVideo)},this.onQosChange=function(){},this.onQosAudioChange=function(){},this.onQosVideoChange=function(){},this.getStatistics=function(){this.pc?this.pc.getStats?this.pc.getStats(this.callback(this,"statisticsAnswer")):console.log("no stats function"):console.log("Not connected yet")},this.doCall=function(){console.log("Sending offer to peer."),this.audioOnly?(console.log("audioOnly call"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOffer"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)},this.doAnswer=function(){console.log("Sending answer to peer."),this.audioOnly?(console.log("audioOnly call"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessage"),this.callback(this,"onCreateAnswerFailure"),this.mediaConstraintsAudioOnly)):this.pc.createAnswer(this.callback(this,"setLocalAndSendMessage"),this.callback(this,"onCreateAnswerFailure"),this.mediaConstraints)},this.doUpdateAnswer=function(){console.log("Sending answer to peer."),this.audioOnly?(console.log("audioOnly call"),this.pc.createAnswer(this.callback(this,"setLocalAndSendMessageUpdate"),this.callback(this,"onCreateAnswerFailure"),this.mediaConstraintsAudioOnly)):this.pc.createAnswer(this.callback(this,"setLocalAndSendMessageUpdate"),this.callback(this,"onCreateAnswerFailure"),this.mediaConstraints)},this.updateMedia=function(){console.log("Sending Update offer to peer."),this.audioOnly?(console.log("audioOnly call"),this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraintsAudioOnly)):this.pc.createOffer(this.callback(this,"setLocalAndSendMessageonOfferUpdate"),this.callback(this,"onCreateOfferFailure"),this.mediaConstraints)},this.setLocalAndSendMessageonOffer=function(e){console.log("setLocalAndSendMessageonOffer"),console.log("sessionDescription="+e);var n=null;t.RTPMedia===!0&&(e.sdp=e.sdp.replace(/RTP\/SAVPF/g,"RTP/SF")),this.audioOnly===!0&&(e.sdp=t.mySDPManager.stripVideoMediaDescriptionFromSDP(e.sdp)),this.sendedSdpOfferMessage=e,this.callCancelled===!1?(t.NtoNConf===!1?(console.log("Conf N to 1"),this.screenSharing===!0&&(n="screenSharing"),this.trickleIce===!0?this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,t.nickname,this.dest_roomId,this.dest_roomId,e,n):this.pc.setLocalDescription(this.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"))):(console.log("Conf N to N"),this.myWebRTC_Stack.sendInviteBroadcast(this.callId,this.callerId,t.nickname,this.dest_roomId,this.dest_roomId,e)),this.inviteSended=!0):(console.warn("Invite is not sended has call has been canceled"),t.removeCallFromTableWithCallIdandRemoteId(this.callId,this.calleeId,"Call_Cancelled"),0===t.callsTable.length&&(console.log("No more established calls for client"),t.initMediaElementState(),t.displayCallButtonInCommand()))},this.setLocalAndSendMessageonOfferUpdate=function(e){console.log("setLocalAndSendMessageonOffer"),console.log("sessionDescription="+e),this.sendedSdpOfferMessage=e;var t=0;t=this.callee?this.callerId:this.calleeId,this.myWebRTC_Stack.sendUpdate(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,e)},this.onCreateOfferFailure=function(e){console.log("onCreateOfferFailure"+e)},this.onCreateAnswerFailure=function(e){console.log("onCreateAnswerFailure"+e)},this.setLocalAndSendMessage=function(e){console.log("setLocalAndSendMessage"),t.RTPMedia===!0&&(e.sdp=e.sdp.replace(/RTP\/SAVPF/g,"RTP/SF")),t.preferOpusCodec===!0&&(console.log("AP Modif preferOpusCodec"),e.sdp=this.preferOpus(e.sdp)),this.pc.setLocalDescription(e,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure")),this.sendedSdpOfferMessage=e,this.trickleIce===!0&&this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,t.nickname,this.dest_roomId,e)},this.setLocalAndSendMessageUpdate=function(e){console.log("setLocalAndSendMessage"),this.pc.setLocalDescription(e,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure"));var t=0;t=this.callee?this.callerId:this.calleeId,this.myWebRTC_Stack.send200Update(this.callId,this.callerId,this.calleeId,this.dest_roomId,t,e)},this.onIceCandidate=function(e){if(console.log("onIceCandidate"),null!==this.pc&&(console.log("Ice Connection State is now : "+this.pc.iceConnectionState),console.log("Ice  State is now : "+this.pc.iceState),console.log("Ice Gathering State is now : "+this.pc.iceGatheringState)),e.candidate){var n=0,i=0,o=0;n=this.callee?this.callerId:this.calleeId,t.mediaRoutingMode===t.mediaRoutingModeEnum.hostOnly?(i=e.candidate.candidate.search("host"),-1!==i?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,n,e.candidate.sdpMLineIndex,e.candidate.sdpMid,e.candidate.candidate):console.log("Media routing mode is hostOnly and not a HOST Candidate : ignoring message")):t.mediaRoutingMode===t.mediaRoutingModeEnum.stun?(i=e.candidate.candidate.search("host"),o=e.candidate.candidate.search("srflx"),-1!==i||-1!==o?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,n,e.candidate.sdpMLineIndex,e.candidate.sdpMid,e.candidate.candidate):console.log("Media routing mode is stun and not a HOST or SRFLX Candidate : ignoring message")):t.mediaRoutingMode===t.mediaRoutingModeEnum.turn?(console.log("Media routing mode is turn : all condidates are considered"),this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,n,e.candidate.sdpMLineIndex,e.candidate.sdpMid,e.candidate.candidate)):t.mediaRoutingMode===t.mediaRoutingModeEnum.turnOnly&&(i=e.candidate.candidate.search("relay"),-1!==i?this.myWebRTC_Stack.sendCandidate(this.callId,this.callerId,this.calleeId,this.dest_roomId,n,e.candidate.sdpMLineIndex,e.candidate.sdpMid,e.candidate.candidate):console.log("Media routing mode is TurnOnly and not a RELAY Candidate : ignoring message"))}else console.log("End of candidates."),this.trickleIce===!1&&(this.callee===!0?this.myWebRTC_Stack.send200OK(this.callId,this.callerId,this.calleeId,t.nickname,this.dest_roomId,this.pc.localDescription):(this.myWebRTC_Stack.sendInvite(this.callId,this.callerId,t.nickname,this.dest_roomId,this.dest_roomId,this.pc.localDescription),this.inviteSended=!0))},this.onRemoteStreamAdded=function(e){console.log("Remote stream added."),console.log("CallId is :"+this.callId),console.log("ClientId is :"+t.clientId);var n=null,i="media",o=0;o=this.callee?this.callerId:this.calleeId,t.hideLocalVideoOnCall===!0&&t.localVideo&&("firefox"===t.myWebRTC_Adapter.webrtcDetectedBrowser?""!==t.localVideo.mozSrcObject&&(t.localVideo.style.opacity=0):""!==t.localVideo.src&&(t.localVideo.style.opacity=0)),t.transitionToActive(),t.remoteVideo&&(t.remoteVideo.style.opacity=1),n=document.createElement("video"),t.myWebRTC_Adapter.attachMediaStream(n,e.stream),n.autoplay=!0,n.id="callId_"+this.callId+"-"+this.calleeId,t.remoteVideo&&t.remoteVideo.appendChild(n),this.screenSharing===!0&&(i="screenSharing"),n.oncanplay=t.myWebRTC_Event.createCanPlayRemoteVideoEvent(n.id,i,o),t.remoteVideoDisplayManager()},this.onRemoteStreamRemoved=function(e){console.warn("Remote stream removed.")},this.onNegotiationNeeded=function(e){console.info("####  onNegotiationNeeded")},this.onSignalingStateChange=function(e){console.info("####  onSignalingStateChange")},this.onIceConnectionStateChange=function(e){console.info("####  onIceConnectionStateChange"),null!==this.pc?(console.log("Ice Connection State is now : "+this.pc.iceConnectionState),"disconnected"===this.pc.iceConnectionState?console.warn("disconnection detected"):"failed"===this.pc.iceConnectionState&&(console.warn("iceConnection failed detected"),l.createErrorEvent("iceConnection failed detected","ICE_CONNECTION_STATE_FAILED"))):console.log("Ice Connection State change with pc is null")},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler},this.preferOpus=function(e){var t=e.split("\r\n"),n=0,i=0,o=null;for(n=0;n<t.length;n+=1)if(-1!==t[n].search("m=audio")){i=n;break}if(null===i)return e;for(n=0;n<t.length;n+=1)if(-1!==t[n].search("opus/48000")){o=this.extractSdp(t[n],/:(\d+) opus\/48000/i),o&&(t[i]=this.setDefaultCodec(t[i],o));break}return t=this.removeCN(t,i),e=t.join("\r\n")},this.extractSdp=function(e,t){var n=e.match(t);return n&&2==n.length?n[1]:null},this.setDefaultCodec=function(e,t){var n=0,i=e.split(" "),o=new Array,r=0;for(n=0;n<i.length;n++)3===r&&(o[r++]=t),i[n]!==t&&(o[r++]=i[n]);return o.join(" ")},this.removeCN=function(e,t){var n=0,i=e[t].split(" "),o=null,r=0;for(n=e.length-1;n>=0;n--)o=this.extractSdp(e[n],/a=rtpmap:(\d+) CN\/\d+/i),o&&(r=i.indexOf(o),-1!==r&&i.splice(r,1),e.splice(n,1));return e[t]=i.join(" "),e}},f=function(n){function i(e,t,n){var i=e.width,o=i<<2,r=e.height,s=null,a=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,g=0,m=0,v=0,b=0,y=0,w=0,C=0,_=0,x=0;if(t){for(s=t.data,0>n&&(n=0),a=n>=2.5?.98711*n-.9633:n>=.5?3.97156-4.14554*Math.sqrt(1-.26891*n):2*n*(3.97156-4.14554*Math.sqrt(.865545)),l=a*a,c=l*a,u=1.57825+2.44413*a+1.4281*l+.422205*c,d=(2.44413*a+2.85619*l+1.26661*c)/u,h=-(1.4281*l+1.26661*c)/u,p=.422205*c/u,f=1-(d+h+p),g=0;3>g;g++)for(m=0;r>m;m++){for(v=m*o+g,b=m*o+(i-1<<2)+g,y=s[v],w=y,C=w,_=C,v=m*o+g;b>=v;v+=4)y=f*s[v]+d*w+h*C+p*_,s[v]=y,_=C,C=w,w=y;for(v=m*o+(i-1<<2)+g,b=m*o+g,y=s[v],w=y,C=w,_=C,v=m*o+(i-1<<2)+g;v>=b;v-=4)y=f*s[v]+d*w+h*C+p*_,s[v]=y,_=C,C=w,w=y}for(g=0;3>g;g++)for(x=0;i>x;x++){for(v=(x<<2)+g,b=(r-1)*o+(x<<2)+g,y=s[v],w=y,C=w,_=C,v=(x<<2)+g;b>=v;v+=o)y=f*s[v]+d*w+h*C+p*_,s[v]=y,_=C,C=w,w=y;for(v=(r-1)*o+(x<<2)+g,b=(x<<2)+g,y=s[v],w=y,C=w,_=C,v=(r-1)*o+(x<<2)+g;v>=b;v-=o)y=f*s[v]+d*w+h*C+p*_,s[v]=y,_=C,C=w,w=y}return t}}function o(e){var t=new RegExp("^[0-9a-z._-]+@{1}[0-9a-z.-]{2,}[.]{1}[a-z]{2,5}$","i");return t.test(e)}this.localVideo=null,this.miniVideo=null,this.remoteVideo=null,this.localStream=null,this.statusDiv=null,this.commandDiv=null,this.remoteStream=null,this.channelReady=!1,this.socket=n.channel.socket,this.clientId=n.apiCCId,this.apiKey=n.apiKey,this.isVideoMuted=!1,this.isAudioMuted=!1,this.callURLDestRoom=0,this.addingUserMedia=!1,this.callsTable=[],this.accessToLocalMedia=!1,this.unidirectionelCallOnly=!1,this.NtoNConf=!1,this.autoAnswer=!1,this.RTPMedia=!1,this.logoAdded=!1,this.preferOpusCodec=!1,this.mediaRoutingModeEnum={hostOnly:1,stun:2,turn:3,turnOnly:4},this.mediaRoutingMode=this.mediaRoutingModeEnum.turn,this.myWebRTC_Event=new a,this.myWebRTC_Adapter=new h,this.getUserMediaOnGoing=!1,this.userAcceptOnIncomingCall=!1,this.maxWidthRemoteVideo=0,this.maxHeightRemoteVideo=0,this.nickname=n.nickname,this.hideLocalVideoOnCall=!0,this.allowMultipleCalls=!1,this.mySDPManager=new g,this.MCUClient=new b(this.clientId),this.audioSourceId=null,this.videoSourceId=null,this.apiRTCExtensionInstalled=!1,this.trickleIce=!0,this.waitingShareScreenDestNumber=0,this.qosEnable=!1,this.pc_config="","firefox"===this.myWebRTC_Adapter.webrtcDetectedBrowser?(console.log("createPeerConnection FIREFOX"),console.log("webrtcDetectedVersion : "+this.myWebRTC_Adapter.webrtcDetectedVersion),this.pc_config={iceServers:[{url:"turn:46.105.45.162:443",credential:"password",username:"anonymous"}]}):this.myWebRTC_Adapter.webrtcDetectedVersion<28?(console.log("chrome < 28"),console.log("webrtcDetectedVersion : "+this.myWebRTC_Adapter.webrtcDetectedVersion),this.pc_config={iceServers:[{url:"turn:anonymous@46.105.45.162:443",credential:"password"}]}):(console.log("chrome >= 28"),console.log("webrtcDetectedVersion : "+this.myWebRTC_Adapter.webrtcDetectedVersion),this.pc_config={iceServers:[{url:"turn:46.105.45.162:443?transport=udp",credential:"password",username:"anonymous"}]}),this.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!0}]},this.recordMgr=null,n.recordActivated===!0&&(console.log("record feature is activated"),this.recordMgr="https:"!=e.location.protocol?new w(this,"https://beta.apizee.com/contactBox.php/main/uploadFile"):new w(this,"http://beta.apizee.com/contactBox.php/main/uploadFile")),this.initialize=function(e,t,n,i,o,r){console.log("localVideoDivName :"+e),this.localVideo=document.getElementById(e),null===this.localVideo&&this.myWebRTC_Event.createErrorEvent("localVideo Div Name is not correct","INCORRECT_DIV_NAME_LOCALVIDEO"),console.log("miniLocalVideoDivName :"+t),this.miniVideo=document.getElementById(t),null===this.miniVideo&&this.myWebRTC_Event.createErrorEvent("miniVideo Div Name is not correct","INCORRECT_DIV_NAME_MINIVIDEO"),console.log("remoteVideoDivName :"+n),this.remoteVideo=document.getElementById(n),null===this.remoteVideo&&this.myWebRTC_Event.createErrorEvent("remoteVideo Div Name is not correct","INCORRECT_DIV_NAME_REMOTEVIDEO"),console.log("statusDivName :"+i),this.statusDiv=document.getElementById(i),null===this.statusDiv&&this.myWebRTC_Event.createErrorEvent("status Div Name is not correct","INCORRECT_DIV_NAME_STATUS"),this.commandDiv=document.getElementById(o),null===this.commandDiv?this.myWebRTC_Event.createErrorEvent("command Div Name is not correct","INCORRECT_DIV_NAME_COMMAND"):(console.log("Command buttons are managed by ApiRTC"),this.displayCallButtonInCommand()),this.callURLDestRoom=this.checkURLForCallDestination(),0!==this.callURLDestRoom&&(console.log("callURLDestRoom is not null"),this.callperURL(this.callURLDestRoom),this.callURLDestRoom=0),this.initMediaElementState(),this.setStatus("<div>Your phone is registered, you can be joigned with this number : "+this.clientId+"</div>")},this.activateScreenSharing=function(){if(console.log("activateScreenSharing"),"chrome"===this.myWebRTC_Adapter.webrtcDetectedBrowser){var n=document.createElement("link");n.href="https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",n.rel="chrome-webstore-item",document.getElementsByTagName("head")[0].appendChild(n),e.postMessage("apiRTC-extension","*"),e.addEventListener("message",function(n){var i=c.session.apiCCWebRTCClient.webRTCClient,o=null,r=0;n.origin==e.location.origin&&("apiRTC-DeskstopCapture-loaded"==n.data&&(i.apiRTCExtensionInstalled=!0),n.data.desktopId!=t&&(console.log("event.data.desktopId :"+n.data.desktopId),console.log("event.data.callNumber :"+n.data.callNumber),c.session.apiCCWebRTCClient.webRTCClient.setStatus("Calling Destination number :"+n.data.callNumber),o=new p(c.session.apiCCWebRTCClient.webRTCClient),console.log("Calling destination number :"+n.data.callNumber),o.generateCallId(),o.callerId=c.session.apiCCId,o.calleeId=n.data.callNumber,o.dest_roomId=n.data.callNumber,o.audioOnly=!1,o.screenSharing=!0,o.desktopId=n.data.desktopId,o.getUserMediaOnCall(),r=c.session.apiCCWebRTCClient.webRTCClient.callsTable.push(o),console.log("Call Number is :"+r)),"mediaError"==n.data&&(console.log("desktop Capture has been refused by user or you need to be connected using https"),"https:"!=e.location.protocol&&console.log("Please connect to your web page using 'HTTPS'. This is mandatory for desktop capture"),l.createDesktopCaptureEvent("UserMediaError")),"extensionInstalledAndLoaded"==n.data&&(console.log("extensionInstalledAndLoaded"),console.log("this.waitingShareScreenDestNumber :"+c.session.apiCCWebRTCClient.webRTCClient.waitingShareScreenDestNumber),0!==c.session.apiCCWebRTCClient.webRTCClient.waitingShareScreenDestNumber&&(e.postMessage({command:"getDesktopId",callNumber:c.session.apiCCWebRTCClient.webRTCClient.waitingShareScreenDestNumber},"*"),c.session.apiCCWebRTCClient.webRTCClient.waitingShareScreenDestNumber=0)))})}else console.log("activateScreenSharing is only available for chrome Browser"),l.createDesktopCaptureEvent("Browser_Not_Compatible")},this.onSetLocalDescriptionSuccess=function(){console.log("onSetLocalDescriptionSuccess in WebRTC_Client")},this.onSetLocalDescriptionFailure=function(e){console.log("onSetLocalDescriptionFailure in WebRTC_Client :"+e)},this.onSetRemoteDescriptionSuccess=function(){console.log("onSetRemoteDescriptionSuccess in WebRTC_Client")},this.onSetRemoteDescriptionFailure=function(e){console.log("onSetRemoteDescriptionFailure in WebRTC_Client :"+e),console.log("e.name :"+e.name)},this.getUserMedia=function(){var e={mandatory:{},optional:[]},t=null;try{null===this.audioSourceId&&null===this.videoSourceId?t={audio:!0,video:e}:(e={mandatory:{},optional:[{sourceId:this.videoSourceId}]},t={audio:{optional:[{sourceId:this.audioSourceId}]},video:e}),this.myWebRTC_Adapter.getUserMedia(t,this.callback(this,"onUserMediaSuccess"),this.callback(this,"onUserMediaError")),console.log("Requested access to local media with new syntax.")}catch(n){alert("getUserMedia() failed. Is this a WebRTC capable browser?"),console.log("getUserMedia failed with exception: "+n.message)}},this.onUserMediaSuccess=function(e){console.log("User has granted access to local media."),this.accessToLocalMedia=!0;var t=!1,n="Unknown",i=!1,o="Unknown";this.miniVideo&&this.myWebRTC_Adapter.attachMediaStream(this.miniVideo,e),this.localVideo&&(this.myWebRTC_Adapter.attachMediaStream(this.localVideo,e),this.localVideo.style.opacity=1),this.localStream=e,e.getAudioTracks().length>0&&(t=!0,e.getAudioTracks()[0].label&&(n=e.getAudioTracks()[0].label),console.log("Using audio device: "+n)),e.getVideoTracks().length>0&&(i=!0,e.getVideoTracks()[0].label&&(o=e.getVideoTracks()[0].label),console.log("Using video device: "+o)),this.myWebRTC_Event.createUserMediaSuccessEvent(!1,t,n,i,o,"media")},this.onUserMediaError=function(e){console.log("Failed to get access to local media. Error code was "+e.code),this.accessToLocalMedia=!1,this.myWebRTC_Event.createUserMediaErrorEvent(!1,"media")},this.processInvite=function(e){console.log("invite received from :"+e.callerId);var n=0,i=null,o=!1,r=!0,s=null;if(i=new p(this),i.callId=e.callId,i.callerId=e.callerId,i.calleeId=this.clientId,i.dest_roomId=e.roomId,i.callee=!0,i.receivedSdpOfferMessage=e.sdpoffer,n=this.callsTable.push(i),console.log("Call Number is :"+n),"screenSharing"===e.callType)this.unidirectionelCallOnly=!0,i.screenSharing=!0;else if(this.allowMultipleCalls===!1){if(console.log("Refusing double call checking :"),
n>=2)return console.log("Refusing double call"),this.myWebRTC_Event.createCallAttemptEvent(this.clientId,e.callerId,e.callerNickname,i.callId),void this.refuseCall(i.callId,"User_Busy");console.log("NOT Refusing double call")}s=this.mySDPManager.getVideoMediaDescriptionPart(e.sdpoffer.sdp),s!==t?o=this.mySDPManager.searchSDPForVideoRecvOnly(s):r=!1,(o||r===!1)&&(i.audioOnly=!0,console.log("Call is audio only")),this.autoAnswer===!0&&this.displayHangUpButtonInCommand(),this.unidirectionelCallOnly?(this.setStatus("You are connected to "+e.callerId+', your audio and video media are not transmitted. <input type="button" id="AddMedia" value="Activate Audio & Video" onclick="apiCC.session.apiCCWebRTCClient.addMedia('+i.callId+')" />'),i.onUserMediaSuccessTestUni(),this.myWebRTC_Event.createIncomingCallEvent(this.clientId,e.callerId,e.callerNickname,i.callId,!1,n,!1,e.callType)):this.accessToLocalMedia===!0&&this.autoAnswer===!0?(this.setStatus("You are connected to :"+e.callerId),console.log("User has already granted access to local media and AutoAnswer activated : establishing call"),this.myWebRTC_Event.createIncomingCallEvent(this.clientId,e.callerId,e.callerNickname,i.callId,!0,n,i.audioOnly,e.callType),this.userAcceptOnIncomingCall?console.log("Waiting for call accept or refuse from user"):(console.log("userAcceptOnIncomingCall is not activated"),i.establishCall())):(this.setStatus("Incoming Call from :"+e.callerId+'. Click on "Autoriser" button to accept.'),this.myWebRTC_Event.createIncomingCallEvent(this.clientId,e.callerId,e.callerNickname,i.callId,!1,n,i.audioOnly,e.callType),i.getUserMediaOnCall())},this.process200OK=function(e){console.log("200OK received from :"+e.calleeId);var t=null,n=null,i=null,o=0,r=null,s="media";if(t=this.findCallWithCallIdAndRemoteId(e.callId,e.calleeId),null===t){if(n=this.findCallWithCallId(e.callId),null===n)return console.log("200OK received but callId is not matching, no process"),void this.myWebRTC_Event.createErrorEvent("200OK received but callId is not matching, no process","NOT_MATCHING_CALLID_ON_200OK");console.log("200OK received with an existing callID but not calleeId, creation of new conference call"),i=new p(this),i.callId=e.callId,i.callerId=e.callerId,i.calleeId=e.calleeId,i.dest_roomId=e.roomId,i.callee=!1,i.createPeerConnection(),i.sendedSdpOfferMessage=n.sendedSdpOfferMessage,i.audioOnly=!1;try{i.callLocalStream=new webkitMediaStream(n.callLocalStream.getAudioTracks(),n.callLocalStream.getVideoTracks())}catch(a){console.log("callLocalStream copy for Chrome 26"),i.callLocalStream=new webkitMediaStream(n.callLocalStream),console.log("call3.callLocalStream"+i.callLocalStream)}i.generatedLocalStream=!0,i.started=!0,o=this.callsTable.push(i),console.log("Call Number is :"+o),console.log("call3.callLocalStream === null"),i.pc.addStream(n.callLocalStream),i.pc.setLocalDescription(i.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure")),r=new this.myWebRTC_Adapter.RTCSessionDescription(e.sdpanswer),console.log("Avant setRemote sur Answer"+r),i.pc.setRemoteDescription(r,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")),this.setStatus("You are connected to :"+e.calleeId),this.myWebRTC_Event.createCallEstablishedEvent(e.calleeId,"media")}else t.calleeId=e.calleeId,t.pc.setLocalDescription(t.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure")),r=new this.myWebRTC_Adapter.RTCSessionDescription(e.sdpanswer),t.receivedSdpOfferMessage=e.sdpanswer,t.pc.setRemoteDescription(r,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")),this.setStatus("You are connected to :"+e.calleeId),t.screenSharing===!0&&(s="screenSharing"),this.myWebRTC_Event.createCallEstablishedEvent(e.calleeId,s)},this.processCandidate=function(e){var t=null,n=null;t=e.callerId===this.clientId?this.findCallWithCallIdAndRemoteId(e.callId,e.calleeId):this.findCallWithCallIdAndRemoteId(e.callId,e.callerId),null!==t?t.started?null!==t.pc?(n=new this.myWebRTC_Adapter.RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate}),t.pc.addIceCandidate(n)):console.log("Error, call is not null but pc is null"):console.log("Call not started"):console.log("Call not found, Candidate message is not handeled")},this.processUpdate=function(e){console.log("Update message on:"+e.roomId);var t=null,n=null;return t=e.callerId===this.clientId?this.findCallWithCallIdAndRemoteId(e.callId,e.calleeId):this.findCallWithCallIdAndRemoteId(e.callId,e.callerId),null===t?void this.myWebRTC_Event.createErrorEvent("Cannot find call to process Update","CALL_NOT_FOUND_ON_UPDATE"):(n=new this.myWebRTC_Adapter.RTCSessionDescription(e.sdpoffer),console.log("remoteDesc"+n),t.pc.setRemoteDescription(n,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")),void t.doUpdateAnswer())},this.process200Update=function(e){console.log("200 Update received from :"+e.calleeId),this.setStatus("You are connected to :"+e.calleeId);var t=null,n=null;return t=this.findCallWithRoomId(e.roomId),null===t?void this.myWebRTC_Event.createErrorEvent("Cannot find call to process 200 Update","CALL_NOT_FOUND_ON_200UPDATE"):(t.calleeId=e.calleeId,t.pc.setLocalDescription(t.sendedSdpOfferMessage,this.callback(this,"onSetLocalDescriptionSuccess"),this.callback(this,"onSetLocalDescriptionFailure")),n=new this.myWebRTC_Adapter.RTCSessionDescription(e.sdpanswer),console.log("Avant setRemote sur Answer"+n),t.pc.setRemoteDescription(n,this.callback(this,"onSetRemoteDescriptionSuccess"),this.callback(this,"onSetRemoteDescriptionFailure")),void(this.addingUserMedia===!0&&(console.log("adding localvideo in mini"),this.miniVideo&&(this.miniVideo.style.opacity=1),this.addingUserMedia=!1)))},this.onHangup=function(){this.setStatus("<div>Your phone is registered, you can be joigned with this number : "+this.clientId+"</div>"),console.log("Hanging up."),this.initMediaElementState(),console.log("Leaving all calls that are established"),this.myWebRTC_Event.createHangupEvent("local",this.clientId,0,!0,"Hangup"),this.removeAllCalls(),this.displayCallButtonInCommand()},this.removeAllCalls=function(){console.log("removeAllCalls");var e=this.callsTable.length,t=0,n=0,i=null,o=null,r=0;for(console.log("callsNumber = "+e),t=0;e>t;t+=1){if(n=0,n=this.callsTable[t-r].callee?this.callsTable[t-r].callerId:this.callsTable[t-r].calleeId,this.callsTable[t-r].callee===!0)o="Hangup_From_Callee",this.callsTable[t-r].myWebRTC_Stack.sendBye(this.callsTable[t-r].callId,this.clientId,this.callsTable[t-r].dest_roomId,n,o);else{if(o="Hangup_From_Caller",this.callsTable[t-r].inviteSended!==!0){this.callsTable[t-r].callCancelled=!0,console.warn("Leaving call iteration on removeAllCalls");continue}this.callsTable[t-r].myWebRTC_Stack.sendBye(this.callsTable[t-r].callId,this.clientId,this.callsTable[t-r].dest_roomId,n,o)}null!==this.callsTable[t-r].callLocalStream&&(console.log("Stopping call local Stream"),this.callsTable[t-r].generatedLocalStream===!0?console.log("This is a created MediaStream"):this.autoAnswer===!1&&(console.log("Stopping call local Stream"),this.callsTable[t-r].callLocalStream.stop())),null!==this.callsTable[t-r].pc&&(console.log("Closing PC"),this.qosEnable&&"undefined"!=typeof this.callsTable[t-r].qm&&(this.callsTable[t-r].qm.saveStatsToDb(!0),clearInterval(this.callsTable[t-r].statisticId)),this.callsTable[t-r].pc.close(),this.callsTable[t-r].pc=null),i=this.callsTable[t-r].callId+"-"+this.callsTable[t-r].calleeId,this.removeRemoteVideoDisplay(i),console.log("Removing call from table"),this.callsTable.splice(t-r,1),r+=1}},this.onRemoteHangup=function(e,n,i,o){console.log("onRemoteHangup"),this.removeCallFromTableWithCallIdandRemoteId(e,n,o),console.log("Reason : "+o),o===t?this.setStatus("<div>Your partner : "+n+" have left the call. You can be joigned with this number : "+this.clientId+"</div>"):(this.setStatus("<div>Call hangup with reason : "+o+". You can be joigned with this number : "+this.clientId+"</div>"),console.log("Remote Hangup for reason : "+o)),0===this.callsTable.length?(console.log("No more established calls for client"),this.initMediaElementState(),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,n,!0,o),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,n,!0,o),this.displayCallButtonInCommand(),this.getUserMediaOnGoing===!0&&(console.log("Cancel from Remote"),location.reload(),this.getUserMediaOnGoing=!1)):(console.log("Other calls are still established"),this.myWebRTC_Event.createRemoteHangupEvent(this.clientId,n,!1,o),this.myWebRTC_Event.createHangupEvent("remote",this.clientId,n,!1,o))},this.removeCallFromTableWithCallIdandRemoteId=function(e,t,n){console.log("removeCallFromTableWithCallIdandRemoteId() with reason :"+n);var i=0,o=null,r=0;i=this.findCallIndexWithCallIdAndRemoteId(e,t),-1!==i?(console.log("Session terminated."),null!==this.callsTable[i].callLocalStream&&(this.callsTable[i].generatedLocalStream===!0?console.log("This is a created MediaStream"):this.autoAnswer===!1&&(console.log("Stopping call local Stream"),this.callsTable[i].callLocalStream.stop())),null!==this.callsTable[i].pc&&(console.log("Closing PC"),this.qosEnable&&"undefined"!=typeof this.callsTable[i].qm&&(this.callsTable[i].qm.saveStatsToDb(!0),clearInterval(this.callsTable[i].statisticId)),this.callsTable[i].pc.close(),this.callsTable[i].pc=null),o=this.callsTable[i].callId+"-"+this.callsTable[i].calleeId,this.removeRemoteVideoDisplay(o),console.log("Removing call from table"),this.callsTable.splice(i,1),console.log("Call is terminated"),r=this.callsTable.length,0!==r&&this.myWebRTC_Adapter.attachMediaStream(this.miniVideo,this.callsTable[0].callLocalStream)):console.log("No call removed")},this.transitionToActive=function(){console.log("transitionToActive"),this.remoteVideo&&(this.remoteVideo.style.opacity=1),setTimeout(this.callback(this,"callback2"),1e3)},this.callback2=function(){this.miniVideo&&(this.miniVideo.style.opacity=1)},this.initMediaElementState=function(){this.autoAnswer===!1?this.localVideo&&(this.localVideo.style.opacity=0,this.localVideo.src=""):this.localVideo&&(this.localVideo.style.opacity=1),this.remoteVideo&&(this.remoteVideo.style.opacity=0,this.remoteVideo.src=""),this.miniVideo&&(this.miniVideo.style.opacity=0),this.autoAnswer===!0?console.log("autoAnswer Activated : localStream is not stopped"):this.miniVideo&&(this.miniVideo.src="")},this.toggleVideoMute=function(){console.log("toggleVideoMute");var e=0,t=this.callsTable.length;if(this.isVideoMuted)for(null!==this.localStream&&this.unMuteTracks(this.localStream.getVideoTracks()),e=0;t>e;e+=1)null!==this.callsTable[e].callLocalStream&&this.unMuteTracks(this.callsTable[e].callLocalStream.getVideoTracks());else for(null!==this.localStream&&this.muteTracks(this.localStream.getVideoTracks()),e=0;t>e;e+=1)null!==this.callsTable[e].callLocalStream&&this.muteTracks(this.callsTable[e].callLocalStream.getVideoTracks());this.isVideoMuted=!this.isVideoMuted},this.unMuteTracks=function(e){var t=0;if(0===e.length)return void console.log("No tracks available.");for(t=0;t<e.length;t+=1)e[t].enabled=!0;console.log("tracks unMuted.")},this.muteTracks=function(e){var t=0;if(0===e.length)return void console.log("No tracks available.");for(t=0;t<e.length;t+=1)e[t].enabled=!1;console.log("tracks muted.")},this.toggleAudioMute=function(){console.log("toggleAudioMute");var e=0,t=this.callsTable.length;if(this.isAudioMuted)for(null!==this.localStream&&this.unMuteTracks(this.localStream.getAudioTracks()),e=0;t>e;e+=1)null!==this.callsTable[e].callLocalStream&&this.unMuteTracks(this.callsTable[e].callLocalStream.getAudioTracks());else for(null!==this.localStream&&this.muteTracks(this.localStream.getAudioTracks()),e=0;t>e;e+=1)null!==this.callsTable[e].callLocalStream&&this.muteTracks(this.callsTable[e].callLocalStream.getAudioTracks());this.isAudioMuted=!this.isAudioMuted},this.xhr=function(e,t,n,i){var o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&200==o.status&&n(o.responseText)},"undefined"!=typeof i&&(o.upload.onprogress=i),o.open("POST",e),o.send(t)},this.takeSnapshot=function(e,n,o,r,s,a){console.log("takeSnapshot");var u=null,d=null,h=document.createElement("canvas"),p=0,f=null,g=null,m=new Date,v=m.toJSON(),b=v.replace(new RegExp(":","g"),"-");switch(r){case"Desactivated":p=0;break;case"Low":p=2;break;case"Medium":p=4;break;case"High":p=6;break;default:console.log("blurLevel not defined switch case : "+r)}h.width=this.localVideo.clientWidth,h.height=this.localVideo.clientHeight,console.log("snapshot.width : "+h.width),console.log("snapshot.height :"+h.height),u=h.getContext("2d"),u.drawImage(this.localVideo,0,0,h.width,h.height),d=document.createElement("img"),d.src=h.toDataURL("image/png"),d.style.padding=5,d.width=h.width,d.height=h.height,0!==p?(f=u.getImageData(0,0,h.width,h.height),console.log("av pixels data : "+f.data),f=i(d,f,p),console.log("ap pixels data : "+f.data),u.putImageData(f,0,0),d.src=h.toDataURL("image/png")):console.log("blur on photo is desactivated"),"object"==typeof n?null!==n?n.src=d.src:console.log("localPhotoIdOrDiv is null"):null!==document.getElementById(n)?document.getElementById(n).src=d.src:console.log("localPhotoId is not defined"),g=new FormData,s!==t?(console.log("sessionId !== undefined :"+s),g.append("destFileName",this.clientId+"-"+b+".png"),g.append("data",h.toDataURL("image/png")),g.append("sessionId",s)):(console.log("Upload on data1"),g.append("photo",h.toDataURL("image/png")),g.append("clientId",this.clientId),g.append("apiKey",c.session.apiKey)),this.xhr(e,g,function(e){if(console.log("fileName :"+e),"Photo received"!==e||"An error occurred."!==e)try{var t=JSON.parse(e);console.log("files loaded, filename :"+t.fileUrl),l.createSnapShotPhotoUploaded(t.fileUrl)}catch(n){console.log("Parsing error:",n)}},a)},this.callWithNumber=function(e,t){console.log("Click on Call Button, video activated : "+t);var n=null,i=0;i=this.callsTable.length,0===i?""!==e&&e!==this.clientId?(this.setStatus("Calling Destination number :"+e),n=new p(this),console.log("Calling destination number :"+e),n.generateCallId(),n.callerId=this.clientId,n.calleeId=e,n.dest_roomId=e,n.audioOnly=!t,this.accessToLocalMedia===!0&&this.autoAnswer===!0?(console.log("User has already granted access to local media and AutoAnswer activated : establishing call"),n.establishCall()):n.getUserMediaOnCall(),i=this.callsTable.push(n),console.log("Call Number is :"+i),this.autoAnswer===!0&&this.displayHangUpButtonInCommand()):(this.setStatus("Dialed call number is not correct :"+e+".You can be joigned with this number : "+this.clientId),console.log("Call Number is incorrect")):console.log("User is already calling, cannot call a second destination")},this.extensionInstallationSuccessCallback=function(){console.log("extensionInstallationSuccessCallback"),c.session.apiCCWebRTCClient.webRTCClient.apiRTCExtensionInstalled=!0},this.extensionInstallationFailureCallback=function(){console.log("extensionInstallationFailureCallback"),l.createDesktopCaptureEvent("Extension_installation_Error")},this.shareScreen=function(t){if(console.log("shareScreen"),"chrome"===this.myWebRTC_Adapter.webrtcDetectedBrowser){if(this.apiRTCExtensionInstalled===!1)return this.setStatus("ApiRTC extension need to be installed to enable screen sharing.<br>You can be joigned with this number : "+this.clientId),console.warn("apiRTC extension not installed"),l.createDesktopCaptureEvent("Extension_not_installed"),chrome.webstore.install("https://chrome.google.com/webstore/detail/mjjnofoemoepfididplbfimokpnpcoeg",this.callback(this,"extensionInstallationSuccessCallback"),this.callback(this,"extensionInstallationFailureCallback")),void(this.waitingShareScreenDestNumber=t);""!==t&&t!==this.clientId?e.postMessage({command:"getDesktopId",callNumber:t},"*"):(this.setStatus("Dialed call number is not correct :"+t+".You can be joigned with this number : "+this.clientId),console.log("Call Number is incorrect"))}else console.log("shareScreen is only available for chrome Browser"),l.createDesktopCaptureEvent("Browser_Not_Compatible")},this.callbymail=function(e){console.log("Click on Call per mail Button"),o(e)?(console.log("Calling Destination mail :"+e),this.socket.emit("webrtc_invite_permail",e),n.channel.socket.emit("webrtc_invite_permail",e)):console.log("Mail address is not correct :"+e)},this.callperURL=function(e){console.log("Call per URL");var t=null,n=0;t=new p(this),console.log("Calling Destination number :"+e),t.generateCallId(),t.callerId=this.clientId,t.calleeId=e,t.dest_roomId=e,t.audioOnly=!1,t.getUserMediaOnCall(),n=this.callsTable.push(t),console.log("Call Number is :"+n)},this.acceptCall=function(e){console.log("acceptCall for callId :"+e);var t=null;t=this.findCallWithCallId(e),null!==t?(console.log("Call found"),this.accessToLocalMedia===!0?(console.log("User has already granted access to local media and AutoAnswer activated : establishing call"),t.establishCall()):t.getUserMediaOnCall()):console.log("Call not found")},this.refuseCall=function(e,n){console.log("refuseCall for callId :"+e);var i=null,o=null;o=n!==t?n:"User_Refuse_Call",i=this.findCallWithCallId(e),null!==i?(console.log("Call found"),i.myWebRTC_Stack.sendBye(i.callId,i.calleeId,i.dest_roomId,i.callerId,o),this.removeCallFromTableWithCallIdandRemoteId(i.callId,i.callerId,o),0===this.callsTable.length&&(console.log("No more established calls for client"),this.initMediaElementState())):console.log("Call not found")},this.addMedia=function(e){console.log("addMedia for callId :"+e),this.addingUserMedia=!0;var t=null;t=this.findCallWithCallId(e),null!==t&&(this.accessToLocalMedia===!0&&this.autoAnswer===!0?(console.log("User has already granted access to local media and AutoAnswer activated : establishing call"),t.establishCall()):t.getUserMediaOnCall())},this.findCallWithRoomId=function(e){var t=0,n=this.callsTable.length;for(t=0;n>t;t+=1)if(this.callsTable[t].dest_roomId===e)return this.callsTable[t];return console.log("Call not found"),null},this.findCallIndexWithCallIdAndRemoteId=function(e,t){var n=0,i=this.callsTable.length;for(n=0;i>n;n+=1)if(this.callsTable[n].callId==e&&(this.callsTable[n].callee===!0&&this.callsTable[n].callerId==t||this.callsTable[n].callee===!1&&this.callsTable[n].calleeId==t))return console.log("Call found with callId and remoteId"),n;return console.log("Call not found"),-1},this.findCallWithCallId=function(e){var t=0,n=this.callsTable.length;for(console.log("callsNumber :"+n),t=0;n>t;t+=1)if(console.log("this.callsTable[i].callId :"+this.callsTable[t].callId),this.callsTable[t].callId==e)return this.callsTable[t];return console.log("Call not found"),null},this.findCallWithCallIdAndRemoteId=function(e,t){var n=0,i=this.callsTable.length;for(console.log("callsNumber :"+i),n=0;i>n;n+=1)if(this.callsTable[n].callId===e&&(this.callsTable[n].callee===!0&&this.callsTable[n].callerId==t||this.callsTable[n].callee===!1&&this.callsTable[n].calleeId==t))return this.callsTable[n];return console.log("Call not found"),null},this.findCallWithRemoteId=function(e){console.log("findCallWithRemoteId");var t=0,n=this.callsTable.length;for(console.log("callsNumber :"+n),t=0;n>t;t+=1)if(this.callsTable[t].callee===!0&&this.callsTable[t].callerId==e||this.callsTable[t].callee===!1&&this.callsTable[t].calleeId==e)return console.log("Call found with remoteId"),this.callsTable[t];return console.log("Call not found"),null},this.remoteVideoDisplayManager=function(){console.log("remoteVideoDisplayManager");var t=0,n=null,i=0,o=0,r=0,s=0,a=.75*s,l=0,c=0;for(this.remoteVideo&&(0===this.maxWidthRemoteVideo&&(this.maxWidthRemoteVideo=this.remoteVideo.clientWidth),0===this.maxHeightRemoteVideo&&(this.maxHeightRemoteVideo=this.remoteVideo.clientHeight),n=this.remoteVideo.children,i=n.length,o=this.maxWidthRemoteVideo,r=this.maxHeightRemoteVideo,console.log("maxWidth"+o),console.log("maxHeight"+r),s=this.remoteVideo.clientWidth,a=.75*s),s>o&&(s=o),s/=i,a=.75*s,a>r&&(a=r,s=4/3*a),l=s/o*100,c=a/r*100,l+="%",c+="%",console.log("widthinPercent"+l),console.log("heightinPercent"+c),t=0;i>t;t+=1)n[t].style.cssText="width:"+l+";height:"+c+";";a=e.innerHeight-a-60},this.removeRemoteVideoDisplay=function(e){console.log("removeRemoteVideoDisplay with callId ="+e);var t="callId_"+e,n=0,i=null,o=0;for(this.remoteVideo&&(i=this.remoteVideo.children,o=i.length),n=0;o>n;n+=1)if(i[n].id===t)return this.remoteVideo.removeChild(i[n]),void console.log("VideoDisplay removed for "+t);this.remoteVideoDisplayManager()},this.setStatus=function(e){null!==this.statusDiv?this.statusDiv.innerHTML=e:console.log("Status Div Null")},this.displayCallButtonInCommand=function(){if(null!==this.commandDiv){var e='<input type="texte" name="mail" value="" placeholder="Enter Destination number..."><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.call(document.forms.form1.mail.value);"><img src="http://www.apizee.com/Demo/images/Call.png" height="30px"></a></input>';this.commandDiv.innerHTML='<form name="form1" action="">'+e+"</form>"}},this.displayHangUpButtonInCommand=function(){console.log("displayHangUpButtonInCommand"),null!==this.commandDiv&&(this.commandDiv.innerHTML='<a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleAudioMute()"> <img src="http://www.apizee.com/Demo/images/Microphone.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.toggleVideoMute();"> <img src="http://www.apizee.com/Demo/images/Camera2.png" height="30px" disabled="true"></a><a href="#" onClick = "apiCC.session.apiCCWebRTCClient.hangUp()"> <img src="http://www.apizee.com/Demo/images/Hangup.png" height="30px" disabled="true"> </a>')},this.checkURLForCallDestination=function(){var e=0;return"room"===location.search.substring(1,5)&&(console.log("Call establishment using URL"),e=location.search.substring(6),console.log("Destination call number is :"+e)),e},this.releaseUserMedia=function(){console.log("releaseUserMedia"),null!==this.localStream&&(console.log("stopping localStream"),this.localStream.stop(),this.localStream=null,this.accessToLocalMedia=!1,this.autoAnswer=!1,console.log("this.autoAnswer :"+this.autoAnswer))},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler}},c.ApiCCIMClient=function(e,t){console.log("apiCC.ApiCCIMClient"),this.convTable=[],this.myWebRTC_Event=new a,this.nickname=e.nickname,this.photoURL=null,this.userDataSetted=!1,this.findIMIdWithDestID=function(e){var t=0,n=this.convTable.length;for(console.log("findIMIdWithDestID = "+e),t=0;n>t;t+=1)if(console.log("this.convTable[i].dest_roomId = "+this.convTable[t].dest_roomId),this.convTable[t].dest_roomId==e)return this.convTable[t].IMId;return console.log("Conversation IMId not found"),0},this.addInConvTable=function(e){console.log("addInConvTable");var t=0,n=this.convTable.length;for(t=0;n>t;t+=1)if(console.log("this.convTable[i].dest_roomId = "+this.convTable[t].dest_roomId),this.convTable[t].dest_roomId==e.dest_roomId)return void(this.convTable[t].IMId=e.IMId);console.log("Conversation not found in the table, adding .."),this.convTable.push(e)},this.sendMessage=function(t,n){console.log("Call sending message function .... from :"+this.nickname+" message :"+n);var i=this.findIMIdWithDestID(t),o=null,r=null,s=null;console.log(0===i?"Creation of a new IM conversation":"Message is for existing conversation with ID : "+i),console.log("IMConvId :"+i),o={type:"IMMessage",IMId:i,senderId:e.apiCCId,nickname:this.nickname,photoURL:this.photoURL,dstRoomId:t,data:n},r=JSON.stringify(o),s=document.createElement("message"),console.log("C->S: "+r),e.channel.socket.emit("IMMessage",r),null!==this.conversation&&(s.innerHTML="<b>me :</b> "+n+"<br>",this.conversation.appendChild(s),this.conversation.scrollTop=this.conversation.scrollHeight)},this.newConversationCreated=function(e){console.log("newConversationCreated :"+e),console.log("msg.dstRoomId :"+e.dstRoomId),console.log("msg.IMId :"+e.IMId);var t={dest_roomId:e.dstRoomId,IMId:e.IMId};this.addInConvTable(t)},this.receiveMessage=function(e){console.log("Call receiveMessage message :"+e);var t=null,n=null;n={dest_roomId:e.senderId,IMId:e.IMId},this.addInConvTable(n),null!==this.conversation&&(t=document.createElement("message"),t.innerHTML="<b>"+e.nickname+":</b> "+e.data+"<br>",this.conversation.appendChild(t),this.conversation.scrollTop=this.conversation.scrollHeight),this.myWebRTC_Event.createReceiveIMMessageEvent(e.senderId,e.nickname,e.photoURL,e.data)},this.createGroupChat=function(t,n){console.log("createGroupChat with contacts : "+t+","+n);var i=null,o=null;i={type:"createGroupChat",nickname:this.nickname,photoURL:this.photoURL,contactId1:t,contactId2:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("createGroupChat",o)},this.groupChatCreation=function(e){console.log("groupChatCreation"),this.myWebRTC_Event.createGroupChatCreationEvent(e.status,e.groupChatId,e.contactId1,e.invitationSendedToInitialDestId,e.contactId2,e.invitationSendedToNewContactId)},this.joinGroupChat=function(t){console.log("joinGroupChat : "+t);var n=null,i=null;n={type:"joinGroupChat",groupChatId:t},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("joinGroupChat",i)},this.groupChatInvitation=function(e){console.log("groupChatInvitation"),this.myWebRTC_Event.createGroupChatInvitationEvent(e.groupChatId,e.senderId,e.senderNickname,e.senderPhotoURL,e.contactList)},this.answerToGroupChatInvitation=function(t,n){if(console.log("answerToGroupChatInvitation: "+t+" : "+n),n===!0||n===!1){var i=null,o=null;i={type:"groupChatInvitationAnswer",groupChatId:t,senderId:e.apiCCId,nickname:this.nickname,photoURL:this.photoURL,accept:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("groupChatInvitationAnswer",o)}else console.log("accept value is not correct")},this.groupChatMemberUpdate=function(e){console.log("groupChatMemberUpdate"),this.myWebRTC_Event.createGroupChatMemberUpdateEvent(e.groupChatId,e.contactList,e.status)},this.addUserInGroupChat=function(t,n){console.log("addUser : "+n+"in Group Chat with Id :"+t);var i=null,o=null;i={type:"addUserInGroupChat",groupChatId:t,nickname:this.nickname,photoURL:this.photoURL,contactId:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("addUserInGroupChat",o)},this.addUserInGroupChatAnswer=function(e){console.log("addUserInGroupChatAnswer"),this.myWebRTC_Event.createAddUserInGroupChatEvent(e.invitationSended,e.groupChatId,e.contactId)},this.leaveGroupChat=function(t){console.log("Leave Group Chat with Id :"+t);var n=null,i=null;n={type:"leaveGroupChat",groupChatId:t,nickname:this.nickname,photoURL:this.photoURL},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("leaveGroupChat",i)},this.sendMessageToGroupChat=function(t,n){console.log("Call sending message to Group Chat .... from :"+this.nickname+" message :"+n);var i=null,o=null;i={type:"groupChatMessage",groupChatId:t,senderId:e.apiCCId,nickname:this.nickname,data:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("groupChatMessage",o)},this.receiveGroupChatMessage=function(e){console.log("receiveGroupChatMessage"),this.myWebRTC_Event.createReceiveGroupChatMessageEvent(e.groupChatId,e.senderId,e.nickname,e.data)},this.getConversationHistory=function(t){console.log("getConversationHistory");var n=null,i=null;n={type:"getConversationHistory",convId:t},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("getConversationHistory",i)},this.receiveConversationHistory=function(e){console.log("receiveConversationHistory"),console.log("msg.convId :"+e.convId);var t=0,n=0,i=[],o=null;if(null!==e.convHistory)for(console.log("msg.convHistory.length :"+e.convHistory.length),n=e.convHistory.length,i=[],t=0;n>t;t+=1)o=JSON.parse(e.convHistory[t]),i.push(o);this.myWebRTC_Event.createReceiveConversationHistoryEvent(e.convId,i,e.status)},this.setUserData=function(t){console.log("setUserData"),this.photoURL=t.photoURL,e.photoURL=t.photoURL,console.log("photoURL :"+this.photoURL);var n=null,i=null;n={type:"setUserData",nickname:this.nickname,photoURL:this.photoURL},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("setUserData",i),this.userDataSetted=!0},this.getUserData=function(t){console.log("getUserData");var n=null,i=null;n={type:"getUserData",contactId:t},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("getUserData",i)},this.receiveUserDataAnswer=function(e){console.log("receiveUserDataAnswer"),this.myWebRTC_Event.createUserDataAnswerEvent(e.userFound,e.contactId,e.nickname,e.photoURL)},this.initialize=function(t){var n=null,i=null;console.log("conversationElementId :"+t),this.conversation=document.getElementById(t),null===this.conversation&&(this.myWebRTC_Event.createErrorEvent("conversationElementId Div Name is not correct","INCORRECT_DIV_NAME_CONVERSATION"),console.log("conversationElementId is null")),n={type:"registerIM",username:this.nickname},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("registerIM",i)},this.initialize(t)},c.ApiCCDataClient=function(e){console.log("apiCC.ApiCCDataClient"),this.sendData=function(t,n){console.log("Call sending data function .... to :"+t+" message :"+n);var i=null,o=null;i={type:"dataMessage",senderId:e.apiCCId,dstRoomId:t,data:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("dataMessage",o)},this.receiveData=function(e){console.log("receiveData :"+e.data),l.createReceiveDataEvent(e.senderId,e.dstRoomId,e.data)}},C=function(e,t){console.log("RoomManager"),this.createRoom=function(t){console.log("RoomManager:createRoom with roomType : "+t);var n=null,i=null;n={type:"createRoom",roomType:t,nickname:e.nickname,photoURL:e.photoURL},i=JSON.stringify(n),console.log("C->S: "+i),e.channel.socket.emit("createRoom",i)},this.roomCreation=function(e){console.log("RoomManager:roomCreation"),t(e)},this.inviteInRoom=function(t,n,i){console.log("RoomManager:inviteInRoom with roomType : "+i);var o=null,r=null;o={type:"inviteInRoom",roomId:t,contactId:n,roomType:i,nickname:e.nickname,photoURL:e.photoURL},r=JSON.stringify(o),console.log("C->S: "+r),e.channel.socket.emit("inviteInRoom",r)},this.inviteInRoomStatus=function(e){console.log("inviteInRoomStatus"),t(e)},this.roomInvitation=function(e){console.log("roomInvitation :"+e),t(e)},this.answerToRoomInvitation=function(t,n,i){if(console.log("answerToRoomInvitation: "+t+" : "+n),n===!0||n===!1){var o=null,r=null;o={type:"roomInvitationAnswer",roomId:t,senderId:e.apiCCId,nickname:e.nickname,photoURL:e.photoURL,accept:n,roomType:i},r=JSON.stringify(o),console.log("C->S: "+r),e.channel.socket.emit("roomInvitationAnswer",r)}else console.log("accept value is not correct")},this.roomMemberUpdate=function(e){console.log("roomMemberUpdate"),t(e)},this.sendMessageToRoom=function(t,n,i){console.log("Call sending message to Room .... from :"+e.apiCCId+" message :"+i);var o=null,r=null;o={type:"roomMessage",roomId:t,senderId:e.apiCCId,nickname:e.nickname,roomType:n,data:i},r=JSON.stringify(o),console.log("C->S: "+r),e.channel.socket.emit("roomMessage",r)},this.receiveRoomMessage=function(e){console.log("receiveRoomMessage"),t(e)},this.leaveRoom=function(t,n){console.log("Leave Room with Id :"+t);var i=null,o=null;i={type:"leaveRoom",roomId:t,nickname:e.nickname,photoURL:e.photoURL,roomType:n},o=JSON.stringify(i),console.log("C->S: "+o),e.channel.socket.emit("leaveRoom",o)}},c.ApiCCWhiteBoardClient=function(e,t,n,i){function o(e){var t=1,n=setInterval(function(){.1>=t&&(clearInterval(n),e.style.display="none"),e.style.opacity=t,e.style.filter="alpha(opacity="+100*t+")",t-=.1*t},50)}console.log("apiCC.ApiCCWhiteBoardClient"),this.roomId=null,this.createRoom=function(){console.log("createRoom()"),e.roomMgr.createRoom("whiteBoard");

},this.inviteInRoom=function(t,n){console.log("inviteInRoom()"),e.roomMgr.inviteInRoom(t,n,"whiteBoard")},this.answerToRoomInvitation=function(t,n){console.log("answerToRoomInvitation()"),e.roomMgr.answerToRoomInvitation(t,n,"whiteBoard")},this.leaveRoom=function(t){console.log("leaveRoom()"),e.roomMgr.leaveRoom(t,"whiteBoard")},this.clearPaper=function(){console.log("clearPaper()");var e=this.canvas.width;this.canvas.width=e},this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.drawLine=function(e,t,n,i){this.ctx.moveTo(e,t),this.ctx.lineTo(n,i),this.ctx.stroke()},this.getContext=function(){return this.ctx},this.loadPhotoInBackground=function(e){console.log("loadPhotoInBackground :"+e);var t=document.getElementsByTagName("body")[0];t.style.backgroundImage="url("+e+")",t.style.backgroundPosition="50% 50%",t.style.backgroundRepeat="no-repeat"},this.messageProcessing=function(e){console.log("messageProcessing :"+e);var t=null,i=null,o=null;e.id in this.clients||(console.log("creating cursor for new user : "+e.id),t=document.createElement("div"),t.className="cursor",t.id="cursorId"+e.id,this.cursors[e.id]=t,i=document.getElementById(n),i.appendChild(t)),this.cursors[e.id].style.left=e.x,this.cursors[e.id].style.top=e.y,e.drawing&&this.clients[e.id]&&(this.drawLine(this.clients[e.id].x,this.clients[e.id].y,e.x,e.y),"undefined"!=typeof focusOnDrawing&&(o=this.canvas.parentNode,o.scrollLeft=e.x-o.clientWidth/2,o.scrollTop=e.y-o.clientHeight/2)),this.clients[e.id]=e},this.start=function(){console.log("starting WhiteBoardClient");var t=!1,n={},r=0;this.clients={},this.cursors={},this.canvas.onmousedown=function(e){e.preventDefault(),t=!0,n.x=e.offsetX,n.y=e.offsetY;var r=document.getElementById(i);null!==r&&o(r)},this.canvas.onmouseup=function(){t=!1},this.canvas.onmouseleave=function(){t=!1},r=Date.now(),this.canvas.onmousemove=function(i){if(Date.now()-r>30){var o={x:i.offsetX,y:i.offsetY,drawing:t,id:c.session.apiCCId};e.roomMgr.sendMessageToRoom(c.session.apiCCWhiteBoardClient.roomId,"whiteBoard",o),r=Date.now()}t&&(c.session.apiCCWhiteBoardClient.drawLine(n.x,n.y,i.offsetX,i.offsetY),n.x=i.offsetX,n.y=i.offsetY)}},this.stop=function(){console.log("Stopping WhiteBoardClient"),this.canvas.onmousedown=null,this.canvas.onmouseup=null,this.canvas.onmouseleave=null,this.canvas.onmousemove=null}},c.ApiCCCoBrowsingClient=function(e){console.log("apiCC.ApiCCCoBrowsingClient"),this.createRoom=function(){console.log("createRoom()"),e.roomMgr.createRoom("coBrowsing")},this.inviteInRoom=function(t,n){console.log("inviteInRoom()"),e.roomMgr.inviteInRoom(t,n,"coBrowsing")},this.answerToRoomInvitation=function(t,n){console.log("answerToRoomInvitation()"),e.roomMgr.answerToRoomInvitation(t,n,"coBrowsing")},this.leaveRoom=function(t){console.log("leaveRoom()"),e.roomMgr.leaveRoom(t,"coBrowsing")}},c.ApiCCWebRTCClient=function(e,t,n,i,o,r){console.log("apiCC.ApiCCWebRTCClient"),this.myWebRTC_Event=new a,this.webRTCClient=new f(e),this.webRTCClient.channelReady=!0,this.webRTCClient.initialize(t,n,i,o,r),this.call=function(e){this.webRTCClient.callWithNumber(e,!0)},this.activateScreenSharing=function(){this.webRTCClient.activateScreenSharing()},this.shareScreen=function(e){this.webRTCClient.shareScreen(e,!0)},this.callAudio=function(e){this.webRTCClient.callWithNumber(e,!1)},this.callbymail=function(e){this.webRTCClient.callbymail(e)},this.addMedia=function(e){this.webRTCClient.addMedia(e)},this.hangUp=function(){this.webRTCClient.onHangup()},this.getMyMedia=function(){this.webRTCClient.getUserMedia()},this.autoAnswerUserMediaSuccessHandler=function(e){this.webRTCClient.autoAnswer=!0},this.autoAnswerUserMediaErrorHandler=function(e){this.webRTCClient.autoAnswer=!1},this.activateAutoAnswer=function(){c.addEventListener("userMediaSuccess",this.callback(this,"autoAnswerUserMediaSuccessHandler")),c.addEventListener("userMediaError",this.callback(this,"autoAnswerUserMediaErrorHandler")),this.webRTCClient.getUserMedia()},this.getAutoAnswer=function(){return this.webRTCClient.autoAnswer},this.setUnidirectionalCall=function(e){e===!0||e===!1?this.webRTCClient.unidirectionelCallOnly=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUnidirectionalCall()","PARAMETER_ERROR_SETUNIDIRCALL")},this.getUnidirectionalCall=function(){return this.webRTCClient.unidirectionelCallOnly},this.toggleVideoMute=function(){this.webRTCClient.toggleVideoMute()},this.isVideoMuted=function(){return this.webRTCClient.isVideoMuted},this.toggleAudioMute=function(){this.webRTCClient.toggleAudioMute()},this.isAudioMuted=function(){return this.webRTCClient.isAudioMuted},this.setNtoNConf=function(e){e===!0||e===!1?this.webRTCClient.NtoNConf=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setNtoNConf()","PARAMETER_ERROR_SETNTONCONF")},this.getNtoNConf=function(){return this.webRTCClient.NtoNConf},this.setRTPMedia=function(e){e===!0||e===!1?this.webRTCClient.RTPMedia=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setRTPMedia()","PARAMETER_ERROR_SETRTPMEDIA")},this.getRTPMedia=function(){return this.webRTCClient.RTPMedia},this.setMediaRoutingMode=function(e){"hostOnly"===e?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.hostOnly:"stun"===e?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.stun:"turn"===e?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turn:"turnOnly"===e?this.webRTCClient.mediaRoutingMode=this.webRTCClient.mediaRoutingModeEnum.turnOnly:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setMediaRoutingMode()","PARAMETER_ERROR_SETMEDIAROUTINGMODE")},this.enableQos=function(e){console.log("this.enableQos="+e),this.webRTCClient.qosEnable=e},this.getMediaRoutingMode=function(){var e=null;return this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.hostOnly?e="hostOnly":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.stun?e="stun":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turn?e="turn":this.webRTCClient.mediaRoutingMode===this.webRTCClient.mediaRoutingModeEnum.turnOnly&&(e="turnOnly"),e},this.takeSnapshot=function(t,n,i,o,r){this.webRTCClient.takeSnapshot(t,n,e.apiKey,i,o,r)},this.setUserAcceptOnIncomingCall=function(e){e===!0||e===!1?this.webRTCClient.userAcceptOnIncomingCall=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setUserAcceptOnIncomingCall()","PARAMETER_ERROR_SETUSERACCEPTONINCOCALL")},this.setHideLocalVideoOnCall=function(e){e===!0||e===!1?this.webRTCClient.hideLocalVideoOnCall=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : hideLocalVideoOnCall()","PARAMETER_ERROR_SETHIDELOCALVIDEOONCALL")},this.setAllowMultipleCalls=function(e){e===!0||e===!1?this.webRTCClient.allowMultipleCalls=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setAllowMultipleCalls()","PARAMETER_ERROR_SETALLOWMULTIPLECALLS")},this.setPcConfig=function(e){console.log("Setting PC_config to :"+e),this.webRTCClient.pc_config=e},this.setPcConstraints=function(e){console.log("Setting PC_constraints to :"+e),this.webRTCClient.pc_constraints=e},this.setTrickleIce=function(e){console.log("Setting trickleIce to :"+e),e===!0||e===!1?this.webRTCClient.trickleIce=e:this.myWebRTC_Event.createErrorEvent("parameter error when calling function : setTrickleIce()","PARAMETER_ERROR_SETTRICKLEICE")},this.acceptCall=function(e){this.webRTCClient.acceptCall(e)},this.refuseCall=function(e){this.webRTCClient.refuseCall(e)},this.releaseUserMedia=function(){this.webRTCClient.releaseUserMedia()},this.createMCUSession=function(e,t){console.log("createMCUSession"),this.webRTCClient.MCUClient.TBLibIsLoaded===!1?$LAB.script(function(){return"//static.opentok.com/webrtc/v2.2/js/opentok.min.js"}).wait(function(){c.session.apiCCWebRTCClient.webRTCClient.MCUClient.TBLibIsLoaded=!0,c.session.apiCCWebRTCClient.webRTCClient.MCUClient.initDivElements(e,t),c.session.apiCCWebRTCClient.webRTCClient.MCUClient.createSession()}):(this.webRTCClient.MCUClient.initDivElements(e,t),this.webRTCClient.MCUClient.createSession())},this.joinMCUSession=function(e,t,n){console.log("joinMCUSession"),this.webRTCClient.MCUClient.TBLibIsLoaded===!1?$LAB.script(function(){return"//static.opentok.com/webrtc/v2.2/js/opentok.min.js"}).wait(function(){c.session.apiCCWebRTCClient.webRTCClient.MCUClient.TBLibIsLoaded=!0,c.session.apiCCWebRTCClient.webRTCClient.MCUClient.initDivElements(e,t),c.session.apiCCWebRTCClient.webRTCClient.MCUClient.joinSession(n)}):(this.webRTCClient.MCUClient.initDivElements(e,t),this.webRTCClient.MCUClient.joinSession(n))},this.takeSnapshotOnMCUSession=function(e){console.log("takeSnapshotOnMCUSession");var t=this.webRTCClient.MCUClient.takeSnapshot(e);return t},this.sendMCUSessionInvitation=function(e,t,n){this.webRTCClient.MCUClient.sendSessionInvitation(e,t,n)},this.sendMCUSessionInvitationToGroupChat=function(e,t){this.webRTCClient.MCUClient.sendSessionInvitationToGroupChat(e,t)},this.acceptMCUSessionInvitation=function(e,t,n,i){this.webRTCClient.MCUClient.TBLibIsLoaded===!1?$LAB.script(function(){return"//static.opentok.com/webrtc/v2.2/js/opentok.min.js"}).wait(function(){c.session.apiCCWebRTCClient.webRTCClient.MCUClient.TBLibIsLoaded=!0,c.session.apiCCWebRTCClient.webRTCClient.MCUClient.initDivElements(n,i),c.session.apiCCWebRTCClient.webRTCClient.MCUClient.acceptSessionInvitation(e,t)}):(this.webRTCClient.MCUClient.initDivElements(n,i),this.webRTCClient.MCUClient.acceptSessionInvitation(e,t))},this.leaveMCUSession=function(){this.webRTCClient.MCUClient.leaveSession()},this.recordType=null,this.duration=6e4,this.listenerOnRecordEventAdded=!1,this.sessionIdForRecord=null,this.recordStreamUserMediaSuccessHandler=function(e){console.log("recordStreamUserMediaSuccessHandler"),this.webRTCClient.recordMgr.record("local",this.recordType,this.duration,this.sessionIdForRecord)},this.recordStreamUserMediaErrorHandler=function(e){console.log("Error on media for recordStream")},this.recordStream=function(e,t,n){console.log("recordStream"),this.recordType=e,this.sessionIdForRecord=n,t>6e4&&(t=6e4),this.duration=t,null!==this.webRTCClient.recordMgr?this.webRTCClient.recordMgr.recordOngoing===!1?(this.listenerOnRecordEventAdded===!1&&(c.addEventListener("userMediaSuccess",this.callback(this,"recordStreamUserMediaSuccessHandler")),c.addEventListener("userMediaError",this.callback(this,"recordStreamUserMediaErrorHandler")),this.listenerOnRecordEventAdded=!0),this.webRTCClient.getUserMedia()):console.log("record already Ongoing"):console.log("Error this.webRTCClient.recordMgr === null")},this.stopRecordStream=function(){console.log("stopRecordStream"),null!==this.webRTCClient.recordMgr?this.webRTCClient.recordMgr.recordOngoing===!1?console.log("record is not Ongoing"):(console.log("record is Ongoing"),this.webRTCClient.recordMgr.stop()):console.log("Error this.webRTCClient.recordMgr === null")},this.setUploadServerAddressForRecord=function(e){this.webRTCClient.recordMgr.setUploadServerAddress(e)},this.getMediaDevices=function(e){if(console.log("getMediaDevices"),"undefined"==typeof MediaStreamTrack)e(null),alert("This browser does not support MediaStreamTrack.\n\nTry Chrome Canary.");else try{MediaStreamTrack.getSources(e)}catch(t){console.debug("catch MediaStreamTrack.getSources :"+t),e(null)}},this.setAudioSourceId=function(e){console.log("setAudioSourceId :"+e),this.webRTCClient.audioSourceId=e},this.setVideoSourceId=function(e){console.log("setVideoSourceId :"+e),this.webRTCClient.videoSourceId=e},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler}},c.ApiCCSession=function(e){if(this.apiCCId=null,this.apiKey=null,this.nickname=null,this.photoURL=null,this.apiCCWebRTCClient=null,this.apiCCIMClient=null,this.apiCCDataClient=null,this.apiCCIDCookie=null,this.channel=null,this.recordActivated=e.recordActivated,this.sessionId=null,this.apiCCWhiteBoardClient=null,this.apiCCCoBrowsingClient=null,this.ccsServer=e.ccsServer,this.userData=e.userData,this.roomManagerEventHandler=function(e){console.log("roomManagerEventHandler, roomId :"+e.roomId),console.log("type :"+e.type),console.log("roomType :"+e.roomType),"whiteBoard"===e.roomType?(console.log("msg.roomType === whiteBoard"),"roomCreation"===e.type&&(console.log("whiteBoard : roomCreation"),this.apiCCWhiteBoardClient.roomId=e.roomId,l.createRoomCreationEvent(e.status,e.roomId,e.roomType)),"roomInvitation"===e.type&&(console.log("whiteBoard : roomInvitation"),this.apiCCWhiteBoardClient.roomId=e.roomId,l.createRoomInvitationEvent(e.roomId,e.senderId,e.senderNickname,e.senderPhotoURL,e.contactList,e.roomType)),"roomMessage"===e.type&&(console.log("whiteBoard : roomMessage :"+e),this.apiCCWhiteBoardClient.messageProcessing(e.data),l.createReceiveRoomMessageEvent(e.roomId,e.senderId,e.nickname,e.data,e.roomType)),"roomMemberUpdate"===e.type&&(console.log("whiteBoard : roomMemberUpdate :"+e),l.createRoomMemberUpdateEvent(e.roomId,e.contactList,e.status,e.roomType))):"coBrowsing"===e.roomType&&(console.log("msg.roomType === coBrowsing"),"roomCreation"===e.type&&(console.log("coBrowsing : roomCreation"),l.createRoomCreationEvent(e.status,e.roomId,e.roomType)),"roomInvitation"===e.type&&(console.log("coBrowsing : roomInvitation"),l.createRoomInvitationEvent(e.roomId,e.senderId,e.senderNickname,e.senderPhotoURL,e.contactList,e.roomType)),"roomMessage"===e.type&&(console.log("coBrowsing : roomMessage :"+e),l.createReceiveRoomMessageEvent(e.roomId,e.senderId,e.nickname,e.data,e.roomType)),"roomMemberUpdate"===e.type&&(console.log("coBrowsing : roomMemberUpdate :"+e),l.createRoomMemberUpdateEvent(e.roomId,e.contactList,e.status,e.roomType)))},this.callback=function(e,t){return this.closureHandler=function(n){return e[t](n)},this.closureHandler},this.roomMgr=new C(this,this.callback(this,"roomManagerEventHandler")),this.xhrPolling=e.xhrPolling===!0?!0:!1,this.getCookie=function(e){var t=new RegExp("(?:; )?"+e+"=([^;]*);?");return t.test(document.cookie)?decodeURIComponent(RegExp.$1):null},this.generateApiCCID=function(){console.log("apiCCId is not defined by user, checking if a cookie for apiCCId exist"),this.apiCCIDCookie=this.getCookie("apiCCId"),null!==this.apiCCIDCookie?(console.log("apiCCId cookie exist : "+this.apiCCIDCookie),this.apiCCId=this.apiCCIDCookie):(console.log(" No apiCCId cookie : generating an apiCCId"),this.apiCCId=Math.floor(1000001*Math.random()).toString(),console.log("Creation of new ApiRTC session with Id : "+this.apiCCId))},this.getNumericIdFromAlpha=function(e){console.log("getNumericIdFromAlpha new : "+e);var t=0,n=0,i=null;if(0==e.length)return t;for(n=0;n<e.length;n++)i=e.charCodeAt(n),t=(t<<5)-t+i,t&=t;return console.log("getNumericIdFromAlpha returned value: "+(t>>>0)),t>>>0},e===t)return alert("Error : Initialisation parameters for session creation are not defined"),console.log("Error : Initialisation parameters for session creation are not defined"),null;if(e.apiKey===t)return alert('Error : Initialisation parameters: "apikey" for session creation is not defined'),console.log('Error : Initialisation parameters: "apikey" for session creation is not defined'),null;if(console.log("Session creation with apiKey : "+e.apiKey),this.apiKey=e.apiKey,e.onReady===t)return alert('Error : Initialisation parameters: "onReady" for session creation is not defined'),console.log('Error : Initialisation parameters: "onReady" for session creation is not defined'),null;if(c.addEventListener("sessionReady",e.onReady),this.sessionId=this.getCookie("sessionId"),e.apiCCId===t)this.generateApiCCID();else if(console.log("Session creation with apiCCId defined by user : "+e.apiCCId),n(e.apiCCId))this.apiCCId=e.apiCCId;else{console.log("Converting this Id in a numeric one");var i=this.getNumericIdFromAlpha(e.apiCCId);i+="",console.log("Numeric Id is : "+i),n(i)?(console.warn("Id has been converted to a numeric one"),this.apiCCId=i):(console.warn("Error : Defined apiCCId :"+e.apiCCId+" is not numeric. ApiCCID is generated"),this.generateApiCCID())}this.channel=new u(this),this.channel.initialize(),null!==e.nickname&&e.nickname!==t?(console.log("Nickname is defined :"+e.nickname),this.nickname=e.nickname):(console.log("Nickname is not defined, setting to apiCCId value :"+this.apiCCId),this.nickname=this.apiCCId),null!==e.photoURL&&e.photoURL!==t?(console.log("photoURL is defined :"+e.photoURL),this.photoURL=e.photoURL):(console.log("photoURL is not defined"),this.photoURL=null),this.reOpenChannel=function(e,t){console.log("reOpenChannel"),this.apiCCId=e,this.apiKey=t,this.channel.socket.disconnect(),this.channel.channelReady=!1,this.channel.socket=null,this.channel.channelId=this.apiCCId,this.channel.initialize(),this.apiCCWebRTCClient.webRTCClient.socket=this.channel.socket},this.onChannelOpened=function(){console.log("ApiCCSession onChannelOpened"),console.log("params.ApiDBActivated :"+e.ApiDBActivated),e.ApiDBActivated===!0&&(console.log("apiDB initialisation"),apiDB.init(this.channel.socket)),l.createSessionReadyEvent(c.session.apiCCId)},this.createWebRTCClient=function(e){return console.log("createWebRTCClient"),e!==t&&null!==e?(this.apiCCWebRTCClient=new c.ApiCCWebRTCClient(this,e.localVideo,e.minilocalVideo,e.remoteVideo,e.status,e.command),l.createWebRTCClientCreatedEvent(),this.apiCCWebRTCClient):(console.log("Error : Initialisation parameters is null or not defined on WebRTCClient creation"),null)},this.createWhiteBoard=function(e,t,n){return console.log("createWhiteBoard"),this.apiCCWhiteBoardClient=new c.ApiCCWhiteBoardClient(this,e,t,n),this.apiCCWhiteBoardClient},this.createCoBrowsing=function(){return console.log("createCoBrowsing"),this.apiCCCoBrowsingClient=new c.ApiCCCoBrowsingClient(this),this.apiCCCoBrowsingClient},this.createIMClient=function(e){return console.log("createIMClient :"+e),this.apiCCIMClient=new c.ApiCCIMClient(this,e),this.apiCCIMClient},this.createDataClient=function(){return console.log("createDataClient"),this.apiCCDataClient=new c.ApiCCDataClient(this),this.apiCCDataClient},this.getConversationList=function(e){console.log("getConversationList request");var n=null,i=null;n=e!==t?{type:"getConversationList",lastConversationNb:e}:{type:"getConversationList",lastConversationNb:50},i=JSON.stringify(n),console.log("C->S: "+i),this.channel.socket.emit("getConversationList",i)},this.receiveConversationListAnswer=function(e){console.log("receiveConversationListAnswer"),console.log("msg.convList.length :"+e.convList.length);var t=0,n=e.convList.length,i=[],o=null;for(t=0;n>t;t+=1)console.log("i ="+t),o=JSON.parse(e.convList[t]),i.push(o);l.createReceiveConversationListAnswerEvent(i)},this.getContactOccurrencesFromConversationList=function(e){console.log("getContactOccurrencesFromConversationList request");var n=null,i=null;n=e!==t?{type:"getContactOccurrencesFromConversationList",lastConversationNb:e}:{type:"getContactOccurrencesFromConversationList",lastConversationNb:50},i=JSON.stringify(n),console.log("C->S: "+i),this.channel.socket.emit("getContactOccurrencesFromConversationList",i)},this.receiveContactOccurrencesFromConversationListAnswer=function(e){console.log("receiveContactOccurrencesFromConversationListAnswer"),console.log("msg.contactOccurrencesTable.length :"+e.contactOccurrencesTable.length),l.createReceiveContactOccurrencesFromConversationListAnswerEvent(e.contactOccurrencesTable)},this.getConversationDetailReport=function(e){console.log("getConversationDetailReport for convId :"+e);var t=null,n=null;t={type:"getConversationDetailReport",convId:e},n=JSON.stringify(t),console.log("C->S: "+n),this.channel.socket.emit("getConversationDetailReport",n)},this.receiveConversationDetailReportAnswer=function(e){console.log("receiveConversationDetailReportAnswer"),console.log("msg.CDR :"+e.CDR),l.createReceiveConversationDetailReportAnswerEvent(e.CDR)},this.updatePresence=function(e){console.log("updatePresence"+e),l.createUpdatePresenceEvent(e.connectedUsersList,e.state,e.connectedUsersListWithStatus)},this.updateUserStatus=function(e){console.log("updateUserStatus"+e),l.createUpdateUserStatusEvent(e)},this.sendDebugCommand=function(e,t,n){console.log("sendDebugCommand :"+e);var i=new d(this.channel.socket);i.sendDebugCommand("getClientSocketsInfo",t,n)},this.processSignalingMessage=function(e){var t=JSON.parse(e);"invite"===t.type?this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processInvite(t):console.warn("WebRTCClient is not created"):"200OK"===t.type?this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200OK(t):console.warn("WebRTCClient is not created"):"candidate"===t.type?this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processCandidate(t):console.warn("WebRTCClient is not created"):"bye"===t.type?this.apiCCWebRTCClient?(console.log("bye message from:"+t.clientId+" for callId : "+t.callId),this.apiCCWebRTCClient.webRTCClient.onRemoteHangup(t.callId,t.clientId,t.roomId,t.reason)):console.warn("WebRTCClient is not created"):"update"===t.type?this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.processUpdate(t):console.warn("WebRTCClient is not created"):"200update"===t.type?this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.process200Update(t):console.warn("WebRTCClient is not created"):"newConversationCreated"===t.type?this.apiCCIMClient?this.apiCCIMClient.newConversationCreated(t):console.warn("IMClient is not created"):"IMMessage"===t.type?this.apiCCIMClient?this.apiCCIMClient.receiveMessage(t):console.warn("IMClient is not created"):"groupChatCreation"===t.type?this.apiCCIMClient?this.apiCCIMClient.groupChatCreation(t):console.warn("IMClient is not created"):"groupChatInvitation"===t.type?this.apiCCIMClient?this.apiCCIMClient.groupChatInvitation(t):console.warn("IMClient is not created"):"groupChatMemberUpdate"===t.type?this.apiCCIMClient?this.apiCCIMClient.groupChatMemberUpdate(t):console.warn("IMClient is not created"):"addUserInGroupChatAnswer"===t.type?this.apiCCIMClient?this.apiCCIMClient.addUserInGroupChatAnswer(t):console.warn("IMClient is not created"):"groupChatMessage"===t.type?this.apiCCIMClient?this.apiCCIMClient.receiveGroupChatMessage(t):console.warn("IMClient is not created"):"conversationHistoryAnswer"===t.type?this.apiCCIMClient?this.apiCCIMClient.receiveConversationHistory(t):console.warn("IMClient is not created"):"getUserDataAnswer"===t.type?this.apiCCIMClient?this.apiCCIMClient.receiveUserDataAnswer(t):console.warn("IMClient is not created"):"dataMessage"===t.type?this.apiCCDataClient?this.apiCCDataClient.receiveData(t):console.warn("DataClient is not created"):"conversationListAnswer"===t.type?this.receiveConversationListAnswer(t):"contactOccurrencesFromConversationListAnswer"===t.type?this.receiveContactOccurrencesFromConversationListAnswer(t):"conversationDetailReport"===t.type?this.receiveConversationDetailReportAnswer(t):"updatePresence"===t.type?(console.log("updatePresence"),this.updatePresence(t)):"updateUserStatus"===t.type?(console.log("updateUserStatus"),this.updateUserStatus(t)):"receiveMCUSessionId"===t.type?(console.log("receiveMCUSessionId"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionId(t):console.warn("WebRTCClient is not created")):"joinMCUSessionAnswer"===t.type?(console.log("joinMCUSessionAnswer"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.joinSessionAnswer(t):console.warn("WebRTCClient is not created")):"MCUSessionInvitation"===t.type?(console.log("MCUSessionInvitation"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(t):console.warn("WebRTCClient is not created")):"MCUSessionInvitationToGroupChat"===t.type?(console.log("MCUSessionInvitationToGroupChat"),this.apiCCWebRTCClient?this.apiCCWebRTCClient.webRTCClient.MCUClient.receiveSessionInvitation(t):console.warn("WebRTCClient is not created")):"sessionId"===t.type?(console.log("sessionId :"+t.sessionId),this.sessionId=t.sessionId):"roomCreation"===t.type?(console.log("roomCreation"),this.roomMgr.roomCreation(t)):"inviteInRoomStatus"===t.type?(console.log("inviteInRoomStatus"),this.roomMgr.inviteInRoomStatus(t)):"roomInvitation"===t.type?(console.log("roomInvitation"),this.roomMgr.roomInvitation(t)):"roomMessage"===t.type?(console.log("roomMessage"),this.roomMgr.receiveRoomMessage(t)):"roomMemberUpdate"===t.type?(console.log("roomMemberUpdate"),this.roomMgr.roomMemberUpdate(t)):console.log("Error : No type for this message")}},e.apiRTC=e.apiCC=e.CC=c,c}(window),function(e){"use strict";"function"==typeof define&&define.amd?define([],function(){return e(window,document)}):"undefined"!=typeof exports?module.exports=e(window,document):window.wysiwyg=e(window,document)}(function(e,t){"use strict";var n=function(e,t,n){var i;return function(){if(i){if(!n)return;clearTimeout(i)}var o=this,r=arguments;i=setTimeout(function(){i=null,e.apply(o,r)},t)}},i=function(t,n,i,o){t.addEventListener?t.addEventListener(n,i,o?!0:!1):t.attachEvent?t.attachEvent("on"+n,i):t!=e&&(t["on"+n]=i)},o=function(t,n,i,o){t.removeEventListener?t.removeEventListener(n,i,o?!0:!1):t.detachEvent?t.detachEvent("on"+n,i):t!=e&&(t["on"+n]=null)},r=function(e,n,i,o){if(t.createEvent){var r=t.createEvent("Event");r.initEvent(n,void 0!==i?i:!0,void 0!==o?o:!1),e.dispatchEvent(r)}else if(t.createEventObject){var r=t.createEventObject();e.fireEvent("on"+n,r)}else"function"==typeof e["on"+n]&&e["on"+n]()},s=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},a="undefined"!=typeof Node?Node.ELEMENT_NODE:1,l="undefined"!=typeof Node?Node.TEXT_NODE:3,c=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},u=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},d=function(n){if(e.getSelection){var i=e.getSelection();if(i.rangeCount>0)return i.getRangeAt(0)}else if(t.selection){var i=t.selection;return i.createRange()}return null},h=function(n,i){if(i)if(e.getSelection){var o=e.getSelection();o.removeAllRanges(),o.addRange(i)}else t.selection&&i.select()},p=function(){if(e.getSelection){var n=e.getSelection();if(!n.rangeCount)return!1;var i=n.getRangeAt(0).cloneRange();if(i.getBoundingClientRect){var o=i.getBoundingClientRect();if(o&&o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)};for(var r=i.getClientRects?i.getClientRects():[],s=0;s<r.length;++s){var o=r[s];if(o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)}}}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var i=n.createRange();if(i.boundingLeft||i.boundingTop||i.boundingWidth||i.boundingHeight)return{left:i.boundingLeft,top:i.boundingTop,width:i.boundingWidth,height:i.boundingHeight}}}return!1},f=function(n){if(e.getSelection){var i=e.getSelection();return i.isCollapsed?!0:!1}if(t.selection){var i=t.selection;if("Text"==i.type){var o=t.selection.createRange(),r=t.body.createTextRange();return r.moveToElementText(n),r.setEndPoint("EndToStart",o),0==o.htmlText.length}if("Control"==i.type)return!1}return!0},g=function(n){if(e.getSelection){var i=e.getSelection();if(!i.rangeCount)return[];for(var o=[],r=0;r<i.rangeCount;++r)for(var s=i.getRangeAt(r),l=s.startContainer,d=s.endContainer;l;){if(l!=n){var h=!1;if(i.containsNode)h=i.containsNode(l,!0);else{var p=t.createRange();p.selectNodeContents(l);for(var r=0;r<i.rangeCount;++r){var s=i.getRangeAt(r);if(s.compareBoundaryPoints(s.END_TO_START,p)>=0&&s.compareBoundaryPoints(s.START_TO_END,p)<=0){h=!0;break}}}h&&o.push(l)}l=u(l,l==d?d:n)}return 0==o.length&&c(n,i.focusNode)&&i.focusNode!=n&&o.push(i.focusNode),o}if(t.selection){var i=t.selection;if("Text"==i.type){for(var o=[],f=i.createRangeCollection(),r=0;r<f.length;++r)for(var s=f[r],g=s.parentElement(),l=g;l;){var p=s.duplicate();if(p.moveToElementText(l.nodeType!=a?l.parentNode:l),p.compareEndPoints("EndToStart",s)>=0&&p.compareEndPoints("StartToEnd",s)<=0){for(var m=!1,v=0;v<o.length;++v)if(o[v]===l){m=!0;break}m||o.push(l)}l=u(l,g)}return 0==o.length&&c(n,t.activeElement)&&t.activeElement!=n&&o.push(t.activeElement),o}if("Control"==i.type){for(var o=[],s=i.createRange(),r=0;r<s.length;++r)o.push(s(r));return o}}return[]},m=function(){if(e.getSelection){var n=e.getSelection();if(!n.isCollapsed)try{n.collapseToEnd()}catch(i){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var o=n.createRange();o.collapse(!1),o.select()}}},v=function(n,i,o){if(e.getSelection){var r=e.getSelection();if(r.modify){for(var s=0;i>s;++s)r.modify("extend","backward","character");for(var s=0;o>s;++s)r.modify("extend","forward","character")}else{var a=r.getRangeAt(0);a.setStart(a.startContainer,a.startOffset-i),a.setEnd(a.endContainer,a.endOffset+o),r.removeAllRanges(),r.addRange(a)}}else if(t.selection){var r=t.selection;if("Control"!=r.type){var a=r.createRange();a.collapse(!0),a.moveStart("character",-i),a.moveEnd("character",o),a.select()}}},b=function(n){if(f(n))return null;if(e.getSelection){var i=e.getSelection();if(i.rangeCount){for(var o=t.createElement("div"),r=i.rangeCount,s=0;r>s;++s){var a=i.getRangeAt(s).cloneContents();o.appendChild(a)}return o.innerHTML}}else if(t.selection){var i=t.selection;if("Text"==i.type){var l=i.createRange();return l.htmlText}}return null},y=function(n,i){if(e.getSelection){var o=e.getSelection();if(c(n,o.anchorNode)&&c(n,o.focusNode))return!0;if(!i)return!1;var r=t.createRange();r.selectNodeContents(n),r.collapse(!1),o.removeAllRanges(),o.addRange(r)}else if(t.selection){var o=t.selection;if("Control"==o.type){var r=o.createRange();if(0!=r.length&&c(n,r(0)))return!0}else{var s=t.body.createTextRange();s.moveToElementText(n);var r=o.createRange();if(s.inRange(r))return!0}if(!i)return!1;var r=t.body.createTextRange();r.moveToElementText(n),r.setEndPoint("StartToEnd",r),r.select()}return!0},w=function(n,i){if(e.getSelection){var o=e.getSelection();if(o.getRangeAt&&o.rangeCount){var r=o.getRangeAt(0),s=t.createElement("div");s.innerHTML=i;for(var a,l,u=t.createDocumentFragment();a=s.firstChild;)l=u.appendChild(a);c(n,r.commonAncestorContainer)?(r.deleteContents(),r.insertNode(u)):n.appendChild(u),l&&(r=r.cloneRange(),r.setStartAfter(l),r.collapse(!0),o.removeAllRanges(),o.addRange(r))}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var d=o.createRange();d.collapse(!0);var r=o.createRange();if(c(n,r.parentElement()))r.pasteHTML(i);else{var h=t.body.createTextRange();h.moveToElementText(n),h.collapse(!1),h.select(),h.pasteHTML(i)}r=o.createRange(),r.setEndPoint("StartToEnd",d),r.select()}}},C=function(C){C=C||{};var _=C.element||null;"string"==typeof _&&(_=t.getElementById(_));var x=C.onKeyDown||null,S=C.onKeyPress||null,k=C.onKeyUp||null,T=C.onSelection||null,$=C.onPlaceholder||null,E=C.onClosepopup||null,D=C.hijackContextmenu||!1,I=C.readOnly||!1,M="TEXTAREA"==_.nodeName||"INPUT"==_.nodeName;if(M){var A="contentEditable"in t.body;if(A){var O=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);O&&420<=parseInt(O[1])&&parseInt(O[1])<534&&(A=!1)}if(!A){var R=_,P=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};R.value=P(R.value);var N=function(){return this},L=function(){return null};return{legacy:!0,getElement:function(){return R},getHTML:function(){return R.value},setHTML:function(e){return R.value=P(e),this},getSelectedHTML:L,sync:N,readOnly:function(e){return void 0===e?R.hasAttribute?R.hasAttribute("readonly"):!!R.getAttribute("readonly"):(e?R.setAttribute("readonly","readonly"):R.removeAttribute("readonly"),this)},collapseSelection:N,expandSelection:N,openPopup:L,
closePopup:N,removeFormat:N,bold:N,italic:N,underline:N,strikethrough:N,forecolor:N,highlight:N,fontName:N,fontSize:N,subscript:N,superscript:N,align:N,format:N,indent:N,insertLink:N,insertImage:N,insertHTML:N,insertList:N}}}var R=null,F=null;if(M){R=_,R.style.display="none",F=t.createElement("DIV"),F.innerHTML=R.value;var U=R.parentNode,j=R.nextSibling;j?U.insertBefore(F,j):U.appendChild(F)}else F=_;I||F.setAttribute("contentEditable","true");var H=t.all&&!t.addEventListener?t:e,W=null;if(M){var B=F.innerHTML;W=function(){var e=F.innerHTML;e!=B&&(R.value=e,B=e,r(R,"change",!1))}}var V;if($){var z=!1;(V=function(){for(var e=!0,t=F;t;)if(t=u(t,F))if(t.nodeType==a){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==l){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}z!=e&&($(e),z=e)})()}var q=null,Y=null,G=null;T&&(Y=function(t,n,i){var o=f(F),r=g(F),s=null===t||null===n?null:{left:t,top:n,width:0,height:0},l=p();if(l&&(s=l),s){if(F.getBoundingClientRect){var c=F.getBoundingClientRect();s.left-=parseInt(c.left),s.top-=parseInt(c.top)}else{var u=F,d=0,h=0,m=!1;do d+=u.offsetLeft?parseInt(u.offsetLeft):0,h+=u.offsetTop?parseInt(u.offsetTop):0,"fixed"==u.style.position&&(m=!0);while(u=u.offsetParent);s.left-=d-(m?0:e.pageXOffset),s.top-=h-(m?0:e.pageYOffset)}s.left<0&&(s.left=0),s.top<0&&(s.top=0),s.width>F.offsetWidth&&(s.width=F.offsetWidth),s.height>F.offsetHeight&&(s.height=F.offsetHeight)}else if(r.length)for(var v=0;v<r.length;++v){var u=r[v];if(u.nodeType==a){s={left:u.offsetLeft,top:u.offsetTop,width:u.offsetWidth,height:u.offsetHeight};break}}T(o,s,r,i)},G=n(Y,1));var K=null,Q=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==l&&(n=n.parentNode),c(K,n)||J()},X=function(){if(K)return K;i(H,"mousedown",Q,!0),K=t.createElement("DIV");var e=F.parentNode,n=F.nextSibling;return n?e.insertBefore(K,n):e.appendChild(K),K},J=function(){K&&(K.parentNode.removeChild(K),K=null,o(H,"mousedown",Q,!0),E&&E())};i(F,"focus",function(){R&&r(R,"focus",!1)}),i(F,"blur",function(){W&&W(),R&&r(R,"blur",!1)});var Z=null;if(V||W){var ee=W?n(W,250,!0):null,te=function(e){V&&V(),ee&&ee()};Z=n(te,1),i(F,"input",Z),i(F,"DOMNodeInserted",Z),i(F,"DOMNodeRemoved",Z),i(F,"DOMSubtreeModified",Z),i(F,"DOMCharacterDataModified",Z),i(F,"propertychange",Z),i(F,"textInput",Z),i(F,"paste",Z),i(F,"cut",Z),i(F,"drop",Z)}var ne=function(t,n){if(!t)var t=e.event;var i=t.which||t.keyCode,o=String.fromCharCode(i||t.charCode),r=t.shiftKey||!1,a=t.altKey||!1,l=t.ctrlKey||!1,c=t.metaKey||!1;if(1==n){if(x&&x(i,o,r,a,l,c)===!1)return s(t)}else if(2==n){if(S&&S(i,o,r,a,l,c)===!1)return s(t)}else if(3==n&&k&&k(i,o,r,a,l,c)===!1)return s(t);if((2==n||3==n)&&(q=null,G&&G(null,null,!1)),2==n&&Z)switch(i){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:Z()}};i(F,"keydown",function(e){return ne(e,1)}),i(F,"keypress",function(e){return ne(e,2)}),i(F,"keyup",function(e){return ne(e,3)});var ie=function(t,n){if(!t)var t=e.event;var i=null,r=null;t.clientX&&t.clientY?(i=t.clientX,r=t.clientY):t.pageX&&t.pageY&&(i=t.pageX-e.pageXOffset,r=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),o(H,"mouseup",ie),q=null,(D||!n)&&G&&G(i,r,n)};i(F,"mousedown",function(e){o(H,"mouseup",ie),i(H,"mouseup",ie)}),i(F,"mouseup",function(e){ie(e),Z&&Z()}),i(F,"dblclick",function(e){ie(e)}),i(F,"selectionchange",function(e){ie(e)}),D&&i(F,"contextmenu",function(e){return ie(e,!0),s(e)});var oe=function(n,i,o){if(h(F,q),!y(F,o))return!1;if(e.getSelection)try{return t.queryCommandSupported&&!t.queryCommandSupported(n)?!1:t.execCommand(n,!1,i)}catch(r){}else if(t.selection){var s=t.selection;if("None"!=s.type){var a=s.createRange();try{return a.queryCommandEnabled(n)?a.execCommand(n,!1,i):!1}catch(r){}}}return!1},re=null,se=function(){(t.all||e.MSInputMethodContext)&&(re=t.createElement("DIV"),F.appendChild(re))},ae=function(e){re&&(F.removeChild(re),re=null),Z&&Z(),e?(m(),q=null):q&&(q=d(F))};return{getElement:function(){return F},getHTML:function(){return F.innerHTML},setHTML:function(e){return F.innerHTML=e,ae(!0),this},getSelectedHTML:function(){return h(F,q),y(F)?b(F):null},sync:function(){return W&&W(),this},readOnly:function(e){return void 0===e?F.hasAttribute?!F.hasAttribute("contentEditable"):!F.getAttribute("contentEditable"):(e?F.removeAttribute("contentEditable"):F.setAttribute("contentEditable","true"),this)},collapseSelection:function(){return m(),q=null,this},expandSelection:function(e,t){return h(F,q),y(F)?(v(F,e,t),q=d(F),this):this},openPopup:function(){return q||(q=d(F)),X()},closePopup:function(){return J(),this},removeFormat:function(){return oe("removeFormat"),oe("unlink"),ae(),this},bold:function(){return oe("bold"),ae(),this},italic:function(){return oe("italic"),ae(),this},underline:function(){return oe("underline"),ae(),this},strikethrough:function(){return oe("strikeThrough"),ae(),this},forecolor:function(e){return oe("foreColor",e),ae(),this},highlight:function(e){return oe("hiliteColor",e)||oe("backColor",e),ae(),this},fontName:function(e){return oe("fontName",e),ae(),this},fontSize:function(e){return oe("fontSize",e),ae(),this},subscript:function(){return oe("subscript"),ae(),this},superscript:function(){return oe("superscript"),ae(),this},align:function(e){return se(),"left"==e?oe("justifyLeft"):"center"==e?oe("justifyCenter"):"right"==e?oe("justifyRight"):"justify"==e&&oe("justifyFull"),ae(),this},format:function(e){return se(),oe("formatBlock",e),ae(),this},indent:function(e){return se(),oe(e?"outdent":"indent"),ae(),this},insertLink:function(e){return oe("createLink",e),ae(!0),this},insertImage:function(e){return oe("insertImage",e,!0),ae(!0),this},insertHTML:function(e){return oe("insertHTML",e,!0)||(h(F,q),y(F,!0),w(F,e)),ae(!0),this},insertList:function(e){return se(),oe(e?"insertOrderedList":"insertUnorderedList"),ae(),this}}};return C}),function(e){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(window,document,t)});else{if("undefined"==typeof exports)return e(window,document,jQuery);module.exports=e(window,document,require("jquery"))}}(function(e,t,n){"use strict";var i=function(e,t,n){var i,o,r,s,a,l,c,u;switch(s=Math.floor(6*e),a=6*e-s,l=n*(1-t),c=n*(1-a*t),u=n*(1-(1-a)*t),s%6){case 0:i=n,o=u,r=l;break;case 1:i=c,o=n,r=l;break;case 2:i=l,o=n,r=u;break;case 3:i=l,o=c,r=n;break;case 4:i=u,o=l,r=n;break;case 5:i=n,o=l,r=c}var d=Math.floor(255*i).toString(16),h=Math.floor(255*o).toString(16),p=Math.floor(255*r).toString(16);return"#"+(d.length<2?"0":"")+d+(h.length<2?"0":"")+h+(p.length<2?"0":"")+p},o=function(e){return e.replace(/[&<>"]/g,function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return t[e]||e})},r=function(r,s,a,l,c,u,d,h,p,f,g,m,v,b,y,w,C){var _=function(e,t){t&&(e.getSelectedHTML()?e.insertLink(t):e.insertHTML('<a href="'+o(t)+'">'+o(t)+"</a>")),e.closePopup().collapseSelection()},x=function(e,t){var i=E(u),o=n('<input type="text" value="'+(t?t.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(n){(10==n.which||13==n.which)&&(t?(t.attr("href",o.val()),e.closePopup().collapseSelection()):_(e,o.val()))});h&&o.attr("placeholder",h);var r=i.click(function(n){return t?(t.attr("href",o.val()),e.closePopup().collapseSelection()):_(e,o.val()),n.stopPropagation(),n.preventDefault(),!1}),s=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");return s.append(o).append(r),s},S=function(t){var i=function(e,i){var r='<img id="wysiwyg-insert-image" src="" alt=""'+(i?' title="'+o(i)+'"':"")+" >test";t.insertHTML(r).closePopup().collapseSelection();var s=n("#wysiwyg-insert-image").removeAttr("id");f&&s.css({maxWidth:f[0]+"px",maxHeight:f[1]+"px"}).load(function(){s.css({maxWidth:"",maxHeight:""});var e=s.width(),t=s.height();(e>f[0]||t>f[1])&&(e/t>f[0]/f[1]?(t=parseInt(t/e*f[0]),e=f[0]):(e=parseInt(e/t*f[1]),t=f[1]),s.attr("width",e).attr("height",t))}),s.attr("src",e)},r=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),s=null,a=n('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!m&&e.File&&e.FileReader&&e.FileList){var l=function(e){if(e.type.match("image.*")){var t=new FileReader;t.onload=function(t){var n=t.target.result;i(n,e.name)},t.readAsDataURL(e)}};s=a.attr("draggable","true").change(function(e){for(var t=e.target.files,n=0;n<t.length;++n)l(t[n])}).on("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault(),!1}).on("drop",function(e){for(var t=e.originalEvent.dataTransfer.files,n=0;n<t.length;++n)l(t[n]);return e.stopPropagation(),e.preventDefault(),!1})}else if(g){var c=a.change(function(e){g.call(this,i)});s=n("<form/>").append(c)}s&&n("<div/>").addClass("wysiwyg-browse").html(d).append(s).appendTo(r);var p=E(u),v=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&i(v.val())});h&&v.attr("placeholder",h);var b=p.click(function(e){return i(v.val()),e.stopPropagation(),e.preventDefault(),!1});return r.append(n("<div/>").append(v).append(b)),r},k=function(e){var t=function(t,i){t=n.trim(t||""),i=n.trim(i||"");var r=!1;t.length&&!i.length?r=t:-1==i.indexOf("<")&&-1==i.indexOf(">")&&i.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(r=i),r&&v&&(i=v(r)||""),!i.length&&r&&(i='<video src="'+o(r)+'" />'),e.insertHTML(i).closePopup().collapseSelection()},i=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),r=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");p&&r.attr("placeholder",p),n("<div/>").addClass("wysiwyg-embedcode").append(r).appendTo(i);var s=E(u),a=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&t(a.val())});h&&a.attr("placeholder",h);var l=s.click(function(e){return t(a.val(),r.val()),e.stopPropagation(),e.preventDefault(),!1});return i.append(n("<div/>").append(a).append(l)),i},T=function(e,t){for(var o=n("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on"),r=1;15>r;++r){for(var s=n("<tr/>"),a=0;25>a;++a){var l;if(24==a){var c=Math.floor(255/13*(14-r)).toString(16),u=(c.length<2?"0":"")+c;l="#"+u+u+u}else{var d=a/24,h=8>=r?r/8:1,p=r>8?(16-r)/8:1;l=i(d,h,p)}n("<td/>").addClass("wysiwyg-toolbar-color").attr("title",l).attr("unselectable","on").css({backgroundColor:l}).click(function(){var n=this.title;return t?e.forecolor(n).closePopup().collapseSelection():e.highlight(n).closePopup().collapseSelection(),!1}).appendTo(s)}o.append(s)}return o},$=function(e,t){switch(e){case"insertimage":return t?function(e){t(S(N),e)}:null;case"insertvideo":return t?function(e){t(k(N),e)}:null;case"insertlink":return t?function(e){t(x(N),e)}:null;case"bold":return function(){N.bold()};case"italic":return function(){N.italic()};case"underline":return function(){N.underline()};case"strikethrough":return function(){N.strikethrough()};case"forecolor":return t?function(e){t(T(N,!0),e)}:null;case"highlight":return t?function(e){t(T(N,!1),e)}:null;case"alignleft":return function(){N.align("left")};case"aligncenter":return function(){N.align("center")};case"alignright":return function(){N.align("right")};case"alignjustify":return function(){N.align("justify")};case"subscript":return function(){N.subscript()};case"superscript":return function(){N.superscript()};case"indent":return function(){N.indent()};case"outdent":return function(){N.indent(!0)};case"orderedList":return function(){N.insertList(!0)};case"unorderedList":return function(){N.insertList()};case"removeformat":return function(){N.removeFormat().closePopup().collapseSelection()}}return null},E=function(e){return n("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","javascript:void(0)").attr("title",e.title).attr("unselectable","on").append(e.image)},D=function(e,t,i,o){n.each(c,function(r,s){if(s&&!(t===!1&&"showstatic"in s&&!s.showstatic||t===!0&&"showselection"in s&&!s.showselection)){var a;a="click"in s?function(e){s.click(n(e))}:"popup"in s?function(e){var t=i(),r=s.popup(t,n(e));o(t,e,r)}:$(r,function(e,t){var n=i();n.append(e),o(n,t),n.find("input[type=text]:first").focus()});var l;a?l=E(s).click(function(e){return a(e.currentTarget),$(r)&&N.getElement().focus(),e.stopPropagation(),e.preventDefault(),!1}):s.html&&(l=n(s.html)),l&&e.append(l)}})},I=function(i,o,r,s){for(var a=o.get(0),l=a.offsetParent,c={left:0,top:0},u=!1,d=!1,h=i.width(),p=l;p;){c.left+=p.offsetLeft,c.top+=p.offsetTop;var f=n(p);"fixed"==f.css("position")&&(u=!0),"visible"!=f.css("overflow")&&(d=!0),p=p.offsetParent}var g=n(l||t.body);g.append(i),r+=a.offsetLeft,s+=a.offsetTop,(u||d)&&(r+h>g.width()-1&&(r=g.width()-h-1),1>r&&(r=1));var m=n(e).width();c.left+r+h>m-1&&(r=m-c.left-h-1);var v=u?0:n(e).scrollLeft();c.left+r<v+1&&(r=v-c.left+1),i.css({left:parseInt(r)+"px",top:parseInt(s)+"px"})},M={},A=null,O=function(e,t,i){var o=function(e,t,i,o,r,s,l){if(C){var c=A||"";switch(t){case 8:c=c.substring(0,c.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(e)return;i=!1;break;default:if(!e)return;c+=i}var u=C(c,t,i,o,r,s,l);if("object"!=typeof u||!u.length)return a.closePopup(),A=null,u;var d=n(a.openPopup());d.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(u),A=c}},r={element:e.get(0),onKeyDown:function(e,t,n,i,r,s){if(b&&b(e,t,n,i,r,s)===!1)return!1;if(t&&!n&&!i&&r&&!s){var a=t.toLowerCase();if(!M[a])return;return M[a](),!1}return o(!1,e,t,n,i,r,s)},onKeyPress:function(e,t,n,i,r,s){return y&&y(e,t,n,i,r,s)===!1?!1:o(!0,e,t,n,i,r,s)},onKeyUp:function(e,t,n,i,o,r){return w&&w(e,t,n,i,o,r)===!1?!1:void 0},onSelection:function(e,i,o,r){var s=!0,c=null;if(e&&n.each(o,function(e,t){return 0!=n(t).parents("a").length?(c=x(a,n(t).parents("a:first")),!1):void 0}),a.readOnly()?s=!1:i?c||r||A||("selection"!=l&&"top-selection"!=l&&"bottom-selection"!=l?s=!1:e?s=!1:1==o.length&&"IMG"==o[0].nodeName&&(s=!1)):s=!1,!s)return void a.closePopup();var u,d=function(){var e=u.outerWidth(),o=t.offset(),r=n(a.getElement()).offset(),s=i.left+parseInt(i.width/2)-parseInt(e/2)+r.left-o.left,l=i.top+i.height+r.top-o.top;I(u,t,s,l)};u=n(a.openPopup()),u.hasClass("wysiwyg-popuphover")&&!u.data("special")==!c||(u=n(a.closePopup().openPopup())),A?u.show():u.hasClass("wysiwyg-popup")||(u.addClass("wysiwyg-popup wysiwyg-popuphover"),c?u.empty().append(c).data("special",!0):D(u,!0,function(){return u.empty()},d)),d()},onClosepopup:function(){A=null},hijackContextmenu:"selection"==l,readOnly:!!e.attr("readonly")};if(i){var s=n("<div/>").addClass("wysiwyg-placeholder").html(i).hide();t.prepend(s),r.onPlaceholder=function(e){e?s.show():s.hide()}}var a=wysiwyg(r);return a},R=n("<div/>").addClass("wysiwyg-container");s&&R.addClass(s),r.wrap(R),R=r.parent(".wysiwyg-container");var P=!1;a&&(P=n("<div/>").addClass("wysiwyg-wrapper").click(function(){N.getElement().focus()}),r.wrap(P),P=r.parent(".wysiwyg-wrapper"));var N=O(r,a?P:R,a);if(N.legacy){var r=n(N.getElement());r.addClass("wysiwyg-textarea"),r.is(":visible")&&r.width(R.width()-(r.outerWidth()-r.width()))}else n(N.getElement()).addClass("wysiwyg-editor");var L={};if(n.each(c,function(e,t){if(t&&t.hotkey){var n=$(e);n&&(M[t.hotkey.toLowerCase()]=n,L[e]=n)}}),"selection"!=l){var F="top"==l||"top-selection"==l,U=n("<div/>").addClass("wysiwyg-toolbar").addClass(F?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");D(U,!1,function(){var e=n(N.openPopup());return e.hasClass("wysiwyg-popup")&&e.hasClass("wysiwyg-popuphover")&&(e=n(N.closePopup().openPopup())),e.hasClass("wysiwyg-popup")||e.addClass("wysiwyg-popup"),e},function(e,t,i){var o=n(t),r=e.outerWidth(),s=o.offset().left-R.offset().left+parseInt(o.width()/2)-parseInt(r/2),a=o.offset().top-R.offset().top;F?a+=o.outerHeight():a-=e.outerHeight(),i&&(s=i.left,a=i.top),I(e,R,s,a)}),F?R.prepend(U):R.append(U)}return{wysiwygeditor:N,$container:R}};n.fn.wysiwyg=function(e,t){if(!e||"object"==typeof e)return e=n.extend({},e),this.each(function(){var t=n(this);if(!t.data("wysiwyg")){var i=e.classes,o=e.placeholder||t.attr("placeholder"),s=!e.toolbar||"top"!=e.toolbar&&"top-selection"!=e.toolbar&&"bottom"!=e.toolbar&&"bottom-selection"!=e.toolbar&&"selection"!=e.toolbar?"top-selection":e.toolbar,a=e.buttons,l=e.submit,c=e.selectImage,u=e.placeholderUrl||null,d=e.placeholderEmbed||null,h=e.maxImageSize||null,p=e.onImageUpload||null,f=e.forceImageUpload&&p,g=e.videoFromUrl||null,m=e.onKeyDown||null,v=e.onKeyPress||null,b=e.onKeyUp||null,y=e.onAutocomplete||null,w=r(t,i,o,s,a,l,c,u,d,h,p,f,g,m,v,b,y);t.data("wysiwyg",w)}});if(1==this.length){var i=this.data("wysiwyg");if(!i)return this;if("container"==e)return i.$container;if("shell"==e)return i.wysiwygeditor}return this}}),function(e,t,n){"use strict";function i(e){return function(){var t,n,i=arguments[0],o="["+(e?e+":":"")+i+"] ",r=arguments[1],s=arguments,a=function(e){return"function"==typeof e?e.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof e?"undefined":"string"!=typeof e?JSON.stringify(e):e};for(t=o+r.replace(/\{\d+\}/g,function(e){var t,n=+e.slice(1,-1);return n+2<s.length?(t=s[n+2],"function"==typeof t?t.toString().replace(/ ?\{[\s\S]*$/,""):"undefined"==typeof t?"undefined":"string"!=typeof t?W(t):t):e}),t=t+"\nhttp://errors.angularjs.org/1.2.25/"+(e?e+"/":"")+i,n=2;n<arguments.length;n++)t=t+(2==n?"?":"&")+"p"+(n-2)+"="+encodeURIComponent(a(arguments[n]));return new Error(t)}}function o(e){if(null==e||k(e))return!1;var t=e.length;return 1===e.nodeType&&t?!0:w(e)||Dn(e)||0===t||"number"==typeof t&&t>0&&t-1 in e}function r(e,t,n){var i;if(e)if(x(e))for(i in e)"prototype"==i||"length"==i||"name"==i||e.hasOwnProperty&&!e.hasOwnProperty(i)||t.call(n,e[i],i);else if(Dn(e)||o(e))for(i=0;i<e.length;i++)t.call(n,e[i],i);else if(e.forEach&&e.forEach!==r)e.forEach(t,n);else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i);return e}function s(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}function a(e,t,n){for(var i=s(e),o=0;o<i.length;o++)t.call(n,e[i[o]],i[o]);return i}function l(e){return function(t,n){e(n,t)}}function c(){for(var e,t=En.length;t;){if(t--,e=En[t].charCodeAt(0),57==e)return En[t]="A",En.join("");if(90!=e)return En[t]=String.fromCharCode(e+1),En.join("");En[t]="0"}return En.unshift("0"),En.join("")}function u(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function d(e){var t=e.$$hashKey;return r(arguments,function(t){t!==e&&r(t,function(t,n){e[n]=t})}),u(e,t),e}function h(e){return parseInt(e,10)}function p(e,t){return d(new(d(function(){},{prototype:e})),t)}function f(){}function g(e){return e}function m(e){return function(){return e}}function v(e){return"undefined"==typeof e}function b(e){return"undefined"!=typeof e}function y(e){return null!=e&&"object"==typeof e}function w(e){return"string"==typeof e}function C(e){return"number"==typeof e}function _(e){return"[object Date]"===kn.call(e)}function x(e){return"function"==typeof e}function S(e){return"[object RegExp]"===kn.call(e)}function k(e){return e&&e.document&&e.location&&e.alert&&e.setInterval}function T(e){return e&&e.$evalAsync&&e.$watch}function $(e){return"[object File]"===kn.call(e)}function E(e){return"[object Blob]"===kn.call(e)}function D(e){return e&&x(e.then)}function I(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}function M(e,t,n){var i=[];return r(e,function(e,o,r){i.push(t.call(n,e,o,r))}),i}function A(e,t){return-1!=O(e,t)}function O(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}function R(e,t){var n=O(e,t);return n>=0&&e.splice(n,1),t}function P(e,t,n,i){if(k(e)||T(e))throw Tn("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");if(t){if(e===t)throw Tn("cpi","Can't copy! Source and destination are identical.");if(n=n||[],i=i||[],y(e)){var o=O(n,e);if(-1!==o)return i[o];n.push(e),i.push(t)}var s;if(Dn(e)){t.length=0;for(var a=0;a<e.length;a++)s=P(e[a],null,n,i),y(e[a])&&(n.push(e[a]),i.push(s)),t.push(s)}else{var l=t.$$hashKey;Dn(t)?t.length=0:r(t,function(e,n){delete t[n]});for(var c in e)s=P(e[c],null,n,i),y(e[c])&&(n.push(e[c]),i.push(s)),t[c]=s;u(t,l)}}else t=e,e&&(Dn(e)?t=P(e,[],n,i):_(e)?t=new Date(e.getTime()):S(e)?(t=new RegExp(e.source,e.toString().match(/[^\/]*$/)[0]),t.lastIndex=e.lastIndex):y(e)&&(t=P(e,{},n,i)));return t}function N(e,t){if(Dn(e)){t=t||[];for(var n=0;n<e.length;n++)t[n]=e[n]}else if(y(e)){t=t||{};for(var i in e)!fn.call(e,i)||"$"===i.charAt(0)&&"$"===i.charAt(1)||(t[i]=e[i])}return t||e}function L(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!==e&&t!==t)return!0;var i,o,r,s=typeof e,a=typeof t;if(s==a&&"object"==s){if(!Dn(e)){if(_(e))return _(t)?isNaN(e.getTime())&&isNaN(t.getTime())||e.getTime()===t.getTime():!1;if(S(e)&&S(t))return e.toString()==t.toString();if(T(e)||T(t)||k(e)||k(t)||Dn(t))return!1;r={};for(o in e)if("$"!==o.charAt(0)&&!x(e[o])){if(!L(e[o],t[o]))return!1;r[o]=!0}for(o in t)if(!r.hasOwnProperty(o)&&"$"!==o.charAt(0)&&t[o]!==n&&!x(t[o]))return!1;return!0}if(!Dn(t))return!1;if((i=e.length)==t.length){for(o=0;i>o;o++)if(!L(e[o],t[o]))return!1;return!0}}return!1}function F(e,t,n){return e.concat(xn.call(t,n))}function U(e,t){return xn.call(e,t||0)}function j(e,t){var n=arguments.length>2?U(arguments,2):[];return!x(t)||t instanceof RegExp?t:n.length?function(){return arguments.length?t.apply(e,n.concat(xn.call(arguments,0))):t.apply(e,n)}:function(){return arguments.length?t.apply(e,arguments):t.call(e)}}function H(e,i){var o=i;return"string"==typeof e&&"$"===e.charAt(0)?o=n:k(i)?o="$WINDOW":i&&t===i?o="$DOCUMENT":T(i)&&(o="$SCOPE"),o}function W(e,t){return"undefined"==typeof e?n:JSON.stringify(e,H,t?"  ":null)}function B(e){return w(e)?JSON.parse(e):e}function V(e){if("function"==typeof e)e=!0;else if(e&&0!==e.length){var t=pn(""+e);e=!("f"==t||"0"==t||"false"==t||"no"==t||"n"==t||"[]"==t)}else e=!1;return e}function z(e){e=yn(e).clone();try{e.empty()}catch(t){}var n=3,i=yn("<div>").append(e).html();try{return e[0].nodeType===n?pn(i):i.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(e,t){return"<"+pn(t)})}catch(t){return pn(i)}}function q(e){try{return decodeURIComponent(e)}catch(t){}}function Y(e){var t,n,i={};return r((e||"").split("&"),function(e){if(e&&(t=e.replace(/\+/g,"%20").split("="),n=q(t[0]),b(n))){var o=b(t[1])?q(t[1]):!0;fn.call(i,n)?Dn(i[n])?i[n].push(o):i[n]=[i[n],o]:i[n]=o}}),i}function G(e){var t=[];return r(e,function(e,n){Dn(e)?r(e,function(e){t.push(Q(n,!0)+(e===!0?"":"="+Q(e,!0)))}):t.push(Q(n,!0)+(e===!0?"":"="+Q(e,!0)))}),t.length?t.join("&"):""}function K(e){return Q(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function Q(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function X(e,n){function i(e){e&&a.push(e)}var o,s,a=[e],l=["ng:app","ng-app","x-ng-app","data-ng-app"],c=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;r(l,function(n){l[n]=!0,i(t.getElementById(n)),n=n.replace(":","\\:"),e.querySelectorAll&&(r(e.querySelectorAll("."+n),i),r(e.querySelectorAll("."+n+"\\:"),i),r(e.querySelectorAll("["+n+"]"),i))}),r(a,function(e){if(!o){var t=" "+e.className+" ",n=c.exec(t);n?(o=e,s=(n[2]||"").replace(/\s+/g,",")):r(e.attributes,function(t){!o&&l[t.name]&&(o=e,s=t.value)})}}),o&&n(o,s?[s]:[])}function J(n,i){var o=function(){if(n=yn(n),n.injector()){var e=n[0]===t?"document":z(n);throw Tn("btstrpd","App Already Bootstrapped with this Element '{0}'",e.replace(/</,"&lt;").replace(/>/,"&gt;"))}i=i||[],i.unshift(["$provide",function(e){e.value("$rootElement",n)}]),i.unshift("ng");var o=Oe(i);return o.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(e,t,n,i,o){e.$apply(function(){t.data("$injector",i),n(t)(e)})}]),o},s=/^NG_DEFER_BOOTSTRAP!/;return e&&!s.test(e.name)?o():(e.name=e.name.replace(s,""),void($n.resumeBootstrap=function(e){r(e,function(e){i.push(e)}),o()}))}function Z(e,t){return t=t||"_",e.replace(An,function(e,n){return(n?t:"")+e.toLowerCase()})}function ee(){wn=e.jQuery,wn&&wn.fn.on?(yn=wn,d(wn.fn,{scope:qn.scope,isolateScope:qn.isolateScope,controller:qn.controller,injector:qn.injector,inheritedData:qn.inheritedData}),ue("remove",!0,!0,!1),ue("empty",!1,!1,!1),ue("html",!1,!1,!0)):yn=fe,$n.element=yn}function te(e,t,n){if(!e)throw Tn("areq","Argument '{0}' is {1}",t||"?",n||"required");return e}function ne(e,t,n){return n&&Dn(e)&&(e=e[e.length-1]),te(x(e),t,"not a function, got "+(e&&"object"==typeof e?e.constructor.name||"Object":typeof e)),e}function ie(e,t){if("hasOwnProperty"===e)throw Tn("badname","hasOwnProperty is not a valid {0} name",t)}function oe(e,t,n){if(!t)return e;for(var i,o=t.split("."),r=e,s=o.length,a=0;s>a;a++)i=o[a],e&&(e=(r=e)[i]);return!n&&x(e)?j(r,e):e}function re(e){var t=e[0],n=e[e.length-1];if(t===n)return yn(t);var i=t,o=[i];do{if(i=i.nextSibling,!i)break;o.push(i)}while(i!==n);return yn(o)}function se(e){function t(e,t,n){return e[t]||(e[t]=n())}var n=i("$injector"),o=i("ng"),r=t(e,"angular",Object);return r.$$minErr=r.$$minErr||i,t(r,"module",function(){var e={};return function(i,r,s){var a=function(e,t){if("hasOwnProperty"===e)throw o("badname","hasOwnProperty is not a valid {0} name",t)};return a(i,"module"),r&&e.hasOwnProperty(i)&&(e[i]=null),t(e,i,function(){function e(e,n,i){return function(){return t[i||"push"]([e,n,arguments]),l}}if(!r)throw n("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",i);var t=[],o=[],a=e("$injector","invoke"),l={_invokeQueue:t,_runBlocks:o,requires:r,name:i,provider:e("$provide","provider"),factory:e("$provide","factory"),service:e("$provide","service"),value:e("$provide","value"),constant:e("$provide","constant","unshift"),animation:e("$animateProvider","register"),filter:e("$filterProvider","register"),controller:e("$controllerProvider","register"),directive:e("$compileProvider","directive"),config:a,run:function(e){return o.push(e),this}};return s&&a(s),l})}})}function ae(t){d(t,{bootstrap:J,copy:P,extend:d,equals:L,element:yn,forEach:r,injector:Oe,noop:f,bind:j,toJson:W,fromJson:B,identity:g,isUndefined:v,isDefined:b,isString:w,isFunction:x,isObject:y,isNumber:C,isElement:I,isArray:Dn,version:On,isDate:_,lowercase:pn,uppercase:gn,callbacks:{counter:0},$$minErr:i,$$csp:Mn}),Cn=se(e);try{Cn("ngLocale")}catch(n){Cn("ngLocale",[]).provider("$locale",nt)}Cn("ng",["ngLocale"],["$provide",function(e){e.provider({$$sanitizeUri:Et}),e.provider("$compile",je).directive({a:Di,input:ji,textarea:ji,form:Oi,script:xo,select:To,style:Eo,option:$o,ngBind:Ji,ngBindHtml:eo,ngBindTemplate:Zi,ngClass:to,ngClassEven:io,ngClassOdd:no,ngCloak:oo,ngController:ro,ngForm:Ri,ngHide:vo,ngIf:lo,ngInclude:co,ngInit:ho,ngNonBindable:po,ngPluralize:fo,ngRepeat:go,ngShow:mo,ngStyle:bo,ngSwitch:yo,ngSwitchWhen:wo,ngSwitchDefault:Co,ngOptions:ko,ngTransclude:_o,ngModel:qi,ngList:Ki,ngChange:Yi,required:Gi,ngRequired:Gi,ngValue:Xi}).directive({ngInclude:uo}).directive(Ii).directive(so),e.provider({$anchorScroll:Re,$animate:ti,$browser:Le,$cacheFactory:Fe,$controller:Be,$document:Ve,$exceptionHandler:ze,$filter:Ut,$interpolate:et,$interval:tt,$http:Qe,$httpBackend:Je,$location:gt,$log:mt,$parse:xt,$rootScope:$t,$q:St,$sce:Ot,$sceDelegate:At,$sniffer:Rt,$templateCache:Ue,$timeout:Pt,$window:Ft,$$rAF:Tt,$$asyncCallback:Pe})}])}function le(){return++Pn}function ce(e){return e.replace(Fn,function(e,t,n,i){return i?n.toUpperCase():n}).replace(Un,"Moz$1")}function ue(e,t,n,i){function o(e){var o,s,a,l,c,u,d,h=n&&e?[this.filter(e)]:[this],p=t;if(!i||null!=e)for(;h.length;)for(o=h.shift(),s=0,a=o.length;a>s;s++)for(l=yn(o[s]),p?l.triggerHandler("$destroy"):p=!p,c=0,u=(d=l.children()).length;u>c;c++)h.push(wn(d[c]));return r.apply(this,arguments)}var r=wn.fn[e];r=r.$original||r,o.$original=r,wn.fn[e]=o}function de(e){return!Wn.test(e)}function he(e,t){var n,i,o,r,s,a,l=t.createDocumentFragment(),c=[];if(de(e))c.push(t.createTextNode(e));else{for(n=l.appendChild(t.createElement("div")),i=(Bn.exec(e)||["",""])[1].toLowerCase(),o=zn[i]||zn._default,n.innerHTML="<div>&#160;</div>"+o[1]+e.replace(Vn,"<$1></$2>")+o[2],n.removeChild(n.firstChild),r=o[0];r--;)n=n.lastChild;for(s=0,a=n.childNodes.length;a>s;++s)c.push(n.childNodes[s]);n=l.firstChild,n.textContent=""}return l.textContent="",l.innerHTML="",c}function pe(e,n){n=n||t;var i;return(i=Hn.exec(e))?[n.createElement(i[1])]:he(e,n)}function fe(e){if(e instanceof fe)return e;if(w(e)&&(e=In(e)),!(this instanceof fe)){if(w(e)&&"<"!=e.charAt(0))throw jn("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new fe(e)}if(w(e)){Se(this,pe(e));var n=yn(t.createDocumentFragment());n.append(this)}else Se(this,e)}function ge(e){return e.cloneNode(!0)}function me(e){be(e);for(var t=0,n=e.childNodes||[];t<n.length;t++)me(n[t])}function ve(e,t,n,i){if(b(i))throw jn("offargs","jqLite#off() does not support the `selector` argument");var o=ye(e,"events"),s=ye(e,"handle");s&&(v(t)?r(o,function(t,n){Ln(e,n,t),delete o[n]}):r(t.split(" "),function(t){v(n)?(Ln(e,t,o[t]),delete o[t]):R(o[t]||[],n)}))}function be(e,t){var i=e.ng339,o=Rn[i];if(o){if(t)return void delete Rn[i].data[t];o.handle&&(o.events.$destroy&&o.handle({},"$destroy"),ve(e)),delete Rn[i],e.ng339=n}}function ye(e,t,n){var i=e.ng339,o=Rn[i||-1];return b(n)?(o||(e.ng339=i=le(),o=Rn[i]={}),void(o[t]=n)):o&&o[t]}function we(e,t,n){var i=ye(e,"data"),o=b(n),r=!o&&b(t),s=r&&!y(t);if(i||s||ye(e,"data",i={}),o)i[t]=n;else{if(!r)return i;if(s)return i&&i[t];d(i,t)}}function Ce(e,t){return e.getAttribute?(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+t+" ")>-1:!1}function _e(e,t){t&&e.setAttribute&&r(t.split(" "),function(t){e.setAttribute("class",In((" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+In(t)+" "," ")))})}function xe(e,t){if(t&&e.setAttribute){var n=(" "+(e.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");r(t.split(" "),function(e){e=In(e),-1===n.indexOf(" "+e+" ")&&(n+=e+" ")}),e.setAttribute("class",In(n))}}function Se(e,t){if(t){t=t.nodeName||!b(t.length)||k(t)?[t]:t;for(var n=0;n<t.length;n++)e.push(t[n])}}function ke(e,t){return Te(e,"$"+(t||"ngController")+"Controller")}function Te(e,t,i){9==e.nodeType&&(e=e.documentElement);for(var o=Dn(t)?t:[t];e;){for(var r=0,s=o.length;s>r;r++)if((i=yn.data(e,o[r]))!==n)return i;e=e.parentNode||11===e.nodeType&&e.host}}function $e(e){for(var t=0,n=e.childNodes;t<n.length;t++)me(n[t]);for(;e.firstChild;)e.removeChild(e.firstChild)}function Ee(e,t){var n=Yn[t.toLowerCase()];return n&&Gn[e.nodeName]&&n}function De(e,n){var i=function(i,o){if(i.preventDefault||(i.preventDefault=function(){i.returnValue=!1}),i.stopPropagation||(i.stopPropagation=function(){i.cancelBubble=!0}),i.target||(i.target=i.srcElement||t),v(i.defaultPrevented)){var s=i.preventDefault;i.preventDefault=function(){i.defaultPrevented=!0,s.call(i)},i.defaultPrevented=!1}i.isDefaultPrevented=function(){return i.defaultPrevented||i.returnValue===!1};var a=N(n[o||i.type]||[]);r(a,function(t){t.call(e,i)}),8>=bn?(i.preventDefault=null,i.stopPropagation=null,i.isDefaultPrevented=null):(delete i.preventDefault,delete i.stopPropagation,delete i.isDefaultPrevented)};return i.elem=e,i}function Ie(e,t){var i,o=typeof e;return"function"==o||"object"==o&&null!==e?"function"==typeof(i=e.$$hashKey)?i=e.$$hashKey():i===n&&(i=e.$$hashKey=(t||c)()):i=e,o+":"+i}function Me(e,t){if(t){var n=0;this.nextUid=function(){return++n}}r(e,this.put,this)}function Ae(e){var t,n,i,o;return"function"==typeof e?(t=e.$inject)||(t=[],e.length&&(n=e.toString().replace(Jn,""),i=n.match(Kn),r(i[1].split(Qn),function(e){e.replace(Xn,function(e,n,i){t.push(i)})})),e.$inject=t):Dn(e)?(o=e.length-1,
ne(e[o],"fn"),t=e.slice(0,o)):ne(e,"fn",!0),t}function Oe(e){function t(e){return function(t,n){return y(t)?void r(t,l(e)):e(t,n)}}function n(e,t){if(ie(e,"service"),(x(t)||Dn(t))&&(t=C.instantiate(t)),!t.$get)throw Zn("pget","Provider '{0}' must define $get factory method.",e);return b[e+p]=t}function i(e,t){return n(e,{$get:t})}function o(e,t){return i(e,["$injector",function(e){return e.instantiate(t)}])}function s(e,t){return i(e,m(t))}function a(e,t){ie(e,"constant"),b[e]=t,_[e]=t}function c(e,t){var n=C.get(e+p),i=n.$get;n.$get=function(){var e=S.invoke(i,n);return S.invoke(t,null,{$delegate:e})}}function u(e){var t,n,i,o,s=[];return r(e,function(e){if(!v.get(e)){v.put(e,!0);try{if(w(e))for(t=Cn(e),s=s.concat(u(t.requires)).concat(t._runBlocks),n=t._invokeQueue,i=0,o=n.length;o>i;i++){var r=n[i],a=C.get(r[0]);a[r[1]].apply(a,r[2])}else x(e)?s.push(C.invoke(e)):Dn(e)?s.push(C.invoke(e)):ne(e,"module")}catch(l){throw Dn(e)&&(e=e[e.length-1]),l.message&&l.stack&&-1==l.stack.indexOf(l.message)&&(l=l.message+"\n"+l.stack),Zn("modulerr","Failed to instantiate module {0} due to:\n{1}",e,l.stack||l.message||l)}}}),s}function d(e,t){function n(n){if(e.hasOwnProperty(n)){if(e[n]===h)throw Zn("cdep","Circular dependency found: {0}",n+" <- "+g.join(" <- "));return e[n]}try{return g.unshift(n),e[n]=h,e[n]=t(n)}catch(i){throw e[n]===h&&delete e[n],i}finally{g.shift()}}function i(e,t,i){var o,r,s,a=[],l=Ae(e);for(r=0,o=l.length;o>r;r++){if(s=l[r],"string"!=typeof s)throw Zn("itkn","Incorrect injection token! Expected service name as string, got {0}",s);a.push(i&&i.hasOwnProperty(s)?i[s]:n(s))}return Dn(e)&&(e=e[o]),e.apply(t,a)}function o(e,t){var n,o,r=function(){};return r.prototype=(Dn(e)?e[e.length-1]:e).prototype,n=new r,o=i(e,n,t),y(o)||x(o)?o:n}return{invoke:i,instantiate:o,get:n,annotate:Ae,has:function(t){return b.hasOwnProperty(t+p)||e.hasOwnProperty(t)}}}var h={},p="Provider",g=[],v=new Me([],!0),b={$provide:{provider:t(n),factory:t(i),service:t(o),value:t(s),constant:t(a),decorator:c}},C=b.$injector=d(b,function(){throw Zn("unpr","Unknown provider: {0}",g.join(" <- "))}),_={},S=_.$injector=d(_,function(e){var t=C.get(e+p);return S.invoke(t.$get,t)});return r(u(e),function(e){S.invoke(e||f)}),S}function Re(){var e=!0;this.disableAutoScrolling=function(){e=!1},this.$get=["$window","$location","$rootScope",function(t,n,i){function o(e){var t=null;return r(e,function(e){t||"a"!==pn(e.nodeName)||(t=e)}),t}function s(){var e,i=n.hash();i?(e=a.getElementById(i))?e.scrollIntoView():(e=o(a.getElementsByName(i)))?e.scrollIntoView():"top"===i&&t.scrollTo(0,0):t.scrollTo(0,0)}var a=t.document;return e&&i.$watch(function(){return n.hash()},function(){i.$evalAsync(s)}),s}]}function Pe(){this.$get=["$$rAF","$timeout",function(e,t){return e.supported?function(t){return e(t)}:function(e){return t(e,0,!1)}}]}function Ne(e,t,i,o){function s(e){try{e.apply(null,U(arguments,1))}finally{if(b--,0===b)for(;y.length;)try{y.pop()()}catch(t){i.error(t)}}}function a(e,t){!function n(){r(_,function(e){e()}),C=t(n,e)}()}function l(){k=null,x!=c.url()&&(x=c.url(),r(T,function(e){e(c.url())}))}var c=this,u=t[0],d=e.location,h=e.history,p=e.setTimeout,g=e.clearTimeout,m={};c.isMock=!1;var b=0,y=[];c.$$completeOutstandingRequest=s,c.$$incOutstandingRequestCount=function(){b++},c.notifyWhenNoOutstandingRequests=function(e){r(_,function(e){e()}),0===b?e():y.push(e)};var C,_=[];c.addPollFn=function(e){return v(C)&&a(100,p),_.push(e),e};var x=d.href,S=t.find("base"),k=null;c.url=function(t,n){if(d!==e.location&&(d=e.location),h!==e.history&&(h=e.history),t){if(x==t)return;return x=t,o.history?n?h.replaceState(null,"",t):(h.pushState(null,"",t),S.attr("href",S.attr("href"))):(k=t,n?d.replace(t):d.href=t),c}return k||d.href.replace(/%27/g,"'")};var T=[],$=!1;c.onUrlChange=function(t){return $||(o.history&&yn(e).on("popstate",l),o.hashchange?yn(e).on("hashchange",l):c.addPollFn(l),$=!0),T.push(t),t},c.$$checkUrlChange=l,c.baseHref=function(){var e=S.attr("href");return e?e.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var E={},D="",I=c.baseHref();c.cookies=function(e,t){var o,r,s,a,l;if(!e){if(u.cookie!==D)for(D=u.cookie,r=D.split("; "),E={},a=0;a<r.length;a++)s=r[a],l=s.indexOf("="),l>0&&(e=unescape(s.substring(0,l)),E[e]===n&&(E[e]=unescape(s.substring(l+1))));return E}t===n?u.cookie=escape(e)+"=;path="+I+";expires=Thu, 01 Jan 1970 00:00:00 GMT":w(t)&&(o=(u.cookie=escape(e)+"="+escape(t)+";path="+I).length+1,o>4096&&i.warn("Cookie '"+e+"' possibly not set or overflowed because it was too large ("+o+" > 4096 bytes)!"))},c.defer=function(e,t){var n;return b++,n=p(function(){delete m[n],s(e)},t||0),m[n]=!0,n},c.defer.cancel=function(e){return m[e]?(delete m[e],g(e),s(f),!0):!1}}function Le(){this.$get=["$window","$log","$sniffer","$document",function(e,t,n,i){return new Ne(e,i,t,n)}]}function Fe(){this.$get=function(){function e(e,n){function o(e){e!=h&&(p?p==e&&(p=e.n):p=e,r(e.n,e.p),r(e,h),h=e,h.n=null)}function r(e,t){e!=t&&(e&&(e.p=t),t&&(t.n=e))}if(e in t)throw i("$cacheFactory")("iid","CacheId '{0}' is already taken!",e);var s=0,a=d({},n,{id:e}),l={},c=n&&n.capacity||Number.MAX_VALUE,u={},h=null,p=null;return t[e]={put:function(e,t){if(c<Number.MAX_VALUE){var n=u[e]||(u[e]={key:e});o(n)}return v(t)?void 0:(e in l||s++,l[e]=t,s>c&&this.remove(p.key),t)},get:function(e){if(c<Number.MAX_VALUE){var t=u[e];if(!t)return;o(t)}return l[e]},remove:function(e){if(c<Number.MAX_VALUE){var t=u[e];if(!t)return;t==h&&(h=t.p),t==p&&(p=t.n),r(t.n,t.p),delete u[e]}delete l[e],s--},removeAll:function(){l={},s=0,u={},h=p=null},destroy:function(){l=null,a=null,u=null,delete t[e]},info:function(){return d({},a,{size:s})}}}var t={};return e.info=function(){var e={};return r(t,function(t,n){e[n]=t.info()}),e},e.get=function(e){return t[e]},e}}function Ue(){this.$get=["$cacheFactory",function(e){return e("templates")}]}function je(e,i){var o={},s="Directive",a=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,c=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,u=/^(on[a-z]+|formaction)$/;this.directive=function h(t,n){return ie(t,"directive"),w(t)?(te(n,"directiveFactory"),o.hasOwnProperty(t)||(o[t]=[],e.factory(t+s,["$injector","$exceptionHandler",function(e,n){var i=[];return r(o[t],function(o,r){try{var s=e.invoke(o);x(s)?s={compile:m(s)}:!s.compile&&s.link&&(s.compile=m(s.link)),s.priority=s.priority||0,s.index=r,s.name=s.name||t,s.require=s.require||s.controller&&s.name,s.restrict=s.restrict||"A",i.push(s)}catch(a){n(a)}}),i}])),o[t].push(n)):r(t,l(h)),this},this.aHrefSanitizationWhitelist=function(e){return b(e)?(i.aHrefSanitizationWhitelist(e),this):i.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(e){return b(e)?(i.imgSrcSanitizationWhitelist(e),this):i.imgSrcSanitizationWhitelist()},this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(e,i,l,h,f,m,v,b,C,_,S,k){function T(e,t,n,i,o){e instanceof yn||(e=yn(e)),r(e,function(t,n){3==t.nodeType&&t.nodeValue.match(/\S+/)&&(e[n]=t=yn(t).wrap("<span></span>").parent()[0])});var s=E(e,t,e,n,i,o);return $(e,"ng-scope"),function(t,n,i,o){te(t,"scope");var a=n?qn.clone.call(e):e;r(i,function(e,t){a.data("$"+t+"Controller",e)});for(var l=0,c=a.length;c>l;l++){var u=a[l],d=u.nodeType;(1===d||9===d)&&a.eq(l).data("$scope",t)}return n&&n(a,t),s&&s(t,a,a,o),a}}function $(e,t){try{e.addClass(t)}catch(n){}}function E(e,t,i,o,r,s){function a(e,i,o,r){var s,a,l,c,u,d,h,p,g=i.length,m=new Array(g);for(u=0;g>u;u++)m[u]=i[u];for(u=0,h=0,d=f.length;d>u;h++)l=m[h],s=f[u++],a=f[u++],s?(s.scope?(c=e.$new(),yn.data(l,"$scope",c)):c=e,p=s.transcludeOnThisElement?D(e,s.transclude,r):!s.templateOnThisElement&&r?r:!r&&t?D(e,t):null,s(a,c,l,o,p)):a&&a(e,l.childNodes,n,r)}for(var l,c,u,d,h,p,f=[],g=0;g<e.length;g++)l=new K,c=I(e[g],[],l,0===g?o:n,r),u=c.length?O(c,e[g],l,t,i,null,[],[],s):null,u&&u.scope&&$(l.$$element,"ng-scope"),h=u&&u.terminal||!(d=e[g].childNodes)||!d.length?null:E(d,u?(u.transcludeOnThisElement||!u.templateOnThisElement)&&u.transclude:t),f.push(u,h),p=p||u||h,s=null;return p?a:null}function D(e,t,n){var i=function(i,o,r){var s=!1;i||(i=e.$new(),i.$$transcluded=!0,s=!0);var a=t(i,o,r,n);return s&&a.on("$destroy",function(){i.$destroy()}),a};return i}function I(e,t,n,i,o){var r,s,l=e.nodeType,u=n.$attr;switch(l){case 1:P(t,He(_n(e).toLowerCase()),"E",i,o);for(var d,h,p,f,g,m,v=e.attributes,b=0,y=v&&v.length;y>b;b++){var C=!1,_=!1;if(d=v[b],!bn||bn>=8||d.specified){h=d.name,g=In(d.value),f=He(h),(m=ee.test(f))&&(h=Z(f.substr(6),"-"));var x=f.replace(/(Start|End)$/,"");f===x+"Start"&&(C=h,_=h.substr(0,h.length-5)+"end",h=h.substr(0,h.length-6)),p=He(h.toLowerCase()),u[p]=h,(m||!n.hasOwnProperty(p))&&(n[p]=g,Ee(e,p)&&(n[p]=!0)),q(e,t,g,p),P(t,p,"A",i,o,C,_)}}if(s=e.className,w(s)&&""!==s)for(;r=c.exec(s);)p=He(r[2]),P(t,p,"C",i,o)&&(n[p]=In(r[3])),s=s.substr(r.index+r[0].length);break;case 3:B(t,e.nodeValue);break;case 8:try{r=a.exec(e.nodeValue),r&&(p=He(r[1]),P(t,p,"M",i,o)&&(n[p]=In(r[2])))}catch(S){}}return t.sort(H),t}function M(e,t,n){var i=[],o=0;if(t&&e.hasAttribute&&e.hasAttribute(t)){do{if(!e)throw ni("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",t,n);1==e.nodeType&&(e.hasAttribute(t)&&o++,e.hasAttribute(n)&&o--),i.push(e),e=e.nextSibling}while(o>0)}else i.push(e);return yn(i)}function A(e,t,n){return function(i,o,r,s,a){return o=M(o[0],t,n),e(i,o,r,s,a)}}function O(e,o,s,a,c,u,d,h,p){function f(e,t,n,i){e&&(n&&(e=A(e,n,i)),e.require=_.require,e.directiveName=S,(H===_||_.$$isolateScope)&&(e=G(e,{isolateScope:!0})),d.push(e)),t&&(n&&(t=A(t,n,i)),t.require=_.require,t.directiveName=S,(H===_||_.$$isolateScope)&&(t=G(t,{isolateScope:!0})),h.push(t))}function g(e,t,n,i){var o,s="data",a=!1;if(w(t)){for(;"^"==(o=t.charAt(0))||"?"==o;)t=t.substr(1),"^"==o&&(s="inheritedData"),a=a||"?"==o;if(o=null,i&&"data"===s&&(o=i[t]),o=o||n[s]("$"+t+"Controller"),!o&&!a)throw ni("ctreq","Controller '{0}', required by directive '{1}', can't be found!",t,e);return o}return Dn(t)&&(o=[],r(t,function(t){o.push(g(e,t,n,i))})),o}function b(e,t,a,c,u){function p(e,t){var i;return arguments.length<2&&(t=e,e=n),X&&(i=k),u(e,t,i)}var f,b,y,w,C,_,x,S,k={};if(f=o===a?s:N(s,new K(yn(a),s.$attr)),b=f.$$element,H){var T=/^\s*([@=&])(\??)\s*(\w*)\s*$/;x=t.$new(!0),!B||B!==H&&B!==H.$$originalDirective?b.data("$isolateScopeNoTemplate",x):b.data("$isolateScope",x),$(b,"ng-isolate-scope"),r(H.scope,function(e,n){var o,r,s,a,l=e.match(T)||[],c=l[3]||n,u="?"==l[2],d=l[1];switch(x.$$isolateBindings[n]=d+c,d){case"@":f.$observe(c,function(e){x[n]=e}),f.$$observers[c].$$scope=t,f[c]&&(x[n]=i(f[c])(t));break;case"=":if(u&&!f[c])return;r=m(f[c]),a=r.literal?L:function(e,t){return e===t||e!==e&&t!==t},s=r.assign||function(){throw o=x[n]=r(t),ni("nonassign","Expression '{0}' used with directive '{1}' is non-assignable!",f[c],H.name)},o=x[n]=r(t),x.$watch(function(){var e=r(t);return a(e,x[n])||(a(e,o)?s(t,e=x[n]):x[n]=e),o=e},null,r.literal);break;case"&":r=m(f[c]),x[n]=function(e){return r(t,e)};break;default:throw ni("iscp","Invalid isolate scope definition for directive '{0}'. Definition: {... {1}: '{2}' ...}",H.name,n,e)}})}for(S=u&&p,P&&r(P,function(e){var n,i={$scope:e===H||e.$$isolateScope?x:t,$element:b,$attrs:f,$transclude:S};_=e.controller,"@"==_&&(_=f[e.name]),n=v(_,i),k[e.name]=n,X||b.data("$"+e.name+"Controller",n),e.controllerAs&&(i.$scope[e.controllerAs]=n)}),y=0,w=d.length;w>y;y++)try{(C=d[y])(C.isolateScope?x:t,b,f,C.require&&g(C.directiveName,C.require,b,k),S)}catch(E){l(E,z(b))}var D=t;for(H&&(H.template||null===H.templateUrl)&&(D=x),e&&e(D,a.childNodes,n,u),y=h.length-1;y>=0;y--)try{(C=h[y])(C.isolateScope?x:t,b,f,C.require&&g(C.directiveName,C.require,b,k),S)}catch(E){l(E,z(b))}}p=p||{};for(var C,_,S,k,E,D,O=-Number.MAX_VALUE,P=p.controllerDirectives,H=p.newIsolateScopeDirective,B=p.templateDirective,V=p.nonTlbTranscludeDirective,q=!1,Q=!1,X=p.hasElementTranscludeDirective,Z=s.$$element=yn(o),ee=u,te=a,ne=0,ie=e.length;ie>ne;ne++){_=e[ne];var oe=_.$$start,re=_.$$end;if(oe&&(Z=M(o,oe,re)),k=n,O>_.priority)break;if((D=_.scope)&&(C=C||_,_.templateUrl||(W("new/isolated scope",H,_,Z),y(D)&&(H=_))),S=_.name,!_.templateUrl&&_.controller&&(D=_.controller,P=P||{},W("'"+S+"' controller",P[S],_,Z),P[S]=_),(D=_.transclude)&&(q=!0,_.$$tlb||(W("transclusion",V,_,Z),V=_),"element"==D?(X=!0,O=_.priority,k=Z,Z=s.$$element=yn(t.createComment(" "+S+": "+s[S]+" ")),o=Z[0],Y(c,U(k),o),te=T(k,a,O,ee&&ee.name,{nonTlbTranscludeDirective:V})):(k=yn(ge(o)).contents(),Z.empty(),te=T(k,a))),_.template)if(Q=!0,W("template",B,_,Z),B=_,D=x(_.template)?_.template(Z,s):_.template,D=J(D),_.replace){if(ee=_,k=de(D)?[]:yn(In(D)),o=k[0],1!=k.length||1!==o.nodeType)throw ni("tplrt","Template for directive '{0}' must have exactly one root element. {1}",S,"");Y(c,Z,o);var se={$attr:{}},ae=I(o,[],se),le=e.splice(ne+1,e.length-(ne+1));H&&R(ae),e=e.concat(ae).concat(le),F(s,se),ie=e.length}else Z.html(D);if(_.templateUrl)Q=!0,W("template",B,_,Z),B=_,_.replace&&(ee=_),b=j(e.splice(ne,e.length-ne),Z,s,c,q&&te,d,h,{controllerDirectives:P,newIsolateScopeDirective:H,templateDirective:B,nonTlbTranscludeDirective:V}),ie=e.length;else if(_.compile)try{E=_.compile(Z,s,te),x(E)?f(null,E,oe,re):E&&f(E.pre,E.post,oe,re)}catch(ce){l(ce,z(Z))}_.terminal&&(b.terminal=!0,O=Math.max(O,_.priority))}return b.scope=C&&C.scope===!0,b.transcludeOnThisElement=q,b.templateOnThisElement=Q,b.transclude=te,p.hasElementTranscludeDirective=X,b}function R(e){for(var t=0,n=e.length;n>t;t++)e[t]=p(e[t],{$$isolateScope:!0})}function P(t,i,r,a,c,u,d){if(i===c)return null;var h=null;if(o.hasOwnProperty(i))for(var f,g=e.get(i+s),m=0,v=g.length;v>m;m++)try{f=g[m],(a===n||a>f.priority)&&-1!=f.restrict.indexOf(r)&&(u&&(f=p(f,{$$start:u,$$end:d})),t.push(f),h=f)}catch(b){l(b)}return h}function F(e,t){var n=t.$attr,i=e.$attr,o=e.$$element;r(e,function(i,o){"$"!=o.charAt(0)&&(t[o]&&t[o]!==i&&(i+=("style"===o?";":" ")+t[o]),e.$set(o,i,!0,n[o]))}),r(t,function(t,r){"class"==r?($(o,t),e["class"]=(e["class"]?e["class"]+" ":"")+t):"style"==r?(o.attr("style",o.attr("style")+";"+t),e.style=(e.style?e.style+";":"")+t):"$"==r.charAt(0)||e.hasOwnProperty(r)||(e[r]=t,i[r]=n[r])})}function j(e,t,n,i,o,s,a,l){var c,u,p=[],g=t[0],m=e.shift(),v=d({},m,{templateUrl:null,transclude:null,replace:null,$$originalDirective:m}),b=x(m.templateUrl)?m.templateUrl(t,n):m.templateUrl;return t.empty(),h.get(_.getTrustedResourceUrl(b),{cache:f}).success(function(d){var h,f,w,C;if(d=J(d),m.replace){if(w=de(d)?[]:yn(In(d)),h=w[0],1!=w.length||1!==h.nodeType)throw ni("tplrt","Template for directive '{0}' must have exactly one root element. {1}",m.name,b);f={$attr:{}},Y(i,t,h);var _=I(h,[],f);y(m.scope)&&R(_),e=_.concat(e),F(n,f)}else h=g,t.html(d);for(e.unshift(v),c=O(e,h,n,o,t,m,s,a,l),r(i,function(e,n){e==h&&(i[n]=t[0])}),u=E(t[0].childNodes,o);p.length;){var x=p.shift(),S=p.shift(),k=p.shift(),T=p.shift(),M=t[0];if(S!==g){var A=S.className;l.hasElementTranscludeDirective&&m.replace||(M=ge(h)),Y(k,yn(S),M),$(yn(M),A)}C=c.transcludeOnThisElement?D(x,c.transclude,T):T,c(u,x,M,i,C)}p=null}).error(function(e,t,n,i){throw ni("tpload","Failed to load template: {0}",i.url)}),function(e,t,n,i,o){var r=o;p?(p.push(t),p.push(n),p.push(i),p.push(r)):(c.transcludeOnThisElement&&(r=D(t,c.transclude,o)),c(u,t,n,i,r))}}function H(e,t){var n=t.priority-e.priority;return 0!==n?n:e.name!==t.name?e.name<t.name?-1:1:e.index-t.index}function W(e,t,n,i){if(t)throw ni("multidir","Multiple directives [{0}, {1}] asking for {2} on: {3}",t.name,n.name,e,z(i))}function B(e,t){var n=i(t,!0);n&&e.push({priority:0,compile:function(e){var t=e.parent(),i=t.length;return i&&$(e.parent(),"ng-binding"),function(e,t){var o=t.parent(),r=o.data("$binding")||[];r.push(n),o.data("$binding",r),i||$(o,"ng-binding"),e.$watch(n,function(e){t[0].nodeValue=e})}}})}function V(e,t){if("srcdoc"==t)return _.HTML;var n=_n(e);return"xlinkHref"==t||"FORM"==n&&"action"==t||"IMG"!=n&&("src"==t||"ngSrc"==t)?_.RESOURCE_URL:void 0}function q(e,t,n,o){var r=i(n,!0);if(r){if("multiple"===o&&"SELECT"===_n(e))throw ni("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",z(e));t.push({priority:100,compile:function(){return{pre:function(t,n,s){var a=s.$$observers||(s.$$observers={});if(u.test(o))throw ni("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");r=i(s[o],!0,V(e,o)),r&&(s[o]=r(t),(a[o]||(a[o]=[])).$$inter=!0,(s.$$observers&&s.$$observers[o].$$scope||t).$watch(r,function(e,t){"class"===o&&e!=t?s.$updateClass(e,t):s.$set(o,e)}))}}}})}}function Y(e,n,i){var o,r,s=n[0],a=n.length,l=s.parentNode;if(e)for(o=0,r=e.length;r>o;o++)if(e[o]==s){e[o++]=i;for(var c=o,u=c+a-1,d=e.length;d>c;c++,u++)d>u?e[c]=e[u]:delete e[c];e.length-=a-1;break}l&&l.replaceChild(i,s);var h=t.createDocumentFragment();h.appendChild(s),i[yn.expando]=s[yn.expando];for(var p=1,f=n.length;f>p;p++){var g=n[p];yn(g).remove(),h.appendChild(g),delete n[p]}n[0]=i,n.length=1}function G(e,t){return d(function(){return e.apply(null,arguments)},e,t)}var K=function(e,t){this.$$element=e,this.$attr=t||{}};K.prototype={$normalize:He,$addClass:function(e){e&&e.length>0&&S.addClass(this.$$element,e)},$removeClass:function(e){e&&e.length>0&&S.removeClass(this.$$element,e)},$updateClass:function(e,t){var n=We(e,t),i=We(t,e);0===n.length?S.removeClass(this.$$element,i):0===i.length?S.addClass(this.$$element,n):S.setClass(this.$$element,n,i)},$set:function(e,t,i,o){var s,a=Ee(this.$$element[0],e);a&&(this.$$element.prop(e,t),o=a),this[e]=t,o?this.$attr[e]=o:(o=this.$attr[e],o||(this.$attr[e]=o=Z(e,"-"))),s=_n(this.$$element),("A"===s&&"href"===e||"IMG"===s&&"src"===e)&&(this[e]=t=k(t,"src"===e)),i!==!1&&(null===t||t===n?this.$$element.removeAttr(o):this.$$element.attr(o,t));var c=this.$$observers;c&&r(c[e],function(e){try{e(t)}catch(n){l(n)}})},$observe:function(e,t){var n=this,i=n.$$observers||(n.$$observers={}),o=i[e]||(i[e]=[]);return o.push(t),b.$evalAsync(function(){o.$$inter||t(n[e])}),t}};var Q=i.startSymbol(),X=i.endSymbol(),J="{{"==Q||"}}"==X?g:function(e){return e.replace(/\{\{/g,Q).replace(/}}/g,X)},ee=/^ngAttr[A-Z]/;return T}]}function He(e){return ce(e.replace(ii,""))}function We(e,t){var n="",i=e.split(/\s+/),o=t.split(/\s+/);e:for(var r=0;r<i.length;r++){for(var s=i[r],a=0;a<o.length;a++)if(s==o[a])continue e;n+=(n.length>0?" ":"")+s}return n}function Be(){var e={},t=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(t,n){ie(t,"controller"),y(t)?d(e,t):e[t]=n},this.$get=["$injector","$window",function(n,o){return function(r,s){var a,l,c,u;if(w(r)&&(l=r.match(t),c=l[1],u=l[3],r=e.hasOwnProperty(c)?e[c]:oe(s.$scope,c,!0)||oe(o,c,!0),ne(r,c,!0)),a=n.instantiate(r,s),u){if(!s||"object"!=typeof s.$scope)throw i("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",c||r.name,u);s.$scope[u]=a}return a}}]}function Ve(){this.$get=["$window",function(e){return yn(e.document)}]}function ze(){this.$get=["$log",function(e){return function(t,n){e.error.apply(e,arguments)}}]}function qe(e){var t,n,i,o={};return e?(r(e.split("\n"),function(e){i=e.indexOf(":"),t=pn(In(e.substr(0,i))),n=In(e.substr(i+1)),t&&(o[t]=o[t]?o[t]+", "+n:n)}),o):o}function Ye(e){var t=y(e)?e:n;return function(n){return t||(t=qe(e)),n?t[pn(n)]||null:t}}function Ge(e,t,n){return x(n)?n(e,t):(r(n,function(n){e=n(e,t)}),e)}function Ke(e){return e>=200&&300>e}function Qe(){var e=/^\s*(\[|\{[^\{])/,t=/[\}\]]\s*$/,i=/^\)\]\}',?\n/,o={"Content-Type":"application/json;charset=utf-8"},s=this.defaults={transformResponse:[function(n){return w(n)&&(n=n.replace(i,""),e.test(n)&&t.test(n)&&(n=B(n))),n}],transformRequest:[function(e){return!y(e)||$(e)||E(e)?e:W(e)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:N(o),put:N(o),patch:N(o)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},l=this.interceptors=[],c=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(e,t,i,o,u,h){function p(e){function t(e){var t=d({},e,{data:Ge(e.data,e.headers,o.transformResponse)});return Ke(e.status)?t:u.reject(t)}function i(e){function t(e){var t;r(e,function(n,i){x(n)&&(t=n(),null!=t?e[i]=t:delete e[i])})}var n,i,o,a=s.headers,l=d({},e.headers);a=d({},a.common,a[pn(e.method)]);e:for(n in a){i=pn(n);for(o in l)if(pn(o)===i)continue e;l[n]=a[n]}return t(l),l}var o={method:"get",transformRequest:s.transformRequest,transformResponse:s.transformResponse},a=i(e);d(o,e),o.headers=a,o.method=gn(o.method);var l=function(e){a=e.headers;var n=Ge(e.data,Ye(a),e.transformRequest);return v(n)&&r(a,function(e,t){"content-type"===pn(t)&&delete a[t]}),v(e.withCredentials)&&!v(s.withCredentials)&&(e.withCredentials=s.withCredentials),m(e,n,a).then(t,t)},c=[l,n],h=u.when(o);for(r(k,function(e){(e.request||e.requestError)&&c.unshift(e.request,e.requestError),(e.response||e.responseError)&&c.push(e.response,e.responseError)});c.length;){var p=c.shift(),f=c.shift();h=h.then(p,f)}return h.success=function(e){return h.then(function(t){e(t.data,t.status,t.headers,o)}),h},h.error=function(e){return h.then(null,function(t){e(t.data,t.status,t.headers,o)}),h},h}function f(e){r(arguments,function(e){p[e]=function(t,n){return p(d(n||{},{method:e,url:t}))}})}function g(e){r(arguments,function(e){p[e]=function(t,n,i){return p(d(i||{},{method:e,url:t,data:n}))}})}function m(i,r,a){function l(e,t,n,i){h&&(Ke(e)?h.put(w,[e,t,qe(n),i]):h.remove(w)),c(t,e,n,i),o.$$phase||o.$apply()}function c(e,t,n,o){t=Math.max(t,0),(Ke(t)?g.resolve:g.reject)({data:e,status:t,headers:Ye(n),config:i,statusText:o})}function d(){var e=O(p.pendingRequests,i);-1!==e&&p.pendingRequests.splice(e,1)}var h,f,g=u.defer(),m=g.promise,w=C(i.url,i.params);if(p.pendingRequests.push(i),m.then(d,d),!i.cache&&!s.cache||i.cache===!1||"GET"!==i.method&&"JSONP"!==i.method||(h=y(i.cache)?i.cache:y(s.cache)?s.cache:S),h)if(f=h.get(w),b(f)){if(D(f))return f.then(d,d),f;Dn(f)?c(f[1],f[0],N(f[2]),f[3]):c(f,200,{},"OK")}else h.put(w,m);if(v(f)){var _=Lt(i.url)?t.cookies()[i.xsrfCookieName||s.xsrfCookieName]:n;_&&(a[i.xsrfHeaderName||s.xsrfHeaderName]=_),e(i.method,w,r,l,a,i.timeout,i.withCredentials,i.responseType)}return m}function C(e,t){if(!t)return e;var n=[];return a(t,function(e,t){null===e||v(e)||(Dn(e)||(e=[e]),r(e,function(e){y(e)&&(e=_(e)?e.toISOString():W(e)),n.push(Q(t)+"="+Q(e))}))}),n.length>0&&(e+=(-1==e.indexOf("?")?"?":"&")+n.join("&")),e}var S=i("$http"),k=[];return r(l,function(e){k.unshift(w(e)?h.get(e):h.invoke(e))}),r(c,function(e,t){var n=w(e)?h.get(e):h.invoke(e);k.splice(t,0,{response:function(e){return n(u.when(e))},responseError:function(e){return n(u.reject(e))}})}),p.pendingRequests=[],f("get","delete","head","jsonp"),g("post","put"),p.defaults=s,p}]}function Xe(t){if(8>=bn&&(!t.match(/^(get|post|head|put|delete|options)$/i)||!e.XMLHttpRequest))return new e.ActiveXObject("Microsoft.XMLHTTP");if(e.XMLHttpRequest)return new e.XMLHttpRequest;throw i("$httpBackend")("noxhr","This browser does not support XMLHttpRequest.")}function Je(){this.$get=["$browser","$window","$document",function(e,t,n){return Ze(e,Xe,e.defer,t.angular.callbacks,n[0])}]}function Ze(e,t,n,i,o){function s(e,t,n){var r=o.createElement("script"),s=null;return r.type="text/javascript",r.src=e,r.async=!0,s=function(e){Ln(r,"load",s),Ln(r,"error",s),o.body.removeChild(r),r=null;var a=-1,l="unknown";e&&("load"!==e.type||i[t].called||(e={type:"error"}),l=e.type,a="error"===e.type?404:200),n&&n(a,l)},Nn(r,"load",s),Nn(r,"error",s),8>=bn&&(r.onreadystatechange=function(){w(r.readyState)&&/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=null,s({type:"load"}))}),o.body.appendChild(r),s}var a=-1;return function(o,l,c,u,d,h,p,g){function m(){y=a,C&&C(),_&&_.abort()}function v(t,i,o,r,s){S&&n.cancel(S),C=_=null,0===i&&(i=o?200:"file"==Nt(l).protocol?404:0),i=1223===i?204:i,s=s||"",t(i,o,r,s),e.$$completeOutstandingRequest(f)}var y;if(e.$$incOutstandingRequestCount(),l=l||e.url(),"jsonp"==pn(o)){var w="_"+(i.counter++).toString(36);i[w]=function(e){i[w].data=e,i[w].called=!0};var C=s(l.replace("JSON_CALLBACK","angular.callbacks."+w),w,function(e,t){v(u,e,i[w].data,"",t),i[w]=f})}else{var _=t(o);if(_.open(o,l,!0),r(d,function(e,t){b(e)&&_.setRequestHeader(t,e)}),_.onreadystatechange=function(){if(_&&4==_.readyState){var e=null,t=null,n="";y!==a&&(e=_.getAllResponseHeaders(),t="response"in _?_.response:_.responseText),y===a&&10>bn||(n=_.statusText),v(u,y||_.status,t,e,n)}},p&&(_.withCredentials=!0),g)try{_.responseType=g}catch(x){if("json"!==g)throw x}_.send(c||null)}if(h>0)var S=n(m,h);else D(h)&&h.then(m)}}function et(){var e="{{",t="}}";this.startSymbol=function(t){return t?(e=t,this):e},this.endSymbol=function(e){return e?(t=e,this):t},this.$get=["$parse","$exceptionHandler","$sce",function(n,i,o){function r(r,l,c){for(var u,d,h,p,f=0,g=[],m=r.length,v=!1,b=[];m>f;)-1!=(u=r.indexOf(e,f))&&-1!=(d=r.indexOf(t,u+s))?(f!=u&&g.push(r.substring(f,u)),g.push(h=n(p=r.substring(u+s,d))),h.exp=p,f=d+a,v=!0):(f!=m&&g.push(r.substring(f)),f=m);if((m=g.length)||(g.push(""),m=1),c&&g.length>1)throw oi("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",r);return!l||v?(b.length=m,h=function(e){try{for(var t,n=0,s=m;s>n;n++){if("function"==typeof(t=g[n]))if(t=t(e),t=c?o.getTrusted(c,t):o.valueOf(t),null==t)t="";else switch(typeof t){case"string":break;case"number":t=""+t;break;default:t=W(t)}b[n]=t}return b.join("")}catch(a){var l=oi("interr","Can't interpolate: {0}\n{1}",r,a.toString());i(l)}},h.exp=r,h.parts=g,h):void 0}var s=e.length,a=t.length;return r.startSymbol=function(){return e},r.endSymbol=function(){return t},r}]}function tt(){this.$get=["$rootScope","$window","$q",function(e,t,n){function i(i,r,s,a){var l=t.setInterval,c=t.clearInterval,u=n.defer(),d=u.promise,h=0,p=b(a)&&!a;return s=b(s)?s:0,d.then(null,null,i),d.$$intervalId=l(function(){u.notify(h++),s>0&&h>=s&&(u.resolve(h),c(d.$$intervalId),delete o[d.$$intervalId]),p||e.$apply()},r),o[d.$$intervalId]=u,d}var o={};return i.cancel=function(e){return e&&e.$$intervalId in o?(o[e.$$intervalId].reject("canceled"),t.clearInterval(e.$$intervalId),delete o[e.$$intervalId],!0):!1},i}]}function nt(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(e){return 1===e?"one":"other"}}}}function it(e){for(var t=e.split("/"),n=t.length;n--;)t[n]=K(t[n]);return t.join("/")}function ot(e,t,n){var i=Nt(e,n);t.$$protocol=i.protocol,t.$$host=i.hostname,t.$$port=h(i.port)||si[i.protocol]||null}function rt(e,t,n){var i="/"!==e.charAt(0);i&&(e="/"+e);var o=Nt(e,n);t.$$path=decodeURIComponent(i&&"/"===o.pathname.charAt(0)?o.pathname.substring(1):o.pathname),t.$$search=Y(o.search),t.$$hash=decodeURIComponent(o.hash),t.$$path&&"/"!=t.$$path.charAt(0)&&(t.$$path="/"+t.$$path)}function st(e,t){return 0===t.indexOf(e)?t.substr(e.length):void 0}function at(e){var t=e.indexOf("#");return-1==t?e:e.substr(0,t)}function lt(e){return e.substr(0,at(e).lastIndexOf("/")+1)}function ct(e){return e.substring(0,e.indexOf("/",e.indexOf("//")+2))}function ut(e,t){this.$$html5=!0,t=t||"";var i=lt(e);ot(e,this,e),this.$$parse=function(t){var n=st(i,t);if(!w(n))throw ai("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',t,i);rt(n,this,e),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var e=G(this.$$search),t=this.$$hash?"#"+K(this.$$hash):"";this.$$url=it(this.$$path)+(e?"?"+e:"")+t,this.$$absUrl=i+this.$$url.substr(1)},this.$$rewrite=function(o){var r,s;return(r=st(e,o))!==n?(s=r,(r=st(t,r))!==n?i+(st("/",r)||r):e+s):(r=st(i,o))!==n?i+r:i==o+"/"?i:void 0}}function dt(e,t){var n=lt(e);ot(e,this,e),this.$$parse=function(i){function o(e,t,n){var i,o=/^\/[A-Z]:(\/.*)/;return 0===t.indexOf(n)&&(t=t.replace(n,"")),o.exec(t)?e:(i=o.exec(e),i?i[1]:e)}var r=st(e,i)||st(n,i),s="#"==r.charAt(0)?st(t,r):this.$$html5?r:"";if(!w(s))throw ai("ihshprfx",'Invalid url "{0}", missing hash prefix "{1}".',i,t);rt(s,this,e),this.$$path=o(this.$$path,s,e),this.$$compose()},this.$$compose=function(){var n=G(this.$$search),i=this.$$hash?"#"+K(this.$$hash):"";this.$$url=it(this.$$path)+(n?"?"+n:"")+i,this.$$absUrl=e+(this.$$url?t+this.$$url:"")},this.$$rewrite=function(t){return at(e)==at(t)?t:void 0}}function ht(e,t){this.$$html5=!0,dt.apply(this,arguments);var n=lt(e);this.$$rewrite=function(i){var o;return e==at(i)?i:(o=st(n,i))?e+t+o:n===i+"/"?n:void 0},this.$$compose=function(){var n=G(this.$$search),i=this.$$hash?"#"+K(this.$$hash):"";this.$$url=it(this.$$path)+(n?"?"+n:"")+i,this.$$absUrl=e+t+this.$$url}}function pt(e){return function(){return this[e]}}function ft(e,t){return function(n){return v(n)?this[e]:(this[e]=t(n),this.$$compose(),this)}}function gt(){var t="",n=!1;this.hashPrefix=function(e){return b(e)?(t=e,this):t},this.html5Mode=function(e){return b(e)?(n=e,this):n},this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(i,o,r,s){function a(e){i.$broadcast("$locationChangeSuccess",l.absUrl(),e)}var l,c,u,d=o.baseHref(),h=o.url();n?(u=ct(h)+(d||"/"),c=r.history?ut:ht):(u=at(h),c=dt),l=new c(u,"#"+t),l.$$parse(l.$$rewrite(h));var p=/^\s*(javascript|mailto):/i;s.on("click",function(n){if(!n.ctrlKey&&!n.metaKey&&2!=n.which){for(var r=yn(n.target);"a"!==pn(r[0].nodeName);)if(r[0]===s[0]||!(r=r.parent())[0])return;var a=r.prop("href");if(y(a)&&"[object SVGAnimatedString]"===a.toString()&&(a=Nt(a.animVal).href),!p.test(a)){if(c===ht){var d=r.attr("href")||r.attr("xlink:href");if(d&&d.indexOf("://")<0){var h="#"+t;if("/"==d[0])a=u+h+d;else if("#"==d[0])a=u+h+(l.path()||"/")+d;else{var f=l.path().split("/"),g=d.split("/");2!==f.length||f[1]||(f.length=1);for(var m=0;m<g.length;m++)"."!=g[m]&&(".."==g[m]?f.pop():g[m].length&&f.push(g[m]));a=u+h+f.join("/")}}}var v=l.$$rewrite(a);a&&!r.attr("target")&&v&&!n.isDefaultPrevented()&&(n.preventDefault(),v!=o.url()&&(l.$$parse(v),i.$apply(),e.angular["ff-684208-preventDefault"]=!0))}}}),l.absUrl()!=h&&o.url(l.absUrl(),!0),o.onUrlChange(function(e){l.absUrl()!=e&&(i.$evalAsync(function(){var t=l.absUrl();l.$$parse(e),i.$broadcast("$locationChangeStart",e,t).defaultPrevented?(l.$$parse(t),o.url(t)):a(t)}),i.$$phase||i.$digest())});var f=0;return i.$watch(function(){var e=o.url(),t=l.$$replace;return f&&e==l.absUrl()||(f++,i.$evalAsync(function(){i.$broadcast("$locationChangeStart",l.absUrl(),e).defaultPrevented?l.$$parse(e):(o.url(l.absUrl(),t),a(e))})),l.$$replace=!1,f}),l}]}function mt(){var e=!0,t=this;this.debugEnabled=function(t){return b(t)?(e=t,this):e},this.$get=["$window",function(n){function i(e){return e instanceof Error&&(e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function o(e){var t=n.console||{},o=t[e]||t.log||f,s=!1;try{s=!!o.apply}catch(a){}return s?function(){var e=[];return r(arguments,function(t){e.push(i(t))}),o.apply(t,e)}:function(e,t){
o(e,null==t?"":t)}}return{log:o("log"),info:o("info"),warn:o("warn"),error:o("error"),debug:function(){var n=o("debug");return function(){e&&n.apply(t,arguments)}}()}}]}function vt(e,t){if("__defineGetter__"===e||"__defineSetter__"===e||"__lookupGetter__"===e||"__lookupSetter__"===e||"__proto__"===e)throw ci("isecfld","Attempting to access a disallowed field in Angular expressions! Expression: {0}",t);return e}function bt(e,t){if(e){if(e.constructor===e)throw ci("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e.document&&e.location&&e.alert&&e.setInterval)throw ci("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",t);if(e.children&&(e.nodeName||e.prop&&e.attr&&e.find))throw ci("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",t);if(e===Object)throw ci("isecobj","Referencing Object in Angular expressions is disallowed! Expression: {0}",t)}return e}function yt(e,t){if(e){if(e.constructor===e)throw ci("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e===di||e===hi||pi&&e===pi)throw ci("isecff","Referencing call, apply or bind in Angular expressions is disallowed! Expression: {0}",t)}}function wt(e,t,i,o,r){bt(e,o),r=r||{};for(var s,a=t.split("."),l=0;a.length>1;l++){s=vt(a.shift(),o);var c=bt(e[s],o);c||(c={},e[s]=c),e=c,e.then&&r.unwrapPromises&&(li(o),"$$v"in e||!function(e){e.then(function(t){e.$$v=t})}(e),e.$$v===n&&(e.$$v={}),e=e.$$v)}return s=vt(a.shift(),o),bt(e[s],o),e[s]=i,i}function Ct(e,t,i,o,r,s,a){return vt(e,s),vt(t,s),vt(i,s),vt(o,s),vt(r,s),a.unwrapPromises?function(a,l){var c,u=l&&l.hasOwnProperty(e)?l:a;return null==u?u:(u=u[e],u&&u.then&&(li(s),"$$v"in u||(c=u,c.$$v=n,c.then(function(e){c.$$v=e})),u=u.$$v),t?null==u?n:(u=u[t],u&&u.then&&(li(s),"$$v"in u||(c=u,c.$$v=n,c.then(function(e){c.$$v=e})),u=u.$$v),i?null==u?n:(u=u[i],u&&u.then&&(li(s),"$$v"in u||(c=u,c.$$v=n,c.then(function(e){c.$$v=e})),u=u.$$v),o?null==u?n:(u=u[o],u&&u.then&&(li(s),"$$v"in u||(c=u,c.$$v=n,c.then(function(e){c.$$v=e})),u=u.$$v),r?null==u?n:(u=u[r],u&&u.then&&(li(s),"$$v"in u||(c=u,c.$$v=n,c.then(function(e){c.$$v=e})),u=u.$$v),u):u):u):u):u)}:function(s,a){var l=a&&a.hasOwnProperty(e)?a:s;return null==l?l:(l=l[e],t?null==l?n:(l=l[t],i?null==l?n:(l=l[i],o?null==l?n:(l=l[o],r?null==l?n:l=l[r]:l):l):l):l)}}function _t(e,t,i){if(bi.hasOwnProperty(e))return bi[e];var o,s=e.split("."),a=s.length;if(t.csp)o=6>a?Ct(s[0],s[1],s[2],s[3],s[4],i,t):function(e,o){var r,l=0;do r=Ct(s[l++],s[l++],s[l++],s[l++],s[l++],i,t)(e,o),o=n,e=r;while(a>l);return r};else{var l="var p;\n";r(s,function(e,n){vt(e,i),l+="if(s == null) return undefined;\ns="+(n?"s":'((k&&k.hasOwnProperty("'+e+'"))?k:s)')+'["'+e+'"];\n'+(t.unwrapPromises?'if (s && s.then) {\n pw("'+i.replace(/(["\r\n])/g,"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n':"")}),l+="return s;";var c=new Function("s","k","pw",l);c.toString=m(l),o=t.unwrapPromises?function(e,t){return c(e,t,li)}:c}return"hasOwnProperty"!==e&&(bi[e]=o),o}function xt(){var e={},t={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0};this.unwrapPromises=function(e){return b(e)?(t.unwrapPromises=!!e,this):t.unwrapPromises},this.logPromiseWarnings=function(e){return b(e)?(t.logPromiseWarnings=e,this):t.logPromiseWarnings},this.$get=["$filter","$sniffer","$log",function(n,i,o){return t.csp=i.csp,li=function(e){t.logPromiseWarnings&&!ui.hasOwnProperty(e)&&(ui[e]=!0,o.warn("[$parse] Promise found in the expression `"+e+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))},function(i){var o;switch(typeof i){case"string":if(e.hasOwnProperty(i))return e[i];var r=new mi(t),s=new vi(r,n,t);return o=s.parse(i),"hasOwnProperty"!==i&&(e[i]=o),o;case"function":return i;default:return f}}}]}function St(){this.$get=["$rootScope","$exceptionHandler",function(e,t){return kt(function(t){e.$evalAsync(t)},t)}]}function kt(e,t){function i(e){return e}function o(e){return c(e)}function s(e){var t=a(),n=0,i=Dn(e)?[]:{};return r(e,function(e,o){n++,l(e).then(function(e){i.hasOwnProperty(o)||(i[o]=e,--n||t.resolve(i))},function(e){i.hasOwnProperty(o)||t.reject(e)})}),0===n&&t.resolve(i),t.promise}var a=function(){var r,s,c=[];return s={resolve:function(t){if(c){var i=c;c=n,r=l(t),i.length&&e(function(){for(var e,t=0,n=i.length;n>t;t++)e=i[t],r.then(e[0],e[1],e[2])})}},reject:function(e){s.resolve(u(e))},notify:function(t){if(c){var n=c;c.length&&e(function(){for(var e,i=0,o=n.length;o>i;i++)e=n[i],e[2](t)})}},promise:{then:function(e,n,s){var l=a(),u=function(n){try{l.resolve((x(e)?e:i)(n))}catch(o){l.reject(o),t(o)}},d=function(e){try{l.resolve((x(n)?n:o)(e))}catch(i){l.reject(i),t(i)}},h=function(e){try{l.notify((x(s)?s:i)(e))}catch(n){t(n)}};return c?c.push([u,d,h]):r.then(u,d,h),l.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function t(e,t){var n=a();return t?n.resolve(e):n.reject(e),n.promise}function n(n,o){var r=null;try{r=(e||i)()}catch(s){return t(s,!1)}return D(r)?r.then(function(){return t(n,o)},function(e){return t(e,!1)}):t(n,o)}return this.then(function(e){return n(e,!0)},function(e){return n(e,!1)})}}}},l=function(t){return D(t)?t:{then:function(n){var i=a();return e(function(){i.resolve(n(t))}),i.promise}}},c=function(e){var t=a();return t.reject(e),t.promise},u=function(n){return{then:function(i,r){var s=a();return e(function(){try{s.resolve((x(r)?r:o)(n))}catch(e){s.reject(e),t(e)}}),s.promise}}},d=function(n,r,s,u){var d,h=a(),p=function(e){try{return(x(r)?r:i)(e)}catch(n){return t(n),c(n)}},f=function(e){try{return(x(s)?s:o)(e)}catch(n){return t(n),c(n)}},g=function(e){try{return(x(u)?u:i)(e)}catch(n){t(n)}};return e(function(){l(n).then(function(e){d||(d=!0,h.resolve(l(e).then(p,f,g)))},function(e){d||(d=!0,h.resolve(f(e)))},function(e){d||h.notify(g(e))})}),h.promise};return{defer:a,reject:c,when:d,all:s}}function Tt(){this.$get=["$window","$timeout",function(e,t){var n=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame,i=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelRequestAnimationFrame,o=!!n,r=o?function(e){var t=n(e);return function(){i(t)}}:function(e){var n=t(e,16.66,!1);return function(){t.cancel(n)}};return r.supported=o,r}]}function $t(){var e=10,t=i("$rootScope"),n=null;this.digestTtl=function(t){return arguments.length&&(e=t),e},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(i,s,a,l){function u(){this.$id=c(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this["this"]=this.$root=this,this.$$destroyed=!1,this.$$asyncQueue=[],this.$$postDigestQueue=[],this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings={}}function d(e){if(v.$$phase)throw t("inprog","{0} already in progress",v.$$phase);v.$$phase=e}function h(){v.$$phase=null}function p(e,t){var n=a(e);return ne(n,t),n}function g(e,t,n){do e.$$listenerCount[n]-=t,0===e.$$listenerCount[n]&&delete e.$$listenerCount[n];while(e=e.$parent)}function m(){}u.prototype={constructor:u,$new:function(e){var t;return e?(t=new u,t.$root=this.$root,t.$$asyncQueue=this.$$asyncQueue,t.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$id=c(),this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),t=new this.$$childScopeClass),t["this"]=t,t.$parent=this,t.$$prevSibling=this.$$childTail,this.$$childHead?(this.$$childTail.$$nextSibling=t,this.$$childTail=t):this.$$childHead=this.$$childTail=t,t},$watch:function(e,t,i){var o=this,r=p(e,"watch"),s=o.$$watchers,a={fn:t,last:m,get:r,exp:e,eq:!!i};if(n=null,!x(t)){var l=p(t||f,"listener");a.fn=function(e,t,n){l(n)}}if("string"==typeof e&&r.constant){var c=a.fn;a.fn=function(e,t,n){c.call(this,e,t,n),R(s,a)}}return s||(s=o.$$watchers=[]),s.unshift(a),function(){R(s,a),n=null}},$watchCollection:function(e,t){function n(){r=h(c);var e,t,n;if(y(r))if(o(r)){s!==p&&(s=p,m=s.length=0,d++),e=r.length,m!==e&&(d++,s.length=m=e);for(var i=0;e>i;i++)n=s[i]!==s[i]&&r[i]!==r[i],n||s[i]===r[i]||(d++,s[i]=r[i])}else{s!==f&&(s=f={},m=0,d++),e=0;for(t in r)r.hasOwnProperty(t)&&(e++,s.hasOwnProperty(t)?(n=s[t]!==s[t]&&r[t]!==r[t],n||s[t]===r[t]||(d++,s[t]=r[t])):(m++,s[t]=r[t],d++));if(m>e){d++;for(t in s)s.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(m--,delete s[t])}}else s!==r&&(s=r,d++);return d}function i(){if(g?(g=!1,t(r,r,c)):t(r,l,c),u)if(y(r))if(o(r)){l=new Array(r.length);for(var e=0;e<r.length;e++)l[e]=r[e]}else{l={};for(var n in r)fn.call(r,n)&&(l[n]=r[n])}else l=r}var r,s,l,c=this,u=t.length>1,d=0,h=a(e),p=[],f={},g=!0,m=0;return this.$watch(n,i)},$digest:function(){var i,o,r,a,c,u,p,f,g,v,b,y=this.$$asyncQueue,w=this.$$postDigestQueue,C=e,_=this,S=[];d("$digest"),l.$$checkUrlChange(),n=null;do{for(u=!1,f=_;y.length;){try{b=y.shift(),b.scope.$eval(b.expression)}catch(k){h(),s(k)}n=null}e:do{if(a=f.$$watchers)for(c=a.length;c--;)try{if(i=a[c])if((o=i.get(f))===(r=i.last)||(i.eq?L(o,r):"number"==typeof o&&"number"==typeof r&&isNaN(o)&&isNaN(r))){if(i===n){u=!1;break e}}else u=!0,n=i,i.last=i.eq?P(o,null):o,i.fn(o,r===m?o:r,f),5>C&&(g=4-C,S[g]||(S[g]=[]),v=x(i.exp)?"fn: "+(i.exp.name||i.exp.toString()):i.exp,v+="; newVal: "+W(o)+"; oldVal: "+W(r),S[g].push(v))}catch(k){h(),s(k)}if(!(p=f.$$childHead||f!==_&&f.$$nextSibling))for(;f!==_&&!(p=f.$$nextSibling);)f=f.$parent}while(f=p);if((u||y.length)&&!C--)throw h(),t("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",e,W(S))}while(u||y.length);for(h();w.length;)try{w.shift()()}catch(k){s(k)}},$destroy:function(){if(!this.$$destroyed){var e=this.$parent;this.$broadcast("$destroy"),this.$$destroyed=!0,this!==v&&(r(this.$$listenerCount,j(null,g,this)),e.$$childHead==this&&(e.$$childHead=this.$$nextSibling),e.$$childTail==this&&(e.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=f,this.$on=this.$watch=function(){return f})}},$eval:function(e,t){return a(e)(this,t)},$evalAsync:function(e){v.$$phase||v.$$asyncQueue.length||l.defer(function(){v.$$asyncQueue.length&&v.$digest()}),this.$$asyncQueue.push({scope:this,expression:e})},$$postDigest:function(e){this.$$postDigestQueue.push(e)},$apply:function(e){try{return d("$apply"),this.$eval(e)}catch(t){s(t)}finally{h();try{v.$digest()}catch(t){throw s(t),t}}},$on:function(e,t){var n=this.$$listeners[e];n||(this.$$listeners[e]=n=[]),n.push(t);var i=this;do i.$$listenerCount[e]||(i.$$listenerCount[e]=0),i.$$listenerCount[e]++;while(i=i.$parent);var o=this;return function(){n[O(n,t)]=null,g(o,1,e)}},$emit:function(e,t){var n,i,o,r=[],a=this,l=!1,c={name:e,targetScope:a,stopPropagation:function(){l=!0},preventDefault:function(){c.defaultPrevented=!0},defaultPrevented:!1},u=F([c],arguments,1);do{for(n=a.$$listeners[e]||r,c.currentScope=a,i=0,o=n.length;o>i;i++)if(n[i])try{n[i].apply(null,u)}catch(d){s(d)}else n.splice(i,1),i--,o--;if(l)return c;a=a.$parent}while(a);return c},$broadcast:function(e,t){for(var n,i,o,r=this,a=r,l=r,c={name:e,targetScope:r,preventDefault:function(){c.defaultPrevented=!0},defaultPrevented:!1},u=F([c],arguments,1);a=l;){for(c.currentScope=a,n=a.$$listeners[e]||[],i=0,o=n.length;o>i;i++)if(n[i])try{n[i].apply(null,u)}catch(d){s(d)}else n.splice(i,1),i--,o--;if(!(l=a.$$listenerCount[e]&&a.$$childHead||a!==r&&a.$$nextSibling))for(;a!==r&&!(l=a.$$nextSibling);)a=a.$parent}return c}};var v=new u;return v}]}function Et(){var e=/^\s*(https?|ftp|mailto|tel|file):/,t=/^\s*((https?|ftp|file):|data:image\/)/;this.aHrefSanitizationWhitelist=function(t){return b(t)?(e=t,this):e},this.imgSrcSanitizationWhitelist=function(e){return b(e)?(t=e,this):t},this.$get=function(){return function(n,i){var o,r=i?t:e;return bn&&!(bn>=8)||(o=Nt(n).href,""===o||o.match(r))?n:"unsafe:"+o}}}function Dt(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function It(e){if("self"===e)return e;if(w(e)){if(e.indexOf("***")>-1)throw yi("iwcard","Illegal sequence *** in string matcher.  String: {0}",e);return e=Dt(e).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+e+"$")}if(S(e))return new RegExp("^"+e.source+"$");throw yi("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}function Mt(e){var t=[];return b(e)&&r(e,function(e){t.push(It(e))}),t}function At(){this.SCE_CONTEXTS=wi;var e=["self"],t=[];this.resourceUrlWhitelist=function(t){return arguments.length&&(e=Mt(t)),e},this.resourceUrlBlacklist=function(e){return arguments.length&&(t=Mt(e)),t},this.$get=["$injector",function(i){function o(e,t){return"self"===e?Lt(t):!!e.exec(t.href)}function r(n){var i,r,s=Nt(n.toString()),a=!1;for(i=0,r=e.length;r>i;i++)if(o(e[i],s)){a=!0;break}if(a)for(i=0,r=t.length;r>i;i++)if(o(t[i],s)){a=!1;break}return a}function s(e){var t=function(e){this.$$unwrapTrustedValue=function(){return e}};return e&&(t.prototype=new e),t.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},t.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},t}function a(e,t){var i=h.hasOwnProperty(e)?h[e]:null;if(!i)throw yi("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",e,t);if(null===t||t===n||""===t)return t;if("string"!=typeof t)throw yi("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",e);return new i(t)}function l(e){return e instanceof d?e.$$unwrapTrustedValue():e}function c(e,t){if(null===t||t===n||""===t)return t;var i=h.hasOwnProperty(e)?h[e]:null;if(i&&t instanceof i)return t.$$unwrapTrustedValue();if(e===wi.RESOURCE_URL){if(r(t))return t;throw yi("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",t.toString())}if(e===wi.HTML)return u(t);throw yi("unsafe","Attempting to use an unsafe value in a safe context.")}var u=function(e){throw yi("unsafe","Attempting to use an unsafe value in a safe context.")};i.has("$sanitize")&&(u=i.get("$sanitize"));var d=s(),h={};return h[wi.HTML]=s(d),h[wi.CSS]=s(d),h[wi.URL]=s(d),h[wi.JS]=s(d),h[wi.RESOURCE_URL]=s(h[wi.URL]),{trustAs:a,getTrusted:c,valueOf:l}}]}function Ot(){var e=!0;this.enabled=function(t){return arguments.length&&(e=!!t),e},this.$get=["$parse","$sniffer","$sceDelegate",function(t,n,i){if(e&&n.msie&&n.msieDocumentMode<8)throw yi("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 9 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var o=N(wi);o.isEnabled=function(){return e},o.trustAs=i.trustAs,o.getTrusted=i.getTrusted,o.valueOf=i.valueOf,e||(o.trustAs=o.getTrusted=function(e,t){return t},o.valueOf=g),o.parseAs=function(e,n){var i=t(n);return i.literal&&i.constant?i:function(t,n){return o.getTrusted(e,i(t,n))}};var s=o.parseAs,a=o.getTrusted,l=o.trustAs;return r(wi,function(e,t){var n=pn(t);o[ce("parse_as_"+n)]=function(t){return s(e,t)},o[ce("get_trusted_"+n)]=function(t){return a(e,t)},o[ce("trust_as_"+n)]=function(t){return l(e,t)}}),o}]}function Rt(){this.$get=["$window","$document",function(e,t){var n,i,o={},r=h((/android (\d+)/.exec(pn((e.navigator||{}).userAgent))||[])[1]),s=/Boxee/i.test((e.navigator||{}).userAgent),a=t[0]||{},l=a.documentMode,c=/^(Moz|webkit|O|ms)(?=[A-Z])/,u=a.body&&a.body.style,d=!1,p=!1;if(u){for(var f in u)if(i=c.exec(f)){n=i[0],n=n.substr(0,1).toUpperCase()+n.substr(1);break}n||(n="WebkitOpacity"in u&&"webkit"),d=!!("transition"in u||n+"Transition"in u),p=!!("animation"in u||n+"Animation"in u),!r||d&&p||(d=w(a.body.style.webkitTransition),p=w(a.body.style.webkitAnimation))}return{history:!(!e.history||!e.history.pushState||4>r||s),hashchange:"onhashchange"in e&&(!l||l>7),hasEvent:function(e){if("input"==e&&9==bn)return!1;if(v(o[e])){var t=a.createElement("div");o[e]="on"+e in t}return o[e]},csp:Mn(),vendorPrefix:n,transitions:d,animations:p,android:r,msie:bn,msieDocumentMode:l}}]}function Pt(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(e,t,n,i){function o(o,s,a){var l,c=n.defer(),u=c.promise,d=b(a)&&!a;return l=t.defer(function(){try{c.resolve(o())}catch(t){c.reject(t),i(t)}finally{delete r[u.$$timeoutId]}d||e.$apply()},s),u.$$timeoutId=l,r[l]=c,u}var r={};return o.cancel=function(e){return e&&e.$$timeoutId in r?(r[e.$$timeoutId].reject("canceled"),delete r[e.$$timeoutId],t.defer.cancel(e.$$timeoutId)):!1},o}]}function Nt(e,t){var n=e;return bn&&(Ci.setAttribute("href",n),n=Ci.href),Ci.setAttribute("href",n),{href:Ci.href,protocol:Ci.protocol?Ci.protocol.replace(/:$/,""):"",host:Ci.host,search:Ci.search?Ci.search.replace(/^\?/,""):"",hash:Ci.hash?Ci.hash.replace(/^#/,""):"",hostname:Ci.hostname,port:Ci.port,pathname:"/"===Ci.pathname.charAt(0)?Ci.pathname:"/"+Ci.pathname}}function Lt(e){var t=w(e)?Nt(e):e;return t.protocol===_i.protocol&&t.host===_i.host}function Ft(){this.$get=m(e)}function Ut(e){function t(i,o){if(y(i)){var s={};return r(i,function(e,n){s[n]=t(n,e)}),s}return e.factory(i+n,o)}var n="Filter";this.register=t,this.$get=["$injector",function(e){return function(t){return e.get(t+n)}}],t("currency",Ht),t("date",Kt),t("filter",jt),t("json",Qt),t("limitTo",Xt),t("lowercase",$i),t("number",Wt),t("orderBy",Jt),t("uppercase",Ei)}function jt(){return function(e,t,n){if(!Dn(e))return e;var i=typeof n,o=[];o.check=function(e){for(var t=0;t<o.length;t++)if(!o[t](e))return!1;return!0},"function"!==i&&(n="boolean"===i&&n?function(e,t){return $n.equals(e,t)}:function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){for(var i in e)if("$"!==i.charAt(0)&&fn.call(e,i)&&n(e[i],t[i]))return!0;return!1}return t=(""+t).toLowerCase(),(""+e).toLowerCase().indexOf(t)>-1});var r=function(e,t){if("string"==typeof t&&"!"===t.charAt(0))return!r(e,t.substr(1));switch(typeof e){case"boolean":case"number":case"string":return n(e,t);case"object":switch(typeof t){case"object":return n(e,t);default:for(var i in e)if("$"!==i.charAt(0)&&r(e[i],t))return!0}return!1;case"array":for(var o=0;o<e.length;o++)if(r(e[o],t))return!0;return!1;default:return!1}};switch(typeof t){case"boolean":case"number":case"string":t={$:t};case"object":for(var s in t)!function(e){"undefined"!=typeof t[e]&&o.push(function(n){return r("$"==e?n:n&&n[e],t[e])})}(s);break;case"function":o.push(t);break;default:return e}for(var a=[],l=0;l<e.length;l++){var c=e[l];o.check(c)&&a.push(c)}return a}}function Ht(e){var t=e.NUMBER_FORMATS;return function(e,n){return v(n)&&(n=t.CURRENCY_SYM),Bt(e,t.PATTERNS[1],t.GROUP_SEP,t.DECIMAL_SEP,2).replace(/\u00A4/g,n)}}function Wt(e){var t=e.NUMBER_FORMATS;return function(e,n){return Bt(e,t.PATTERNS[0],t.GROUP_SEP,t.DECIMAL_SEP,n)}}function Bt(e,t,n,i,o){if(null==e||!isFinite(e)||y(e))return"";var r=0>e;e=Math.abs(e);var s=e+"",a="",l=[],c=!1;if(-1!==s.indexOf("e")){var u=s.match(/([\d\.]+)e(-?)(\d+)/);u&&"-"==u[2]&&u[3]>o+1?(s="0",e=0):(a=s,c=!0)}if(c)o>0&&e>-1&&1>e&&(a=e.toFixed(o));else{var d=(s.split(xi)[1]||"").length;v(o)&&(o=Math.min(Math.max(t.minFrac,d),t.maxFrac)),e=+(Math.round(+(e.toString()+"e"+o)).toString()+"e"+-o),0===e&&(r=!1);var h=(""+e).split(xi),p=h[0];h=h[1]||"";var f,g=0,m=t.lgSize,b=t.gSize;if(p.length>=m+b)for(g=p.length-m,f=0;g>f;f++)(g-f)%b===0&&0!==f&&(a+=n),a+=p.charAt(f);for(f=g;f<p.length;f++)(p.length-f)%m===0&&0!==f&&(a+=n),a+=p.charAt(f);for(;h.length<o;)h+="0";o&&"0"!==o&&(a+=i+h.substr(0,o))}return l.push(r?t.negPre:t.posPre),l.push(a),l.push(r?t.negSuf:t.posSuf),l.join("")}function Vt(e,t,n){var i="";for(0>e&&(i="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),i+e}function zt(e,t,n,i){return n=n||0,function(o){var r=o["get"+e]();return(n>0||r>-n)&&(r+=n),0===r&&-12==n&&(r=12),Vt(r,t,i)}}function qt(e,t){return function(n,i){var o=n["get"+e](),r=gn(t?"SHORT"+e:e);return i[r][o]}}function Yt(e){var t=-1*e.getTimezoneOffset(),n=t>=0?"+":"";return n+=Vt(Math[t>0?"floor":"ceil"](t/60),2)+Vt(Math.abs(t%60),2)}function Gt(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function Kt(e){function t(e){var t;if(t=e.match(n)){var i=new Date(0),o=0,r=0,s=t[8]?i.setUTCFullYear:i.setFullYear,a=t[8]?i.setUTCHours:i.setHours;t[9]&&(o=h(t[9]+t[10]),r=h(t[9]+t[11])),s.call(i,h(t[1]),h(t[2])-1,h(t[3]));var l=h(t[4]||0)-o,c=h(t[5]||0)-r,u=h(t[6]||0),d=Math.round(1e3*parseFloat("0."+(t[7]||0)));return a.call(i,l,c,u,d),i}return e}var n=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(n,i){var o,s,a="",l=[];if(i=i||"mediumDate",i=e.DATETIME_FORMATS[i]||i,w(n)&&(n=Ti.test(n)?h(n):t(n)),C(n)&&(n=new Date(n)),!_(n))return n;for(;i;)s=ki.exec(i),s?(l=F(l,s,1),i=l.pop()):(l.push(i),i=null);return r(l,function(t){o=Si[t],a+=o?o(n,e.DATETIME_FORMATS):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),a}}function Qt(){return function(e){return W(e,!0)}}function Xt(){return function(e,t){if(!Dn(e)&&!w(e))return e;if(t=Math.abs(Number(t))===1/0?Number(t):h(t),w(e))return t?t>=0?e.slice(0,t):e.slice(t,e.length):"";var n,i,o=[];for(t>e.length?t=e.length:t<-e.length&&(t=-e.length),t>0?(n=0,i=t):(n=e.length+t,i=e.length);i>n;n++)o.push(e[n]);return o}}function Jt(e){return function(t,n,i){function r(e,t){for(var i=0;i<n.length;i++){var o=n[i](e,t);if(0!==o)return o}return 0}function s(e,t){return V(t)?function(t,n){return e(n,t)}:e}function a(e,t){var n=typeof e,i=typeof t;return n==i?(_(e)&&_(t)&&(e=e.valueOf(),t=t.valueOf()),"string"==n&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t?0:t>e?-1:1):i>n?-1:1}if(!o(t))return t;if(!n)return t;n=Dn(n)?n:[n],n=M(n,function(t){var n=!1,i=t||g;if(w(t)&&(("+"==t.charAt(0)||"-"==t.charAt(0))&&(n="-"==t.charAt(0),t=t.substring(1)),i=e(t),i.constant)){var o=i();return s(function(e,t){return a(e[o],t[o])},n)}return s(function(e,t){return a(i(e),i(t))},n)});for(var l=[],c=0;c<t.length;c++)l.push(t[c]);return l.sort(s(r,i))}}function Zt(e){return x(e)&&(e={link:e}),e.restrict=e.restrict||"AC",m(e)}function en(e,t,n,i){function o(t,n){n=n?"-"+Z(n,"-"):"",i.setClass(e,(t?Hi:Wi)+n,(t?Wi:Hi)+n)}var s=this,a=e.parent().controller("form")||Mi,l=0,c=s.$error={},u=[];s.$name=t.name||t.ngForm,s.$dirty=!1,s.$pristine=!0,s.$valid=!0,s.$invalid=!1,a.$addControl(s),e.addClass(Bi),o(!0),s.$addControl=function(e){ie(e.$name,"input"),u.push(e),e.$name&&(s[e.$name]=e)},s.$removeControl=function(e){e.$name&&s[e.$name]===e&&delete s[e.$name],r(c,function(t,n){s.$setValidity(n,!0,e)}),R(u,e)},s.$setValidity=function(e,t,n){var i=c[e];if(t)i&&(R(i,n),i.length||(l--,l||(o(t),s.$valid=!0,s.$invalid=!1),c[e]=!1,o(!0,e),a.$setValidity(e,!0,s)));else{if(l||o(t),i){if(A(i,n))return}else c[e]=i=[],l++,o(!1,e),a.$setValidity(e,!1,s);i.push(n),s.$valid=!1,s.$invalid=!0}},s.$setDirty=function(){i.removeClass(e,Bi),i.addClass(e,Vi),s.$dirty=!0,s.$pristine=!1,a.$setDirty()},s.$setPristine=function(){i.removeClass(e,Vi),i.addClass(e,Bi),s.$dirty=!1,s.$pristine=!0,r(u,function(e){e.$setPristine()})}}function tn(e,t,i,o){return e.$setValidity(t,i),i?o:n}function nn(e,t){var n,i;if(t)for(n=0;n<t.length;++n)if(i=t[n],e[i])return!0;return!1}function on(e,t,n,i,o){if(y(o)){e.$$hasNativeValidators=!0;var r=function(r){return e.$error[t]||nn(o,i)||!nn(o,n)?r:void e.$setValidity(t,!1)};e.$parsers.push(r)}}function rn(e,t,n,o,r,s){var a=t.prop(hn),l=t[0].placeholder,c={},u=pn(t[0].type);if(o.$$validityState=a,!r.android){var d=!1;t.on("compositionstart",function(e){d=!0}),t.on("compositionend",function(){d=!1,p()})}var p=function(i){if(!d){var r=t.val();if(bn&&"input"===(i||c).type&&t[0].placeholder!==l)return void(l=t[0].placeholder);"password"!==u&&V(n.ngTrim||"T")&&(r=In(r));var s=a&&o.$$hasNativeValidators;(o.$viewValue!==r||""===r&&s)&&(e.$root.$$phase?o.$setViewValue(r):e.$apply(function(){o.$setViewValue(r)}))}};if(r.hasEvent("input"))t.on("input",p);else{var f,g=function(){f||(f=s.defer(function(){p(),f=null}))};t.on("keydown",function(e){var t=e.keyCode;91===t||t>15&&19>t||t>=37&&40>=t||g()}),r.hasEvent("paste")&&t.on("paste cut",g)}t.on("change",p),o.$render=function(){t.val(o.$isEmpty(o.$viewValue)?"":o.$viewValue)};var m,v,b=n.ngPattern;if(b){var y=function(e,t){return tn(o,"pattern",o.$isEmpty(t)||e.test(t),t)};v=b.match(/^\/(.*)\/([gim]*)$/),v?(b=new RegExp(v[1],v[2]),m=function(e){return y(b,e)}):m=function(n){var o=e.$eval(b);if(!o||!o.test)throw i("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",b,o,z(t));return y(o,n)},o.$formatters.push(m),o.$parsers.push(m)}if(n.ngMinlength){var w=h(n.ngMinlength),C=function(e){return tn(o,"minlength",o.$isEmpty(e)||e.length>=w,e)};o.$parsers.push(C),o.$formatters.push(C)}if(n.ngMaxlength){var _=h(n.ngMaxlength),x=function(e){return tn(o,"maxlength",o.$isEmpty(e)||e.length<=_,e)};o.$parsers.push(x),o.$formatters.push(x)}}function sn(e,t,i,o,r,s){if(rn(e,t,i,o,r,s),o.$parsers.push(function(e){var t=o.$isEmpty(e);return t||Li.test(e)?(o.$setValidity("number",!0),""===e?null:t?e:parseFloat(e)):(o.$setValidity("number",!1),n)}),on(o,"number",Ui,null,o.$$validityState),o.$formatters.push(function(e){return o.$isEmpty(e)?"":""+e}),i.min){var a=function(e){var t=parseFloat(i.min);return tn(o,"min",o.$isEmpty(e)||e>=t,e)};o.$parsers.push(a),o.$formatters.push(a)}if(i.max){var l=function(e){var t=parseFloat(i.max);return tn(o,"max",o.$isEmpty(e)||t>=e,e)};o.$parsers.push(l),o.$formatters.push(l)}o.$formatters.push(function(e){return tn(o,"number",o.$isEmpty(e)||C(e),e)})}function an(e,t,n,i,o,r){rn(e,t,n,i,o,r);var s=function(e){return tn(i,"url",i.$isEmpty(e)||Pi.test(e),e)};i.$formatters.push(s),i.$parsers.push(s)}function ln(e,t,n,i,o,r){rn(e,t,n,i,o,r);var s=function(e){return tn(i,"email",i.$isEmpty(e)||Ni.test(e),e)};i.$formatters.push(s),i.$parsers.push(s)}function cn(e,t,n,i){v(n.name)&&t.attr("name",c()),t.on("click",function(){t[0].checked&&e.$apply(function(){i.$setViewValue(n.value)})}),i.$render=function(){var e=n.value;t[0].checked=e==i.$viewValue},n.$observe("value",i.$render)}function un(e,t,n,i){var o=n.ngTrueValue,r=n.ngFalseValue;w(o)||(o=!0),w(r)||(r=!1),t.on("click",function(){e.$apply(function(){i.$setViewValue(t[0].checked)})}),i.$render=function(){t[0].checked=i.$viewValue},i.$isEmpty=function(e){return e!==o},i.$formatters.push(function(e){return e===o}),i.$parsers.push(function(e){return e?o:r})}function dn(e,t){return e="ngClass"+e,["$animate",function(n){function i(e,t){var n=[];e:for(var i=0;i<e.length;i++){for(var o=e[i],r=0;r<t.length;r++)if(o==t[r])continue e;n.push(o)}return n}function o(e){if(Dn(e))return e;if(w(e))return e.split(" ");if(y(e)){var t=[];return r(e,function(e,n){e&&(t=t.concat(n.split(" ")))}),t}return e}return{restrict:"AC",link:function(s,a,l){function c(e){var t=d(e,1);l.$addClass(t)}function u(e){var t=d(e,-1);l.$removeClass(t)}function d(e,t){var n=a.data("$classCounts")||{},i=[];return r(e,function(e){(t>0||n[e])&&(n[e]=(n[e]||0)+t,n[e]===+(t>0)&&i.push(e))}),a.data("$classCounts",n),i.join(" ")}function h(e,t){var o=i(t,e),r=i(e,t);r=d(r,-1),o=d(o,1),0===o.length?n.removeClass(a,r):0===r.length?n.addClass(a,o):n.setClass(a,o,r)}function p(e){if(t===!0||s.$index%2===t){var n=o(e||[]);if(f){if(!L(e,f)){var i=o(f);h(i,n)}}else c(n)}f=N(e)}var f;s.$watch(l[e],p,!0),l.$observe("class",function(t){p(s.$eval(l[e]))}),"ngClass"!==e&&s.$watch("$index",function(n,i){var r=1&n;if(r!==(1&i)){var a=o(s.$eval(l[e]));r===t?c(a):u(a)}})}}}]}var hn="validity",pn=function(e){return w(e)?e.toLowerCase():e},fn=Object.prototype.hasOwnProperty,gn=function(e){return w(e)?e.toUpperCase():e},mn=function(e){return w(e)?e.replace(/[A-Z]/g,function(e){return String.fromCharCode(32|e.charCodeAt(0))}):e},vn=function(e){return w(e)?e.replace(/[a-z]/g,function(e){return String.fromCharCode(-33&e.charCodeAt(0))}):e};"i"!=="I".toLowerCase()&&(pn=mn,gn=vn);var bn,yn,wn,Cn,_n,xn=[].slice,Sn=[].push,kn=Object.prototype.toString,Tn=i("ng"),$n=e.angular||(e.angular={}),En=["0","0","0"];bn=h((/msie (\d+)/.exec(pn(navigator.userAgent))||[])[1]),isNaN(bn)&&(bn=h((/trident\/.*; rv:(\d+)/.exec(pn(navigator.userAgent))||[])[1])),f.$inject=[],g.$inject=[];var Dn=function(){return x(Array.isArray)?Array.isArray:function(e){return"[object Array]"===kn.call(e)}}(),In=function(){return String.prototype.trim?function(e){return w(e)?e.trim():e}:function(e){return w(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();_n=9>bn?function(e){return e=e.nodeName?e:e[0],e.scopeName&&"HTML"!=e.scopeName?gn(e.scopeName+":"+e.nodeName):e.nodeName}:function(e){return e.nodeName?e.nodeName:e[0].nodeName};var Mn=function(){if(b(Mn.isActive_))return Mn.isActive_;var e=!(!t.querySelector("[ng-csp]")&&!t.querySelector("[data-ng-csp]"));if(!e)try{new Function("")}catch(n){e=!0}return Mn.isActive_=e},An=/[A-Z]/g,On={full:"1.2.25",major:1,minor:2,dot:25,codeName:"hypnotic-gesticulation"};fe.expando="ng339";var Rn=fe.cache={},Pn=1,Nn=e.document.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)},Ln=e.document.removeEventListener?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)},Fn=(fe._data=function(e){return this.cache[e[this.expando]]||{}},/([\:\-\_]+(.))/g),Un=/^moz([A-Z])/,jn=i("jqLite"),Hn=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Wn=/<|&#?\w+;/,Bn=/<([\w:]+)/,Vn=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,zn={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};zn.optgroup=zn.option,zn.tbody=zn.tfoot=zn.colgroup=zn.caption=zn.thead,zn.th=zn.td;var qn=fe.prototype={ready:function(n){function i(){o||(o=!0,n())}var o=!1;"complete"===t.readyState?setTimeout(i):(this.on("DOMContentLoaded",i),fe(e).on("load",i))},toString:function(){var e=[];return r(this,function(t){e.push(""+t)}),"["+e.join(", ")+"]"},eq:function(e){return yn(e>=0?this[e]:this[this.length+e])},length:0,push:Sn,sort:[].sort,splice:[].splice},Yn={};r("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(e){Yn[pn(e)]=e});var Gn={};r("input,select,option,textarea,button,form,details".split(","),function(e){Gn[gn(e)]=!0}),r({data:we,removeData:be},function(e,t){fe[t]=e}),r({data:we,inheritedData:Te,scope:function(e){return yn.data(e,"$scope")||Te(e.parentNode||e,["$isolateScope","$scope"])},isolateScope:function(e){return yn.data(e,"$isolateScope")||yn.data(e,"$isolateScopeNoTemplate")},controller:ke,injector:function(e){return Te(e,"$injector")},removeAttr:function(e,t){e.removeAttribute(t)},hasClass:Ce,css:function(e,t,i){if(t=ce(t),!b(i)){var o;return 8>=bn&&(o=e.currentStyle&&e.currentStyle[t],""===o&&(o="auto")),o=o||e.style[t],8>=bn&&(o=""===o?n:o),o}e.style[t]=i},attr:function(e,t,i){var o=pn(t);if(Yn[o]){if(!b(i))return e[t]||(e.attributes.getNamedItem(t)||f).specified?o:n;i?(e[t]=!0,e.setAttribute(t,o)):(e[t]=!1,e.removeAttribute(o))}else if(b(i))e.setAttribute(t,i);else if(e.getAttribute){var r=e.getAttribute(t,2);return null===r?n:r}},prop:function(e,t,n){return b(n)?void(e[t]=n):e[t]},text:function(){function e(e,n){var i=t[e.nodeType];return v(n)?i?e[i]:"":void(e[i]=n)}var t=[];return 9>bn?(t[1]="innerText",t[3]="nodeValue"):t[1]=t[3]="textContent",e.$dv="",e}(),val:function(e,t){if(v(t)){if("SELECT"===_n(e)&&e.multiple){var n=[];

return r(e.options,function(e){e.selected&&n.push(e.value||e.text)}),0===n.length?null:n}return e.value}e.value=t},html:function(e,t){if(v(t))return e.innerHTML;for(var n=0,i=e.childNodes;n<i.length;n++)me(i[n]);e.innerHTML=t},empty:$e},function(e,t){fe.prototype[t]=function(t,i){var o,r,s=this.length;if(e!==$e&&(2==e.length&&e!==Ce&&e!==ke?t:i)===n){if(y(t)){for(o=0;s>o;o++)if(e===we)e(this[o],t);else for(r in t)e(this[o],r,t[r]);return this}for(var a=e.$dv,l=a===n?Math.min(s,1):s,c=0;l>c;c++){var u=e(this[c],t,i);a=a?a+u:u}return a}for(o=0;s>o;o++)e(this[o],t,i);return this}}),r({removeData:be,dealoc:me,on:function Do(e,n,i,o){if(b(o))throw jn("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");var s=ye(e,"events"),a=ye(e,"handle");s||ye(e,"events",s={}),a||ye(e,"handle",a=De(e,s)),r(n.split(" "),function(n){var o=s[n];if(!o){if("mouseenter"==n||"mouseleave"==n){var r=t.body.contains||t.body.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};s[n]=[];var l={mouseleave:"mouseout",mouseenter:"mouseover"};Do(e,l[n],function(e){var t=this,i=e.relatedTarget;(!i||i!==t&&!r(t,i))&&a(e,n)})}else Nn(e,n,a),s[n]=[];o=s[n]}o.push(i)})},off:ve,one:function(e,t,n){e=yn(e),e.on(t,function i(){e.off(t,n),e.off(t,i)}),e.on(t,n)},replaceWith:function(e,t){var n,i=e.parentNode;me(e),r(new fe(t),function(t){n?i.insertBefore(t,n.nextSibling):i.replaceChild(t,e),n=t})},children:function(e){var t=[];return r(e.childNodes,function(e){1===e.nodeType&&t.push(e)}),t},contents:function(e){return e.contentDocument||e.childNodes||[]},append:function(e,t){r(new fe(t),function(t){(1===e.nodeType||11===e.nodeType)&&e.appendChild(t)})},prepend:function(e,t){if(1===e.nodeType){var n=e.firstChild;r(new fe(t),function(t){e.insertBefore(t,n)})}},wrap:function(e,t){t=yn(t)[0];var n=e.parentNode;n&&n.replaceChild(t,e),t.appendChild(e)},remove:function(e){me(e);var t=e.parentNode;t&&t.removeChild(e)},after:function(e,t){var n=e,i=e.parentNode;r(new fe(t),function(e){i.insertBefore(e,n.nextSibling),n=e})},addClass:xe,removeClass:_e,toggleClass:function(e,t,n){t&&r(t.split(" "),function(t){var i=n;v(i)&&(i=!Ce(e,t)),(i?xe:_e)(e,t)})},parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},next:function(e){if(e.nextElementSibling)return e.nextElementSibling;for(var t=e.nextSibling;null!=t&&1!==t.nodeType;)t=t.nextSibling;return t},find:function(e,t){return e.getElementsByTagName?e.getElementsByTagName(t):[]},clone:ge,triggerHandler:function(e,t,n){var i,o,s,a=t.type||t,l=(ye(e,"events")||{})[a];l&&(i={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return this.defaultPrevented===!0},stopPropagation:f,type:a,target:e},t.type&&(i=d(i,t)),o=N(l),s=n?[i].concat(n):[i],r(o,function(t){t.apply(e,s)}))}},function(e,t){fe.prototype[t]=function(t,n,i){for(var o,r=0;r<this.length;r++)v(o)?(o=e(this[r],t,n,i),b(o)&&(o=yn(o))):Se(o,e(this[r],t,n,i));return b(o)?o:this},fe.prototype.bind=fe.prototype.on,fe.prototype.unbind=fe.prototype.off}),Me.prototype={put:function(e,t){this[Ie(e,this.nextUid)]=t},get:function(e){return this[Ie(e,this.nextUid)]},remove:function(e){var t=this[e=Ie(e,this.nextUid)];return delete this[e],t}};var Kn=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,Qn=/,/,Xn=/^\s*(_?)(\S+?)\1\s*$/,Jn=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,Zn=i("$injector"),ei=i("$animate"),ti=["$provide",function(e){this.$$selectors={},this.register=function(t,n){var i=t+"-animation";if(t&&"."!=t.charAt(0))throw ei("notcsel","Expecting class selector starting with '.' got '{0}'.",t);this.$$selectors[t.substr(1)]=i,e.factory(i,n)},this.classNameFilter=function(e){return 1===arguments.length&&(this.$$classNameFilter=e instanceof RegExp?e:null),this.$$classNameFilter},this.$get=["$timeout","$$asyncCallback",function(e,t){function n(e){e&&t(e)}return{enter:function(e,t,i,o){i?i.after(e):(t&&t[0]||(t=i.parent()),t.append(e)),n(o)},leave:function(e,t){e.remove(),n(t)},move:function(e,t,n,i){this.enter(e,t,n,i)},addClass:function(e,t,i){t=w(t)?t:Dn(t)?t.join(" "):"",r(e,function(e){xe(e,t)}),n(i)},removeClass:function(e,t,i){t=w(t)?t:Dn(t)?t.join(" "):"",r(e,function(e){_e(e,t)}),n(i)},setClass:function(e,t,i,o){r(e,function(e){xe(e,t),_e(e,i)}),n(o)},enabled:f}}]}],ni=i("$compile");je.$inject=["$provide","$$sanitizeUriProvider"];var ii=/^(x[\:\-_]|data[\:\-_])/i,oi=i("$interpolate"),ri=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,si={http:80,https:443,ftp:21},ai=i("$location");ht.prototype=dt.prototype=ut.prototype={$$html5:!1,$$replace:!1,absUrl:pt("$$absUrl"),url:function(e){if(v(e))return this.$$url;var t=ri.exec(e);return t[1]&&this.path(decodeURIComponent(t[1])),(t[2]||t[1])&&this.search(t[3]||""),this.hash(t[5]||""),this},protocol:pt("$$protocol"),host:pt("$$host"),port:pt("$$port"),path:ft("$$path",function(e){return e=e?e.toString():"","/"==e.charAt(0)?e:"/"+e}),search:function(e,t){switch(arguments.length){case 0:return this.$$search;case 1:if(w(e)||C(e))e=e.toString(),this.$$search=Y(e);else{if(!y(e))throw ai("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");r(e,function(t,n){null==t&&delete e[n]}),this.$$search=e}break;default:v(t)||null===t?delete this.$$search[e]:this.$$search[e]=t}return this.$$compose(),this},hash:ft("$$hash",function(e){return e?e.toString():""}),replace:function(){return this.$$replace=!0,this}};var li,ci=i("$parse"),ui={},di=Function.prototype.call,hi=Function.prototype.apply,pi=Function.prototype.bind,fi={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:f,"+":function(e,t,i,o){return i=i(e,t),o=o(e,t),b(i)?b(o)?i+o:i:b(o)?o:n},"-":function(e,t,n,i){return n=n(e,t),i=i(e,t),(b(n)?n:0)-(b(i)?i:0)},"*":function(e,t,n,i){return n(e,t)*i(e,t)},"/":function(e,t,n,i){return n(e,t)/i(e,t)},"%":function(e,t,n,i){return n(e,t)%i(e,t)},"^":function(e,t,n,i){return n(e,t)^i(e,t)},"=":f,"===":function(e,t,n,i){return n(e,t)===i(e,t)},"!==":function(e,t,n,i){return n(e,t)!==i(e,t)},"==":function(e,t,n,i){return n(e,t)==i(e,t)},"!=":function(e,t,n,i){return n(e,t)!=i(e,t)},"<":function(e,t,n,i){return n(e,t)<i(e,t)},">":function(e,t,n,i){return n(e,t)>i(e,t)},"<=":function(e,t,n,i){return n(e,t)<=i(e,t)},">=":function(e,t,n,i){return n(e,t)>=i(e,t)},"&&":function(e,t,n,i){return n(e,t)&&i(e,t)},"||":function(e,t,n,i){return n(e,t)||i(e,t)},"&":function(e,t,n,i){return n(e,t)&i(e,t)},"|":function(e,t,n,i){return i(e,t)(e,t,n(e,t))},"!":function(e,t,n){return!n(e,t)}},gi={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},mi=function(e){this.options=e};mi.prototype={constructor:mi,lex:function(e){for(this.text=e,this.index=0,this.ch=n,this.lastCh=":",this.tokens=[];this.index<this.text.length;){if(this.ch=this.text.charAt(this.index),this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),this.index++;else{if(this.isWhitespace(this.ch)){this.index++;continue}var t=this.ch+this.peek(),i=t+this.peek(2),o=fi[this.ch],r=fi[t],s=fi[i];s?(this.tokens.push({index:this.index,text:i,fn:s}),this.index+=3):r?(this.tokens.push({index:this.index,text:t,fn:r}),this.index+=2):o?(this.tokens.push({index:this.index,text:this.ch,fn:o}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(e){return-1!==e.indexOf(this.ch)},was:function(e){return-1!==e.indexOf(this.lastCh)},peek:function(e){var t=e||1;return this.index+t<this.text.length?this.text.charAt(this.index+t):!1},isNumber:function(e){return e>="0"&&"9">=e},isWhitespace:function(e){return" "===e||"\r"===e||"	"===e||"\n"===e||""===e||" "===e},isIdent:function(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e||"_"===e||"$"===e},isExpOperator:function(e){return"-"===e||"+"===e||this.isNumber(e)},throwError:function(e,t,n){n=n||this.index;var i=b(t)?"s "+t+"-"+this.index+" ["+this.text.substring(t,n)+"]":" "+n;throw ci("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",e,i,this.text)},readNumber:function(){for(var e="",t=this.index;this.index<this.text.length;){var n=pn(this.text.charAt(this.index));if("."==n||this.isNumber(n))e+=n;else{var i=this.peek();if("e"==n&&this.isExpOperator(i))e+=n;else if(this.isExpOperator(n)&&i&&this.isNumber(i)&&"e"==e.charAt(e.length-1))e+=n;else{if(!this.isExpOperator(n)||i&&this.isNumber(i)||"e"!=e.charAt(e.length-1))break;this.throwError("Invalid exponent")}}this.index++}e=1*e,this.tokens.push({index:t,text:e,literal:!0,constant:!0,fn:function(){return e}})},readIdent:function(){for(var e,t,n,i,o=this,r="",s=this.index;this.index<this.text.length&&(i=this.text.charAt(this.index),"."===i||this.isIdent(i)||this.isNumber(i));)"."===i&&(e=this.index),r+=i,this.index++;if(e)for(t=this.index;t<this.text.length;){if(i=this.text.charAt(t),"("===i){n=r.substr(e-s+1),r=r.substr(0,e-s),this.index=t;break}if(!this.isWhitespace(i))break;t++}var a={index:s,text:r};if(fi.hasOwnProperty(r))a.fn=fi[r],a.literal=!0,a.constant=!0;else{var l=_t(r,this.options,this.text);a.fn=d(function(e,t){return l(e,t)},{assign:function(e,t){return wt(e,r,t,o.text,o.options)}})}this.tokens.push(a),n&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:n}))},readString:function(e){var t=this.index;this.index++;for(var n="",i=e,o=!1;this.index<this.text.length;){var r=this.text.charAt(this.index);if(i+=r,o){if("u"===r){var s=this.text.substring(this.index+1,this.index+5);s.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+s+"]"),this.index+=4,n+=String.fromCharCode(parseInt(s,16))}else{var a=gi[r];n+=a||r}o=!1}else if("\\"===r)o=!0;else{if(r===e)return this.index++,void this.tokens.push({index:t,text:i,string:n,literal:!0,constant:!0,fn:function(){return n}});n+=r}this.index++}this.throwError("Unterminated quote",t)}};var vi=function(e,t,n){this.lexer=e,this.$filter=t,this.options=n};vi.ZERO=d(function(){return 0},{constant:!0}),vi.prototype={constructor:vi,parse:function(e){this.text=e,this.tokens=this.lexer.lex(e);var t=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),t.literal=!!t.literal,t.constant=!!t.constant,t},primary:function(){var e;if(this.expect("("))e=this.filterChain(),this.consume(")");else if(this.expect("["))e=this.arrayDeclaration();else if(this.expect("{"))e=this.object();else{var t=this.expect();e=t.fn,e||this.throwError("not a primary expression",t),e.literal=!!t.literal,e.constant=!!t.constant}for(var n,i;n=this.expect("(","[",".");)"("===n.text?(e=this.functionCall(e,i),i=null):"["===n.text?(i=e,e=this.objectIndex(e)):"."===n.text?(i=e,e=this.fieldAccess(e)):this.throwError("IMPOSSIBLE");return e},throwError:function(e,t){throw ci("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",t.text,e,t.index+1,this.text,this.text.substring(t.index))},peekToken:function(){if(0===this.tokens.length)throw ci("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e,t,n,i){if(this.tokens.length>0){var o=this.tokens[0],r=o.text;if(r===e||r===t||r===n||r===i||!e&&!t&&!n&&!i)return o}return!1},expect:function(e,t,n,i){var o=this.peek(e,t,n,i);return o?(this.tokens.shift(),o):!1},consume:function(e){this.expect(e)||this.throwError("is unexpected, expecting ["+e+"]",this.peek())},unaryFn:function(e,t){return d(function(n,i){return e(n,i,t)},{constant:t.constant})},ternaryFn:function(e,t,n){return d(function(i,o){return e(i,o)?t(i,o):n(i,o)},{constant:e.constant&&t.constant&&n.constant})},binaryFn:function(e,t,n){return d(function(i,o){return t(i,o,e,n)},{constant:e.constant&&n.constant})},statements:function(){for(var e=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&e.push(this.filterChain()),!this.expect(";"))return 1===e.length?e[0]:function(t,n){for(var i,o=0;o<e.length;o++){var r=e[o];r&&(i=r(t,n))}return i}},filterChain:function(){for(var e,t=this.expression();;){if(!(e=this.expect("|")))return t;t=this.binaryFn(t,e.fn,this.filter())}},filter:function(){for(var e=this.expect(),t=this.$filter(e.text),n=[];;){if(!(e=this.expect(":"))){var i=function(e,i,o){for(var r=[o],s=0;s<n.length;s++)r.push(n[s](e,i));return t.apply(e,r)};return function(){return i}}n.push(this.expression())}},expression:function(){return this.assignment()},assignment:function(){var e,t,n=this.ternary();return(t=this.expect("="))?(n.assign||this.throwError("implies assignment but ["+this.text.substring(0,t.index)+"] can not be assigned to",t),e=this.ternary(),function(t,i){return n.assign(t,e(t,i),i)}):n},ternary:function(){var e,t,n=this.logicalOR();return(t=this.expect("?"))?(e=this.assignment(),(t=this.expect(":"))?this.ternaryFn(n,e,this.assignment()):void this.throwError("expected :",t)):n},logicalOR:function(){for(var e,t=this.logicalAND();;){if(!(e=this.expect("||")))return t;t=this.binaryFn(t,e.fn,this.logicalAND())}},logicalAND:function(){var e,t=this.equality();return(e=this.expect("&&"))&&(t=this.binaryFn(t,e.fn,this.logicalAND())),t},equality:function(){var e,t=this.relational();return(e=this.expect("==","!=","===","!=="))&&(t=this.binaryFn(t,e.fn,this.equality())),t},relational:function(){var e,t=this.additive();return(e=this.expect("<",">","<=",">="))&&(t=this.binaryFn(t,e.fn,this.relational())),t},additive:function(){for(var e,t=this.multiplicative();e=this.expect("+","-");)t=this.binaryFn(t,e.fn,this.multiplicative());return t},multiplicative:function(){for(var e,t=this.unary();e=this.expect("*","/","%");)t=this.binaryFn(t,e.fn,this.unary());return t},unary:function(){var e;return this.expect("+")?this.primary():(e=this.expect("-"))?this.binaryFn(vi.ZERO,e.fn,this.unary()):(e=this.expect("!"))?this.unaryFn(e.fn,this.unary()):this.primary()},fieldAccess:function(e){var t=this,n=this.expect().text,i=_t(n,this.options,this.text);return d(function(t,n,o){return i(o||e(t,n))},{assign:function(i,o,r){var s=e(i,r);return s||e.assign(i,s={}),wt(s,n,o,t.text,t.options)}})},objectIndex:function(e){var t=this,i=this.expression();return this.consume("]"),d(function(o,r){var s,a,l=e(o,r),c=i(o,r);return vt(c,t.text),l?(s=bt(l[c],t.text),s&&s.then&&t.options.unwrapPromises&&(a=s,"$$v"in s||(a.$$v=n,a.then(function(e){a.$$v=e})),s=s.$$v),s):n},{assign:function(n,o,r){var s=vt(i(n,r),t.text),a=bt(e(n,r),t.text);return a||e.assign(n,a={}),a[s]=o}})},functionCall:function(e,t){var n=[];if(")"!==this.peekToken().text)do n.push(this.expression());while(this.expect(","));this.consume(")");var i=this;return function(o,r){for(var s=[],a=t?t(o,r):o,l=0;l<n.length;l++)s.push(bt(n[l](o,r),i.text));var c=e(o,r,a)||f;bt(a,i.text),yt(c,i.text);var u=c.apply?c.apply(a,s):c(s[0],s[1],s[2],s[3],s[4]);return bt(u,i.text)}},arrayDeclaration:function(){var e=[],t=!0;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;var n=this.expression();e.push(n),n.constant||(t=!1)}while(this.expect(","));return this.consume("]"),d(function(t,n){for(var i=[],o=0;o<e.length;o++)i.push(e[o](t,n));return i},{literal:!0,constant:t})},object:function(){var e=[],t=!0;if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var n=this.expect(),i=n.string||n.text;this.consume(":");var o=this.expression();e.push({key:i,value:o}),o.constant||(t=!1)}while(this.expect(","));return this.consume("}"),d(function(t,n){for(var i={},o=0;o<e.length;o++){var r=e[o];i[r.key]=r.value(t,n)}return i},{literal:!0,constant:t})}};var bi={},yi=i("$sce"),wi={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Ci=t.createElement("a"),_i=Nt(e.location.href,!0);Ut.$inject=["$provide"],Ht.$inject=["$locale"],Wt.$inject=["$locale"];var xi=".",Si={yyyy:zt("FullYear",4),yy:zt("FullYear",2,0,!0),y:zt("FullYear",1),MMMM:qt("Month"),MMM:qt("Month",!0),MM:zt("Month",2,1),M:zt("Month",1,1),dd:zt("Date",2),d:zt("Date",1),HH:zt("Hours",2),H:zt("Hours",1),hh:zt("Hours",2,-12),h:zt("Hours",1,-12),mm:zt("Minutes",2),m:zt("Minutes",1),ss:zt("Seconds",2),s:zt("Seconds",1),sss:zt("Milliseconds",3),EEEE:qt("Day"),EEE:qt("Day",!0),a:Gt,Z:Yt},ki=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,Ti=/^\-?\d+$/;Kt.$inject=["$locale"];var $i=m(pn),Ei=m(gn);Jt.$inject=["$parse"];var Di=m({restrict:"E",compile:function(e,n){return 8>=bn&&(n.href||n.name||n.$set("href",""),e.append(t.createComment("IE fix"))),n.href||n.xlinkHref||n.name?void 0:function(e,t){var n="[object SVGAnimatedString]"===kn.call(t.prop("href"))?"xlink:href":"href";t.on("click",function(e){t.attr(n)||e.preventDefault()})}}}),Ii={};r(Yn,function(e,t){if("multiple"!=e){var n=He("ng-"+t);Ii[n]=function(){return{priority:100,link:function(e,i,o){e.$watch(o[n],function(e){o.$set(t,!!e)})}}}}}),r(["src","srcset","href"],function(e){var t=He("ng-"+e);Ii[t]=function(){return{priority:99,link:function(n,i,o){var r=e,s=e;"href"===e&&"[object SVGAnimatedString]"===kn.call(i.prop("href"))&&(s="xlinkHref",o.$attr[s]="xlink:href",r=null),o.$observe(t,function(t){return t?(o.$set(s,t),void(bn&&r&&i.prop(r,o[s]))):void("href"===e&&o.$set(s,null))})}}}});var Mi={$addControl:f,$removeControl:f,$setValidity:f,$setDirty:f,$setPristine:f};en.$inject=["$element","$attrs","$scope","$animate"];var Ai=function(e){return["$timeout",function(t){var i={name:"form",restrict:e?"EAC":"E",controller:en,compile:function(){return{pre:function(e,i,o,r){if(!o.action){var s=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};Nn(i[0],"submit",s),i.on("$destroy",function(){t(function(){Ln(i[0],"submit",s)},0,!1)})}var a=i.parent().controller("form"),l=o.name||o.ngForm;l&&wt(e,l,r,l),a&&i.on("$destroy",function(){a.$removeControl(r),l&&wt(e,l,n,l),d(r,Mi)})}}}};return i}]},Oi=Ai(),Ri=Ai(!0),Pi=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Ni=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,Li=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Fi={text:rn,number:sn,url:an,email:ln,radio:cn,checkbox:un,hidden:f,button:f,submit:f,reset:f,file:f},Ui=["badInput"],ji=["$browser","$sniffer",function(e,t){return{restrict:"E",require:"?ngModel",link:function(n,i,o,r){r&&(Fi[pn(o.type)]||Fi.text)(n,i,o,r,t,e)}}}],Hi="ng-valid",Wi="ng-invalid",Bi="ng-pristine",Vi="ng-dirty",zi=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(e,t,n,o,s,a){function l(e,t){t=t?"-"+Z(t,"-"):"",a.removeClass(o,(e?Wi:Hi)+t),a.addClass(o,(e?Hi:Wi)+t)}this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$name=n.name;var c=s(n.ngModel),u=c.assign;if(!u)throw i("ngModel")("nonassign","Expression '{0}' is non-assignable. Element: {1}",n.ngModel,z(o));this.$render=f,this.$isEmpty=function(e){return v(e)||""===e||null===e||e!==e};var d=o.inheritedData("$formController")||Mi,h=0,p=this.$error={};o.addClass(Bi),l(!0),this.$setValidity=function(e,t){p[e]!==!t&&(t?(p[e]&&h--,h||(l(!0),this.$valid=!0,this.$invalid=!1)):(l(!1),this.$invalid=!0,this.$valid=!1,h++),p[e]=!t,l(t,e),d.$setValidity(e,t,this))},this.$setPristine=function(){this.$dirty=!1,this.$pristine=!0,a.removeClass(o,Vi),a.addClass(o,Bi)},this.$setViewValue=function(n){this.$viewValue=n,this.$pristine&&(this.$dirty=!0,this.$pristine=!1,a.removeClass(o,Bi),a.addClass(o,Vi),d.$setDirty()),r(this.$parsers,function(e){n=e(n)}),this.$modelValue!==n&&(this.$modelValue=n,u(e,n),r(this.$viewChangeListeners,function(e){try{e()}catch(n){t(n)}}))};var g=this;e.$watch(function(){var t=c(e);if(g.$modelValue!==t){var n=g.$formatters,i=n.length;for(g.$modelValue=t;i--;)t=n[i](t);g.$viewValue!==t&&(g.$viewValue=t,g.$render())}return t})}],qi=function(){return{require:["ngModel","^?form"],controller:zi,link:function(e,t,n,i){var o=i[0],r=i[1]||Mi;r.$addControl(o),e.$on("$destroy",function(){r.$removeControl(o)})}}},Yi=m({require:"ngModel",link:function(e,t,n,i){i.$viewChangeListeners.push(function(){e.$eval(n.ngChange)})}}),Gi=function(){return{require:"?ngModel",link:function(e,t,n,i){if(i){n.required=!0;var o=function(e){return n.required&&i.$isEmpty(e)?void i.$setValidity("required",!1):(i.$setValidity("required",!0),e)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("required",function(){o(i.$viewValue)})}}}},Ki=function(){return{require:"ngModel",link:function(e,t,i,o){var s=/\/(.*)\//.exec(i.ngList),a=s&&new RegExp(s[1])||i.ngList||",",l=function(e){if(!v(e)){var t=[];return e&&r(e.split(a),function(e){e&&t.push(In(e))}),t}};o.$parsers.push(l),o.$formatters.push(function(e){return Dn(e)?e.join(", "):n}),o.$isEmpty=function(e){return!e||!e.length}}}},Qi=/^(true|false|\d+)$/,Xi=function(){return{priority:100,compile:function(e,t){return Qi.test(t.ngValue)?function(e,t,n){n.$set("value",e.$eval(n.ngValue))}:function(e,t,n){e.$watch(n.ngValue,function(e){n.$set("value",e)})}}}},Ji=Zt({compile:function(e){return e.addClass("ng-binding"),function(e,t,i){t.data("$binding",i.ngBind),e.$watch(i.ngBind,function(e){t.text(e==n?"":e)})}}}),Zi=["$interpolate",function(e){return function(t,n,i){var o=e(n.attr(i.$attr.ngBindTemplate));n.addClass("ng-binding").data("$binding",o),i.$observe("ngBindTemplate",function(e){n.text(e)})}}],eo=["$sce","$parse",function(e,t){return{compile:function(n){return n.addClass("ng-binding"),function(n,i,o){function r(){return(s(n)||"").toString()}i.data("$binding",o.ngBindHtml);var s=t(o.ngBindHtml);n.$watch(r,function(t){i.html(e.getTrustedHtml(s(n))||"")})}}}}],to=dn("",!0),no=dn("Odd",0),io=dn("Even",1),oo=Zt({compile:function(e,t){t.$set("ngCloak",n),e.removeClass("ng-cloak")}}),ro=[function(){return{scope:!0,controller:"@",priority:500}}],so={},ao={blur:!0,focus:!0};r("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(e){var t=He("ng-"+e);so[t]=["$parse","$rootScope",function(n,i){return{compile:function(o,r){var s=n(r[t]);return function(t,n){n.on(e,function(n){var o=function(){s(t,{$event:n})};ao[e]&&i.$$phase?t.$evalAsync(o):t.$apply(o)})}}}}]});var lo=["$animate",function(e){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(n,i,o,r,s){var a,l,c;n.$watch(o.ngIf,function(r){V(r)?l||(l=n.$new(),s(l,function(n){n[n.length++]=t.createComment(" end ngIf: "+o.ngIf+" "),a={clone:n},e.enter(n,i.parent(),i)})):(c&&(c.remove(),c=null),l&&(l.$destroy(),l=null),a&&(c=re(a.clone),e.leave(c,function(){c=null}),a=null))})}}}],co=["$http","$templateCache","$anchorScroll","$animate","$sce",function(e,t,n,i,o){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:$n.noop,compile:function(r,s){var a=s.ngInclude||s.src,l=s.onload||"",c=s.autoscroll;return function(r,s,u,d,h){var p,f,g,m=0,v=function(){f&&(f.remove(),f=null),p&&(p.$destroy(),p=null),g&&(i.leave(g,function(){f=null}),f=g,g=null)};r.$watch(o.parseAsResourceUrl(a),function(o){var a=function(){!b(c)||c&&!r.$eval(c)||n()},u=++m;o?(e.get(o,{cache:t}).success(function(e){if(u===m){var t=r.$new();d.template=e;var n=h(t,function(e){v(),i.enter(e,null,s,a)});p=t,g=n,p.$emit("$includeContentLoaded"),r.$eval(l)}}).error(function(){u===m&&v()}),r.$emit("$includeContentRequested")):(v(),d.template=null)})}}}}],uo=["$compile",function(e){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(t,n,i,o){n.html(o.template),e(n.contents())(t)}}}],ho=Zt({priority:450,compile:function(){return{pre:function(e,t,n){e.$eval(n.ngInit)}}}}),po=Zt({terminal:!0,priority:1e3}),fo=["$locale","$interpolate",function(e,t){var n=/{}/g;return{restrict:"EA",link:function(i,o,s){var a=s.count,l=s.$attr.when&&o.attr(s.$attr.when),c=s.offset||0,u=i.$eval(l)||{},d={},h=t.startSymbol(),p=t.endSymbol(),f=/^when(Minus)?(.+)$/;r(s,function(e,t){f.test(t)&&(u[pn(t.replace("when","").replace("Minus","-"))]=o.attr(s.$attr[t]))}),r(u,function(e,i){d[i]=t(e.replace(n,h+a+"-"+c+p))}),i.$watch(function(){var t=parseFloat(i.$eval(a));return isNaN(t)?"":(t in u||(t=e.pluralCat(t-c)),d[t](i,o,!0))},function(e){o.text(e)})}}}],go=["$parse","$animate",function(e,n){function s(e){return e.clone[0]}function a(e){return e.clone[e.clone.length-1]}var l="$$NG_REMOVED",c=i("ngRepeat");return{transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,link:function(i,u,d,h,p){var f,g,m,v,b,y,w,C,_,x=d.ngRepeat,S=x.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),k={$id:Ie};if(!S)throw c("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",x);if(y=S[1],w=S[2],f=S[3],f?(g=e(f),m=function(e,t,n){return _&&(k[_]=e),k[C]=t,k.$index=n,g(i,k)}):(v=function(e,t){return Ie(t)},b=function(e){return e}),S=y.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!S)throw c("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",y);C=S[3]||S[1],_=S[2];var T={};i.$watchCollection(w,function(e){var d,h,f,g,y,w,S,k,$,E,D,I,M=u[0],A={},O=[];if(o(e))E=e,$=m||v;else{$=m||b,E=[];for(w in e)e.hasOwnProperty(w)&&"$"!=w.charAt(0)&&E.push(w);E.sort()}for(g=E.length,h=O.length=E.length,d=0;h>d;d++)if(w=e===E?d:E[d],S=e[w],k=$(w,S,d),ie(k,"`track by` id"),T.hasOwnProperty(k))D=T[k],delete T[k],A[k]=D,O[d]=D;else{if(A.hasOwnProperty(k))throw r(O,function(e){e&&e.scope&&(T[e.id]=e)}),c("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",x,k,W(S));O[d]={id:k},A[k]=!1}for(w in T)T.hasOwnProperty(w)&&(D=T[w],I=re(D.clone),n.leave(I),r(I,function(e){e[l]=!0}),D.scope.$destroy());for(d=0,h=E.length;h>d;d++){if(w=e===E?d:E[d],S=e[w],D=O[d],O[d-1]&&(M=a(O[d-1])),D.scope){y=D.scope,f=M;do f=f.nextSibling;while(f&&f[l]);s(D)!=f&&n.move(re(D.clone),null,yn(M)),M=a(D)}else y=i.$new();y[C]=S,_&&(y[_]=w),y.$index=d,y.$first=0===d,y.$last=d===g-1,y.$middle=!(y.$first||y.$last),y.$odd=!(y.$even=0===(1&d)),D.scope||p(y,function(e){e[e.length++]=t.createComment(" end ngRepeat: "+x+" "),n.enter(e,null,yn(M)),M=e,D.scope=y,D.clone=e,A[D.id]=D})}T=A})}}}],mo=["$animate",function(e){return function(t,n,i){t.$watch(i.ngShow,function(t){e[V(t)?"removeClass":"addClass"](n,"ng-hide")})}}],vo=["$animate",function(e){return function(t,n,i){t.$watch(i.ngHide,function(t){e[V(t)?"addClass":"removeClass"](n,"ng-hide")})}}],bo=Zt(function(e,t,n){e.$watch(n.ngStyle,function(e,n){n&&e!==n&&r(n,function(e,n){t.css(n,"")}),e&&t.css(e)},!0)}),yo=["$animate",function(e){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(t,n,i,o){var s=i.ngSwitch||i.on,a=[],l=[],c=[],u=[];t.$watch(s,function(n){var s,d;for(s=0,d=c.length;d>s;++s)c[s].remove();for(c.length=0,s=0,d=u.length;d>s;++s){var h=l[s];u[s].$destroy(),c[s]=h,e.leave(h,function(){c.splice(s,1)})}l.length=0,u.length=0,(a=o.cases["!"+n]||o.cases["?"])&&(t.$eval(i.change),r(a,function(n){var i=t.$new();u.push(i),n.transclude(i,function(t){var i=n.element;l.push(t),e.enter(t,i.parent(),i)})}))})}}}],wo=Zt({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,n,i,o){i.cases["!"+n.ngSwitchWhen]=i.cases["!"+n.ngSwitchWhen]||[],i.cases["!"+n.ngSwitchWhen].push({transclude:o,element:t})}}),Co=Zt({transclude:"element",priority:800,require:"^ngSwitch",link:function(e,t,n,i,o){i.cases["?"]=i.cases["?"]||[],i.cases["?"].push({transclude:o,element:t})}}),_o=Zt({link:function(e,t,n,o,r){if(!r)throw i("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",z(t));r(function(e){t.empty(),t.append(e)})}}),xo=["$templateCache",function(e){return{restrict:"E",terminal:!0,compile:function(t,n){if("text/ng-template"==n.type){var i=n.id,o=t[0].text;e.put(i,o)}}}}],So=i("ngOptions"),ko=m({terminal:!0}),To=["$compile","$parse",function(e,i){var o=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,a={$setViewValue:f};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(e,t,n){var i,o,r=this,s={},l=a;r.databound=n.ngModel,r.init=function(e,t,n){l=e,i=t,o=n},r.addOption=function(t){ie(t,'"option value"'),s[t]=!0,l.$viewValue==t&&(e.val(t),o.parent()&&o.remove())},r.removeOption=function(e){this.hasOption(e)&&(delete s[e],l.$viewValue==e&&this.renderUnknownOption(e))},r.renderUnknownOption=function(t){var n="? "+Ie(t)+" ?";o.val(n),e.prepend(o),e.val(n),o.prop("selected",!0)},r.hasOption=function(e){return s.hasOwnProperty(e)},t.$on("$destroy",function(){r.renderUnknownOption=f})}],link:function(a,l,c,u){function d(e,t,n,i){n.$render=function(){var e=n.$viewValue;i.hasOption(e)?(S.parent()&&S.remove(),t.val(e),""===e&&f.prop("selected",!0)):v(e)&&f?t.val(""):i.renderUnknownOption(e)},t.on("change",function(){e.$apply(function(){S.parent()&&S.remove(),n.$setViewValue(t.val())})})}function h(e,t,n){var i;n.$render=function(){var e=new Me(n.$viewValue);r(t.find("option"),function(t){t.selected=b(e.get(t.value))})},e.$watch(function(){L(i,n.$viewValue)||(i=N(n.$viewValue),n.$render())}),t.on("change",function(){e.$apply(function(){var e=[];r(t.find("option"),function(t){t.selected&&e.push(t.value)}),n.$setViewValue(e)})})}function p(t,r,a){function l(){var e=!1;if(y){var n=a.$modelValue;if(S&&Dn(n)){e=new Me([]);for(var i={},o=0;o<n.length;o++)i[h]=n[o],e.put(S(t,i),n[o])}else e=new Me(n)}return e}function c(){var e,n,i,o,c,u,v,w,T,$,E,D,I,M,A,O={"":[]},R=[""],P=a.$modelValue,N=m(t)||[],L=p?s(N):N,F={},U=l();for(E=0;T=L.length,T>E;E++){if(v=E,p){if(v=L[E],"$"===v.charAt(0))continue;F[p]=v}if(F[h]=N[v],e=f(t,F)||"",(n=O[e])||(n=O[e]=[],R.push(e)),y)D=b(U.remove(S?S(t,F):g(t,F)));else{if(S){var j={};j[h]=P,D=S(t,j)===S(t,F)}else D=P===g(t,F);U=U||D}A=d(t,F),A=b(A)?A:"",n.push({id:S?S(t,F):p?L[E]:E,label:A,selected:D})}for(y||(C||null===P?O[""].unshift({id:"",label:"",selected:!U}):U||O[""].unshift({id:"?",label:"",selected:!0})),$=0,w=R.length;w>$;$++){for(e=R[$],n=O[e],k.length<=$?(o={element:x.clone().attr("label",e),label:n.label},c=[o],k.push(c),r.append(o.element)):(c=k[$],o=c[0],o.label!=e&&o.element.attr("label",o.label=e)),I=null,E=0,T=n.length;T>E;E++)i=n[E],(u=c[E+1])?(I=u.element,u.label!==i.label&&I.text(u.label=i.label),u.id!==i.id&&I.val(u.id=i.id),I[0].selected!==i.selected&&(I.prop("selected",u.selected=i.selected),bn&&I.prop("selected",u.selected))):(""===i.id&&C?M=C:(M=_.clone()).val(i.id).prop("selected",i.selected).attr("selected",i.selected).text(i.label),c.push(u={element:M,label:i.label,id:i.id,selected:i.selected}),I?I.after(M):o.element.append(M),I=M);for(E++;c.length>E;)c.pop().element.remove()}for(;k.length>$;)k.pop()[0].element.remove()}var u;if(!(u=w.match(o)))throw So("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",w,z(r));var d=i(u[2]||u[1]),h=u[4]||u[6],p=u[5],f=i(u[3]||""),g=i(u[2]?u[1]:h),m=i(u[7]),v=u[8],S=v?i(u[8]):null,k=[[{element:r,label:""}]];C&&(e(C)(t),C.removeClass("ng-scope"),C.remove()),r.empty(),r.on("change",function(){t.$apply(function(){var e,i,o,s,l,u,d,f,v,b=m(t)||[],w={};if(y){for(o=[],u=0,f=k.length;f>u;u++)for(e=k[u],l=1,d=e.length;d>l;l++)if((s=e[l].element)[0].selected){if(i=s.val(),p&&(w[p]=i),S)for(v=0;v<b.length&&(w[h]=b[v],S(t,w)!=i);v++);else w[h]=b[i];o.push(g(t,w))}}else if(i=r.val(),"?"==i)o=n;else if(""===i)o=null;else if(S){
for(v=0;v<b.length;v++)if(w[h]=b[v],S(t,w)==i){o=g(t,w);break}}else w[h]=b[i],p&&(w[p]=i),o=g(t,w);a.$setViewValue(o),c()})}),a.$render=c,t.$watchCollection(m,c),t.$watchCollection(function(){var e={},n=m(t);if(n){for(var i=new Array(n.length),o=0,r=n.length;r>o;o++)e[h]=n[o],i[o]=d(t,e);return i}},c),y&&t.$watchCollection(function(){return a.$modelValue},c)}if(u[1]){for(var f,g=u[0],m=u[1],y=c.multiple,w=c.ngOptions,C=!1,_=yn(t.createElement("option")),x=yn(t.createElement("optgroup")),S=_.clone(),k=0,T=l.children(),$=T.length;$>k;k++)if(""===T[k].value){f=C=T.eq(k);break}g.init(m,C,S),y&&(m.$isEmpty=function(e){return!e||0===e.length}),w?p(a,l,m):y?h(a,l,m):d(a,l,m,g)}}}}],$o=["$interpolate",function(e){var t={addOption:f,removeOption:f};return{restrict:"E",priority:100,compile:function(n,i){if(v(i.value)){var o=e(n.text(),!0);o||i.$set("value",n.text())}return function(e,n,i){var r="$selectController",s=n.parent(),a=s.data(r)||s.parent().data(r);a&&a.databound?n.prop("selected",!1):a=t,o?e.$watch(o,function(e,t){i.$set("value",e),e!==t&&a.removeOption(t),a.addOption(e)}):a.addOption(i.value),n.on("$destroy",function(){a.removeOption(i.value)})}}}}],Eo=m({restrict:"E",terminal:!0});return e.angular.bootstrap?void console.log("WARNING: Tried to load angular more than once."):(ee(),ae($n),void yn(t).ready(function(){X(t,J)}))}(window,document),!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>'),function(){"use strict";var e=angular.module("pasvaz.bindonce",[]);e.directive("bindonce",function(){var e=function(e){if(e&&0!==e.length){var t=angular.lowercase(""+e);e=!("f"===t||"0"===t||"false"===t||"no"===t||"n"===t||"[]"===t)}else e=!1;return e},t=parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10);isNaN(t)&&(t=parseInt((/trident\/.*; rv:(\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10));var n={restrict:"AM",controller:["$scope","$element","$attrs","$interpolate",function(n,i,o,r){var s=function(t,n,i){var o="show"===n?"":"none",r="hide"===n?"":"none";t.css("display",e(i)?o:r)},a=function(e,t){if(angular.isObject(t)&&!angular.isArray(t)){var n=[];angular.forEach(t,function(e,t){e&&n.push(t)}),t=n}t&&e.addClass(angular.isArray(t)?t.join(" "):t)},l=function(e,t){e.transclude(t,function(t){var n=e.element.parent(),i=e.element&&e.element[e.element.length-1],o=n&&n[0]||i&&i.parentNode,r=i&&i.nextSibling||null;angular.forEach(t,function(e){o.insertBefore(e,r)})})},c={watcherRemover:void 0,binders:[],group:o.boName,element:i,ran:!1,addBinder:function(e){this.binders.push(e),this.ran&&this.runBinders()},setupWatcher:function(e){var t=this;this.watcherRemover=n.$watch(e,function(e){void 0!==e&&(t.removeWatcher(),t.checkBindonce(e))},!0)},checkBindonce:function(e){var t=this,n=e.$promise?e.$promise.then:e.then;"function"==typeof n?n(function(){t.runBinders()}):t.runBinders()},removeWatcher:function(){void 0!==this.watcherRemover&&(this.watcherRemover(),this.watcherRemover=void 0)},runBinders:function(){for(;this.binders.length>0;){var n=this.binders.shift();if(!this.group||this.group==n.group){var i=n.scope.$eval(n.interpolate?r(n.value):n.value);switch(n.attr){case"boIf":e(i)&&l(n,n.scope.$new());break;case"boSwitch":var o,c=n.controller[0];(o=c.cases["!"+i]||c.cases["?"])&&(n.scope.$eval(n.attrs.change),angular.forEach(o,function(e){l(e,n.scope.$new())}));break;case"boSwitchWhen":var u=n.controller[0];u.cases["!"+n.attrs.boSwitchWhen]=u.cases["!"+n.attrs.boSwitchWhen]||[],u.cases["!"+n.attrs.boSwitchWhen].push({transclude:n.transclude,element:n.element});break;case"boSwitchDefault":var u=n.controller[0];u.cases["?"]=u.cases["?"]||[],u.cases["?"].push({transclude:n.transclude,element:n.element});break;case"hide":case"show":s(n.element,n.attr,i);break;case"class":a(n.element,i);break;case"text":n.element.text(i);break;case"html":n.element.html(i);break;case"style":n.element.css(i);break;case"disabled":n.element.prop("disabled",i);break;case"src":n.element.attr(n.attr,i),t&&n.element.prop("src",i);break;case"attr":angular.forEach(n.attrs,function(e,t){var i,o;t.match(/^boAttr./)&&n.attrs[t]&&(i=t.replace(/^boAttr/,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=n.scope.$eval(n.attrs[t]),n.element.attr(i,o))});break;case"href":case"alt":case"title":case"id":case"value":n.element.attr(n.attr,i)}}}this.ran=!0}};angular.extend(this,c)}],link:function(e,t,n,i){var o=n.bindonce&&e.$eval(n.bindonce);void 0!==o?i.checkBindonce(o):(i.setupWatcher(n.bindonce),t.bind("$destroy",i.removeWatcher))}};return n}),angular.forEach([{directiveName:"boShow",attribute:"show"},{directiveName:"boHide",attribute:"hide"},{directiveName:"boClass",attribute:"class"},{directiveName:"boText",attribute:"text"},{directiveName:"boBind",attribute:"text"},{directiveName:"boHtml",attribute:"html"},{directiveName:"boSrcI",attribute:"src",interpolate:!0},{directiveName:"boSrc",attribute:"src"},{directiveName:"boHrefI",attribute:"href",interpolate:!0},{directiveName:"boHref",attribute:"href"},{directiveName:"boAlt",attribute:"alt"},{directiveName:"boTitle",attribute:"title"},{directiveName:"boId",attribute:"id"},{directiveName:"boStyle",attribute:"style"},{directiveName:"boDisabled",attribute:"disabled"},{directiveName:"boValue",attribute:"value"},{directiveName:"boAttr",attribute:"attr"},{directiveName:"boIf",transclude:"element",terminal:!0,priority:1e3},{directiveName:"boSwitch",require:"boSwitch",controller:function(){this.cases={}}},{directiveName:"boSwitchWhen",transclude:"element",priority:800,require:"^boSwitch"},{directiveName:"boSwitchDefault",transclude:"element",priority:800,require:"^boSwitch"}],function(t){var n=200;return e.directive(t.directiveName,function(){var e={priority:t.priority||n,transclude:t.transclude||!1,terminal:t.terminal||!1,require:["^bindonce"].concat(t.require||[]),controller:t.controller,compile:function(e,n,i){return function(e,n,o,r){var s=r[0],a=o.boParent;if(a&&s.group!==a){var l=s.element.parent();s=void 0;for(var c;9!==l[0].nodeType&&l.length;){if((c=l.data("$bindonceController"))&&c.group===a){s=c;break}l=l.parent()}if(!s)throw new Error("No bindonce controller: "+a)}s.addBinder({element:n,attr:t.attribute||t.directiveName,attrs:o,value:o[t.directiveName],interpolate:t.interpolate,group:a,transclude:i,controller:r.slice(1),scope:e})}}};return e})})}(),function(e){function t(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function n(e,t){function n(){le.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}var i=!0;return l(function(){return i&&(n(),i=!1),t.apply(this,arguments)},t)}function i(e,t){return function(n){return d(e.call(this,n),t)}}function o(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}function r(){}function s(e){S(e),l(this,e)}function a(e){var t=v(e),n=t.year||0,i=t.quarter||0,o=t.month||0,r=t.week||0,s=t.day||0,a=t.hour||0,l=t.minute||0,c=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*c+6e4*l+36e5*a,this._days=+s+7*r,this._months=+o+3*i+12*n,this._data={},this._bubble()}function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function c(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&_e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function u(e){return 0>e?Math.ceil(e):Math.floor(e)}function d(e,t,n){for(var i=""+Math.abs(e),o=e>=0;i.length<t;)i="0"+i;return(o?n?"+":"":"-")+i}function h(e,t,n,i){var o=t._milliseconds,r=t._days,s=t._months;i=null==i?!0:i,o&&e._d.setTime(+e._d+o*n),r&&ie(e,"Date",ne(e,"Date")+r*n),s&&te(e,ne(e,"Month")+s*n),i&&le.updateOffset(e,r||s)}function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function f(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function g(e,t,n){var i,o=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),s=0;for(i=0;o>i;i++)(n&&e[i]!==t[i]||!n&&y(e[i])!==y(t[i]))&&s++;return s+r}function m(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=Xe[e]||Je[t]||t}return e}function v(e){var t,n,i={};for(n in e)e.hasOwnProperty(n)&&(t=m(n),t&&(i[t]=e[n]));return i}function b(t){var n,i;if(0===t.indexOf("week"))n=7,i="day";else{if(0!==t.indexOf("month"))return;n=12,i="month"}le[t]=function(o,r){var s,a,l=le.fn._lang[t],c=[];if("number"==typeof o&&(r=o,o=e),a=function(e){var t=le().utc().set(i,e);return l.call(le.fn._lang,t,o||"")},null!=r)return a(r);for(s=0;n>s;s++)c.push(a(s));return c}}function y(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function w(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function C(e,t,n){return J(le([e,11,31+t-n]),t,n).week}function _(e){return x(e)?366:365}function x(e){return e%4===0&&e%100!==0||e%400===0}function S(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[ge]<0||e._a[ge]>11?ge:e._a[me]<1||e._a[me]>w(e._a[fe],e._a[ge])?me:e._a[ve]<0||e._a[ve]>23?ve:e._a[be]<0||e._a[be]>59?be:e._a[ye]<0||e._a[ye]>59?ye:e._a[we]<0||e._a[we]>999?we:-1,e._pf._overflowDayOfYear&&(fe>t||t>me)&&(t=me),e._pf.overflow=t)}function k(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function T(e){return e?e.toLowerCase().replace("_","-"):e}function $(e,t){return t._isUTC?le(e).zone(t._offset||0):le(e).local()}function E(e,t){return t.abbr=e,Ce[e]||(Ce[e]=new r),Ce[e].set(t),Ce[e]}function D(e){delete Ce[e]}function I(e){var t,n,i,o,r=0,s=function(e){if(!Ce[e]&&xe)try{require("./lang/"+e)}catch(t){}return Ce[e]};if(!e)return le.fn._lang;if(!p(e)){if(n=s(e))return n;e=[e]}for(;r<e.length;){for(o=T(e[r]).split("-"),t=o.length,i=T(e[r+1]),i=i?i.split("-"):null;t>0;){if(n=s(o.slice(0,t).join("-")))return n;if(i&&i.length>=t&&g(o,i,!0)>=t-1)break;t--}r++}return le.fn._lang}function M(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function A(e){var t,n,i=e.match($e);for(t=0,n=i.length;n>t;t++)i[t]=nt[i[t]]?nt[i[t]]:M(i[t]);return function(o){var r="";for(t=0;n>t;t++)r+=i[t]instanceof Function?i[t].call(o,e):i[t];return r}}function O(e,t){return e.isValid()?(t=R(t,e.lang()),Ze[t]||(Ze[t]=A(t)),Ze[t](e)):e.lang().invalidDate()}function R(e,t){function n(e){return t.longDateFormat(e)||e}var i=5;for(Ee.lastIndex=0;i>=0&&Ee.test(e);)e=e.replace(Ee,n),Ee.lastIndex=0,i-=1;return e}function P(e,t){var n,i=t._strict;switch(e){case"Q":return Ue;case"DDDD":return He;case"YYYY":case"GGGG":case"gggg":return i?We:Me;case"Y":case"G":case"g":return Ve;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?Be:Ae;case"S":if(i)return Ue;case"SS":if(i)return je;case"SSS":if(i)return He;case"DDD":return Ie;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Re;case"a":case"A":return I(t._l)._meridiemParse;case"X":return Le;case"Z":case"ZZ":return Pe;case"T":return Ne;case"SSSS":return Oe;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?je:De;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return De;case"Do":return Fe;default:return n=new RegExp(B(W(e.replace("\\","")),"i"))}}function N(e){e=e||"";var t=e.match(Pe)||[],n=t[t.length-1]||[],i=(n+"").match(Ke)||["-",0,0],o=+(60*i[1])+y(i[2]);return"+"===i[0]?-o:o}function L(e,t,n){var i,o=n._a;switch(e){case"Q":null!=t&&(o[ge]=3*(y(t)-1));break;case"M":case"MM":null!=t&&(o[ge]=y(t)-1);break;case"MMM":case"MMMM":i=I(n._l).monthsParse(t),null!=i?o[ge]=i:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[me]=y(t));break;case"Do":null!=t&&(o[me]=y(parseInt(t,10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=y(t));break;case"YY":o[fe]=le.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":o[fe]=y(t);break;case"a":case"A":n._isPm=I(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":o[ve]=y(t);break;case"m":case"mm":o[be]=y(t);break;case"s":case"ss":o[ye]=y(t);break;case"S":case"SS":case"SSS":case"SSSS":o[we]=y(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=N(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=t)}}function F(e){var t,n,i,o,r,s,a,l,c,u,d=[];if(!e._d){for(i=j(e),e._w&&null==e._a[me]&&null==e._a[ge]&&(r=function(t){var n=parseInt(t,10);return t?t.length<3?n>68?1900+n:2e3+n:n:null==e._a[fe]?le().weekYear():e._a[fe]},s=e._w,null!=s.GG||null!=s.W||null!=s.E?a=Z(r(s.GG),s.W||1,s.E,4,1):(l=I(e._l),c=null!=s.d?K(s.d,l):null!=s.e?parseInt(s.e,10)+l._week.dow:0,u=parseInt(s.w,10)||1,null!=s.d&&c<l._week.dow&&u++,a=Z(r(s.gg),u,c,l._week.doy,l._week.dow)),e._a[fe]=a.year,e._dayOfYear=a.dayOfYear),e._dayOfYear&&(o=null==e._a[fe]?i[fe]:e._a[fe],e._dayOfYear>_(o)&&(e._pf._overflowDayOfYear=!0),n=G(o,0,e._dayOfYear),e._a[ge]=n.getUTCMonth(),e._a[me]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=d[t]=i[t];for(;7>t;t++)e._a[t]=d[t]=null==e._a[t]?2===t?1:0:e._a[t];d[ve]+=y((e._tzm||0)/60),d[be]+=y((e._tzm||0)%60),e._d=(e._useUTC?G:Y).apply(null,d)}}function U(e){var t;e._d||(t=v(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],F(e))}function j(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function H(e){e._a=[],e._pf.empty=!0;var t,n,i,o,r,s=I(e._l),a=""+e._i,l=a.length,c=0;for(i=R(e._f,s).match($e)||[],t=0;t<i.length;t++)o=i[t],n=(a.match(P(o,e))||[])[0],n&&(r=a.substr(0,a.indexOf(n)),r.length>0&&e._pf.unusedInput.push(r),a=a.slice(a.indexOf(n)+n.length),c+=n.length),nt[o]?(n?e._pf.empty=!1:e._pf.unusedTokens.push(o),L(o,n,e)):e._strict&&!n&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=l-c,a.length>0&&e._pf.unusedInput.push(a),e._isPm&&e._a[ve]<12&&(e._a[ve]+=12),e._isPm===!1&&12===e._a[ve]&&(e._a[ve]=0),F(e),S(e)}function W(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,o){return t||n||i||o})}function B(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function V(e){var n,i,o,r,s;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(0/0));for(r=0;r<e._f.length;r++)s=0,n=l({},e),n._pf=t(),n._f=e._f[r],H(n),k(n)&&(s+=n._pf.charsLeftOver,s+=10*n._pf.unusedTokens.length,n._pf.score=s,(null==o||o>s)&&(o=s,i=n));l(e,i||n)}function z(e){var t,n,i=e._i,o=ze.exec(i);if(o){for(e._pf.iso=!0,t=0,n=Ye.length;n>t;t++)if(Ye[t][1].exec(i)){e._f=Ye[t][0]+(o[6]||" ");break}for(t=0,n=Ge.length;n>t;t++)if(Ge[t][1].exec(i)){e._f+=Ge[t][0];break}i.match(Pe)&&(e._f+="Z"),H(e)}else le.createFromInputFallback(e)}function q(t){var n=t._i,i=Se.exec(n);n===e?t._d=new Date:i?t._d=new Date(+i[1]):"string"==typeof n?z(t):p(n)?(t._a=n.slice(0),F(t)):f(n)?t._d=new Date(+n):"object"==typeof n?U(t):"number"==typeof n?t._d=new Date(n):le.createFromInputFallback(t)}function Y(e,t,n,i,o,r,s){var a=new Date(e,t,n,i,o,r,s);return 1970>e&&a.setFullYear(e),a}function G(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function K(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function Q(e,t,n,i,o){return o.relativeTime(t||1,!!n,e,i)}function X(e,t,n){var i=pe(Math.abs(e)/1e3),o=pe(i/60),r=pe(o/60),s=pe(r/24),a=pe(s/365),l=45>i&&["s",i]||1===o&&["m"]||45>o&&["mm",o]||1===r&&["h"]||22>r&&["hh",r]||1===s&&["d"]||25>=s&&["dd",s]||45>=s&&["M"]||345>s&&["MM",pe(s/30)]||1===a&&["y"]||["yy",a];return l[2]=t,l[3]=e>0,l[4]=n,Q.apply({},l)}function J(e,t,n){var i,o=n-t,r=n-e.day();return r>o&&(r-=7),o-7>r&&(r+=7),i=le(e).add("d",r),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function Z(e,t,n,i,o){var r,s,a=G(e,0,1).getUTCDay();return n=null!=n?n:o,r=o-a+(a>i?7:0)-(o>a?7:0),s=7*(t-1)+(n-o)+r+1,{year:s>0?e:e-1,dayOfYear:s>0?s:_(e-1)+s}}function ee(t){var n=t._i,i=t._f;return null===n||i===e&&""===n?le.invalid({nullInput:!0}):("string"==typeof n&&(t._i=n=I().preparse(n)),le.isMoment(n)?(t=c(n),t._d=new Date(+n._d)):i?p(i)?V(t):H(t):q(t),new s(t))}function te(e,t){var n;return"string"==typeof t&&(t=e.lang().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),w(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function ne(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function ie(e,t,n){return"Month"===t?te(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function oe(e,t){return function(n){return null!=n?(ie(this,e,n),le.updateOffset(this,t),this):ne(this,e)}}function re(e){le.duration.fn[e]=function(){return this._data[e]}}function se(e,t){le.duration.fn["as"+e]=function(){return+this/t}}function ae(e){"undefined"==typeof ender&&(ce=he.moment,he.moment=e?n("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",le):le)}for(var le,ce,ue,de="2.6.0",he="undefined"!=typeof global?global:this,pe=Math.round,fe=0,ge=1,me=2,ve=3,be=4,ye=5,we=6,Ce={},_e={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},xe="undefined"!=typeof module&&module.exports,Se=/^\/?Date\((\-?\d+)/i,ke=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Te=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,$e=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Ee=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,De=/\d\d?/,Ie=/\d{1,3}/,Me=/\d{1,4}/,Ae=/[+\-]?\d{1,6}/,Oe=/\d+/,Re=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Pe=/Z|[\+\-]\d\d:?\d\d/gi,Ne=/T/i,Le=/[\+\-]?\d+(\.\d{1,3})?/,Fe=/\d{1,2}/,Ue=/\d/,je=/\d\d/,He=/\d{3}/,We=/\d{4}/,Be=/[+-]?\d{6}/,Ve=/[+-]?\d+/,ze=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qe="YYYY-MM-DDTHH:mm:ssZ",Ye=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Ge=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Ke=/([\+\-]|\d\d)/gi,Qe=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),Xe={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Je={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Ze={},et="DDD w W M D d".split(" "),tt="M D H h m s w W".split(" "),nt={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return d(this.year()%100,2)},YYYY:function(){return d(this.year(),4)},YYYYY:function(){return d(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+d(Math.abs(e),6)},gg:function(){return d(this.weekYear()%100,2)},gggg:function(){return d(this.weekYear(),4)},ggggg:function(){return d(this.weekYear(),5)},GG:function(){return d(this.isoWeekYear()%100,2)},GGGG:function(){return d(this.isoWeekYear(),4)},GGGGG:function(){return d(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return y(this.milliseconds()/100)},SS:function(){return d(y(this.milliseconds()/10),2)},SSS:function(){return d(this.milliseconds(),3)},SSSS:function(){return d(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+d(y(e/60),2)+":"+d(y(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+d(y(e/60),2)+d(y(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},it=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];et.length;)ue=et.pop(),nt[ue+"o"]=o(nt[ue],ue);for(;tt.length;)ue=tt.pop(),nt[ue+ue]=i(nt[ue],2);for(nt.DDDD=i(nt.DDD,3),l(r.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,i;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(n=le.utc([2e3,t]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(i.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=le([2e3,1]).day(t),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var o=this._relativeTime[n];return"function"==typeof o?o(e,t,n,i):o.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return J(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),le=function(n,i,o,r){var s;return"boolean"==typeof o&&(r=o,o=e),s={},s._isAMomentObject=!0,s._i=n,s._f=i,s._l=o,s._strict=r,s._isUTC=!1,s._pf=t(),ee(s)},le.suppressDeprecationWarnings=!1,le.createFromInputFallback=n("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i)}),le.utc=function(n,i,o,r){var s;return"boolean"==typeof o&&(r=o,o=e),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=o,s._i=n,s._f=i,s._strict=r,s._pf=t(),ee(s).utc()},le.unix=function(e){return le(1e3*e)},le.duration=function(e,t){var n,i,o,r=e,s=null;return le.isDuration(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(r={},t?r[t]=e:r.milliseconds=e):(s=ke.exec(e))?(n="-"===s[1]?-1:1,r={y:0,d:y(s[me])*n,h:y(s[ve])*n,m:y(s[be])*n,s:y(s[ye])*n,ms:y(s[we])*n}):(s=Te.exec(e))&&(n="-"===s[1]?-1:1,o=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n},r={y:o(s[2]),M:o(s[3]),d:o(s[4]),h:o(s[5]),m:o(s[6]),s:o(s[7]),w:o(s[8])}),i=new a(r),le.isDuration(e)&&e.hasOwnProperty("_lang")&&(i._lang=e._lang),i},le.version=de,le.defaultFormat=qe,le.momentProperties=_e,le.updateOffset=function(){},le.lang=function(e,t){var n;return e?(t?E(T(e),t):null===t?(D(e),e="en"):Ce[e]||I(e),n=le.duration.fn._lang=le.fn._lang=I(e),n._abbr):le.fn._lang._abbr},le.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),I(e)},le.isMoment=function(e){return e instanceof s||null!=e&&e.hasOwnProperty("_isAMomentObject")},le.isDuration=function(e){return e instanceof a},ue=it.length-1;ue>=0;--ue)b(it[ue]);le.normalizeUnits=function(e){return m(e)},le.invalid=function(e){var t=le.utc(0/0);return null!=e?l(t._pf,e):t._pf.userInvalidated=!0,t},le.parseZone=function(){return le.apply(null,arguments).parseZone()},le.parseTwoDigitYear=function(e){return y(e)+(y(e)>68?1900:2e3)},l(le.fn=s.prototype,{clone:function(){return le(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=le(this).utc();return 0<e.year()&&e.year()<=9999?O(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):O(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return k(this)},isDSTShifted:function(){return this._a?this.isValid()&&g(this._a,(this._isUTC?le.utc(this._a):le(this._a)).toArray())>0:!1},parsingFlags:function(){return l({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=O(this,e||le.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var n;return n="string"==typeof e?le.duration(+t,e):le.duration(e,t),h(this,n,1),this},subtract:function(e,t){var n;return n="string"==typeof e?le.duration(+t,e):le.duration(e,t),h(this,n,-1),this},diff:function(e,t,n){var i,o,r=$(e,this),s=6e4*(this.zone()-r.zone());return t=m(t),"year"===t||"month"===t?(i=432e5*(this.daysInMonth()+r.daysInMonth()),o=12*(this.year()-r.year())+(this.month()-r.month()),o+=(this-le(this).startOf("month")-(r-le(r).startOf("month")))/i,o-=6e4*(this.zone()-le(this).startOf("month").zone()-(r.zone()-le(r).startOf("month").zone()))/i,"year"===t&&(o/=12)):(i=this-r,o="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-s)/864e5:"week"===t?(i-s)/6048e5:i),n?o:u(o)},from:function(e,t){return le.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(le(),e)},calendar:function(){var e=$(le(),this).startOf("day"),t=this.diff(e,"days",!0),n=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){return x(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=K(e,this.lang()),this.add({d:e-t})):t},month:oe("Month",!0),startOf:function(e){switch(e=m(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(e){return e=m(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+le(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+le(e).startOf(t)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)===+$(e,this).startOf(t)},min:function(e){return e=le.apply(null,arguments),this>e?this:e},max:function(e){return e=le.apply(null,arguments),e>this?this:e},zone:function(e,t){var n=this._offset||0;return null==e?this._isUTC?n:this._d.getTimezoneOffset():("string"==typeof e&&(e=N(e)),Math.abs(e)<16&&(e=60*e),this._offset=e,this._isUTC=!0,n!==e&&(!t||this._changeInProgress?h(this,le.duration(n-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,le.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?le(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return w(this.year(),this.month())},dayOfYear:function(e){var t=pe((le(this).startOf("day")-le(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=J(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=J(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=J(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return C(this.year(),1,4)},weeksInYear:function(){var e=this._lang._week;return C(this.year(),e.dow,e.doy)},get:function(e){return e=m(e),this[e]()},set:function(e,t){return e=m(e),"function"==typeof this[e]&&this[e](t),this},lang:function(t){return t===e?this._lang:(this._lang=I(t),this)}}),le.fn.millisecond=le.fn.milliseconds=oe("Milliseconds",!1),le.fn.second=le.fn.seconds=oe("Seconds",!1),le.fn.minute=le.fn.minutes=oe("Minutes",!1),le.fn.hour=le.fn.hours=oe("Hours",!0),le.fn.date=oe("Date",!0),le.fn.dates=n("dates accessor is deprecated. Use date instead.",oe("Date",!0)),le.fn.year=oe("FullYear",!0),le.fn.years=n("years accessor is deprecated. Use year instead.",oe("FullYear",!0)),
le.fn.days=le.fn.day,le.fn.months=le.fn.month,le.fn.weeks=le.fn.week,le.fn.isoWeeks=le.fn.isoWeek,le.fn.quarters=le.fn.quarter,le.fn.toJSON=le.fn.toISOString,l(le.duration.fn=a.prototype,{_bubble:function(){var e,t,n,i,o=this._milliseconds,r=this._days,s=this._months,a=this._data;a.milliseconds=o%1e3,e=u(o/1e3),a.seconds=e%60,t=u(e/60),a.minutes=t%60,n=u(t/60),a.hours=n%24,r+=u(n/24),a.days=r%30,s+=u(r/30),a.months=s%12,i=u(s/12),a.years=i},weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*y(this._months/12)},humanize:function(e){var t=+this,n=X(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},add:function(e,t){var n=le.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=le.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=m(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=m(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:le.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),o=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||o||r?"T":"")+(i?i+"H":"")+(o?o+"M":"")+(r?r+"S":""):"P0D"}});for(ue in Qe)Qe.hasOwnProperty(ue)&&(se(ue,Qe[ue]),re(ue.toLowerCase()));se("Weeks",6048e5),le.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},le.lang("en",{ordinal:function(e){var t=e%10,n=1===y(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),xe?module.exports=le:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(he.moment=ce),le}),ae(!0)):ae()}.call(this),function(e,t){"object"==typeof exports?module.exports=t(require("moment")):"function"==typeof define&&define.amd?define(["moment"],t):e.moment=t(e.moment)}(this,function(e){var t,n;return n={year:!0,month:!0,week:!0,day:!0,hour:!0,minute:!0,second:!0},t=function(){function t(t,n){this.start=e(t),this.end=e(n)}return t.prototype.contains=function(e){return e instanceof t?this.start<=e.start&&this.end>=e.end:this.start<=e&&e<=this.end},t.prototype._by_string=function(t,n){var i,o;for(i=e(this.start),o=[];this.contains(i);)n.call(this,i.clone()),o.push(i.add(1,t));return o},t.prototype._by_range=function(t,n){var i,o,r,s;if(o=Math.floor(this/t),o===1/0)return this;for(s=[],i=r=0;o>=0?o>=r:r>=o;i=o>=0?++r:--r)s.push(n.call(this,e(this.start.valueOf()+t.valueOf()*i)));return s},t.prototype.overlaps=function(e){return null!==this.intersect(e)},t.prototype.intersect=function(e){var n,i,o,r,s,a,l,c;return this.start<=(i=e.start)&&i<(n=this.end)&&n<e.end?new t(e.start,this.end):e.start<(r=this.start)&&r<(o=e.end)&&o<=this.end?new t(this.start,e.end):e.start<(a=this.start)&&a<(s=this.end)&&s<e.end?this:this.start<=(c=e.start)&&c<(l=e.end)&&l<=this.end?e:null},t.prototype.subtract=function(e){var n,i,o,r,s,a,l,c;return null===this.intersect(e)?[this]:e.start<=(i=this.start)&&i<(n=this.end)&&n<=e.end?[]:e.start<=(r=this.start)&&r<(o=e.end)&&o<this.end?[new t(e.end,this.end)]:this.start<(a=e.start)&&a<(s=this.end)&&s<=e.end?[new t(this.start,e.start)]:this.start<(c=e.start)&&c<(l=e.end)&&l<this.end?[new t(this.start,e.start),new t(e.end,this.end)]:void 0},t.prototype.by=function(e,t){return"string"==typeof e?this._by_string(e,t):this._by_range(e,t),this},t.prototype.valueOf=function(){return this.end-this.start},t.prototype.toDate=function(){return[this.start.toDate(),this.end.toDate()]},t.prototype.isSame=function(e){return this.start.isSame(e.start)&&this.end.isSame(e.end)},t.prototype.diff=function(e){return null==e&&(e=void 0),this.end.diff(this.start,e)},t}(),e.fn.range=function(i,o){return i in n?new t(e(this).startOf(i),e(this).endOf(i)):new t(i,o)},e.range=function(e,n){return new t(e,n)},e.fn.within=function(e){return e.contains(this._d)},e}),function(){angular.module("dateRangePicker",["pasvaz.bindonce"]),angular.module("dateRangePicker").directive("dateRangePicker",["$compile","$timeout",function(e,t){var n,i;return i='<div ng-show="visible" class="angular-date-range-picker__picker" ng-click="handlePickerClick($event)" ng-class="{\'angular-date-range-picker--ranged\': showRanged }">\n  <div class="angular-date-range-picker__timesheet">\n    <a ng-click="move(-1, $event)" class="angular-date-range-picker__prev-month">&#9664;</a>\n    <div bindonce ng-repeat="month in months" class="angular-date-range-picker__month">\n      <div class="angular-date-range-picker__month-name" bo-text="month.name"></div>\n      <table class="angular-date-range-picker__calendar">\n        <tr>\n          <th bindonce ng-repeat="day in month.weeks[1]" class="angular-date-range-picker__calendar-weekday" bo-text="day.date.format(\'dd\')">\n          </th>\n        </tr>\n        <tr bindonce ng-repeat="week in month.weeks">\n          <td\n              bo-class=\'{\n                "angular-date-range-picker__calendar-day": day,\n                "angular-date-range-picker__calendar-day-selected": day.selected,\n                "angular-date-range-picker__calendar-day-disabled": day.disabled,\n                "angular-date-range-picker__calendar-day-start": day.start\n              }\'\n              ng-repeat="day in week track by $index" ng-click="select(day, $event)">\n              <div class="angular-date-range-picker__calendar-day-wrapper" bo-text="day.date.date()"></div>\n          </td>\n        </tr>\n      </table>\n    </div>\n    <a ng-click="move(+1, $event)" class="angular-date-range-picker__next-month">&#9654;</a>\n  </div>\n  <div class="angular-date-range-picker__panel">\n    <div ng-show="showRanged">\n      Select range: <select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList"></select>\n    </div>\n    <div class="angular-date-range-picker__buttons">\n      <a ng-click="ok($event)" class="angular-date-range-picker__apply">Apply</a>\n      <a ng-click="hide($event)" class="angular-date-range-picker__cancel">cancel</a>\n    </div>\n  </div>\n</div>',n="CUSTOM",{restrict:"AE",replace:!0,template:'<span tabindex="0" ng-keydown="hide()" class="angular-date-range-picker__input">\n  <span ng-if="showRanged">\n    <span ng-show="!!model">{{ model.start.format("ll") }} - {{ model.end.format("ll") }}</span>\n    <span ng-hide="!!model">Select date range</span>\n  </span>\n  <span ng-if="!showRanged">\n    <span ng-show="!!model">{{ model.format("ll") }}</span>\n    <span ng-hide="!!model">Select date</span>\n  </span>\n</span>',scope:{model:"=ngModel",customSelectOptions:"=",ranged:"=",pastDates:"@",callback:"&"},link:function(o,r,s){var a,l,c,u,d,h;return o.quickListDefinitions=o.customSelectOptions,null==o.quickListDefinitions&&(o.quickListDefinitions=[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}]),o.quick=null,o.range=null,o.selecting=!1,o.visible=!1,o.start=null,o.showRanged=void 0===o.ranged?!0:o.ranged,d=function(e){var t,i,r,s,a;if(null==e&&(e=!1),o.showRanged){for(o.quickList=[],e&&o.quickList.push({label:"Custom",range:n}),s=o.quickListDefinitions,a=[],i=0,r=s.length;r>i;i++)t=s[i],a.push(o.quickList.push(t));return a}},c=function(){var e,t;return o.showRanged?o.range=o.selection?(t=o.selection.start.clone().startOf("month").startOf("day"),e=t.clone().add(2,"months").endOf("month").startOf("day"),moment().range(t,e)):moment().range(moment().startOf("month").subtract(1,"month").startOf("day"),moment().endOf("month").add(1,"month").startOf("day")):(o.selection=!1,o.selection=o.model||!1,o.date=moment(o.model)||moment(),o.range=moment().range(moment(o.date).startOf("month"),moment(o.date).endOf("month")))},u=function(){var e,t,i,r;if(o.showRanged&&o.selection){for(r=o.quickList,t=0,i=r.length;i>t;t++)if(e=r[t],e.range!==n&&o.selection.start.startOf("day").unix()===e.range.start.startOf("day").unix()&&o.selection.end.startOf("day").unix()===e.range.end.startOf("day").unix())return o.quick=e.range,void d();return o.quick=n,d(!0)}},h=function(){var e,t,n,i,r,s;for(o.months=[],n=12*o.range.start.year()+o.range.start.month(),t=moment().startOf("week").day(),o.range.by("days",function(e){var i,r,s,a,l,c,u;return i=e.day()-t,0>i&&(i=7+i),s=12*e.year()+e.month()-n,l=parseInt((7+e.date()-i)/7),a=!1,r=!1,o.showRanged?o.start?(a=e===o.start,r=e<o.start):a=o.selection&&o.selection.contains(e):(a=e.isSame(o.selection),o.pastDates&&(r=moment().diff(e,"days")>0)),(c=o.months)[s]||(c[s]={name:e.format("MMMM YYYY"),weeks:[]}),(u=o.months[s].weeks)[l]||(u[l]=[]),o.months[s].weeks[l][i]={date:e,selected:a,disabled:r,start:o.start&&o.start.unix()===e.unix()}}),s=o.months,i=0,r=s.length;r>i;i++)e=s[i],e.weeks[0]||e.weeks.splice(0,1);return u()},o.show=function(){return o.selection=o.model,c(),h(),o.visible=!0},o.hide=function(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.visible=!1,o.start=null},o.prevent_select=function(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0},o.ok=function(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.model=o.selection,t(function(){return o.callback?o.callback():void 0}),o.hide()},o.select=function(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),e.disabled?void 0:(o.showRanged?(o.selecting=!o.selecting,o.selecting?o.start=e.date:(o.selection=moment().range(o.start,e.date),o.start=null)):o.selection=moment(e.date),h())},o.move=function(e,t){return null!=t&&"function"==typeof t.stopPropagation&&t.stopPropagation(),o.showRanged?o.range=moment().range(o.range.start.add(e,"months").startOf("month").startOf("day"),o.range.start.clone().add(2,"months").endOf("month").startOf("day")):(o.date.add(e,"months"),o.range=moment().range(moment(o.date).startOf("month"),moment(o.date).endOf("month"))),h()},o.handlePickerClick=function(e){return null!=e&&"function"==typeof e.stopPropagation?e.stopPropagation():void 0},o.$watch("quick",function(e,t){return e&&e!==n?(o.selection=o.quick,o.selecting=!1,o.start=null,c(),h()):void 0}),o.$watch("customSelectOptions",function(e){return"undefined"!=typeof customSelectOptions&&null!==customSelectOptions?o.quickListDefinitions=e:void 0}),l=e(angular.element(i))(o),r.append(l),r.bind("click",function(e){return null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),o.$apply(function(){return o.visible?o.hide():o.show()})}),a=function(e){return o.$apply(function(){return o.hide()}),!0},angular.element(document).bind("click",a),o.$on("$destroy",function(){return angular.element(document).unbind("click",a)}),d(),c(),h()}}}])}.call(this);var ngMap=angular.module("ngMap",[]);ngMap.service("Attr2Options",["$parse","NavigatorGeolocation","GeoCoder",function($parse,NavigatorGeolocation,GeoCoder){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,orgAttributes=function(e){e.length>0&&(e=e[0]);for(var t={},n=0;n<e.attributes.length;n++){var i=e.attributes[n];t[i.name]=i.value}return t},camelCase=function(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,n,i){return i?n.toUpperCase():n}).replace(MOZ_HACK_REGEXP,"Moz$1")},JSONize=function(e){try{return JSON.parse(e),e}catch(t){return e.replace(/([\$\w]+)\s*:/g,function(e,t){return'"'+t+'":'}).replace(/'([^']+)'/g,function(e,t){return'"'+t+'"'})}},toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(input.match(/^[\+\-]?[0-9\.]+,[ ]*\ ?[\+\-]?[0-9\.]+$/)&&(input="["+input+"]"),output=JSON.parse(JSONize(input)),output instanceof Array){var t1stEl=output[0];if(t1stEl.constructor==Object);else if(t1stEl.constructor==Array)output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])});else if(!isNaN(parseFloat(t1stEl))&&isFinite(t1stEl))return new google.maps.LatLng(output[0],output[1])}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/))try{var matches=input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/);output=google.maps[matches[1]][matches[2]]}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitalizedKey=key.charAt(0).toUpperCase()+key.slice(1);key.match(/temperatureUnit|windSpeedUnit|labelColor/)?(capitalizedKey=capitalizedKey.replace(/s$/,""),output=google.maps.weather[capitalizedKey][input]):output=google.maps[capitalizedKey][input]}catch(e){output=input}else output=input}}return output},setDelayedGeoLocation=function(e,t,n,i){i=i||{};var o=e.centered||i.centered,r=function(){var n=i.fallbackLocation||new google.maps.LatLng(0,0);e[t](n)};!n||n.match(/^current/i)?NavigatorGeolocation.getCurrentPosition().then(function(n){var r=n.coords.latitude,s=n.coords.longitude,a=new google.maps.LatLng(r,s);e[t](a),o&&e.map.setCenter(a),i.callback&&i.callback.apply(e)},r):GeoCoder.geocode({address:n}).then(function(n){e[t](n[0].geometry.location),o&&e.map.setCenter(n[0].geometry.location)},r)},getAttrsToObserve=function(e){var t=[];if(e["ng-repeat"]||e.ngRepeat);else for(var n in e){var i=e[n];i&&i.match(/\{\{.*\}\}/)&&t.push(camelCase(n))}return t},observeAttrSetObj=function(e,t,n){var i=getAttrsToObserve(e);Object.keys(i).length;for(var o=0;o<i.length;o++)observeAndSet(t,i[o],n)},observeAndSet=function(e,t,n){e.$observe(t,function(e){if(e){var i=camelCase("set-"+t),o=toOptionValue(e,{key:t});n[i]&&(t.match(/center|position/)&&"string"==typeof o?setDelayedGeoLocation(n,i,o):n[i](o))}})};return{filter:function(e){var t={};for(var n in e)n.match(/^\$/)||n.match(/^ng[A-Z]/)||(t[n]=e[n]);return t},getOptions:function(e,t){var n={};for(var i in e)if(e[i]){if(i.match(/^on[A-Z]/))continue;if(i.match(/ControlOptions$/))continue;n[i]=toOptionValue(e[i],{scope:t,key:i})}return n},getEvents:function(e,t){var n={},i=function(e){return"_"+e.toLowerCase()},o=function(t){var n=t.match(/([^\(]+)\(([^\)]*)\)/),i=n[1],o=n[2].replace(/event[ ,]*/,""),r=e.$eval("["+o+"]");return function(t){function n(e,t){return e[t]}f=i.split(".").reduce(n,e),f.apply(this,[t].concat(r)),e.$apply()}};for(var r in t)if(t[r]){if(!r.match(/^on[A-Z]/))continue;var s=r.replace(/^on/,"");s=s.charAt(0).toLowerCase()+s.slice(1),s=s.replace(/([A-Z])/g,i);var a=t[r];n[s]=new o(a)}return n},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var n in e)if(e[n]){if(!n.match(/(.*)ControlOptions$/))continue;var i=e[n],o=i.replace(/'/g,'"');o=o.replace(/([^"]+)|("[^"]+")/g,function(e,t,n){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):n});try{var r=JSON.parse(o);for(var s in r)if(r[s]){var a=r[s];if("string"==typeof a?a=a.toUpperCase():"mapTypeIds"===s&&(a=a.map(function(e){return e.match(/^[A-Z]+$/)?google.maps.MapTypeId[e.toUpperCase()]:e})),"style"===s){var l=n.charAt(0).toUpperCase()+n.slice(1),c=l.replace(/Options$/,"")+"Style";r[s]=google.maps[c][a]}else r[s]="position"===s?google.maps.ControlPosition[a]:a}t[n]=r}catch(u){}}return t},toOptionValue:toOptionValue,camelCase:camelCase,setDelayedGeoLocation:setDelayedGeoLocation,getAttrsToObserve:getAttrsToObserve,observeAndSet:observeAndSet,observeAttrSetObj:observeAttrSetObj,orgAttributes:orgAttributes}}]),ngMap.service("GeoCoder",["$q",function(e){return{geocode:function(t){var n=e.defer(),i=new google.maps.Geocoder;return i.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?n.resolve(e):n.reject("Geocoder failed due to: "+t)}),n.promise}}}]),ngMap.service("NavigatorGeolocation",["$q",function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}}]),ngMap.service("StreetView",["$q",function(e){return{getPanorama:function(t,n){n=n||t.getCenter();var i=e.defer(),o=new google.maps.StreetViewService;return o.getPanoramaByLocation(n||t.getCenter,100,function(e,t){i.resolve(t===google.maps.StreetViewStatus.OK?e.location.pano:!1)}),i.promise},setPanorama:function(e,t){var n=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});n.setPano(t)}}}]),ngMap.directive("bicyclingLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.BicyclingLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("bicyclingLayers",u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("cloudLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.CloudLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("cloudLayers",u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("customControl",["Attr2Options","$compile",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,i,o,r){i.css("display","none");var s=(n.orgAttributes(i),n.filter(o)),a=n.getOptions(s,e),l=n.getEvents(e,s),c=t(i.html().trim())(e),u=c[0];for(var d in l)google.maps.event.addDomListener(u,d,l[d]);r.addObject("customControls",u),e.$on("mapInitialized",function(e,t){var n=a.position;t.controls[google.maps.ControlPosition[n]].push(u)})}}}]),ngMap.directive("dynamicMapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.DynamicMapsEngineLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.filter(o),a=t.getOptions(s),l=t.getEvents(e,s,l),c=n(a,l);r.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("fusionTablesLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.FusionTablesLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.filter(o),a=t.getOptions(s),l=t.getEvents(e,s,l),c=n(a,l);r.addObject("fusionTablesLayers",c)}}}]),ngMap.directive("heatmapLayer",["Attr2Options","$window",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=n.filter(o),a=n.getOptions(s);if(a.data=t[o.data]||e[o.data],!(a.data instanceof Array))throw"invalid heatmap data";a.data=new google.maps.MVCArray(a.data);var l=new google.maps.visualization.HeatmapLayer(a);n.getEvents(e,s),r.addObject("heatmapLayers",l)}}}]),ngMap.directive("infoWindow",["Attr2Options","$compile","$timeout",function(Attr2Options,$compile,$timeout){var parser=Attr2Options,getInfoWindow=function(options,events,element){var infoWindow;if(!options.position||options.position instanceof google.maps.LatLng)infoWindow=new google.maps.InfoWindow(options);else{var address=options.position;delete options.position,infoWindow=new google.maps.InfoWindow(options);var callback=function(){infoWindow.open(infoWindow.map)};parser.setDelayedGeoLocation(infoWindow,"setPosition",address,{callback:callback})}Object.keys(events).length>0;for(var eventName in events)eventName&&google.maps.event.addListener(infoWindow,eventName,events[eventName]);var template=element.html().trim();if(1!=angular.element(template).length)throw"info-window working as a template must have a container";return infoWindow.__template=template.replace(/\s?ng-non-bindable[='"]+/,""),infoWindow.__compile=function(e){var t=$compile(infoWindow.__template)(e);e.$apply(),infoWindow.setContent(t[0])},infoWindow.__eval=function(event){var template=infoWindow.__template,_this=this;return template=template.replace(/{{(event|this)[^;\}]+}}/g,function(match){var expression=match.replace(/[{}]/g,"").replace("this.","_this.");return eval(expression)})},infoWindow};return{restrict:"E",require:"^map",link:function(e,t,n,i){t.css("display","none");var o=parser.orgAttributes(t),r=parser.filter(n),s=parser.getOptions(r,e),a=parser.getEvents(e,r),l=getInfoWindow(s,a,t);i.addObject("infoWindows",l),parser.observeAttrSetObj(o,n,l),l.visible&&e.$on("mapInitialized",function(t,n){$timeout(function(){l.__template=l.__eval.apply(this,[t]),l.__compile(e),l.map=n,l.position&&l.open(n)})}),l.visibleOnMarker&&e.$on("mapInitialized",function(t,n){$timeout(function(){var i=l.visibleOnMarker,o=n.markers[i];if(!o)throw"Invalid marker id";l.__template=l.__eval.apply(this,[t]),l.__compile(e),l.open(n,o)})}),e.showInfoWindow=e.showInfoWindow||function(t,n,o){var r=i.map.infoWindows[n];r.__template=r.__eval.apply(this,[t]),r.__compile(e),o?r.open(i.map,o):this.getPosition?r.open(i.map,this):r.open(i.map)},e.hideInfoWindow=e.hideInfoWindow||function(t,n){var o=i.map.infoWindows[n];o.__template=o.__eval.apply(this,[t]),o.__compile(e),o.close()}}}}]),ngMap.directive("kmlLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.KmlLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("kmlLayers",u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("mapData",["Attr2Options",function(e){var t=e;return{restrict:"E",require:"^map",link:function(e,n,i){var o=t.filter(i),r=t.getOptions(o),s=t.getEvents(e,o,s);e.$on("mapInitialized",function(t,n){for(var i in r)if(i){var o=r[i];n.data[i]("function"==typeof e[o]?e[o]:o)}for(var a in s)s[a]&&n.data.addListener(a,s[a])})}}}]),ngMap.directive("mapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,i,o){var r,s=i.name;if(!s)throw"invalid map-type name";if(i.object){var a=e[i.object]?e:t;r=a[i.object],"function"==typeof r&&(r=new r)}if(!r)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){t.mapTypes.set(s,r)}),o.addObject("mapTypes",r)}}}]),ngMap.directive("map",["Attr2Options","$timeout",function(e,t){function n(e,t){if(e.currentStyle)var n=e.currentStyle[t];else if(window.getComputedStyle)var n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return n}var i=e;return{restrict:"AE",controller:ngMap.MapController,link:function(o,r,s,a){var l=i.orgAttributes(r);o.google=google;var c=document.createElement("div");c.style.width="100%",c.style.height="100%",r.prepend(c),"block"!=n(r[0],"display")&&r.css("display","block"),n(r[0],"height").match(/^(0|auto)/)&&r.css("height","300px");var u=function(n,r){var u=new google.maps.Map(c,{});u.markers={},u.shapes={},t(function(){google.maps.event.trigger(u,"resize")}),n.zoom=n.zoom||15;var d=n.center;d?d instanceof google.maps.LatLng||(delete n.center,e.setDelayedGeoLocation(u,"setCenter",d,{fallbackLocation:h.geoFallbackCenter})):n.center=new google.maps.LatLng(0,0),u.setOptions(n);for(var p in r)p&&google.maps.event.addListener(u,p,r[p]);i.observeAttrSetObj(l,s,u),a.map=u,a.addObjects(a._objects),o.map=u,o.map.scope=o,o.$emit("mapInitialized",u),o.maps=o.maps||{},o.maps[h.id||Object.keys(o.maps).length]=u,o.$emit("mapsInitialized",o.maps)},d=i.filter(s),h=i.getOptions(d,o),p=i.getControlOptions(d),f=angular.extend(h,p),g=i.getEvents(o,d);s.initEvent?o.$on(s.initEvent,function(){!a.map&&u(f,g)}):u(f,g)}}}]),ngMap.MapController=function(){this.map=null,this._objects=[],this.addMarker=function(e){if(this.map){this.map.markers=this.map.markers||{},e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e}else this._objects.push(e)},this.addShape=function(e){if(this.map){this.map.shapes=this.map.shapes||{},e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e}else this._objects.push(e)},this.addObject=function(e,t){if(this.map){this.map[e]=this.map[e]||{};var n=Object.keys(this.map[e]).length;this.map[e][t.id||n]=t,"infoWindows"!=e&&t.setMap&&t.setMap(this.map)}else t.groupName=e,this._objects.push(t)},this.addObjects=function(e){for(var t=0;t<e.length;t++){var n=e[t];n instanceof google.maps.Marker?this.addMarker(n):n instanceof google.maps.Circle||n instanceof google.maps.Polygon||n instanceof google.maps.Polyline||n instanceof google.maps.Rectangle||n instanceof google.maps.GroundOverlay?this.addShape(n):this.addObject(n.groupName,n)}}},ngMap.directive("mapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.MapsEngineLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.filter(o),a=t.getOptions(s),l=t.getEvents(e,s,l),c=n(a,l);r.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("marker",["Attr2Options",function(e){var t=e,n=function(e,n){var i;if(e.icon instanceof Object){(""+e.icon.path).match(/^[A-Z_]+$/)&&(e.icon.path=google.maps.SymbolPath[e.icon.path]);for(var o in e.icon){var r=e.icon[o];"anchor"==o||"origin"==o?e.icon[o]=new google.maps.Point(r[0],r[1]):("size"==o||"scaledSize"==o)&&(e.icon[o]=new google.maps.Size(r[0],r[1]))}}if(e.position instanceof google.maps.LatLng)i=new google.maps.Marker(e);else{var s=e.position;e.position=new google.maps.LatLng(0,0),i=new google.maps.Marker(e),t.setDelayedGeoLocation(i,"setPosition",s)}Object.keys(n).length>0;for(var a in n)a&&google.maps.event.addListener(i,a,n[a]);return i};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a,e),c=t.getEvents(e,a);i.bind("$destroy",function(){var e=u.map.markers;for(var t in e)e[t]==u&&delete e[t];u.setMap(null)});var u=n(l,c);r.addMarker(u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("overlayMapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,i,o){var r,s=i.initMethod||"insertAt";if(i.object){var a=e[i.object]?e:t;r=a[i.object],"function"==typeof r&&(r=new r)}if(!r)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){if("insertAt"==s){var n=parseInt(i.index,10);t.overlayMapTypes.insertAt(n,r)}else"push"==s&&t.overlayMapTypes.push(r)}),o.addObject("overlayMapTypes",r)}}}]),ngMap.directive("shape",["Attr2Options",function(e){var t=e,n=function(e){return new google.maps.LatLngBounds(e[0],e[1])},i=function(e,i){var o,r=e.name;if(delete e.name,e.icons)for(var s=0;s<e.icons.length;s++){var a=e.icons[s];a.icon.path.match(/^[A-Z_]+$/)&&(a.icon.path=google.maps.SymbolPath[a.icon.path])}switch(r){case"circle":if(e.center instanceof google.maps.LatLng)o=new google.maps.Circle(e);else{var l=e.center;e.center=new google.maps.LatLng(0,0),o=new google.maps.Circle(e),t.setDelayedGeoLocation(o,"setCenter",l)}break;case"polygon":o=new google.maps.Polygon(e);break;case"polyline":o=new google.maps.Polyline(e);break;case"rectangle":e.bounds&&(e.bounds=n(e.bounds)),o=new google.maps.Rectangle(e);break;case"groundOverlay":case"image":var c=e.url,u=n(e.bounds),d={opacity:e.opacity,clickable:e.clickable,id:e.id};o=new google.maps.GroundOverlay(c,u,d)}for(var h in i)i[h]&&google.maps.event.addListener(o,h,i[h]);return o};return{restrict:"E",require:"^map",link:function(e,n,o,r){var s=t.orgAttributes(n),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=i(l,c);r.addShape(u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("trafficLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TrafficLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("trafficLayers",u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("transitLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TransitLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("transitLayers",u),t.observeAttrSetObj(s,o,u)}}}]),ngMap.directive("weatherLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.WeatherLayer(e);for(var i in t)google.maps.event.addListener(n,i,t[i]);return n};return{restrict:"E",require:"^map",link:function(e,i,o,r){var s=t.orgAttributes(i),a=t.filter(o),l=t.getOptions(a),c=t.getEvents(e,a),u=n(l,c);r.addObject("weatherLayers",u),t.observeAttrSetObj(s,o,u)}}}]),function(e,t,n){var i=e();e.fn.dropdownHover=function(n){return"ontouchstart"in document?this:(i=i.add(this.parent()),this.each(function(){var o,r=e(this),s=r.parent(),a={delay:500,instantlyCloseOthers:!0},l={delay:e(this).data("delay"),instantlyCloseOthers:e(this).data("close-others")},c="show.bs.dropdown",u="hide.bs.dropdown",d=e.extend(!0,{},a,n,l);s.hover(function(e){return s.hasClass("open")||r.is(e.target)?(i.find(":focus").blur(),d.instantlyCloseOthers===!0&&i.removeClass("open"),t.clearTimeout(o),s.addClass("open"),void r.trigger(c)):!0},function(){o=t.setTimeout(function(){s.removeClass("open"),r.trigger(u)},d.delay)}),r.hover(function(){i.find(":focus").blur(),d.instantlyCloseOthers===!0&&i.removeClass("open"),t.clearTimeout(o),s.addClass("open"),r.trigger(c)}),s.find(".dropdown-submenu").each(function(){var n,i=e(this);i.hover(function(){t.clearTimeout(n),i.children(".dropdown-menu").show(),i.siblings().children(".dropdown-menu").hide()},function(){var e=i.children(".dropdown-menu");n=t.setTimeout(function(){e.hide()},d.delay)})})}))},e(document).ready(function(){e('[data-hover="dropdown"]').dropdownHover()})}(jQuery,this),function(e,t,n){"use strict";function i(e){var n=[];return l(n,t.noop).chars(e),n.join("")}function o(e){var t={};e=e.split(",");var n;for(n=0;n<e.length;n++)t[e[n]]=!0;return t}function r(e,n){function i(e,i,r,a){if(i=t.lowercase(i),_[i])for(;b.last()&&x[b.last()];)o("",b.last());C[i]&&b.last()==i&&o("",i),(a=w[i]||!!a)||b.push(i);var l={};r.replace(h,function(e,t,n,i,o){l[t]=s(n||i||o||"")}),n.start&&n.start(i,l,a)}function o(e,i){var o,r=0;if(i=t.lowercase(i))for(r=b.length-1;r>=0&&b[r]!=i;r--);if(r>=0){for(o=b.length-1;o>=r;o--)n.end&&n.end(b[o]);b.length=r}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var r,a,l,b=[],y=e;for(b.last=function(){return b[b.length-1]};e;){if(l="",a=!0,b.last()&&S[b.last()]?(e=e.replace(RegExp("(.*)<\\s*\\/\\s*"+b.last()+"[^>]*>","i"),function(e,t){return t=t.replace(g,"$1").replace(v,"$1"),n.chars&&n.chars(s(t)),""}),o("",b.last())):(0===e.indexOf("<!--")?(r=e.indexOf("--",4),r>=0&&e.lastIndexOf("-->",r)===r&&(n.comment&&n.comment(e.substring(4,r)),e=e.substring(r+3),a=!1)):m.test(e)?(r=e.match(m))&&(e=e.replace(r[0],""),a=!1):f.test(e)?(r=e.match(d))&&(e=e.substring(r[0].length),r[0].replace(d,o),a=!1):p.test(e)&&((r=e.match(u))?(r[4]&&(e=e.substring(r[0].length),r[0].replace(u,i)),a=!1):(l+="<",e=e.substring(1))),a&&(r=e.indexOf("<"),
l+=0>r?e:e.substring(0,r),e=0>r?"":e.substring(r),n.chars&&n.chars(s(l)))),e==y)throw c("badparse",e);y=e}o()}function s(e){if(!e)return"";var t=D.exec(e);e=t[1];var n=t[3];return(t=t[2])&&(E.innerHTML=t.replace(/</g,"&lt;"),t="textContent"in E?E.textContent:E.innerText),e+t+n}function a(e){return e.replace(/&/g,"&amp;").replace(b,function(e){var t=e.charCodeAt(0);return e=e.charCodeAt(1),"&#"+(1024*(t-55296)+(e-56320)+65536)+";"}).replace(y,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function l(e,n){var i=!1,o=t.bind(e,e.push);return{start:function(e,r,s){e=t.lowercase(e),!i&&S[e]&&(i=e),i||!0!==k[e]||(o("<"),o(e),t.forEach(r,function(i,r){var s=t.lowercase(r),l="img"===e&&"src"===s||"background"===s;!0!==$[s]||!0===T[s]&&!n(i,l)||(o(" "),o(r),o('="'),o(a(i)),o('"'))}),o(s?"/>":">"))},end:function(e){e=t.lowercase(e),i||!0!==k[e]||(o("</"),o(e),o(">")),e==i&&(i=!1)},chars:function(e){i||o(a(e))}}}var c=t.$$minErr("$sanitize"),u=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,d=/^<\/\s*([\w:-]+)[^>]*>/,h=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,p=/^</,f=/^<\//,g=/\x3c!--(.*?)--\x3e/g,m=/<!DOCTYPE([^>]*?)>/i,v=/<!\[CDATA\[(.*?)]]\x3e/g,b=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,y=/([^\#-~| |!])/g,w=o("area,br,col,hr,img,wbr");e=o("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),n=o("rp,rt");var C=t.extend({},n,e),_=t.extend({},e,o("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),x=t.extend({},n,o("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),S=o("script,style"),k=t.extend({},w,_,x,C),T=o("background,cite,href,longdesc,src,usemap"),$=t.extend({},T,o("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),E=document.createElement("pre"),D=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return r(t,l(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"]/,o=/^mailto:/;return function(r,s){function a(e){e&&p.push(i(e))}function l(e,n){p.push("<a "),t.isDefined(s)&&(p.push('target="'),p.push(s),p.push('" ')),p.push('href="'),p.push(e),p.push('">'),a(n),p.push("</a>")}if(!r)return r;for(var c,u,d,h=r,p=[];c=h.match(n);)u=c[0],c[2]==c[3]&&(u="mailto:"+u),d=c.index,a(h.substr(0,d)),l(u,c[0].replace(o,"")),h=h.substring(d+c[0].length);return a(h),e(p.join(""))}}])}(window,window.angular),window.Modernizr=function(e,t,n){function i(e){y.cssText=e}function o(e,t){return i(x.join(e+";")+(t||""))}function r(e,t){return typeof e===t}function s(e,t){return!!~(""+e).indexOf(t)}function a(e,t){for(var i in e){var o=e[i];if(!s(o,"-")&&y[o]!==n)return"pfx"==t?o:!0}return!1}function l(e,t,i){for(var o in e){var s=t[e[o]];if(s!==n)return i===!1?e[o]:r(s,"function")?s.bind(i||t):s}return!1}function c(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+k.join(i+" ")+i).split(" ");return r(t,"string")||r(t,"undefined")?a(o,t):(o=(e+" "+T.join(i+" ")+i).split(" "),l(o,t,n))}function u(){f.input=function(n){for(var i=0,o=n.length;o>i;i++)I[n[i]]=n[i]in w;return I.list&&(I.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),I}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),f.inputtypes=function(e){for(var i,o,r,s=0,a=e.length;a>s;s++)w.setAttribute("type",o=e[s]),i="text"!==w.type,i&&(w.value=C,w.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(o)&&w.style.WebkitAppearance!==n?(m.appendChild(w),r=t.defaultView,i=r.getComputedStyle&&"textfield"!==r.getComputedStyle(w,null).WebkitAppearance&&0!==w.offsetHeight,m.removeChild(w)):/^(search|tel)$/.test(o)||(i=/^(url|email)$/.test(o)?w.checkValidity&&w.checkValidity()===!1:w.value!=C)),D[e[s]]=!!i;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d,h,p="2.6.2",f={},g=!0,m=t.documentElement,v="modernizr",b=t.createElement(v),y=b.style,w=t.createElement("input"),C=":)",_={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),S="Webkit Moz O ms",k=S.split(" "),T=S.toLowerCase().split(" "),$={svg:"http://www.w3.org/2000/svg"},E={},D={},I={},M=[],A=M.slice,O=function(e,n,i,o){var r,s,a,l,c=t.createElement("div"),u=t.body,d=u||t.createElement("body");if(parseInt(i,10))for(;i--;)a=t.createElement("div"),a.id=o?o[i]:v+(i+1),c.appendChild(a);return r=["&#173;",'<style id="s',v,'">',e,"</style>"].join(""),c.id=v,(u?c:d).innerHTML+=r,d.appendChild(c),u||(d.style.background="",d.style.overflow="hidden",l=m.style.overflow,m.style.overflow="hidden",m.appendChild(d)),s=n(c,e),u?c.parentNode.removeChild(c):(d.parentNode.removeChild(d),m.style.overflow=l),!!s},R=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t).matches;var i;return O("@media "+t+" { #"+v+" { position: absolute; } }",function(t){i="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),i},P=function(){function e(e,o){o=o||t.createElement(i[e]||"div"),e="on"+e;var s=e in o;return s||(o.setAttribute||(o=t.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(e,""),s=r(o[e],"function"),r(o[e],"undefined")||(o[e]=n),o.removeAttribute(e))),o=null,s}var i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),N={}.hasOwnProperty;h=r(N,"undefined")||r(N.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(e,t){return N.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=A.call(arguments,1),i=function(){if(this instanceof i){var o=function(){};o.prototype=t.prototype;var r=new o,s=t.apply(r,n.concat(A.call(arguments)));return Object(s)===s?s:r}return t.apply(e,n.concat(A.call(arguments)))};return i}),E.flexbox=function(){return c("flexWrap")},E.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},E.canvastext=function(){return!!f.canvas&&!!r(t.createElement("canvas").getContext("2d").fillText,"function")},E.webgl=function(){return!!e.WebGLRenderingContext},E.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:O(["@media (",x.join("touch-enabled),("),v,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},E.geolocation=function(){return"geolocation"in navigator},E.postmessage=function(){return!!e.postMessage},E.websqldatabase=function(){return!!e.openDatabase},E.indexedDB=function(){return!!c("indexedDB",e)},E.hashchange=function(){return P("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},E.history=function(){return!!e.history&&!!history.pushState},E.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},E.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},E.rgba=function(){return i("background-color:rgba(150,255,150,.5)"),s(y.backgroundColor,"rgba")},E.hsla=function(){return i("background-color:hsla(120,40%,100%,.5)"),s(y.backgroundColor,"rgba")||s(y.backgroundColor,"hsla")},E.multiplebgs=function(){return i("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(y.background)},E.backgroundsize=function(){return c("backgroundSize")},E.borderimage=function(){return c("borderImage")},E.borderradius=function(){return c("borderRadius")},E.boxshadow=function(){return c("boxShadow")},E.textshadow=function(){return""===t.createElement("div").style.textShadow},E.opacity=function(){return o("opacity:.55"),/^0.55$/.test(y.opacity)},E.cssanimations=function(){return c("animationName")},E.csscolumns=function(){return c("columnCount")},E.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return i((e+"-webkit- ".split(" ").join(t+e)+x.join(n+e)).slice(0,-e.length)),s(y.backgroundImage,"gradient")},E.cssreflections=function(){return c("boxReflect")},E.csstransforms=function(){return!!c("transform")},E.csstransforms3d=function(){var e=!!c("perspective");return e&&"webkitPerspective"in m.style&&O("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=9===t.offsetLeft&&3===t.offsetHeight}),e},E.csstransitions=function(){return c("transition")},E.fontface=function(){var e;return O('@font-face {font-family:"font";src:url("https://")}',function(n,i){var o=t.getElementById("smodernizr"),r=o.sheet||o.styleSheet,s=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";e=/src/i.test(s)&&0===s.indexOf(i.split(" ")[0])}),e},E.generatedcontent=function(){var e;return O(["#",v,"{font:0/0 a}#",v,':after{content:"',C,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},E.video=function(){var e=t.createElement("video"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(i){}return n},E.audio=function(){var e=t.createElement("audio"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(i){}return n},E.localstorage=function(){try{return localStorage.setItem(v,v),localStorage.removeItem(v),!0}catch(e){return!1}},E.sessionstorage=function(){try{return sessionStorage.setItem(v,v),sessionStorage.removeItem(v),!0}catch(e){return!1}},E.webworkers=function(){return!!e.Worker},E.applicationcache=function(){return!!e.applicationCache},E.svg=function(){return!!t.createElementNS&&!!t.createElementNS($.svg,"svg").createSVGRect},E.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==$.svg},E.smil=function(){return!!t.createElementNS&&/SVGAnimate/.test(_.call(t.createElementNS($.svg,"animate")))},E.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(_.call(t.createElementNS($.svg,"clipPath")))};for(var L in E)h(E,L)&&(d=L.toLowerCase(),f[d]=E[L](),M.push((f[d]?"":"no-")+d));return f.input||u(),f.addTest=function(e,t){if("object"==typeof e)for(var i in e)h(e,i)&&f.addTest(i,e[i]);else{if(e=e.toLowerCase(),f[e]!==n)return f;t="function"==typeof t?t():t,"undefined"!=typeof g&&g&&(m.className+=" "+(t?"":"no-")+e),f[e]=t}return f},i(""),b=w=null,function(e,t){function n(e,t){var n=e.createElement("p"),i=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",i.insertBefore(n.lastChild,i.firstChild)}function i(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function o(e){var t=m[e[f]];return t||(t={},g++,e[f]=g,m[g]=t),t}function r(e,n,i){if(n||(n=t),u)return n.createElement(e);i||(i=o(n));var r;return r=i.cache[e]?i.cache[e].cloneNode():p.test(e)?(i.cache[e]=i.createElem(e)).cloneNode():i.createElem(e),r.canHaveChildren&&!h.test(e)?i.frag.appendChild(r):r}function s(e,n){if(e||(e=t),u)return e.createDocumentFragment();n=n||o(e);for(var r=n.frag.cloneNode(),s=0,a=i(),l=a.length;l>s;s++)r.createElement(a[s]);return r}function a(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return v.shivMethods?r(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+i().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function l(e){e||(e=t);var i=o(e);return v.shivCSS&&!c&&!i.hasCSS&&(i.hasCSS=!!n(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),u||a(e,i),e}var c,u,d=e.html5||{},h=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,p=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f="_html5shiv",g=0,m={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,u=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){c=!0,u=!0}}();var v={elements:d.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:d.shivCSS!==!1,supportsUnknownElements:u,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:l,createElement:r,createDocumentFragment:s};e.html5=v,l(t)}(this,t),f._version=p,f._prefixes=x,f._domPrefixes=T,f._cssomPrefixes=k,f.mq=R,f.hasEvent=P,f.testProp=function(e){return a([e])},f.testAllProps=c,f.testStyles=O,f.prefixed=function(e,t,n){return t?c(e,t,n):c(e,"pfx")},m.className=m.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(g?" js "+M.join(" "):""),f}(this,this.document),function(e,t,n){function i(e){return"[object Function]"==m.call(e)}function o(e){return"string"==typeof e}function r(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function a(){var e=v.shift();b=1,e?e.t?f(function(){("c"==e.t?h.injectCss:h.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),a()):b=0}function l(e,n,i,o,r,l,c){function u(t){if(!p&&s(d.readyState)&&(y.r=p=1,!b&&a(),d.onload=d.onreadystatechange=null,t)){"img"!=e&&f(function(){C.removeChild(d)},50);for(var i in T[n])T[n].hasOwnProperty(i)&&T[n][i].onload()}}var c=c||h.errorTimeout,d=t.createElement(e),p=0,m=0,y={t:i,s:n,e:r,a:l,x:c};1===T[n]&&(m=1,T[n]=[]),"object"==e?d.data=n:(d.src=n,d.type=e),d.width=d.height="0",d.onerror=d.onload=d.onreadystatechange=function(){u.call(this,m)},v.splice(o,0,y),"img"!=e&&(m||2===T[n]?(C.insertBefore(d,w?null:g),f(u,c)):T[n].push(d))}function c(e,t,n,i,r){return b=0,t=t||"j",o(e)?l("c"==t?x:_,e,t,this.i++,n,i,r):(v.splice(this.i++,0,e),1==v.length&&a()),this}function u(){var e=h;return e.loader={load:c,i:0},e}var d,h,p=t.documentElement,f=e.setTimeout,g=t.getElementsByTagName("script")[0],m={}.toString,v=[],b=0,y="MozAppearance"in p.style,w=y&&!!t.createRange().compareNode,C=w?p:g.parentNode,p=e.opera&&"[object Opera]"==m.call(e.opera),p=!!t.attachEvent&&!p,_=y?"object":p?"script":"img",x=p?"script":_,S=Array.isArray||function(e){return"[object Array]"==m.call(e)},k=[],T={},$={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};h=function(e){function t(e){var t,n,i,e=e.split("!"),o=k.length,r=e.pop(),s=e.length,r={url:r,origUrl:r,prefixes:e};for(n=0;s>n;n++)i=e[n].split("="),(t=$[i.shift()])&&(r=t(r,i));for(n=0;o>n;n++)r=k[n](r);return r}function s(e,o,r,s,a){var l=t(e),c=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(o&&(o=i(o)?o:o[e]||o[s]||o[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,o,r,s,a):(T[l.url]?l.noexec=!0:T[l.url]=1,r.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":n,l.noexec,l.attrs,l.timeout),(i(o)||i(c))&&r.load(function(){u(),o&&o(l.origUrl,a,s),c&&c(l.origUrl,a,s),T[l.url]=2})))}function a(e,t){function n(e,n){if(e){if(o(e))n||(d=function(){var e=[].slice.call(arguments);h.apply(this,e),p()}),s(e,d,t,0,c);else if(Object(e)===e)for(l in a=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(l)&&(!n&&!--a&&(i(d)?d=function(){var e=[].slice.call(arguments);h.apply(this,e),p()}:d[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),p()}}(h[l])),s(e[l],d,t,l,c))}else!n&&p()}var a,l,c=!!e.test,u=e.load||e.both,d=e.callback||r,h=d,p=e.complete||r;n(c?e.yep:e.nope,!!u),u&&n(u)}var l,c,d=this.yepnope.loader;if(o(e))s(e,0,d,0);else if(S(e))for(l=0;l<e.length;l++)c=e[l],o(c)?s(c,0,d,0):S(c)?h(c):Object(c)===c&&a(c,d);else Object(e)===e&&a(e,d)},h.addPrefix=function(e,t){$[e]=t},h.addFilter=function(e){k.push(e)},h.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",d=function(){t.removeEventListener("DOMContentLoaded",d,0),t.readyState="complete"},0)),e.yepnope=u(),e.yepnope.executeStack=a,e.yepnope.injectJs=function(e,n,i,o,l,c){var u,d,p=t.createElement("script"),o=o||h.errorTimeout;p.src=e;for(d in i)p.setAttribute(d,i[d]);n=c?a:n||r,p.onreadystatechange=p.onload=function(){!u&&s(p.readyState)&&(u=1,n(),p.onload=p.onreadystatechange=null)},f(function(){u||(u=1,n(1))},o),l?p.onload():g.parentNode.insertBefore(p,g)},e.yepnope.injectCss=function(e,n,i,o,s,l){var c,o=t.createElement("link"),n=l?a:n||r;o.href=e,o.rel="stylesheet",o.type="text/css";for(c in i)o.setAttribute(c,i[c]);s||(g.parentNode.insertBefore(o,g),f(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},function(e,t,n){"use strict";function i(e,n){n=n||{},t.forEach(n,function(e,t){delete n[t]});for(var i in e)!e.hasOwnProperty(i)||"$"===i.charAt(0)&&"$"===i.charAt(1)||(n[i]=e[i]);return n}var o=t.$$minErr("$resource"),r=/^(\.[a-zA-Z_$][0-9a-zA-Z_$]*)+$/;t.module("ngResource",["ng"]).provider("$resource",function(){var e=this;this.defaults={stripTrailingSlashes:!0,actions:{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}}},this.$get=["$http","$q",function(s,a){function l(t,n){this.template=t,this.defaults=h({},e.defaults,n),this.urlParams={}}function c(g,m,v,b){function y(e,t){var i={};return t=h({},m,t),d(t,function(t,s){f(t)&&(t=t());var a;if(t&&t.charAt&&"@"==t.charAt(0)){a=e;var l=t.substr(1);if(null==l||""===l||"hasOwnProperty"===l||!r.test("."+l))throw o("badmember",l);for(var l=l.split("."),c=0,u=l.length;u>c&&a!==n;c++){var d=l[c];a=null!==a?a[d]:n}}else a=t;i[s]=a}),i}function w(e){return e.resource}function C(e){i(e||{},this)}var _=new l(g,b);return v=h({},e.defaults.actions,v),C.prototype.toJSON=function(){var e=h({},this);return delete e.$promise,delete e.$resolved,e},d(v,function(e,r){var l=/^(POST|PUT|PATCH)$/i.test(e.method);C[r]=function(r,c,g,m){var v,b,x,S={};switch(arguments.length){case 4:x=m,b=g;case 3:case 2:if(!f(c)){S=r,v=c,b=g;break}if(f(r)){b=r,x=c;break}b=c,x=g;case 1:f(r)?b=r:l?v=r:S=r;break;case 0:break;default:throw o("badargs",arguments.length)}var k=this instanceof C,T=k?v:e.isArray?[]:new C(v),$={},E=e.interceptor&&e.interceptor.response||w,D=e.interceptor&&e.interceptor.responseError||n;return d(e,function(e,t){"params"!=t&&"isArray"!=t&&"interceptor"!=t&&($[t]=p(e))}),l&&($.data=v),_.setUrlParams($,h({},y(v,e.params||{}),S),e.url),S=s($).then(function(n){var r=n.data,s=T.$promise;if(r){if(t.isArray(r)!==!!e.isArray)throw o("badcfg",e.isArray?"array":"object",t.isArray(r)?"array":"object");e.isArray?(T.length=0,d(r,function(e){T.push("object"==typeof e?new C(e):e)})):(i(r,T),T.$promise=s)}return T.$resolved=!0,n.resource=T,n},function(e){return T.$resolved=!0,(x||u)(e),a.reject(e)}),S=S.then(function(e){var t=E(e);return(b||u)(t,e.headers),t},D),k?S:(T.$promise=S,T.$resolved=!1,T)},C.prototype["$"+r]=function(e,t,n){return f(e)&&(n=t,t=e,e={}),e=C[r].call(this,e,this,t,n),e.$promise||e}}),C.bind=function(e){return c(g,h({},m,e),v)},C}var u=t.noop,d=t.forEach,h=t.extend,p=t.copy,f=t.isFunction;return l.prototype={setUrlParams:function(e,n,i){var r,s,a=this,l=i||a.template,c=a.urlParams={};d(l.split(/\W/),function(e){if("hasOwnProperty"===e)throw o("badname");!/^\d+$/.test(e)&&e&&RegExp("(^|[^\\\\]):"+e+"(\\W|$)").test(l)&&(c[e]=!0)}),l=l.replace(/\\:/g,":"),n=n||{},d(a.urlParams,function(e,i){r=n.hasOwnProperty(i)?n[i]:a.defaults[i],t.isDefined(r)&&null!==r?(s=encodeURIComponent(r).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"%20").replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+"),l=l.replace(RegExp(":"+i+"(\\W|$)","g"),function(e,t){return s+t})):l=l.replace(RegExp("(/?):"+i+"(\\W|$)","g"),function(e,t,n){return"/"==n.charAt(0)?n:t+n})}),a.defaults.stripTrailingSlashes&&(l=l.replace(/\/+$/,"")||"/"),l=l.replace(/\/\.(?=\w+($|\?))/,"."),e.url=l.replace(/\/\\\./,"/."),d(n,function(t,n){a.urlParams[n]||(e.params=e.params||{},e.params[n]=t)})}},c}]})}(window,window.angular),function(e,t,n){"use strict";function i(e,n,i){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(o,r,s,a,l){function c(){p&&(p.remove(),p=null),d&&(d.$destroy(),d=null),h&&(i.leave(h,function(){p=null}),p=h,h=null)}function u(){var s=e.current&&e.current.locals;if(t.isDefined(s&&s.$template)){var s=o.$new(),a=e.current;h=l(s,function(e){i.enter(e,null,h||r,function(){!t.isDefined(f)||f&&!o.$eval(f)||n()}),c()}),d=a.scope=s,d.$emit("$viewContentLoaded"),d.$eval(g)}else c()}var d,h,p,f=s.autoscroll,g=s.onload||"";o.$on("$routeChangeSuccess",u),u()}}}function o(e,t,n){return{restrict:"ECA",priority:-400,link:function(i,o){var r=n.current,s=r.locals;o.html(s.$template);var a=e(o.contents());r.controller&&(s.$scope=i,s=t(r.controller,s),r.controllerAs&&(i[r.controllerAs]=s),o.data("$ngControllerController",s),o.children().data("$ngControllerController",s)),a(i)}}}e=t.module("ngRoute",["ng"]).provider("$route",function(){function e(e,n){return t.extend(new(t.extend(function(){},{prototype:e})),n)}function n(e,t){var n=t.caseInsensitiveMatch,i={originalPath:e,regexp:e},o=i.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,n,i){return e="?"===i?i:null,i="*"===i?i:null,o.push({name:n,optional:!!e}),t=t||"",""+(e?"":t)+"(?:"+(e?t:"")+(i&&"(.+?)"||"([^/]+)")+(e||"")+")"+(e||"")}).replace(/([\/$\*])/g,"\\$1"),i.regexp=RegExp("^"+e+"$",n?"i":""),i}var i={};this.when=function(e,o){if(i[e]=t.extend({reloadOnSearch:!0},o,e&&n(e,o)),e){var r="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";i[r]=t.extend({redirectTo:e},n(r,o))}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(n,o,s,a,l,c,u,d){function h(){var e=p(),i=m.current;e&&i&&e.$$route===i.$$route&&t.equals(e.pathParams,i.pathParams)&&!e.reloadOnSearch&&!g?(i.params=e.params,t.copy(i.params,s),n.$broadcast("$routeUpdate",i)):(e||i)&&(g=!1,n.$broadcast("$routeChangeStart",e,i),(m.current=e)&&e.redirectTo&&(t.isString(e.redirectTo)?o.path(f(e.redirectTo,e.params)).search(e.params).replace():o.url(e.redirectTo(e.pathParams,o.path(),o.search())).replace()),a.when(e).then(function(){if(e){var n,i,o=t.extend({},e.resolve);return t.forEach(o,function(e,n){o[n]=t.isString(e)?l.get(e):l.invoke(e,null,null,n)}),t.isDefined(n=e.template)?t.isFunction(n)&&(n=n(e.params)):t.isDefined(i=e.templateUrl)&&(t.isFunction(i)&&(i=i(e.params)),i=d.getTrustedResourceUrl(i),t.isDefined(i)&&(e.loadedTemplateUrl=i,n=c.get(i,{cache:u}).then(function(e){return e.data}))),t.isDefined(n)&&(o.$template=n),a.all(o)}}).then(function(o){e==m.current&&(e&&(e.locals=o,t.copy(e.params,s)),n.$broadcast("$routeChangeSuccess",e,i))},function(t){e==m.current&&n.$broadcast("$routeChangeError",e,i,t)}))}function p(){var n,r;return t.forEach(i,function(i,s){var a;if(a=!r){var l=o.path();a=i.keys;var c={};if(i.regexp)if(l=i.regexp.exec(l)){for(var u=1,d=l.length;d>u;++u){var h=a[u-1],p=l[u];h&&p&&(c[h.name]=p)}a=c}else a=null;else a=null;a=n=a}a&&(r=e(i,{params:t.extend({},o.search(),n),pathParams:n}),r.$$route=i)}),r||i[null]&&e(i[null],{params:{},pathParams:{}})}function f(e,n){var i=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)i.push(e);else{var o=e.match(/(\w+)(.*)/),r=o[1];i.push(n[r]),i.push(o[2]||""),delete n[r]}}),i.join("")}var g=!1,m={routes:i,reload:function(){g=!0,n.$evalAsync(h)},updateParams:function(e){if(!this.current||!this.current.$$route)throw r("norout");var n={},i=this;t.forEach(Object.keys(e),function(t){i.current.pathParams[t]||(n[t]=e[t])}),e=t.extend({},this.current.params,e),o.path(f(this.current.$$route.originalPath,e)),o.search(t.extend({},o.search(),n))}};return n.$on("$locationChangeSuccess",h),m}]});var r=t.$$minErr("ngRoute");e.provider("$routeParams",function(){this.$get=function(){return{}}}),e.directive("ngView",i),e.directive("ngView",o),i.$inject=["$route","$anchorScroll","$animate"],o.$inject=["$compile","$controller","$route"]}(window,window.angular),function(e,t,n){"use strict";t.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(e,i){var o,r={},s={},a=!1,l=t.copy,c=t.isUndefined;return i.addPollFn(function(){var t=i.cookies();o!=t&&(o=t,l(t,s),l(t,r),a&&e.$apply())})(),a=!0,e.$watch(function(){var e,o,a;for(e in s)c(r[e])&&i.cookies(e,n);for(e in r)o=r[e],t.isString(o)||(o=""+o,r[e]=o),o!==s[e]&&(i.cookies(e,o),a=!0);if(a)for(e in o=i.cookies(),r)r[e]!==o[e]&&(c(o[e])?delete r[e]:r[e]=o[e])}),r}]).factory("$cookieStore",["$cookies",function(e){return{get:function(n){return(n=e[n])?t.fromJson(n):n},put:function(n,i){e[n]=t.toJson(i)},remove:function(t){delete e[t]}}}])}(window,window.angular),!function(e,t){"use strict";function n(e){for(var t=-1,n=Object.keys(e),i=new Array(n.length);++t<n.length;)i[t]=e[n[t]];return i}function i(e){return null===e}function o(e,t){var n=Object.keys(e);return-1==n.map(function(n){return!(!t[n]||t[n]!=e[n])}).indexOf(!1)}function r(e){return function(t,i){function o(e,t){return s(t)?!1:e.some(function(e){return d(e,t)})}if(t=l(t)?n(t):t,s(i))return t.filter(function(e,t,n){return n.indexOf(e)===t});var r=[],a=e(i);return t.filter(function(e){var t=a(e);return o(r,t)?!1:(r.push(t),!0)})}}var s=(t.isDefined,t.isUndefined),a=(t.isFunction,t.isString),l=t.isObject,c=t.isArray,u=(t.forEach,t.extend),d=(t.copy,t.equals);t.module("a8m.angular",[]).filter("isUndefined",function(){return function(e){return t.isUndefined(e)}}).filter("isDefined",function(){return function(e){return t.isDefined(e)}}).filter("isFunction",function(){return function(e){return t.isFunction(e)}}).filter("isString",function(){return function(e){return t.isString(e)}}).filter("isNumber",function(){return function(e){return t.isNumber(e)}}).filter("isArray",function(){return function(e){return t.isArray(e)}}).filter("isObject",function(){return function(e){return t.isObject(e)}}).filter("isEqual",function(){return function(e,n){return t.equals(e,n)}}),t.module("a8m.is-null",[]).filter("isNull",function(){return function(e){return i(e)}}),t.module("a8m.after-where",[]).filter("afterWhere",function(){return function(e,t){if(e=l(e)?n(e):e,!c(e)||s(t))return e;var i=e.map(function(e){return o(t,e)}).indexOf(!0);return e.slice(-1===i?0:i)}}),t.module("a8m.after",[]).filter("after",function(){return function(e,t){return e=l(e)?n(e):e,c(e)?e.slice(t):e}}),t.module("a8m.before-where",[]).filter("beforeWhere",function(){return function(e,t){if(e=l(e)?n(e):e,!c(e)||s(t))return e;var i=e.map(function(e){return o(t,e)}).indexOf(!0);return e.slice(0,-1===i?e.length:++i)}}),t.module("a8m.before",[]).filter("before",function(){return function(e,t){return e=l(e)?n(e):e,c(e)?e.slice(0,t?--t:t):e}}),t.module("a8m.concat",[]).filter("concat",[function(){return function(e,t){if(s(t))return e;if(c(e))return e.concat(l(t)?n(t):t);if(l(e)){var i=n(e);return i.concat(l(t)?n(t):t)}return e}}]),t.module("a8m.group-by",[]).filter("groupBy",["$parse",function(e){return function(t,i){var o,r={},a=e(i);return t=l(t)?n(t):t,!c(t)||s(i)?t:(t.forEach(function(e){o=a(e),r[o]||(r[o]=[]),r[o].push(e)}),r)}}]),t.module("a8m.is-empty",[]).filter("isEmpty",function(){return function(e){return l(e)?!n(e).length:!e.length}}),t.module("a8m.remove-with",[]).filter("removeWith",function(){return function(e,t){return s(t)?e:(e=l(e)?n(e):e,e.filter(function(e){return!o(t,e)}))}}),t.module("a8m.remove",[]).filter("remove",function(){return function(e){e=l(e)?n(e):e;var t=Array.prototype.slice.call(arguments,1);return c(e)?e.filter(function(e){return!t.some(function(t){return d(t,e)})}):e}}),t.module("a8m.reverse",[]).filter("reverse",[function(){return function(e){return e=l(e)?n(e):e,a(e)?e.split("").reverse().join(""):c(e)?e.reverse():e}}]),t.module("a8m.search-field",[]).filter("searchField",["$parse",function(e){return function(t){var i,o;t=l(t)?n(t):t;var r=Array.prototype.slice.call(arguments,1);return c(t)&&r.length?t.map(function(t){return o=r.map(function(n){return(i=e(n))(t)}).join(" "),u({searchField:o},t)}):t}}]),t.module("a8m.unique",[]).filter({unique:["$parse",r],uniq:["$parse",r]}),t.module("a8m.where",[]).filter("where",function(){return function(e,t){return s(t)?e:(e=l(e)?n(e):e,e.filter(function(e){return o(t,e)}))}}),t.module("a8m.math",[]).factory("$math",["$window",function(e){return e.Math}]),t.module("a8m.math.max",["a8m.math"]).filter("max",["$math",function(e){return function(t){return c(t)?e.max.apply(e,t):t}}]),t.module("a8m.math.min",["a8m.math"]).filter("min",["$math",function(e){return function(t){return c(t)?e.min.apply(e,t):t}}]),t.module("a8m.remove-spaces",[]).filter("removeSpaces",[function(){return function(e,t){var n=t||"-";return a(e)?e.replace(/\s+/g,n):e}}]),t.module("a8m.stringular",[]).filter("stringular",function(){return function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return s(t[n])?e:t[n]})}}),t.module("a8m.strip-tags",[]).filter("stripTags",function(){return function(e){return a(e)?e.replace(/<\S[^><]*>/g,""):e}}),t.module("a8m.truncate",[]).filter("truncate",function(){return function(e,t,n,i){return a(e)?(t=s(t)?e.length:t,i=i||!1,n=n||"",e.substring(0,i?-1===e.indexOf(" ",t)?t:e.indexOf(" ",t):t)+n):e}}),t.module("a8m.ucfirst",[]).filter("ucfirst",[function(){return function(e){return t.isString(e)?e.split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.substring(1)}).join(" "):e}}]),t.module("a8m.uri-encode",[]).filter("uriEncode",["$window",function(e){return function(t){return a(t)?e.encodeURI(t):t}}]),t.module("angular.filter",["a8m.ucfirst","a8m.uri-encode","a8m.remove-spaces","a8m.strip-tags","a8m.stringular","a8m.truncate","a8m.concat","a8m.unique","a8m.is-empty","a8m.after","a8m.after-where","a8m.before","a8m.before-where","a8m.where","a8m.reverse","a8m.remove","a8m.remove-with","a8m.group-by","a8m.search-field","a8m.math","a8m.math.max","a8m.math.min","a8m.angular","a8m.is-null"])}(window,window.angular),!function(e,t){return"function"==typeof define&&define.amd?void define("angular-file-upload",["angular"],function(e){return t(e)}):t(e)}("undefined"==typeof angular?null:angular,function(e){var t=e.module("angularFileUpload",[]);return t.value("fileUploaderOptions",{url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:!1}).factory("FileUploader",["fileUploaderOptions","$rootScope","$http","$window","$compile",function(t,n,i,o,r){function s(n){var i=e.copy(t);e.extend(this,i,n,{isUploading:!1,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}}),this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter
}),this.filters.unshift({name:"folder",fn:this._folderFilter})}function a(t){var n=e.isElement(t),i=n?t.value:t,o=e.isString(i)?"FakePath":"Object",r="_createFrom"+o;this[r](i)}function l(t,n,i){var o=e.isElement(n),r=o?e.element(n):null,a=o?null:n;e.extend(this,{url:t.url,alias:t.alias,headers:e.copy(t.headers),formData:e.copy(t.formData),removeAfterUpload:t.removeAfterUpload,withCredentials:t.withCredentials,method:t.method},i,{uploader:t,file:new s.FileLikeObject(n),isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:0,index:null,_file:a,_input:r}),r&&this._replaceNode(r)}function c(t){e.extend(this,t),this.uploader._directives[this.prop].push(this),this._saveLinks(),this.bind()}function u(){u.super_.apply(this,arguments),this.uploader.isHTML5||this.element.removeAttr("multiple"),this.element.prop("value",null)}function d(){d.super_.apply(this,arguments)}function h(){h.super_.apply(this,arguments)}return s.prototype.isHTML5=!(!o.File||!o.FormData),s.prototype.addToQueue=function(t,n,i){var o=this.isArrayLikeObject(t)?t:[t],r=this._getFilters(i),a=this.queue.length,l=[];e.forEach(o,function(e){var t=new s.FileLikeObject(e);if(this._isValidFile(t,r,n)){var i=new s.FileItem(this,e,n);l.push(i),this.queue.push(i),this._onAfterAddingFile(i)}else{var o=this.filters[this._failFilterIndex];this._onWhenAddingFileFailed(t,o,n)}},this),this.queue.length!==a&&(this._onAfterAddingAll(l),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},s.prototype.removeFromQueue=function(e){var t=this.getIndexOfItem(e),n=this.queue[t];n.isUploading&&n.cancel(),this.queue.splice(t,1),n._destroy(),this.progress=this._getTotalProgress()},s.prototype.clearQueue=function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0},s.prototype.uploadItem=function(e){var t=this.getIndexOfItem(e),n=this.queue[t],i=this.isHTML5?"_xhrTransport":"_iframeTransport";n._prepareToUploading(),this.isUploading||(this.isUploading=!0,this[i](n))},s.prototype.cancelItem=function(e){var t=this.getIndexOfItem(e),n=this.queue[t],i=this.isHTML5?"_xhr":"_form";n&&n.isUploading&&n[i].abort()},s.prototype.uploadAll=function(){var t=this.getNotUploadedItems().filter(function(e){return!e.isUploading});t.length&&(e.forEach(t,function(e){e._prepareToUploading()}),t[0].upload())},s.prototype.cancelAll=function(){var t=this.getNotUploadedItems();e.forEach(t,function(e){e.cancel()})},s.prototype.isFile=function(e){var t=o.File;return t&&e instanceof t},s.prototype.isFileLikeObject=function(e){return e instanceof s.FileLikeObject},s.prototype.isArrayLikeObject=function(t){return e.isObject(t)&&"length"in t},s.prototype.getIndexOfItem=function(t){return e.isNumber(t)?t:this.queue.indexOf(t)},s.prototype.getNotUploadedItems=function(){return this.queue.filter(function(e){return!e.isUploaded})},s.prototype.getReadyItems=function(){return this.queue.filter(function(e){return e.isReady&&!e.isUploading}).sort(function(e,t){return e.index-t.index})},s.prototype.destroy=function(){e.forEach(this._directives,function(t){e.forEach(this._directives[t],function(e){e.destroy()},this)},this)},s.prototype.onAfterAddingAll=function(){},s.prototype.onAfterAddingFile=function(){},s.prototype.onWhenAddingFileFailed=function(){},s.prototype.onBeforeUploadItem=function(){},s.prototype.onProgressItem=function(){},s.prototype.onProgressAll=function(){},s.prototype.onSuccessItem=function(){},s.prototype.onErrorItem=function(){},s.prototype.onCancelItem=function(){},s.prototype.onCompleteItem=function(){},s.prototype.onCompleteAll=function(){},s.prototype._getTotalProgress=function(e){if(this.removeAfterUpload)return e||0;var t=this.getNotUploadedItems().length,n=t?this.queue.length-t:this.queue.length,i=100/this.queue.length,o=(e||0)*i/100;return Math.round(n*i+o)},s.prototype._getFilters=function(t){if(e.isUndefined(t))return this.filters;if(e.isArray(t))return t;var n=t.match(/[^\s,]+/g);return this.filters.filter(function(e){return-1!==n.indexOf(e.name)},this)},s.prototype._render=function(){n.$$phase||n.$apply()},s.prototype._folderFilter=function(e){return!(!e.size&&!e.type)},s.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit},s.prototype._isValidFile=function(e,t,n){return this._failFilterIndex=-1,t.length?t.every(function(t){return this._failFilterIndex++,t.fn.call(this,e,n)},this):!0},s.prototype._isSuccessCode=function(e){return e>=200&&300>e||304===e},s.prototype._transformResponse=function(t){return e.forEach(i.defaults.transformResponse,function(e){t=e(t)}),t},s.prototype._parseHeaders=function(t){function n(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function i(e){return e.toLowerCase()}var o,r,s,a={};return t?(e.forEach(t.split("\n"),function(e){s=e.indexOf(":"),o=i(n(e.substr(0,s))),r=n(e.substr(s+1)),o&&(a[o]=a[o]?a[o]+", "+r:r)}),a):a},s.prototype._xhrTransport=function(t){var n=t._xhr=new XMLHttpRequest,i=new FormData,o=this;o._onBeforeUploadItem(t),e.forEach(t.formData,function(t){e.forEach(t,function(e,t){i.append(t,e)})}),i.append(t.alias,t._file,t.file.name),n.upload.onprogress=function(e){var n=Math.round(e.lengthComputable?100*e.loaded/e.total:0);o._onProgressItem(t,n)},n.onload=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response),r=o._isSuccessCode(n.status)?"Success":"Error",s="_on"+r+"Item";o[s](t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.onerror=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response);o._onErrorItem(t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.onabort=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response);o._onCancelItem(t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.open(t.method,t.url,!0),n.withCredentials=t.withCredentials,e.forEach(t.headers,function(e,t){n.setRequestHeader(t,e)}),n.send(i),this._render()},s.prototype._iframeTransport=function(t){var n=e.element('<form style="display: none;" />'),i=e.element('<iframe name="iframeTransport'+Date.now()+'">'),o=t._input,r=this;t._form&&t._form.replaceWith(o),t._form=n,r._onBeforeUploadItem(t),o.prop("name",t.alias),e.forEach(t.formData,function(t){e.forEach(t,function(t,i){n.append(e.element('<input type="hidden" name="'+i+'" value="'+t+'" />'))})}),n.prop({action:t.url,method:"POST",target:i.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),i.bind("load",function(){try{var e=i[0].contentDocument.body.innerHTML}catch(n){}var o={response:e,status:200,dummy:!0},s=r._transformResponse(o.response),a={};r._onSuccessItem(t,s,o.status,a),r._onCompleteItem(t,s,o.status,a)}),n.abort=function(){var e,s={status:0,dummy:!0},a={};i.unbind("load").prop("src","javascript:false;"),n.replaceWith(o),r._onCancelItem(t,e,s.status,a),r._onCompleteItem(t,e,s.status,a)},o.after(n),n.append(o).append(i),n[0].submit(),this._render()},s.prototype._onWhenAddingFileFailed=function(e,t,n){this.onWhenAddingFileFailed(e,t,n)},s.prototype._onAfterAddingFile=function(e){this.onAfterAddingFile(e)},s.prototype._onAfterAddingAll=function(e){this.onAfterAddingAll(e)},s.prototype._onBeforeUploadItem=function(e){e._onBeforeUpload(),this.onBeforeUploadItem(e)},s.prototype._onProgressItem=function(e,t){var n=this._getTotalProgress(t);this.progress=n,e._onProgress(t),this.onProgressItem(e,t),this.onProgressAll(n),this._render()},s.prototype._onSuccessItem=function(e,t,n,i){e._onSuccess(t,n,i),this.onSuccessItem(e,t,n,i)},s.prototype._onErrorItem=function(e,t,n,i){e._onError(t,n,i),this.onErrorItem(e,t,n,i)},s.prototype._onCancelItem=function(e,t,n,i){e._onCancel(t,n,i),this.onCancelItem(e,t,n,i)},s.prototype._onCompleteItem=function(t,n,i,o){t._onComplete(n,i,o),this.onCompleteItem(t,n,i,o);var r=this.getReadyItems()[0];return this.isUploading=!1,e.isDefined(r)?void r.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())},s.isFile=s.prototype.isFile,s.isFileLikeObject=s.prototype.isFileLikeObject,s.isArrayLikeObject=s.prototype.isArrayLikeObject,s.isHTML5=s.prototype.isHTML5,s.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.super_=t},s.FileLikeObject=a,s.FileItem=l,s.FileDirective=c,s.FileSelect=u,s.FileDrop=d,s.FileOver=h,a.prototype._createFromFakePath=function(e){this.lastModifiedDate=null,this.size=null,this.type="like/"+e.slice(e.lastIndexOf(".")+1).toLowerCase(),this.name=e.slice(e.lastIndexOf("/")+e.lastIndexOf("\\")+2)},a.prototype._createFromObject=function(t){this.lastModifiedDate=e.copy(t.lastModifiedDate),this.size=t.size,this.type=t.type,this.name=t.name},l.prototype.upload=function(){this.uploader.uploadItem(this)},l.prototype.cancel=function(){this.uploader.cancelItem(this)},l.prototype.remove=function(){this.uploader.removeFromQueue(this)},l.prototype.onBeforeUpload=function(){},l.prototype.onProgress=function(){},l.prototype.onSuccess=function(){},l.prototype.onError=function(){},l.prototype.onCancel=function(){},l.prototype.onComplete=function(){},l.prototype._onBeforeUpload=function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},l.prototype._onProgress=function(e){this.progress=e,this.onProgress(e)},l.prototype._onSuccess=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(e,t,n)},l.prototype._onError=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(e,t,n)},l.prototype._onCancel=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(e,t,n)},l.prototype._onComplete=function(e,t,n){this.onComplete(e,t,n),this.removeAfterUpload&&this.remove()},l.prototype._destroy=function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input},l.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0},l.prototype._replaceNode=function(e){var t=r(e.clone())(e.scope());t.prop("value",null),e.css("display","none"),e.after(t)},c.prototype.events={},c.prototype.bind=function(){for(var e in this.events){var t=this.events[e];this.element.bind(e,this[t])}},c.prototype.unbind=function(){for(var e in this.events)this.element.unbind(e,this.events[e])},c.prototype.destroy=function(){var e=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(e,1),this.unbind()},c.prototype._saveLinks=function(){for(var e in this.events){var t=this.events[e];this[t]=this[t].bind(this)}},s.inherit(u,c),u.prototype.events={$destroy:"destroy",change:"onChange"},u.prototype.prop="select",u.prototype.getOptions=function(){},u.prototype.getFilters=function(){},u.prototype.isEmptyAfterSelection=function(){return!!this.element.attr("multiple")},u.prototype.onChange=function(){var e=this.uploader.isHTML5?this.element[0].files:this.element[0],t=this.getOptions(),n=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(e,t,n),this.isEmptyAfterSelection()&&this.element.prop("value",null)},s.inherit(d,c),d.prototype.events={$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"},d.prototype.prop="drop",d.prototype.getOptions=function(){},d.prototype.getFilters=function(){},d.prototype.onDrop=function(t){var n=this._getTransfer(t);if(n){var i=this.getOptions(),o=this.getFilters();this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._removeOverClass,this),this.uploader.addToQueue(n.files,i,o)}},d.prototype.onDragOver=function(t){var n=this._getTransfer(t);this._haveFiles(n.types)&&(n.dropEffect="copy",this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._addOverClass,this))},d.prototype.onDragLeave=function(t){t.target===this.element[0]&&(this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._removeOverClass,this))},d.prototype._getTransfer=function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent.dataTransfer},d.prototype._preventAndStop=function(e){e.preventDefault(),e.stopPropagation()},d.prototype._haveFiles=function(e){return e?e.indexOf?-1!==e.indexOf("Files"):e.contains?e.contains("Files"):!1:!1},d.prototype._addOverClass=function(e){e.addOverClass()},d.prototype._removeOverClass=function(e){e.removeOverClass()},s.inherit(h,c),h.prototype.events={$destroy:"destroy"},h.prototype.prop="over",h.prototype.overClass="nv-file-over",h.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())},h.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())},h.prototype.getOverClass=function(){return this.overClass},s}]).directive("nvFileSelect",["$parse","FileUploader",function(e,t){return{link:function(n,i,o){var r=n.$eval(o.uploader);if(!(r instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');var s=new t.FileSelect({uploader:r,element:i});s.getOptions=e(o.options).bind(s,n),s.getFilters=function(){return o.filters}}}}]).directive("nvFileDrop",["$parse","FileUploader",function(e,t){return{link:function(n,i,o){var r=n.$eval(o.uploader);if(!(r instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');if(r.isHTML5){var s=new t.FileDrop({uploader:r,element:i});s.getOptions=e(o.options).bind(s,n),s.getFilters=function(){return o.filters}}}}}]).directive("nvFileOver",["FileUploader",function(e){return{link:function(t,n,i){var o=t.$eval(i.uploader);if(!(o instanceof e))throw new TypeError('"Uploader" must be an instance of FileUploader');var r=new e.FileOver({uploader:o,element:n});r.getOverClass=function(){return i.overClass||this.overClass}}}}]),t}),angular.module("uz.mailto",[]).factory("Mailto",[function(){var e={};return e.url=function(e,t){var n="mailto:";n+=window.encodeURIComponent(e);var i=[];return angular.forEach(t,function(e,t){i.push(t.toLowerCase()+"="+window.encodeURIComponent(e))}),i.length>0&&(n+="?"+i.join("&")),n},e}]),angular.module("ui.bootstrap",["ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(e,t,n){function i(e){for(var t in e)if(void 0!==r.style[t])return e[t]}var o=function(i,r,s){s=s||{};var a=e.defer(),l=o[s.animation?"animationEndEventName":"transitionEndEventName"],c=function(){n.$apply(function(){i.unbind(l,c),a.resolve(i)})};return l&&i.bind(l,c),t(function(){angular.isString(r)?i.addClass(r):angular.isFunction(r)?r(i):angular.isObject(r)&&i.css(r),l||a.resolve(i)}),a.promise.cancel=function(){l&&i.unbind(l,c),a.reject("Transition cancelled")},a.promise},r=document.createElement("trans"),s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},a={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return o.transitionEndEventName=i(s),o.animationEndEventName=i(a),o}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(e){return{link:function(t,n,i){function o(t){function i(){c===o&&(c=void 0)}var o=e(n,t);return c&&c.cancel(),c=o,o.then(i,i),o}function r(){u?(u=!1,s()):(n.removeClass("collapse").addClass("collapsing"),o({height:n[0].scrollHeight+"px"}).then(s))}function s(){n.removeClass("collapsing"),n.addClass("collapse in"),n.css({height:"auto"})}function a(){u?(u=!1,l(),n.css({height:0})):(n.css({height:n[0].scrollHeight+"px"}),n[0].offsetWidth,n.removeClass("collapse in").addClass("collapsing"),o({height:0}).then(l))}function l(){n.removeClass("collapsing"),n.addClass("collapse")}var c,u=!0;t.$watch(i.collapse,function(e){e?a():r()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(e,t,n){this.groups=[],this.closeOthers=function(i){var o=angular.isDefined(t.closeOthers)?e.$eval(t.closeOthers):n.closeOthers;o&&angular.forEach(this.groups,function(e){e!==i&&(e.isOpen=!1)})},this.addGroup=function(e){var t=this;this.groups.push(e),e.$on("$destroy",function(){t.removeGroup(e)})},this.removeGroup=function(e){var t=this.groups.indexOf(e);-1!==t&&this.groups.splice(t,1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(e){this.heading=e}},link:function(e,t,n,i){i.addGroup(e),e.$watch("isOpen",function(t){t&&i.closeOthers(e)}),e.toggleOpen=function(){e.isDisabled||(e.isOpen=!e.isOpen)}}}}).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",link:function(e,t,n,i,o){i.setHeading(o(e,function(){}))}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(e,t,n,i){e.$watch(function(){return i[n.accordionTransclude]},function(e){e&&(t.html(""),t.append(e))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(e,t){e.closeable="close"in t}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(e,t,n){t.addClass("ng-binding").data("$binding",n.bindHtmlUnsafe),e.$watch(n.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(e){this.activeClass=e.activeClass||"active",this.toggleEvent=e.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(e,t,n,i){var o=i[0],r=i[1];r.$render=function(){t.toggleClass(o.activeClass,angular.equals(r.$modelValue,e.$eval(n.btnRadio)))},t.bind(o.toggleEvent,function(){var i=t.hasClass(o.activeClass);(!i||angular.isDefined(n.uncheckable))&&e.$apply(function(){r.$setViewValue(i?null:e.$eval(n.btnRadio)),r.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(e,t,n,i){function o(){return s(n.btnCheckboxTrue,!0)}function r(){return s(n.btnCheckboxFalse,!1)}function s(t,n){var i=e.$eval(t);return angular.isDefined(i)?i:n}var a=i[0],l=i[1];l.$render=function(){t.toggleClass(a.activeClass,angular.equals(l.$modelValue,o()))},t.bind(a.toggleEvent,function(){e.$apply(function(){l.$setViewValue(t.hasClass(a.activeClass)?r():o()),l.$render()})})}}}),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition",function(e,t,n){function i(){o();var n=+e.interval;!isNaN(n)&&n>=0&&(s=t(r,n))}function o(){s&&(t.cancel(s),s=null)}function r(){a?(e.next(),i()):e.pause()}var s,a,l=this,c=l.slides=e.slides=[],u=-1;l.currentSlide=null;var d=!1;l.select=e.select=function(o,r){function s(){d||(l.currentSlide&&angular.isString(r)&&!e.noTransition&&o.$element?(o.$element.addClass(r),o.$element[0].offsetWidth,angular.forEach(c,function(e){angular.extend(e,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(o,{direction:r,active:!0,entering:!0}),angular.extend(l.currentSlide||{},{direction:r,leaving:!0}),e.$currentTransition=n(o.$element,{}),function(t,n){e.$currentTransition.then(function(){a(t,n)},function(){a(t,n)})}(o,l.currentSlide)):a(o,l.currentSlide),l.currentSlide=o,u=h,i())}function a(t,n){angular.extend(t,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(n||{},{direction:"",active:!1,leaving:!1,entering:!1}),e.$currentTransition=null}var h=c.indexOf(o);void 0===r&&(r=h>u?"next":"prev"),o&&o!==l.currentSlide&&(e.$currentTransition?(e.$currentTransition.cancel(),t(s)):s())},e.$on("$destroy",function(){d=!0}),l.indexOfSlide=function(e){return c.indexOf(e)},e.next=function(){var t=(u+1)%c.length;return e.$currentTransition?void 0:l.select(c[t],"next")},e.prev=function(){var t=0>u-1?c.length-1:u-1;return e.$currentTransition?void 0:l.select(c[t],"prev")},e.isActive=function(e){return l.currentSlide===e},e.$watch("interval",i),e.$on("$destroy",o),e.play=function(){a||(a=!0,i())},e.pause=function(){e.noPause||(a=!1,o())},l.addSlide=function(t,n){t.$element=n,c.push(t),1===c.length||t.active?(l.select(c[c.length-1]),1==c.length&&e.play()):t.active=!1},l.removeSlide=function(e){var t=c.indexOf(e);c.splice(t,1),c.length>0&&e.active?l.select(t>=c.length?c[t-1]:c[t]):u>t&&u--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"=?"},link:function(e,t,n,i){i.addSlide(e,t),e.$on("$destroy",function(){i.removeSlide(e)}),e.$watch("active",function(t){t&&i.select(e)})}}}),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function(e,t){function n(e){var n=[],i=e.split("");return angular.forEach(o,function(t,o){var r=e.indexOf(o);if(r>-1){e=e.split(""),i[r]="("+t.regex+")",e[r]="$";for(var s=r+1,a=r+o.length;a>s;s++)i[s]="",e[s]="$";e=e.join(""),n.push({index:r,apply:t.apply})}}),{regex:new RegExp("^"+i.join("")+"$"),map:t(n,"index")}}function i(e,t,n){return 1===t&&n>28?29===n&&(e%4===0&&e%100!==0||e%400===0):3===t||5===t||8===t||10===t?31>n:!0}this.parsers={};var o={yyyy:{regex:"\\d{4}",apply:function(e){this.year=+e}},yy:{regex:"\\d{2}",apply:function(e){this.year=+e+2e3}},y:{regex:"\\d{1,4}",apply:function(e){this.year=+e}},MMMM:{regex:e.DATETIME_FORMATS.MONTH.join("|"),apply:function(t){this.month=e.DATETIME_FORMATS.MONTH.indexOf(t)}},MMM:{regex:e.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(t){this.month=e.DATETIME_FORMATS.SHORTMONTH.indexOf(t)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(e){this.month=e-1}},M:{regex:"[1-9]|1[0-2]",apply:function(e){this.month=e-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e}},EEEE:{regex:e.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:e.DATETIME_FORMATS.SHORTDAY.join("|")}};this.parse=function(t,o){if(!angular.isString(t)||!o)return t;o=e.DATETIME_FORMATS[o]||o,this.parsers[o]||(this.parsers[o]=n(o));var r=this.parsers[o],s=r.regex,a=r.map,l=t.match(s);if(l&&l.length){for(var c,u={year:1900,month:0,date:1,hours:0},d=1,h=l.length;h>d;d++){var p=a[d-1];p.apply&&p.apply.call(u,l[d])}return i(u.year,u.month,u.date)&&(c=new Date(u.year,u.month,u.date,u.hours)),c}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function i(e){return"static"===(n(e,"position")||"static")}var o=function(t){for(var n=e[0],o=t.offsetParent||n;o&&o!==n&&i(o);)o=o.offsetParent;return o||n};return{position:function(t){var n=this.offset(t),i={top:0,left:0},r=o(t[0]);r!=e[0]&&(i=this.offset(angular.element(r)),i.top+=r.clientTop-r.scrollTop,i.left+=r.clientLeft-r.scrollLeft);var s=t[0].getBoundingClientRect();return{width:s.width||t.prop("offsetWidth"),height:s.height||t.prop("offsetHeight"),top:n.top-i.top,left:n.left-i.left}},offset:function(n){var i=n[0].getBoundingClientRect();return{width:i.width||n.prop("offsetWidth"),height:i.height||n.prop("offsetHeight"),top:i.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:i.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}},positionElements:function(e,t,n,i){var o,r,s,a,l=n.split("-"),c=l[0],u=l[1]||"center";o=i?this.offset(e):this.position(e),r=t.prop("offsetWidth"),s=t.prop("offsetHeight");var d={center:function(){return o.left+o.width/2-r/2},left:function(){return o.left},right:function(){return o.left+o.width}},h={center:function(){return o.top+o.height/2-s/2},top:function(){return o.top},bottom:function(){return o.top+o.height}};switch(c){case"right":a={top:h[u](),left:d[c]()};break;case"left":a={top:h[u](),left:o.left-r};break;case"bottom":a={top:h[c](),left:d[u]()};break;default:a={top:o.top-s,left:d[u]()}}return a}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function(e,t,n,i,o,r,s,a){var l=this,c={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange"],function(n,o){l[n]=angular.isDefined(t[n])?8>o?i(t[n])(e.$parent):e.$parent.$eval(t[n]):a[n]}),angular.forEach(["minDate","maxDate"],function(i){t[i]?e.$parent.$watch(n(t[i]),function(e){l[i]=e?new Date(e):null,l.refreshView()}):l[i]=a[i]?new Date(a[i]):null}),e.datepickerMode=e.datepickerMode||a.datepickerMode,e.uniqueId="datepicker-"+e.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined(t.initDate)?e.$parent.$eval(t.initDate):new Date,e.isActive=function(t){return 0===l.compare(t.date,l.activeDate)?(e.activeDateId=t.uid,!0):!1},this.init=function(e){c=e,c.$render=function(){l.render()}},this.render=function(){if(c.$modelValue){var e=new Date(c.$modelValue),t=!isNaN(e);t?this.activeDate=e:r.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),c.$setValidity("date",t)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var e=c.$modelValue?new Date(c.$modelValue):null;c.$setValidity("date-disabled",!e||this.element&&!this.isDisabled(e))}},this.createDateObject=function(e,t){var n=c.$modelValue?new Date(c.$modelValue):null;return{date:e,label:s(e,t),selected:n&&0===this.compare(e,n),disabled:this.isDisabled(e),current:0===this.compare(e,new Date)}},this.isDisabled=function(n){return this.minDate&&this.compare(n,this.minDate)<0||this.maxDate&&this.compare(n,this.maxDate)>0||t.dateDisabled&&e.dateDisabled({date:n,mode:e.datepickerMode})},this.split=function(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n},e.select=function(t){if(e.datepickerMode===l.minMode){var n=c.$modelValue?new Date(c.$modelValue):new Date(0,0,0,0,0,0,0);n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),c.$setViewValue(n),c.$render()}else l.activeDate=t,e.datepickerMode=l.modes[l.modes.indexOf(e.datepickerMode)-1]},e.move=function(e){var t=l.activeDate.getFullYear()+e*(l.step.years||0),n=l.activeDate.getMonth()+e*(l.step.months||0);l.activeDate.setFullYear(t,n,1),l.refreshView()},e.toggleMode=function(t){t=t||1,e.datepickerMode===l.maxMode&&1===t||e.datepickerMode===l.minMode&&-1===t||(e.datepickerMode=l.modes[l.modes.indexOf(e.datepickerMode)+t])},e.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var u=function(){o(function(){l.element[0].focus()},0,!1)};e.$on("datepicker.focus",u),e.keydown=function(t){var n=e.keys[t.which];if(n&&!t.shiftKey&&!t.altKey)if(t.preventDefault(),t.stopPropagation(),"enter"===n||"space"===n){if(l.isDisabled(l.activeDate))return;e.select(l.activeDate),u()}else!t.ctrlKey||"up"!==n&&"down"!==n?(l.handleKeyDown(n,t),l.refreshView()):(e.toggleMode("up"===n?1:-1),u())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r)}}}).directive("daypicker",["dateFilter",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(t,n,i,o){function r(e,t){return 1!==t||e%4!==0||e%100===0&&e%400!==0?l[t]:29}function s(e,t){var n=new Array(t),i=new Date(e),o=0;for(i.setHours(12);t>o;)n[o++]=new Date(i),i.setDate(i.getDate()+1);return n}function a(e){var t=new Date(e);t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1}t.showWeeks=o.showWeeks,o.step={months:1},o.element=n;var l=[31,28,31,30,31,30,31,31,30,31,30,31];o._refreshView=function(){var n=o.activeDate.getFullYear(),i=o.activeDate.getMonth(),r=new Date(n,i,1),l=o.startingDay-r.getDay(),c=l>0?7-l:-l,u=new Date(r);c>0&&u.setDate(-c+1);for(var d=s(u,42),h=0;42>h;h++)d[h]=angular.extend(o.createDateObject(d[h],o.formatDay),{secondary:d[h].getMonth()!==i,uid:t.uniqueId+"-"+h});t.labels=new Array(7);for(var p=0;7>p;p++)t.labels[p]={abbr:e(d[p].date,o.formatDayHeader),full:e(d[p].date,"EEEE")};if(t.title=e(o.activeDate,o.formatDayTitle),t.rows=o.split(d,7),t.showWeeks){t.weekNumbers=[];for(var f=a(t.rows[0][0].date),g=t.rows.length;t.weekNumbers.push(f++)<g;);}},o.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},o.handleKeyDown=function(e){var t=o.activeDate.getDate();if("left"===e)t-=1;else if("up"===e)t-=7;else if("right"===e)t+=1;else if("down"===e)t+=7;else if("pageup"===e||"pagedown"===e){var n=o.activeDate.getMonth()+("pageup"===e?-1:1);o.activeDate.setMonth(n,1),t=Math.min(r(o.activeDate.getFullYear(),o.activeDate.getMonth()),t)}else"home"===e?t=1:"end"===e&&(t=r(o.activeDate.getFullYear(),o.activeDate.getMonth()));o.activeDate.setDate(t)},o.refreshView()}}}]).directive("monthpicker",["dateFilter",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/month.html",require:"^datepicker",link:function(t,n,i,o){o.step={years:1},o.element=n,o._refreshView=function(){for(var n=new Array(12),i=o.activeDate.getFullYear(),r=0;12>r;r++)n[r]=angular.extend(o.createDateObject(new Date(i,r,1),o.formatMonth),{uid:t.uniqueId+"-"+r});t.title=e(o.activeDate,o.formatMonthTitle),t.rows=o.split(n,3)},o.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth())-new Date(t.getFullYear(),t.getMonth())},o.handleKeyDown=function(e){var t=o.activeDate.getMonth();if("left"===e)t-=1;else if("up"===e)t-=3;else if("right"===e)t+=1;else if("down"===e)t+=3;else if("pageup"===e||"pagedown"===e){var n=o.activeDate.getFullYear()+("pageup"===e?-1:1);o.activeDate.setFullYear(n)}else"home"===e?t=0:"end"===e&&(t=11);

o.activeDate.setMonth(t)},o.refreshView()}}}]).directive("yearpicker",["dateFilter",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/year.html",require:"^datepicker",link:function(e,t,n,i){function o(e){return parseInt((e-1)/r,10)*r+1}var r=i.yearRange;i.step={years:r},i.element=t,i._refreshView=function(){for(var t=new Array(r),n=0,s=o(i.activeDate.getFullYear());r>n;n++)t[n]=angular.extend(i.createDateObject(new Date(s+n,0,1),i.formatYear),{uid:e.uniqueId+"-"+n});e.title=[t[0].label,t[r-1].label].join(" - "),e.rows=i.split(t,5)},i.compare=function(e,t){return e.getFullYear()-t.getFullYear()},i.handleKeyDown=function(e){var t=i.activeDate.getFullYear();"left"===e?t-=1:"up"===e?t-=5:"right"===e?t+=1:"down"===e?t+=5:"pageup"===e||"pagedown"===e?t+=("pageup"===e?-1:1)*i.step.years:"home"===e?t=o(i.activeDate.getFullYear()):"end"===e&&(t=o(i.activeDate.getFullYear())+r-1),i.activeDate.setFullYear(t)},i.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function(e,t,n,i,o,r,s){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&"},link:function(a,l,c,u){function d(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function h(e){if(e){if(angular.isDate(e)&&!isNaN(e))return u.$setValidity("date",!0),e;if(angular.isString(e)){var t=r.parse(e,p)||new Date(e);return isNaN(t)?void u.$setValidity("date",!1):(u.$setValidity("date",!0),t)}return void u.$setValidity("date",!1)}return u.$setValidity("date",!0),null}var p,f=angular.isDefined(c.closeOnDateSelection)?a.$parent.$eval(c.closeOnDateSelection):s.closeOnDateSelection,g=angular.isDefined(c.datepickerAppendToBody)?a.$parent.$eval(c.datepickerAppendToBody):s.appendToBody;a.showButtonBar=angular.isDefined(c.showButtonBar)?a.$parent.$eval(c.showButtonBar):s.showButtonBar,a.getText=function(e){return a[e+"Text"]||s[e+"Text"]},c.$observe("datepickerPopup",function(e){p=e||s.datepickerPopup,u.$render()});var m=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");m.attr({"ng-model":"date","ng-change":"dateSelection()"});var v=angular.element(m.children()[0]);c.datepickerOptions&&angular.forEach(a.$parent.$eval(c.datepickerOptions),function(e,t){v.attr(d(t),e)}),a.watchData={},angular.forEach(["minDate","maxDate","datepickerMode"],function(e){if(c[e]){var n=t(c[e]);if(a.$parent.$watch(n,function(t){a.watchData[e]=t}),v.attr(d(e),"watchData."+e),"datepickerMode"===e){var i=n.assign;a.$watch("watchData."+e,function(e,t){e!==t&&i(a.$parent,e)})}}}),c.dateDisabled&&v.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),u.$parsers.unshift(h),a.dateSelection=function(e){angular.isDefined(e)&&(a.date=e),u.$setViewValue(a.date),u.$render(),f&&(a.isOpen=!1,l[0].focus())},l.bind("input change keyup",function(){a.$apply(function(){a.date=u.$modelValue})}),u.$render=function(){var e=u.$viewValue?o(u.$viewValue,p):"";l.val(e),a.date=h(u.$modelValue)};var b=function(e){a.isOpen&&e.target!==l[0]&&a.$apply(function(){a.isOpen=!1})},y=function(e){a.keydown(e)};l.bind("keydown",y),a.keydown=function(e){27===e.which?(e.preventDefault(),e.stopPropagation(),a.close()):40!==e.which||a.isOpen||(a.isOpen=!0)},a.$watch("isOpen",function(e){e?(a.$broadcast("datepicker.focus"),a.position=g?i.offset(l):i.position(l),a.position.top=a.position.top+l.prop("offsetHeight"),n.bind("click",b)):n.unbind("click",b)}),a.select=function(e){if("today"===e){var t=new Date;angular.isDate(u.$modelValue)?(e=new Date(u.$modelValue),e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate())):e=new Date(t.setHours(0,0,0,0))}a.dateSelection(e)},a.close=function(){a.isOpen=!1,l[0].focus()};var w=e(m)(a);m.remove(),g?n.find("body").append(w):l.after(w),a.$on("$destroy",function(){w.remove(),l.unbind("keydown",y),n.unbind("click",b)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(e,t){t.bind("click",function(e){e.preventDefault(),e.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdown",[]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(e){var t=null;this.open=function(o){t||(e.bind("click",n),e.bind("keydown",i)),t&&t!==o&&(t.isOpen=!1),t=o},this.close=function(o){t===o&&(t=null,e.unbind("click",n),e.unbind("keydown",i))};var n=function(e){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})},i=function(e){27===e.which&&(t.focusToggleElement(),n())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(e,t,n,i,o,r){var s,a=this,l=e.$new(),c=i.openClass,u=angular.noop,d=t.onToggle?n(t.onToggle):angular.noop;this.init=function(i){a.$element=i,t.isOpen&&(s=n(t.isOpen),u=s.assign,e.$watch(s,function(e){l.isOpen=!!e}))},this.toggle=function(e){return l.isOpen=arguments.length?!!e:!l.isOpen},this.isOpen=function(){return l.isOpen},l.getToggleElement=function(){return a.toggleElement},l.focusToggleElement=function(){a.toggleElement&&a.toggleElement[0].focus()},l.$watch("isOpen",function(t,n){r[t?"addClass":"removeClass"](a.$element,c),t?(l.focusToggleElement(),o.open(l)):o.close(l),u(e,t),angular.isDefined(t)&&t!==n&&d(e,{open:!!t})}),e.$on("$locationChangeSuccess",function(){l.isOpen=!1}),e.$on("$destroy",function(){l.$destroy()})}]).directive("dropdown",function(){return{restrict:"CA",controller:"DropdownController",link:function(e,t,n,i){i.init(t)}}}).directive("dropdownToggle",function(){return{restrict:"CA",require:"?^dropdown",link:function(e,t,n,i){if(i){i.toggleElement=t;var o=function(o){o.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){i.toggle()})};t.bind("click",o),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(i.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",o)})}}}}),angular.module("ui.bootstrap.modal",["ui.bootstrap.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,n){e.push({key:t,value:n})},get:function(t){for(var n=0;n<e.length;n++)if(t==e[n].key)return e[n]},keys:function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var n=-1,i=0;i<e.length;i++)if(t==e[i].key){n=i;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalBackdrop",["$timeout",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(t,n,i){t.backdropClass=i.backdropClass||"",t.animate=!1,e(function(){t.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(e,t){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(e,t){return t.templateUrl||"template/modal/window.html"},link:function(n,i,o){i.addClass(o.windowClass||""),n.size=o.size,t(function(){n.animate=!0,i[0].querySelectorAll("[autofocus]").length||i[0].focus()}),n.close=function(t){var n=e.getTop();n&&n.value.backdrop&&"static"!=n.value.backdrop&&t.target===t.currentTarget&&(t.preventDefault(),t.stopPropagation(),e.dismiss(n.key,"backdrop click"))}}}}]).directive("modalTransclude",function(){return{link:function(e,t,n,i,o){o(e.$parent,function(e){t.empty(),t.append(e)})}}}).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,t,n,i,o,r){function s(){for(var e=-1,t=p.keys(),n=0;n<t.length;n++)p.get(t[n]).value.backdrop&&(e=n);return e}function a(e){var t=n.find("body").eq(0),i=p.get(e).value;p.remove(e),c(i.modalDomEl,i.modalScope,300,function(){i.modalScope.$destroy(),t.toggleClass(h,p.length()>0),l()})}function l(){if(u&&-1==s()){var e=d;c(u,d,150,function(){e.$destroy(),e=null}),u=void 0,d=void 0}}function c(n,i,o,r){function s(){s.done||(s.done=!0,n.remove(),r&&r())}i.animate=!1;var a=e.transitionEndEventName;if(a){var l=t(s,o);n.bind(a,function(){t.cancel(l),s(),i.$apply()})}else t(s)}var u,d,h="modal-open",p=r.createNew(),f={};return o.$watch(s,function(e){d&&(d.index=e)}),n.bind("keydown",function(e){var t;27===e.which&&(t=p.top(),t&&t.value.keyboard&&(e.preventDefault(),o.$apply(function(){f.dismiss(t.key,"escape key press")})))}),f.open=function(e,t){p.add(e,{deferred:t.deferred,modalScope:t.scope,backdrop:t.backdrop,keyboard:t.keyboard});var r=n.find("body").eq(0),a=s();if(a>=0&&!u){d=o.$new(!0),d.index=a;var l=angular.element("<div modal-backdrop></div>");l.attr("backdrop-class",t.backdropClass),u=i(l)(d),r.append(u)}var c=angular.element("<div modal-window></div>");c.attr({"template-url":t.windowTemplateUrl,"window-class":t.windowClass,size:t.size,index:p.length()-1,animate:"animate"}).html(t.content);var f=i(c)(t.scope);p.top().value.modalDomEl=f,r.append(f),r.addClass(h)},f.close=function(e,t){var n=p.get(e);n&&(n.value.deferred.resolve(t),a(e))},f.dismiss=function(e,t){var n=p.get(e);n&&(n.value.deferred.reject(t),a(e))},f.dismissAll=function(e){for(var t=this.getTop();t;)this.dismiss(t.key,e),t=this.getTop()},f.getTop=function(){return p.top()},f}]).provider("$modal",function(){var e={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,n,i,o,r,s,a){function l(e){return e.template?i.when(e.template):o.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:r}).then(function(e){return e.data})}function c(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(i.when(t.invoke(e)))}),n}var u={};return u.open=function(t){var o=i.defer(),r=i.defer(),u={result:o.promise,opened:r.promise,close:function(e){a.close(u,e)},dismiss:function(e){a.dismiss(u,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var d=i.all([l(t)].concat(c(t.resolve)));return d.then(function(e){var i=(t.scope||n).$new();i.$close=u.close,i.$dismiss=u.dismiss;var r,l={},c=1;t.controller&&(l.$scope=i,l.$modalInstance=u,angular.forEach(t.resolve,function(t,n){l[n]=e[c++]}),r=s(t.controller,l),t.controllerAs&&(i[t.controllerAs]=r)),a.open(u,{scope:i,deferred:o,content:e[0],backdrop:t.backdrop,keyboard:t.keyboard,backdropClass:t.backdropClass,windowClass:t.windowClass,windowTemplateUrl:t.windowTemplateUrl,size:t.size})},function(e){o.reject(e)}),d.then(function(){r.resolve(!0)},function(){r.reject(!1)}),u},u}]};return e}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse",function(e,t,n){var i=this,o={$setViewValue:angular.noop},r=t.numPages?n(t.numPages).assign:angular.noop;this.init=function(r,s){o=r,this.config=s,o.$render=function(){i.render()},t.itemsPerPage?e.$parent.$watch(n(t.itemsPerPage),function(t){i.itemsPerPage=parseInt(t,10),e.totalPages=i.calculateTotalPages()}):this.itemsPerPage=s.itemsPerPage},this.calculateTotalPages=function(){var t=this.itemsPerPage<1?1:Math.ceil(e.totalItems/this.itemsPerPage);return Math.max(t||0,1)},this.render=function(){e.page=parseInt(o.$viewValue,10)||1},e.selectPage=function(t){e.page!==t&&t>0&&t<=e.totalPages&&(o.$setViewValue(t),o.$render())},e.getText=function(t){return e[t+"Text"]||i.config[t+"Text"]},e.noPrevious=function(){return 1===e.page},e.noNext=function(){return e.page===e.totalPages},e.$watch("totalItems",function(){e.totalPages=i.calculateTotalPages()}),e.$watch("totalPages",function(t){r(e.$parent,t),e.page>t?e.selectPage(t):o.$render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(e,t){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(n,i,o,r){function s(e,t,n){return{number:e,text:t,active:n}}function a(e,t){var n=[],i=1,o=t,r=angular.isDefined(u)&&t>u;r&&(d?(i=Math.max(e-Math.floor(u/2),1),o=i+u-1,o>t&&(o=t,i=o-u+1)):(i=(Math.ceil(e/u)-1)*u+1,o=Math.min(i+u-1,t)));for(var a=i;o>=a;a++){var l=s(a,a,a===e);n.push(l)}if(r&&!d){if(i>1){var c=s(i-1,"...",!1);n.unshift(c)}if(t>o){var h=s(o+1,"...",!1);n.push(h)}}return n}var l=r[0],c=r[1];if(c){var u=angular.isDefined(o.maxSize)?n.$parent.$eval(o.maxSize):t.maxSize,d=angular.isDefined(o.rotate)?n.$parent.$eval(o.rotate):t.rotate;n.boundaryLinks=angular.isDefined(o.boundaryLinks)?n.$parent.$eval(o.boundaryLinks):t.boundaryLinks,n.directionLinks=angular.isDefined(o.directionLinks)?n.$parent.$eval(o.directionLinks):t.directionLinks,l.init(c,t),o.maxSize&&n.$parent.$watch(e(o.maxSize),function(e){u=parseInt(e,10),l.render()});var h=l.render;l.render=function(){h(),n.page>0&&n.page<=n.totalPages&&(n.pages=a(n.page,n.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(e){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(t,n,i,o){var r=o[0],s=o[1];s&&(t.align=angular.isDefined(i.align)?t.$parent.$eval(i.align):e.align,r.init(s,e))}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function e(e){var t=/[A-Z]/g,n="-";return e.replace(t,function(e,t){return(t?n:"")+e.toLowerCase()})}var t={placement:"top",animation:!0,popupDelay:0},n={mouseenter:"mouseleave",click:"click",focus:"blur"},i={};this.options=function(e){angular.extend(i,e)},this.setTriggers=function(e){angular.extend(n,e)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(o,r,s,a,l,c,u){return function(o,d,h){function p(e){var t=e||f.trigger||h,i=n[t]||t;return{show:t,hide:i}}var f=angular.extend({},t,i),g=e(o),m=u.startSymbol(),v=u.endSymbol(),b="<div "+g+'-popup title="'+m+"tt_title"+v+'" content="'+m+"tt_content"+v+'" placement="'+m+"tt_placement"+v+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var e=r(b);return function(t,n,i){function r(){t.tt_isOpen?h():u()}function u(){(!S||t.$eval(i[d+"Enable"]))&&(t.tt_popupDelay?C||(C=s(g,t.tt_popupDelay,!1),C.then(function(e){e()})):g()())}function h(){t.$apply(function(){m()})}function g(){return C=null,w&&(s.cancel(w),w=null),t.tt_content?(v(),y.css({top:0,left:0,display:"block"}),_?l.find("body").append(y):n.after(y),k(),t.tt_isOpen=!0,t.$digest(),k):angular.noop}function m(){t.tt_isOpen=!1,s.cancel(C),C=null,t.tt_animation?w||(w=s(b,500)):b()}function v(){y&&b(),y=e(t,function(){}),t.$digest()}function b(){w=null,y&&(y.remove(),y=null)}var y,w,C,_=angular.isDefined(f.appendToBody)?f.appendToBody:!1,x=p(void 0),S=angular.isDefined(i[d+"Enable"]),k=function(){var e=c.positionElements(n,y,t.tt_placement,_);e.top+="px",e.left+="px",y.css(e)};t.tt_isOpen=!1,i.$observe(o,function(e){t.tt_content=e,!e&&t.tt_isOpen&&m()}),i.$observe(d+"Title",function(e){t.tt_title=e}),i.$observe(d+"Placement",function(e){t.tt_placement=angular.isDefined(e)?e:f.placement}),i.$observe(d+"PopupDelay",function(e){var n=parseInt(e,10);t.tt_popupDelay=isNaN(n)?f.popupDelay:n});var T=function(){n.unbind(x.show,u),n.unbind(x.hide,h)};i.$observe(d+"Trigger",function(e){T(),x=p(e),x.show===x.hide?n.bind(x.show,r):(n.bind(x.show,u),n.bind(x.hide,h))});var $=t.$eval(i[d+"Animation"]);t.tt_animation=angular.isDefined($)?!!$:f.animation,i.$observe(d+"AppendToBody",function(e){_=angular.isDefined(e)?a(e)(t):_}),_&&t.$on("$locationChangeSuccess",function(){t.tt_isOpen&&m()}),t.$on("$destroy",function(){s.cancel(w),s.cancel(C),T(),b()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(e){return e("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(e){return e("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function(e){return e("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",[]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig",function(e,t,n){var i=this,o=angular.isDefined(t.animate)?e.$parent.$eval(t.animate):n.animate;this.bars=[],e.max=angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max,this.addBar=function(t,n){o||n.css({transition:"none"}),this.bars.push(t),t.$watch("value",function(n){t.percent=+(100*n/e.max).toFixed(2)}),t.$on("$destroy",function(){n=null,i.removeBar(t)})},this.removeBar=function(e){this.bars.splice(this.bars.indexOf(e),1)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},templateUrl:"template/progressbar/progress.html"}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(e,t,n,i){i.addBar(e,t)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(e,t,n,i){i.addBar(e,angular.element(t.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","ratingConfig",function(e,t,n){var i={$setViewValue:angular.noop};this.init=function(o){i=o,i.$render=this.render,this.stateOn=angular.isDefined(t.stateOn)?e.$parent.$eval(t.stateOn):n.stateOn,this.stateOff=angular.isDefined(t.stateOff)?e.$parent.$eval(t.stateOff):n.stateOff;var r=angular.isDefined(t.ratingStates)?e.$parent.$eval(t.ratingStates):new Array(angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max);e.range=this.buildTemplateObjects(r)},this.buildTemplateObjects=function(e){for(var t=0,n=e.length;n>t;t++)e[t]=angular.extend({index:t},{stateOn:this.stateOn,stateOff:this.stateOff},e[t]);return e},e.rate=function(t){!e.readonly&&t>=0&&t<=e.range.length&&(i.$setViewValue(t),i.$render())},e.enter=function(t){e.readonly||(e.value=t),e.onHover({value:t})},e.reset=function(){e.value=i.$viewValue,e.onLeave()},e.onKeydown=function(t){/(37|38|39|40)/.test(t.which)&&(t.preventDefault(),t.stopPropagation(),e.rate(e.value+(38===t.which||39===t.which?1:-1)))},this.render=function(){e.value=i.$viewValue}}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0,link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r)}}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function(e){var t=this,n=t.tabs=e.tabs=[];t.select=function(e){angular.forEach(n,function(t){t.active&&t!==e&&(t.active=!1,t.onDeselect())}),e.active=!0,e.onSelect()},t.addTab=function(e){n.push(e),1===n.length?e.active=!0:e.active&&t.select(e)},t.removeTab=function(e){var i=n.indexOf(e);if(e.active&&n.length>1){var o=i==n.length-1?i-1:i+1;t.select(n[o])}n.splice(i,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(e,t,n){e.vertical=angular.isDefined(n.vertical)?e.$parent.$eval(n.vertical):!1,e.justified=angular.isDefined(n.justified)?e.$parent.$eval(n.justified):!1}}}).directive("tab",["$parse",function(e){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(t,n,i){return function(t,n,o,r){t.$watch("active",function(e){e&&r.select(t)}),t.disabled=!1,o.disabled&&t.$parent.$watch(e(o.disabled),function(e){t.disabled=!!e}),t.select=function(){t.disabled||(t.active=!0)},r.addTab(t),t.$on("$destroy",function(){r.removeTab(t)}),t.$transcludeFn=i}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(e,t){e.$watch("headingElement",function(e){e&&(t.html(""),t.append(e))})}}}]).directive("tabContentTransclude",function(){function e(e){return e.tagName&&(e.hasAttribute("tab-heading")||e.hasAttribute("data-tab-heading")||"tab-heading"===e.tagName.toLowerCase()||"data-tab-heading"===e.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(t,n,i){var o=t.$eval(i.tabContentTransclude);o.$transcludeFn(o.$parent,function(t){angular.forEach(t,function(t){e(t)?o.headingElement=t:n.append(t)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function(e,t,n,i,o,r){function s(){var t=parseInt(e.hours,10),n=e.showMeridian?t>0&&13>t:t>=0&&24>t;return n?(e.showMeridian&&(12===t&&(t=0),e.meridian===g[1]&&(t+=12)),t):void 0}function a(){var t=parseInt(e.minutes,10);return t>=0&&60>t?t:void 0}function l(e){return angular.isDefined(e)&&e.toString().length<2?"0"+e:e}function c(e){u(),f.$setViewValue(new Date(p)),d(e)}function u(){f.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function d(t){var n=p.getHours(),i=p.getMinutes();e.showMeridian&&(n=0===n||12===n?12:n%12),e.hours="h"===t?n:l(n),e.minutes="m"===t?i:l(i),e.meridian=p.getHours()<12?g[0]:g[1]}function h(e){var t=new Date(p.getTime()+6e4*e);p.setHours(t.getHours(),t.getMinutes()),c()}var p=new Date,f={$setViewValue:angular.noop},g=angular.isDefined(t.meridians)?e.$parent.$eval(t.meridians):r.meridians||o.DATETIME_FORMATS.AMPMS;this.init=function(n,i){f=n,f.$render=this.render;var o=i.eq(0),s=i.eq(1),a=angular.isDefined(t.mousewheel)?e.$parent.$eval(t.mousewheel):r.mousewheel;a&&this.setupMousewheelEvents(o,s),e.readonlyInput=angular.isDefined(t.readonlyInput)?e.$parent.$eval(t.readonlyInput):r.readonlyInput,this.setupInputEvents(o,s)};var m=r.hourStep;t.hourStep&&e.$parent.$watch(n(t.hourStep),function(e){m=parseInt(e,10)});var v=r.minuteStep;t.minuteStep&&e.$parent.$watch(n(t.minuteStep),function(e){v=parseInt(e,10)}),e.showMeridian=r.showMeridian,t.showMeridian&&e.$parent.$watch(n(t.showMeridian),function(t){if(e.showMeridian=!!t,f.$error.time){var n=s(),i=a();angular.isDefined(n)&&angular.isDefined(i)&&(p.setHours(n),c())}else d()}),this.setupMousewheelEvents=function(t,n){var i=function(e){e.originalEvent&&(e=e.originalEvent);var t=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||t>0};t.bind("mousewheel wheel",function(t){e.$apply(i(t)?e.incrementHours():e.decrementHours()),t.preventDefault()}),n.bind("mousewheel wheel",function(t){e.$apply(i(t)?e.incrementMinutes():e.decrementMinutes()),t.preventDefault()})},this.setupInputEvents=function(t,n){if(e.readonlyInput)return e.updateHours=angular.noop,void(e.updateMinutes=angular.noop);var i=function(t,n){f.$setViewValue(null),f.$setValidity("time",!1),angular.isDefined(t)&&(e.invalidHours=t),angular.isDefined(n)&&(e.invalidMinutes=n)};e.updateHours=function(){var e=s();angular.isDefined(e)?(p.setHours(e),c("h")):i(!0)},t.bind("blur",function(){!e.invalidHours&&e.hours<10&&e.$apply(function(){e.hours=l(e.hours)})}),e.updateMinutes=function(){var e=a();angular.isDefined(e)?(p.setMinutes(e),c("m")):i(void 0,!0)},n.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=l(e.minutes)})})},this.render=function(){var e=f.$modelValue?new Date(f.$modelValue):null;isNaN(e)?(f.$setValidity("time",!1),i.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(e&&(p=e),u(),d())},e.incrementHours=function(){h(60*m)},e.decrementHours=function(){h(60*-m)},e.incrementMinutes=function(){h(v)},e.decrementMinutes=function(){h(-v)},e.toggleMeridian=function(){h(720*(p.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r,t.find("input"))}}}),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(n){var i=n.match(t);if(!i)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+n+'".');return{itemName:i[3],source:e(i[4]),viewMapper:e(i[2]||i[1]),modelMapper:e(i[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,t,n,i,o,r,s){var a=[9,13,27,38,40];return{require:"ngModel",link:function(l,c,u,d){var h,p=l.$eval(u.typeaheadMinLength)||1,f=l.$eval(u.typeaheadWaitMs)||0,g=l.$eval(u.typeaheadEditable)!==!1,m=t(u.typeaheadLoading).assign||angular.noop,v=t(u.typeaheadOnSelect),b=u.typeaheadInputFormatter?t(u.typeaheadInputFormatter):void 0,y=u.typeaheadAppendToBody?l.$eval(u.typeaheadAppendToBody):!1,w=t(u.ngModel).assign,C=s.parse(u.typeahead),_=l.$new();l.$on("$destroy",function(){_.$destroy()});var x="typeahead-"+_.$id+"-"+Math.floor(1e4*Math.random());c.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":x});var S=angular.element("<div typeahead-popup></div>");S.attr({id:x,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(u.typeaheadTemplateUrl)&&S.attr("template-url",u.typeaheadTemplateUrl);var k=function(){_.matches=[],_.activeIdx=-1,c.attr("aria-expanded",!1)},T=function(e){return x+"-option-"+e};_.$watch("activeIdx",function(e){0>e?c.removeAttr("aria-activedescendant"):c.attr("aria-activedescendant",T(e))});var $=function(e){var t={$viewValue:e};m(l,!0),n.when(C.source(l,t)).then(function(n){var i=e===d.$viewValue;if(i&&h)if(n.length>0){_.activeIdx=0,_.matches.length=0;for(var o=0;o<n.length;o++)t[C.itemName]=n[o],_.matches.push({id:T(o),label:C.viewMapper(_,t),model:n[o]});_.query=e,_.position=y?r.offset(c):r.position(c),_.position.top=_.position.top+c.prop("offsetHeight"),c.attr("aria-expanded",!0)}else k();i&&m(l,!1)},function(){k(),m(l,!1)})};k(),_.query=void 0;var E,D=function(e){E=i(function(){$(e)},f)},I=function(){E&&i.cancel(E)};d.$parsers.unshift(function(e){return h=!0,e&&e.length>=p?f>0?(I(),D(e)):$(e):(m(l,!1),I(),k()),g?e:e?void d.$setValidity("editable",!1):(d.$setValidity("editable",!0),e)}),d.$formatters.push(function(e){var t,n,i={};return b?(i.$model=e,b(l,i)):(i[C.itemName]=e,t=C.viewMapper(l,i),i[C.itemName]=void 0,n=C.viewMapper(l,i),t!==n?t:e)}),_.select=function(e){var t,n,o={};o[C.itemName]=n=_.matches[e].model,t=C.modelMapper(l,o),w(l,t),d.$setValidity("editable",!0),v(l,{$item:n,$model:t,$label:C.viewMapper(l,o)}),k(),i(function(){c[0].focus()},0,!1)},c.bind("keydown",function(e){0!==_.matches.length&&-1!==a.indexOf(e.which)&&(e.preventDefault(),40===e.which?(_.activeIdx=(_.activeIdx+1)%_.matches.length,_.$digest()):38===e.which?(_.activeIdx=(_.activeIdx?_.activeIdx:_.matches.length)-1,_.$digest()):13===e.which||9===e.which?_.$apply(function(){_.select(_.activeIdx)}):27===e.which&&(e.stopPropagation(),k(),_.$digest()))}),c.bind("blur",function(){h=!1});var M=function(e){c[0]!==e.target&&(k(),_.$digest())};o.bind("click",M),l.$on("$destroy",function(){o.unbind("click",M)});var A=e(S)(_);y?o.find("body").append(A):c.after(A)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(e,t,n){e.templateUrl=n.templateUrl,e.isOpen=function(){return e.matches.length>0},e.isActive=function(t){return e.active==t},e.selectActive=function(t){e.active=t},e.selectMatch=function(t){e.select({activeIdx:t})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(e,t,n,i){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(o,r,s){var a=i(s.templateUrl)(o.$parent)||"template/typeahead/typeahead-match.html";e.get(a,{cache:t}).success(function(e){r.replaceWith(n(e.trim())(o))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n?(""+t).replace(new RegExp(e(n),"gi"),"<strong>$&</strong>"):t}}),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(e,t,n){function i(e){for(var t in e)if(void 0!==r.style[t])return e[t]}var o=function(i,r,s){s=s||{};var a=e.defer(),l=o[s.animation?"animationEndEventName":"transitionEndEventName"],c=function(){n.$apply(function(){i.unbind(l,c),a.resolve(i)})};return l&&i.bind(l,c),t(function(){angular.isString(r)?i.addClass(r):angular.isFunction(r)?r(i):angular.isObject(r)&&i.css(r),l||a.resolve(i)}),a.promise.cancel=function(){l&&i.unbind(l,c),a.reject("Transition cancelled")},a.promise},r=document.createElement("trans"),s={
WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},a={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return o.transitionEndEventName=i(s),o.animationEndEventName=i(a),o}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(e){return{link:function(t,n,i){function o(t){function i(){c===o&&(c=void 0)}var o=e(n,t);return c&&c.cancel(),c=o,o.then(i,i),o}function r(){u?(u=!1,s()):(n.removeClass("collapse").addClass("collapsing"),o({height:n[0].scrollHeight+"px"}).then(s))}function s(){n.removeClass("collapsing"),n.addClass("collapse in"),n.css({height:"auto"})}function a(){u?(u=!1,l(),n.css({height:0})):(n.css({height:n[0].scrollHeight+"px"}),n[0].offsetWidth,n.removeClass("collapse in").addClass("collapsing"),o({height:0}).then(l))}function l(){n.removeClass("collapsing"),n.addClass("collapse")}var c,u=!0;t.$watch(i.collapse,function(e){e?a():r()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(e,t,n){this.groups=[],this.closeOthers=function(i){var o=angular.isDefined(t.closeOthers)?e.$eval(t.closeOthers):n.closeOthers;o&&angular.forEach(this.groups,function(e){e!==i&&(e.isOpen=!1)})},this.addGroup=function(e){var t=this;this.groups.push(e),e.$on("$destroy",function(){t.removeGroup(e)})},this.removeGroup=function(e){var t=this.groups.indexOf(e);-1!==t&&this.groups.splice(t,1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(e){this.heading=e}},link:function(e,t,n,i){i.addGroup(e),e.$watch("isOpen",function(t){t&&i.closeOthers(e)}),e.toggleOpen=function(){e.isDisabled||(e.isOpen=!e.isOpen)}}}}).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",link:function(e,t,n,i,o){i.setHeading(o(e,function(){}))}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(e,t,n,i){e.$watch(function(){return i[n.accordionTransclude]},function(e){e&&(t.html(""),t.append(e))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(e,t){e.closeable="close"in t}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(e,t,n){t.addClass("ng-binding").data("$binding",n.bindHtmlUnsafe),e.$watch(n.bindHtmlUnsafe,function(e){t.html(e||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(e){this.activeClass=e.activeClass||"active",this.toggleEvent=e.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(e,t,n,i){var o=i[0],r=i[1];r.$render=function(){t.toggleClass(o.activeClass,angular.equals(r.$modelValue,e.$eval(n.btnRadio)))},t.bind(o.toggleEvent,function(){var i=t.hasClass(o.activeClass);(!i||angular.isDefined(n.uncheckable))&&e.$apply(function(){r.$setViewValue(i?null:e.$eval(n.btnRadio)),r.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(e,t,n,i){function o(){return s(n.btnCheckboxTrue,!0)}function r(){return s(n.btnCheckboxFalse,!1)}function s(t,n){var i=e.$eval(t);return angular.isDefined(i)?i:n}var a=i[0],l=i[1];l.$render=function(){t.toggleClass(a.activeClass,angular.equals(l.$modelValue,o()))},t.bind(a.toggleEvent,function(){e.$apply(function(){l.$setViewValue(t.hasClass(a.activeClass)?r():o()),l.$render()})})}}}),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition",function(e,t,n){function i(){o();var n=+e.interval;!isNaN(n)&&n>=0&&(s=t(r,n))}function o(){s&&(t.cancel(s),s=null)}function r(){a?(e.next(),i()):e.pause()}var s,a,l=this,c=l.slides=e.slides=[],u=-1;l.currentSlide=null;var d=!1;l.select=e.select=function(o,r){function s(){d||(l.currentSlide&&angular.isString(r)&&!e.noTransition&&o.$element?(o.$element.addClass(r),o.$element[0].offsetWidth,angular.forEach(c,function(e){angular.extend(e,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(o,{direction:r,active:!0,entering:!0}),angular.extend(l.currentSlide||{},{direction:r,leaving:!0}),e.$currentTransition=n(o.$element,{}),function(t,n){e.$currentTransition.then(function(){a(t,n)},function(){a(t,n)})}(o,l.currentSlide)):a(o,l.currentSlide),l.currentSlide=o,u=h,i())}function a(t,n){angular.extend(t,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(n||{},{direction:"",active:!1,leaving:!1,entering:!1}),e.$currentTransition=null}var h=c.indexOf(o);void 0===r&&(r=h>u?"next":"prev"),o&&o!==l.currentSlide&&(e.$currentTransition?(e.$currentTransition.cancel(),t(s)):s())},e.$on("$destroy",function(){d=!0}),l.indexOfSlide=function(e){return c.indexOf(e)},e.next=function(){var t=(u+1)%c.length;return e.$currentTransition?void 0:l.select(c[t],"next")},e.prev=function(){var t=0>u-1?c.length-1:u-1;return e.$currentTransition?void 0:l.select(c[t],"prev")},e.isActive=function(e){return l.currentSlide===e},e.$watch("interval",i),e.$on("$destroy",o),e.play=function(){a||(a=!0,i())},e.pause=function(){e.noPause||(a=!1,o())},l.addSlide=function(t,n){t.$element=n,c.push(t),1===c.length||t.active?(l.select(c[c.length-1]),1==c.length&&e.play()):t.active=!1},l.removeSlide=function(e){var t=c.indexOf(e);c.splice(t,1),c.length>0&&e.active?l.select(t>=c.length?c[t-1]:c[t]):u>t&&u--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"=?"},link:function(e,t,n,i){i.addSlide(e,t),e.$on("$destroy",function(){i.removeSlide(e)}),e.$watch("active",function(t){t&&i.select(e)})}}}),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function(e,t){function n(e){var n=[],i=e.split("");return angular.forEach(o,function(t,o){var r=e.indexOf(o);if(r>-1){e=e.split(""),i[r]="("+t.regex+")",e[r]="$";for(var s=r+1,a=r+o.length;a>s;s++)i[s]="",e[s]="$";e=e.join(""),n.push({index:r,apply:t.apply})}}),{regex:new RegExp("^"+i.join("")+"$"),map:t(n,"index")}}function i(e,t,n){return 1===t&&n>28?29===n&&(e%4===0&&e%100!==0||e%400===0):3===t||5===t||8===t||10===t?31>n:!0}this.parsers={};var o={yyyy:{regex:"\\d{4}",apply:function(e){this.year=+e}},yy:{regex:"\\d{2}",apply:function(e){this.year=+e+2e3}},y:{regex:"\\d{1,4}",apply:function(e){this.year=+e}},MMMM:{regex:e.DATETIME_FORMATS.MONTH.join("|"),apply:function(t){this.month=e.DATETIME_FORMATS.MONTH.indexOf(t)}},MMM:{regex:e.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(t){this.month=e.DATETIME_FORMATS.SHORTMONTH.indexOf(t)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(e){this.month=e-1}},M:{regex:"[1-9]|1[0-2]",apply:function(e){this.month=e-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e}},EEEE:{regex:e.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:e.DATETIME_FORMATS.SHORTDAY.join("|")}};this.parse=function(t,o){if(!angular.isString(t)||!o)return t;o=e.DATETIME_FORMATS[o]||o,this.parsers[o]||(this.parsers[o]=n(o));var r=this.parsers[o],s=r.regex,a=r.map,l=t.match(s);if(l&&l.length){for(var c,u={year:1900,month:0,date:1,hours:0},d=1,h=l.length;h>d;d++){var p=a[d-1];p.apply&&p.apply.call(u,l[d])}return i(u.year,u.month,u.date)&&(c=new Date(u.year,u.month,u.date,u.hours)),c}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(e,t){function n(e,n){return e.currentStyle?e.currentStyle[n]:t.getComputedStyle?t.getComputedStyle(e)[n]:e.style[n]}function i(e){return"static"===(n(e,"position")||"static")}var o=function(t){for(var n=e[0],o=t.offsetParent||n;o&&o!==n&&i(o);)o=o.offsetParent;return o||n};return{position:function(t){var n=this.offset(t),i={top:0,left:0},r=o(t[0]);r!=e[0]&&(i=this.offset(angular.element(r)),i.top+=r.clientTop-r.scrollTop,i.left+=r.clientLeft-r.scrollLeft);var s=t[0].getBoundingClientRect();return{width:s.width||t.prop("offsetWidth"),height:s.height||t.prop("offsetHeight"),top:n.top-i.top,left:n.left-i.left}},offset:function(n){var i=n[0].getBoundingClientRect();return{width:i.width||n.prop("offsetWidth"),height:i.height||n.prop("offsetHeight"),top:i.top+(t.pageYOffset||e[0].documentElement.scrollTop),left:i.left+(t.pageXOffset||e[0].documentElement.scrollLeft)}},positionElements:function(e,t,n,i){var o,r,s,a,l=n.split("-"),c=l[0],u=l[1]||"center";o=i?this.offset(e):this.position(e),r=t.prop("offsetWidth"),s=t.prop("offsetHeight");var d={center:function(){return o.left+o.width/2-r/2},left:function(){return o.left},right:function(){return o.left+o.width}},h={center:function(){return o.top+o.height/2-s/2},top:function(){return o.top},bottom:function(){return o.top+o.height}};switch(c){case"right":a={top:h[u](),left:d[c]()};break;case"left":a={top:h[u](),left:o.left-r};break;case"bottom":a={top:h[c](),left:d[u]()};break;default:a={top:o.top-s,left:d[u]()}}return a}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function(e,t,n,i,o,r,s,a){var l=this,c={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange"],function(n,o){l[n]=angular.isDefined(t[n])?8>o?i(t[n])(e.$parent):e.$parent.$eval(t[n]):a[n]}),angular.forEach(["minDate","maxDate"],function(i){t[i]?e.$parent.$watch(n(t[i]),function(e){l[i]=e?new Date(e):null,l.refreshView()}):l[i]=a[i]?new Date(a[i]):null}),e.datepickerMode=e.datepickerMode||a.datepickerMode,e.uniqueId="datepicker-"+e.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined(t.initDate)?e.$parent.$eval(t.initDate):new Date,e.isActive=function(t){return 0===l.compare(t.date,l.activeDate)?(e.activeDateId=t.uid,!0):!1},this.init=function(e){c=e,c.$render=function(){l.render()}},this.render=function(){if(c.$modelValue){var e=new Date(c.$modelValue),t=!isNaN(e);t?this.activeDate=e:r.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),c.$setValidity("date",t)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var e=c.$modelValue?new Date(c.$modelValue):null;c.$setValidity("date-disabled",!e||this.element&&!this.isDisabled(e))}},this.createDateObject=function(e,t){var n=c.$modelValue?new Date(c.$modelValue):null;return{date:e,label:s(e,t),selected:n&&0===this.compare(e,n),disabled:this.isDisabled(e),current:0===this.compare(e,new Date)}},this.isDisabled=function(n){return this.minDate&&this.compare(n,this.minDate)<0||this.maxDate&&this.compare(n,this.maxDate)>0||t.dateDisabled&&e.dateDisabled({date:n,mode:e.datepickerMode})},this.split=function(e,t){for(var n=[];e.length>0;)n.push(e.splice(0,t));return n},e.select=function(t){if(e.datepickerMode===l.minMode){var n=c.$modelValue?new Date(c.$modelValue):new Date(0,0,0,0,0,0,0);n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),c.$setViewValue(n),c.$render()}else l.activeDate=t,e.datepickerMode=l.modes[l.modes.indexOf(e.datepickerMode)-1]},e.move=function(e){var t=l.activeDate.getFullYear()+e*(l.step.years||0),n=l.activeDate.getMonth()+e*(l.step.months||0);l.activeDate.setFullYear(t,n,1),l.refreshView()},e.toggleMode=function(t){t=t||1,e.datepickerMode===l.maxMode&&1===t||e.datepickerMode===l.minMode&&-1===t||(e.datepickerMode=l.modes[l.modes.indexOf(e.datepickerMode)+t])},e.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var u=function(){o(function(){l.element[0].focus()},0,!1)};e.$on("datepicker.focus",u),e.keydown=function(t){var n=e.keys[t.which];if(n&&!t.shiftKey&&!t.altKey)if(t.preventDefault(),t.stopPropagation(),"enter"===n||"space"===n){if(l.isDisabled(l.activeDate))return;e.select(l.activeDate),u()}else!t.ctrlKey||"up"!==n&&"down"!==n?(l.handleKeyDown(n,t),l.refreshView()):(e.toggleMode("up"===n?1:-1),u())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r)}}}).directive("daypicker",["dateFilter",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(t,n,i,o){function r(e,t){return 1!==t||e%4!==0||e%100===0&&e%400!==0?l[t]:29}function s(e,t){var n=new Array(t),i=new Date(e),o=0;for(i.setHours(12);t>o;)n[o++]=new Date(i),i.setDate(i.getDate()+1);return n}function a(e){var t=new Date(e);t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1}t.showWeeks=o.showWeeks,o.step={months:1},o.element=n;var l=[31,28,31,30,31,30,31,31,30,31,30,31];o._refreshView=function(){var n=o.activeDate.getFullYear(),i=o.activeDate.getMonth(),r=new Date(n,i,1),l=o.startingDay-r.getDay(),c=l>0?7-l:-l,u=new Date(r);c>0&&u.setDate(-c+1);for(var d=s(u,42),h=0;42>h;h++)d[h]=angular.extend(o.createDateObject(d[h],o.formatDay),{secondary:d[h].getMonth()!==i,uid:t.uniqueId+"-"+h});t.labels=new Array(7);for(var p=0;7>p;p++)t.labels[p]={abbr:e(d[p].date,o.formatDayHeader),full:e(d[p].date,"EEEE")};if(t.title=e(o.activeDate,o.formatDayTitle),t.rows=o.split(d,7),t.showWeeks){t.weekNumbers=[];for(var f=a(t.rows[0][0].date),g=t.rows.length;t.weekNumbers.push(f++)<g;);}},o.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},o.handleKeyDown=function(e){var t=o.activeDate.getDate();if("left"===e)t-=1;else if("up"===e)t-=7;else if("right"===e)t+=1;else if("down"===e)t+=7;else if("pageup"===e||"pagedown"===e){var n=o.activeDate.getMonth()+("pageup"===e?-1:1);o.activeDate.setMonth(n,1),t=Math.min(r(o.activeDate.getFullYear(),o.activeDate.getMonth()),t)}else"home"===e?t=1:"end"===e&&(t=r(o.activeDate.getFullYear(),o.activeDate.getMonth()));o.activeDate.setDate(t)},o.refreshView()}}}]).directive("monthpicker",["dateFilter",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/month.html",require:"^datepicker",link:function(t,n,i,o){o.step={years:1},o.element=n,o._refreshView=function(){for(var n=new Array(12),i=o.activeDate.getFullYear(),r=0;12>r;r++)n[r]=angular.extend(o.createDateObject(new Date(i,r,1),o.formatMonth),{uid:t.uniqueId+"-"+r});t.title=e(o.activeDate,o.formatMonthTitle),t.rows=o.split(n,3)},o.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth())-new Date(t.getFullYear(),t.getMonth())},o.handleKeyDown=function(e){var t=o.activeDate.getMonth();if("left"===e)t-=1;else if("up"===e)t-=3;else if("right"===e)t+=1;else if("down"===e)t+=3;else if("pageup"===e||"pagedown"===e){var n=o.activeDate.getFullYear()+("pageup"===e?-1:1);o.activeDate.setFullYear(n)}else"home"===e?t=0:"end"===e&&(t=11);o.activeDate.setMonth(t)},o.refreshView()}}}]).directive("yearpicker",["dateFilter",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/year.html",require:"^datepicker",link:function(e,t,n,i){function o(e){return parseInt((e-1)/r,10)*r+1}var r=i.yearRange;i.step={years:r},i.element=t,i._refreshView=function(){for(var t=new Array(r),n=0,s=o(i.activeDate.getFullYear());r>n;n++)t[n]=angular.extend(i.createDateObject(new Date(s+n,0,1),i.formatYear),{uid:e.uniqueId+"-"+n});e.title=[t[0].label,t[r-1].label].join(" - "),e.rows=i.split(t,5)},i.compare=function(e,t){return e.getFullYear()-t.getFullYear()},i.handleKeyDown=function(e){var t=i.activeDate.getFullYear();"left"===e?t-=1:"up"===e?t-=5:"right"===e?t+=1:"down"===e?t+=5:"pageup"===e||"pagedown"===e?t+=("pageup"===e?-1:1)*i.step.years:"home"===e?t=o(i.activeDate.getFullYear()):"end"===e&&(t=o(i.activeDate.getFullYear())+r-1),i.activeDate.setFullYear(t)},i.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function(e,t,n,i,o,r,s){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&"},link:function(a,l,c,u){function d(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function h(e){if(e){if(angular.isDate(e)&&!isNaN(e))return u.$setValidity("date",!0),e;if(angular.isString(e)){var t=r.parse(e,p)||new Date(e);return isNaN(t)?void u.$setValidity("date",!1):(u.$setValidity("date",!0),t)}return void u.$setValidity("date",!1)}return u.$setValidity("date",!0),null}var p,f=angular.isDefined(c.closeOnDateSelection)?a.$parent.$eval(c.closeOnDateSelection):s.closeOnDateSelection,g=angular.isDefined(c.datepickerAppendToBody)?a.$parent.$eval(c.datepickerAppendToBody):s.appendToBody;a.showButtonBar=angular.isDefined(c.showButtonBar)?a.$parent.$eval(c.showButtonBar):s.showButtonBar,a.getText=function(e){return a[e+"Text"]||s[e+"Text"]},c.$observe("datepickerPopup",function(e){p=e||s.datepickerPopup,u.$render()});var m=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");m.attr({"ng-model":"date","ng-change":"dateSelection()"});var v=angular.element(m.children()[0]);c.datepickerOptions&&angular.forEach(a.$parent.$eval(c.datepickerOptions),function(e,t){v.attr(d(t),e)}),a.watchData={},angular.forEach(["minDate","maxDate","datepickerMode"],function(e){if(c[e]){var n=t(c[e]);if(a.$parent.$watch(n,function(t){a.watchData[e]=t}),v.attr(d(e),"watchData."+e),"datepickerMode"===e){var i=n.assign;a.$watch("watchData."+e,function(e,t){e!==t&&i(a.$parent,e)})}}}),c.dateDisabled&&v.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),u.$parsers.unshift(h),a.dateSelection=function(e){angular.isDefined(e)&&(a.date=e),u.$setViewValue(a.date),u.$render(),f&&(a.isOpen=!1,l[0].focus())},l.bind("input change keyup",function(){a.$apply(function(){a.date=u.$modelValue})}),u.$render=function(){var e=u.$viewValue?o(u.$viewValue,p):"";l.val(e),a.date=h(u.$modelValue)};var b=function(e){a.isOpen&&e.target!==l[0]&&a.$apply(function(){a.isOpen=!1})},y=function(e){a.keydown(e)};l.bind("keydown",y),a.keydown=function(e){27===e.which?(e.preventDefault(),e.stopPropagation(),a.close()):40!==e.which||a.isOpen||(a.isOpen=!0)},a.$watch("isOpen",function(e){e?(a.$broadcast("datepicker.focus"),a.position=g?i.offset(l):i.position(l),a.position.top=a.position.top+l.prop("offsetHeight"),n.bind("click",b)):n.unbind("click",b)}),a.select=function(e){if("today"===e){var t=new Date;angular.isDate(u.$modelValue)?(e=new Date(u.$modelValue),e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate())):e=new Date(t.setHours(0,0,0,0))}a.dateSelection(e)},a.close=function(){a.isOpen=!1,l[0].focus()};var w=e(m)(a);m.remove(),g?n.find("body").append(w):l.after(w),a.$on("$destroy",function(){w.remove(),l.unbind("keydown",y),n.unbind("click",b)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(e,t){t.bind("click",function(e){e.preventDefault(),e.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdown",[]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(e){var t=null;this.open=function(o){t||(e.bind("click",n),e.bind("keydown",i)),t&&t!==o&&(t.isOpen=!1),t=o},this.close=function(o){t===o&&(t=null,e.unbind("click",n),e.unbind("keydown",i))};var n=function(e){var n=t.getToggleElement();e&&n&&n[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})},i=function(e){27===e.which&&(t.focusToggleElement(),n())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(e,t,n,i,o,r){var s,a=this,l=e.$new(),c=i.openClass,u=angular.noop,d=t.onToggle?n(t.onToggle):angular.noop;this.init=function(i){a.$element=i,t.isOpen&&(s=n(t.isOpen),u=s.assign,e.$watch(s,function(e){l.isOpen=!!e}))},this.toggle=function(e){return l.isOpen=arguments.length?!!e:!l.isOpen},this.isOpen=function(){return l.isOpen},l.getToggleElement=function(){return a.toggleElement},l.focusToggleElement=function(){a.toggleElement&&a.toggleElement[0].focus()},l.$watch("isOpen",function(t,n){r[t?"addClass":"removeClass"](a.$element,c),t?(l.focusToggleElement(),o.open(l)):o.close(l),u(e,t),angular.isDefined(t)&&t!==n&&d(e,{open:!!t})}),e.$on("$locationChangeSuccess",function(){l.isOpen=!1}),e.$on("$destroy",function(){l.$destroy()})}]).directive("dropdown",function(){return{restrict:"CA",controller:"DropdownController",link:function(e,t,n,i){i.init(t)}}}).directive("dropdownToggle",function(){return{restrict:"CA",require:"?^dropdown",link:function(e,t,n,i){if(i){i.toggleElement=t;var o=function(o){o.preventDefault(),t.hasClass("disabled")||n.disabled||e.$apply(function(){i.toggle()})};t.bind("click",o),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(i.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",o)})}}}}),angular.module("ui.bootstrap.modal",["ui.bootstrap.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,n){e.push({key:t,value:n})},get:function(t){for(var n=0;n<e.length;n++)if(t==e[n].key)return e[n]},keys:function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var n=-1,i=0;i<e.length;i++)if(t==e[i].key){n=i;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalBackdrop",["$timeout",function(e){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(t,n,i){t.backdropClass=i.backdropClass||"",t.animate=!1,e(function(){t.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(e,t){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(e,t){return t.templateUrl||"template/modal/window.html"},link:function(n,i,o){i.addClass(o.windowClass||""),n.size=o.size,t(function(){n.animate=!0,i[0].querySelectorAll("[autofocus]").length||i[0].focus()}),n.close=function(t){var n=e.getTop();n&&n.value.backdrop&&"static"!=n.value.backdrop&&t.target===t.currentTarget&&(t.preventDefault(),t.stopPropagation(),e.dismiss(n.key,"backdrop click"))}}}}]).directive("modalTransclude",function(){return{link:function(e,t,n,i,o){o(e.$parent,function(e){t.empty(),t.append(e)})}}}).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,t,n,i,o,r){function s(){for(var e=-1,t=p.keys(),n=0;n<t.length;n++)p.get(t[n]).value.backdrop&&(e=n);return e}function a(e){var t=n.find("body").eq(0),i=p.get(e).value;p.remove(e),c(i.modalDomEl,i.modalScope,300,function(){i.modalScope.$destroy(),t.toggleClass(h,p.length()>0),l()})}function l(){if(u&&-1==s()){var e=d;c(u,d,150,function(){e.$destroy(),e=null}),u=void 0,d=void 0}}function c(n,i,o,r){function s(){s.done||(s.done=!0,n.remove(),r&&r())}i.animate=!1;var a=e.transitionEndEventName;if(a){var l=t(s,o);n.bind(a,function(){t.cancel(l),s(),i.$apply()})}else t(s)}var u,d,h="modal-open",p=r.createNew(),f={};return o.$watch(s,function(e){d&&(d.index=e)}),n.bind("keydown",function(e){var t;27===e.which&&(t=p.top(),t&&t.value.keyboard&&(e.preventDefault(),o.$apply(function(){f.dismiss(t.key,"escape key press")})))}),f.open=function(e,t){p.add(e,{deferred:t.deferred,modalScope:t.scope,backdrop:t.backdrop,keyboard:t.keyboard});var r=n.find("body").eq(0),a=s();if(a>=0&&!u){d=o.$new(!0),d.index=a;var l=angular.element("<div modal-backdrop></div>");l.attr("backdrop-class",t.backdropClass),u=i(l)(d),r.append(u)}var c=angular.element("<div modal-window></div>");c.attr({"template-url":t.windowTemplateUrl,"window-class":t.windowClass,size:t.size,index:p.length()-1,animate:"animate"}).html(t.content);var f=i(c)(t.scope);p.top().value.modalDomEl=f,r.append(f),r.addClass(h)},f.close=function(e,t){var n=p.get(e);n&&(n.value.deferred.resolve(t),a(e))},f.dismiss=function(e,t){var n=p.get(e);n&&(n.value.deferred.reject(t),a(e))},f.dismissAll=function(e){for(var t=this.getTop();t;)this.dismiss(t.key,e),t=this.getTop()},f.getTop=function(){return p.top()},f}]).provider("$modal",function(){var e={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,n,i,o,r,s,a){function l(e){return e.template?i.when(e.template):o.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:r}).then(function(e){return e.data})}function c(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(i.when(t.invoke(e)))}),n}var u={};return u.open=function(t){var o=i.defer(),r=i.defer(),u={result:o.promise,opened:r.promise,close:function(e){a.close(u,e)},dismiss:function(e){a.dismiss(u,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var d=i.all([l(t)].concat(c(t.resolve)));return d.then(function(e){var i=(t.scope||n).$new();i.$close=u.close,i.$dismiss=u.dismiss;var r,l={},c=1;t.controller&&(l.$scope=i,l.$modalInstance=u,angular.forEach(t.resolve,function(t,n){l[n]=e[c++]}),r=s(t.controller,l),t.controllerAs&&(i[t.controllerAs]=r)),a.open(u,{scope:i,deferred:o,content:e[0],backdrop:t.backdrop,keyboard:t.keyboard,backdropClass:t.backdropClass,windowClass:t.windowClass,windowTemplateUrl:t.windowTemplateUrl,size:t.size})},function(e){o.reject(e)}),d.then(function(){r.resolve(!0)},function(){r.reject(!1)}),u},u}]};return e}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse",function(e,t,n){var i=this,o={$setViewValue:angular.noop},r=t.numPages?n(t.numPages).assign:angular.noop;this.init=function(r,s){o=r,this.config=s,o.$render=function(){i.render()},t.itemsPerPage?e.$parent.$watch(n(t.itemsPerPage),function(t){i.itemsPerPage=parseInt(t,10),e.totalPages=i.calculateTotalPages()}):this.itemsPerPage=s.itemsPerPage},this.calculateTotalPages=function(){var t=this.itemsPerPage<1?1:Math.ceil(e.totalItems/this.itemsPerPage);return Math.max(t||0,1)},this.render=function(){e.page=parseInt(o.$viewValue,10)||1},e.selectPage=function(t){e.page!==t&&t>0&&t<=e.totalPages&&(o.$setViewValue(t),o.$render())},e.getText=function(t){return e[t+"Text"]||i.config[t+"Text"]},e.noPrevious=function(){return 1===e.page},e.noNext=function(){return e.page===e.totalPages},e.$watch("totalItems",function(){e.totalPages=i.calculateTotalPages()}),e.$watch("totalPages",function(t){r(e.$parent,t),e.page>t?e.selectPage(t):o.$render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(e,t){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(n,i,o,r){function s(e,t,n){return{number:e,text:t,active:n}}function a(e,t){var n=[],i=1,o=t,r=angular.isDefined(u)&&t>u;r&&(d?(i=Math.max(e-Math.floor(u/2),1),o=i+u-1,o>t&&(o=t,i=o-u+1)):(i=(Math.ceil(e/u)-1)*u+1,o=Math.min(i+u-1,t)));for(var a=i;o>=a;a++){var l=s(a,a,a===e);n.push(l)}if(r&&!d){if(i>1){var c=s(i-1,"...",!1);n.unshift(c)}if(t>o){var h=s(o+1,"...",!1);n.push(h)}}return n}var l=r[0],c=r[1];if(c){var u=angular.isDefined(o.maxSize)?n.$parent.$eval(o.maxSize):t.maxSize,d=angular.isDefined(o.rotate)?n.$parent.$eval(o.rotate):t.rotate;n.boundaryLinks=angular.isDefined(o.boundaryLinks)?n.$parent.$eval(o.boundaryLinks):t.boundaryLinks,n.directionLinks=angular.isDefined(o.directionLinks)?n.$parent.$eval(o.directionLinks):t.directionLinks,l.init(c,t),o.maxSize&&n.$parent.$watch(e(o.maxSize),function(e){u=parseInt(e,10),l.render()});var h=l.render;l.render=function(){h(),n.page>0&&n.page<=n.totalPages&&(n.pages=a(n.page,n.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(e){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(t,n,i,o){var r=o[0],s=o[1];s&&(t.align=angular.isDefined(i.align)?t.$parent.$eval(i.align):e.align,r.init(s,e))}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function e(e){var t=/[A-Z]/g,n="-";return e.replace(t,function(e,t){return(t?n:"")+e.toLowerCase()})}var t={placement:"top",animation:!0,popupDelay:0},n={mouseenter:"mouseleave",click:"click",focus:"blur"},i={};this.options=function(e){angular.extend(i,e)},this.setTriggers=function(e){angular.extend(n,e)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(o,r,s,a,l,c,u){return function(o,d,h){function p(e){var t=e||f.trigger||h,i=n[t]||t;return{show:t,hide:i}}var f=angular.extend({},t,i),g=e(o),m=u.startSymbol(),v=u.endSymbol(),b="<div "+g+'-popup title="'+m+"tt_title"+v+'" content="'+m+"tt_content"+v+'" placement="'+m+"tt_placement"+v+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var e=r(b);return function(t,n,i){function r(){t.tt_isOpen?h():u()}function u(){(!S||t.$eval(i[d+"Enable"]))&&(t.tt_popupDelay?C||(C=s(g,t.tt_popupDelay,!1),C.then(function(e){e()})):g()())}function h(){t.$apply(function(){m()})}function g(){return C=null,w&&(s.cancel(w),w=null),t.tt_content?(v(),y.css({top:0,left:0,display:"block"}),_?l.find("body").append(y):n.after(y),k(),t.tt_isOpen=!0,t.$digest(),k):angular.noop}function m(){t.tt_isOpen=!1,s.cancel(C),C=null,t.tt_animation?w||(w=s(b,500)):b()}function v(){y&&b(),y=e(t,function(){}),t.$digest()}function b(){w=null,y&&(y.remove(),y=null)}var y,w,C,_=angular.isDefined(f.appendToBody)?f.appendToBody:!1,x=p(void 0),S=angular.isDefined(i[d+"Enable"]),k=function(){
var e=c.positionElements(n,y,t.tt_placement,_);e.top+="px",e.left+="px",y.css(e)};t.tt_isOpen=!1,i.$observe(o,function(e){t.tt_content=e,!e&&t.tt_isOpen&&m()}),i.$observe(d+"Title",function(e){t.tt_title=e}),i.$observe(d+"Placement",function(e){t.tt_placement=angular.isDefined(e)?e:f.placement}),i.$observe(d+"PopupDelay",function(e){var n=parseInt(e,10);t.tt_popupDelay=isNaN(n)?f.popupDelay:n});var T=function(){n.unbind(x.show,u),n.unbind(x.hide,h)};i.$observe(d+"Trigger",function(e){T(),x=p(e),x.show===x.hide?n.bind(x.show,r):(n.bind(x.show,u),n.bind(x.hide,h))});var $=t.$eval(i[d+"Animation"]);t.tt_animation=angular.isDefined($)?!!$:f.animation,i.$observe(d+"AppendToBody",function(e){_=angular.isDefined(e)?a(e)(t):_}),_&&t.$on("$locationChangeSuccess",function(){t.tt_isOpen&&m()}),t.$on("$destroy",function(){s.cancel(w),s.cancel(C),T(),b()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(e){return e("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(e){return e("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function(e){return e("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",[]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig",function(e,t,n){var i=this,o=angular.isDefined(t.animate)?e.$parent.$eval(t.animate):n.animate;this.bars=[],e.max=angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max,this.addBar=function(t,n){o||n.css({transition:"none"}),this.bars.push(t),t.$watch("value",function(n){t.percent=+(100*n/e.max).toFixed(2)}),t.$on("$destroy",function(){n=null,i.removeBar(t)})},this.removeBar=function(e){this.bars.splice(this.bars.indexOf(e),1)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},templateUrl:"template/progressbar/progress.html"}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(e,t,n,i){i.addBar(e,t)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(e,t,n,i){i.addBar(e,angular.element(t.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","ratingConfig",function(e,t,n){var i={$setViewValue:angular.noop};this.init=function(o){i=o,i.$render=this.render,this.stateOn=angular.isDefined(t.stateOn)?e.$parent.$eval(t.stateOn):n.stateOn,this.stateOff=angular.isDefined(t.stateOff)?e.$parent.$eval(t.stateOff):n.stateOff;var r=angular.isDefined(t.ratingStates)?e.$parent.$eval(t.ratingStates):new Array(angular.isDefined(t.max)?e.$parent.$eval(t.max):n.max);e.range=this.buildTemplateObjects(r)},this.buildTemplateObjects=function(e){for(var t=0,n=e.length;n>t;t++)e[t]=angular.extend({index:t},{stateOn:this.stateOn,stateOff:this.stateOff},e[t]);return e},e.rate=function(t){!e.readonly&&t>=0&&t<=e.range.length&&(i.$setViewValue(t),i.$render())},e.enter=function(t){e.readonly||(e.value=t),e.onHover({value:t})},e.reset=function(){e.value=i.$viewValue,e.onLeave()},e.onKeydown=function(t){/(37|38|39|40)/.test(t.which)&&(t.preventDefault(),t.stopPropagation(),e.rate(e.value+(38===t.which||39===t.which?1:-1)))},this.render=function(){e.value=i.$viewValue}}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0,link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r)}}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function(e){var t=this,n=t.tabs=e.tabs=[];t.select=function(e){angular.forEach(n,function(t){t.active&&t!==e&&(t.active=!1,t.onDeselect())}),e.active=!0,e.onSelect()},t.addTab=function(e){n.push(e),1===n.length?e.active=!0:e.active&&t.select(e)},t.removeTab=function(e){var i=n.indexOf(e);if(e.active&&n.length>1){var o=i==n.length-1?i-1:i+1;t.select(n[o])}n.splice(i,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(e,t,n){e.vertical=angular.isDefined(n.vertical)?e.$parent.$eval(n.vertical):!1,e.justified=angular.isDefined(n.justified)?e.$parent.$eval(n.justified):!1}}}).directive("tab",["$parse",function(e){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(t,n,i){return function(t,n,o,r){t.$watch("active",function(e){e&&r.select(t)}),t.disabled=!1,o.disabled&&t.$parent.$watch(e(o.disabled),function(e){t.disabled=!!e}),t.select=function(){t.disabled||(t.active=!0)},r.addTab(t),t.$on("$destroy",function(){r.removeTab(t)}),t.$transcludeFn=i}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(e,t){e.$watch("headingElement",function(e){e&&(t.html(""),t.append(e))})}}}]).directive("tabContentTransclude",function(){function e(e){return e.tagName&&(e.hasAttribute("tab-heading")||e.hasAttribute("data-tab-heading")||"tab-heading"===e.tagName.toLowerCase()||"data-tab-heading"===e.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(t,n,i){var o=t.$eval(i.tabContentTransclude);o.$transcludeFn(o.$parent,function(t){angular.forEach(t,function(t){e(t)?o.headingElement=t:n.append(t)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function(e,t,n,i,o,r){function s(){var t=parseInt(e.hours,10),n=e.showMeridian?t>0&&13>t:t>=0&&24>t;return n?(e.showMeridian&&(12===t&&(t=0),e.meridian===g[1]&&(t+=12)),t):void 0}function a(){var t=parseInt(e.minutes,10);return t>=0&&60>t?t:void 0}function l(e){return angular.isDefined(e)&&e.toString().length<2?"0"+e:e}function c(e){u(),f.$setViewValue(new Date(p)),d(e)}function u(){f.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function d(t){var n=p.getHours(),i=p.getMinutes();e.showMeridian&&(n=0===n||12===n?12:n%12),e.hours="h"===t?n:l(n),e.minutes="m"===t?i:l(i),e.meridian=p.getHours()<12?g[0]:g[1]}function h(e){var t=new Date(p.getTime()+6e4*e);p.setHours(t.getHours(),t.getMinutes()),c()}var p=new Date,f={$setViewValue:angular.noop},g=angular.isDefined(t.meridians)?e.$parent.$eval(t.meridians):r.meridians||o.DATETIME_FORMATS.AMPMS;this.init=function(n,i){f=n,f.$render=this.render;var o=i.eq(0),s=i.eq(1),a=angular.isDefined(t.mousewheel)?e.$parent.$eval(t.mousewheel):r.mousewheel;a&&this.setupMousewheelEvents(o,s),e.readonlyInput=angular.isDefined(t.readonlyInput)?e.$parent.$eval(t.readonlyInput):r.readonlyInput,this.setupInputEvents(o,s)};var m=r.hourStep;t.hourStep&&e.$parent.$watch(n(t.hourStep),function(e){m=parseInt(e,10)});var v=r.minuteStep;t.minuteStep&&e.$parent.$watch(n(t.minuteStep),function(e){v=parseInt(e,10)}),e.showMeridian=r.showMeridian,t.showMeridian&&e.$parent.$watch(n(t.showMeridian),function(t){if(e.showMeridian=!!t,f.$error.time){var n=s(),i=a();angular.isDefined(n)&&angular.isDefined(i)&&(p.setHours(n),c())}else d()}),this.setupMousewheelEvents=function(t,n){var i=function(e){e.originalEvent&&(e=e.originalEvent);var t=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||t>0};t.bind("mousewheel wheel",function(t){e.$apply(i(t)?e.incrementHours():e.decrementHours()),t.preventDefault()}),n.bind("mousewheel wheel",function(t){e.$apply(i(t)?e.incrementMinutes():e.decrementMinutes()),t.preventDefault()})},this.setupInputEvents=function(t,n){if(e.readonlyInput)return e.updateHours=angular.noop,void(e.updateMinutes=angular.noop);var i=function(t,n){f.$setViewValue(null),f.$setValidity("time",!1),angular.isDefined(t)&&(e.invalidHours=t),angular.isDefined(n)&&(e.invalidMinutes=n)};e.updateHours=function(){var e=s();angular.isDefined(e)?(p.setHours(e),c("h")):i(!0)},t.bind("blur",function(){!e.invalidHours&&e.hours<10&&e.$apply(function(){e.hours=l(e.hours)})}),e.updateMinutes=function(){var e=a();angular.isDefined(e)?(p.setMinutes(e),c("m")):i(void 0,!0)},n.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=l(e.minutes)})})},this.render=function(){var e=f.$modelValue?new Date(f.$modelValue):null;isNaN(e)?(f.$setValidity("time",!1),i.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(e&&(p=e),u(),d())},e.incrementHours=function(){h(60*m)},e.decrementHours=function(){h(60*-m)},e.incrementMinutes=function(){h(v)},e.decrementMinutes=function(){h(-v)},e.toggleMeridian=function(){h(720*(p.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(e,t,n,i){var o=i[0],r=i[1];r&&o.init(r,t.find("input"))}}}),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(n){var i=n.match(t);if(!i)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+n+'".');return{itemName:i[3],source:e(i[4]),viewMapper:e(i[2]||i[1]),modelMapper:e(i[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,t,n,i,o,r,s){var a=[9,13,27,38,40];return{require:"ngModel",link:function(l,c,u,d){var h,p=l.$eval(u.typeaheadMinLength)||1,f=l.$eval(u.typeaheadWaitMs)||0,g=l.$eval(u.typeaheadEditable)!==!1,m=t(u.typeaheadLoading).assign||angular.noop,v=t(u.typeaheadOnSelect),b=u.typeaheadInputFormatter?t(u.typeaheadInputFormatter):void 0,y=u.typeaheadAppendToBody?l.$eval(u.typeaheadAppendToBody):!1,w=t(u.ngModel).assign,C=s.parse(u.typeahead),_=l.$new();l.$on("$destroy",function(){_.$destroy()});var x="typeahead-"+_.$id+"-"+Math.floor(1e4*Math.random());c.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":x});var S=angular.element("<div typeahead-popup></div>");S.attr({id:x,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(u.typeaheadTemplateUrl)&&S.attr("template-url",u.typeaheadTemplateUrl);var k=function(){_.matches=[],_.activeIdx=-1,c.attr("aria-expanded",!1)},T=function(e){return x+"-option-"+e};_.$watch("activeIdx",function(e){0>e?c.removeAttr("aria-activedescendant"):c.attr("aria-activedescendant",T(e))});var $=function(e){var t={$viewValue:e};m(l,!0),n.when(C.source(l,t)).then(function(n){var i=e===d.$viewValue;if(i&&h)if(n.length>0){_.activeIdx=0,_.matches.length=0;for(var o=0;o<n.length;o++)t[C.itemName]=n[o],_.matches.push({id:T(o),label:C.viewMapper(_,t),model:n[o]});_.query=e,_.position=y?r.offset(c):r.position(c),_.position.top=_.position.top+c.prop("offsetHeight"),c.attr("aria-expanded",!0)}else k();i&&m(l,!1)},function(){k(),m(l,!1)})};k(),_.query=void 0;var E,D=function(e){E=i(function(){$(e)},f)},I=function(){E&&i.cancel(E)};d.$parsers.unshift(function(e){return h=!0,e&&e.length>=p?f>0?(I(),D(e)):$(e):(m(l,!1),I(),k()),g?e:e?void d.$setValidity("editable",!1):(d.$setValidity("editable",!0),e)}),d.$formatters.push(function(e){var t,n,i={};return b?(i.$model=e,b(l,i)):(i[C.itemName]=e,t=C.viewMapper(l,i),i[C.itemName]=void 0,n=C.viewMapper(l,i),t!==n?t:e)}),_.select=function(e){var t,n,o={};o[C.itemName]=n=_.matches[e].model,t=C.modelMapper(l,o),w(l,t),d.$setValidity("editable",!0),v(l,{$item:n,$model:t,$label:C.viewMapper(l,o)}),k(),i(function(){c[0].focus()},0,!1)},c.bind("keydown",function(e){0!==_.matches.length&&-1!==a.indexOf(e.which)&&(e.preventDefault(),40===e.which?(_.activeIdx=(_.activeIdx+1)%_.matches.length,_.$digest()):38===e.which?(_.activeIdx=(_.activeIdx?_.activeIdx:_.matches.length)-1,_.$digest()):13===e.which||9===e.which?_.$apply(function(){_.select(_.activeIdx)}):27===e.which&&(e.stopPropagation(),k(),_.$digest()))}),c.bind("blur",function(){h=!1});var M=function(e){c[0]!==e.target&&(k(),_.$digest())};o.bind("click",M),l.$on("$destroy",function(){o.unbind("click",M)});var A=e(S)(_);y?o.find("body").append(A):c.after(A)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(e,t,n){e.templateUrl=n.templateUrl,e.isOpen=function(){return e.matches.length>0},e.isActive=function(t){return e.active==t},e.selectActive=function(t){e.active=t},e.selectMatch=function(t){e.select({activeIdx:t})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(e,t,n,i){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(o,r,s){var a=i(s.templateUrl)(o.$parent)||"template/typeahead/typeahead-match.html";e.get(a,{cache:t}).success(function(e){r.replaceWith(n(e.trim())(o))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n?(""+t).replace(new RegExp(e(n),"gi"),"<strong>$&</strong>"):t}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function(e){e.put("template/accordion/accordion-group.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <h4 class="panel-title">\n      <a class="accordion-toggle" ng-click="toggleOpen()" accordion-transclude="heading"><span ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a>\n    </h4>\n  </div>\n  <div class="panel-collapse" collapse="!isOpen">\n	  <div class="panel-body" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function(e){e.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(e){e.put("template/alert/alert.html",'<div class="alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissable\' : null]" role="alert">\n    <button ng-show="closeable" type="button" class="close" ng-click="close()">\n        <span aria-hidden="true">&times;</span>\n        <span class="sr-only">Close</span>\n    </button>\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function(e){e.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function(e){e.put("template/carousel/slide.html","<div ng-class=\"{\n    'active': leaving || (active && !entering),\n    'prev': (next || active) && direction=='prev',\n    'next': (next || active) && direction=='next',\n    'right': direction=='prev',\n    'left': direction=='next'\n  }\" class=\"item text-center\" ng-transclude></div>\n")}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/day.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="{{5 + showWeeks}}"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n    <tr>\n      <th ng-show="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)">\n	<li ng-transclude></li>\n	<li ng-if="showButtonBar" style="padding:10px 9px 2px">\n		<span class="btn-group">\n			<button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n			<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n		</span>\n		<button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n	</li>\n</ul>\n')}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function(e){e.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="3"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(e){e.put("template/modal/backdrop.html",'<div class="modal-backdrop fade {{ backdropClass }}"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"\n></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(e){e.put("template/modal/window.html",'<div tabindex="-1" role="dialog" class="modal fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="{\'modal-sm\': size == \'sm\', \'modal-lg\': size == \'lg\'}"><div class="modal-content" modal-transclude></div></div>\n</div>')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function(e){e.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function(e){e.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages)">{{getText(\'last\')}}</a></li>\n</ul>')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(e){e.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function(e){e.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function(e){e.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: percent + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function(e){e.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function(e){e.put("template/progressbar/progressbar.html",'<div class="progress">\n  <div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: percent + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n</div>')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function(e){e.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <i ng-repeat="r in range track by $index" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')">\n        <span class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    </i>\n</span>')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function(e){e.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function(e){e.put("template/tabs/tabset.html",'<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function(e){e.put("template/timepicker/timepicker.html",'<table>\n	<tbody>\n		<tr class="text-center">\n			<td><a ng-click="incrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n			<td>&nbsp;</td>\n			<td><a ng-click="incrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n			<td ng-show="showMeridian"></td>\n		</tr>\n		<tr>\n			<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidHours}">\n				<input type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-mousewheel="incrementHours()" ng-readonly="readonlyInput" maxlength="2">\n			</td>\n			<td>:</td>\n			<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n				<input type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="readonlyInput" maxlength="2">\n			</td>\n			<td ng-show="showMeridian"><button type="button" class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n		</tr>\n		<tr class="text-center">\n			<td><a ng-click="decrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n			<td>&nbsp;</td>\n			<td><a ng-click="decrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n			<td ng-show="showMeridian"></td>\n		</tr>\n	</tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ui.router"),function(e,t,n){"use strict";function i(e,t){return P(new(P(function(){},{prototype:e})),t)}function o(e){return R(arguments,function(t){t!==e&&R(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}function r(e,t){var n=[];for(var i in e.path){if(e.path[i]!==t.path[i])break;n.push(e.path[i])}return n}function s(e){if(Object.keys)return Object.keys(e);var n=[];return t.forEach(e,function(e,t){n.push(t)}),n}function a(e,t){if(Array.prototype.indexOf)return e.indexOf(t,Number(arguments[2])||0);var n=e.length>>>0,i=Number(arguments[2])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=n);n>i;i++)if(i in e&&e[i]===t)return i;return-1}function l(e,t,n,i){var o,l=r(n,i),c={},u=[];for(var d in l)if(l[d].params&&(o=s(l[d].params),o.length))for(var h in o)a(u,o[h])>=0||(u.push(o[h]),c[o[h]]=e[o[h]]);return P({},c,t)}function c(e,t,n){if(!n){n=[];for(var i in e)n.push(i)}for(var o=0;o<n.length;o++){var r=n[o];if(e[r]!=t[r])return!1}return!0}function u(e,t){var n={};return R(e,function(e){n[e]=t[e]}),n}function d(e,t){var i=1,r=2,s={},a=[],l=s,c=P(e.when(s),{$$promises:s,$$values:s});this.study=function(s){function u(e,n){if(f[n]!==r){if(p.push(n),f[n]===i)throw p.splice(0,p.indexOf(n)),new Error("Cyclic dependency: "+p.join(" -> "));if(f[n]=i,M(e))h.push(n,[function(){return t.get(e)}],a);else{var o=t.annotate(e);R(o,function(e){e!==n&&s.hasOwnProperty(e)&&u(s[e],e)}),h.push(n,e,o)}p.pop(),
f[n]=r}}function d(e){return A(e)&&e.then&&e.$$promises}if(!A(s))throw new Error("'invocables' must be an object");var h=[],p=[],f={};return R(s,u),s=p=f=null,function(i,r,s){function a(){--b||(y||o(v,r.$$values),g.$$values=v,g.$$promises=!0,delete g.$$inheritedValues,f.resolve(v))}function u(e){g.$$failure=e,f.reject(e)}function p(n,o,r){function l(e){d.reject(e),u(e)}function c(){if(!D(g.$$failure))try{d.resolve(t.invoke(o,s,v)),d.promise.then(function(e){v[n]=e,a()},l)}catch(e){l(e)}}var d=e.defer(),h=0;R(r,function(e){m.hasOwnProperty(e)&&!i.hasOwnProperty(e)&&(h++,m[e].then(function(t){v[e]=t,--h||c()},l))}),h||c(),m[n]=d.promise}if(d(i)&&s===n&&(s=r,r=i,i=null),i){if(!A(i))throw new Error("'locals' must be an object")}else i=l;if(r){if(!d(r))throw new Error("'parent' must be a promise returned by $resolve.resolve()")}else r=c;var f=e.defer(),g=f.promise,m=g.$$promises={},v=P({},i),b=1+h.length/3,y=!1;if(D(r.$$failure))return u(r.$$failure),g;r.$$inheritedValues&&o(v,r.$$inheritedValues),r.$$values?(y=o(v,r.$$values),g.$$inheritedValues=r.$$values,a()):(r.$$inheritedValues&&(g.$$inheritedValues=r.$$inheritedValues),P(m,r.$$promises),r.then(a,u));for(var w=0,C=h.length;C>w;w+=3)i.hasOwnProperty(h[w])?a():p(h[w],h[w+1],h[w+2]);return g}},this.resolve=function(e,t,n,i){return this.study(e)(t,n,i)}}function h(e,t,n){this.fromConfig=function(e,t,n){return D(e.template)?this.fromString(e.template,t):D(e.templateUrl)?this.fromUrl(e.templateUrl,t):D(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):null},this.fromString=function(e,t){return I(e)?e(t):e},this.fromUrl=function(n,i){return I(n)&&(n=n(i)),null==n?null:e.get(n,{cache:t}).then(function(e){return e.data})},this.fromProvider=function(e,t,i){return n.invoke(e,null,i||{params:t})}}function p(e,i){function o(e){return D(e)?this.type.decode(e):g.$$getDefaultValue(this)}function r(t,n,i){if(!/^\w+(-+\w+)*$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(p[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");p[t]=P({type:n||new f,$value:o},i)}function s(e,t,n){var i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;var o=n?"?":"";return i+o+"("+t+")"+o}function a(e){if(!i.params||!i.params[e])return{};var t=i.params[e];return A(t)?t:{value:t}}i=t.isObject(i)?i:{};var l,c=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,u="^",d=0,h=this.segments=[],p=this.params={};this.source=e;for(var m,v,b,y,w;(l=c.exec(e))&&(m=l[2]||l[3],v=l[4]||("*"==l[1]?".*":"[^/]*"),b=e.substring(d,l.index),y=this.$types[v]||new f({pattern:new RegExp(v)}),w=a(m),!(b.indexOf("?")>=0));)u+=s(b,y.$subPattern(),D(w.value)),r(m,y,w),h.push(b),d=c.lastIndex;b=e.substring(d);var C=b.indexOf("?");if(C>=0){var _=this.sourceSearch=b.substring(C);b=b.substring(0,C),this.sourcePath=e.substring(0,d+C),R(_.substring(1).split(/[&?]/),function(e){r(e,null,a(e))})}else this.sourcePath=e,this.sourceSearch="";u+=s(b)+(i.strict===!1?"/?":"")+"$",h.push(b),this.regexp=new RegExp(u,i.caseInsensitive?"i":n),this.prefix=h[0]}function f(e){P(this,e)}function g(){function e(){return{strict:r,caseInsensitive:o}}function t(e){return I(e)||O(e)&&I(e[e.length-1])}function n(){R(a,function(e){if(p.prototype.$types[e.name])throw new Error("A type named '"+e.name+"' has already been defined.");var n=new f(t(e.def)?i.invoke(e.def):e.def);p.prototype.$types[e.name]=n})}var i,o=!1,r=!0,s=!0,a=[],l={"int":{decode:function(e){return parseInt(e,10)},is:function(e){return D(e)?this.decode(e.toString())===e:!1},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return 0===parseInt(e,10)?!1:!0},is:function(e){return e===!0||e===!1},pattern:/0|1/},string:{pattern:/[^\/]*/},date:{equals:function(e,t){return e.toISOString()===t.toISOString()},decode:function(e){return new Date(e)},encode:function(e){return[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-")},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/}};g.$$getDefaultValue=function(e){if(!t(e.value))return e.value;if(!i)throw new Error("Injectable functions cannot be called at configuration time");return i.invoke(e.value)},this.caseInsensitive=function(e){o=e},this.strictMode=function(e){r=e},this.compile=function(t,n){return new p(t,P(e(),n))},this.isMatcher=function(e){if(!A(e))return!1;var t=!0;return R(p.prototype,function(n,i){I(n)&&(t=t&&D(e[i])&&I(e[i]))}),t},this.type=function(e,t){return D(t)?(a.push({name:e,def:t}),s||n(),this):p.prototype.$types[e]},this.$get=["$injector",function(e){return i=e,s=!1,p.prototype.$types={},n(),R(l,function(e,t){p.prototype.$types[t]||(p.prototype.$types[t]=new f(e))}),this}]}function m(e,t){function i(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return null!=t?t[1].replace(/\\(.)/g,"$1"):""}function o(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t["$"===n?0:Number(n)]})}function r(e,t,n){if(!n)return!1;var i=e.invoke(t,t,{$match:n});return D(i)?i:!0}function s(t,n,i,o){function r(e,t,n){return"/"===h?e:t?h.slice(0,-1)+e:n?h.slice(1)+e:e}function s(e){function n(e){var n=e(i,t);return n?(M(n)&&t.replace().url(n),!0):!1}if(!e||!e.defaultPrevented){var o,r=l.length;for(o=0;r>o;o++)if(n(l[o]))return;c&&n(c)}}function d(){return a=a||n.$on("$locationChangeSuccess",s)}var h=o.baseHref(),p=t.url();return u||d(),{sync:function(){s()},listen:function(){return d()},update:function(e){return e?void(p=t.url()):void(t.url()!==p&&(t.url(p),t.replace()))},push:function(e,n,i){t.url(e.format(n||{})),i&&i.replace&&t.replace()},href:function(n,i,o){if(!n.validates(i))return null;var s=e.html5Mode(),a=n.format(i);if(o=o||{},s||null===a||(a="#"+e.hashPrefix()+a),a=r(a,s,o.absolute),!o.absolute||!a)return a;var l=!s&&a?"/":"",c=t.port();return c=80===c||443===c?"":":"+c,[t.protocol(),"://",t.host(),c,l,a].join("")}}}var a,l=[],c=null,u=!1;this.rule=function(e){if(!I(e))throw new Error("'rule' must be a function");return l.push(e),this},this.otherwise=function(e){if(M(e)){var t=e;e=function(){return t}}else if(!I(e))throw new Error("'rule' must be a function");return c=e,this},this.when=function(e,n){var s,a=M(n);if(M(e)&&(e=t.compile(e)),!a&&!I(n)&&!O(n))throw new Error("invalid 'handler' in when()");var l={matcher:function(e,n){return a&&(s=t.compile(n),n=["$match",function(e){return s.format(e)}]),P(function(t,i){return r(t,n,e.exec(i.path(),i.search()))},{prefix:M(e.prefix)?e.prefix:""})},regex:function(e,t){if(e.global||e.sticky)throw new Error("when() RegExp must not be global or sticky");return a&&(s=t,t=["$match",function(e){return o(s,e)}]),P(function(n,i){return r(n,t,e.exec(i.path()))},{prefix:i(e)})}},c={matcher:t.isMatcher(e),regex:e instanceof RegExp};for(var u in c)if(c[u])return this.rule(l[u](e,n));throw new Error("invalid 'what' in when()")},this.deferIntercept=function(e){e===n&&(e=!0),u=e},this.$get=s,s.$inject=["$location","$rootScope","$injector","$browser"]}function v(e,o){function r(e){return 0===e.indexOf(".")||0===e.indexOf("^")}function a(e,t){if(!e)return n;var i=M(e),o=i?e:e.name,s=r(o);if(s){if(!t)throw new Error("No reference point given for path '"+o+"'");for(var a=o.split("."),l=0,c=a.length,u=t;c>l;l++)if(""!==a[l]||0!==l){if("^"!==a[l])break;if(!u.parent)throw new Error("Path '"+o+"' not valid for state '"+t.name+"'");u=u.parent}else u=t;a=a.slice(l).join("."),o=u.name+(u.name&&a?".":"")+a}var d=C[o];return!d||!i&&(i||d!==e&&d.self!==e)?n:d}function d(e,t){_[e]||(_[e]=[]),_[e].push(t)}function h(t){t=i(t,{self:t,resolve:t.resolve||{},toString:function(){return this.name}});var n=t.name;if(!M(n)||n.indexOf("@")>=0)throw new Error("State must have a valid name");if(C.hasOwnProperty(n))throw new Error("State '"+n+"'' is already defined");var o=-1!==n.indexOf(".")?n.substring(0,n.lastIndexOf(".")):M(t.parent)?t.parent:"";if(o&&!C[o])return d(o,t.self);for(var r in S)I(S[r])&&(t[r]=S[r](t,S.$delegates[r]));if(C[n]=t,!t[x]&&t.url&&e.when(t.url,["$match","$stateParams",function(e,n){w.$current.navigable==t&&c(e,n)||w.transitionTo(t,e,{location:!1})}]),_[n])for(var s=0;s<_[n].length;s++)h(_[n][s]);return t}function p(e){return e.indexOf("*")>-1}function f(e){var t=e.split("."),n=w.$current.name.split(".");if("**"===t[0]&&(n=n.slice(n.indexOf(t[1])),n.unshift("**")),"**"===t[t.length-1]&&(n.splice(n.indexOf(t[t.length-2])+1,Number.MAX_VALUE),n.push("**")),t.length!=n.length)return!1;for(var i=0,o=t.length;o>i;i++)"*"===t[i]&&(n[i]="*");return n.join("")===t.join("")}function g(e,t){return M(e)&&!D(t)?S[e]:I(t)&&M(e)?(S[e]&&!S.$delegates[e]&&(S.$delegates[e]=S[e]),S[e]=t,this):this}function m(e,t){return A(e)?t=e:t.name=e,h(t),this}function v(e,o,r,d,h,g,m){function v(t,n,i,r){var s=e.$broadcast("$stateNotFound",t,n,i);if(s.defaultPrevented)return m.update(),T;if(!s.retry)return null;if(r.$retry)return m.update(),$;var a=w.transition=o.when(s.retry);return a.then(function(){return a!==w.transition?S:(t.options.$retry=!0,w.transitionTo(t.to,t.toParams,t.options))},function(){return T}),m.update(),a}function _(e,n,i,a,l){var c=i?n:u(s(e.params),n),p={$stateParams:c};l.resolve=h.resolve(e.resolve,p,l.resolve,e);var f=[l.resolve.then(function(e){l.globals=e})];return a&&f.push(a),R(e.views,function(n,i){var o=n.resolve&&n.resolve!==e.resolve?n.resolve:{};o.$template=[function(){return r.load(i,{view:n,locals:p,params:c})||""}],f.push(h.resolve(o,p,l.resolve,e).then(function(r){if(I(n.controllerProvider)||O(n.controllerProvider)){var s=t.extend({},o,p);r.$$controller=d.invoke(n.controllerProvider,null,s)}else r.$$controller=n.controller;r.$$state=e,r.$$controllerAs=n.controllerAs,l[i]=r}))}),o.all(f).then(function(){return l})}var S=o.reject(new Error("transition superseded")),k=o.reject(new Error("transition prevented")),T=o.reject(new Error("transition aborted")),$=o.reject(new Error("transition failed"));return y.locals={resolve:null,globals:{$stateParams:{}}},w={params:{},current:y.self,$current:y,transition:null},w.reload=function(){w.transitionTo(w.current,g,{reload:!0,inherit:!1,notify:!1})},w.go=function(e,t,n){return w.transitionTo(e,t,P({inherit:!0,relative:w.$current},n))},w.transitionTo=function(t,n,r){n=n||{},r=P({location:!0,inherit:!1,relative:null,notify:!0,reload:!1,$retry:!1},r||{});var h,p=w.$current,f=w.params,C=p.path,T=a(t,r.relative);if(!D(T)){var $={to:t,toParams:n,options:r},E=v($,p.self,f,r);if(E)return E;if(t=$.to,n=$.toParams,r=$.options,T=a(t,r.relative),!D(T)){if(!r.relative)throw new Error("No such state '"+t+"'");throw new Error("Could not resolve '"+t+"' from state '"+r.relative+"'")}}if(T[x])throw new Error("Cannot transition to abstract state '"+t+"'");r.inherit&&(n=l(g,n||{},w.$current,T)),t=T;var I=t.path,M=0,A=I[M],O=y.locals,R=[];if(!r.reload)for(;A&&A===C[M]&&c(n,f,A.ownParams);)O=R[M]=A.locals,M++,A=I[M];if(b(t,p,O,r))return t.self.reloadOnSearch!==!1&&m.update(),w.transition=null,o.when(w.current);if(n=u(s(t.params),n||{}),r.notify&&e.$broadcast("$stateChangeStart",t.self,n,p.self,f).defaultPrevented)return m.update(),k;for(var L=o.when(O),F=M;F<I.length;F++,A=I[F])O=R[F]=i(O),L=_(A,n,A===t,L,O);var U=w.transition=L.then(function(){var i,o,s;if(w.transition!==U)return S;for(i=C.length-1;i>=M;i--)s=C[i],s.self.onExit&&d.invoke(s.self.onExit,s.self,s.locals.globals),s.locals=null;for(i=M;i<I.length;i++)o=I[i],o.locals=R[i],o.self.onEnter&&d.invoke(o.self.onEnter,o.self,o.locals.globals);return w.transition!==U?S:(w.$current=t,w.current=t.self,w.params=n,N(w.params,g),w.transition=null,r.location&&t.navigable&&m.push(t.navigable.url,t.navigable.locals.globals.$stateParams,{replace:"replace"===r.location}),r.notify&&e.$broadcast("$stateChangeSuccess",t.self,n,p.self,f),m.update(!0),w.current)},function(i){return w.transition!==U?S:(w.transition=null,h=e.$broadcast("$stateChangeError",t.self,n,p.self,f,i),h.defaultPrevented||m.update(),o.reject(i))});return U},w.is=function(e,i){var o=a(e);return D(o)?w.$current!==o?!1:D(i)&&null!==i?t.equals(g,i):!0:n},w.includes=function(e,t){if(M(e)&&p(e)){if(!f(e))return!1;e=w.$current.name}var i=a(e);return D(i)?D(w.$current.includes[i.name])?c(t,g):!1:n},w.href=function(e,t,n){n=P({lossy:!0,inherit:!0,absolute:!1,relative:w.$current},n||{});var i=a(e,n.relative);if(!D(i))return null;n.inherit&&(t=l(g,t||{},w.$current,i));var o=i&&n.lossy?i.navigable:i;return o&&o.url?m.href(o.url,u(s(i.params),t||{}),{absolute:n.absolute}):null},w.get=function(e,t){if(0===arguments.length)return s(C).map(function(e){return C[e].self});var n=a(e,t);return n&&n.self?n.self:null},w}function b(e,t,n,i){return e!==t||(n!==t.locals||i.reload)&&e.self.reloadOnSearch!==!1?void 0:!0}var y,w,C={},_={},x="abstract",S={parent:function(e){if(D(e.parent)&&e.parent)return a(e.parent);var t=/^(.+)\.[^.]+$/.exec(e.name);return t?a(t[1]):y},data:function(e){return e.parent&&e.parent.data&&(e.data=e.self.data=P({},e.parent.data,e.data)),e.data},url:function(e){var t=e.url,n={params:e.params||{}};if(M(t))return"^"==t.charAt(0)?o.compile(t.substring(1),n):(e.parent.navigable||y).url.concat(t,n);if(!t||o.isMatcher(t))return t;throw new Error("Invalid url '"+t+"' in state '"+e+"'")},navigable:function(e){return e.url?e:e.parent?e.parent.navigable:null},params:function(e){return e.params?e.params:e.url?e.url.params:e.parent.params},views:function(e){var t={};return R(D(e.views)?e.views:{"":e},function(n,i){i.indexOf("@")<0&&(i+="@"+e.parent.name),t[i]=n}),t},ownParams:function(e){if(e.params=e.params||{},!e.parent)return s(e.params);var t={};R(e.params,function(e,n){t[n]=!0}),R(e.parent.params,function(n,i){if(!t[i])throw new Error("Missing required parameter '"+i+"' in state '"+e.name+"'");t[i]=!1});var n=[];return R(t,function(e,t){e&&n.push(t)}),n},path:function(e){return e.parent?e.parent.path.concat(e):[]},includes:function(e){var t=e.parent?P({},e.parent.includes):{};return t[e.name]=!0,t},$delegates:{}};y=h({name:"",url:"^",views:null,"abstract":!0}),y.navigable=null,this.decorator=g,this.state=m,this.$get=v,v.$inject=["$rootScope","$q","$view","$injector","$resolve","$stateParams","$urlRouter"]}function b(){function e(e,t){return{load:function(n,i){var o,r={template:null,controller:null,view:null,locals:null,notify:!0,async:!0,params:{}};return i=P(r,i),i.view&&(o=t.fromConfig(i.view,i.params,i.locals)),o&&i.notify&&e.$broadcast("$viewContentLoading",i),o}}}this.$get=e,e.$inject=["$rootScope","$templateFactory"]}function y(){var e=!1;this.useAnchorScroll=function(){e=!0},this.$get=["$anchorScroll","$timeout",function(t,n){return e?t:function(e){n(function(){e[0].scrollIntoView()},0,!1)}}]}function w(e,n,i){function o(){return n.has?function(e){return n.has(e)?n.get(e):null}:function(e){try{return n.get(e)}catch(t){return null}}}function r(e,t){var n=function(){return{enter:function(e,t,n){t.after(e),n()},leave:function(e,t){e.remove(),t()}}};if(l)return{enter:function(e,t,n){l.enter(e,null,t,n)},leave:function(e,t){l.leave(e,t)}};if(a){var i=a&&a(t,e);return{enter:function(e,t,n){i.enter(e,null,t),n()},leave:function(e,t){i.leave(e),t()}}}return n()}var s=o(),a=s("$animator"),l=s("$animate"),c={restrict:"ECA",terminal:!0,priority:400,transclude:"element",compile:function(n,o,s){return function(n,o,a){function l(){u&&(u.remove(),u=null),h&&(h.$destroy(),h=null),d&&(m.leave(d,function(){u=null}),u=d,d=null)}function c(r){var c,u=_(a,o.inheritedData("$uiView")),v=u&&e.$current&&e.$current.locals[u];if(r||v!==p){c=n.$new(),p=e.$current.locals[u];var b=s(c,function(e){m.enter(e,o,function(){(t.isDefined(g)&&!g||n.$eval(g))&&i(e)}),l()});d=b,h=c,h.$emit("$viewContentLoaded"),h.$eval(f)}}var u,d,h,p,f=a.onload||"",g=a.autoscroll,m=r(a,n);n.$on("$stateChangeSuccess",function(){c(!1)}),n.$on("$viewContentLoading",function(){c(!1)}),c(!0)}}};return c}function C(e,t,n){return{restrict:"ECA",priority:-400,compile:function(i){var o=i.html();return function(i,r,s){var a=n.$current,l=_(s,r.inheritedData("$uiView")),c=a&&a.locals[l];if(c){r.data("$uiView",{name:l,state:c.$$state}),r.html(c.$template?c.$template:o);var u=e(r.contents());if(c.$$controller){c.$scope=i;var d=t(c.$$controller,c);c.$$controllerAs&&(i[c.$$controllerAs]=d),r.data("$ngControllerController",d),r.children().data("$ngControllerController",d)}u(i)}}}}}function _(e,t){var n=e.uiView||e.name||"";return n.indexOf("@")>=0?n:n+"@"+(t?t.state.name:"")}function x(e,t){var n,i=e.match(/^\s*({[^}]*})\s*$/);if(i&&(e=t+"("+i[1]+")"),n=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!n||4!==n.length)throw new Error("Invalid state ref '"+e+"'");return{state:n[1],paramExpr:n[3]||null}}function S(e){var t=e.parent().inheritedData("$uiView");return t&&t.state&&t.state.name?t.state:void 0}function k(e,n){var i=["location","inherit","reload"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(o,r,s,a){var l=x(s.uiSref,e.current.name),c=null,u=S(r)||e.$current,d="FORM"===r[0].nodeName,h=d?"action":"href",p=!0,f={relative:u,inherit:!0},g=o.$eval(s.uiSrefOpts)||{};t.forEach(i,function(e){e in g&&(f[e]=g[e])});var m=function(t){if(t&&(c=t),p){var n=e.href(l.state,c,f),i=a[1]||a[0];return i&&i.$$setStateInfo(l.state,c),null===n?(p=!1,!1):void(r[0][h]=n)}};l.paramExpr&&(o.$watch(l.paramExpr,function(e){e!==c&&m(e)},!0),c=o.$eval(l.paramExpr)),m(),d||r.bind("click",function(t){var i=t.which||t.button;if(!(i>1||t.ctrlKey||t.metaKey||t.shiftKey||r.attr("target"))){var o=n(function(){e.go(l.state,c,f)});t.preventDefault(),t.preventDefault=function(){n.cancel(o)}}})}}}function T(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(i,o,r){function s(){a()?o.addClass(h):o.removeClass(h)}function a(){return"undefined"!=typeof r.uiSrefActiveEq?e.$current.self===u&&l():e.includes(u.name)&&l()}function l(){return!d||c(d,t)}var u,d,h;h=n(r.uiSrefActiveEq||r.uiSrefActive||"",!1)(i),this.$$setStateInfo=function(t,n){u=e.get(t,S(o)),d=n,s()},i.$on("$stateChangeSuccess",s)}]}}function $(e){return function(t){return e.is(t)}}function E(e){return function(t){return e.includes(t)}}var D=t.isDefined,I=t.isFunction,M=t.isString,A=t.isObject,O=t.isArray,R=t.forEach,P=t.extend,N=t.copy;t.module("ui.router.util",["ng"]),t.module("ui.router.router",["ui.router.util"]),t.module("ui.router.state",["ui.router.router","ui.router.util"]),t.module("ui.router",["ui.router.state"]),t.module("ui.router.compat",["ui.router"]),d.$inject=["$q","$injector"],t.module("ui.router.util").service("$resolve",d),h.$inject=["$http","$templateCache","$injector"],t.module("ui.router.util").service("$templateFactory",h),p.prototype.concat=function(e,t){return new p(this.sourcePath+e+this.sourceSearch,t)},p.prototype.toString=function(){return this.source},p.prototype.exec=function(e,t){var n=this.regexp.exec(e);if(!n)return null;t=t||{};var i,o,r,s=this.parameters(),a=s.length,l=this.segments.length-1,c={};if(l!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(i=0;l>i;i++)r=s[i],o=this.params[r],c[r]=o.$value(n[i+1]);for(;a>i;i++)r=s[i],o=this.params[r],c[r]=o.$value(t[r]);return c},p.prototype.parameters=function(e){return D(e)?this.params[e]||null:s(this.params)},p.prototype.validates=function(e){var t,n,i=!0,o=this;return R(e,function(e,r){o.params[r]&&(n=o.params[r],t=!e&&D(n.value),i=i&&(t||n.type.is(e)))}),i},p.prototype.format=function(e){var t=this.segments,n=this.parameters();if(!e)return t.join("").replace("//","/");var i,o,r,s,a,l,c=t.length-1,u=n.length,d=t[0];if(!this.validates(e))return null;for(i=0;c>i;i++)s=n[i],r=e[s],a=this.params[s],(D(r)||"/"!==t[i]&&"/"!==t[i+1])&&(null!=r&&(d+=encodeURIComponent(a.type.encode(r))),d+=t[i+1]);for(;u>i;i++)s=n[i],r=e[s],null!=r&&(l=O(r),l&&(r=r.map(encodeURIComponent).join("&"+s+"=")),d+=(o?"&":"?")+s+"="+(l?r:encodeURIComponent(r)),o=!0);return d},p.prototype.$types={},f.prototype.is=function(){return!0},f.prototype.encode=function(e){return e},f.prototype.decode=function(e){return e},f.prototype.equals=function(e,t){return e==t},f.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)},f.prototype.pattern=/.*/,t.module("ui.router.util").provider("$urlMatcherFactory",g),m.$inject=["$locationProvider","$urlMatcherFactoryProvider"],t.module("ui.router.router").provider("$urlRouter",m),v.$inject=["$urlRouterProvider","$urlMatcherFactoryProvider"],t.module("ui.router.state").value("$stateParams",{}).provider("$state",v),b.$inject=[],t.module("ui.router.state").provider("$view",b),t.module("ui.router.state").provider("$uiViewScroll",y),w.$inject=["$state","$injector","$uiViewScroll"],C.$inject=["$compile","$controller","$state"],t.module("ui.router.state").directive("uiView",w),t.module("ui.router.state").directive("uiView",C),k.$inject=["$state","$timeout"],T.$inject=["$state","$stateParams","$interpolate"],t.module("ui.router.state").directive("uiSref",k).directive("uiSrefActive",T).directive("uiSrefActiveEq",T),$.$inject=["$state"],E.$inject=["$state"],t.module("ui.router.state").filter("isState",$).filter("includedByState",E)}(window,window.angular),jQuery&&function(e){function t(t,n){var i=e('<div class="minicolors" />'),o=e.minicolors.defaults;t.data("minicolors-initialized")||(n=e.extend(!0,{},o,n),i.addClass("minicolors-theme-"+n.theme).toggleClass("minicolors-with-opacity",n.opacity).toggleClass("minicolors-no-data-uris",n.dataUris!==!0),void 0!==n.position&&e.each(n.position.split(" "),function(){i.addClass("minicolors-position-"+this)}),t.addClass("minicolors-input").data("minicolors-initialized",!1).data("minicolors-settings",n).prop("size",7).wrap(i).after('<div class="minicolors-panel minicolors-slider-'+n.control+'"><div class="minicolors-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-opacity-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-grid minicolors-sprite"><div class="minicolors-grid-inner"></div><div class="minicolors-picker"><div></div></div></div></div>'),n.inline||(t.after('<span class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></span>'),t.next(".minicolors-swatch").on("click",function(e){e.preventDefault(),t.focus()})),t.parent().find(".minicolors-panel").on("selectstart",function(){return!1}).end(),n.inline&&t.parent().addClass("minicolors-inline"),a(t,!1),t.data("minicolors-initialized",!0))}function n(e){var t=e.parent();e.removeData("minicolors-initialized").removeData("minicolors-settings").removeProp("size").removeClass("minicolors-input"),t.before(e).remove()}function i(e){var t=e.parent(),n=t.find(".minicolors-panel"),i=e.data("minicolors-settings");!e.data("minicolors-initialized")||e.prop("disabled")||t.hasClass("minicolors-inline")||t.hasClass("minicolors-focus")||(o(),t.addClass("minicolors-focus"),n.stop(!0,!0).fadeIn(i.showSpeed,function(){i.show&&i.show.call(e.get(0))}))}function o(){e(".minicolors-focus").each(function(){var t=e(this),n=t.find(".minicolors-input"),i=t.find(".minicolors-panel"),o=n.data("minicolors-settings");i.fadeOut(o.hideSpeed,function(){o.hide&&o.hide.call(n.get(0)),t.removeClass("minicolors-focus")})})}function r(e,t,n){var i,o,r,a,l=e.parents(".minicolors").find(".minicolors-input"),c=l.data("minicolors-settings"),u=e.find("[class$=-picker]"),d=e.offset().left,h=e.offset().top,p=Math.round(t.pageX-d),f=Math.round(t.pageY-h),g=n?c.animationSpeed:0;t.originalEvent.changedTouches&&(p=t.originalEvent.changedTouches[0].pageX-d,f=t.originalEvent.changedTouches[0].pageY-h),0>p&&(p=0),0>f&&(f=0),p>e.width()&&(p=e.width()),f>e.height()&&(f=e.height()),e.parent().is(".minicolors-slider-wheel")&&u.parent().is(".minicolors-grid")&&(i=75-p,o=75-f,r=Math.sqrt(i*i+o*o),a=Math.atan2(o,i),0>a&&(a+=2*Math.PI),r>75&&(r=75,p=75-75*Math.cos(a),f=75-75*Math.sin(a)),p=Math.round(p),f=Math.round(f)),e.is(".minicolors-grid")?u.stop(!0).animate({top:f+"px",left:p+"px"},g,c.animationEasing,function(){s(l,e)}):u.stop(!0).animate({top:f+"px"},g,c.animationEasing,function(){s(l,e)})}function s(e,t){function n(e,t){var n,i;return e.length&&t?(n=e.offset().left,i=e.offset().top,{x:n-t.offset().left+e.outerWidth()/2,y:i-t.offset().top+e.outerHeight()/2}):null}var i,o,r,s,a,c,u,h=e.val(),f=e.attr("data-opacity"),g=e.parent(),v=e.data("minicolors-settings"),b=g.find(".minicolors-swatch"),y=g.find(".minicolors-grid"),w=g.find(".minicolors-slider"),C=g.find(".minicolors-opacity-slider"),_=y.find("[class$=-picker]"),x=w.find("[class$=-picker]"),S=C.find("[class$=-picker]"),k=n(_,y),T=n(x,w),$=n(S,C);if(t.is(".minicolors-grid, .minicolors-slider")){switch(v.control){case"wheel":s=y.width()/2-k.x,a=y.height()/2-k.y,c=Math.sqrt(s*s+a*a),u=Math.atan2(a,s),0>u&&(u+=2*Math.PI),c>75&&(c=75,k.x=69-75*Math.cos(u),k.y=69-75*Math.sin(u)),o=p(c/.75,0,100),i=p(180*u/Math.PI,0,360),r=p(100-Math.floor(T.y*(100/w.height())),0,100),h=m({h:i,s:o,b:r}),w.css("backgroundColor",m({h:i,s:o,b:100}));break;case"saturation":i=p(parseInt(k.x*(360/y.width()),10),0,360),o=p(100-Math.floor(T.y*(100/w.height())),0,100),r=p(100-Math.floor(k.y*(100/y.height())),0,100),h=m({h:i,s:o,b:r}),w.css("backgroundColor",m({h:i,s:100,b:r})),g.find(".minicolors-grid-inner").css("opacity",o/100);break;case"brightness":i=p(parseInt(k.x*(360/y.width()),10),0,360),o=p(100-Math.floor(k.y*(100/y.height())),0,100),r=p(100-Math.floor(T.y*(100/w.height())),0,100),h=m({h:i,s:o,b:r}),w.css("backgroundColor",m({h:i,s:o,b:100})),g.find(".minicolors-grid-inner").css("opacity",1-r/100);break;default:i=p(360-parseInt(T.y*(360/w.height()),10),0,360),o=p(Math.floor(k.x*(100/y.width())),0,100),r=p(100-Math.floor(k.y*(100/y.height())),0,100),h=m({h:i,s:o,b:r}),y.css("backgroundColor",m({h:i,s:100,b:100}))}e.val(d(h,v.letterCase))}t.is(".minicolors-opacity-slider")&&(f=v.opacity?parseFloat(1-$.y/C.height()).toFixed(2):1,v.opacity&&e.attr("data-opacity",f)),b.find("SPAN").css({backgroundColor:h,opacity:f}),l(e,h,f)}function a(e,t){var n,i,o,r,s,a,c,u=e.parent(),f=e.data("minicolors-settings"),g=u.find(".minicolors-swatch"),b=u.find(".minicolors-grid"),y=u.find(".minicolors-slider"),w=u.find(".minicolors-opacity-slider"),C=b.find("[class$=-picker]"),_=y.find("[class$=-picker]"),x=w.find("[class$=-picker]");switch(n=d(h(e.val(),!0),f.letterCase),n||(n=d(h(f.defaultValue,!0),f.letterCase)),i=v(n),t||e.val(n),f.opacity&&(o=""===e.attr("data-opacity")?1:p(parseFloat(e.attr("data-opacity")).toFixed(2),0,1),isNaN(o)&&(o=1),e.attr("data-opacity",o),g.find("SPAN").css("opacity",o),s=p(w.height()-w.height()*o,0,w.height()),x.css("top",s+"px")),g.find("SPAN").css("backgroundColor",n),f.control){case"wheel":a=p(Math.ceil(.75*i.s),0,b.height()/2),c=i.h*Math.PI/180,r=p(75-Math.cos(c)*a,0,b.width()),s=p(75-Math.sin(c)*a,0,b.height()),C.css({top:s+"px",left:r+"px"}),s=150-i.b/(100/b.height()),""===n&&(s=0),_.css("top",s+"px"),y.css("backgroundColor",m({h:i.h,s:i.s,b:100}));break;case"saturation":r=p(5*i.h/12,0,150),s=p(b.height()-Math.ceil(i.b/(100/b.height())),0,b.height()),C.css({top:s+"px",left:r+"px"}),s=p(y.height()-i.s*(y.height()/100),0,y.height()),_.css("top",s+"px"),y.css("backgroundColor",m({h:i.h,s:100,b:i.b})),u.find(".minicolors-grid-inner").css("opacity",i.s/100);break;case"brightness":r=p(5*i.h/12,0,150),s=p(b.height()-Math.ceil(i.s/(100/b.height())),0,b.height()),C.css({top:s+"px",left:r+"px"}),s=p(y.height()-i.b*(y.height()/100),0,y.height()),_.css("top",s+"px"),y.css("backgroundColor",m({h:i.h,s:i.s,b:100})),u.find(".minicolors-grid-inner").css("opacity",1-i.b/100);break;default:r=p(Math.ceil(i.s/(100/b.width())),0,b.width()),s=p(b.height()-Math.ceil(i.b/(100/b.height())),0,b.height()),C.css({top:s+"px",left:r+"px"}),s=p(y.height()-i.h/(360/y.height()),0,y.height()),_.css("top",s+"px"),b.css("backgroundColor",m({h:i.h,s:100,b:100}))}e.data("minicolors-initialized")&&l(e,n,o)}function l(e,t,n){var i=e.data("minicolors-settings"),o=e.data("minicolors-lastChange");o&&o.hex===t&&o.opacity===n||(e.data("minicolors-lastChange",{hex:t,opacity:n}),i.change&&(i.changeDelay?(clearTimeout(e.data("minicolors-changeTimeout")),e.data("minicolors-changeTimeout",setTimeout(function(){i.change.call(e.get(0),t,n)},i.changeDelay))):i.change.call(e.get(0),t,n)),e.trigger("change").trigger("input"))}function c(t){var n=h(e(t).val(),!0),i=y(n),o=e(t).attr("data-opacity");return i?(void 0!==o&&e.extend(i,{a:parseFloat(o)}),i):null}function u(t,n){var i=h(e(t).val(),!0),o=y(i),r=e(t).attr("data-opacity");return o?(void 0===r&&(r=1),n?"rgba("+o.r+", "+o.g+", "+o.b+", "+parseFloat(r)+")":"rgb("+o.r+", "+o.g+", "+o.b+")"):null}function d(e,t){return"uppercase"===t?e.toUpperCase():e.toLowerCase()}function h(e,t){return e=e.replace(/[^A-F0-9]/gi,""),3!==e.length&&6!==e.length?"":(3===e.length&&t&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),"#"+e)}function p(e,t,n){return t>e&&(e=t),e>n&&(e=n),e}function f(e){var t={},n=Math.round(e.h),i=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0===i)t.r=t.g=t.b=o;else{var r=o,s=(255-i)*o/255,a=(r-s)*(n%60)/60;360===n&&(n=0),60>n?(t.r=r,t.b=s,t.g=s+a):120>n?(t.g=r,t.b=s,t.r=r-a):180>n?(t.g=r,t.r=s,t.b=s+a):240>n?(t.b=r,t.r=s,t.g=r-a):300>n?(t.b=r,t.g=s,t.r=s+a):360>n?(t.r=r,t.g=s,t.b=r-a):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}}function g(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){1===t.length&&(n[e]="0"+t)}),"#"+n.join("")}function m(e){return g(f(e))}function v(e){var t=b(y(e));return 0===t.s&&(t.h=360),t}function b(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),o=i-n;return t.b=i,t.s=0!==i?255*o/i:0,t.h=0!==t.s?e.r===i?(e.g-e.b)/o:e.g===i?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t}function y(e){return e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16),{r:e>>16,g:(65280&e)>>8,b:255&e}}e.minicolors={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",dataUris:!0,defaultValue:"",hide:null,hideSpeed:100,inline:!1,letterCase:"lowercase",opacity:!1,position:"bottom left",show:null,showSpeed:100,theme:"default"}},e.extend(e.fn,{minicolors:function(r,s){switch(r){case"destroy":return e(this).each(function(){n(e(this))}),e(this);case"hide":return o(),e(this);case"opacity":return void 0===s?e(this).attr("data-opacity"):(e(this).each(function(){a(e(this).attr("data-opacity",s))}),e(this));case"rgbObject":return c(e(this),"rgbaObject"===r);case"rgbString":case"rgbaString":return u(e(this),"rgbaString"===r);case"settings":return void 0===s?e(this).data("minicolors-settings"):(e(this).each(function(){var t=e(this).data("minicolors-settings")||{};n(e(this)),e(this).minicolors(e.extend(!0,t,s))}),e(this));case"show":return i(e(this).eq(0)),e(this);case"value":return void 0===s?e(this).val():(e(this).each(function(){a(e(this).val(s))}),e(this));default:return"create"!==r&&(s=r),e(this).each(function(){t(e(this),s)}),e(this)}}}),e(document).on("mousedown.minicolors touchstart.minicolors",function(t){e(t.target).parents().add(t.target).hasClass("minicolors")||o()}).on("mousedown.minicolors touchstart.minicolors",".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider",function(t){var n=e(this);t.preventDefault(),e(document).data("minicolors-target",n),r(n,t,!0)}).on("mousemove.minicolors touchmove.minicolors",function(t){var n=e(document).data("minicolors-target");n&&r(n,t)}).on("mouseup.minicolors touchend.minicolors",function(){e(this).removeData("minicolors-target")}).on("mousedown.minicolors touchstart.minicolors",".minicolors-swatch",function(t){var n=e(this).parent().find(".minicolors-input");t.preventDefault(),i(n)}).on("focus.minicolors",".minicolors-input",function(){var t=e(this);t.data("minicolors-initialized")&&i(t)}).on("blur.minicolors",".minicolors-input",function(){var t=e(this),n=t.data("minicolors-settings");t.data("minicolors-initialized")&&(t.val(h(t.val(),!0)),""===t.val()&&t.val(h(n.defaultValue,!0)),t.val(d(t.val(),n.letterCase)))}).on("keydown.minicolors",".minicolors-input",function(t){
var n=e(this);if(n.data("minicolors-initialized"))switch(t.keyCode){case 9:o();break;case 13:case 27:o(),n.blur()}}).on("keyup.minicolors",".minicolors-input",function(){var t=e(this);t.data("minicolors-initialized")&&a(t,!0)}).on("paste.minicolors",".minicolors-input",function(){var t=e(this);t.data("minicolors-initialized")&&setTimeout(function(){a(t,!0)},1)})}(jQuery),function(e){"use strict";var t={},n=Math.max,i=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var i;for(i in t)n.o[i]=t[i];n._carve().init(),n._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var i=e(this);n.i[t]=i,n.v[t]=n.o.parse(i.val()),i.bind("change blur",function(){var e={};e[t]=i.val(),n.val(e)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var i=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return this.t=t.c.t(e),i(e),t.c.d.bind("touchmove.k",i).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var i=function(e){var t=n.xy2val(e.pageX,e.pageY);t!=n.cv&&(n.cH&&n.cH(t)===!1||(n.change(n._validate(t)),n._draw()))};return i(e),t.c.d.bind("mousemove.k",i).bind("keyup.k",function(e){if(27===e.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){return~~((0>e?-.5:.5)+e/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){return null==e?this.v:(e=this.o.parse(e),void(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1||(this.cv=this.o.stopper?n(i(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())))},this.xy2val=function(e,t){var o,r;return o=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(o=this.angleArc-o-this.PI2),this.angleArc!=this.PI2&&0>o&&o>-.5?o=0:0>o&&(o+=this.PI2),r=~~(.5+o*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(r=n(i(r,this.o.max),this.o.min)),r},this.listen=function(){var t,o,r=this,s=1,a={37:-r.o.step,38:r.o.step,39:r.o.step,40:-r.o.step};this.$.bind("keydown",function(l){var c=l.keyCode;if(c>=96&&105>=c&&(c=l.keyCode=c-48),t=parseInt(String.fromCharCode(c)),isNaN(t)&&(13!==c&&8!==c&&9!==c&&189!==c&&(190!==c||r.$.val().match(/\./))&&l.preventDefault(),e.inArray(c,[37,38,39,40])>-1)){l.preventDefault();var u=r.o.parse(r.$.val())+a[c]*s;r.o.stopper&&(u=n(i(u,r.o.max),r.o.min)),r.change(u),r._draw(),o=window.setTimeout(function(){s*=2},30)}}).bind("keyup",function(e){isNaN(t)?o&&(window.clearTimeout(o),o=null,s=1,r.val(r.$.val())):r.$.val()>r.o.max&&r.$.val(r.o.max)||r.$.val()<r.o.min&&r.$.val(r.o.min)})},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e,t=this.g,n=this.arc(this.cv),i=1;t.lineWidth=this.lineWidth,t.lineCap=this.lineCap,t.beginPath(),t.strokeStyle=this.o.bgColor,t.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),t.stroke(),this.o.displayPrevious&&(e=this.arc(this.v),t.beginPath(),t.strokeStyle=this.pColor,t.arc(this.xy,this.xy,this.radius,e.s,e.e,e.d),t.stroke(),i=this.cv==this.v),t.beginPath(),t.strokeStyle=i?this.o.fgColor:this.fgColor,t.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),t.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var i=new t.Dial;i.o=n,i.$=e(this),i.run()}).parent()}}(jQuery),function(){function e(e,t,n){n=(n||0)-1;for(var i=e?e.length:0;++n<i;)if(e[n]===t)return n;return-1}function t(t,n){var i=typeof n;if(t=t.l,"boolean"==i||null==n)return t[n]?0:-1;"number"!=i&&"string"!=i&&(i="object");var o="number"==i?n:y+n;return t=(t=t[i])&&t[o],"object"==i?t&&-1<e(t,n)?0:-1:t?0:-1}function n(e){var t=this.l,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var i="number"==n?e:y+e,t=t[n]||(t[n]={});"object"==n?(t[i]||(t[i]=[])).push(e):t[i]=!0}}function i(e){return e.charCodeAt(0)}function o(e,t){for(var n=e.m,i=t.m,o=-1,r=n.length;++o<r;){var s=n[o],a=i[o];if(s!==a){if(s>a||"undefined"==typeof s)return 1;if(a>s||"undefined"==typeof a)return-1}}return e.n-t.n}function r(e){var t=-1,i=e.length,o=e[0],r=e[i/2|0],s=e[i-1];if(o&&"object"==typeof o&&r&&"object"==typeof r&&s&&"object"==typeof s)return!1;for(o=l(),o["false"]=o["null"]=o["true"]=o.undefined=!1,r=l(),r.k=e,r.l=o,r.push=n;++t<i;)r.push(e[t]);return r}function s(e){return"\\"+J[e]}function a(){return g.pop()||[]}function l(){return m.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,o:null}}function c(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function u(e){e.length=0,g.length<C&&g.push(e)}function d(e){var t=e.l;t&&d(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,m.length<C&&m.push(e)}function h(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);var i=-1;n=n-t||0;for(var o=Array(0>n?0:n);++i<n;)o[i]=e[t+i];return o}function p(n){function g(e){return e&&"object"==typeof e&&!Ht(e)&&Ct.call(e,"__wrapped__")?e:new m(e)}function m(e,t){this.__chain__=!!t,this.__wrapped__=e}function C(e){function t(){if(i){var e=h(i);_t.apply(e,arguments)}if(this instanceof t){var r=ee(n.prototype),e=n.apply(r,e||arguments);return xe(e)?e:r}return n.apply(o,e||arguments)}var n=e[0],i=e[2],o=e[4];return jt(t,e),t}function J(e,t,n,i,o){if(n){var r=n(e);if("undefined"!=typeof r)return r}if(!xe(e))return e;var s=ft.call(e);if(!Y[s]||!Ut.nodeClass&&c(e))return e;var l=Lt[s];switch(s){case U:case j:return new l(+e);case B:case q:return new l(e);case z:return r=l(e.source,E.exec(e)),r.lastIndex=e.lastIndex,r}if(s=Ht(e),t){var d=!i;i||(i=a()),o||(o=a());for(var p=i.length;p--;)if(i[p]==e)return o[p];r=s?l(e.length):{}}else r=s?h(e):Jt({},e);return s&&(Ct.call(e,"index")&&(r.index=e.index),Ct.call(e,"input")&&(r.input=e.input)),t?(i.push(e),o.push(r),(s?Xt:tn)(e,function(e,s){r[s]=J(e,t,n,i,o)}),d&&(u(i),u(o)),r):r}function ee(e){return xe(e)?Et(e):{}}function te(e,t,n){if("function"!=typeof e)return Ge;if("undefined"==typeof t||!("prototype"in e))return e;var i=e.__bindData__;if("undefined"==typeof i&&(Ut.funcNames&&(i=!e.name),i=i||!Ut.funcDecomp,!i)){var o=yt.call(e);Ut.funcNames||(i=!D.test(o)),i||(i=O.test(o),jt(e,i))}if(!1===i||!0!==i&&1&i[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,o){return e.call(t,n,i,o)};case 4:return function(n,i,o,r){return e.call(t,n,i,o,r)}}return qe(e,t)}function ne(e){function t(){var e=l?s:this;if(o){var f=h(o);_t.apply(f,arguments)}return(r||u)&&(f||(f=h(arguments)),r&&_t.apply(f,r),u&&f.length<a)?(i|=16,ne([n,d?i:-4&i,f,null,s,a])):(f||(f=arguments),c&&(n=e[p]),this instanceof t?(e=ee(n.prototype),f=n.apply(e,f),xe(f)?f:e):n.apply(e,f))}var n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=1&i,c=2&i,u=4&i,d=8&i,p=n;return jt(t,e),t}function ie(n,i){var o=-1,s=fe(),a=n?n.length:0,l=a>=w&&s===e,c=[];if(l){var u=r(i);u?(s=t,i=u):l=!1}for(;++o<a;)u=n[o],0>s(i,u)&&c.push(u);return l&&d(i),c}function re(e,t,n,i){i=(i||0)-1;for(var o=e?e.length:0,r=[];++i<o;){var s=e[i];if(s&&"object"==typeof s&&"number"==typeof s.length&&(Ht(s)||be(s))){t||(s=re(s,t,n));var a=-1,l=s.length,c=r.length;for(r.length+=l;++a<l;)r[c++]=s[a]}else n||r.push(s)}return r}function se(e,t,n,i,o,r){if(n){var s=n(e,t);if("undefined"!=typeof s)return!!s}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&X[typeof e]||t&&X[typeof t]))return!1;if(null==e||null==t)return e===t;var l=ft.call(e),d=ft.call(t);if(l==L&&(l=V),d==L&&(d=V),l!=d)return!1;switch(l){case U:case j:return+e==+t;case B:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case z:case q:return e==at(t)}if(d=l==F,!d){var h=Ct.call(e,"__wrapped__"),p=Ct.call(t,"__wrapped__");if(h||p)return se(h?e.__wrapped__:e,p?t.__wrapped__:t,n,i,o,r);if(l!=V||!Ut.nodeClass&&(c(e)||c(t)))return!1;if(l=!Ut.argsObject&&be(e)?rt:e.constructor,h=!Ut.argsObject&&be(t)?rt:t.constructor,l!=h&&!(_e(l)&&l instanceof l&&_e(h)&&h instanceof h)&&"constructor"in e&&"constructor"in t)return!1}for(l=!o,o||(o=a()),r||(r=a()),h=o.length;h--;)if(o[h]==e)return r[h]==t;var f=0,s=!0;if(o.push(e),r.push(t),d){if(h=e.length,f=t.length,(s=f==h)||i)for(;f--;)if(d=h,p=t[f],i)for(;d--&&!(s=se(e[d],p,n,i,o,r)););else if(!(s=se(e[f],p,n,i,o,r)))break}else en(t,function(t,a,l){return Ct.call(l,a)?(f++,s=Ct.call(e,a)&&se(e[a],t,n,i,o,r)):void 0}),s&&!i&&en(e,function(e,t,n){return Ct.call(n,t)?s=-1<--f:void 0});return o.pop(),r.pop(),l&&(u(o),u(r)),s}function ae(e,t,n,i,o){(Ht(t)?Me:tn)(t,function(t,r){var s,a,l=t,c=e[r];if(t&&((a=Ht(t))||nn(t))){for(l=i.length;l--;)if(s=i[l]==t){c=o[l];break}if(!s){var u;n&&(l=n(c,t),u="undefined"!=typeof l)&&(c=l),u||(c=a?Ht(c)?c:[]:nn(c)?c:{}),i.push(t),o.push(c),u||ae(c,t,n,i,o)}}else n&&(l=n(c,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(c=l);e[r]=c})}function le(e,t){return e+bt(Nt()*(t-e+1))}function ce(n,i,o){var s=-1,l=fe(),c=n?n.length:0,h=[],p=!i&&c>=w&&l===e,f=o||p?a():h;for(p&&(f=r(f),l=t);++s<c;){var g=n[s],m=o?o(g,s,n):g;(i?!s||f[f.length-1]!==m:0>l(f,m))&&((o||p)&&f.push(m),h.push(g))}return p?(u(f.k),d(f)):o&&u(f),h}function ue(e){return function(t,n,i){var o={};if(n=g.createCallback(n,i,3),Ht(t)){i=-1;for(var r=t.length;++i<r;){var s=t[i];e(o,s,n(s,i,t),t)}}else Xt(t,function(t,i,r){e(o,t,n(t,i,r),r)});return o}}function de(e,t,n,i,o,r){var s=1&t,a=4&t,l=16&t,c=32&t;if(!(2&t||_e(e)))throw new lt;l&&!n.length&&(t&=-17,l=n=!1),c&&!i.length&&(t&=-33,c=i=!1);var u=e&&e.__bindData__;return u&&!0!==u?(u=h(u),u[2]&&(u[2]=h(u[2])),u[3]&&(u[3]=h(u[3])),!s||1&u[1]||(u[4]=o),!s&&1&u[1]&&(t|=8),!a||4&u[1]||(u[5]=r),l&&_t.apply(u[2]||(u[2]=[]),n),c&&Tt.apply(u[3]||(u[3]=[]),i),u[1]|=t,de.apply(null,u)):(1==t||17===t?C:ne)([e,t,n,i,o,r])}function he(){Q.h=N,Q.b=Q.c=Q.g=Q.i="",Q.e="t",Q.j=!0;for(var e,t=0;e=arguments[t];t++)for(var n in e)Q[n]=e[n];t=Q.a,Q.d=/^[^,]+/.exec(t)[0],e=nt,t="return function("+t+"){",n=Q;var i="var n,t="+n.d+",E="+n.e+";if(!t)return E;"+n.i+";";n.b?(i+="var u=t.length;n=-1;if("+n.b+"){",Ut.unindexedChars&&(i+="if(s(t)){t=t.split('')}"),i+="while(++n<u){"+n.g+";}}else{"):Ut.nonEnumArgs&&(i+="var u=t.length;n=-1;if(u&&p(t)){while(++n<u){n+='';"+n.g+";}}else{"),Ut.enumPrototypes&&(i+="var G=typeof t=='function';"),Ut.enumErrorProps&&(i+="var F=t===k||t instanceof Error;");var o=[];if(Ut.enumPrototypes&&o.push('!(G&&n=="prototype")'),Ut.enumErrorProps&&o.push('!(F&&(n=="message"||n=="name"))'),n.j&&n.f)i+="var C=-1,D=B[typeof t]&&v(t),u=D?D.length:0;while(++C<u){n=D[C];",o.length&&(i+="if("+o.join("&&")+"){"),i+=n.g+";",o.length&&(i+="}"),i+="}";else if(i+="for(n in t){",n.j&&o.push("m.call(t, n)"),o.length&&(i+="if("+o.join("&&")+"){"),i+=n.g+";",o.length&&(i+="}"),i+="}",Ut.nonEnumShadows){for(i+="if(t!==A){var i=t.constructor,r=t===(i&&i.prototype),f=t===J?I:t===k?j:L.call(t),x=y[f];",k=0;7>k;k++)i+="n='"+n.h[k]+"';if((!(r&&x[n])&&m.call(t,n))",n.j||(i+="||(!x[n]&&t[n]!==A[n])"),i+="){"+n.g+"}";i+="}"}return(n.b||Ut.nonEnumArgs)&&(i+="}"),i+=n.c+";return E",e("d,j,k,m,o,p,q,s,v,A,B,y,I,J,L",t+i+"}")(te,H,ut,Ct,b,be,Ht,ke,Q.f,dt,X,Ft,q,ht,ft)}function pe(e){return Yt[e]}function fe(){var t=(t=g.indexOf)===je?e:t;return t}function ge(e){return"function"==typeof e&&gt.test(e)}function me(e){var t,n;return!e||ft.call(e)!=V||(t=e.constructor,_e(t)&&!(t instanceof t))||!Ut.argsClass&&be(e)||!Ut.nodeClass&&c(e)?!1:Ut.ownLast?(en(e,function(e,t,i){return n=Ct.call(i,t),!1}),!1!==n):(en(e,function(e,t){n=t}),"undefined"==typeof n||Ct.call(e,n))}function ve(e){return Gt[e]}function be(e){return e&&"object"==typeof e&&"number"==typeof e.length&&ft.call(e)==L||!1}function ye(e,t,n){var i=Bt(e),o=i.length;for(t=te(t,n,3);o--&&(n=i[o],!1!==t(e[n],n,e)););return e}function we(e){var t=[];return en(e,function(e,n){_e(e)&&t.push(n)}),t.sort()}function Ce(e){for(var t=-1,n=Bt(e),i=n.length,o={};++t<i;){var r=n[t];o[e[r]]=r}return o}function _e(e){return"function"==typeof e}function xe(e){return!(!e||!X[typeof e])}function Se(e){return"number"==typeof e||e&&"object"==typeof e&&ft.call(e)==B||!1}function ke(e){return"string"==typeof e||e&&"object"==typeof e&&ft.call(e)==q||!1}function Te(e){for(var t=-1,n=Bt(e),i=n.length,o=Ze(i);++t<i;)o[t]=e[n[t]];return o}function $e(e,t,n){var i=-1,o=fe(),r=e?e.length:0,s=!1;return n=(0>n?Ot(0,r+n):n)||0,Ht(e)?s=-1<o(e,t,n):"number"==typeof r?s=-1<(ke(e)?e.indexOf(t,n):o(e,t,n)):Xt(e,function(e){return++i<n?void 0:!(s=e===t)}),s}function Ee(e,t,n){var i=!0;if(t=g.createCallback(t,n,3),Ht(e)){n=-1;for(var o=e.length;++n<o&&(i=!!t(e[n],n,e)););}else Xt(e,function(e,n,o){return i=!!t(e,n,o)});return i}function De(e,t,n){var i=[];if(t=g.createCallback(t,n,3),Ht(e)){n=-1;for(var o=e.length;++n<o;){var r=e[n];t(r,n,e)&&i.push(r)}}else Xt(e,function(e,n,o){t(e,n,o)&&i.push(e)});return i}function Ie(e,t,n){if(t=g.createCallback(t,n,3),!Ht(e)){var i;return Xt(e,function(e,n,o){return t(e,n,o)?(i=e,!1):void 0}),i}n=-1;for(var o=e.length;++n<o;){var r=e[n];if(t(r,n,e))return r}}function Me(e,t,n){if(t&&"undefined"==typeof n&&Ht(e)){n=-1;for(var i=e.length;++n<i&&!1!==t(e[n],n,e););}else Xt(e,t,n);return e}function Ae(e,t,n){var i=e,o=e?e.length:0;if(t=t&&"undefined"==typeof n?t:te(t,n,3),Ht(e))for(;o--&&!1!==t(e[o],o,e););else{if("number"!=typeof o)var r=Bt(e),o=r.length;else Ut.unindexedChars&&ke(e)&&(i=e.split(""));Xt(e,function(e,n,s){return n=r?r[--o]:--o,t(i[n],n,s)})}return e}function Oe(e,t,n){var i=-1,o=e?e.length:0,r=Ze("number"==typeof o?o:0);if(t=g.createCallback(t,n,3),Ht(e))for(;++i<o;)r[i]=t(e[i],i,e);else Xt(e,function(e,n,o){r[++i]=t(e,n,o)});return r}function Re(e,t,n){var o=-1/0,r=o;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Ht(e)){n=-1;for(var s=e.length;++n<s;){var a=e[n];a>r&&(r=a)}}else t=null==t&&ke(e)?i:g.createCallback(t,n,3),Xt(e,function(e,n,i){n=t(e,n,i),n>o&&(o=n,r=e)});return r}function Pe(e,t,n,i){var o=3>arguments.length;if(t=g.createCallback(t,i,4),Ht(e)){var r=-1,s=e.length;for(o&&(n=e[++r]);++r<s;)n=t(n,e[r],r,e)}else Xt(e,function(e,i,r){n=o?(o=!1,e):t(n,e,i,r)});return n}function Ne(e,t,n,i){var o=3>arguments.length;return t=g.createCallback(t,i,4),Ae(e,function(e,i,r){n=o?(o=!1,e):t(n,e,i,r)}),n}function Le(e){var t=-1,n=e?e.length:0,i=Ze("number"==typeof n?n:0);return Me(e,function(e){var n=le(0,++t);i[t]=i[n],i[n]=e}),i}function Fe(e,t,n){var i;if(t=g.createCallback(t,n,3),Ht(e)){n=-1;for(var o=e.length;++n<o&&!(i=t(e[n],n,e)););}else Xt(e,function(e,n,o){return!(i=t(e,n,o))});return!!i}function Ue(e,t,n){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var r=-1;for(t=g.createCallback(t,n,3);++r<o&&t(e[r],r,e);)i++}else if(i=t,null==i||n)return e?e[0]:f;return h(e,0,Rt(Ot(0,i),o))}function je(t,n,i){if("number"==typeof i){var o=t?t.length:0;i=0>i?Ot(0,o+i):i||0}else if(i)return i=We(t,n),t[i]===n?i:-1;return e(t,n,i)}function He(e,t,n){if("number"!=typeof t&&null!=t){var i=0,o=-1,r=e?e.length:0;for(t=g.createCallback(t,n,3);++o<r&&t(e[o],o,e);)i++}else i=null==t||n?1:Ot(0,t);return h(e,i)}function We(e,t,n,i){var o=0,r=e?e.length:o;for(n=n?g.createCallback(n,i,1):Ge,t=n(t);r>o;)i=o+r>>>1,n(e[i])<t?o=i+1:r=i;return o}function Be(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(n=g.createCallback(n,i,3)),ce(e,t,n)}function Ve(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,n=e?Re(an(e,"length")):0,i=Ze(0>n?0:n);++t<n;)i[t]=an(e,t);return i}function ze(e,t){var n=-1,i=e?e.length:0,o={};for(t||!i||Ht(e[0])||(t=[]);++n<i;){var r=e[n];t?o[r]=t[n]:r&&(o[r[0]]=r[1])}return o}function qe(e,t){return 2<arguments.length?de(e,17,h(arguments,2),null,t):de(e,1,null,null,t)}function Ye(e,t,n){var i,o,r,s,a,l,c,u=0,d=!1,h=!0;if(!_e(e))throw new lt;if(t=Ot(0,t)||0,!0===n)var p=!0,h=!1;else xe(n)&&(p=n.leading,d="maxWait"in n&&(Ot(t,n.maxWait)||0),h="trailing"in n?n.trailing:h);var g=function(){var n=t-(ln()-s);n>0?l=St(g,n):(o&&vt(o),n=c,o=l=c=f,n&&(u=ln(),r=e.apply(a,i),l||o||(i=a=null)))},m=function(){l&&vt(l),o=l=c=f,(h||d!==t)&&(u=ln(),r=e.apply(a,i),l||o||(i=a=null))};return function(){if(i=arguments,s=ln(),a=this,c=h&&(l||!p),!1===d)var n=p&&!l;else{o||p||(u=s);var f=d-(s-u),v=0>=f;v?(o&&(o=vt(o)),u=s,r=e.apply(a,i)):o||(o=St(m,f))}return v&&l?l=vt(l):l||t===d||(l=St(g,t)),n&&(v=!0,r=e.apply(a,i)),!v||l||o||(i=a=null),r}}function Ge(e){return e}function Ke(e,t,n){var i=!0,o=t&&we(t);t&&(n||o.length)||(null==n&&(n=t),r=m,t=e,e=g,o=we(t)),!1===n?i=!1:xe(n)&&"chain"in n&&(i=n.chain);var r=e,s=_e(r);Me(o,function(n){var o=e[n]=t[n];s&&(r.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,s=[n];if(_t.apply(s,arguments),s=o.apply(e,s),i||t){if(n===s&&xe(s))return this;s=new r(s),s.__chain__=t}return s})})}function Qe(){}function Xe(e){return function(t){return t[e]}}function Je(){return this.__wrapped__}n=n?oe.defaults(Z.Object(),n,oe.pick(Z,P)):Z;var Ze=n.Array,et=n.Boolean,tt=n.Date,nt=n.Function,it=n.Math,ot=n.Number,rt=n.Object,st=n.RegExp,at=n.String,lt=n.TypeError,ct=[],ut=n.Error.prototype,dt=rt.prototype,ht=at.prototype,pt=n._,ft=dt.toString,gt=st("^"+at(ft).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),mt=it.ceil,vt=n.clearTimeout,bt=it.floor,yt=nt.prototype.toString,wt=ge(wt=rt.getPrototypeOf)&&wt,Ct=dt.hasOwnProperty,_t=ct.push,xt=dt.propertyIsEnumerable,St=n.setTimeout,kt=ct.splice,Tt=ct.unshift,$t=function(){try{var e={},t=ge(t=rt.defineProperty)&&t,n=t(e,e,e)&&t}catch(i){}return n}(),Et=ge(Et=rt.create)&&Et,Dt=ge(Dt=Ze.isArray)&&Dt,It=n.isFinite,Mt=n.isNaN,At=ge(At=rt.keys)&&At,Ot=it.max,Rt=it.min,Pt=n.parseInt,Nt=it.random,Lt={};Lt[F]=Ze,Lt[U]=et,Lt[j]=tt,Lt[W]=nt,Lt[V]=rt,Lt[B]=ot,Lt[z]=st,Lt[q]=at;var Ft={};Ft[F]=Ft[j]=Ft[B]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Ft[U]=Ft[q]={constructor:!0,toString:!0,valueOf:!0},Ft[H]=Ft[W]=Ft[z]={constructor:!0,toString:!0},Ft[V]={constructor:!0},function(){for(var e=N.length;e--;){var t,n=N[e];for(t in Ft)Ct.call(Ft,t)&&!Ct.call(Ft[t],n)&&(Ft[t][n]=!1)}}(),m.prototype=g.prototype;var Ut=g.support={};!function(){var e=function(){this.x=1},t={0:1,length:1},i=[];e.prototype={valueOf:1,y:1};for(var o in new e)i.push(o);for(o in arguments);Ut.argsClass=ft.call(arguments)==L,Ut.argsObject=arguments.constructor==rt&&!(arguments instanceof Ze),Ut.enumErrorProps=xt.call(ut,"message")||xt.call(ut,"name"),Ut.enumPrototypes=xt.call(e,"prototype"),Ut.funcDecomp=!ge(n.WinRTError)&&O.test(p),Ut.funcNames="string"==typeof nt.name,Ut.nonEnumArgs=0!=o,Ut.nonEnumShadows=!/valueOf/.test(i),Ut.ownLast="x"!=i[0],Ut.spliceObjects=(ct.splice.call(t,0,1),!t[0]),Ut.unindexedChars="xx"!="x"[0]+rt("x")[0];try{Ut.nodeClass=!(ft.call(document)==V&&!({toString:0}+""))}catch(r){Ut.nodeClass=!0}}(1),g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:I,variable:"",imports:{_:g}},Et||(ee=function(){function e(){}return function(t){if(xe(t)){e.prototype=t;var i=new e;e.prototype=null}return i||n.Object()}}());var jt=$t?function(e,t){K.value=t,$t(e,"__bindData__",K)}:Qe;Ut.argsClass||(be=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Ct.call(e,"callee")&&!xt.call(e,"callee")||!1});var Ht=Dt||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&ft.call(e)==F||!1},Wt=he({a:"z",e:"[]",i:"if(!(B[typeof z]))return E",g:"E.push(n)"}),Bt=At?function(e){return xe(e)?Ut.enumPrototypes&&"function"==typeof e||Ut.nonEnumArgs&&e.length&&be(e)?Wt(e):At(e):[]}:Wt,Vt={a:"g,e,K",i:"e=e&&typeof K=='undefined'?e:d(e,K,3)",b:"typeof u=='number'",v:Bt,g:"if(e(t[n],n,g)===false)return E"},zt={a:"z,H,l",i:"var a=arguments,b=0,c=typeof l=='number'?2:a.length;while(++b<c){t=a[b];if(t&&B[typeof t]){",v:Bt,g:"if(typeof E[n]=='undefined')E[n]=t[n]",c:"}}"},qt={i:"if(!B[typeof t])return E;"+Vt.i,b:!1},Yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Gt=Ce(Yt),Kt=st("("+Bt(Gt).join("|")+")","g"),Qt=st("["+Bt(Yt).join("")+"]","g"),Xt=he(Vt),Jt=he(zt,{i:zt.i.replace(";",";if(c>3&&typeof a[c-2]=='function'){var e=d(a[--c-1],a[c--],2)}else if(c>2&&typeof a[c-1]=='function'){e=a[--c]}"),g:"E[n]=e?e(E[n],t[n]):t[n]"}),Zt=he(zt),en=he(Vt,qt,{j:!1}),tn=he(Vt,qt);_e(/x/)&&(_e=function(e){return"function"==typeof e&&ft.call(e)==W});var nn=wt?function(e){if(!e||ft.call(e)!=V||!Ut.argsClass&&be(e))return!1;var t=e.valueOf,n=ge(t)&&(n=wt(t))&&wt(n);return n?e==n||wt(e)==n:me(e)}:me,on=ue(function(e,t,n){Ct.call(e,n)?e[n]++:e[n]=1}),rn=ue(function(e,t,n){(Ct.call(e,n)?e[n]:e[n]=[]).push(t)}),sn=ue(function(e,t,n){e[n]=t}),an=Oe,ln=ge(ln=tt.now)&&ln||function(){return(new tt).getTime()},cn=8==Pt(_+"08")?Pt:function(e,t){return Pt(ke(e)?e.replace(M,""):e,t||0)};return g.after=function(e,t){if(!_e(t))throw new lt;return function(){return 1>--e?t.apply(this,arguments):void 0}},g.assign=Jt,g.at=function(e){var t=arguments,n=-1,i=re(t,!0,!1,1),t=t[2]&&t[2][t[1]]===e?1:i.length,o=Ze(t);for(Ut.unindexedChars&&ke(e)&&(e=e.split(""));++n<t;)o[n]=e[i[n]];return o},g.bind=qe,g.bindAll=function(e){for(var t=1<arguments.length?re(arguments,!0,!1,1):we(e),n=-1,i=t.length;++n<i;){var o=t[n];e[o]=de(e[o],1,null,null,e)}return e},g.bindKey=function(e,t){return 2<arguments.length?de(t,19,h(arguments,2),null,e):de(t,3,null,null,e)},g.chain=function(e){return e=new m(e),e.__chain__=!0,e},g.compact=function(e){for(var t=-1,n=e?e.length:0,i=[];++t<n;){var o=e[t];o&&i.push(o)}return i},g.compose=function(){for(var e=arguments,t=e.length;t--;)if(!_e(e[t]))throw new lt;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},g.constant=function(e){return function(){return e}},g.countBy=on,g.create=function(e,t){var n=ee(e);return t?Jt(n,t):n},g.createCallback=function(e,t,n){var i=typeof e;if(null==e||"function"==i)return te(e,t,n);if("object"!=i)return Xe(e);var o=Bt(e),r=o[0],s=e[r];return 1!=o.length||s!==s||xe(s)?function(t){for(var n=o.length,i=!1;n--&&(i=se(t[o[n]],e[o[n]],null,!0)););return i}:function(e){return e=e[r],s===e&&(0!==s||1/s==1/e)}},g.curry=function(e,t){return t="number"==typeof t?t:+t||e.length,de(e,4,null,null,null,t)},g.debounce=Ye,g.defaults=Zt,g.defer=function(e){if(!_e(e))throw new lt;var t=h(arguments,1);return St(function(){e.apply(f,t)},1)},g.delay=function(e,t){if(!_e(e))throw new lt;var n=h(arguments,2);return St(function(){e.apply(f,n)},t)},g.difference=function(e){return ie(e,re(arguments,!0,!0,1))},g.filter=De,g.flatten=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(e=Oe(e,n,i)),re(e,t)},g.forEach=Me,g.forEachRight=Ae,g.forIn=en,g.forInRight=function(e,t,n){var i=[];en(e,function(e,t){i.push(t,e)});var o=i.length;for(t=te(t,n,3);o--&&!1!==t(i[o--],i[o],e););return e},g.forOwn=tn,g.forOwnRight=ye,g.functions=we,g.groupBy=rn,g.indexBy=sn,g.initial=function(e,t,n){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var r=o;for(t=g.createCallback(t,n,3);r--&&t(e[r],r,e);)i++}else i=null==t||n?1:t||i;return h(e,0,Rt(Ot(0,o-i),o))},g.intersection=function(){for(var n=[],i=-1,o=arguments.length,s=a(),l=fe(),c=l===e,h=a();++i<o;){var p=arguments[i];(Ht(p)||be(p))&&(n.push(p),s.push(c&&p.length>=w&&r(i?n[i]:h)))}var c=n[0],f=-1,g=c?c.length:0,m=[];e:for(;++f<g;){var v=s[0],p=c[f];if(0>(v?t(v,p):l(h,p))){for(i=o,(v||h).push(p);--i;)if(v=s[i],0>(v?t(v,p):l(n[i],p)))continue e;m.push(p)}}for(;o--;)(v=s[o])&&d(v);return u(s),u(h),m},g.invert=Ce,g.invoke=function(e,t){var n=h(arguments,2),i=-1,o="function"==typeof t,r=e?e.length:0,s=Ze("number"==typeof r?r:0);return Me(e,function(e){s[++i]=(o?t:e[t]).apply(e,n)}),s},g.keys=Bt,g.map=Oe,g.mapValues=function(e,t,n){var i={};return t=g.createCallback(t,n,3),tn(e,function(e,n,o){i[n]=t(e,n,o)}),i},g.max=Re,g.memoize=function(e,t){if(!_e(e))throw new lt;var n=function(){var i=n.cache,o=t?t.apply(this,arguments):y+arguments[0];return Ct.call(i,o)?i[o]:i[o]=e.apply(this,arguments)};return n.cache={},n},g.merge=function(e){var t=arguments,n=2;if(!xe(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var i=te(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(i=t[--n]);for(var t=h(arguments,1,n),o=-1,r=a(),s=a();++o<n;)ae(e,t[o],i,r,s);return u(r),u(s),e},g.min=function(e,t,n){var o=1/0,r=o;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Ht(e)){n=-1;for(var s=e.length;++n<s;){var a=e[n];r>a&&(r=a)}}else t=null==t&&ke(e)?i:g.createCallback(t,n,3),Xt(e,function(e,n,i){n=t(e,n,i),o>n&&(o=n,r=e)});return r},g.omit=function(e,t,n){var i={};if("function"!=typeof t){var o=[];en(e,function(e,t){o.push(t)});for(var o=ie(o,re(arguments,!0,!1,1)),r=-1,s=o.length;++r<s;){var a=o[r];i[a]=e[a]}}else t=g.createCallback(t,n,3),en(e,function(e,n,o){t(e,n,o)||(i[n]=e)});return i},g.once=function(e){var t,n;if(!_e(e))throw new lt;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},g.pairs=function(e){for(var t=-1,n=Bt(e),i=n.length,o=Ze(i);++t<i;){var r=n[t];o[t]=[r,e[r]]}return o},g.partial=function(e){
return de(e,16,h(arguments,1))},g.partialRight=function(e){return de(e,32,null,h(arguments,1))},g.pick=function(e,t,n){var i={};if("function"!=typeof t)for(var o=-1,r=re(arguments,!0,!1,1),s=xe(e)?r.length:0;++o<s;){var a=r[o];a in e&&(i[a]=e[a])}else t=g.createCallback(t,n,3),en(e,function(e,n,o){t(e,n,o)&&(i[n]=e)});return i},g.pluck=an,g.property=Xe,g.pull=function(e){for(var t=arguments,n=0,i=t.length,o=e?e.length:0;++n<i;)for(var r=-1,s=t[n];++r<o;)e[r]===s&&(kt.call(e,r--,1),o--);return e},g.range=function(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);var i=-1;t=Ot(0,mt((t-e)/(n||1)));for(var o=Ze(t);++i<t;)o[i]=e,e+=n;return o},g.reject=function(e,t,n){return t=g.createCallback(t,n,3),De(e,function(e,n,i){return!t(e,n,i)})},g.remove=function(e,t,n){var i=-1,o=e?e.length:0,r=[];for(t=g.createCallback(t,n,3);++i<o;)n=e[i],t(n,i,e)&&(r.push(n),kt.call(e,i--,1),o--);return r},g.rest=He,g.shuffle=Le,g.sortBy=function(e,t,n){var i=-1,r=Ht(t),s=e?e.length:0,c=Ze("number"==typeof s?s:0);for(r||(t=g.createCallback(t,n,3)),Me(e,function(e,n,o){var s=c[++i]=l();r?s.m=Oe(t,function(t){return e[t]}):(s.m=a())[0]=t(e,n,o),s.n=i,s.o=e}),s=c.length,c.sort(o);s--;)e=c[s],c[s]=e.o,r||u(e.m),d(e);return c},g.tap=function(e,t){return t(e),e},g.throttle=function(e,t,n){var i=!0,o=!0;if(!_e(e))throw new lt;return!1===n?i=!1:xe(n)&&(i="leading"in n?n.leading:i,o="trailing"in n?n.trailing:o),G.leading=i,G.maxWait=t,G.trailing=o,Ye(e,t,G)},g.times=function(e,t,n){e=-1<(e=+e)?e:0;var i=-1,o=Ze(e);for(t=te(t,n,1);++i<e;)o[i]=t(i);return o},g.toArray=function(e){return e&&"number"==typeof e.length?Ut.unindexedChars&&ke(e)?e.split(""):h(e):Te(e)},g.transform=function(e,t,n,i){var o=Ht(e);if(null==n)if(o)n=[];else{var r=e&&e.constructor;n=ee(r&&r.prototype)}return t&&(t=g.createCallback(t,i,4),(o?Xt:tn)(e,function(e,i,o){return t(n,e,i,o)})),n},g.union=function(){return ce(re(arguments,!0,!0))},g.uniq=Be,g.values=Te,g.where=De,g.without=function(e){return ie(e,h(arguments,1))},g.wrap=function(e,t){return de(t,16,[e])},g.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Ht(n)||be(n))var i=i?ce(ie(i,n).concat(ie(n,i))):n}return i||[]},g.zip=Ve,g.zipObject=ze,g.collect=Oe,g.drop=He,g.each=Me,g.eachRight=Ae,g.extend=Jt,g.methods=we,g.object=ze,g.select=De,g.tail=He,g.unique=Be,g.unzip=Ve,Ke(g),g.clone=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1),J(e,t,"function"==typeof n&&te(n,i,1))},g.cloneDeep=function(e,t,n){return J(e,!0,"function"==typeof t&&te(t,n,1))},g.contains=$e,g.escape=function(e){return null==e?"":at(e).replace(Qt,pe)},g.every=Ee,g.find=Ie,g.findIndex=function(e,t,n){var i=-1,o=e?e.length:0;for(t=g.createCallback(t,n,3);++i<o;)if(t(e[i],i,e))return i;return-1},g.findKey=function(e,t,n){var i;return t=g.createCallback(t,n,3),tn(e,function(e,n,o){return t(e,n,o)?(i=n,!1):void 0}),i},g.findLast=function(e,t,n){var i;return t=g.createCallback(t,n,3),Ae(e,function(e,n,o){return t(e,n,o)?(i=e,!1):void 0}),i},g.findLastIndex=function(e,t,n){var i=e?e.length:0;for(t=g.createCallback(t,n,3);i--;)if(t(e[i],i,e))return i;return-1},g.findLastKey=function(e,t,n){var i;return t=g.createCallback(t,n,3),ye(e,function(e,n,o){return t(e,n,o)?(i=n,!1):void 0}),i},g.has=function(e,t){return e?Ct.call(e,t):!1},g.identity=Ge,g.indexOf=je,g.isArguments=be,g.isArray=Ht,g.isBoolean=function(e){return!0===e||!1===e||e&&"object"==typeof e&&ft.call(e)==U||!1},g.isDate=function(e){return e&&"object"==typeof e&&ft.call(e)==j||!1},g.isElement=function(e){return e&&1===e.nodeType||!1},g.isEmpty=function(e){var t=!0;if(!e)return t;var n=ft.call(e),i=e.length;return n==F||n==q||(Ut.argsClass?n==L:be(e))||n==V&&"number"==typeof i&&_e(e.splice)?!i:(tn(e,function(){return t=!1}),t)},g.isEqual=function(e,t,n,i){return se(e,t,"function"==typeof n&&te(n,i,2))},g.isFinite=function(e){return It(e)&&!Mt(parseFloat(e))},g.isFunction=_e,g.isNaN=function(e){return Se(e)&&e!=+e},g.isNull=function(e){return null===e},g.isNumber=Se,g.isObject=xe,g.isPlainObject=nn,g.isRegExp=function(e){return e&&X[typeof e]&&ft.call(e)==z||!1},g.isString=ke,g.isUndefined=function(e){return"undefined"==typeof e},g.lastIndexOf=function(e,t,n){var i=e?e.length:0;for("number"==typeof n&&(i=(0>n?Ot(0,i+n):Rt(n,i-1))+1);i--;)if(e[i]===t)return i;return-1},g.mixin=Ke,g.noConflict=function(){return n._=pt,this},g.noop=Qe,g.now=ln,g.parseInt=cn,g.random=function(e,t,n){var i=null==e,o=null==t;return null==n&&("boolean"==typeof e&&o?(n=e,e=1):o||"boolean"!=typeof t||(n=t,o=!0)),i&&o&&(t=1),e=+e||0,o?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=Nt(),Rt(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):le(e,t)},g.reduce=Pe,g.reduceRight=Ne,g.result=function(e,t){if(e){var n=e[t];return _e(n)?e[t]():n}},g.runInContext=p,g.size=function(e){var t=e?e.length:0;return"number"==typeof t?t:Bt(e).length},g.some=Fe,g.sortedIndex=We,g.template=function(e,t,n){var i=g.templateSettings;e=at(e||""),n=Zt({},n,i);var o,r=Zt({},n.imports,i.imports),i=Bt(r),r=Te(r),a=0,l=n.interpolate||A,c="__p+='",l=st((n.escape||A).source+"|"+l.source+"|"+(l===I?$:A).source+"|"+(n.evaluate||A).source+"|$","g");e.replace(l,function(t,n,i,r,l,u){return i||(i=r),c+=e.slice(a,u).replace(R,s),n&&(c+="'+__e("+n+")+'"),l&&(o=!0,c+="';"+l+";\n__p+='"),i&&(c+="'+((__t=("+i+"))==null?'':__t)+'"),a=u+t.length,t}),c+="';",l=n=n.variable,l||(n="obj",c="with("+n+"){"+c+"}"),c=(o?c.replace(x,""):c).replace(S,"$1").replace(T,"$1;"),c="function("+n+"){"+(l?"":n+"||("+n+"={});")+"var __t,__p='',__e=_.escape"+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+c+"return __p}";try{var u=nt(i,"return "+c).apply(f,r)}catch(d){throw d.source=c,d}return t?u(t):(u.source=c,u)},g.unescape=function(e){return null==e?"":at(e).replace(Kt,ve)},g.uniqueId=function(e){var t=++v;return at(null==e?"":e)+t},g.all=Ee,g.any=Fe,g.detect=Ie,g.findWhere=Ie,g.foldl=Pe,g.foldr=Ne,g.include=$e,g.inject=Pe,Ke(function(){var e={};return tn(g,function(t,n){g.prototype[n]||(e[n]=t)}),e}(),!1),g.first=Ue,g.last=function(e,t,n){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var r=o;for(t=g.createCallback(t,n,3);r--&&t(e[r],r,e);)i++}else if(i=t,null==i||n)return e?e[o-1]:f;return h(e,Ot(0,o-i))},g.sample=function(e,t,n){return e&&"number"!=typeof e.length?e=Te(e):Ut.unindexedChars&&ke(e)&&(e=e.split("")),null==t||n?e?e[le(0,e.length-1)]:f:(e=Le(e),e.length=Rt(Ot(0,t),e.length),e)},g.take=Ue,g.head=Ue,tn(g,function(e,t){var n="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,i){var o=this.__chain__,r=e(this.__wrapped__,t,i);return o||null!=t&&(!i||n&&"function"==typeof t)?new m(r,o):r})}),g.VERSION="2.4.1",g.prototype.chain=function(){return this.__chain__=!0,this},g.prototype.toString=function(){return at(this.__wrapped__)},g.prototype.value=Je,g.prototype.valueOf=Je,Xt(["join","pop","shift"],function(e){var t=ct[e];g.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new m(n,e):n}}),Xt(["push","reverse","sort","unshift"],function(e){var t=ct[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Xt(["concat","slice","splice"],function(e){var t=ct[e];g.prototype[e]=function(){return new m(t.apply(this.__wrapped__,arguments),this.__chain__)}}),Ut.spliceObjects||Xt(["pop","shift","splice"],function(e){var t=ct[e],n="splice"==e;g.prototype[e]=function(){var e=this.__chain__,i=this.__wrapped__,o=t.apply(i,arguments);return 0===i.length&&delete i[0],e||n?new m(o,e):o}}),g}var f,g=[],m=[],v=0,b={},y=+new Date+"",w=75,C=40,_=" 	\f \ufeff\n\r\u2028\u2029 ᠎             　",x=/\b__p\+='';/g,S=/\b(__p\+=)''\+/g,T=/(__e\(.*?\)|\b__t\))\+'';/g,$=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,E=/\w*$/,D=/^\s*function[ \n\r\t]+\w/,I=/<%=([\s\S]+?)%>/g,M=RegExp("^["+_+"]*0+(?=.$)"),A=/($^)/,O=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,P="Array Boolean Date Error Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),L="[object Arguments]",F="[object Array]",U="[object Boolean]",j="[object Date]",H="[object Error]",W="[object Function]",B="[object Number]",V="[object Object]",z="[object RegExp]",q="[object String]",Y={};Y[W]=!1,Y[L]=Y[F]=Y[U]=Y[j]=Y[B]=Y[V]=Y[z]=Y[q]=!0;var G={leading:!1,maxWait:0,trailing:!1},K={configurable:!1,enumerable:!1,value:null,writable:!1},Q={a:"",b:null,c:"",d:"",e:"",v:null,g:"",h:null,support:null,i:"",j:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},J={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=X[typeof window]&&window||this,ee=X[typeof exports]&&exports&&!exports.nodeType&&exports,te=X[typeof module]&&module&&!module.nodeType&&module,ne=te&&te.exports===ee&&ee,ie=X[typeof global]&&global;!ie||ie.global!==ie&&ie.window!==ie||(Z=ie);var oe=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=oe,define(function(){return oe})):ee&&te?ne?(te.exports=oe)._=oe:ee._=oe:Z._=oe}.call(this),!function(){var e=angular.module("restangular",[]);e.provider("Restangular",function(){var e={};e.init=function(e,t){function n(e,t,n,i){var o={};return _.each(_.keys(i),function(r){var s=i[r];s.params=_.extend({},s.params,e.defaultRequestParams[s.method.toLowerCase()]),_.isEmpty(s.params)&&delete s.params,o[r]=e.isSafe(s.method)?function(){return t(_.extend(s,{url:n}))}:function(e){return t(_.extend(s,{url:n,data:e}))}}),o}e.configuration=t;var i=["get","head","options","trace","getlist"];t.isSafe=function(e){return _.contains(i,e.toLowerCase())};var o=/^https?:\/\//i;t.isAbsoluteUrl=function(e){return _.isUndefined(t.absoluteUrl)||_.isNull(t.absoluteUrl)?e&&o.test(e):t.absoluteUrl},t.absoluteUrl=_.isUndefined(t.absoluteUrl)?!0:t.absoluteUrl,e.setSelfLinkAbsoluteUrl=function(e){t.absoluteUrl=e},t.baseUrl=_.isUndefined(t.baseUrl)?"":t.baseUrl,e.setBaseUrl=function(e){return t.baseUrl=/\/$/.test(e)?e.substring(0,e.length-1):e,this},t.extraFields=t.extraFields||[],e.setExtraFields=function(e){return t.extraFields=e,this},t.defaultHttpFields=t.defaultHttpFields||{},e.setDefaultHttpFields=function(e){return t.defaultHttpFields=e,this},t.withHttpValues=function(e,n){return _.defaults(n,e,t.defaultHttpFields)},t.encodeIds=_.isUndefined(t.encodeIds)?!0:t.encodeIds,e.setEncodeIds=function(e){t.encodeIds=e},t.defaultRequestParams=t.defaultRequestParams||{get:{},post:{},put:{},remove:{},common:{}},e.setDefaultRequestParams=function(e,n){var i=[],o=n||e;return _.isUndefined(n)?i.push("common"):_.isArray(e)?i=e:i.push(e),_.each(i,function(e){t.defaultRequestParams[e]=o}),this},e.requestParams=t.defaultRequestParams,t.defaultHeaders=t.defaultHeaders||{},e.setDefaultHeaders=function(n){return t.defaultHeaders=n,e.defaultHeaders=t.defaultHeaders,this},e.defaultHeaders=t.defaultHeaders,t.methodOverriders=t.methodOverriders||[],e.setMethodOverriders=function(e){var n=_.extend([],e);return t.isOverridenMethod("delete",n)&&n.push("remove"),t.methodOverriders=n,this},t.jsonp=_.isUndefined(t.jsonp)?!1:t.jsonp,e.setJsonp=function(e){t.jsonp=e},t.isOverridenMethod=function(e,n){var i=n||t.methodOverriders;return!_.isUndefined(_.find(i,function(t){return t.toLowerCase()===e.toLowerCase()}))},t.urlCreator=t.urlCreator||"path",e.setUrlCreator=function(e){if(!_.has(t.urlCreatorFactory,e))throw new Error("URL Path selected isn't valid");return t.urlCreator=e,this},t.restangularFields=t.restangularFields||{id:"id",route:"route",parentResource:"parentResource",restangularCollection:"restangularCollection",cannonicalId:"__cannonicalId",etag:"restangularEtag",selfLink:"href",get:"get",getList:"getList",put:"put",post:"post",remove:"remove",head:"head",trace:"trace",options:"options",patch:"patch",getRestangularUrl:"getRestangularUrl",getRequestedUrl:"getRequestedUrl",putElement:"putElement",addRestangularMethod:"addRestangularMethod",getParentList:"getParentList",clone:"clone",ids:"ids",httpConfig:"_$httpConfig",reqParams:"reqParams",one:"one",all:"all",several:"several",oneUrl:"oneUrl",allUrl:"allUrl",customPUT:"customPUT",customPOST:"customPOST",customDELETE:"customDELETE",customGET:"customGET",customGETLIST:"customGETLIST",customOperation:"customOperation",doPUT:"doPUT",doPOST:"doPOST",doDELETE:"doDELETE",doGET:"doGET",doGETLIST:"doGETLIST",fromServer:"fromServer",withConfig:"withConfig",withHttpConfig:"withHttpConfig",singleOne:"singleOne",plain:"plain",save:"save"},e.setRestangularFields=function(e){return t.restangularFields=_.extend(t.restangularFields,e),this},t.isRestangularized=function(e){return!!e[t.restangularFields.one]||!!e[t.restangularFields.all]},t.setFieldToElem=function(e,t,n){var i=e.split("."),o=t;return _.each(_.initial(i),function(e){o[e]={},o=o[e]}),o[_.last(i)]=n,this},t.getFieldFromElem=function(e,t){var n=e.split("."),i=t;return _.each(n,function(e){i&&(i=i[e])}),angular.copy(i)},t.setIdToElem=function(e,n){return t.setFieldToElem(t.restangularFields.id,e,n),this},t.getIdFromElem=function(e){return t.getFieldFromElem(t.restangularFields.id,e)},t.isValidId=function(e){return""!==e&&!_.isUndefined(e)&&!_.isNull(e)},t.setUrlToElem=function(e,n){return t.setFieldToElem(t.restangularFields.selfLink,e,n),this},t.getUrlFromElem=function(e){return t.getFieldFromElem(t.restangularFields.selfLink,e)},t.useCannonicalId=_.isUndefined(t.useCannonicalId)?!1:t.useCannonicalId,e.setUseCannonicalId=function(e){return t.useCannonicalId=e,this},t.getCannonicalIdFromElem=function(e){var n=e[t.restangularFields.cannonicalId],i=t.isValidId(n)?n:t.getIdFromElem(e);return i},t.responseInterceptors=t.responseInterceptors||[],t.defaultResponseInterceptor=function(e){return e},t.responseExtractor=function(e,n,i,o,r,s){var a=angular.copy(t.responseInterceptors);a.push(t.defaultResponseInterceptor);var l=e;return _.each(a,function(e){l=e(l,n,i,o,r,s)}),l},e.addResponseInterceptor=function(e){return t.responseInterceptors.push(e),this},e.setResponseInterceptor=e.addResponseInterceptor,e.setResponseExtractor=e.addResponseInterceptor,t.requestInterceptors=t.requestInterceptors||[],t.defaultInterceptor=function(e,t,n,i,o,r,s){return{element:e,headers:o,params:r,httpConfig:s}},t.fullRequestInterceptor=function(e,n,i,o,r,s,a){var l=angular.copy(t.requestInterceptors),c=t.defaultInterceptor(e,n,i,o,r,s,a);return _.reduce(l,function(e,t){return _.extend(e,t(e.element,n,i,o,e.headers,e.params,e.httpConfig))},c)},e.addRequestInterceptor=function(e){return t.requestInterceptors.push(function(t,n,i,o,r,s,a){return{headers:r,params:s,element:e(t,n,i,o),httpConfig:a}}),this},e.setRequestInterceptor=e.addRequestInterceptor,e.addFullRequestInterceptor=function(e){return t.requestInterceptors.push(e),this},e.setFullRequestInterceptor=e.addFullRequestInterceptor,t.errorInterceptor=t.errorInterceptor||function(){},e.setErrorInterceptor=function(e){return t.errorInterceptor=e,this},t.onBeforeElemRestangularized=t.onBeforeElemRestangularized||function(e){return e},e.setOnBeforeElemRestangularized=function(e){return t.onBeforeElemRestangularized=e,this},t.onElemRestangularized=t.onElemRestangularized||function(e){return e},e.setOnElemRestangularized=function(e){return t.onElemRestangularized=e,this},t.shouldSaveParent=t.shouldSaveParent||function(){return!0},e.setParentless=function(e){return _.isArray(e)?t.shouldSaveParent=function(t){return!_.contains(e,t)}:_.isBoolean(e)&&(t.shouldSaveParent=function(){return!e}),this},t.suffix=_.isUndefined(t.suffix)?null:t.suffix,e.setRequestSuffix=function(e){return t.suffix=e,this},t.transformers=t.transformers||{},e.addElementTransformer=function(n,i,o){var r=null,s=null;2===arguments.length?s=i:(s=o,r=i);var a=t.transformers[n];return a||(a=t.transformers[n]=[]),a.push(function(e,t){return _.isNull(r)||e==r?s(t):t}),e},e.extendCollection=function(t,n){return e.addElementTransformer(t,!0,n)},e.extendModel=function(t,n){return e.addElementTransformer(t,!1,n)},t.transformElem=function(e,n,i,o,r){if(!r&&!t.transformLocalElements&&!e[t.restangularFields.fromServer])return e;var s=t.transformers[i],a=e;return s&&_.each(s,function(e){a=e(n,a)}),t.onElemRestangularized(a,n,i,o)},t.transformLocalElements=_.isUndefined(t.transformLocalElements)?!1:t.transformLocalElements,e.setTransformOnlyServerElements=function(e){t.transformLocalElements=!e},t.fullResponse=_.isUndefined(t.fullResponse)?!1:t.fullResponse,e.setFullResponse=function(e){return t.fullResponse=e,this},t.urlCreatorFactory={};var r=function(){};r.prototype.setConfig=function(e){return this.config=e,this},r.prototype.parentsArray=function(e){for(var t=[];e;)t.push(e),e=e[this.config.restangularFields.parentResource];return t.reverse()},r.prototype.resource=function(e,i,o,r,s,a,l,c){var u=_.defaults(s||{},this.config.defaultRequestParams.common),d=_.defaults(r||{},this.config.defaultHeaders);l&&(t.isSafe(c)?d["If-None-Match"]=l:d["If-Match"]=l);var h=this.base(e);if(a){var p="";/\/$/.test(h)||(p+="/"),p+=a,h+=p}return this.config.suffix&&-1===h.indexOf(this.config.suffix,h.length-this.config.suffix.length)&&!this.config.getUrlFromElem(e)&&(h+=this.config.suffix),e[this.config.restangularFields.httpConfig]=void 0,n(this.config,i,h,{getList:this.config.withHttpValues(o,{method:"GET",params:u,headers:d}),get:this.config.withHttpValues(o,{method:"GET",params:u,headers:d}),jsonp:this.config.withHttpValues(o,{method:"jsonp",params:u,headers:d}),put:this.config.withHttpValues(o,{method:"PUT",params:u,headers:d}),post:this.config.withHttpValues(o,{method:"POST",params:u,headers:d}),remove:this.config.withHttpValues(o,{method:"DELETE",params:u,headers:d}),head:this.config.withHttpValues(o,{method:"HEAD",params:u,headers:d}),trace:this.config.withHttpValues(o,{method:"TRACE",params:u,headers:d}),options:this.config.withHttpValues(o,{method:"OPTIONS",params:u,headers:d}),patch:this.config.withHttpValues(o,{method:"PATCH",params:u,headers:d})})};var s=function(){};s.prototype=new r,s.prototype.base=function(e){var n=this;return _.reduce(this.parentsArray(e),function(e,i){var o,r=n.config.getUrlFromElem(i);if(r){if(n.config.isAbsoluteUrl(r))return r;o=r}else if(o=i[n.config.restangularFields.route],i[n.config.restangularFields.restangularCollection]){var s=i[n.config.restangularFields.ids];s&&(o+="/"+s.join(","))}else{var a;a=n.config.useCannonicalId?n.config.getCannonicalIdFromElem(i):n.config.getIdFromElem(i),t.isValidId(a)&&!i.singleOne&&(o+="/"+(n.config.encodeIds?encodeURIComponent(a):a))}return e.replace(/\/$/,"")+"/"+o},this.config.baseUrl)},s.prototype.fetchUrl=function(e,t){var n=this.base(e);return t&&(n+="/"+t),n},s.prototype.fetchRequestedUrl=function(e,n){function i(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t.sort()}function o(e,t,n){for(var o=i(e),r=0;r<o.length;r++)t.call(n,e[o[r]],o[r]);return o}function r(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}var s=this.fetchUrl(e,n),a=e[t.restangularFields.reqParams];if(!a)return s;var l=[];return o(a,function(e,t){null!=e&&void 0!=e&&(angular.isArray(e)||(e=[e]),angular.forEach(e,function(e){angular.isObject(e)&&(e=angular.toJson(e)),l.push(r(t)+"="+r(e))}))}),s+(this.config.suffix||"")+(-1===s.indexOf("?")?"?":"&")+l.join("&")},t.urlCreatorFactory.path=s};var t={};e.init(this,t),this.$get=["$http","$q",function(n,i){function o(t){function r(e,n,i,o,r){if(n[t.restangularFields.route]=i,n[t.restangularFields.getRestangularUrl]=_.bind(W.fetchUrl,W,n),n[t.restangularFields.getRequestedUrl]=_.bind(W.fetchRequestedUrl,W,n),n[t.restangularFields.addRestangularMethod]=_.bind(F,n),n[t.restangularFields.clone]=_.bind(v,n,n),n[t.restangularFields.reqParams]=_.isEmpty(o)?null:o,n[t.restangularFields.withHttpConfig]=_.bind(T,n),n[t.restangularFields.plain]=_.bind(g,n,n),n[t.restangularFields.one]=_.bind(s,n,n),n[t.restangularFields.all]=_.bind(a,n,n),n[t.restangularFields.several]=_.bind(l,n,n),n[t.restangularFields.oneUrl]=_.bind(c,n,n),n[t.restangularFields.allUrl]=_.bind(u,n,n),n[t.restangularFields.fromServer]=!!r,e&&t.shouldSaveParent(i)){var d=t.getIdFromElem(e),h=t.getUrlFromElem(e),p=_.union(_.values(_.pick(t.restangularFields,["route","singleOne","parentResource"])),t.extraFields),f=_.pick(e,p);t.isValidId(d)&&t.setIdToElem(f,d),t.isValidId(h)&&t.setUrlToElem(f,h),n[t.restangularFields.parentResource]=f}else n[t.restangularFields.parentResource]=null;return n}function s(e,n,i,o){if(_.isNumber(n)||_.isNumber(e)){var r="You're creating a Restangular entity with the number ";throw r+="instead of the route or the parent. You can't call .one(12)",new Error(r)}var s={};return t.setIdToElem(s,i),t.setFieldToElem(t.restangularFields.singleOne,s,o),b(e,s,n,!1)}function a(e,t){return y(e,[],t,!1)}function l(e,n){var i=[];return i[t.restangularFields.ids]=Array.prototype.splice.call(arguments,2),y(e,i,n,!1)}function c(e,n,i){if(!n)throw new Error("Route is mandatory when creating new Restangular objects.");var o={};return t.setUrlToElem(o,i,n),b(e,o,n,!1)}function u(e,n,i){if(!n)throw new Error("Route is mandatory when creating new Restangular objects.");var o={};return t.setUrlToElem(o,i,n),y(e,o,n,!1)}function d(e,n,i){return e.call=_.bind(h,e),e.get=_.bind(p,e),e[t.restangularFields.restangularCollection]=n,n&&(e.push=_.bind(h,e,"push")),e.$object=i,e}function h(e){var n=i.defer(),o=arguments,r={};return this.then(function(t){var i=Array.prototype.slice.call(o,1),s=t[e];s.apply(t,i),r=t,n.resolve(t)}),d(n.promise,this[t.restangularFields.restangularCollection],r)}function p(e){var n=i.defer(),o={};return this.then(function(t){o=t[e],n.resolve(o)}),d(n.promise,this[t.restangularFields.restangularCollection],o)}function f(e,n,i,o){return _.extend(o,i),t.fullResponse?e.resolve(_.extend(n,{data:i})):void e.resolve(i)}function g(e){if(_.isArray(e)){var n=[];return _.each(e,function(e){n.push(g(e))}),n}return _.omit(e,_.values(_.omit(t.restangularFields,"id")))}function m(e){e[t.restangularFields.customOperation]=_.bind(L,e),_.each(["put","post","get","delete"],function(t){_.each(["do","custom"],function(n){var i,o="delete"===t?"remove":t,r=n+t.toUpperCase();i="put"!==o&&"post"!==o?L:function(e,t,n,i,o){return _.bind(L,this)(e,n,i,o,t)},e[r]=_.bind(i,e,o)})}),e[t.restangularFields.customGETLIST]=_.bind(k,e),e[t.restangularFields.doGETLIST]=e[t.restangularFields.customGETLIST]}function v(e,n){var i=angular.copy(e,n);return b(i[t.restangularFields.parentResource],i,i[t.restangularFields.route],!0)}function b(e,n,i,o,s,a){var l=t.onBeforeElemRestangularized(n,!1,i),c=r(e,l,i,a,o);return t.useCannonicalId&&(c[t.restangularFields.cannonicalId]=t.getIdFromElem(c)),s&&(c[t.restangularFields.getParentList]=function(){return s}),c[t.restangularFields.restangularCollection]=!1,c[t.restangularFields.get]=_.bind(D,c),c[t.restangularFields.getList]=_.bind(k,c),c[t.restangularFields.put]=_.bind(M,c),c[t.restangularFields.post]=_.bind(A,c),c[t.restangularFields.remove]=_.bind(I,c),c[t.restangularFields.head]=_.bind(O,c),c[t.restangularFields.trace]=_.bind(R,c),c[t.restangularFields.options]=_.bind(P,c),c[t.restangularFields.patch]=_.bind(N,c),c[t.restangularFields.save]=_.bind($,c),m(c),t.transformElem(c,!1,i,H,!0)}function y(e,n,i,o,s){var a=t.onBeforeElemRestangularized(n,!0,i),l=r(e,a,i,s,o);return l[t.restangularFields.restangularCollection]=!0,l[t.restangularFields.post]=_.bind(A,l,null),l[t.restangularFields.remove]=_.bind(I,l),l[t.restangularFields.head]=_.bind(O,l),l[t.restangularFields.trace]=_.bind(R,l),l[t.restangularFields.putElement]=_.bind(x,l),l[t.restangularFields.options]=_.bind(P,l),l[t.restangularFields.patch]=_.bind(N,l),l[t.restangularFields.get]=_.bind(C,l),l[t.restangularFields.getList]=_.bind(k,l,null),m(l),t.transformElem(l,!0,i,H,!0)}function w(e,t,n){var i=y(e,t,n,!1);return _.each(i,function(t){b(e,t,n,!1)}),i}function C(e,t,n){return this.customGET(e.toString(),t,n)}function x(e,n,o){var r=this,s=this[e],a=i.defer(),l=[];return l=t.transformElem(l,!0,s[t.restangularFields.route],H),s.put(n,o).then(function(t){var n=v(r);n[e]=t,l=n,a.resolve(n)},function(e){a.reject(e)}),d(a.promise,!0,l)}function S(e,n,i,o,r,s){var a=t.responseExtractor(e,n,i,o,r,s),l=r.headers("ETag");return a&&l&&(a[t.restangularFields.etag]=l),a}function k(e,o,r){var s=this,a=i.defer(),l="getList",c=W.fetchUrl(this,e),u=e||s[t.restangularFields.route],h=t.fullRequestInterceptor(null,l,u,c,r||{},o||{},this[t.restangularFields.httpConfig]||{}),p=[];p=t.transformElem(p,!0,u,H);var g="getList";return t.jsonp&&(g="jsonp"),W.resource(this,n,h.httpConfig,h.headers,h.params,e,this[t.restangularFields.etag],l)[g]().then(function(n){var i=n.data,o=n.config.params,r=S(i,l,u,c,n,a);if((_.isUndefined(r)||""===r)&&(r=[]),!_.isArray(r))throw new Error("Response for getList SHOULD be an array and not an object or something else");var d=_.map(r,function(n){return s[t.restangularFields.restangularCollection]?b(s[t.restangularFields.parentResource],n,s[t.restangularFields.route],!0,r):b(s,n,e,!0,r)});d=_.extend(r,d),s[t.restangularFields.restangularCollection]?f(a,n,y(s[t.restangularFields.parentResource],d,s[t.restangularFields.route],!0,o),p):f(a,n,y(s,d,e,!0,o),p)},function(e){304===e.status&&s[t.restangularFields.restangularCollection]?f(a,e,s,p):t.errorInterceptor(e,a)!==!1&&a.reject(e)}),d(a.promise,!0,p)}function T(e){return this[t.restangularFields.httpConfig]=e,this}function $(e,n){return this[t.restangularFields.fromServer]?this[t.restangularFields.put](e,n):_.bind(E,this)("post",void 0,e,void 0,n)}function E(e,o,r,s,a){var l=this,c=i.defer(),u=r||{},h=o||this[t.restangularFields.route],p=W.fetchUrl(this,o),m=s||this,v=m[t.restangularFields.etag]||("post"!=e?this[t.restangularFields.etag]:null);_.isObject(m)&&t.isRestangularized(m)&&(m=g(m));var y=t.fullRequestInterceptor(m,e,h,p,a||{},u||{},this[t.restangularFields.httpConfig]||{}),w={};w=t.transformElem(w,!1,h,H);var C=function(n){var i=n.data,r=n.config.params,s=S(i,e,h,p,n,c);s?"post"!==e||l[t.restangularFields.restangularCollection]?(data=b(l[t.restangularFields.parentResource],s,l[t.restangularFields.route],!0,null,r),data[t.restangularFields.singleOne]=l[t.restangularFields.singleOne],f(c,n,data,w)):f(c,n,b(l,s,o,!0,null,r),w):f(c,n,void 0,w)},x=function(n){304===n.status&&t.isSafe(e)?f(c,n,l,w):t.errorInterceptor(n,c)!==!1&&c.reject(n)},k=e,T=_.extend({},y.headers),$=t.isOverridenMethod(e);return $?(k="post",T=_.extend(T,{"X-HTTP-Method-Override":"remove"===e?"DELETE":e})):t.jsonp&&"get"===k&&(k="jsonp"),t.isSafe(e)?$?W.resource(this,n,y.httpConfig,T,y.params,o,v,k)[k]({}).then(C,x):W.resource(this,n,y.httpConfig,T,y.params,o,v,k)[k]().then(C,x):W.resource(this,n,y.httpConfig,T,y.params,o,v,k)[k](y.element).then(C,x),d(c.promise,!1,w)}function D(e,t){return _.bind(E,this)("get",void 0,e,void 0,t)}function I(e,t){return _.bind(E,this)("remove",void 0,e,void 0,t)}function M(e,t){return _.bind(E,this)("put",void 0,e,void 0,t)}function A(e,t,n,i){return _.bind(E,this)("post",e,n,t,i)}function O(e,t){return _.bind(E,this)("head",void 0,e,void 0,t)}function R(e,t){return _.bind(E,this)("trace",void 0,e,void 0,t)}function P(e,t){return _.bind(E,this)("options",void 0,e,void 0,t)}function N(e,t,n){return _.bind(E,this)("patch",void 0,t,e,n)}function L(e,t,n,i,o){return _.bind(E,this)(e,t,n,o,i)}function F(e,n,i,o,r,s){var a;a="getList"===n?_.bind(k,this,i):_.bind(L,this,n,i);var l=function(e,t,n){var i=_.defaults({params:e,headers:t,elem:n},{params:o,headers:r,elem:s});return a(i.params,i.headers,i.elem)};this[e]=t.isSafe(n)?l:function(e,t,n){return l(t,n,e)}}function U(n){var i=angular.copy(_.omit(t,"configuration"));return e.init(i,i),n(i),o(i)}function j(e,t){var n={},i=(t||H).all(e);return n.one=_.bind(s,t||H,t,e),n.post=_.bind(i.post,i),n.getList=_.bind(i.getList,i),n}var H={},W=new t.urlCreatorFactory[t.urlCreator];return W.setConfig(t),e.init(H,t),H.copy=_.bind(v,H),H.service=_.bind(j,H),H.withConfig=_.bind(U,H),H.one=_.bind(s,H,null),H.all=_.bind(a,H,null),H.several=_.bind(l,H,null),H.oneUrl=_.bind(c,H,null),H.allUrl=_.bind(u,H,null),H.stripRestangular=_.bind(g,H),H.restangularizeElement=_.bind(b,H),H.restangularizeCollection=_.bind(w,H),H}return o(t)}]})}(),function(e,t){function n(t,n){var o,r,s,a=t.nodeName.toLowerCase();return"area"===a?(o=t.parentNode,r=o.name,t.href&&r&&"map"===o.nodeName.toLowerCase()?(s=e("img[usemap=#"+r+"]")[0],!!s&&i(s)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var o=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.10.0",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return"number"==typeof t?this.each(function(){var i=this;setTimeout(function(){e(i).focus(),n&&n.call(i)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,o,r=e(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function o(t,n,i,o){return e.each(r,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?a["inner"+i].call(this):this.each(function(){e(this).css(s,o(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?a["outer"+i].call(this,t):this.each(function(){e(this).css(s,o(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var o,r=e.ui[t].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],
r.plugins[o].push([n,i[o]])},call:function(e,t,n){var i,o=e.plugins[t];if(o&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;i<o.length;i++)e.options[o[i][0]]&&o[i][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[i]>0?!0:(t[i]=1,o=t[i]>0,t[i]=0,o)}}))}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(r){}o(t)},e.widget=function(t,n,i){var o,r,s,a,l={},c=t.split(".")[0];t=t.split(".")[1],o=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[c]=e[c]||{},r=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new n,a.options=e.widget.extend({},a.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=o,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()):void(l[t]=i)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:o}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete r._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(n){for(var o,r,s=i.call(arguments,1),a=0,l=s.length;l>a;a++)for(o in s[a])r=s[a][o],s[a].hasOwnProperty(o)&&r!==t&&(n[o]=e.isPlainObject(r)?e.isPlainObject(n[o])?e.widget.extend({},n[o],r):e.widget.extend({},r):r);return n},e.widget.bridge=function(n,o){var r=o.prototype.widgetFullName||n;e.fn[n]=function(s){var a="string"==typeof s,l=i.call(arguments,1),c=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,this.each(a?function(){var i,o=e.data(this,r);return o?e.isFunction(o[s])&&"_"!==s.charAt(0)?(i=o[s].apply(o,l),i!==o&&i!==t?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+s+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+s+"'")}:function(){var t=e.data(this,r);t?t.option(s||{})._init():e.data(this,r,new o(s,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var o,r,s,a=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(a={},o=n.split("."),n=o.shift(),o.length){for(r=a[n]=e.widget.extend({},this.options[n]),s=0;s<o.length-1;s++)r[o[s]]=r[o[s]]||{},r=r[o[s]];if(n=o.pop(),i===t)return r[n]===t?null:r[n];r[n]=i}else{if(i===t)return this.options[n]===t?null:this.options[n];a[n]=i}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var o,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=o=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),e.each(i,function(i,s){function a(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,u=l[2];u?o.delegate(u,c,a):n.bind(c,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var o,r,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(e.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,r){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),s&&e.effects&&e.effects.effect[a]?i[t](o):a!==t&&i[a]?i[a](o.duration,o.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}})}(jQuery),function(e,t){function n(){return++o}function i(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}var o=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.10.0",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(n.active):e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var t=this.options.active,n=this.options.collapsible,i=location.hash.substring(1);return null===t&&(i&&this.tabs.each(function(n,o){return e(o).attr("aria-controls")===i?(t=n,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=n?!1:0)),!n&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),i=this.tabs.index(n),o=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:i++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:o=!1,i--;break;case e.ui.keyCode.END:i=this.anchors.length-1;break;case e.ui.keyCode.HOME:i=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(i);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(i===this.options.active?!1:i);default:return}t.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,o),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,n){function i(){return t>o&&(t=0),0>t&&(t=o),t}for(var o=this.tabs.length-1;-1!==e.inArray(i(),this.options.disabled);)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),!t&&this.options.active===!1&&this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,o){var r,s,a,l=e(o).uniqueId().attr("id"),c=e(o).closest("li"),u=c.attr("aria-controls");i(o)?(r=o.hash,s=t.element.find(t._sanitizeSelector(r))):(a=t._tabId(c),r="#"+a,s=t.element.find(r),s.length||(s=t._createPanel(a),s.insertAfter(t.panels[n-1]||t.tablist)),s.attr("aria-live","polite")),s.length&&(t.panels=t.panels.add(s)),u&&c.data("ui-tabs-aria-controls",u),c.attr({"aria-controls":r.substring(1),"aria-labelledby":l}),s.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n,i=0;n=this.tabs[i];i++)t===!0||-1!==e.inArray(i,t)?e(n).addClass("ui-state-disabled").attr("aria-disabled","true"):e(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,i=this.element.parent();"fill"===t?(n=i.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),i=t.css("position");"absolute"!==i&&"fixed"!==i&&(n-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,i=this.active,o=e(t.currentTarget),r=o.closest("li"),s=r[0]===i[0],a=s&&n.collapsible,l=a?e():this._getPanelForTab(r),c=i.length?this._getPanelForTab(i):e(),u={oldTab:i,oldPanel:c,newTab:a?e():r,newPanel:l};t.preventDefault(),r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||s&&!n.collapsible||this._trigger("beforeActivate",t,u)===!1||(n.active=a?!1:this.tabs.index(r),this.active=s?e():r,this.xhr&&this.xhr.abort(),!c.length&&!l.length&&e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(r),t),this._toggle(t,u))},_toggle:function(t,n){function i(){r.running=!1,r._trigger("activate",t,n)}function o(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&r.options.show?r._show(s,r.options.show,i):(s.show(),i())}var r=this,s=n.newPanel,a=n.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),o()),a.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),s.length&&a.length?n.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,i=this._findActive(t);i[0]!==this.active[0]&&(i.length||(i=this.active),n=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(n){var i=this.options.disabled;i!==!1&&(n===t?i=!1:(n=this._getIndex(n),i=e.isArray(i)?e.map(i,function(e){return e!==n?e:null}):e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(i))},disable:function(n){var i=this.options.disabled;if(i!==!0){if(n===t)i=!0;else{if(n=this._getIndex(n),-1!==e.inArray(n,i))return;i=e.isArray(i)?e.merge([n],i).sort():[n]}this._setupDisabled(i)}},load:function(t,n){t=this._getIndex(t);var o=this,r=this.tabs.eq(t),s=r.find(".ui-tabs-anchor"),a=this._getPanelForTab(r),l={tab:r,panel:a};i(s[0])||(this.xhr=e.ajax(this._ajaxSettings(s,n,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(r.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){a.html(e),o._trigger("load",n,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&o.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===o.xhr&&delete o.xhr},1)})))},_ajaxSettings:function(t,n,i){var o=this;return{url:t.attr("href"),beforeSend:function(t,r){return o._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:r},i))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(jQuery),function(e,t){function n(e,t,n){return[parseInt(e[0],10)*(p.test(e[0])?t/100:1),parseInt(e[1],10)*(p.test(e[1])?n/100:1)]}function i(t,n){return parseInt(e.css(t,n),10)||0}function o(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var r,s=Math.max,a=Math.abs,l=Math.round,c=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+%?/,h=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(r!==t)return r;var n,i,o=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=o.children()[0];return e("body").append(o),n=s.offsetWidth,o.css("overflow","scroll"),i=s.offsetWidth,n===i&&(i=o[0].clientWidth),o.remove(),r=n-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),i=t.isWindow?"":t.element.css("overflow-y"),o="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,r="scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]);return{element:n,isWindow:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return f.apply(this,arguments);t=e.extend({},t);var r,p,g,m,v,b,y=e(t.of),w=e.position.getWithinInfo(t.within),C=e.position.getScrollInfo(w),_=(t.collision||"flip").split(" "),x={};return b=o(y),y[0].preventDefault&&(t.at="left top"),p=b.width,g=b.height,m=b.offset,v=e.extend({},m),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=c.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=c.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),n=d.exec(i[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?v.left+=p:"center"===t.at[0]&&(v.left+=p/2),"bottom"===t.at[1]?v.top+=g:"center"===t.at[1]&&(v.top+=g/2),r=n(x.at,p,g),v.left+=r[0],v.top+=r[1],this.each(function(){var o,c,u=e(this),d=u.outerWidth(),h=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),S=d+f+i(this,"marginRight")+C.width,k=h+b+i(this,"marginBottom")+C.height,T=e.extend({},v),$=n(x.my,u.outerWidth(),u.outerHeight());"right"===t.my[0]?T.left-=d:"center"===t.my[0]&&(T.left-=d/2),"bottom"===t.my[1]?T.top-=h:"center"===t.my[1]&&(T.top-=h/2),T.left+=$[0],T.top+=$[1],e.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),o={marginLeft:f,marginTop:b},e.each(["left","top"],function(n,i){e.ui.position[_[n]]&&e.ui.position[_[n]][i](T,{targetWidth:p,targetHeight:g,elemWidth:d,elemHeight:h,collisionPosition:o,collisionWidth:S,collisionHeight:k,offset:[r[0]+$[0],r[1]+$[1]],my:t.my,at:t.at,within:w,elem:u})}),t.using&&(c=function(e){var n=m.left-T.left,i=n+p-d,o=m.top-T.top,r=o+g-h,l={target:{element:y,left:m.left,top:m.top,width:p,height:g},element:{element:u,left:T.left,top:T.top,width:d,height:h},horizontal:0>i?"left":n>0?"right":"center",vertical:0>r?"top":o>0?"bottom":"middle"};d>p&&a(n+i)<p&&(l.horizontal="center"),h>g&&a(o+r)<g&&(l.vertical="middle"),l.important=s(a(n),a(i))>s(a(o),a(r))?"horizontal":"vertical",t.using.call(this,e,l)}),u.offset(e.extend(T,{using:c}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,r=i.width,a=e.left-t.collisionPosition.marginLeft,l=o-a,c=a+t.collisionWidth-r-o;t.collisionWidth>r?l>0&&0>=c?(n=e.left+l+t.collisionWidth-r-o,e.left+=l-n):e.left=c>0&&0>=l?o:l>c?o+r-t.collisionWidth:o:l>0?e.left+=l:c>0?e.left-=c:e.left=s(e.left-a,e.left)},top:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,r=t.within.height,a=e.top-t.collisionPosition.marginTop,l=o-a,c=a+t.collisionHeight-r-o;t.collisionHeight>r?l>0&&0>=c?(n=e.top+l+t.collisionHeight-r-o,e.top+=l-n):e.top=c>0&&0>=l?o:l>c?o+r-t.collisionHeight:o:l>0?e.top+=l:c>0?e.top-=c:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var n,i,o=t.within,r=o.offset.left+o.scrollLeft,s=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,c=e.left-t.collisionPosition.marginLeft,u=c-l,d=c+t.collisionWidth-s-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(n=e.left+h+p+f+t.collisionWidth-s-r,(0>n||n<a(u))&&(e.left+=h+p+f)):d>0&&(i=e.left-t.collisionPosition.marginLeft+h+p+f-l,(i>0||a(i)<d)&&(e.left+=h+p+f))},top:function(e,t){var n,i,o=t.within,r=o.offset.top+o.scrollTop,s=o.height,l=o.isWindow?o.scrollTop:o.offset.top,c=e.top-t.collisionPosition.marginTop,u=c-l,d=c+t.collisionHeight-s-l,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,g=-2*t.offset[1];0>u?(i=e.top+p+f+g+t.collisionHeight-s-r,e.top+p+f+g>u&&(0>i||i<a(u))&&(e.top+=p+f+g)):d>0&&(n=e.top-t.collisionPosition.marginTop+p+f+g-l,e.top+p+f+g>d&&(n>0||a(n)<d)&&(e.top+=p+f+g))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,i,o,r,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in i)t.style[r]=i[r];t.appendChild(a),n=s||document.documentElement,n.insertBefore(t,n.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",o=e(a).offset().left,e.support.offsetFractions=o>10&&11>o,t.innerHTML="",n.removeChild(t)}()}(jQuery),function($){function Timepicker(){this.debug=!0,this._curInst=null,this._disabledInputs=[],this._timepickerShowing=!1,this._inDialog=!1,this._dialogClass="ui-timepicker-dialog",this._mainDivId="ui-timepicker-div",this._inlineClass="ui-timepicker-inline",this._currentClass="ui-timepicker-current",this._dayOverClass="ui-timepicker-days-cell-over",this.regional=[],this.regional[""]={hourText:"Hour",minuteText:"Minute",amPmText:["AM","PM"],closeButtonText:"Done",nowButtonText:"Now",deselectButtonText:"Deselect"},this._defaults={showOn:"focus",button:null,showAnim:"fadeIn",showOptions:{},appendText:"",beforeShow:null,onSelect:null,onClose:null,timeSeparator:":",periodSeparator:" ",showPeriod:!1,showPeriodLabels:!0,showLeadingZero:!0,showMinutesLeadingZero:!0,altField:"",defaultTime:"now",myPosition:"left top",atPosition:"left bottom",onHourShow:null,onMinuteShow:null,hours:{starts:0,ends:23},minutes:{starts:0,ends:55,interval:5,manual:[]},rows:4,showHours:!0,showMinutes:!0,optionalMinutes:!1,showCloseButton:!1,showNowButton:!1,showDeselectButton:!1,maxTime:{hour:null,minute:null},minTime:{hour:null,minute:null}},$.extend(this._defaults,this.regional[""]),this.tpDiv=$('<div id="'+this._mainDivId+'" class="ui-timepicker ui-widget ui-helper-clearfix ui-corner-all " style="display: none"></div>')}function extendRemove(e,t){$.extend(e,t);for(var n in t)(null==t[n]||void 0==t[n])&&(e[n]=t[n]);return e}$.extend($.ui,{timepicker:{version:"0.3.3"}});var PROP_NAME="timepicker",tpuuid=(new Date).getTime();$.extend(Timepicker.prototype,{markerClassName:"hasTimepicker",log:function(){this.debug&&console.log.apply("",arguments)},_widgetTimepicker:function(){return this.tpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachTimepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("time:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="tp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?(this._connectTimepicker(target,inst),this._setTimeFromField(inst)):inline&&this._inlineTimepicker(target,inst)},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,inline:t,tpDiv:t?$('<div class="'+this._inlineClass+' ui-timepicker ui-widget  ui-helper-clearfix"></div>'):this.tpDiv}},_connectTimepicker:function(e,t){var n=$(e);t.append=$([]),t.trigger=$([]),n.hasClass(this.markerClassName)||(this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keyup(this._doKeyUp).bind("setData.timepicker",function(e,n,i){t.settings[n]=i}).bind("getData.timepicker",function(e,n){return this._get(t,n)}),$.data(e,PROP_NAME,t))},_doKeyDown:function(e){var t=$.timepicker._getInst(e.target),n=!0;if(t._keyEvent=!0,$.timepicker._timepickerShowing)switch(e.keyCode){case 9:$.timepicker._hideTimepicker(),n=!1;break;case 13:return $.timepicker._updateSelectedValue(t),$.timepicker._hideTimepicker(),!1;case 27:$.timepicker._hideTimepicker();break;default:n=!1}else 36==e.keyCode&&e.ctrlKey?$.timepicker._showTimepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyUp:function(e){var t=$.timepicker._getInst(e.target);$.timepicker._setTimeFromField(t),$.timepicker._updateTimepicker(t)},_attachments:function(e,t){var n=this._get(t,"appendText"),i=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=$('<span class="'+this._appendClass+'">'+n+"</span>"),e[i?"before":"after"](t.append)),e.unbind("focus.timepicker",this._showTimepicker),e.unbind("click.timepicker",this._adjustZIndex),t.trigger&&t.trigger.remove();var o=this._get(t,"showOn");if(("focus"==o||"both"==o)&&(e.bind("focus.timepicker",this._showTimepicker),e.bind("click.timepicker",this._adjustZIndex)),"button"==o||"both"==o){var r=this._get(t,"button");null==r&&(r=$('<button class="ui-timepicker-trigger" type="button">...</button>'),e.after(r)),$(r).bind("click.timepicker",function(){return $.timepicker._timepickerShowing&&$.timepicker._lastInput==e[0]?$.timepicker._hideTimepicker():t.input.is(":disabled")||$.timepicker._showTimepicker(e[0]),!1})}},_inlineTimepicker:function(e,t){var n=$(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(t.tpDiv).bind("setData.timepicker",function(e,n,i){t.settings[n]=i}).bind("getData.timepicker",function(e,n){return this._get(t,n)}),$.data(e,PROP_NAME,t),this._setTimeFromField(t),this._updateTimepicker(t),t.tpDiv.show())},_adjustZIndex:function(e){e=e.target||e;var t=$.timepicker._getInst(e);t.tpDiv.css("zIndex",$.timepicker._getZIndex(e)+1)},_showTimepicker:function(e){if(e=e.target||e,"input"!=e.nodeName.toLowerCase()&&(e=$("input",e.parentNode)[0]),!$.timepicker._isDisabledTimepicker(e)&&$.timepicker._lastInput!=e){$.timepicker._hideTimepicker();var t=$.timepicker._getInst(e);$.timepicker._curInst&&$.timepicker._curInst!=t&&$.timepicker._curInst.tpDiv.stop(!0,!0);var n=$.timepicker._get(t,"beforeShow");extendRemove(t.settings,n?n.apply(e,[e,t]):{}),t.lastVal=null,$.timepicker._lastInput=e,$.timepicker._setTimeFromField(t),$.timepicker._inDialog&&(e.value=""),$.timepicker._pos||($.timepicker._pos=$.timepicker._findPos(e),$.timepicker._pos[1]+=e.offsetHeight);var i=!1;$(e).parents().each(function(){return i|="fixed"==$(this).css("position"),!i});var o={left:$.timepicker._pos[0],top:$.timepicker._pos[1]};if($.timepicker._pos=null,t.tpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.timepicker._updateTimepicker(t),!t.inline&&"object"==typeof $.ui.position){t.tpDiv.position({of:t.input,my:$.timepicker._get(t,"myPosition"),at:$.timepicker._get(t,"atPosition"),collision:"flip"});var o=t.tpDiv.offset();$.timepicker._pos=[o.top,o.left]}if(t._hoursClicked=!1,t._minutesClicked=!1,o=$.timepicker._checkOffset(t,o,i),t.tpDiv.css({position:$.timepicker._inDialog&&$.blockUI?"static":i?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),!t.inline){var r=$.timepicker._get(t,"showAnim"),s=$.timepicker._get(t,"duration"),a=function(){$.timepicker._timepickerShowing=!0;var e=$.timepicker._getBorders(t.tpDiv);t.tpDiv.find("iframe.ui-timepicker-cover").css({left:-e[0],top:-e[1],width:t.tpDiv.outerWidth(),height:t.tpDiv.outerHeight()})};$.timepicker._adjustZIndex(e),$.effects&&$.effects[r]?t.tpDiv.show(r,$.timepicker._get(t,"showOptions"),s,a):t.tpDiv.show(r?s:null,a),r&&s||a(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.timepicker._curInst=t}}},_getZIndex:function(e){for(var t,n,i=$(e),o=0;i.length&&i[0]!==document;)t=i.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(n=parseInt(i.css("zIndex"),10),isNaN(n)||0===n||n>o&&(o=n)),i=i.parent();return o},_refreshTimepicker:function(e){var t=this._getInst(e);t&&this._updateTimepicker(t)},_updateTimepicker:function(e){e.tpDiv.empty().append(this._generateHTML(e)),this._rebindDialogEvents(e)},_rebindDialogEvents:function(e){var t=$.timepicker._getBorders(e.tpDiv),n=this;e.tpDiv.find("iframe.ui-timepicker-cover").css({left:-t[0],top:-t[1],width:e.tpDiv.outerWidth(),height:e.tpDiv.outerHeight()}).end().find(".ui-timepicker-minute-cell").unbind().bind("click",{fromDoubleClick:!1},$.proxy($.timepicker.selectMinutes,this)).bind("dblclick",{fromDoubleClick:!0},$.proxy($.timepicker.selectMinutes,this)).end().find(".ui-timepicker-hour-cell").unbind().bind("click",{fromDoubleClick:!1},$.proxy($.timepicker.selectHours,this)).bind("dblclick",{
fromDoubleClick:!0},$.proxy($.timepicker.selectHours,this)).end().find(".ui-timepicker td a").unbind().bind("mouseout",function(){$(this).removeClass("ui-state-hover"),-1!=this.className.indexOf("ui-timepicker-prev")&&$(this).removeClass("ui-timepicker-prev-hover"),-1!=this.className.indexOf("ui-timepicker-next")&&$(this).removeClass("ui-timepicker-next-hover")}).bind("mouseover",function(){n._isDisabledTimepicker(e.inline?e.tpDiv.parent()[0]:e.input[0])||($(this).parents(".ui-timepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),-1!=this.className.indexOf("ui-timepicker-prev")&&$(this).addClass("ui-timepicker-prev-hover"),-1!=this.className.indexOf("ui-timepicker-next")&&$(this).addClass("ui-timepicker-next-hover"))}).end().find("."+this._dayOverClass+" a").trigger("mouseover").end().find(".ui-timepicker-now").bind("click",function(e){$.timepicker.selectNow(e)}).end().find(".ui-timepicker-deselect").bind("click",function(e){$.timepicker.deselectTime(e)}).end().find(".ui-timepicker-close").bind("click",function(e){$.timepicker._hideTimepicker()}).end()},_generateHTML:function(e){var t,n,i,o,r=1==this._get(e,"showPeriod"),s=1==this._get(e,"showPeriodLabels"),a=1==this._get(e,"showLeadingZero"),l=1==this._get(e,"showHours"),c=1==this._get(e,"showMinutes"),u=this._get(e,"amPmText"),d=this._get(e,"rows"),h=0,p=0,f=0,g=0,m=0,v=0,b=Array(),y=this._get(e,"hours"),w=null,C=0,_=this._get(e,"hourText"),x=this._get(e,"showCloseButton"),S=this._get(e,"closeButtonText"),k=this._get(e,"showNowButton"),T=this._get(e,"nowButtonText"),$=this._get(e,"showDeselectButton"),E=this._get(e,"deselectButtonText"),D=x||k||$;for(t=y.starts;t<=y.ends;t++)b.push(t);if(w=Math.ceil(b.length/d),s){for(C=0;C<b.length;C++)b[C]<12?f++:g++;C=0,h=Math.floor(f/b.length*d),p=Math.floor(g/b.length*d),d!=h+p&&(f&&(!g||!h||p&&f/h>=g/p)?h++:p++),m=Math.min(h,1),v=h+1,w=Math.ceil(0==h?g/p:0==p?f/h:Math.max(f/h,g/p))}if(o='<table class="ui-timepicker-table ui-widget-content ui-corner-all"><tr>',l){for(o+='<td class="ui-timepicker-hours"><div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+_+'</div><table class="ui-timepicker">',n=1;d>=n;n++){for(o+="<tr>",n==m&&s&&(o+='<th rowspan="'+h.toString()+'" class="periods" scope="row">'+u[0]+"</th>"),n==v&&s&&(o+='<th rowspan="'+p.toString()+'" class="periods" scope="row">'+u[1]+"</th>"),i=1;w>=i;i++)s&&v>n&&b[C]>=12?o+=this._generateHTMLHourCell(e,void 0,r,a):(o+=this._generateHTMLHourCell(e,b[C],r,a),C++);o+="</tr>"}o+="</table></td>"}if(c&&(o+='<td class="ui-timepicker-minutes">',o+=this._generateHTMLMinutes(e),o+="</td>"),o+="</tr>",D){var I='<tr><td colspan="3"><div class="ui-timepicker-buttonpane ui-widget-content">';k&&(I+='<button type="button" class="ui-timepicker-now ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+e.id.replace(/\\\\/g,"\\")+'" >'+T+"</button>"),$&&(I+='<button type="button" class="ui-timepicker-deselect ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+e.id.replace(/\\\\/g,"\\")+'" >'+E+"</button>"),x&&(I+='<button type="button" class="ui-timepicker-close ui-state-default ui-corner-all"  data-timepicker-instance-id="#'+e.id.replace(/\\\\/g,"\\")+'" >'+S+"</button>"),o+=I+"</div></td></tr>"}return o+="</table>"},_updateMinuteDisplay:function(e){var t=this._generateHTMLMinutes(e);e.tpDiv.find("td.ui-timepicker-minutes").html(t),this._rebindDialogEvents(e)},_generateHTMLMinutes:function(e){var t,n,o="",r=this._get(e,"rows"),s=Array(),a=this._get(e,"minutes"),l=null,c=0,u=1==this._get(e,"showMinutesLeadingZero"),d=this._get(e,"onMinuteShow"),h=this._get(e,"minuteText");for(a.starts||(a.starts=0),a.ends||(a.ends=59),a.manual||(a.manual=[]),t=a.starts;t<=a.ends;t+=a.interval)s.push(t);for(i=0;i<a.manual.length;i++){var p=a.manual[i];"number"!=typeof p||0>p||p>59||$.inArray(p,s)>=0||s.push(p)}if(s.sort(function(e,t){return e-t}),l=Math.round(s.length/r+.49),d&&0==d.apply(e.input?e.input[0]:null,[e.hours,e.minutes]))for(c=0;c<s.length;c+=1)if(t=s[c],d.apply(e.input?e.input[0]:null,[e.hours,t])){e.minutes=t;break}for(o+='<div class="ui-timepicker-title ui-widget-header ui-helper-clearfix ui-corner-all">'+h+'</div><table class="ui-timepicker">',c=0,n=1;r>=n;n++){for(o+="<tr>";n*l>c;){var t=s[c],f="";void 0!==t&&(f=10>t&&u?"0"+t.toString():t.toString()),o+=this._generateHTMLMinuteCell(e,t,f),c++}o+="</tr>"}return o+="</table>"},_generateHTMLHourCell:function(e,t,n,i){var o=t;t>12&&n&&(o=t-12),0==o&&n&&(o=12),10>o&&i&&(o="0"+o);var r="",s=!0,a=this._get(e,"onHourShow"),l=this._get(e,"maxTime"),c=this._get(e,"minTime");return void 0==t?r='<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>':(a&&(s=a.apply(e.input?e.input[0]:null,[t])),s&&(!isNaN(parseInt(l.hour))&&t>l.hour&&(s=!1),!isNaN(parseInt(c.hour))&&t<c.hour&&(s=!1)),r=s?'<td class="ui-timepicker-hour-cell" data-timepicker-instance-id="#'+e.id.replace(/\\\\/g,"\\")+'" data-hour="'+t.toString()+'"><a class="ui-state-default '+(t==e.hours?"ui-state-active":"")+'">'+o.toString()+"</a></td>":'<td><span class="ui-state-default ui-state-disabled '+(t==e.hours?" ui-state-active ":" ")+'">'+o.toString()+"</span></td>")},_generateHTMLMinuteCell:function(e,t,n){var i="",o=!0,r=e.hours,s=this._get(e,"onMinuteShow"),a=this._get(e,"maxTime"),l=this._get(e,"minTime");return s&&(o=s.apply(e.input?e.input[0]:null,[e.hours,t])),void 0==t?i='<td><span class="ui-state-default ui-state-disabled">&nbsp;</span></td>':(o&&null!==r&&(!isNaN(parseInt(a.hour))&&!isNaN(parseInt(a.minute))&&r>=a.hour&&t>a.minute&&(o=!1),!isNaN(parseInt(l.hour))&&!isNaN(parseInt(l.minute))&&r<=l.hour&&t<l.minute&&(o=!1)),i=o?'<td class="ui-timepicker-minute-cell" data-timepicker-instance-id="#'+e.id.replace(/\\\\/g,"\\")+'" data-minute="'+t.toString()+'" ><a class="ui-state-default '+(t==e.minutes?"ui-state-active":"")+'" >'+n+"</a></td>":'<td><span class="ui-state-default ui-state-disabled" >'+n+"</span></td>")},_destroyTimepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var i=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),"input"==i?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus.timepicker",this._showTimepicker).unbind("click.timepicker",this._adjustZIndex)):("div"==i||"span"==i)&&t.removeClass(this.markerClassName).empty()}},_enableTimepicker:function(e){var t=$(e),n=t.attr("id"),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var o=e.nodeName.toLowerCase();if("input"==o){e.disabled=!1;var r=this._get(i,"button");$(r).removeClass("ui-state-disabled").disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end()}else if("div"==o||"span"==o){var s=t.children("."+this._inlineClass);s.children().removeClass("ui-state-disabled"),s.find("button").each(function(){this.disabled=!1})}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==n?null:e})}},_disableTimepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var i=e.nodeName.toLowerCase();if("input"==i){var o=this._get(n,"button");$(o).addClass("ui-state-disabled").disabled=!0,e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end()}else if("div"==i||"span"==i){var r=t.children("."+this._inlineClass);r.children().addClass("ui-state-disabled"),r.find("button").each(function(){this.disabled=!0})}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=t.attr("id")}},_isDisabledTimepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_checkOffset:function(e,t,n){var i=e.tpDiv.outerWidth(),o=e.tpDiv.outerHeight(),r=e.input?e.input.outerWidth():0,s=e.input?e.input.outerHeight():0,a=document.documentElement.clientWidth+$(document).scrollLeft(),l=document.documentElement.clientHeight+$(document).scrollTop();return t.left-=this._get(e,"isRTL")?i-r:0,t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+s?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+i>a&&a>i?Math.abs(t.left+i-a):0),t.top-=Math.min(t.top,t.top+o>l&&l>o?Math.abs(o+s):0),t},_findPos:function(e){for(var t=this._getInst(e),n=this._get(t,"isRTL");e&&("hidden"==e.type||1!=e.nodeType);)e=e[n?"previousSibling":"nextSibling"];var i=$(e).offset();return[i.left,i.top]},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkExternalClick:function(e){if($.timepicker._curInst){var t=$(e.target);t[0].id==$.timepicker._mainDivId||0!=t.parents("#"+$.timepicker._mainDivId).length||t.hasClass($.timepicker.markerClassName)||t.hasClass($.timepicker._triggerClass)||!$.timepicker._timepickerShowing||$.timepicker._inDialog&&$.blockUI||$.timepicker._hideTimepicker()}},_hideTimepicker:function(e){var t=this._curInst;if(t&&(!e||t==$.data(e,PROP_NAME))&&this._timepickerShowing){var n=this._get(t,"showAnim"),i=this._get(t,"duration"),o=function(){$.timepicker._tidyDialog(t),this._curInst=null};$.effects&&$.effects[n]?t.tpDiv.hide(n,$.timepicker._get(t,"showOptions"),i,o):t.tpDiv["slideDown"==n?"slideUp":"fadeIn"==n?"fadeOut":"hide"](n?i:null,o),n||o(),this._timepickerShowing=!1,this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.tpDiv))),this._inDialog=!1;var r=this._get(t,"onClose");r&&r.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t])}},_tidyDialog:function(e){e.tpDiv.removeClass(this._dialogClass).unbind(".ui-timepicker")},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this timepicker"}},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setTimeFromField:function(e){if(e.input.val()!=e.lastVal){var t=this._get(e,"defaultTime"),n="now"==t?this._getCurrentTimeRounded(e):t;if(0==e.inline&&""!=e.input.val()&&(n=e.input.val()),n instanceof Date)e.hours=n.getHours(),e.minutes=n.getMinutes();else{var i=e.lastVal=n;if(""==n)e.hours=-1,e.minutes=-1;else{var o=this.parseTime(e,i);e.hours=o.hours,e.minutes=o.minutes}}$.timepicker._updateTimepicker(e)}},_optionTimepicker:function(e,t,n){var i=this._getInst(e);if(2==arguments.length&&"string"==typeof t)return"defaults"==t?$.extend({},$.timepicker._defaults):i?"all"==t?$.extend({},i.settings):this._get(i,t):null;var o=t||{};"string"==typeof t&&(o={},o[t]=n),i&&(extendRemove(i.settings,o),this._curInst==i&&(this._hideTimepicker(),this._updateTimepicker(i)),i.inline&&this._updateTimepicker(i))},_setTimeTimepicker:function(e,t){var n=this._getInst(e);n&&(this._setTime(n,t),this._updateTimepicker(n),this._updateAlternate(n,t))},_setTime:function(e,t,n){var i=e.hours,o=e.minutes;if(t instanceof Date)e.hours=t.getHours(),e.minutes=t.getMinutes();else{var t=this.parseTime(e,t);e.hours=t.hours,e.minutes=t.minutes}i==e.hours&&o==e.minutes||n||e.input.trigger("change"),this._updateTimepicker(e),this._updateSelectedValue(e)},_getCurrentTimeRounded:function(e){var t=new Date,n=t.getMinutes(),i=this._get(e,"minutes"),o=Math.round(n/i.interval)*i.interval;return t.setMinutes(o),t},parseTime:function(e,t){var n=new Object;if(n.hours=-1,n.minutes=-1,!t)return"";var i=this._get(e,"timeSeparator"),o=this._get(e,"amPmText"),r=this._get(e,"showHours"),s=this._get(e,"showMinutes"),a=this._get(e,"optionalMinutes"),l=1==this._get(e,"showPeriod"),c=t.indexOf(i);if(-1!=c?(n.hours=parseInt(t.substr(0,c),10),n.minutes=parseInt(t.substr(c+1),10)):!r||s&&!a?!r&&s&&(n.minutes=parseInt(t,10)):n.hours=parseInt(t,10),r){var u=t.toUpperCase();n.hours<12&&l&&-1!=u.indexOf(o[1].toUpperCase())&&(n.hours+=12),12==n.hours&&l&&-1!=u.indexOf(o[0].toUpperCase())&&(n.hours=0)}return n},selectNow:function(e){var t=$(e.target).attr("data-timepicker-instance-id"),n=$(t),i=this._getInst(n[0]),o=new Date;i.hours=o.getHours(),i.minutes=o.getMinutes(),this._updateSelectedValue(i),this._updateTimepicker(i),this._hideTimepicker()},deselectTime:function(e){var t=$(e.target).attr("data-timepicker-instance-id"),n=$(t),i=this._getInst(n[0]);i.hours=-1,i.minutes=-1,this._updateSelectedValue(i),this._hideTimepicker()},selectHours:function(e){var t=$(e.currentTarget),n=t.attr("data-timepicker-instance-id"),i=parseInt(t.attr("data-hour")),o=e.data.fromDoubleClick,r=$(n),s=this._getInst(r[0]),a=1==this._get(s,"showMinutes");if($.timepicker._isDisabledTimepicker(r.attr("id")))return!1;t.parents(".ui-timepicker-hours:first").find("a").removeClass("ui-state-active"),t.children("a").addClass("ui-state-active"),s.hours=i;var l=this._get(s,"onMinuteShow"),c=this._get(s,"maxTime"),u=this._get(s,"minTime");return(l||c.minute||u.minute)&&this._updateMinuteDisplay(s),this._updateSelectedValue(s),s._hoursClicked=!0,(s._minutesClicked||o||0==a)&&$.timepicker._hideTimepicker(),!1},selectMinutes:function(e){var t=$(e.currentTarget),n=t.attr("data-timepicker-instance-id"),i=parseInt(t.attr("data-minute")),o=e.data.fromDoubleClick,r=$(n),s=this._getInst(r[0]),a=1==this._get(s,"showHours");return $.timepicker._isDisabledTimepicker(r.attr("id"))?!1:(t.parents(".ui-timepicker-minutes:first").find("a").removeClass("ui-state-active"),t.children("a").addClass("ui-state-active"),s.minutes=i,this._updateSelectedValue(s),s._minutesClicked=!0,s._hoursClicked||o||0==a?($.timepicker._hideTimepicker(),!1):!1)},_updateSelectedValue:function(e){var t=this._getParsedTime(e);e.input&&(e.input.val(t),e.input.trigger("change"));var n=this._get(e,"onSelect");return n&&n.apply(e.input?e.input[0]:null,[t,e]),this._updateAlternate(e,t),t},_getParsedTime:function(e){if(-1==e.hours&&-1==e.minutes)return"";(e.hours<e.hours.starts||e.hours>e.hours.ends)&&(e.hours=0),(e.minutes<e.minutes.starts||e.minutes>e.minutes.ends)&&(e.minutes=0);var t="",n=1==this._get(e,"showPeriod"),i=1==this._get(e,"showLeadingZero"),o=1==this._get(e,"showHours"),r=1==this._get(e,"showMinutes"),s=1==this._get(e,"optionalMinutes"),a=this._get(e,"amPmText"),l=e.hours?e.hours:0,c=e.minutes?e.minutes:0,u=l?l:0,d="";-1==u&&(u=0),-1==c&&(c=0),n&&(0==e.hours&&(u=12),e.hours<12?t=a[0]:(t=a[1],u>12&&(u-=12)));var h=u.toString();i&&10>u&&(h="0"+h);var p=c.toString();return 10>c&&(p="0"+p),o&&(d+=h),!o||!r||s&&0==p||(d+=this._get(e,"timeSeparator")),!r||s&&0==p||(d+=p),o&&t.length>0&&(d+=this._get(e,"periodSeparator")+t),d},_updateAlternate:function(e,t){var n=this._get(e,"altField");n&&$(n).each(function(e,n){$(n).val(t)})},_getTimeAsDateTimepicker:function(e){var t=this._getInst(e);return-1==t.hours&&-1==t.minutes?"":((t.hours<t.hours.starts||t.hours>t.hours.ends)&&(t.hours=0),(t.minutes<t.minutes.starts||t.minutes>t.minutes.ends)&&(t.minutes=0),new Date(0,0,0,t.hours,t.minutes,0))},_getTimeTimepicker:function(e){var t=this._getInst(e);return this._getParsedTime(t)},_getHourTimepicker:function(e){var t=this._getInst(e);return void 0==t?-1:t.hours},_getMinuteTimepicker:function(e){var t=this._getInst(e);return void 0==t?-1:t.minutes}}),$.fn.timepicker=function(e){$.timepicker.initialized||($(document).mousedown($.timepicker._checkExternalClick),$.timepicker.initialized=!0),0===$("#"+$.timepicker._mainDivId).length&&$("body").append($.timepicker.tpDiv);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"getTime"!=e&&"getTimeAsDate"!=e&&"getHour"!=e&&"getMinute"!=e?"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?$.timepicker["_"+e+"Timepicker"].apply($.timepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?$.timepicker["_"+e+"Timepicker"].apply($.timepicker,[this].concat(t)):$.timepicker._attachTimepicker(this,e)}):$.timepicker["_"+e+"Timepicker"].apply($.timepicker,[this[0]].concat(t))},$.timepicker=new Timepicker,$.timepicker.initialized=!1,$.timepicker.uuid=(new Date).getTime(),$.timepicker.version="0.3.3",window["TP_jQuery_"+tpuuid]=$}(jQuery),function(e,t,n){"use strict";t.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(e,i){var o,r={},s={},a=!1,l=t.copy,c=t.isUndefined;return i.addPollFn(function(){var t=i.cookies();o!=t&&(o=t,l(t,s),l(t,r),a&&e.$apply())})(),a=!0,e.$watch(function(){var e,o,a;for(e in s)c(r[e])&&i.cookies(e,n);for(e in r)o=r[e],t.isString(o)||(o=""+o,r[e]=o),o!==s[e]&&(i.cookies(e,o),a=!0);if(a)for(e in o=i.cookies(),r)r[e]!==o[e]&&(c(o[e])?delete r[e]:r[e]=o[e])}),r}]).factory("$cookieStore",["$cookies",function(e){return{get:function(n){return(n=e[n])?t.fromJson(n):n},put:function(n,i){e[n]=t.toJson(i)},remove:function(t){delete e[t]}}}])}(window,window.angular),!function(e,t){"use strict";function n(e){return/^-?\d+\.?\d*$/.test(e.replace(/["']/g,""))}var i=t.isDefined,o=t.isUndefined,r=t.isNumber,s=t.isObject,a=t.isArray,l=t.extend,c=t.toJson,u=t.fromJson,d=t.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setStorageCookie=function(e,t){return this.cookie={expiry:e,path:t},this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse",function(e,t,d,h){var p,f=this,g=f.prefix,m=f.cookie,v=f.notify,b=f.storageType;d?d[0]&&(d=d[0]):d=document,"."!==g.substr(-1)&&(g=g?g+".":"");var y=function(e){return g+e},w=function(){try{var n=b in t&&null!==t[b],i=y("__"+Math.round(1e7*Math.random()));return n&&(p=t[b],p.setItem(i,""),p.removeItem(i)),n}catch(o){return b="cookie",e.$broadcast("LocalStorageModule.notification.error",o.message),!1}}(),C=function(t,n){if(o(n)?n=null:(s(n)||a(n)||r(+n||n))&&(n=c(n)),!w||"cookie"===f.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:"cookie"}),$(t,n);try{(s(n)||a(n))&&(n=c(n)),p&&p.setItem(y(t),n),v.setItem&&e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:n,storageType:f.storageType})}catch(i){return e.$broadcast("LocalStorageModule.notification.error",i.message),$(t,n)}return!0},_=function(t){if(!w||"cookie"===f.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),E(t);var i=p?p.getItem(y(t)):null;return i&&"null"!==i?"{"===i.charAt(0)||"["===i.charAt(0)||n(i)?u(i):i:null},x=function(t){if(!w||"cookie"===f.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),D(t);try{p.removeItem(y(t)),v.removeItem&&e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:f.storageType})}catch(n){return e.$broadcast("LocalStorageModule.notification.error",n.message),D(t)}return!0},S=function(){if(!w)return e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var t=g.length,n=[];for(var i in p)if(i.substr(0,t)===g)try{n.push(i.substr(t))}catch(o){return e.$broadcast("LocalStorageModule.notification.error",o.Description),[]}return n},k=function(t){t=t||"";var n=g.slice(0,-1),i=new RegExp(n+"."+t);if(!w||"cookie"===f.storageType)return w||e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();var o=g.length;for(var r in p)if(i.test(r))try{x(r.substr(o))}catch(s){return e.$broadcast("LocalStorageModule.notification.error",s.message),I()}return!0},T=function(){try{return t.navigator.cookieEnabled||"cookie"in d&&(d.cookie.length>0||(d.cookie="test").indexOf.call(d.cookie,"test")>-1)}catch(n){return e.$broadcast("LocalStorageModule.notification.error",n.message),!1}}(),$=function(t,n){if(o(n))return!1;if((a(n)||s(n))&&(n=c(n)),!T)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var i="",r=new Date,l="";if(null===n?(r.setTime(r.getTime()+-864e5),i="; expires="+r.toGMTString(),n=""):0!==m.expiry&&(r.setTime(r.getTime()+24*m.expiry*60*60*1e3),i="; expires="+r.toGMTString()),t){var u="; path="+m.path;m.domain&&(l="; domain="+m.domain),d.cookie=y(t)+"="+encodeURIComponent(n)+i+u+l}}catch(h){return e.$broadcast("LocalStorageModule.notification.error",h.message),!1}return!0},E=function(t){if(!T)return e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var n=d.cookie&&d.cookie.split(";")||[],i=0;i<n.length;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(y(t)+"=")){var r=decodeURIComponent(o.substring(g.length+t.length+1,o.length));try{var s=JSON.parse(r);return u(s)}catch(a){return r}}}return null},D=function(e){$(e,null)},I=function(){for(var e=null,t=g.length,n=d.cookie.split(";"),i=0;i<n.length;i++){for(e=n[i];" "===e.charAt(0);)e=e.substring(1,e.length);var o=e.substring(t,e.indexOf("="));D(o)}},M=function(){return b},A=function(e,t,n,o){o=o||t;var r=_(o);return null===r&&i(n)?r=n:s(r)&&s(n)&&(r=l(n,r)),h(t).assign(e,r),e.$watch(t,function(e){C(o,e)},s(e[t]))},O=function(){for(var e=0,n=t[b],i=0;i<n.length;i++)0===n.key(i).indexOf(g)&&e++;return e};return{isSupported:w,getStorageType:M,set:C,add:C,get:_,keys:S,remove:x,clearAll:k,bind:A,deriveKey:y,length:O,cookie:{isSupported:T,set:$,add:$,get:E,remove:D,clearAll:I}}}]})}(window,window.angular),function(){var e,t={}.hasOwnProperty;e=angular.module("fcsa-number",[]),e.directive("fcsaNumber",["fcsaNumberConfig",function(e){var n,i,o,r,s,a,l,c,u,d,h,p,f;return o=e.defaultOptions,r=function(e){var n,i,r,s;if(i=angular.copy(o),null!=e.options){s=e.$eval(e.options);for(n in s)t.call(s,n)&&(r=s[n],i[n]=r)}return i},c=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},l=function(e){return 44>e||e>57||47===e},i=[0,8,13],a=function(e){return-1===i.indexOf(e)},s=function(e){return null!=e&&e.toString().split(".").length>2},d=function(e){var t,n;return t=e>0?"^-?\\d*\\.?\\d{0,"+e+"}$":"^-?\\d*$",n=new RegExp(t),function(e){return n.test(e)}},p=function(e){return function(t,n){return e>=n}},f=function(e){return function(t,n){return n>=e}},h=function(e){var t;return t=new RegExp("^-?\\d{0,"+e+"}(\\.\\d*)?$"),function(e){return t.test(e)}},u=function(e){var t;return t=[],null!=e.maxDecimals&&t.push(d(e.maxDecimals)),null!=e.max&&t.push(p(e.max)),null!=e.min&&t.push(f(e.min)),null!=e.maxDigits&&t.push(h(e.maxDigits)),function(e){var n,i,o,r;if(!c(e))return!1;if(s(e))return!1;for(i=Number(e),n=o=0,r=t.length;r>=0?r>o:o>r;n=r>=0?++o:--o)if(!t[n](e,i))return!1;return!0}},n=function(e){var t,n,i;return n=-1==e.indexOf(".")?"":e.replace(/^-?\d+(?=\.)/,""),i=e.replace(/(\.\d+)$/,""),t=i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),""+t+n},{restrict:"A",require:"ngModel",scope:{options:"@fcsaNumber"},link:function(e,t,i,o){var s,c;return c=r(e),s=u(c),o.$parsers.unshift(function(e){var t;return t=e.replace(/,/g,""),s(t)||!t?(o.$setValidity("fcsaNumber",!0),t):void o.$setValidity("fcsaNumber",!1)}),o.$formatters.push(function(e){return null==c.nullDisplay||e&&""!==e?null!=e&&s(e)?(o.$setValidity("fcsaNumber",!0),e=n(e.toString()),null!=c.prepend&&(e=""+c.prepend+e),null!=c.append&&(e=""+e+c.append),e):e:c.nullDisplay}),t.on("blur",function(){var e,t,n,i,r;if(t=o.$modelValue,null!=t&&s(t)){for(r=o.$formatters,n=0,i=r.length;i>n;n++)e=r[n],t=e(t);return o.$viewValue=t,o.$render()}}),t.on("focus",function(){var e;return e=t.val(),null!=c.prepend&&(e=e.replace(c.prepend,"")),null!=c.append&&(e=e.replace(c.append,"")),t.val(e.replace(/,/g,"")),t[0].select()}),c.preventInvalidInput===!0?t.on("keypress",function(e){return l(e.which)&&a(e.which)?e.preventDefault():void 0}):void 0}}}]),e.provider("fcsaNumberConfig",function(){var e;e={},this.setDefaultOptions=function(t){return e=t},this.$get=function(){return{defaultOptions:e}}})}.call(this),!function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]),angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var t=["$q","$cacheFactory","$timeout","$rootScope","cfpLoadingBar",function(t,n,i,o,r){function s(){i.cancel(l),r.complete(),u=0,c=0}function a(t){var i,o=n.get("$http"),r=e.defaults;!t.cache&&!r.cache||t.cache===!1||"GET"!==t.method&&"JSONP"!==t.method||(i=angular.isObject(t.cache)?t.cache:angular.isObject(r.cache)?r.cache:o);var s=void 0!==i?void 0!==i.get(t.url):!1;return void 0!==t.cached&&s!==t.cached?t.cached:(t.cached=s,s)}var l,c=0,u=0,d=r.latencyThreshold;return{request:function(e){return e.ignoreLoadingBar||a(e)||(o.$broadcast("cfpLoadingBar:loading",{url:e.url}),0===c&&(l=i(function(){r.start()},d)),c++,r.set(u/c)),e},response:function(e){return e.config.ignoreLoadingBar||a(e.config)||(u++,o.$broadcast("cfpLoadingBar:loaded",{url:e.config.url}),u>=c?s():r.set(u/c)),e},responseError:function(e){return e.config.ignoreLoadingBar||a(e.config)||(u++,o.$broadcast("cfpLoadingBar:loaded",{url:e.config.url}),u>=c?s():r.set(u/c)),t.reject(e)}}}];e.interceptors.push(t)}]),angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector="body",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function(e,t,n,i){function o(){u||(u=e.get("$animate"));var o=t.find(p).eq(0);n.cancel(h),v||(i.$broadcast("cfpLoadingBar:started"),v=!0,w&&u.enter(f,o),y&&u.enter(m,o),r(C))}function r(e){if(v){var t=100*e+"%";g.css("width",t),b=e,n.cancel(d),d=n(function(){s()},250)}}function s(){if(!(a()>=1)){var e=0,t=a();e=t>=0&&.25>t?(3*Math.random()+3)/100:t>=.25&&.65>t?3*Math.random()/100:t>=.65&&.9>t?2*Math.random()/100:t>=.9&&.99>t?.005:0;var n=a()+e;r(n)}}function a(){return b}function l(){b=0,v=!1}function c(){u||(u=e.get("$animate")),i.$broadcast("cfpLoadingBar:completed"),r(1),n.cancel(h),h=n(function(){var e=u.leave(f,l);e&&e.then&&e.then(l),u.leave(m)},500)}var u,d,h,p=this.parentSelector,f=angular.element(this.loadingBarTemplate),g=f.find("div").eq(0),m=angular.element(this.spinnerTemplate),v=!1,b=0,y=this.includeSpinner,w=this.includeBar,C=this.startSize;return{start:o,set:r,status:a,inc:s,complete:c,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}(),angular.module("pascalprecht.translate",["ng"]).run(["$translate",function(e){var t=e.storageKey(),n=e.storage();n?n.get(t)?e.use(n.get(t)):angular.isString(e.preferredLanguage())?e.use(e.preferredLanguage()):n.set(t,e.use()):angular.isString(e.preferredLanguage())&&e.use(e.preferredLanguage())}]),angular.module("pascalprecht.translate").provider("$translate",["$STORAGE_KEY",function(e){var t,n,i,o,r,s,a,l,c,u,d,h,p,f,g={},m=[],v=e,b=[],y=!1,w="translate-cloak",C=!1,_=".",x=function(){var e=window.navigator;return(e.language||e.browserLanguage||e.systemLanguage||e.userLanguage||"").split("-").join("_")},S=function(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},k=function(){return this.replace(/^\s+|\s+$/g,"")},T=function(e){for(var t=[],i=angular.lowercase(e),o=0,r=m.length;r>o;o++)t.push(angular.lowercase(m[o]));if(S(t,i)>-1)return e;if(n){var s;for(var a in n){var l=!1,c=Object.prototype.hasOwnProperty.call(n,a)&&angular.lowercase(a)===angular.lowercase(e);if("*"===a.slice(-1)&&(l=a.slice(0,-1)===e.slice(0,a.length-1)),(c||l)&&(s=n[a],S(t,angular.lowercase(s))>-1))return s}}var u=e.split("_");return u.length>1&&S(t,angular.lowercase(u[0]))>-1?u[0]:e},$=function(e,t){if(!e&&!t)return g;if(e&&!t){if(angular.isString(e))return g[e]}else angular.isObject(g[e])||(g[e]={}),angular.extend(g[e],E(t));return this};this.translations=$,this.cloakClassName=function(e){return e?(w=e,this):w};var E=function(e,t,n,i){var o,r,s,a;t||(t=[]),n||(n={});for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(a=e[o],angular.isObject(a)?E(a,t.concat(o),n,o):(r=t.length?""+t.join(_)+_+o:o,t.length&&o===i&&(s=""+t.join(_),n[s]="@:"+r),n[r]=a));return n};this.addInterpolation=function(e){return b.push(e),this},this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")},this.useInterpolation=function(e){return u=e,this},this.useSanitizeValueStrategy=function(e){return y=e,this},this.preferredLanguage=function(e){return D(e),this};var D=function(e){return e&&(t=e),t};this.translationNotFoundIndicator=function(e){return this.translationNotFoundIndicatorLeft(e),this.translationNotFoundIndicatorRight(e),this},this.translationNotFoundIndicatorLeft=function(e){return e?(p=e,this):p},this.translationNotFoundIndicatorRight=function(e){return e?(f=e,this):f},this.fallbackLanguage=function(e){return I(e),this};var I=function(e){return e?(angular.isString(e)?(o=!0,i=[e]):angular.isArray(e)&&(o=!1,i=e),angular.isString(t)&&S(i,t)<0&&i.push(t),this):o?i[0]:i};this.use=function(e){if(e){if(!g[e]&&!d)throw new Error("$translateProvider couldn't find translationTable for langKey: '"+e+"'");return r=e,this}return r};var M=function(e){return e?void(v=e):l?l+v:v};this.storageKey=M,this.useUrlLoader=function(e){return this.useLoader("$translateUrlLoader",{url:e})},this.useStaticFilesLoader=function(e){return this.useLoader("$translateStaticFilesLoader",e)},this.useLoader=function(e,t){return d=e,h=t||{},this},this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")},this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")},this.useStorage=function(e){return a=e,this},this.storagePrefix=function(e){return e?(l=e,this):e},this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")},this.useMissingTranslationHandler=function(e){return c=e,this},this.usePostCompiling=function(e){return C=!!e,this},this.determinePreferredLanguage=function(e){var n=e&&angular.isFunction(e)?e():x();return t=m.length?T(n):n,this},this.registerAvailableLanguageKeys=function(e,t){return e?(m=e,t&&(n=t),this):m},this.$get=["$log","$injector","$rootScope","$q",function(e,n,l,m){var _,x,A,O=n.get(u||"$translateDefaultInterpolation"),R=!1,P={},N={},L=function(e,n,o){if(angular.isArray(e)){var s=function(e){for(var t={},i=[],r=function(e){var i=m.defer(),r=function(n){t[e]=n,i.resolve([e,n])};return L(e,n,o).then(r,r),i.promise},s=0,a=e.length;a>s;s++)i.push(r(e[s]));return m.all(i).then(function(){return t})};return s(e)}var l=m.defer();e&&(e=k.apply(e));var c=function(){var e=t?N[t]:N[r];if(x=0,a&&!e){var n=_.get(v);if(e=N[n],i&&i.length){var o=S(i,n);x=o>-1?o+=1:0,i.push(t)}}return e}();return c?c.then(function(){K(e,n,o).then(l.resolve,l.reject)},l.reject):K(e,n,o).then(l.resolve,l.reject),l.promise},F=function(e){return p&&(e=[p,e].join(" ")),f&&(e=[e,f].join(" ")),e},U=function(e){r=e,l.$emit("$translateChangeSuccess"),a&&_.set(L.storageKey(),r),O.setLocale(r),angular.forEach(P,function(e,t){P[t].setLocale(r)}),l.$emit("$translateChangeEnd")},j=function(e){if(!e)throw"No language key specified for loading.";var t=m.defer();return l.$emit("$translateLoadingStart"),R=!0,n.get(d)(angular.extend(h,{key:e})).then(function(n){var i={};l.$emit("$translateLoadingSuccess"),angular.isArray(n)?angular.forEach(n,function(e){angular.extend(i,E(e))}):angular.extend(i,E(n)),R=!1,t.resolve({key:e,table:i}),l.$emit("$translateLoadingEnd")},function(e){l.$emit("$translateLoadingError"),
t.reject(e),l.$emit("$translateLoadingEnd")}),t.promise};if(a&&(_=n.get(a),!_.get||!_.set))throw new Error("Couldn't use storage '"+a+"', missing get() or set() method!");angular.isFunction(O.useSanitizeValueStrategy)&&O.useSanitizeValueStrategy(y),b.length&&angular.forEach(b,function(e){var i=n.get(e);i.setLocale(t||r),angular.isFunction(i.useSanitizeValueStrategy)&&i.useSanitizeValueStrategy(y),P[i.getInterpolationIdentifier()]=i});var H=function(e){var t=m.defer();return Object.prototype.hasOwnProperty.call(g,e)?(t.resolve(g[e]),t.promise):(N[e].then(function(e){$(e.key,e.table),t.resolve(e.table)},t.reject),t.promise)},W=function(e,t,n,i){var o=m.defer();return H(e).then(function(s){Object.prototype.hasOwnProperty.call(s,t)?(i.setLocale(e),o.resolve(i.interpolate(s[t],n)),i.setLocale(r)):o.reject()},o.reject),o.promise},B=function(e,t,n,i){var o,s=g[e];return Object.prototype.hasOwnProperty.call(s,t)&&(i.setLocale(e),o=i.interpolate(s[t],n),i.setLocale(r)),o},V=function(e){if(c){var t=n.get(c)(e,r);return void 0!==t?t:e}return e},z=function(e,t,n,o){var r=m.defer();if(e<i.length){var s=i[e];W(s,t,n,o).then(function(e){r.resolve(e)},function(){var i=z(e+1,t,n,o);r.resolve(i)})}else r.resolve(V(t));return r.promise},q=function(e,t,n,o){var r;if(e<i.length){var s=i[e];r=B(s,t,n,o),r||(r=q(e+1,t,n,o))}return r},Y=function(e,t,n){return z(A>0?A:x,e,t,n)},G=function(e,t,n){return q(A>0?A:x,e,t,n)},K=function(e,t,n){var o=m.defer(),s=r?g[r]:g,a=n?P[n]:O;if(s&&Object.prototype.hasOwnProperty.call(s,e)){var l=s[e];"@:"===l.substr(0,2)?L(l.substr(2),t,n).then(o.resolve,o.reject):o.resolve(a.interpolate(l,t))}else{var u;c&&!R&&(u=V(e)),r&&i&&i.length?Y(e,t,a).then(function(e){o.resolve(e)},function(e){o.reject(F(e))}):c&&!R&&u?o.resolve(u):o.reject(F(e))}return o.promise},Q=function(e,t,n){var o,s=r?g[r]:g,a=n?P[n]:O;if(s&&Object.prototype.hasOwnProperty.call(s,e)){var l=s[e];o="@:"===l.substr(0,2)?Q(l.substr(2),t,n):a.interpolate(l,t)}else{var u;c&&!R&&(u=V(e)),r&&i&&i.length?(x=0,o=G(e,t,a)):o=c&&!R&&u?u:F(e)}return o};if(L.preferredLanguage=function(e){return e&&D(e),t},L.cloakClassName=function(){return w},L.fallbackLanguage=function(e){if(void 0!==e&&null!==e){if(I(e),d&&i&&i.length)for(var t=0,n=i.length;n>t;t++)N[i[t]]||(N[i[t]]=j(i[t]));L.use(L.use())}return o?i[0]:i},L.useFallbackLanguage=function(e){if(void 0!==e&&null!==e)if(e){var t=S(i,e);t>-1&&(A=t)}else A=0},L.proposedLanguage=function(){return s},L.storage=function(){return _},L.use=function(e){if(!e)return r;var t=m.defer();l.$emit("$translateChangeStart");var n=T(e);return n&&(e=n),g[e]||!d||N[e]?(t.resolve(e),U(e)):(s=e,N[e]=j(e).then(function(n){$(n.key,n.table),t.resolve(n.key),s===e&&(U(n.key),s=void 0)},function(e){s=void 0,l.$emit("$translateChangeError"),t.reject(e),l.$emit("$translateChangeEnd")})),t.promise},L.storageKey=function(){return M()},L.isPostCompilingEnabled=function(){return C},L.refresh=function(e){function t(){o.resolve(),l.$emit("$translateRefreshEnd")}function n(){o.reject(),l.$emit("$translateRefreshEnd")}if(!d)throw new Error("Couldn't refresh translation table, no loader registered!");var o=m.defer();if(l.$emit("$translateRefreshStart"),e)g[e]?j(e).then(function(n){$(n.key,n.table),e===r&&U(r),t()},n):n();else{var s=[];if(i&&i.length)for(var a=0,c=i.length;c>a;a++)s.push(j(i[a]));r&&s.push(j(r)),m.all(s).then(function(e){angular.forEach(e,function(e){g[e.key]&&delete g[e.key],$(e.key,e.table)}),r&&U(r),t()})}return o.promise},L.instant=function(e,n,o){if(null===e||angular.isUndefined(e))return e;if(angular.isArray(e)){for(var s={},a=0,l=e.length;l>a;a++)s[e[a]]=L.instant(e[a],n,o);return s}if(angular.isString(e)&&e.length<1)return e;e&&(e=k.apply(e));var u,d=[];t&&d.push(t),r&&d.push(r),i&&i.length&&(d=d.concat(i));for(var h=0,p=d.length;p>h;h++){var f=d[h];if(g[f]&&"undefined"!=typeof g[f][e]&&(u=Q(e,n,o)),"undefined"!=typeof u)break}return u||""===u||(u=e,c&&!R&&(u=V(e))),u},d&&(angular.equals(g,{})&&L.use(L.use()),i&&i.length))for(var X=function(e){$(e.key,e.table)},J=0,Z=i.length;Z>J;J++)N[i[J]]=j(i[J]).then(X);return L}]}]),angular.module("pascalprecht.translate").factory("$translateDefaultInterpolation",["$interpolate",function(e){var t,n={},i="default",o=null,r={escaped:function(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=angular.element("<div></div>").text(e[n]).html());return t}},s=function(e){var t;return t=angular.isFunction(r[o])?r[o](e):e};return n.setLocale=function(e){t=e},n.getInterpolationIdentifier=function(){return i},n.useSanitizeValueStrategy=function(e){return o=e,this},n.interpolate=function(t,n){return o&&(n=s(n)),e(t)(n||{})},n}]),angular.module("pascalprecht.translate").constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY"),angular.module("pascalprecht.translate").directive("translate",["$translate","$q","$interpolate","$compile","$parse","$rootScope",function(e,t,n,i,o,r){return{restrict:"AE",scope:!0,compile:function(t,s){var a=s.translateValues?s.translateValues:void 0,l=s.translateInterpolation?s.translateInterpolation:void 0,c=t[0].outerHTML.match(/translate-value-+/i),u="^(.*)("+n.startSymbol()+".*"+n.endSymbol()+")(.*)";return function(t,d,h){if(t.interpolateParams={},t.preText="",t.postText="",h.$observe("translate",function(e){if(angular.equals(e,"")||!angular.isDefined(e)){var i=d.text().match(u);angular.isArray(i)?(t.preText=i[1],t.postText=i[3],t.translationId=n(i[2])(t.$parent)):t.translationId=d.text().replace(/^\s+|\s+$/g,"")}else t.translationId=e}),h.$observe("translateDefault",function(e){t.defaultText=e}),a&&h.$observe("translateValues",function(e){e&&t.$parent.$watch(function(){angular.extend(t.interpolateParams,o(e)(t.$parent))})}),c){var p=function(e){h.$observe(e,function(n){t.interpolateParams[angular.lowercase(e.substr(14,1))+e.substr(15)]=n})};for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&"translateValue"===f.substr(0,14)&&"translateValues"!==f&&p(f)}var g=function(t,n,o){o||"undefined"==typeof n.defaultText||(t=n.defaultText),d.html(n.preText+t+n.postText);var r=e.isPostCompilingEnabled(),a="undefined"!=typeof s.translateCompile,l=a&&"false"!==s.translateCompile;(r&&!a||l)&&i(d.contents())(n)},m=function(){return a||c?function(){var n=function(){t.translationId&&t.interpolateParams&&e(t.translationId,t.interpolateParams,l).then(function(e){g(e,t,!0)},function(e){g(e,t,!1)})};t.$watch("interpolateParams",n,!0),t.$watch("translationId",n)}:function(){var n=t.$watch("translationId",function(i){t.translationId&&i&&e(i,{},l).then(function(e){g(e,t,!0),n()},function(e){g(e,t,!1),n()})},!0)}}(),v=r.$on("$translateChangeSuccess",m);m(),t.$on("$destroy",v)}}}}]),angular.module("pascalprecht.translate").directive("translateCloak",["$rootScope","$translate",function(e,t){return{compile:function(n){var i=e.$on("$translateChangeEnd",function(){n.removeClass(t.cloakClassName()),i(),i=null});n.addClass(t.cloakClassName())}}}]),angular.module("pascalprecht.translate").filter("translate",["$parse","$translate",function(e,t){return function(n,i,o){return angular.isObject(i)||(i=e(i)(this)),t.instant(n,i,o)}}]),angular.module("pascalprecht.translate").factory("$translateStaticFilesLoader",["$q","$http",function(e,t){return function(n){if(!n||!angular.isString(n.prefix)||!angular.isString(n.suffix))throw new Error("Couldn't load static files, no prefix or suffix specified!");var i=e.defer();return t({url:[n.prefix,n.key,n.suffix].join(""),method:"GET",params:""}).success(function(e){i.resolve(e)}).error(function(){i.reject(n.key)}),i.promise}}]),function(e){function t(t,n){var i;return e.Notification?i=new e.Notification(t,{icon:b(n.icon)?n.icon:n.icon.x32,body:n.body||f,tag:n.tag||f}):e.webkitNotifications?(i=e.webkitNotifications.createNotification(n.icon,t,n.body),i.show()):navigator.mozNotification?(i=navigator.mozNotification.createNotification(t,n.body,n.icon),i.show()):e.external&&e.external.msIsSiteMode()&&(e.external.msSiteModeClearIconOverlay(),e.external.msSiteModeSetIconOverlay(b(n.icon)?n.icon:n.icon.x16,t),e.external.msSiteModeActivate(),i={ieVerification:m+1}),i}function n(t){return{close:function(){t&&(t.close?t.close():t.cancel?t.cancel():e.external&&e.external.msIsSiteMode()&&t.ieVerification===m&&e.external.msSiteModeClearIconOverlay())}}}function i(t){if(g){var n=v(t)?t:C;e.webkitNotifications&&e.webkitNotifications.checkPermission?e.webkitNotifications.requestPermission(n):e.Notification&&e.Notification.requestPermission&&e.Notification.requestPermission(n)}}function o(){var t;return g?(e.Notification&&e.Notification.permissionLevel?t=e.Notification.permissionLevel():e.webkitNotifications&&e.webkitNotifications.checkPermission?t=d[e.webkitNotifications.checkPermission()]:e.Notification&&e.Notification.permission?t=e.Notification.permission:navigator.mozNotification?t=c:e.external&&void 0!==e.external.msIsSiteMode()&&(t=e.external.msIsSiteMode()?c:l),t):void 0}function r(e){return e&&y(e)&&w(_,e),_}function s(){return _.pageVisibility?document.hidden||document.msHidden||document.mozHidden||document.webkitHidden:!0}function a(i,r){var a,l;return g&&s()&&b(i)&&r&&(b(r.icon)||y(r.icon))&&o()===c&&(a=t(i,r)),l=n(a),_.autoClose&&a&&!a.ieVerification&&a.addEventListener&&a.addEventListener("show",function(){var t=l;e.setTimeout(function(){t.close()},_.autoClose)}),l}var l="default",c="granted",u="denied",d=[c,l,u],h={pageVisibility:!1,autoClose:0},p={},f="",g=function(){var t=!1;try{t=!!(e.Notification||e.webkitNotifications||navigator.mozNotification||e.external&&void 0!==e.external.msIsSiteMode())}catch(n){}return t}(),m=Math.floor(10*Math.random()+1),v=function(e){return e&&e.constructor===Function},b=function(e){return e&&e.constructor===String},y=function(e){return e&&e.constructor===Object},w=function(e,t){var n,i;for(n in t)i=t[n],n in e&&(e[n]===i||n in p&&p[n]===i)||(e[n]=i);return e},C=function(){},_=h;e.notify={PERMISSION_DEFAULT:l,PERMISSION_GRANTED:c,PERMISSION_DENIED:u,isSupported:g,config:r,createNotification:a,permissionLevel:o,requestPermission:i},v(Object.seal)&&Object.seal(e.notify)}(window),!function(e){!function(e,t,n){function i(e){if("string"==typeof e)return e;var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&").replace(/\+/g,"%20")}function o(e,t){return t?u.hasCapabilities("classList")?e.classList.contains(t):e.className.indexOf(t)>-1:!1}function r(e,t){if(t&&0!==t.length&&1===e.nodeType){var n=t.length,i=0;if(u.hasCapabilities("classList"))for(;n>i;++i)e.classList.toggle(t[i]);else{for(var r=(" "+e.className+" ").replace(/[\s+]/," ");n>i;++i)o(e,t[i])?r=r.replace(" "+t[i]+" "," "):r+=t[i]+" ";e.className=u.trim(r)}}}function s(e,t){if(t&&0!==t.length&&1===e.nodeType){var n=t.length,i=0;if(u.hasCapabilities("classList"))for(;n>i;++i)e.classList.add(t[i]);else if(e.className||1!==t.length){for(var o=" "+e.className+" ";n>i;++i)~o.indexOf(" "+t[i]+" ")||(o+=t[i]+" ");e.className=u.trim(o)}else e.className=t.join(" ")}}function a(e,t){if(t&&0!==t.length&&1===e.nodeType){var n=t.length,i=0;if(u.hasCapabilities("classList"))for(;n>i;++i)e.classList.remove(t[i]);else{for(var o=(" "+e.className+" ").replace(/[\s+]/," ");n>i;++i)o=o.replace(" "+t[i]+" "," ");e.className=u.trim(o)}}}var l=Array.prototype.slice,c=/^#([\w-]*)$/,t=function(n,i){var o=[];if("string"==typeof n){var r=c.exec(n);if(i=i||document,r&&r[1]){var s=i.getElementById(r[1]);s&&o.push(s)}else o=i.querySelectorAll(n)}else n&&(n.nodeType||e.XMLHttpRequest&&n instanceof XMLHttpRequest)?(o=[n],i=n):t.isArray(n)&&(o=n.slice(),i=null);return new h(o,i)},u=t,d=function(e){if("IE"!==u.env.name||u.env.version>9)return l.call(e);for(var t=[],n=0,i=e.length;i>n;++n)t.push(e[n]);return t},h=function(e,t){var n=d(e);this.context=t,this.toArray=function(){return n},this.length=n.length,this.first=n[0],this.last=n[n.length-1],this.get=function(e){return void 0===e?n:n[e]}};h.prototype.some=function(e,t){return u.some(this.get(),e,t)},h.prototype.forEach=function(e,t){return u.forEach(this.get(),e,t),this},h.prototype.map=function(e,t){return new h(u.map(this.get(),e,t),this.context)},h.prototype.filter=function(e,t){return new h(u.filter(this.get(),e,t),this.context)},h.prototype.find=function(e){return u(e,this.first)};var p=e.OTHelpers;e.OTHelpers=t,e.___othelpers=!0,t.keys=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t};var f=Array.prototype.forEach||function(e,t){for(var n=0,i=this.length||0;i>n;++n)n in this&&e.call(t,this[n],n)};t.forEach=function(e,t,n){return f.call(e,t,n)};var g=Array.prototype.map||function(e,t){var n=[];return f.call(this,function(i,o){n.push(e.call(t,i,o))}),n};t.map=function(e,t){return g.call(e,t)};var m=Array.prototype.filter||function(e,t){var n=[];return f.call(this,function(i,o){e.call(t,i,o)&&n.push(i)}),n};t.filter=function(e,t,n){return m.call(e,t,n)};var v=Array.prototype.some||function(e,t){for(var n=!1,i=0,o=this.length||0;o>i;++i)if(i in this&&e.call(t,this[i],i)){n=!0;break}return n};t.find=function(e,t,n){if(!u.isFunction(t))throw new TypeError("iter must be a function");for(var i=void 0,o=0,r=e.length||0;r>o;++o)if(o in e&&t.call(n,e[o],o)){i=e[o];break}return i},t.findIndex=function(e,t,n){if(!u.isFunction(t))throw new TypeError("iter must be a function");for(var i=0,o=e.length||0;o>i;++i)if(i in e&&t.call(n,e[i],i,e))return i;return-1},t.some=function(e,t,n){return v.call(e,t,n)};var b=Array.prototype.indexOf||function(e,t){var n,i,o=t?t:0;if(!this)throw new TypeError;if(i=this.length,0===i||o>=i)return-1;for(0>o&&(o=i-Math.abs(o)),n=o;i>n;n++)if(this[n]===e)return n;return-1};t.arrayIndexOf=function(e,t,n){return b.call(e,t,n)};var y=Function.prototype.bind||function(){var e=l.call(arguments),t=e.shift(),n=this;return function(){return n.apply(t,e.concat(l.call(arguments)))}};t.bind=function(){var e=l.call(arguments),t=e.shift();return y.apply(t,e)};var w=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};t.trim=function(e){return w.call(e)},t.noConflict=function(){return t.noConflict=function(){return t},e.OTHelpers=p,t},t.isNone=function(e){return void 0===e||null===e},t.isObject=function(e){return e===Object(e)},t.isFunction=function(e){return!!e&&(-1!==e.toString().indexOf("()")||"[object Function]"===Object.prototype.toString.call(e))},t.isArray=t.isFunction(Array.isArray)&&Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isEmpty=function(e){if(null===e||void 0===e)return!0;if(t.isArray(e)||"string"==typeof e)return 0===e.length;for(var n in e)if(e.hasOwnProperty(n))return!1;return!0},t.extend=function(){var e=l.call(arguments),n=e.shift();return t.forEach(e,function(e){for(var t in e)n[t]=e[t]}),n},t.defaults=function(){var e=l.call(arguments),n=e.shift();return t.forEach(e,function(e){for(var t in e)void 0===n[t]&&(n[t]=e[t])}),n},t.clone=function(e){return t.isObject(e)?t.isArray(e)?e.slice():t.extend({},e):e},t.noop=function(){},t.now=function(){var n,i=e.performance||{},o=i.now||i.mozNow||i.msNow||i.oNow||i.webkitNow;return o?(o=t.bind(o,i),n=i.timing.navigationStart,function(){return n+o()}):function(){return(new Date).getTime()}}(),t.canDefineProperty=!0;try{Object.defineProperty({},"x",{})}catch(C){t.canDefineProperty=!1}t.defineGetters=function(e,n,i){var o={};void 0===i&&(i=!1);for(var r in n)o[r]={get:n[r],enumerable:i};t.defineProperties(e,o)};var _=function(e,t,n){return t&&!n?function(){return t.call(e)}:t&&n?function(i){return void 0!==i&&n.call(e,i),t.call(e)}:function(t){void 0!==t&&n.call(e,t)}};t.defineProperties=function(e,t){for(var n in t)e[n]=_(e,t[n].get,t[n].set)},Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),t.invert=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t},t.Event=function(){return function(e,i){this.type=e,this.cancelable=i!==n?i:!0;var o=!1;this.preventDefault=function(){this.cancelable?o=!0:t.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")},this.isDefaultPrevented=function(){return o}}},t.statable=function(e,n,i,o,r){var s,a=e.currentState=i,l=function(i){if(a!==i){if(-1===t.arrayIndexOf(n,i))return void(r&&t.isFunction(r)&&r("invalidState",i));e.previousState=s=a,e.currentState=a=i,o&&t.isFunction(o)&&o(i,s)}};return e.is=function(){return-1!==t.arrayIndexOf(arguments,a)},e.isNot=function(){return-1===t.arrayIndexOf(arguments,a)},l},function(){function n(e,t,n){var i=t&&n||0,o=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>o&&(t[i+o++]=h[e])});16>o;)t[i+o++]=0;return t}function i(e,t){var n=t||0,i=d;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}function o(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new u(16):null,e=null),e=e||{};var r=e.random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;16>s;s++)t[o+s]=r[s];return t||i(r)}var r,s,a=new Array(16);if(r=function(){var e,t=a,n=0;for(n=0;16>n;n++)0===(3&n)&&(e=4294967296*Math.random()),t[n]=e>>>((3&n)<<3)&255;return t},e.crypto&&crypto.getRandomValues){var l=new Uint32Array(4);s=function(){crypto.getRandomValues(l);for(var e=0;16>e;e++)a[e]=l[e>>2]>>>8*(3&e)&255;return a}}for(var c=s||r,u="function"==typeof Buffer?Buffer:Array,d=[],h={},p=0;256>p;p++)d[p]=(p+256).toString(16).substr(1),h[d[p]]=p;var f=o;f.v4=o,f.parse=n,f.unparse=i,f.BufferClass=u,f.mathRNG=r,f.whatwgRNG=s,t.uuid=f}(),function(){"use strict";function i(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function s(){}function a(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function l(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function c(e,t){return"onerror"===e?void Se.on("error",t):2!==arguments.length?Se[e]:void(Se[e]=t)}function u(){setTimeout(function(){for(var e,t=0;t<ke.length;t++){e=ke[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),Se.trigger(e.name,e.payload)}ke.length=0},50)}function d(e,t,n){1===ke.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:Ce(),error:Se["instrument-with-stack"]?new Error(t._label):null}})&&u()}function h(){return new TypeError("A promises callback cannot return that same promise.")}function p(){}function f(e){try{return e.then}catch(t){return Ie.error=t,Ie}}function g(e,t,n,i){try{e.call(t,n,i)}catch(o){return o}}function m(e,t,n){Se.async(function(e){var i=!1,o=g(n,t,function(n){i||(i=!0,t!==n?y(e,n):C(e,n))},function(t){i||(i=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&o&&(i=!0,_(e,o))},e)}function v(e,t){t._state===Ee?C(e,t._result):t._state===De?(t._onError=null,_(e,t._result)):x(t,n,function(n){t!==n?y(e,n):C(e,n)},function(t){_(e,t)})}function b(e,t){if(t.constructor===e.constructor)v(e,t);else{var i=f(t);i===Ie?_(e,Ie.error):i===n?C(e,t):o(i)?m(e,t,i):C(e,t)}}function y(e,t){e===t?C(e,t):i(t)?b(e,t):C(e,t)}function w(e){e._onError&&e._onError(e._result),S(e)}function C(e,t){e._state===$e&&(e._result=t,e._state=Ee,0===e._subscribers.length?Se.instrument&&Te("fulfilled",e):Se.async(S,e))}function _(e,t){e._state===$e&&(e._state=De,e._result=t,Se.async(w,e))}function x(e,t,n,i){var o=e._subscribers,r=o.length;e._onError=null,o[r]=t,o[r+Ee]=n,o[r+De]=i,0===r&&e._state&&Se.async(S,e)}function S(e){var t=e._subscribers,n=e._state;if(Se.instrument&&Te(n===Ee?"fulfilled":"rejected",e),0!==t.length){for(var i,o,r=e._result,s=0;s<t.length;s+=3)i=t[s],o=t[s+n],i?$(n,i,o,r):o(r);e._subscribers.length=0}}function k(){this.error=null}function T(e,t){try{return e(t)}catch(n){return Me.error=n,Me}}function $(e,t,n,i){var r,s,a,l,c=o(n);if(c){if(r=T(n,i),r===Me?(l=!0,s=r.error,r=null):a=!0,t===r)return void _(t,h())}else r=i,a=!0;t._state!==$e||(c&&a?y(t,r):l?_(t,s):e===Ee?C(t,r):e===De&&_(t,r))}function E(e,t){var n=!1;try{t(function(t){n||(n=!0,y(e,t))},function(t){n||(n=!0,_(e,t))})}catch(i){_(e,i)}}function D(e,t,n){return e===Ee?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function I(e,t,n,i){this._instanceConstructor=e,this.promise=new e(p,i),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&C(this.promise,this._result))):_(this.promise,this._validationError())}function M(e,t){return new Ae(this,e,!0,t).promise}function A(e,t){function i(e){y(s,e)}function o(e){_(s,e)}var r=this,s=new r(p,t);if(!we(e))return _(s,new TypeError("You must pass an array to race.")),s;for(var a=e.length,l=0;s._state===$e&&a>l;l++)x(r.resolve(e[l]),n,i,o);return s}function O(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var i=new n(p,t);return y(i,e),i}function R(e,t){var n=this,i=new n(p,t);return _(i,e),i}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(e,t){this._id=Fe++,this._label=t,this._state=n,this._result=n,this._subscribers=[],Se.instrument&&Te("created",this),p!==e&&(o(e)||P(),this instanceof L||N(),E(this,e))}function F(e,t,n){this._superConstructor(e,t,!1,n)}function U(e,t){return new F(Ue,e,t).promise}function j(e,t){return Ue.all(e,t)}function H(e,t){Xe[Ve]=e,Xe[Ve+1]=t,Ve+=2,2===Ve&&He()}function W(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(Y)}}function B(){return function(){je(Y)}}function V(){var e=0,t=new Ge(Y),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function z(){var e=new MessageChannel;return e.port1.onmessage=Y,function(){e.port2.postMessage(0)}}function q(){return function(){setTimeout(Y,1)}}function Y(){for(var e=0;Ve>e;e+=2){var t=Xe[e],i=Xe[e+1];t(i),Xe[e]=n,Xe[e+1]=n}Ve=0}function G(){try{var e=require,t=e("vertx");return je=t.runOnLoop||t.runOnContext,B()}catch(n){return q()}}function K(e){var t={};return t.promise=new Ue(function(e,n){t.resolve=e,t.reject=n},e),t}function Q(e,t,n){return Ue.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as filter's second argument.");for(var i=e.length,r=new Array(i),s=0;i>s;s++)r[s]=t(e[s]);return Ue.all(r,n).then(function(t){for(var n=new Array(i),o=0,r=0;i>r;r++)t[r]&&(n[o]=e[r],o++);return n.length=o,n})})}function X(e,t,n){this._superConstructor(e,t,!0,n)}function J(e,t,n){this._superConstructor(e,t,!1,n)}function Z(e,t){return new J(Ue,e,t).promise}function ee(e,t){return new et(Ue,e,t).promise}function te(e,t,n){return Ue.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as map's second argument.");for(var i=e.length,r=new Array(i),s=0;i>s;s++)r[s]=t(e[s]);return Ue.all(r,n)})}function ne(){this.value=n}function ie(e){try{return e.then}catch(t){return ot.value=t,ot}}function oe(e,t,n){try{e.apply(t,n)}catch(i){return ot.value=i,ot}}function re(e,t){for(var n,i,o={},r=e.length,s=new Array(r),a=0;r>a;a++)s[a]=e[a];for(i=0;i<t.length;i++)n=t[i],o[n]=s[i+1];return o}function se(e){for(var t=e.length,n=new Array(t-1),i=1;t>i;i++)n[i-1]=e[i];return n}function ae(e,t){return{then:function(n,i){return e.call(t,n,i)}}}function le(e,t){var i=function(){for(var i,o=this,r=arguments.length,s=new Array(r+1),a=!1,l=0;r>l;++l){if(i=arguments[l],!a){if(a=de(i),a===rt){var c=new Ue(p);return _(c,rt.value),c}a&&a!==!0&&(i=ae(a,i))}s[l]=i}var u=new Ue(p);return s[r]=function(e,i){e?_(u,e):t===n?y(u,i):t===!0?y(u,se(arguments)):we(t)?y(u,re(arguments,t)):y(u,i)},a?ue(u,s,e,o):ce(u,s,e,o)};return i.__proto__=e,i}function ce(e,t,n,i){var o=oe(n,i,t);return o===ot&&_(e,o.value),e}function ue(e,t,n,i){return Ue.all(t).then(function(t){var o=oe(n,i,t);return o===ot&&_(e,o.value),e})}function de(e){return e&&"object"==typeof e?e.constructor===Ue?!0:ie(e):!1}function he(e,t){return Ue.race(e,t)}function pe(e,t){return Ue.reject(e,t)}function fe(e,t){return Ue.resolve(e,t)}function ge(e){throw setTimeout(function(){throw e}),e}function me(e,t){Se.async(e,t)}function ve(){Se.on.apply(Se,arguments)}function be(){Se.off.apply(Se,arguments)}var ye;ye=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var we=ye,Ce=Date.now||function(){return(new Date).getTime()},_e=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return s.prototype=e,new s},xe={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=n,e},on:function(e,t){var n,i=l(this);n=i[e],n||(n=i[e]=[]),-1===a(n,t)&&n.push(t)},off:function(e,t){var n,i,o=l(this);return t?(n=o[e],i=a(n,t),void(-1!==i&&n.splice(i,1))):void(o[e]=[])},trigger:function(e,t){var n,i,o=l(this);if(n=o[e])for(var r=0;r<n.length;r++)(i=n[r])(t)}},Se={instrument:!1};xe.mixin(Se);var ke=[],Te=d,$e=void 0,Ee=1,De=2,Ie=new k,Me=new k,Ae=I;I.prototype._validateInput=function(e){return we(e)},I.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},I.prototype._init=function(){this._result=new Array(this.length)},I.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,i=0;t._state===$e&&e>i;i++)this._eachEntry(n[i],i)},I.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;r(e)?e.constructor===n&&e._state!==$e?(e._onError=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(Ee,t,e))},I.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===$e&&(this._remaining--,this._abortOnReject&&e===De?_(i,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&C(i,this._result)},I.prototype._makeResult=function(e,t,n){return n},I.prototype._willSettleAt=function(e,t){var i=this;x(e,n,function(e){i._settledAt(Ee,t,e)},function(e){i._settledAt(De,t,e)})};var Oe=M,Re=A,Pe=O,Ne=R,Le="rsvp_"+Ce()+"-",Fe=0,Ue=L;L.cast=Pe,L.all=Oe,L.race=Re,L.resolve=Pe,L.reject=Ne,L.prototype={constructor:L,_guidKey:Le,_onError:function(e){Se.async(function(t){setTimeout(function(){t._onError&&Se.trigger("error",e)},0)},this)},then:function(e,t,n){var i=this,o=i._state;if(o===Ee&&!e||o===De&&!t)return Se.instrument&&Te("chained",this,this),this;i._onError=null;var r=new this.constructor(p,n),s=i._result;if(Se.instrument&&Te("chained",i,r),o){var a=arguments[o-1];Se.async(function(){$(o,r,a,s)})}else x(i,r,e,t);return r},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}},F.prototype=_e(Ae.prototype),F.prototype._superConstructor=Ae,F.prototype._makeResult=D,F.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var je,He,We=U,Be=j,Ve=0,ze=({}.toString,H),qe="undefined"!=typeof e?e:n,Ye=qe||{},Ge=Ye.MutationObserver||Ye.WebKitMutationObserver,Ke="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Qe="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Xe=new Array(1e3);He=Ke?W():Ge?V():Qe?z():qe===n&&"function"==typeof require?G():q();var Je=K,Ze=Q,et=X;X.prototype=_e(Ae.prototype),X.prototype._superConstructor=Ae,X.prototype._init=function(){this._result={}},X.prototype._validateInput=function(e){return e&&"object"==typeof e},X.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},X.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var i in t)e._state===$e&&t.hasOwnProperty(i)&&n.push({position:i,entry:t[i]});var o=n.length;this._remaining=o;for(var r,s=0;e._state===$e&&o>s;s++)r=n[s],this._eachEntry(r.entry,r.position)},J.prototype=_e(et.prototype),J.prototype._superConstructor=Ae,J.prototype._makeResult=D,J.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var tt=Z,nt=ee,it=te,ot=new ne,rt=new ne,st=le,at=he,lt=pe,ct=fe,ut=ge;if(Se.async=ze,"undefined"!=typeof e&&"object"==typeof e.__PROMISE_INSTRUMENTATION__){var dt=e.__PROMISE_INSTRUMENTATION__;c("instrument",!0);for(var ht in dt)dt.hasOwnProperty(ht)&&ve(ht,dt[ht])}var pt={race:at,Promise:Ue,allSettled:We,hash:nt,hashSettled:tt,denodeify:st,on:ve,off:be,map:it,filter:Ze,resolve:ct,reject:lt,all:Be,rethrow:ut,defer:Je,EventTarget:xe,configure:c,async:me};t.RSVP=pt}.call(this);var x,S=["description","fileName","lineNumber","message","name","number","stack"];t.Error=function(e,t,n){switch(arguments.length){case 1:u.isObject(e)&&(n=e,t=void 0,e=void 0);break;case 2:u.isObject(t)&&(n=t,t=void 0)}if(n instanceof Error)for(var i=0,o=S.length;o>i;++i)this[S[i]]=n[S[i]];else if(u.isObject(n))for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);if(!(this.fileName&&this.lineNumber&&this.columnNumber&&this.stack)){var s=x();!this.fileName&&s.fileName&&(this.fileName=s.fileName),!this.lineNumber&&s.lineNumber&&(this.lineNumber=s.lineNumber),!this.columnNumber&&s.columnNumber&&(this.columnNumber=s.columnNumber),!this.stack&&s.stack&&(this.stack=s.stack)}!this.message&&e&&(this.message=e),!this.name&&t&&(this.name=t)},t.Error.prototype.toString=t.Error.prototype.valueOf=function(){var e="";return this.fileName&&(e+=" "+this.fileName),this.lineNumber&&(e+=" "+this.lineNumber,this.columnNumber&&(e+=":"+this.columnNumber)),"<"+(this.name?this.name+" ":"")+this.message+e+">"};var k=function(e,t){return u.map(t.slice(2),function(e){var t={fileName:e.getFileName(),linenumber:e.getLineNumber(),columnNumber:e.getColumnNumber()};return e.getFunctionName()&&(t.functionName=e.getFunctionName()),e.getMethodName()&&(t.methodName=e.getMethodName()),e.getThis()&&(t.self=e.getThis()),t})};x=function(){var t,n,i,o={};switch(u.env.name){case"Firefox":case"Safari":case"IE":if("IE"===u.env.name)i=new Error;else try{e.call.js.is.explody}catch(r){i=r}t=i.stack.split("\n"),t.shift(),t.shift(),o.stack=t,"IE"===u.env.name&&(o.stack.shift(),o.stack=u.map(t,function(e){return e.replace(/^\s+at\s+/g,"")})),n=/@(.+?):([0-9]+)(:([0-9]+))?$/.exec(t[0]),n&&(o.fileName=n[1],o.lineNumber=parseInt(n[2],10),n.length>3&&(o.columnNumber=parseInt(n[4],10)));break;case"Chrome":case"Node":case"Opera":var s=Error.prepareStackTrace;Error.prepareStackTrace=k,i=new Error,o.stack=i.stack,Error.prepareStackTrace=s;var a=o.stack[0];o.lineNumber=a.lineNumber,o.columnNumber=a.columnNumber,o.fileName=a.fileName,a.functionName&&(o.functionName=a.functionName),a.methodName&&(o.methodName=a.methodName),a.self&&(o.self=a.self);break;default:i=new Error,i.stack&&(o.stack=i.stack.split("\n"))}return i.message&&(o.message=i.message),o},function(){var n=-1,i=function(e){if(e===n)return!0;if("number"==typeof e&&"number"==typeof n)return e>n;for(var t=e.split("."),i=n.split("."),o=(t.length>i.length?i:t).length,r=0;o>r;++r)if(parseInt(t[r],10)>parseInt(i[r],10))return!0;return r<t.length?!0:!1},o=function(){if("undefined"!=typeof process&&"undefined"!=typeof process.versions&&"string"==typeof process.versions.node)return n=process.versions.node,"v"===n.substr(1)&&(n=n.substr(1)),{name:"Node",version:n,userAgent:"Node "+n,iframeNeedsLoad:!1,versionGreaterThan:i};var t,o=e.navigator.userAgent.toLowerCase(),r=e.navigator.appName,s="unknown";

return o.indexOf("opera")>-1||o.indexOf("opr")>-1?(s="Opera",null!==/opr\/([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))):o.indexOf("firefox")>-1?(s="Firefox",null!==/firefox\/([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))):"Microsoft Internet Explorer"===r?(s="IE",null!==/msie ([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))):"Netscape"===r&&o.indexOf("trident")>-1?(s="IE",null!==/trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))):o.indexOf("chrome")>-1?(s="Chrome",null!==/chrome\/([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))):(t=e.navigator.vendor)&&t.toLowerCase().indexOf("apple")>-1&&(s="Safari",null!==/version\/([0-9]{1,}[\.0-9]{0,})/.exec(o)&&(n=parseFloat(RegExp.$1))),{name:s,version:n,userAgent:e.navigator.userAgent,iframeNeedsLoad:o.indexOf("webkit")<0,versionGreaterThan:i}}();t.env=o,t.browser=function(){return t.env.name},t.browserVersion=function(){return t.env}}();var T;"Node"===u.env.name&&!function(){var e=require("events").EventEmitter,t=require("util"),n=function(){e.call(this),this.events={}};t.inherits(n,e),T=function(){var e=new n,t=e.on,i=e.removeListener;return e.addListeners=function(n,i,o,r){var s={handler:i};o&&(s.context=o),r&&(s.closure=r),u.forEach(n,function(n){e.events[n]||(e.events[n]=[]),e.events[n].push(s),t(n,i);var o=n+":added";e.events[o]&&e.emit(o,e.events[n].length)})},e.removeAllListenersNamed=function(t){var n=t.split(" ");e.removeAllListeners(n),u.forEach(n,function(t){e.events[t]&&delete e.events[t]})},e.removeListeners=function(t,n,o){function r(e){return!(e.handler===n&&e.closure===o)}u.forEach(t.split(" "),function(t){if(e.events[t]){i(t,n),e.events[t]=u.filter(e.events[t],r),0===e.events[t].length&&delete e.events[t];var o=t+":removed";e.events[o]&&e.emit(o,e.events[t]?e.events[t].length:0)}})},e.removeAllListeners=function(){e.events={},e.removeAllListeners()},e.dispatchEvent=function(e,t){this.emit(e.type,e),t&&t.call(null,e)},e.trigger=u.bind(e.emit,e),e}}();var $;if("Node"!==u.env.name&&($=function(e,t){function n(e,t){e&&e.apply(null,t.slice())}function i(e,t,i){var o=r.events[e];if(o&&0!==o.length){var s=o.length;u.forEach(o,function(o){function a(e){return e.handler===o.handler}u.callAsync(function(){try{r.events[e]&&u.some(r.events[e],a)&&(o.closure||o.handler).apply(o.context||null,t)}finally{s--,0===s&&n(i,t)}})})}}function o(e,t){var n=r.events[e];n&&0!==n.length&&u.forEach(n,function(e){(e.closure||e.handler).apply(e.context||null,t)})}var r={events:{}},s=t===!0?o:i;return r.addListeners=function(e,t,n,i){var o={handler:t};n&&(o.context=n),i&&(o.closure=i),u.forEach(e,function(e){r.events[e]||(r.events[e]=[]),r.events[e].push(o);var t=e+":added";r.events[t]&&s(t,[r.events[e].length])})},r.removeListeners=function(e,t,n){function i(e){var i=e.handler.originalHandler===t||e.handler===t;return!(i&&e.context===n)}u.forEach(e,function(e){if(r.events[e]){r.events[e]=u.filter(r.events[e],i),0===r.events[e].length&&delete r.events[e];var t=e+":removed";r.events[t]&&s(t,[r.events[e]?r.events[e].length:0])}})},r.removeAllListenersNamed=function(e){u.forEach(e,function(e){r.events[e]&&delete r.events[e]})},r.removeAllListeners=function(){r.events={}},r.dispatchEvent=function(e,t){return r.events[e.type]&&0!==r.events[e.type].length?void s(e.type,[e],t):void n(t,[e])},r.trigger=function(e,t){r.events[e]&&0!==r.events[e].length&&s(e,t)},r}),"Node"===e.OTHelpers.env.name){var E=require("request");t.request=function(e,t,n){var i=function(e,t,i){var o={response:t,body:i};!e&&t.statusCode>=200&&(t.statusCode<300||304===t.statusCode)?n(null,o):n(e,o)};"get"===t.method.toLowerCase()?E.get(e,i):E.post(e,t.body,i)},t.getJSON=function(e,t,n){var i=require("underscore").extend({Accept:"application/json"},t.headers||{});E.get({url:e,headers:i,json:!0},function(e,t){n(e,t&&t.body)})}}"Node"!==e.OTHelpers.env.name&&(t.xdomainRequest=function(e,t,n){function o(e,t){r.onload=r.onerror=r.ontimeout=function(){},r=void 0,n(e,t)}var r=new XDomainRequest,s=t||{},a=s.method.toLowerCase();return a?(a=a.toUpperCase(),"GET"!==a&&"POST"!==a?void n(new Error("HTTP method can only be ")):(r.onload=function(){o(null,{target:{responseText:r.responseText,headers:{"content-type":r.contentType}}})},r.onerror=function(){o(new Error("XDomainRequest of "+e+" failed"))},r.ontimeout=function(){o(new Error("XDomainRequest of "+e+" timed out"))},r.open(a,e),void r.send(t.body&&i(t.body)))):void n(new Error("No HTTP method specified in options"))},t.request=function(e,n,o){var r=new XMLHttpRequest,s=n||{},a=s.method;if(!a)return void o(new Error("No HTTP method specified in options"));o&&(t.on(r,"load",function(e){var t=e.target.status;t>=200&&(300>t||304===t)?o(null,e):o(e)}),t.on(r,"error",o)),r.open(n.method,e,!0),s.headers||(s.headers={});for(var l in s.headers)r.setRequestHeader(l,s.headers[l]);r.send(n.body&&i(n.body))},t.getJSON=function(e,n,i){n=n||{};var o=function(e,t){if(e)i(e,t&&t.target&&t.target.responseText);else{var n;try{n=JSON.parse(t.target.responseText)}catch(o){return void i(o,t&&t.target&&t.target.responseText)}i(null,n,t)}};if(n.xdomainrequest)t.xdomainRequest(e,{method:"GET"},o);else{var r=t.extend({Accept:"application/json"},n.headers||{});t.get(e,t.extend(n||{},{headers:r}),o)}});var D=5,I=4,M=3,A=2,O=1,R=0,P=R,N=function(e){return P="number"==typeof e?e:0};t.useLogHelpers=function(n){function i(t,i,o){return function(){if(n.shouldLog(i)){var r=e.console,s=h(arguments);if(r&&r[t])r[t].apply||u?(r[t].apply||(r[t]=Function.prototype.bind.call(r[t],r)),r[t].apply(r,s)):r[t](s);else if(o)return void o.apply(n,s);a(t,h(arguments))}}}function o(){var e=new Date;return e.toLocaleTimeString()+e.getMilliseconds()}function r(e){try{return JSON.stringify(e)}catch(t){return e.toString()}}function s(e){var n=[];if("undefined"==typeof e);else if(null===e)n.push("NULL");else if(t.isArray(e))for(var i=0;i<e.length;++i)n.push(r(e[i]));else if(t.isObject(e))for(var o in e){var s;t.isFunction(e[o])?e.hasOwnProperty(o)&&(s="function "+o+"()"):s=r(e[o]),n.push(o+": "+s)}else if(t.isFunction(e))try{n.push(e.toString())}catch(a){n.push("function()")}else n.push(e.toString());return n.join(", ")}function a(e,t){if(t){var n=s(t);n.length<=2||c.push([e,o(),n])}}n.DEBUG=D,n.LOG=I,n.INFO=M,n.WARN=A,n.ERROR=O,n.NONE=R;var c=[],u=!0;try{Function.prototype.bind.call(e.console.log,e.console)}catch(d){u=!1}var h=function(e){return e};"IE"===t.env.name&&(h=function(e){return[s(l.apply(e))]}),n.log=i("log",n.LOG),n.debug=i("debug",n.DEBUG,n.log),n.info=i("info",n.INFO,n.log),n.warn=i("warn",n.WARN,n.log),n.error=i("error",n.ERROR,n.log),n.setLogLevel=function(e){return n.debug("TB.setLogLevel("+P+")"),N(e)},n.getLogs=function(){return c},n.shouldLog=function(e){return P>=e}},t.useLogHelpers(t),t.setLogLevel(t.ERROR),h.prototype.on=function(e,t){return this.forEach(function(n){if(n.addEventListener)n.addEventListener(e,t,!1);else if(n.attachEvent)n.attachEvent("on"+e,t);else{var i=n["on"+e];n["on"+e]=function(){t.apply(this,arguments),i&&i.apply(this,arguments)}}})},h.prototype.off=function(e,t){return this.forEach(function(n){n.removeEventListener?n.removeEventListener(e,t,!1):n.detachEvent&&n.detachEvent("on"+e,t)})},h.prototype.once=function(e,t){var n=u.bind(function(){this.off(e,n),t.apply(null,arguments)},this);return this.on(e,n)},t.on=function(e,t,n){return u(e).on(t,n)},t.off=function(e,t,n){return u(e).off(t,n)},t.once=function(e,t,n){return u(e).once(t,n)},function(){var n="undefined"==typeof document||"complete"===document.readyState||"interactive"===document.readyState&&document.body,i=[],o=[],r=!1,s=function(){n=!0,"undefined"!=typeof document&&(document.addEventListener?(document.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1)):(document.detachEvent("onreadystatechange",s),e.detachEvent("onload",s))),t.on(e,"unload",a),t.forEach(i,function(e){e[0].call(e[1])}),i=[]},a=function(){r=!0,t.forEach(o,function(e){e[0].call(e[1])}),o=[]};t.onDOMLoad=function(e,n){return t.isReady()?void e.call(n):void i.push([e,n])},t.onDOMUnload=function(e,t){return this.isDOMUnloaded()?void e.call(t):void o.push([e,t])},t.isReady=function(){return!r&&n},t.isDOMUnloaded=function(){return r},n?s():"undefined"!=typeof document&&(document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&s()}),e.attachEvent("onload",s)))}(),t.setCookie=function(e,t){try{localStorage.setItem(e,t)}catch(n){var i=new Date;i.setTime(i.getTime()+31536e6);var o="; expires="+i.toGMTString();document.cookie=e+"="+t+o+"; path=/"}},t.getCookie=function(e){var t;try{return t=localStorage.getItem(e)}catch(n){for(var i=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var s=o[r];" "===s.charAt(0);)s=s.substring(1,s.length);0===s.indexOf(i)&&(t=s.substring(i.length,s.length))}if(t)return t}return null},t.Collection=function(e){var n=[],i={},o=e||"id";t.eventing(this,!0);var r=function(e,n){return t.isFunction(e[n])?e[n]():e[n]},s=t.bind(function(e){this.trigger("update",e),this.trigger("update:"+e.target.id,e)},this),a=t.bind(function(e){this.remove(e.target,e.reason)},this);this.reset=function(){t.forEach(n,function(e){e.off("updated",s,this),e.off("destroyed",a,this)},this),n=[],i={}},this.destroy=function(e){t.forEach(n,function(t){t&&"function"==typeof t.destroy&&t.destroy(e,!0)}),this.reset(),this.off()},this.get=function(e){return e&&void 0!==i[e]?n[i[e]]:void 0},this.has=function(e){return e&&void 0!==i[e]},this.toString=function(){return n.toString()},this.where=function(e,i){return t.isFunction(e)?t.filter(n,e,i):t.filter(n,function(t){for(var n in e)if(e.hasOwnProperty(n)&&r(t,n)!==e[n])return!1;return!0})},this.find=function(e,i){var o;o=t.isFunction(e)?e:function(t){for(var n in e)if(e.hasOwnProperty(n)&&r(t,n)!==e[n])return!1;return!0},o=t.bind(o,i);for(var s=0;s<n.length;++s)if(o(n[s])===!0)return n[s];return null},this.add=function(e){var l=r(e,o);return this.has(l)?(t.warn("Model "+l+" is already in the collection",n),this):(i[l]=n.push(e)-1,e.on("updated",s,this),e.on("destroyed",a,this),this.trigger("add",e),this.trigger("add:"+l,e),this)},this.remove=function(e,t){var l=r(e,o);n.splice(i[l],1);for(var c=i[l];c<n.length;++c)i[n[c][o]]=c;return delete i[l],e.off("updated",s,this),e.off("destroyed",a,this),this.trigger("remove",e,t),this.trigger("remove:"+l,e,t),this},this._triggerAddEvents=function(){var e=this.where.apply(this,arguments);t.forEach(e,function(e){this.trigger("add",e),this.trigger("add:"+r(e,o),e)},this)},this.length=function(){return n.length}},t.castToBoolean=function(e,t){return e===n?t:"true"===e||e===!0},t.roundFloat=function(e,t){return Number(e.toFixed(t))},function(){var e={};t.registerCapability=function(i,o){var r=i.toLowerCase();return e.hasOwnProperty(r)?void t.error("Attempted to register",i,"capability more than once"):t.isFunction(o)?void n(r,o):void t.error("Attempted to register",i,"capability with a callback that isn' a function")};var n=function(t,n){e[t]=function(){var i=n();return e[t]=function(){return i},i}},i=function(t){return e[t]()};t.hasCapabilities=function(){for(var n,o=l.call(arguments),r=0;r<o.length;++r){if(n=o[r].toLowerCase(),!e.hasOwnProperty(n))return t.error("hasCapabilities was called with an unknown capability: "+n),!1;if(i(n)===!1)return!1}return!0}}(),t.registerCapability("websockets",function(){return"WebSocket"in e&&void 0!==e.WebSocket}),function(){var n,i=function(){if(e.postMessage){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}();if(i){var o=[],r="OTHelpers."+t.uuid.v4()+".zero-timeout",s=function(){o=[],e.removeEventListener?e.removeEventListener("message",a):e.detachEvent&&e.detachEvent("onmessage",a)},a=function(n){if(n.source===e&&n.data===r){if(t.isFunction(n.stopPropagation)&&n.stopPropagation(),n.cancelBubble=!0,!e.___othelpers)return void s();if(o.length>0){var i=o.shift(),a=i.shift();a.apply(null,i)}}};t.on(e,"unload",s),e.addEventListener?e.addEventListener("message",a,!0):e.attachEvent&&e.attachEvent("onmessage",a),n=function(){o.push(l.call(arguments)),e.postMessage(r,"*")}}else n=function(){var e=l.call(arguments),t=e.shift();setTimeout(function(){t.apply(null,e)},0)};t.callAsync=n,t.createAsyncHandler=function(e){return function(){var n=l.call(arguments);t.callAsync(function(){e.apply(null,n)})}}}(),t.eventing=function(e,t){var n=(T||$)(this,t);return e.on=function(e,t,i){if("string"==typeof e&&t)n.addListeners(e.split(" "),t,i);else for(var o in e)e.hasOwnProperty(o)&&n.addListeners([o],e[o],t);return this},e.off=function(e,t,i){if("string"==typeof e)t&&u.isFunction(t)?n.removeListeners(e.split(" "),t,i):n.removeAllListenersNamed(e.split(" "));else if(e)for(var o in e)e.hasOwnProperty(o)&&n.removeListeners([o],e[o],i);else n.removeAllListeners();return this},e.once=function(t,n,i){var o=function(){e.off(t,o,i),n.apply(i,arguments)};return o.originalHandler=n,e.on(t,o,i),this},e.dispatchEvent=function(e,t){if(!e.type)throw u.error("OTHelpers.Eventing.dispatchEvent: Event has no type"),u.error(e),new Error("OTHelpers.Eventing.dispatchEvent: Event has no type");return e.target||(e.target=this),n.dispatchEvent(e,t),this},e.trigger=function(){var e=l.call(arguments);return n.trigger(e.shift(),e),this},e.emit=e.trigger,e.addEventListener=function(t,n,i){return u.warn("The addEventListener() method is deprecated. Use on() or once() instead."),e.on(t,n,i)},e.removeEventListener=function(t,n,i){return u.warn("The removeEventListener() method is deprecated. Use off() instead."),e.off(t,n,i)},e},t.createElement=function(e,t,n,i){var o=(i||document).createElement(e);if(t)for(var r in t)if("object"==typeof t[r]){o[r]||(o[r]={});var s=t[r];for(var a in s)o[r][a]=s[a]}else"className"===r?o.className=t[r]:o.setAttribute(r,t[r]);var l=function(e){"string"==typeof e?o.innerHTML=o.innerHTML+e:o.appendChild(e)};return u.isArray(n)?u.forEach(n,l):n&&l(n),o},t.createButton=function(e,t,n){var i=u.createElement("button",t,e);if(n){for(var o in n)n.hasOwnProperty(o)&&u.on(i,o,n[o]);i._boundEvents=n}return i};var L;L="undefined"!=typeof document&&void 0!==document.createElement("div").firstElementChild?function(e){return e.firstElementChild}:function(e){var t=e.firstChild;do{if(1===t.nodeType)return t;t=t.nextSibling}while(t);return null},h.prototype.appendTo=function(e){if(!e)throw new Error("appendTo requires a DOMElement to append to.");return this.forEach(function(t){e.appendChild(t)})},h.prototype.append=function(){var e=this.first;return e?(u.forEach(l.call(arguments),function(t){e.appendChild(t)}),this):this},h.prototype.prepend=function(){if(0===arguments.length)return this;var e,t=this.first;return t?(e=l.call(arguments),L(t)||t.appendChild(e.shift()),u.forEach(e,function(e){t.insertBefore(e,L(t))}),this):this},h.prototype.after=function(e){if(!e)throw new Error("after requires a DOMElement to insert after");return this.forEach(function(t){t.parentElement&&(e!==t.parentNode.lastChild?t.parentElement.insertBefore(t,e):t.parentElement.appendChild(t))})},h.prototype.before=function(e){if(!e)throw new Error("before requires a DOMElement to insert before");return this.forEach(function(t){t.parentElement&&t.parentElement.insertBefore(t,e)})},h.prototype.remove=function(){return this.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})},h.prototype.empty=function(){return this.forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})},h.prototype.isDisplayNone=function(){return this.some(function(e){return 0!==e.offsetWidth&&0!==e.offsetHeight||"none"!==u(e).css("display")?e.parentNode&&e.parentNode.style?u(e.parentNode).isDisplayNone():void 0:!0})},h.prototype.findElementWithDisplayNone=function(e){return u.findElementWithDisplayNone(e)},t.isElementNode=function(e){return e&&"object"==typeof e&&1===e.nodeType},t.removeElement=function(e){u(e).remove()},t.removeElementById=function(e){return u("#"+e).remove()},t.removeElementsByType=function(e,t){return u(t,e).remove()},t.emptyElement=function(e){return u(e).empty()},t.isDisplayNone=function(e){return u(e).isDisplayNone()},t.findElementWithDisplayNone=function(e){return 0!==e.offsetWidth&&0!==e.offsetHeight||"none"!==u.css(e,"display")?e.parentNode&&e.parentNode.style?u.findElementWithDisplayNone(e.parentNode):null:e},t.Modal=function(e){t.eventing(this,!0);var n=arguments[arguments.length-1];if(!t.isFunction(n))throw new Error("OTHelpers.Modal2 must be given a callback");arguments.length<2&&(e={});var i=document.createElement("iframe");i.id=e.id||t.uuid(),i.style.position="absolute",i.style.position="fixed",i.style.height="100%",i.style.width="100%",i.style.top="0px",i.style.left="0px",i.style.right="0px",i.style.bottom="0px",i.style.zIndex=1e3,i.style.border="0";try{i.style.backgroundColor="rgba(0,0,0,0.2)"}catch(o){i.style.backgroundColor="transparent",i.setAttribute("allowTransparency","true")}i.scrolling="no",i.setAttribute("scrolling","no");var r='<!DOCTYPE html><html><head><meta http-equiv="x-ua-compatible" content="IE=Edge"><meta http-equiv="Content-type" content="text/html; charset=utf-8"><title></title></head><body></body></html>',s=function(){var e=i.contentDocument||i.contentWindow.document;t.env.iframeNeedsLoad&&(e.body.style.backgroundColor="transparent",e.body.style.border="none","IE"!==t.env.name&&(e.open(),e.write(r),e.close())),n(i.contentWindow,e)};document.body.appendChild(i),t.env.iframeNeedsLoad?("IE"===t.env.name&&(i.contentWindow.contents=r,i.src='javascript:window["contents"]'),t.on(i,"load",s)):setTimeout(s,0),this.close=function(){return t.removeElement(i),this.trigger("closed"),this.element=i=null,this},this.element=i},function(){function e(t,n,i,o){var r,s=n[i],a=parseFloat(s),l=s.split(/\d/)[0];return o=null!=o?o:/%|em/.test(l)&&t.parentElement?e(t.parentElement,t.parentElement.currentStyle,"fontSize",null):16,r="fontSize"===i?o:/width/i.test(i)?t.clientWidth:t.clientHeight,"em"===l?a*o:"in"===l?96*a:"pt"===l?96*a/72:"%"===l?a/100*r:a}function n(e,t){var n="border"===t?"Width":"",i=t+"Top"+n,o=t+"Right"+n,r=t+"Bottom"+n,s=t+"Left"+n;e[t]=(e[i]===e[o]===e[r]===e[s]?[e[i]]:e[i]===e[r]&&e[s]===e[o]?[e[i],e[o]]:e[s]===e[o]?[e[i],e[o],e[r]]:[e[i],e[o],e[r],e[s]]).join(" ")}function i(t){var i,o=t.currentStyle,r=this,s=e(t,o,"fontSize",null);for(i in o)/width|height|margin.|padding.|border.+W/.test(i)&&"auto"!==r[i]?r[i]=e(t,o,i,s)+"px":"styleFloat"===i?r["float"]=o[i]:r[i]=o[i];return n(r,"margin"),n(r,"padding"),n(r,"border"),r.fontSize=s+"px",r}function o(e){return new i(e)}i.prototype={constructor:i,getPropertyPriority:function(){},getPropertyValue:function(e){return this[e]||""},item:function(){},removeProperty:function(){},setProperty:function(){},getPropertyCSSValue:function(){}},t.getComputedStyle=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView&&e.ownerDocument.defaultView.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle(e):o(e)}}();var F=function(e,t,n){var i={},o=function(t){switch(t){case"width":return u(e).width();case"height":return u(e).height();default:return u(e).css(t)}};u.forEach(t,function(e){i[e]=o(e)});var r=new MutationObserver(function(r){var s={};u.forEach(r,function(n){if("style"===n.attributeName){var r=u.isDisplayNone(e);u.forEach(t,function(e){if(!r||"width"!==e&&"height"!==e){var t=o(e);t!==i[e]&&(s[e]=[i[e],t],i[e]=t)}})}}),u.isEmpty(s)||u.callAsync(function(){n.call(null,s)})});return r.observe(e,{attributes:!0,attributeFilter:["style"],childList:!1,characterData:!1,subtree:!1}),r},U=function(e,t){var n=new MutationObserver(function(e){var n=[];u.forEach(e,function(e){e.removedNodes.length&&(n=n.concat(l.call(e.removedNodes)))}),n.length&&u.callAsync(function(){t(u(n))})});return n.observe(e,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),n},j=function(e,t){var n={width:0,height:0},i=setInterval(function(){var i=e.getBoundingClientRect();(n.width!==i.width||n.height!==i.height)&&(t(i,n),n={width:i.width,height:i.height})},200);return{disconnect:function(){clearInterval(i)}}};h.prototype.observeStyleChanges=function(e,t){var n=[];return this.forEach(function(i){n.push(F(i,e,t))}),n},h.prototype.observeNodeOrChildNodeRemoval=function(e){var t=[];return this.forEach(function(n){t.push(U(n,e))}),t},h.prototype.observeSize=function(e){var t=[];return this.forEach(function(n){t.push(j(n,e))}),t},t.observeStyleChanges=function(e,t,n){return u(e).observeStyleChanges(t,n)[0]},t.observeNodeOrChildNodeRemoval=function(e,t){return u(e).observeNodeOrChildNodeRemoval(t)[0]},t.registerCapability("classList",function(){return"undefined"!=typeof document&&"classList"in document.createElement("a")}),h.prototype.addClass=function(e){if(e){var t=u.trim(e).split(/\s+/);this.forEach(function(e){s(e,t)})}return this},h.prototype.removeClass=function(e){if(e){var t=u.trim(e).split(/\s+/);this.forEach(function(e){a(e,t)})}return this},h.prototype.toggleClass=function(e){if(e){var t=u.trim(e).split(/\s+/);this.forEach(function(e){r(e,t)})}return this},h.prototype.hasClass=function(e){return this.some(function(t){return o(t,e)})},t.addClass=function(e,t){return u(e).addClass(t)},t.removeClass=function(e,t){return u(e).removeClass(t)};var H={"for":"htmlFor","class":"className"};h.prototype.attr=function(e,n){if(t.isObject(e)){var i;for(var o in e)i=H[o]||o,this.first.setAttribute(i,e[o])}else{if(void 0===n)return this.first.getAttribute(H[e]||e);this.first.setAttribute(H[e]||e,n)}return this},h.prototype.removeAttr=function(e){var t=H[e]||e;return this.forEach(function(e){e.removeAttribute(t)}),this},h.prototype.html=function(e){return void 0!==e&&(this.first.innerHTML=e),this.first.innerHTML},h.prototype.center=function(e,t){var n;return this.forEach(function(i){n=u(i),e||(e=parseInt(n.width(),10)),t||(t=parseInt(n.height(),10));var o=-.5*e+"px",r=-.5*t+"px";n.css("margin",r+" 0 0 "+o).addClass("OT_centered")}),this},t.centerElement=function(e,t,n){return u(e).center(t,n)},function(){var e=function(e){return e.offsetWidth>0?e.offsetWidth+"px":u(e).css("width")},n=function(e){return e.offsetHeight>0?e.offsetHeight+"px":u(e).css("height")};h.prototype.width=function(t){return t?(this.css("width",t),this):this.isDisplayNone()?this.makeVisibleAndYield(function(t){return e(t)})[0]:e(this.get(0))},h.prototype.height=function(e){return e?(this.css("height",e),this):this.isDisplayNone()?this.makeVisibleAndYield(function(e){return n(e)})[0]:n(this.get(0))},t.width=function(e,n){var i=u(e).width(n);return n?t:i},t.height=function(e,n){var i=u(e).height(n);return n?t:i}}(),function(){var e={},i={},o=function(e){if(i[e.ownerDocument]&&i[e.ownerDocument][e.nodeName])return i[e.ownerDocument][e.nodeName];i[e.ownerDocument]||(i[e.ownerDocument]={});var t,n=e.ownerDocument.createElement(e.nodeName);return e.ownerDocument.body.appendChild(n),t=i[e.ownerDocument][e.nodeName]=u(n).css("display"),u(n).remove(),n=null,t},r=function(e){var t=u.getComputedStyle(e);return"none"===t.getPropertyValue("display")},s=function(e,t){var n=e.style;for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},a=function(e,t,n){e.style[t]=n},l=function(e,t){var n=t.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase(),i=u.getComputedStyle(e),o=i.getPropertyValue(n);return""===o&&(o=e.style[n]),o},c=function(e,t,n){var i,o,r={};for(i in t)t.hasOwnProperty(i)&&(r[i]=e.style[i],u(e).css(i,t[i]));o=n(e);for(i in t)t.hasOwnProperty(i)&&u(e).css(i,r[i]||"");return o};h.prototype.show=function(){return this.forEach(function(t){var n=t.style.display;(""===n||"none"===n)&&(t.style.display=e[t]||"",delete e[t]),r(t)&&(e[t]="none",t.style.display=o(t))})},h.prototype.hide=function(){return this.forEach(function(t){"none"!==t.style.display&&(e[t]=t.style.display,t.style.display="none")})},h.prototype.css=function(e,t){return 0!==this.length?"string"!=typeof e?this.forEach(function(t){s(t,e)}):t!==n?this.forEach(function(n){a(n,e,t)}):l(this.first,e,t):void 0},h.prototype.applyCSS=function(e,t){var n=[];return this.forEach(function(i){n.push(c(i,e,t))}),n},h.prototype.makeVisibleAndYield=function(e){var t={display:"block",visibility:"hidden"},n=[];return this.forEach(function(i){var o=u.findElementWithDisplayNone(i);n.push(o?c(o,t,e):void 0)}),n},t.show=function(e){return u(e).show()},t.hide=function(e){return u(e).hide()},t.css=function(e,t,n){return u(e).css(t,n)},t.applyCSS=function(e,t,n){return u(e).applyCSS(t,n)},t.makeVisibleAndYield=function(e,t){return u(e).makeVisibleAndYield(t)}}(),function(){t.setImmediate=function(){return"undefined"!=typeof process&&process.nextTick?"undefined"!=typeof setImmediate?setImmediate:process.nextTick:"function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){setTimeout(e,0)}}(),t.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return n<e.length-1?t(n+1):null},i};return t(0)},t.waterfall=function(e,n){if(n=n||function(){},e.constructor!==Array)return n(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return n();var i=function(e){return function(o){if(o)n.apply(null,arguments),n=function(){};else{var r=l.call(arguments,1),s=e.next();r.push(s?i(s):n),t.setImmediate(function(){e.apply(null,r)})}}};i(t.iterator(e))()}}(),function(){var n=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame;if(n)n=t.bind(n,e);else{var i=0,o=t.now();n=function(n){var r=t.now(),s=Math.max(0,16-(r-i)),a=e.setTimeout(function(){n(r-o)},s);return i=r+s,a}}t.requestAnimationFrame=n}(),function(){var e=[],i=!1;t.Analytics=function(o,r){var s=o+"/logging/ClientEvent",a=o+"/logging/ClientQos",l={},c=function(e,n,i){t.post((n?a:s)+"?_="+t.uuid.v4(),{body:e,xdomainrequest:"IE"===u.env.name&&u.env.version<10,headers:{"Content-Type":"application/json"}},i)},d=function(){if(!i&&e.length>0){i=!0;var t=e[0],n=function(){e.shift(),i=!1,d()};t&&c(t.data,t.isQos,function(e){if(e){var i="Failed to send ClientEvent, moving on to the next item.";r?r(i):console.log(i)}else t.onComplete();setTimeout(n,50)})}},h=function(t,n,i){e.push({data:t,onComplete:n,isQos:i}),d()},p=function(e,t,i){if(!i)return!1;var o=[i,t,e].join("_"),r=100;return null===r||r===n?!1:(l[o]||0)<=r};this.logError=function(e,n,i,o,r){r||(r={});var s=r.partnerId;if(!p(e,n,s)){var a=[s,n,e].join("_"),c=o?o:null;l[a]="undefined"!=typeof l[a]?l[a]+1:1,this.logEvent(t.extend(r,{action:n+"."+e,payload:c}),!1)}},this.logEvent=function(e,t,n){if(t||(t=!1),!(n&&!isNaN(n)&&Math.random()>n)){for(var i in e)e.hasOwnProperty(i)&&null===e[i]&&delete e[i];e=JSON.stringify(e);var o=function(){};h(e,o,t)}},this.logQOS=function(e){this.logEvent(e,!0)}}}(),t.get=function(e,n,i){var o=t.extend(n||{},{method:"GET"});t.request(e,o,i)},t.post=function(e,n,i){var o=t.extend(n||{},{method:"POST"});o.xdomainrequest?t.xdomainRequest(e,o,i):t.request(e,o,i)}}(e,e.OTHelpers),function(t){if(void 0===t.OTPlugin){var n=OTHelpers,i="Safari"===n.env.name||"IE"===n.env.name&&n.env.version>=8&&-1===n.env.userAgent.indexOf("x64"),o=!1,r={isSupported:function(){return i},isReady:function(){return o},meta:{mimeType:"application/x-opentokie,version=0.4.0.10",activeXName:"TokBox.OpenTokIE.0.4.0.10",version:"0.4.0.10"},useLoggingFrom:function(e){r.log=n.bind(e.log,e),r.debug=n.bind(e.debug,e),r.info=n.bind(e.info,e),r.warn=n.bind(e.warn,e),r.error=n.bind(e.error,e)}};if(n.useLogHelpers(r),t.OTPlugin=r,n.registerCapability("otplugin",function(){return r.isInstalled()}),!r.isSupported())return void(r.isInstalled=function(){return!1});var s=function(){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n,i,o=t?t:0;if(!this)throw new TypeError;if(i=this.length,0===i||o>=i)return-1;for(0>o&&(o=i-Math.abs(o)),n=o;i>n;n++)if(this[n]===e)return n;return-1}),Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=new Array(n),o=arguments.length>=2?arguments[1]:void 0,r=0;n>r;r++)r in t&&(i[r]=e.call(o,t[r],r,t));return i})},a=function(e,t){var i,o,s,a=function(){},l=new a,c=!1;try{i=e._.RumorInit(t,"")}catch(u){r.error("Error creating the Rumor Socket: ",u.message)}if(!i)throw new Error("Could not initialise OTPlugin rumor connection");return l.open=function(){c=!0,e._.RumorOpen(i)},l.close=function(t,n){c&&(c=!1,e._.RumorClose(i,t,n)),e.removeRef(l)},l.destroy=function(){this.close()},l.send=function(t){e._.RumorSend(i,t.type,t.toAddress,JSON.parse(JSON.stringify(t.headers)),t.data)},l.onOpen=function(e){o=e},l.onClose=function(e){s=e},l.onError=function(t){e._.SetOnRumorError(i,h(t))},l.onMessage=function(t){e._.SetOnRumorMessage(i,h(t))},e.addRef(l),e._.SetOnRumorOpen(i,h(function(){o&&n.isFunction(o)&&o.call(null)})),e._.SetOnRumorClose(i,h(function(t){s(t),e.removeRef(l)})),l},l=function(e){var t=[];e.addRef=function(n){return t.push(n),e},e.removeRef=function(n){if(0!==t.length){var i=t.indexOf(n);return-1!==i&&t.splice(i,1),0===t.length&&e.destroy(),e}},e.removeAllRefs=function(){for(;t.length;)t.shift().destroy()}},c=function(e){var t={},i=function(){var t=Array.prototype.slice.call(arguments);e.emit(t.shift(),t)};e.on=function(n,i,o){return t.hasOwnProperty(n)||(t[n]=[]),t[n].push([i,o]),e},e.off=function(i,o,r){return t.hasOwnProperty(i)&&0!==t[i].length?(n.filter(t[i],function(e){return e[0]===o&&e[1]===r}),e):void 0},e.once=function(t,n,i){var o=function(){return e.off(t,o),n.apply(i,arguments)};return e.on(t,o),e},e.emit=function(i,o){return n.callAsync(function(){(t.hasOwnProperty(i)||!t[i].length)&&n.forEach(t[i],function(e){e[0].apply(e[1],o)})}),e};var o=function(t){e._.on&&e._.on(-1,{customEvent:h(i)}),e._.initialise?(e.on("ready",h(t)),e._.initialise()):t.call(e)};return function(t){o(function(n){return n?(r.error("Error while starting up plugin "+e.uuid+": "+n),void t(n)):(r.debug("Plugin "+e.id+" is loaded"),void t(void 0,e))})}},u=5e3,d={},h=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),n.callAsync.apply(n,t)}},p=function(e){if(e&&(d[e]&&(clearTimeout(d[e]),d[e]=null),t[e]))try{delete t[e]}catch(n){t[e]=void 0}},f=function(e,n){d[e]=setTimeout(function(){p(e),n("The object timed out while loading.")},u),t[e]=function(){p(e);var t=Array.prototype.slice.call(arguments);t.unshift(null),n.apply(null,t)}},g=function(){return"OTPlugin_loaded_"+n.uuid().replace(/\-+/g,"")},m=function(e,t){t=t||{};var i=[],o=['type="'+t.mimeType+'"','id="'+e+'_obj"','tb_callback_id="'+e+'"','width="0" height="0"'],r={userAgent:n.env.userAgent.toLowerCase(),windowless:t.windowless,onload:e};t.isVisible!==!0&&o.push('visibility="hidden"'),i.push("<object "+o.join(" ")+">");for(var s in r)r.hasOwnProperty(s)&&i.push('<param name="'+s+'" value="'+r[s]+'" />');return i.push("</object>"),i.join("")},v=function(e,n,i){n=n||{};var o=m(e,n),r=n.doc||t.document;r.body.insertAdjacentHTML("beforeend",o);var s=r.body.querySelector("#"+e+"_obj");i(void 0,s)},b=function(e,t){var i=function(){},o=new i,r=c(o);l(o);var s=function(e){e?(o._=e,o.parentElement=e.parentElement,o.$=n(e)):(o._=null,o.parentElement=null,o.$=n())};return o.uuid=g(),o.isValid=function(){return o._.valid},o.destroy=function(){o.removeAllRefs(),s(null),o.emit("destroy")},s(null),f(o.uuid,function(n){
return n?(t("The plugin with the mimeType of "+e.mimeType+" timed out while loading: "+n),void o.destroy()):(o._.setAttribute("id","tb_plugin_"+o._.uuid),o._.removeAttribute("tb_callback_id"),o.uuid=o._.uuid,o.id=o._.id,void r(function(e){return e?(t("Error while starting up plugin "+o.uuid+": "+e),void o.destroy()):void t(void 0,o)}))}),v(o.uuid,e,function(e,t){s(t)}),o},y=function(e){return e.selectSources=function(){return e._.selectSources.apply(e._,arguments)},e},w=function(e){return e.setStream=function(t,i){if(e._.setStream(t),i)if(t.hasVideo()){var o=function(){return e._?void(e._.videoWidth>0?setTimeout(i,200):setTimeout(o,500)):void i(new n.Error("The plugin went away before the stream could be bound."))};setTimeout(o,500)}else setTimeout(i,200);return e},e},C=function(e,t){var i=function(){},o=new i;return o.domElement=e._,o.$=n(e._),o.parentElement=e._.parentNode,e.addRef(o),o.appendTo=function(t){t&&e._.parentNode!==t&&(r.debug("VideoContainer appendTo",t),t.appendChild(e._),o.parentElement=t)},o.show=function(i){return r.debug("VideoContainer show"),e._.removeAttribute("width"),e._.removeAttribute("height"),e.setStream(t,i),n.show(e._),o},o.setSize=function(t,n){return e._.setAttribute("width",t),e._.setAttribute("height",n),o},o.width=function(t){return void 0!==t&&(r.debug("VideoContainer set width to "+t),e._.setAttribute("width",t)),e._.getAttribute("width")},o.height=function(t){return void 0!==t&&(r.debug("VideoContainer set height to "+t),e._.setAttribute("height",t)),e._.getAttribute("height")},o.volume=function(e){return r.debug(void 0!==e?"VideoContainer setVolume not implemented: called with "+e:"VideoContainer getVolume not implemented"),.5},o.getImgData=function(){return e._.getImgData("image/png")},o.videoWidth=function(){return e._.videoWidth},o.videoHeight=function(){return e._.videoHeight},o.destroy=function(){e._.setStream(null),e.removeRef(o)},o},_=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};_.prototype.forEach=function(e,t){for(var n in this)this.hasOwnProperty(n)&&e.call(t,this[n])};var x=function(){var e=function(){},t=new e,i={},o=function(e){t.mediaCapturer&&t.mediaCapturer.id===e.id?t.mediaCapturer=null:i.hasOwnProperty(e.id)&&delete i[e.id],e.$&&e.$.remove()};return t.mediaCapturer=null,t.removeAll=function(){for(var e in i)i.hasOwnProperty(e)&&i[e].destroy();t.mediaCapturer&&t.mediaCapturer.destroy()},t.create=function(e,t){var n=b(e,t);return i[n.uuid]=n,n.on("destroy",function(){o(n)}),n},t.createMediaPeer=function(e,o){n.isFunction(e)&&(o=e,e={});var s=t.create(n.extend(e||{},{mimeType:r.meta.mimeType,isVisible:!0,windowless:!0}),function(e){return e?void o.call(r,e):(i[s.id]=s,void o.call(r,void 0,s))});w(s)},t.createMediaCapturer=function(e){return t.mediaCapturer?(e.call(r,void 0,t.mediaCapturer),t):(t.mediaCapturer=t.create({mimeType:r.meta.mimeType,isVisible:!1,windowless:!1},function(n){e.call(r,n,t.mediaCapturer)}),void y(t.mediaCapturer))},t}(),S=function(e,t,i,o){var s,a=function(){},l=new a,c=n.uuid(),u=!1,d=!1,p=[],f=!1,g=[];i.addRef(l),s={addstream:[],removestream:[],icecandidate:[],signalingstatechange:[],iceconnectionstatechange:[]};var m=function(){},v=function(e){r.error("Failed to process candidate"),r.error(e)},b=function(){for(var e=0;e<p.length;++e)i._.addIceCandidate(c,p[e],m,v)},y=function(e){return function(){return f===!0?e.apply(l,arguments):void g.push([e,arguments])}},w=function(){for(var e;e=g.shift();)e[0].apply(l,e[1])},C=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return s.hasOwnProperty(t)?void n.forEach(s[t],function(t){t.apply(null,e)}):void r.error("PeerConnection does not have an event called: "+t)},x=function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]=h(e[t]));i._.on(c,e)},S=function(e){setTimeout(function(){var t=T.fromJson(e,i),o={stream:t,target:l};l.onaddstream&&n.isFunction(l.onaddstream)&&n.callAsync(l.onaddstream,o),C("addstream",o)},3e3)},k=function(e){var t=T.fromJson(e,i),o={stream:t,target:l};l.onremovestream&&n.isFunction(l.onremovestream)&&n.callAsync(l.onremovestream,o),C("removestream",o)},$=function(e,t,i){var o=new r.RTCIceCandidate({candidate:e,sdpMid:t,sdpMLineIndex:i}),s={candidate:o,target:l};l.onicecandidate&&n.isFunction(l.onicecandidate)&&n.callAsync(l.onicecandidate,s),C("icecandidate",s)},E=function(e){l.signalingState=e;var t={state:e,target:l};l.onsignalingstatechange&&n.isFunction(l.onsignalingstatechange)&&n.callAsync(l.onsignalingstatechange,t),C("signalingstate",t)},D=function(e){l.iceConnectionState=e;var t={state:e,target:l};l.oniceconnectionstatechange&&n.isFunction(l.oniceconnectionstatechange)&&n.callAsync(l.oniceconnectionstatechange,t),C("iceconnectionstatechange",t)};return l.createOffer=y(function(e,t,n){r.debug("createOffer",n),i._.createOffer(c,function(t,n){e(new r.RTCSessionDescription({type:t,sdp:n}))},t,n||{})}),l.createAnswer=y(function(e,t,n){r.debug("createAnswer",n),i._.createAnswer(c,function(t,n){e(new r.RTCSessionDescription({type:t,sdp:n}))},t,n||{})}),l.setLocalDescription=y(function(e,t,n){r.debug("setLocalDescription"),i._.setLocalDescription(c,e,function(){u=!0,d&&b(),t&&t.call(null)},n)}),l.setRemoteDescription=y(function(e,t,n){r.debug("setRemoteDescription"),i._.setRemoteDescription(c,e,function(){d=!0,u&&b(),t&&t.call(null)},n)}),l.addIceCandidate=y(function(e){r.debug("addIceCandidate"),u&&d?i._.addIceCandidate(c,e,m,v):p.push(e)}),l.addStream=y(function(e){var t={};i._.addStream(c,e,t)}),l.removeStream=y(function(e){i._.removeStream(c,e)}),l.getRemoteStreams=function(){return n.map(i._.getRemoteStreams(c),function(e){return T.fromJson(e,i)})},l.getLocalStreams=function(){return n.map(i._.getLocalStreams(c),function(e){return T.fromJson(e,i)})},l.getStreamById=function(e){return T.fromJson(i._.getStreamById(c,e),i)},l.getStats=y(function(e,t,n){i._.getStats(c,e||null,h(function(e){var n=new _(JSON.parse(e));t(n)}),n)}),l.close=function(){i._.destroyPeerConnection(c),i.removeRef(this)},l.destroy=function(){l.close()},l.addEventListener=function(e,t){return void 0===s[e]?(r.error('Could not bind invalid event "'+e+'" to PeerConnection. The valid event types are:'),void r.error("	"+n.keys(s).join(", "))):void s[e].push(t)},l.removeEventListener=function(e,t){return void 0===s[e]?(r.error('Could not unbind invalid event "'+e+'" to PeerConnection. The valid event types are:'),void r.error("	"+n.keys(s).join(", "))):void(s[e]=n.filter(s[e],t))},l.onaddstream=null,l.onremovestream=null,l.onicecandidate=null,l.onsignalingstatechange=null,l.oniceconnectionstatechange=null,n.forEach(e.iceServers,function(e){e.username||(e.username=""),e.credential||(e.credential="")}),i._.initPeerConnection(c,e,t)?(x({addStream:S,removeStream:k,iceCandidate:$,signalingStateChange:E,iceConnectionChange:D}),f=!0,w(),o(void 0,l),l):void o(new n.error("Failed to initialise PeerConnection"))};S.create=function(e,t,n,i){new S(e,t,n,i)};var k=function(e,t,i){var o=function(){},r=new o;return r.id=t.id,r.kind=t.kind,r.label=t.label,r.enabled=n.castToBoolean(t.enabled),r.streamId=e,r.setEnabled=function(t){r.enabled=n.castToBoolean(t),r.enabled?i._.enableMediaStreamTrack(e,r.id):i._.disableMediaStreamTrack(e,r.id)},r},T=function(e,t){var i=function(){},o=new i,r=[],s=[];o.id=e.id,t.addRef(o),e.videoTracks&&e.videoTracks.map(function(n){s.push(new k(e.id,n,t))}),e.audioTracks&&e.audioTracks.map(function(n){r.push(new k(e.id,n,t))});var a=function(e){var t="video"===e?s:r;return n.some(t,function(e){return e.enabled})};return o.getVideoTracks=function(){return s},o.getAudioTracks=function(){return r},o.getTrackById=function(e){return s.concat(r).forEach(function(t){return t.id===e?t:void 0}),null},o.hasVideo=function(){return a("video")},o.hasAudio=function(){return a("audio")},o.addTrack=function(){},o.removeTrack=function(){},o.stop=function(){t._.stopMediaStream(o.id),t.removeRef(o)},o.destroy=function(){o.stop()},o._={plugin:t,render:function(){return new C(t,o)}},o};T.fromJson=function(e,t){return e?new T(JSON.parse(e),t):null};var $,E=function(e){var t=n.clone(e);this.hasVideo=void 0!==t.video&&t.video!==!1,this.hasAudio=void 0!==t.audio&&t.audio!==!1,t.video===!0&&(t.video={}),t.audio===!0&&(t.audio={}),this.hasVideo&&!t.video.mandatory&&(t.video.mandatory={}),this.hasAudio&&!t.audio.mandatory&&(t.audio.mandatory={}),this.screenSharing=this.hasVideo&&("screen"===t.video.mandatory.chromeMediaSource||"window"===t.video.mandatory.chromeMediaSource),this.audio=t.audio,this.video=t.video,this.setVideoSource=function(e){void 0!==e?t.video.mandatory.sourceId=e:delete t.video},this.setAudioSource=function(e){void 0!==e?t.audio.mandatory.sourceId=e:delete t.audio},this.toHash=function(){return t}};!function(){var t,i,o=-1,s=function(e,t){if(e===t)return!1;if(-1===e)return t;if(-1===t)return e;if(-1===e.indexOf(".")&&-1===t.indexOf("."))return e>t;for(var n=e.split("."),i=t.split("."),o=(n.length>i.length?i:n).length,r=0;o>r;++r)if(parseInt(n[r],10)>parseInt(i[r],10))return!0;return r<n.length?!0:!1},a=function(){if(void 0!==i)return i;var e="TokBox.otiePluginInstaller",t="otiePluginInstaller",r="application/x-otieplugininstaller",a=navigator.plugins[e]||navigator.plugins[t];if(o=-1,a)for(var l,c,u=a.length,d=new RegExp(r.replace("-","\\-")+",version=([0-9a-zA-Z-_.]+)","i"),h=0;u>h;++h)l=a[h],l&&l.enabledPlugin&&l.enabledPlugin.name===a.name&&-1!==l.type.indexOf(r)&&(c=d.exec(l.type),null!==c&&s(c[1],o)&&(o=c[1]));else if("IE"===n.env.name)try{a=new ActiveXObject(e),o=a.getMasterVersion()}catch(p){}i=-1!==o?r+",version="+o:null},l=function(){return void 0===i&&a(),i},c=function(){return void 0===o&&a(),o},u=function(){var e="0.4.0.9"===c()||!s(c(),"0.4.0.4");return u=function(){return e},e};$=function(){var t,i=function(e){return function(){return t?e(void 0,arguments):void x.create({mimeType:l(),isVisible:!1,windowless:!1},function(n,i){return t=i,n?void r.error("Error while loading the AutoUpdater: "+n):e.apply(void 0,arguments)})}};this.isOutOfDate=function(){return s(r.meta.version,c())},this.autoUpdate=i(function(){var i=OT.Dialogs.Plugin.updateInProgress(),o=new OT.Analytics,s={ieVersion:n.env.version,pluginOldVersion:r.installedVersion(),pluginNewVersion:r.version()},a=h(function(){o.logEvent({action:"OTPluginAutoUpdate",variation:"Success",partnerId:OT.APIKEY,payload:JSON.stringify(s)}),t.destroy(),i.close(),OT.Dialogs.Plugin.updateComplete().on({reload:function(){e.location.reload()}})}),l=h(function(e,n,a){s.errorCode=e,s.systemErrorCode=a,o.logEvent({action:"OTPluginAutoUpdate",variation:"Failure",partnerId:OT.APIKEY,payload:JSON.stringify(s)}),t.destroy(),i.close();var l=n+" ("+e+"). Please restart your browser and try again.";i=OT.Dialogs.Plugin.updateComplete(l).on({reload:function(){i.close()}}),r.error("autoUpdate failed: "+n+" ("+e+"). Please restart your browser and try again.")}),c=h(function(e){i.setUpdateProgress(e.toFixed())});t._.updatePlugin(r.pathToInstaller(),a,l,c)}),this.destroy=function(){t&&t.destroy()},navigator.plugins&&navigator.plugins.refresh(!1)},$.get=function(e){if(!t){if(!this.isinstalled())return void e.call(null,"Plugin was not installed");t=new $}e.call(null,void 0,t)},$.isinstalled=function(){return null!==l()&&!u()},$.installedVersion=function(){return c()}}();var D=[],I=function(){x.removeAll()},M=function(e){D.push(e)},A=function(e){for(var t;(t=D.pop())&&n.isFunction(t);)t.call(r,e)},O=function(){$.get(function(e,t){return e?(r.error("Error while loading the AutoUpdater: "+e),void A("Error while loading the AutoUpdater: "+e)):t.isOutOfDate()?void t.autoUpdate():void x.createMediaCapturer(function(e){e||!x.mediaCapturer||x.mediaCapturer.isValid()||(e="The TB Plugin failed to load properly"),o=!0,A(e),n.onDOMUnload(I)})})};r.isInstalled=function(){return this.isSupported()?$.isinstalled():!1},r.version=function(){return r.meta.version},r.installedVersion=function(){return $.installedVersion()},r.pathToInstaller=function(){return"https://s3.amazonaws.com/otplugin.tokbox.com/v"+r.meta.version+"/otiePluginMain.msi"},r.ready=function(e){if(r.isReady()){var t;x.mediaCapturer&&x.mediaCapturer.isValid()||(t="The TB Plugin failed to load properly"),e.call(r,t)}else M(e)};var R=function(e,t,n){x.createMediaPeer(function(i,o){return i?void n.call(r,i):void o._.getUserMedia(e.toHash(),function(e){t.call(r,T.fromJson(e,o))},n)})};r.getUserMedia=function(e,t,n){var i=new E(e);if(i.screenSharing)R(i,t,n);else{var o=[];i.hasVideo&&o.push("video"),i.hasAudio&&o.push("audio"),x.mediaCapturer.selectSources(o,function(e){for(var o in e)e.hasOwnProperty(o)&&r.debug(o+" Capture Device: "+e[o]);i.setVideoSource(e.video),i.setAudioSource(e.audio),R(i,t,n)},n)}},r.initRumorSocket=function(e,t){r.ready(function(n){n?t(n):t(null,new a(x.mediaCapturer,e))})},r.initPeerConnection=function(e,t,n,i){var o=function(n,o){return n?void i.call(r,n):(r.debug("Got PeerConnection for "+o.id),void S.create(e,t,o,function(e,t){return e?void i.call(r,e):void i.call(r,null,t)}))};n&&n._.plugin?o(null,n._.plugin):x.createMediaPeer(o)},r.RTCSessionDescription=function(e){this.type=e.type,this.sdp=e.sdp},r.RTCIceCandidate=function(e){this.sdpMid=e.sdpMid,this.sdpMLineIndex=parseInt(e.sdpMLineIndex,10),this.candidate=e.candidate},s(),n.onDOMLoad(O)}}(this),!function(e,t){function n(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;++i)n[i]=e[i];return t}function i(e){function n(e){var n=new XMLHttpRequest,i=new t.$.RSVP.Promise(function(t,i){function o(e){return 8e3*e/(Date.now()-r)}var r=Date.now(),s=0;n.addEventListener("load",function(e){t(o(e.loaded))}),n.addEventListener("abort",function(){t(o(s))}),n.addEventListener("error",function(e){i(e)}),n.addEventListener("progress",function(e){s=e.loaded}),n.open("GET",e+"?_"+Math.random()),n.send()});return{promise:i,abort:function(){n.abort()}}}function i(e,n){var i=new XMLHttpRequest,o=new t.$.RSVP.Promise(function(t,o){var r,s,a;i.upload.addEventListener("progress",function(e){r||(r=Date.now()),a=e.loaded}),i.addEventListener("load",function(){s=Date.now(),t(8e3*a/(s-r))}),i.addEventListener("error",function(e){o(e)}),i.addEventListener("abort",function(){o()}),i.open("POST",e),i.send(n)});return{promise:o,abort:function(){i.abort()}}}function o(e,t){var i=n(e);return setTimeout(function(){i.abort()},t),i.promise}function r(e,n,o){return new t.$.RSVP.Promise(function(t){function r(t){s=i(e,new ArrayBuffer(t/8)),s.promise.then(function(e){a=e,r(2*t)})}var s,a=0;setTimeout(function(){s.abort(),t(a)},o),r(n)})}var s=e.httpConfig;return t.$.RSVP.Promise.all([o(s.downloadUrl,1e3*s.duration),r(s.uploadUrl,s.uploadSize,1e3*s.duration)]).then(function(e){return{downloadBandwidth:e[0],uploadBandwidth:e[1]}})}function o(e){return e.hasOwnProperty("googFrameWidthReceived")||e.hasOwnProperty("googFrameWidthInput")||"video"===e.mediaType}function r(e){return e.hasOwnProperty("audioInputLevel")||e.hasOwnProperty("audioOutputLevel")||"audio"===e.mediaType}function s(e){return e.hasOwnProperty("bytesReceived")}function a(e){var t={packetsLost:0,packetsReceived:0,bytesReceived:0};return e.hasOwnProperty("packetsReceived")&&(t.packetsReceived=parseInt(e.packetsReceived,10)),e.hasOwnProperty("packetsLost")&&(t.packetsLost=parseInt(e.packetsLost,10)),e.hasOwnProperty("bytesReceived")&&(t.bytesReceived+=parseInt(e.bytesReceived,10)),t}function l(e){return t.$.isObject(e)&&"getTime"in e?e.getTime():e}function c(){function e(e,t){e.getStats(function(e){var n=[];e.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),t(null,n)})}function n(e,t){e.getStats(null,function(e){var n=[];e.forEach(function(e){n.push(e)}),t(null,n)},t)}return"Firefox"===t.$.browserVersion().name||OTPlugin.isInstalled()?n:e}function u(n){function i(e){return-1!==e.candidate.indexOf("relay")}function o(){var e=new t.VideoElement({attributes:{muted:!0}});return e.domElement().style.position="absolute",e.domElement().style.top="-9999%",e.appendTo(document.body),e}function r(){return new t.$.RSVP.Promise(function(e,n){t.$.createPeerConnection({iceServers:y.iceServers},{},null,function(i,o){i?n(new t.$.Error("createPeerConnection failed",1600,i)):e(o)})})}function s(e){return new t.$.RSVP.Promise(function(t,n){e.createOffer(t,n)})}function a(e,n){return new t.$.RSVP.Promise(function(i,o){e.bindToStream(n,function(e){e?o(new t.$.Error("bindToStream failed",1600,e)):i()})})}function l(e,n){return new t.$.RSVP.Promise(function(t,i){e.addIceCandidate(new v({sdpMLineIndex:n.sdpMLineIndex,candidate:n.candidate}),t,i)})}function c(e,n){return new t.$.RSVP.Promise(function(i,o){e.setLocalDescription(n,i,function(e){o(new t.$.Error("setLocalDescription failed",1600,e))})})}function u(e,n){return new t.$.RSVP.Promise(function(i,o){e.setRemoteDescription(n,i,function(e){o(new t.$.Error("setRemoteDescription failed",1600,e))})})}function d(e){return new t.$.RSVP.Promise(function(n,i){e.createAnswer(n,function(e){i(new t.$.Error("createAnswer failed",1600,e))})})}function h(e){return new t.$.RSVP.Promise(function(n,i){b(e,function(e,o){e?i(new t.$.Error("geStats failed",1600,e)):n(o)})})}function p(e){return function(n){n.candidate&&i(n.candidate)&&l(e,n.candidate)["catch"](function(){t.warn("An error occurred while adding a ICE candidate during webrtc test")})}}function f(e){return 8*(e.videoBytesReceived+e.audioBytesReceived)/(t.$.now()-e.startTs)*1e3}function g(e,n){var i=1e3;return new t.$.RSVP.Promise(function(o){function r(){t.$.RSVP.Promise.all([h(e).then(function(e){t.$.forEach(e,function(e){if(t.getStatsHelpers.isVideoStat(e)){var n=null;e.hasOwnProperty("googRtt")?n=parseInt(e.googRtt,10):e.hasOwnProperty("mozRtt")&&(n=e.mozRtt),null!==n&&n>-1&&(l.roundTripTimeSamplesCount++,l.roundTripTime+=n)}})}),h(n).then(function(e){t.$.forEach(e,function(e){if(t.getStatsHelpers.isVideoStat(e)){if(e.hasOwnProperty("packetsReceived")&&e.hasOwnProperty("packetsLost")){var n=parseInt(e.packetsLost,10),i=parseInt(e.packetsReceived,10);n>=0&&i>0&&(l.packetLostRatioSamplesCount++,l.packetLostRatio+=100*n/i)}e.hasOwnProperty("bytesReceived")&&(l.videoBytesReceived=parseInt(e.bytesReceived,10))}else t.getStatsHelpers.isAudioStat(e)&&e.hasOwnProperty("bytesReceived")&&(l.audioBytesReceived=parseInt(e.bytesReceived,10))})})]).then(function(){setTimeout(function(){a&&r()},i)})}function s(e){a=!1;var t={packetLostRatio:l.packetLostRatioSamplesCount>0?l.packetLostRatio/=100*l.packetLostRatioSamplesCount:null,roundTripTime:l.roundTripTimeSamplesCount>0?l.roundTripTime/=l.roundTripTimeSamplesCount:null,bandwidth:f(l),extended:e};o(t)}var a=!0,l={startTs:t.$.now(),packetLostRatioSamplesCount:0,packetLostRatio:0,roundTripTimeSamplesCount:0,roundTripTime:0,videoBytesReceived:0,audioBytesReceived:0};r(),setTimeout(function(){f(l)<y.thresholdBitsPerSecond?setTimeout(function(){s(!0)},1e3*y.extendedDuration):s(!1)},1e3*y.duration)})}var m,v,b=t.getStatsAdpater(),y=n.mediaConfig,w=n.localStream;return OTPlugin.isInstalled()?(m=OTPlugin.RTCSessionDescription,v=OTPlugin.RTCIceCandidate):(m=e.mozRTCSessionDescription||e.RTCSessionDescription,v=e.mozRTCIceCandidate||e.RTCIceCandidate),t.$.RSVP.Promise.all([r(),r()]).then(function(e){function n(){l.destroy(),h.destroy(),i.close(),r.close()}var i=e[0],r=e[1],l=o(),h=o();a(l,w),i.addStream(w);var f;return r.onaddstream=function(e){f=e.stream,a(h,f)},i.onicecandidate=p(r),r.onicecandidate=p(i),s(i).then(function(e){return t.$.RSVP.Promise.all([c(i,e),u(r,e)])}).then(function(){return d(r)}).then(function(e){return t.$.RSVP.Promise.all([c(r,e),u(i,e)])}).then(function(){return g(i,r)}).then(function(e){return n(),e},function(e){throw n(),e})})}function d(e,t){this.code=e,this.message=t,this.reason=t}"file:"===location.protocol&&alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.");var t=e.OT||{};t.APIKEY=function(){var e=function(){var e=document.getElementsByTagName("script");return e=e[e.length-1],e=e.getAttribute("src")||e.src}(),t=e.match(/[\?\&]apikey=([^&]+)/i);return t?t[1]:""}(),e.OT||(e.OT=t),e.TB||(e.TB=t),t.properties={version:"v2.5.1",build:"23265fa",debug:"false",websiteURL:"http://www.tokbox.com",cdnURL:"http://static.opentok.com",loggingURL:"http://hlg.tokbox.com/prod",apiURL:"http://anvil.opentok.com",messagingProtocol:"wss",messagingPort:443,supportSSL:"true",cdnURLSSL:"https://static.opentok.com",loggingURLSSL:"https://hlg.tokbox.com/prod",apiURLSSL:"https://anvil.opentok.com",minimumVersion:{firefox:parseFloat("29"),chrome:parseFloat("34")}},t.$=e.OTHelpers,t.$.eventing(t),t.$.defineGetters=function(e,t,n){var i={};void 0===n&&(n=!1);for(var o in t)t.hasOwnProperty(o)&&(i[o]={get:t[o],enumerable:n});Object.defineProperties(e,i)},t.Modal=t.$.Modal,t.$.useLogHelpers(t);var h=!1,p=t.setLogLevel;t.setLogLevel=function(e){t.$.setLogLevel(e);var n=p.call(t,e);return t.shouldLog(t.DEBUG)&&!h&&(t.debug("OpenTok JavaScript library "+t.properties.version),t.debug("Release notes: "+t.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html"),t.debug("Known issues: "+t.properties.websiteURL+"/opentok/webrtc/docs/js/release-notes.html#knownIssues"),h=!0),t.debug("OT.setLogLevel("+n+")"),n};var f="true"===t.properties.debug||t.properties.debug===!0;t.setLogLevel(f?t.DEBUG:t.ERROR),OTPlugin&&OTPlugin.isInstalled()&&(t.$.env.userAgent+="; OTPlugin "+OTPlugin.version()),t.$.userAgent=function(){return t.$.env.userAgent},t.Rumor={MessageType:{SUBSCRIBE:0,UNSUBSCRIBE:1,MESSAGE:2,CONNECT:3,DISCONNECT:4,PING:7,PONG:8,STATUS:9}},!function(){t.Rumor.PluginSocket=function(e,n){var i,o="initializing";OTPlugin.initRumorSocket(e,t.$.bind(function(e,r){e?(o="closed",n.onClose({code:4999})):"initializing"===o?(i=r,i.onOpen(function(){o="open",n.onOpen()}),i.onClose(function(e){o="closed",n.onClose({code:e})}),i.onError(function(e){o="closed",n.onError(e),n.onClose({code:e})}),i.onMessage(function(e,i,o,r){var s=new t.Rumor.Message(e,i,o,r);n.onMessage(s)}),i.open()):this.close()},this)),this.close=function(){return"initializing"===o||"closed"===o?void(o="closed"):void i.close(1e3,"")},this.send=function(e){"open"===o&&i.send(e)},this.isClosed=function(){return"closed"===o}}}(this),function(e){"use strict";function n(e,t,n){return e>=t&&n>=e}function i(e,t){return Math.floor(e/t)}function o(e){var t=0;this.get=function(){return t>=e.length?v:Number(e[t])},this.offset=function(n){if(t+=n,0>t)throw new Error("Seeking past start of the buffer");if(t>e.length)throw new Error("Seeking past EOF")},this.match=function(n){if(n.length>t+e.length)return!1;var i;for(i=0;i<n.length;i+=1)if(Number(e[t+i])!==n[i])return!1;return!0}}function r(e){var t=0;this.emit=function(n){var i,o=v;for(i=0;i<arguments.length;++i)o=Number(arguments[i]),e[t++]=o;return o}}function s(e){function t(e){for(var t=[],i=0,o=e.length;i<e.length;){var r=e.charCodeAt(i);if(n(r,55296,57343))if(n(r,56320,57343))t.push(65533);else if(i===o-1)t.push(65533);else{var s=e.charCodeAt(i+1);if(n(s,56320,57343)){var a=1023&r,l=1023&s;i+=1,t.push(65536+(a<<10)+l)}else t.push(65533)}else t.push(r);i+=1}return t}var i=0,o=t(e);this.offset=function(e){if(i+=e,0>i)throw new Error("Seeking past start of the buffer");if(i>o.length)throw new Error("Seeking past EOF")},this.get=function(){return i>=o.length?b:o[i]}}function a(){var e="";this.string=function(){return e},this.emit=function(t){65535>=t?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode(55296+(t>>10&1023)),e+=String.fromCharCode(56320+(1023&t)))}}function l(e){this.name="EncodingError",this.message=e,this.code=0}function c(e,t){if(e)throw new l("Decoder error");return t||65533}function u(e){throw new l("The code point "+e+" could not be encoded.")}function d(e){return e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(C,e)?C[e]:null}function h(e){var t=e.fatal,i=0,o=0,r=0,s=0;this.decode=function(e){var a=e.get();if(a===v)return 0!==o?c(t):b;if(e.offset(1),0===o){if(n(a,0,127))return a;if(n(a,194,223))o=1,s=128,i=a-192;else if(n(a,224,239))o=2,s=2048,i=a-224;else{if(!n(a,240,244))return c(t);o=3,s=65536,i=a-240}return i*=Math.pow(64,o),null}if(!n(a,128,191))return i=0,o=0,r=0,s=0,e.offset(-1),c(t);if(r+=1,i+=(a-128)*Math.pow(64,o-r),r!==o)return null;var l=i,u=s;return i=0,o=0,r=0,s=0,n(l,u,1114111)&&!n(l,55296,57343)?l:c(t)}}function p(e){e.fatal,this.encode=function(e,t){var o=t.get();if(o===b)return v;if(t.offset(1),n(o,55296,57343))return u(o);if(n(o,0,127))return e.emit(o);var r,s;n(o,128,2047)?(r=1,s=192):n(o,2048,65535)?(r=2,s=224):n(o,65536,1114111)&&(r=3,s=240);for(var a=e.emit(i(o,Math.pow(64,r))+s);r>0;){var l=i(o,Math.pow(64,r-1));a=e.emit(128+l%64),r-=1}return a}}function f(e,t){return t.match([255,254])&&"utf-16"===e?void t.offset(2):t.match([254,255])&&"utf-16be"==e?void t.offset(2):t.match([239,187,191])&&"utf-8"==e?void t.offset(3):void 0}function g(t,n){if(!this||this===e)return new g(t,n);if(t=t?String(t):_,n=Object(n),this._encoding=d(t),null===this._encoding||"utf-8"!==this._encoding.name&&"utf-16"!==this._encoding.name&&"utf-16be"!==this._encoding.name)throw new TypeError("Unknown encoding: "+t);return this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(n.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this}function m(t,n){if(!this||this===e)return new m(t,n);if(t=t?String(t):_,n=Object(n),this._encoding=d(t),null===this._encoding)throw new TypeError("Unknown encoding: "+t);return this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(n.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this}if(!(t.$.env&&"IE"===t.$.env.name&&t.$.env.version<10||void 0!==e.TextEncoder&&void 0!==e.TextDecoder)){var v=-1,b=-1;l.prototype=Error.prototype;var y=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}],w={},C={};y.forEach(function(e){e.encodings.forEach(function(e){w[e.name]=e,e.labels.forEach(function(t){C[t]=e})})}),e["encoding-indexes"]||{},w["utf-8"].getEncoder=function(e){return new p(e)},w["utf-8"].getDecoder=function(e){return new h(e)};var _="utf-8";g.prototype={encode:function(e,t){e=e?String(e):"",t=Object(t),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(t.stream);for(var n=[],i=new r(n),o=new s(e);o.get()!==b;)this._encoder.encode(i,o);if(!this._streaming){var a;do a=this._encoder.encode(i,o);while(a!==v);this._encoder=null}return new Uint8Array(n)}},m.prototype={decode:function(e,t){if(e&&!("buffer"in e&&"byteOffset"in e&&"byteLength"in e))throw new TypeError("Expected ArrayBufferView");e||(e=new Uint8Array(0)),t=Object(t),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(t.stream);var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=new o(n);this._BOMseen||(this._BOMseen=!0,f(this._encoding.name,i));for(var r,s=new a;i.get()!==v;)r=this._decoder.decode(i),null!==r&&r!==b&&s.emit(r);if(!this._streaming){do r=this._decoder.decode(i),null!==r&&r!==b&&s.emit(r);while(r!==b&&i.get()!=v);this._decoder=null}return s.string()}},e.TextEncoder=e.TextEncoder||g,e.TextDecoder=e.TextDecoder||m}}(this),t.Rumor.Message=function(e,t,n,i){this.type=e,this.toAddress=t,this.headers=n,this.data=i,this.transactionId=this.headers["TRANSACTION-ID"],this.status=this.headers.STATUS,this.isError=!(this.status&&"2"===this.status[0])},t.Rumor.Message.prototype.serialize=function(){var e,t,n,i,o=8,r=7,s=[],a=[],l=[];for(r++,n=0;n<this.toAddress.length;n++)s.push(new TextEncoder("utf-8").encode(this.toAddress[n])),r+=2,r+=s[n].length;r++,n=0;for(var c in this.headers)this.headers.hasOwnProperty(c)&&(a.push(new TextEncoder("utf-8").encode(c)),l.push(new TextEncoder("utf-8").encode(this.headers[c])),r+=4,r+=a[n].length,r+=l[n].length,n++);t=new TextEncoder("utf-8").encode(this.data),r+=t.length;var u=new ArrayBuffer(r),d=new Uint8Array(u,0,r);for(r-=4,d[0]=(4278190080&r)>>>24,d[1]=(16711680&r)>>>16,d[2]=(65280&r)>>>8,d[3]=(255&r)>>>0,d[4]=0,d[5]=0,d[6]=this.type,d[7]=this.toAddress.length,n=0;n<s.length;n++)for(e=s[n],d[o++]=e.length>>8&255,d[o++]=e.length>>0&255,i=0;i<e.length;i++)d[o++]=e[i];for(d[o++]=a.length,n=0;n<a.length;n++){for(e=a[n],d[o++]=e.length>>8&255,d[o++]=e.length>>0&255,i=0;i<e.length;i++)d[o++]=e[i];for(e=l[n],d[o++]=e.length>>8&255,d[o++]=e.length>>0&255,i=0;i<e.length;i++)d[o++]=e[i]}for(n=0;n<t.length;n++)d[o++]=t[n];return u},t.Rumor.Message.deserialize=function(e){"undefined"!=typeof Buffer&&Buffer.isBuffer(e)&&(e=n(e));var i,o,r,s,a,l,c,u,d=0,h=8,p=new Uint8Array(e);d+=p[0]<<24,
d+=p[1]<<16,d+=p[2]<<8,d+=p[3]<<0,i=p[6];var f=[];for(u=0;u<p[7];u++)c=p[h++]<<8,c+=p[h++],o=new Uint8Array(e,h,c),f[u]=new TextDecoder("utf-8").decode(o),h+=c;for(r=p[h++],s={},u=0;r>u;u++)c=p[h++]<<8,c+=p[h++],o=new Uint8Array(e,h,c),a=new TextDecoder("utf-8").decode(o),h+=c,c=p[h++]<<8,c+=p[h++],o=new Uint8Array(e,h,c),l=new TextDecoder("utf-8").decode(o),s[a]=l,h+=c;var g=new Uint8Array(e,h),m=new TextDecoder("utf-8").decode(g);return new t.Rumor.Message(i,f,s,m)},t.Rumor.Message.Connect=function(e,n){var i={uniqueId:e,notifyDisconnectAddress:n};return new t.Rumor.Message(t.Rumor.MessageType.CONNECT,[],i,"")},t.Rumor.Message.Disconnect=function(){return new t.Rumor.Message(t.Rumor.MessageType.DISCONNECT,[],{},"")},t.Rumor.Message.Subscribe=function(e){return new t.Rumor.Message(t.Rumor.MessageType.SUBSCRIBE,e,{},"")},t.Rumor.Message.Unsubscribe=function(e){return new t.Rumor.Message(t.Rumor.MessageType.UNSUBSCRIBE,e,{},"")},t.Rumor.Message.Publish=function(e,n,i){return new t.Rumor.Message(t.Rumor.MessageType.MESSAGE,e,i||{},n||"")},t.Rumor.Message.Ping=function(){return new t.Rumor.Message(t.Rumor.MessageType.PING,[],{},"")},!function(){var e=100,n=10;t.Rumor.NativeSocket=function(i,o,r){var s,a,l,c;s=new i(o),s.binaryType="arraybuffer",s.onopen=r.onOpen,s.onclose=r.onClose,s.onerror=r.onError,s.onmessage=function(e){if(t){var n=t.Rumor.Message.deserialize(e.data);r.onMessage(n)}},a=function u(t){s&&(void 0===t&&(t=0),l&&clearTimeout(l),s.bufferedAmount>0&&n>=t+1?l=setTimeout(u,e,t+1):c())},c=function(){s.close()},this.close=function(e){e?a():c()},this.send=function(e){s.send(e.serialize())},this.isClosed=function(){return 3===s.readyState}}}(this);var g,m=9e3,v=5*m-100;g={1002:"The endpoint is terminating the connection due to a protocol error. (CLOSE_PROTOCOL_ERROR)",1003:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data). (CLOSE_UNSUPPORTED)",1004:"The endpoint is terminating the connection because a data frame was received that is too large. (CLOSE_TOO_LARGE)",1005:"Indicates that no status code was provided even though one was expected. (CLOSE_NO_STATUS)",1006:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected. (CLOSE_ABNORMAL)",1007:"Indicates that an endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 [RFC3629] data within a text message)",1008:"Indicates that an endpoint is terminating the connection because it has received a message that violates its policy.  This is a generic status code that can be returned when there is no other more suitable status code (e.g., 1003 or 1009) or if there is a need to hide specific details about the policy",1009:"Indicates that an endpoint is terminating the connection because it has received a message that is too big for it to process",1011:"Indicates that a server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request",4001:"Connectivity loss was detected as it was too long since the socket received the last PONG message"},t.Rumor.SocketError=function(e,t){this.code=e,this.message=t},t.Rumor.Socket=function(n,i,o){var r,s,a,l,c,u,d,h,p,f,b=["disconnected","error","connected","connecting","disconnecting"],y=function(e){switch(e){case"disconnected":case"error":if(r=null,c){var t;x()&&(t=new Error(g[4001]),t.code=4001),c(t)}}},w=t.$.statable(this,b,"disconnected",y),C=function(e,n){if(null===n||!t.$.isFunction(n))throw new Error("The Rumor.Socket "+e+" callback must be a valid function or null")},_=t.$.bind(function(e){t.error("Rumor.Socket: "+e);var n=new t.Rumor.SocketError(null,e||"Unknown Socket Error");h&&clearTimeout(h),w("error"),"connecting"===this.previousState&&d&&(d(n,void 0),d=null),l&&l(n)},this),x=function(){return p?t.$.now()-p>=v:!1},S=t.$.bind(function(){this.is("connected")&&(x()?D({code:4001}):(r.send(t.Rumor.Message.Ping()),f=setTimeout(S,m)))},this),k=function(){return!e.OT},T=t.$.bind(function(){return h&&clearTimeout(h),this.isNot("connecting")?void t.debug("webSocketConnected reached in state other than connecting"):(r.send(t.Rumor.Message.Connect(s,i)),w("connected"),d&&(d(void 0,s),d=null),a&&a(s),void(f=setTimeout(function(){p=t.$.now(),S()},m)))},this),$=function(){var e=r;_("Timed out while waiting for the Rumor socket to connect.");try{e.close()}catch(t){}},E=function(){},D=t.$.bind(function(e){if(h&&clearTimeout(h),f&&clearTimeout(f),!k()){if(1e3!==e.code&&1001!==e.code){var t=e.reason||e.message;!t&&g.hasOwnProperty(e.code)&&(t=g[e.code]),_("Rumor Socket Disconnected: "+t)}this.isNot("error")&&w("disconnected")}},this),I=function(e){p=t.$.now(),u&&e.type!==t.Rumor.MessageType.PONG&&u(e)};this.publish=function(e,n,i){r.send(t.Rumor.Message.Publish(e,n,i))},this.subscribe=function(e){r.send(t.Rumor.Message.Subscribe(e))},this.unsubscribe=function(e){r.send(t.Rumor.Message.Unsubscribe(e))},this.connect=function(i,a){if(this.is("connecting","connected"))return void a(new t.Rumor.SocketError(null,"Rumor.Socket cannot connect when it is already connecting or connected."));s=i,d=a,w("connecting");var l=o||e.WebSocket,c={onOpen:T,onClose:D,onError:E,onMessage:I};try{r="undefined"!=typeof l?new t.Rumor.NativeSocket(l,n,c):new t.Rumor.PluginSocket(n,c),h=setTimeout($,t.Rumor.Socket.CONNECT_TIMEOUT)}catch(u){t.error(u),_("Could not connect to the Rumor socket, possibly because of a blocked port.")}},this.disconnect=function(e){return h&&clearTimeout(h),f&&clearTimeout(f),r?void(r.isClosed()?this.isNot("error")&&w("disconnected"):(this.is("connected")&&r.send(t.Rumor.Message.Disconnect()),r.close(e))):void(this.isNot("error")&&w("disconnected"))},t.$.defineProperties(this,{id:{get:function(){return s}},onOpen:{set:function(e){C("onOpen",e),a=e},get:function(){return a}},onError:{set:function(e){C("onError",e),l=e},get:function(){return l}},onClose:{set:function(e){C("onClose",e),c=e},get:function(){return c}},onMessage:{set:function(e){C("onMessage",e),u=e},get:function(){return u}}})},t.Rumor.Socket.CONNECT_TIMEOUT=15e3,t.Raptor={Actions:{CONNECT:100,CREATE:101,UPDATE:102,DELETE:103,STATE:104,FORCE_DISCONNECT:105,FORCE_UNPUBLISH:106,SIGNAL:107,CREATE_ARCHIVE:108,CLOSE_ARCHIVE:109,START_RECORDING_SESSION:110,STOP_RECORDING_SESSION:111,START_RECORDING_STREAM:112,STOP_RECORDING_STREAM:113,LOAD_ARCHIVE:114,START_PLAYBACK:115,STOP_PLAYBACK:116,APPSTATE_PUT:117,APPSTATE_DELETE:118,OFFER:119,ANSWER:120,PRANSWER:121,CANDIDATE:122,SUBSCRIBE:123,UNSUBSCRIBE:124,QUERY:125,SDP_ANSWER:126,PONG:127,REGISTER:128,QUALITY_CHANGED:129},Types:{RPC_REQUEST:100,RPC_RESPONSE:101,STREAM:102,ARCHIVE:103,CONNECTION:104,APPSTATE:105,CONNECTIONCOUNT:106,MODERATION:107,SIGNAL:108,SUBSCRIBER:110,JSEP:109}},t.Raptor.serializeMessage=function(e){return JSON.stringify(e)},t.Raptor.deserializeMessage=function(e){if(0===e.length)return{};var t=JSON.parse(e),n=t.uri.substr(1).split("/");n.shift(),""===n[n.length-1]&&n.pop(),t.params={};for(var i=0,o=n.length;o-1>i;i+=2)t.params[n[i]]=n[i+1];return t.resource=n.length%2===0?"channel"===n[n.length-2]&&n.length>6?n[n.length-4]+"_"+n[n.length-2]:n[n.length-2]:"channel"===n[n.length-1]&&n.length>5?n[n.length-3]+"_"+n[n.length-1]:n[n.length-1],t.signature=t.resource+"#"+t.method,t},t.Raptor.unboxFromRumorMessage=function(e){var n=t.Raptor.deserializeMessage(e.data);return n.transactionId=e.transactionId,n.fromAddress=e.headers["X-TB-FROM-ADDRESS"],n},t.Raptor.parseIceServers=function(e){try{return JSON.parse(e.data).content.iceServers}catch(t){return[]}},t.Raptor.Message={},t.Raptor.Message.offer=function(e,n){return t.Raptor.serializeMessage({method:"offer",uri:e,content:{sdp:n}})},t.Raptor.Message.connections={},t.Raptor.Message.connections.create=function(e,n,i){return t.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+e+"/session/"+n+"/connection/"+i,content:{userAgent:t.$.env.userAgent}})},t.Raptor.Message.connections.destroy=function(e,n,i){return t.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+e+"/session/"+n+"/connection/"+i,content:{}})},t.Raptor.Message.sessions={},t.Raptor.Message.sessions.get=function(e,n){return t.Raptor.serializeMessage({method:"read",uri:"/v2/partner/"+e+"/session/"+n,content:{}})},t.Raptor.Message.streams={},t.Raptor.Message.streams.get=function(e,n,i){return t.Raptor.serializeMessage({method:"read",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i,content:{}})},t.Raptor.Message.streams.channelFromOTChannel=function(e){var t={id:e.id,type:e.type,active:e.active};return"video"===e.type&&(t.width=e.width,t.height=e.height,t.orientation=e.orientation,t.frameRate=e.frameRate,"default"!==e.source&&(t.source=e.source),t.fitMode=e.fitMode),t},t.Raptor.Message.streams.create=function(e,n,i,o,r,s,a,l){var c={id:i,name:o,audioFallbackEnabled:r,channel:t.$.map(s,function(e){return t.Raptor.Message.streams.channelFromOTChannel(e)})};return a&&(c.minBitrate=a),l&&(c.maxBitrate=l),t.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i,content:c})},t.Raptor.Message.streams.destroy=function(e,n,i){return t.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i,content:{}})},t.Raptor.Message.streams.answer=function(e,n,i,o){return t.Raptor.serializeMessage({method:"answer",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i,content:{sdp:o}})},t.Raptor.Message.streams.candidate=function(e,n,i,o){return t.Raptor.serializeMessage({method:"candidate",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i,content:o})},t.Raptor.Message.streamChannels={},t.Raptor.Message.streamChannels.update=function(e,n,i,o,r){return t.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/channel/"+o,content:r})},t.Raptor.Message.subscribers={},t.Raptor.Message.subscribers.create=function(e,n,i,o,r,s){var a={id:o,connection:r,keyManagementMethod:t.$.supportedCryptoScheme(),bundleSupport:t.$.hasCapabilities("bundle"),rtcpMuxSupport:t.$.hasCapabilities("RTCPMux")};return s&&(a.channel=s),t.Raptor.serializeMessage({method:"create",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o,content:a})},t.Raptor.Message.subscribers.destroy=function(e,n,i,o){return t.Raptor.serializeMessage({method:"delete",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o,content:{}})},t.Raptor.Message.subscribers.update=function(e,n,i,o,r){return t.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o,content:r})},t.Raptor.Message.subscribers.candidate=function(e,n,i,o,r){return t.Raptor.serializeMessage({method:"candidate",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o,content:r})},t.Raptor.Message.subscribers.answer=function(e,n,i,o,r){return t.Raptor.serializeMessage({method:"answer",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o,content:{sdp:r}})},t.Raptor.Message.subscriberChannels={},t.Raptor.Message.subscriberChannels.update=function(e,n,i,o,r,s){return t.Raptor.serializeMessage({method:"update",uri:"/v2/partner/"+e+"/session/"+n+"/stream/"+i+"/subscriber/"+o+"/channel/"+r,content:s})},t.Raptor.Message.signals={},t.Raptor.Message.signals.create=function(e,n,i,o,r){var s={};return void 0!==o&&(s.type=o),void 0!==r&&(s.data=r),t.Raptor.serializeMessage({method:"signal",uri:"/v2/partner/"+e+"/session/"+n+(void 0!==i?"/connection/"+i:"")+"/signal/"+t.$.uuid(),content:s})},!function(){var e;e={409:"This P2P session already has 2 participants.",410:"The session already has four participants.",1004:"The token passed is invalid."},t.Raptor.Dispatcher=function(){t.$.eventing(this,!0),this.callbacks={}},t.Raptor.Dispatcher.prototype.registerCallback=function(e,t){this.callbacks[e]=t},t.Raptor.Dispatcher.prototype.triggerCallback=function(e){if(e){var n=this.callbacks[e];if(n&&t.$.isFunction(n)){var i=Array.prototype.slice.call(arguments);i.shift(),n.apply(null,i)}delete this.callbacks[e]}},t.Raptor.Dispatcher.prototype.onClose=function(e){this.emit("close",e)},t.Raptor.Dispatcher.prototype.dispatch=function(e){if(e.type===t.Rumor.MessageType.STATUS){t.debug("OT.Raptor.dispatch: STATUS"),t.debug(e);var n;return e.isError&&(n=new t.Error(e.status)),void this.triggerCallback(e.transactionId,n,e)}var i=t.Raptor.unboxFromRumorMessage(e);switch(t.debug("OT.Raptor.dispatch "+i.signature),t.debug(e.data),i.resource){case"session":this.dispatchSession(i);break;case"connection":this.dispatchConnection(i);break;case"stream":this.dispatchStream(i);break;case"stream_channel":this.dispatchStreamChannel(i);break;case"subscriber":this.dispatchSubscriber(i);break;case"subscriber_channel":this.dispatchSubscriberChannel(i);break;case"signal":this.dispatchSignal(i);break;case"archive":this.dispatchArchive(i);break;default:t.warn("OT.Raptor.dispatch: Type "+i.resource+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchSession=function(e){switch(e.method){case"read":this.emit("session#read",e.content,e.transactionId);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchConnection=function(e){switch(e.method){case"created":this.emit("connection#created",e.content);break;case"deleted":this.emit("connection#deleted",e.params.connection,e.reason);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchStream=function(e){switch(e.method){case"created":this.emit("stream#created",e.content,e.transactionId);break;case"deleted":this.emit("stream#deleted",e.params.stream,e.reason);break;case"updated":this.emit("stream#updated",e.params.stream,e.content);break;case"generateoffer":case"answer":case"pranswer":case"offer":case"candidate":this.dispatchJsep(e.method,e);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchStreamChannel=function(e){switch(e.method){case"updated":this.emit("streamChannel#updated",e.params.stream,e.params.channel,e.content);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchJsep=function(e,t){this.emit("jsep#"+e,t.params.stream,t.fromAddress,t)},t.Raptor.Dispatcher.prototype.dispatchSubscriberChannel=function(e){switch(e.method){case"updated":this.emit("subscriberChannel#updated",e.params.stream,e.params.channel,e.content);break;case"update":this.emit("subscriberChannel#update",e.params.subscriber,e.params.stream,e.content);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchSubscriber=function(e){switch(e.method){case"created":this.emit("subscriber#created",e.params.stream,e.fromAddress,e.content.id);break;case"deleted":this.dispatchJsep("unsubscribe",e),this.emit("subscriber#deleted",e.params.stream,e.fromAddress);break;case"generateoffer":case"answer":case"pranswer":case"offer":case"candidate":this.dispatchJsep(e.method,e);break;default:t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented")}},t.Raptor.Dispatcher.prototype.dispatchSignal=function(e){return"signal"!==e.method?void t.warn("OT.Raptor.dispatch: "+e.signature+" is not currently implemented"):void this.emit("signal",e.fromAddress,e.content.type,e.content.data)},t.Raptor.Dispatcher.prototype.dispatchArchive=function(e){switch(e.method){case"created":this.emit("archive#created",e.content);break;case"updated":this.emit("archive#updated",e.params.archive,e.content)}}}(this),function(e){function n(e,n){var i=e.channel.map(function(e){return new t.StreamChannel(e)}),o=e.connectionId?e.connectionId:e.connection.id;return new t.Stream(e.id,e.name,e.creationTime,n.connections.get(o),n,i)}function i(e,t){if(!t.streams.has(e.id)){var i=n(e,t);return t.streams.add(i),i}}function o(e){return new t.Archive(e.id,e.name,e.status)}function r(e,t){if(!t.archives.has(e.id)){var n=o(e);return t.archives.add(n),n}}t.publishers=new t.$.Collection("guid"),t.subscribers=new t.$.Collection("widgetId"),t.sessions=new t.$.Collection;var s=function(e){var t=[];this.enqueue=function(){t.push(Array.prototype.slice.call(arguments))},this.triggerAll=function(){for(var n;n=t.shift();)e.trigger.apply(e,n)}},a=function(e){var n={};this.enqueue=function(){var t=arguments[0],i=Array.prototype.slice.call(arguments,1);n[t]||(n[t]=new s(e)),n[t].enqueue.apply(n[t],i)},this.triggerConnectionCreated=function(e){n["connectionCreated"+e.id]&&n["connectionCreated"+e.id].triggerAll()},this.triggerSessionConnected=function(e){n.sessionConnected&&n.sessionConnected.triggerAll(),t.$.forEach(e,function(e){this.triggerConnectionCreated(e)})}},l={};e.OT.SessionDispatcher=function(e){var n=new t.Raptor.Dispatcher,o=!1,s=new a(n);n.on("close",function(n){var i=e.connection;return i?i.destroyedReason()?void t.debug("OT.Raptor.Socket: Socket was closed but the connection had already been destroyed. Reason: "+i.destroyedReason()):void i.destroy(n):void 0});var c=function(n,o){return n=t.Connection.fromHash(n),(o||e.connection&&n.id!==e.connection.id)&&(e.connections.add(n),s.triggerConnectionCreated(n)),t.$.forEach(t.$.keys(l),function(t){var r=l[t];if(r&&n.id===r.connection.id){i(r,e),delete l[r.id];var s={debug:o?"connection came in session#read":"connection came in connection#created",streamId:r.id,connectionId:n.id};e.logEvent("streamCreated","warning",s)}}),n};n.on("session#read",function(a,l){var u,d={};d.streams=[],d.connections=[],d.archives=[],t.$.forEach(a.connection,function(e){u=c(e,!0),d.connections.push(u)}),t.$.forEach(a.stream,function(t){d.streams.push(i(t,e))}),t.$.forEach(a.archive||a.archives,function(t){d.archives.push(r(t,e))}),e._.subscriberMap={},n.triggerCallback(l,null,d),o=!0,s.triggerSessionConnected(e.connections)}),n.on("connection#created",function(e){c(e)}),n.on("connection#deleted",function(t,n){t=e.connections.get(t),t.destroy(n)}),n.on("stream#created",function(t,o){var r=t.connectionId?t.connectionId:t.connection.id;if(e.connections.has(r))t=i(t,e);else{l[t.id]=t;var s={debug:"eventOrderError -- streamCreated event before connectionCreated",streamId:t.id};e.logEvent("streamCreated","warning",s)}t.publisher&&t.publisher.setStream(t),n.triggerCallback(o,null,t)}),n.on("stream#deleted",function(n,i){var o=e.streams.get(n);return o?void o.destroy(i):void t.error("OT.Raptor.dispatch: A stream does not exist with the id of "+n+", for stream#deleted message!")}),n.on("stream#updated",function(n,i){var o=e.streams.get(n);return o?void o._.update(i):void t.error("OT.Raptor.dispatch: A stream does not exist with the id of "+n+", for stream#updated message!")}),n.on("streamChannel#updated",function(n,i,o){var r;return n&&(r=e.streams.get(n))?void r._.updateChannel(i,o):void t.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for streamChannel message!")});var u=function(e,n,i,o){var r,s;switch(e){case"offer":s=[];var a=t.subscribers.find({streamId:n});a&&s.push(a);break;case"answer":case"pranswer":case"generateoffer":case"unsubscribe":s=t.publishers.where({streamId:n});break;case"candidate":s=t.publishers.where({streamId:n}).concat(t.subscribers.where({streamId:n}));break;default:return void t.warn("OT.Raptor.dispatch: jsep#"+e+" is not currently implemented")}if(0!==s.length){if(r=s[0].session.connections.get(i),!r&&i.match(/^symphony\./))r=t.Connection.fromHash({id:i,creationTime:Math.floor(t.$.now())}),s[0].session.connections.add(r);else if(!r)return void t.warn("OT.Raptor.dispatch: Messsage comes from a connection ("+i+") that we do not know about. The message was ignored.");t.$.forEach(s,function(t){t.processMessage(e,r,o)})}};return n.on("jsep#offer",t.$.bind(u,null,"offer")),n.on("jsep#answer",t.$.bind(u,null,"answer")),n.on("jsep#pranswer",t.$.bind(u,null,"pranswer")),n.on("jsep#generateoffer",t.$.bind(u,null,"generateoffer")),n.on("jsep#unsubscribe",t.$.bind(u,null,"unsubscribe")),n.on("jsep#candidate",t.$.bind(u,null,"candidate")),n.on("subscriberChannel#updated",function(n,i,o){return n&&e.streams.has(n)?void e.streams.get(n)._.updateChannel(i,o):void t.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriberChannel#updated message!")}),n.on("subscriberChannel#update",function(n,i,o){return i&&e.streams.has(i)?t.subscribers.has(n)?void t.subscribers.get(n).disableVideo(o.active):void t.error("OT.Raptor.dispatch: Unable to determine subscriberId, or the subscriber does not exist, for subscriberChannel#update message!"):void t.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriberChannel#update message!")}),n.on("subscriber#created",function(n,i,o){var r=n?e.streams.get(n):null;return r?void(e._.subscriberMap[i+"_"+r.id]=o):void t.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriber#created message!")}),n.on("subscriber#deleted",function(n,i){var o=n?e.streams.get(n):null;return o?void delete e._.subscriberMap[i+"_"+o.id]:void t.error("OT.Raptor.dispatch: Unable to determine streamId, or the stream does not exist, for subscriber#created message!")}),n.on("signal",function(t,n,i){var r=e.connections.get(t);e.connection&&t===e.connection.connectionId?o?e._.dispatchSignal(r,n,i):s.enqueue("sessionConnected","signal",t,n,i):e.connections.get(t)?e._.dispatchSignal(r,n,i):s.enqueue("connectionCreated"+t,"signal",t,n,i)}),n.on("archive#created",function(t){r(t,e)}),n.on("archive#updated",function(n,i){var o=e.archives.get(n);return o?void o._.update(i):void t.error("OT.Raptor.dispatch: An archive does not exist with the id of "+n+", for archive#updated message!")}),n}}(e),t.httpTest=i;var b={getMLineIndex:function(e,n){var i="m="+n;return t.$.findIndex(e,function(e){return-1!==e.indexOf(i)?!0:!1})},getMLinePayloadTypes:function(e,n){var i=new RegExp("^m="+n+" \\d+(/\\d+)? [a-zA-Z0-9/]+(( [a-zA-Z0-9/]+)+)$","i"),o=e.match(i);return!o||o.length<2?[]:t.$.trim(o[2]).split(" ")},removeTypesFromMLine:function(e,n){return t.$.trim(e.replace(new RegExp(" "+n.join(" |"),"ig")," ").replace(/\s+/g," "))},removeMediaEncoding:function(e,n,i){var o,r,s=e.split("\r\n"),a=b.getMLineIndex(s,n),l=a>-1?s[a]:void 0,c=[];if(-1===a)return s.join("\r\n");if(o=b.getMLinePayloadTypes(l,n),0===o.length)return s.join("\r\n");var u=new RegExp("a=rtpmap:("+o.join("|")+") "+i+"\\/\\d+","i");return s=t.$.filter(s,function(e,t){return r=e.match(u),null===r?!0:(c.push(r[1]),a>t&&a--,!1)}),c.length>0&&a>-1&&(s[a]=b.removeTypesFromMLine(l,c)),s.join("\r\n")},removeComfortNoise:function(e){return b.removeMediaEncoding(e,"audio","CN")},removeVideoCodec:function(e,t){return b.removeMediaEncoding(e,"video",t)}},y={};y.isVideoStat=o,y.isAudioStat=r,y.isInboundStat=s,y.parseStatCategory=a,y.normalizeTimestamp=l,t.getStatsHelpers=y,t.getStatsAdpater=c,t.webrtcTest=u,t.Chrome=function(e){var n=!1,i={},o=function(t,n){n.parent=this,n.appendTo(e.parent),i[t]=n,this[t]=n};e.parent&&(t.$.eventing(this),this.destroy=function(){this.off(),this.hideWhileLoading();for(var e in i)i[e].destroy()},this.showAfterLoading=function(){n=!0;for(var e in i)i[e].showAfterLoading()},this.hideWhileLoading=function(){n=!1;for(var e in i)i[e].hideWhileLoading()},this.set=function(e,t){if("string"==typeof e&&t)o.call(this,e,t);else for(var n in e)e.hasOwnProperty(n)&&o.call(this,n,e[n]);return this})},t.Chrome.Behaviour||(t.Chrome.Behaviour={}),t.Chrome.Behaviour.Widget=function(e,n){var i,o,r=n||{},s="auto";e.setDisplayMode=function(e){var n=e||"auto";i!==n&&(t.$.removeClass(this.domElement,"OT_mode-"+i),t.$.addClass(this.domElement,"OT_mode-"+n),"off"===n&&(s=i),i=n)},e.getDisplayMode=function(){return i},e.show=function(){return i!==s&&(this.setDisplayMode(s),r.onShow&&r.onShow()),this},e.showAfterLoading=function(){this.setDisplayMode(o)},e.hide=function(){return"off"!==i&&(this.setDisplayMode("off"),r.onHide&&r.onHide()),this},e.hideWhileLoading=function(){o=i,this.setDisplayMode("off")},e.destroy=function(){return r.onDestroy&&r.onDestroy(this.domElement),this.domElement&&t.$.removeElement(this.domElement),e},e.appendTo=function(n){return this.domElement=t.$.createElement(r.nodeName||"div",r.htmlAttributes,r.htmlContent),r.onCreate&&r.onCreate(this.domElement),e.setDisplayMode(r.mode),"auto"===r.mode&&(t.$.addClass(e.domElement,"OT_mode-on-hold"),setTimeout(function(){t.$.removeClass(e.domElement,"OT_mode-on-hold")},2e3)),n.appendChild(this.domElement),e}},t.Chrome.VideoDisabledIndicator=function(e){var n,i=!1,o=!1;n=t.$.bind(function(e){i?t.$.addClass(e,"OT_video-disabled"):t.$.removeClass(e,"OT_video-disabled"),o?t.$.addClass(e,"OT_video-disabled-warning"):t.$.removeClass(e,"OT_video-disabled-warning"),!i&&!o||"auto"!==this.getDisplayMode()&&"on"!==this.getDisplayMode()?t.$.removeClass(e,"OT_active"):t.$.addClass(e,"OT_active")},this),this.disableVideo=function(e){i=e,e===!0&&(o=!1),n(this.domElement)},this.setWarning=function(e){o=e,n(this.domElement)},t.Chrome.Behaviour.Widget(this,{mode:e.mode||"auto",nodeName:"div",htmlAttributes:{className:"OT_video-disabled-indicator"}});var r=t.$.bind(this.setDisplayMode,this);this.setDisplayMode=function(e){r(e),n(this.domElement)}},t.Chrome.NamePanel=function(e){var n=e.name;n&&""!==t.$.trim(n).length||(n=null,e.mode="off"),this.setName=t.$.bind(function(e){n||this.setDisplayMode("auto"),n=e,this.domElement.innerHTML=n}),t.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"h1",htmlContent:n,htmlAttributes:{className:"OT_name OT_edge-bar-item"}})},t.Chrome.MuteButton=function(e){var n,i,o,r,s,a=e.muted||!1;i=t.$.bind(function(){a?t.$.addClass(this.domElement,"OT_active"):t.$.removeClass(this.domElement,"OT_active ")},this),o=function(e){n=t.$.bind(s,this),t.$.on(e,"click",n)},r=function(e){n=null,t.$.off(e,"click",n)},s=function(){return a=!a,i(),a?this.parent.trigger("muted",this):this.parent.trigger("unmuted",this),!1},t.$.defineProperties(this,{muted:{get:function(){return a},set:function(e){a=e,i()}}});var l=a?"OT_edge-bar-item OT_mute OT_active":"OT_edge-bar-item OT_mute";t.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:l},onCreate:t.$.bind(o,this),onDestroy:t.$.bind(r,this)})},t.Chrome.BackingBar=function(e){function n(){return"on"===i||"on"===o?"on":"mini"===i||"mini"===o?"mini":"mini-auto"===i||"mini-auto"===o?"mini-auto":"auto"===i||"auto"===o?"auto":"off"}var i=e.nameMode,o=e.muteMode;t.Chrome.Behaviour.Widget(this,{mode:n(),nodeName:"div",htmlContent:"",htmlAttributes:{className:"OT_bar OT_edge-bar-item"}}),this.setNameMode=function(e){i=e,this.setDisplayMode(n())},this.setMuteMode=function(e){o=e,this.setDisplayMode(n())}},t.Chrome.AudioLevelMeter=function(e){function n(){o=t.$.createElement("div",{className:"OT_audio-level-meter__bar"},""),s=t.$.createElement("div",{className:"OT_audio-level-meter__value"},""),r=t.$.createElement("div",{className:"OT_audio-level-meter__audio-only-img"},""),l.domElement.appendChild(o),l.domElement.appendChild(r),l.domElement.appendChild(s)}function i(){var e=100*a/(c-u);s.style.width=s.style.height=2*e+"%",s.style.top=s.style.right=-e+"%"}var o,r,s,a,l=this,c=e.maxValue||1,u=e.minValue||0,d={mode:e?e.mode:"auto",nodeName:"div",htmlAttributes:{className:"OT_audio-level-meter"},onCreate:n};t.Chrome.Behaviour.Widget(this,d);var h=t.$.bind(l.setDisplayMode,l);l.setDisplayMode=function(t){h(t),"off"===t?e.onPassivate&&e.onPassivate():e.onActivate&&e.onActivate()},l.setValue=function(e){a=e,i()}},t.Chrome.Archiving=function(e){var n,i,o,r,s,a,l,c=e.archiving,u=e.archivingStarted||"Archiving on",d=e.archivingEnded||"Archiving off",h=!0;a=function(e){r.nodeValue=e,n.setAttribute("title",e)},l=t.$.bind(function(){s&&(clearTimeout(s),s=null),c?t.$.addClass(i,"OT_active"):t.$.removeClass(i,"OT_active"),t.$.removeClass(this.domElement,"OT_archiving-"+(c?"off":"on")),t.$.addClass(this.domElement,"OT_archiving-"+(c?"on":"off")),e.show&&c?(a(u),t.$.addClass(o,"OT_mode-on"),t.$.removeClass(o,"OT_mode-auto"),this.setDisplayMode("on"),s=setTimeout(function(){t.$.addClass(o,"OT_mode-auto"),t.$.removeClass(o,"OT_mode-on")},5e3)):e.show&&!h?(t.$.addClass(o,"OT_mode-on"),t.$.removeClass(o,"OT_mode-auto"),this.setDisplayMode("on"),a(d),s=setTimeout(t.$.bind(function(){this.setDisplayMode("off")},this),5e3)):this.setDisplayMode("off")},this),t.Chrome.Behaviour.Widget(this,{mode:c&&e.show&&"on"||"off",nodeName:"h1",htmlAttributes:{className:"OT_archiving OT_edge-bar-item OT_edge-bottom"},onCreate:t.$.bind(function(){n=t.$.createElement("div",{className:"OT_archiving-light-box"},""),i=t.$.createElement("div",{className:"OT_archiving-light"},""),n.appendChild(i),o=t.$.createElement("div",{className:"OT_archiving-status OT_mode-on OT_edge-bar-item OT_edge-bottom"},""),r=document.createTextNode(""),o.appendChild(r),this.domElement.appendChild(n),this.domElement.appendChild(o),l()},this)}),this.setShowArchiveStatus=t.$.bind(function(t){e.show=t,this.domElement&&l.call(this)},this),this.setArchiving=t.$.bind(function(e){c=e,h=!1,this.domElement&&l.call(this)},this)},!function(e){if(e&&"undefined"!=typeof navigator){var n=e.webkitRTCPeerConnection||e.mozRTCPeerConnection;navigator.webkitGetUserMedia?(webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams}),webkitRTCPeerConnection.prototype.getRemoteStreams||(webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):navigator.mozGetUserMedia&&(MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]})),"undefined"!=typeof e.MediaStreamTrack&&(e.MediaStreamTrack.prototype.setEnabled||(e.MediaStreamTrack.prototype.setEnabled=function(e){this.enabled=t.$.castToBoolean(e)})),!e.URL&&e.webkitURL&&(e.URL=e.webkitURL),t.$.createPeerConnection=function(e,t,i,o){if(OTPlugin.isInstalled())OTPlugin.initPeerConnection(e,t,i,o);else{var r;try{r=new n(e,t)}catch(s){return void o(s.message)}o(null,r)}}}t.$.supportedCryptoScheme=function(){return"Chrome"===t.$.env.name&&t.$.env.version<25?"SDES_SRTP":"DTLS_SRTP"}}(e);var w,C=function(e,n,i){var o,r;o=function(e,n){return function(o){t.error(e),t.error(o),i&&i(e,o,n)}},r=function(t){t.sdp=b.removeComfortNoise(t.sdp),t.sdp=b.removeVideoCodec(t.sdp,"ulpfec"),t.sdp=b.removeVideoCodec(t.sdp,"red"),e.setLocalDescription(t,function(){n(t)},o("Error while setting LocalDescription","SetLocalDescription"))},e.createOffer(r,o("Error while creating Offer","CreateOffer"),{})},_=function(e,n,i,o){var r,s,a;if(r=function(e,n){return function(i){t.error(e),t.error(i),o&&o(e,i,n)}},s=function(t){t.sdp=b.removeComfortNoise(t.sdp),t.sdp=b.removeVideoCodec(t.sdp,"ulpfec"),t.sdp=b.removeVideoCodec(t.sdp,"red"),e.setLocalDescription(t,function(){i(t)},r("Error while setting LocalDescription","SetLocalDescription"))},a=function(){e.createAnswer(s,r("Error while setting createAnswer","CreateAnswer"),null,!1)},-1===n.sdp.indexOf("a=rtcp-fb")){var l="a=rtcp-fb:* ccm fir\r\na=rtcp-fb:* nack ";n.sdp=n.sdp.replace(/^m=video(.*)$/gim,"m=video$1\r\n"+l)}e.setRemoteDescription(n,a,r("Error while setting RemoteDescription","SetRemoteDescription"))};w=OTPlugin.isInstalled()?OTPlugin.RTCIceCandidate:e.mozRTCIceCandidate||e.RTCIceCandidate;var x,S=function(){var e=[],t=null;this.setPeerConnection=function(e){t=e},this.process=function(n){var i=new w(n.content);

t?t.addIceCandidate(i):e.push(i)},this.processPending=function(){for(;e.length;)t.addIceCandidate(e.shift())}},k=function(e){this.data=e.data,this.source=e.source,this.lastEventId=e.lastEventId,this.origin=e.origin,this.timeStamp=e.timeStamp,this.type=e.type,this.ports=e.ports,this.path=e.path},T=function(e){var n={},i=[],o=function(e){return i.push(e),n},r=function(t){return e.send(t),n},s=function(){for(var e;e=i.shift();)n.send(e)},a=function(){n.send=r,s()},l=function(e){n.send=o,n.trigger("close",e)},c=function(e){t.error("Data Channel Error:",e)},u=function(e){var t=new k(e);n.trigger("message",t)};return t.$.eventing(n,!0),n.label=e.label,n.id=e.id,n.reliable=e.reliable,n.negotiated=e.negotiated,n.ordered=e.ordered,n.protocol=e.protocol,n._channel=e,n.close=function(){e.close()},n.equals=function(e,t){if(n.label!==e)return!1;for(var i in t)if(t.hasOwnProperty(i)&&n[i]!==t[i])return!1;return!0},n.send=o,e.addEventListener("open",a,!1),e.addEventListener("close",l,!1),e.addEventListener("error",c,!1),e.addEventListener("message",u,!1),n},$=function(e){var n=[],i={},o=function(e){t.$.filter(n,function(t){return e!==t})},r=function(e){var t=new T(e);return n.push(t),t.on("close",function(){o(t)}),t};return i.add=function(t,n){return r(e.createDataChannel(t,n))},i.addMany=function(e){for(var t in e)e.hasOwnProperty(t)&&i.add(t,e[t])},i.get=function(e,i){return t.$.find(n,function(t){return t.equals(e,i)})},i.getOrAdd=function(e,t){var n=i.get(e,t);return n||(n=i.add(e,t)),n},i.destroy=function(){t.$.forEach(n,function(e){e.close()}),n=[]},e.addEventListener("datachannel",function(e){r(e.channel)},!1),i},E=function(e){var n,i,o=t.$.now(),r=[],s=function(){var i=t.$.now(),o=r[r.length-1],s={delta:n?i-n:0};o&&o.iceConnection===e.iceConnectionState||(s.iceConnectionState=e.iceConnectionState),o&&o.signalingState===e.signalingState||(s.signalingState=e.signalingState),o&&o.iceGatheringState===e.iceGatheringState||(s.iceGathering=e.iceGatheringState),t.debug(s),r.push(s),n=i};return e.addEventListener("iceconnectionstatechange",s,!1),e.addEventListener("signalingstatechange",s,!1),e.addEventListener("icegatheringstatechange",s,!1),{stop:function(){e.removeEventListener("iceconnectionstatechange",s,!1),e.removeEventListener("signalingstatechange",s,!1),e.removeEventListener("icegatheringstatechange",s,!1),i=!0;var a={type:"PeerConnectionWorkflow",success:i,startTime:o,finishTime:n,states:r};t.debug(a)}}};x=OTPlugin.isInstalled()?OTPlugin.RTCSessionDescription:e.mozRTCSessionDescription||e.RTCSessionDescription;var D=function(e){return function(n){n.candidate?e(t.Raptor.Actions.CANDIDATE,{candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid||"",sdpMLineIndex:n.candidate.sdpMLineIndex||0}):t.debug("IceCandidateForwarder: No more ICE candidates.")}};t.PeerConnection=function(e){var n,i,o,r,s,a=[],l=new S,c=t.getStatsAdpater(),u="new",d=[],h={};t.$.eventing(h),e.iceServers||(e.iceServers=[]);var p=function(e,t,n){d.length&&d[0](e,t,n)},f=function(i,o){if(n)return void i.call(null,null,n);if(a.push(i),!(a.length>1)){var r={optional:[{DtlsSrtpKeyAgreement:!0},{googIPv6:!1}]};t.debug('Creating peer connection config "'+JSON.stringify(e)+'".'),e.iceServers&&0!==e.iceServers.length||t.error("No ice servers present"),t.$.createPeerConnection(e,r,o,g)}},g=function(r,s){if(r)return R("Failed to create PeerConnection, exception: "+r.toString(),"NewPeerConnection"),void(a=[]);if(t.debug("OT attachEventsToPeerConnection"),n=s,o=E(n),i=new $(n),e.channels&&i.addMany(e.channels),n.addEventListener("icecandidate",D(p),!1),n.addEventListener("addstream",k,!1),n.addEventListener("removestream",T,!1),n.addEventListener("signalingstatechange",b,!1),void 0!==n.oniceconnectionstatechange){var l;n.addEventListener("iceconnectionstatechange",function(e){"failed"===e.target.iceConnectionState&&(l&&clearTimeout(l),l=setTimeout(function(){"failed"===e.target.iceConnectionState&&R("The stream was unable to connect due to a network error. Make sure your connection isn't blocked by a firewall.","ICEWorkflow")},5e3))},!1)}m(null)},m=function(){for(;a.length;)a.shift().call(null)},v=function(){l&&l.setPeerConnection(null),o&&o.stop(),N.stopCollecting(),null!==n&&(n.destroy&&n.destroy(),n=null,h.trigger("close"))},b=function(){var e=n.signalingState;if(e&&e!==u)switch(u=e,t.debug("PeerConnection.stateChange: "+u),u){case"closed":v()}},y=function(e){h.trigger("qos",e)},w=function(){var e;if(n.getRemoteStreams)e=n.getRemoteStreams();else{if(!n.remoteStreams)throw new Error("Invalid Peer Connection object implements no method for retrieving remote streams");e=n.remoteStreams}return Array.prototype.slice.call(e)},k=function(e){h.trigger("streamAdded",e.stream)},T=function(e){h.trigger("streamRemoved",e.stream)},I=function(e,t,n){p(e,t,n)},M=function(e){var i=new x({type:"offer",sdp:e.content.sdp}),o=function(e){l.setPeerConnection(n),l.processPending(),I(t.Raptor.Actions.ANSWER,e),N.startCollecting(n)},r=function(e,t,n){R("PeerConnection.offerProcessor "+e+": "+t,n)};f(function(){_(n,i,o,r)})},A=function(e){return e.content.sdp?(s=new x({type:"answer",sdp:e.content.sdp}),n.setRemoteDescription(s,function(){t.debug("setRemoteDescription Success")},function(e){R("Error while setting RemoteDescription "+e,"SetRemoteDescription")}),l.setPeerConnection(n),l.processPending(),void N.startCollecting(n)):void t.error("PeerConnection.processMessage: Weird answer message, no SDP.")},O=function(e){if(t.debug("PeerConnection.processSubscribe: Sending offer to subscriber."),!n)throw new Error("PeerConnection broke!");f(function(){C(n,function(n){r=n,I(t.Raptor.Actions.OFFER,r,e.uri)},function(e,t,n){R("PeerConnection.subscribeProcessor "+e+": "+t,n)})})},R=function(e,n){t.error(e),h.trigger("error",e,n)};h.addLocalStream=function(e){f(function(){n.addStream(e)},e)},h.getSenders=function(){return n.getSenders()},h.disconnect=function(){l=null,n&&n.signalingState&&"closed"!==n.signalingState.toLowerCase()&&(n.close(),"Firefox"===t.$.env.name&&t.$.callAsync(v)),h.off()},h.processMessage=function(e,n){switch(t.debug("PeerConnection.processMessage: Received "+e+" from "+n.fromAddress),t.debug(n),e){case"generateoffer":O(n);break;case"offer":M(n);break;case"answer":case"pranswer":A(n);break;case"candidate":l.process(n);break;default:t.debug("PeerConnection.processMessage: Received an unexpected message of type "+e+" from "+n.fromAddress+": "+JSON.stringify(n))}return h},h.setIceServers=function(t){t&&(e.iceServers=t)},h.registerMessageDelegate=function(e){return d.push(e)},h.unregisterMessageDelegate=function(e){var n=t.$.arrayIndexOf(d,e);return-1!==n&&d.splice(n,1),d.length},h.remoteStreams=function(){return n?w():[]},h.getStats=function(e){f(function(){c(n,e)})};var P=function L(e,n,o,r){var s,a=i.get(n,o);if(!a){if(e>0)return void setTimeout(t.$.bind(L,null,e-1,n,o,r),200);s=new t.$.Error("A channel with that label and options could not be found. Label:"+n+". Options: "+JSON.stringify(o))}r(s,a)};h.getDataChannel=function(e,t,n){f(function(){P(100,e,t,n)})};var N=new t.PeerConnection.QOS(y);return h},!function(){var e=function(e,t,n,i){var o=function(e){return e.stat("googFrameRateSent")?(n.videoSentBytes=Number(e.stat("bytesSent")),n.videoSentPackets=Number(e.stat("packetsSent")),n.videoSentPacketsLost=Number(e.stat("packetsLost")),n.videoRtt=Number(e.stat("googRtt")),n.videoFrameRate=Number(e.stat("googFrameRateInput")),n.videoWidth=Number(e.stat("googFrameWidthSent")),n.videoHeight=Number(e.stat("googFrameHeightSent")),n.videoCodec=e.stat("googCodecName")):e.stat("googFrameRateReceived")&&(n.videoRecvBytes=Number(e.stat("bytesReceived")),n.videoRecvPackets=Number(e.stat("packetsReceived")),n.videoRecvPacketsLost=Number(e.stat("packetsLost")),n.videoFrameRate=Number(e.stat("googFrameRateOutput")),n.videoWidth=Number(e.stat("googFrameWidthReceived")),n.videoHeight=Number(e.stat("googFrameHeightReceived")),n.videoCodec=e.stat("googCodecName")),null},r=function(e){e.stat("audioInputLevel")?(n.audioSentPackets=Number(e.stat("packetsSent")),n.audioSentPacketsLost=Number(e.stat("packetsLost")),n.audioSentBytes=Number(e.stat("bytesSent")),n.audioCodec=e.stat("googCodecName"),n.audioRtt=Number(e.stat("googRtt"))):e.stat("audioOutputLevel")&&(n.audioRecvPackets=Number(e.stat("packetsReceived")),n.audioRecvPacketsLost=Number(e.stat("packetsLost")),n.audioRecvBytes=Number(e.stat("bytesReceived")),n.audioCodec=e.stat("googCodecName"))},s=function(e){if(e.result)for(var t=e.result(),s=0;s<t.length;s++){var a=t[s];a.stat&&("true"===a.stat("googActiveConnection")&&(n.localCandidateType=a.stat("googLocalCandidateType"),n.remoteCandidateType=a.stat("googRemoteCandidateType"),n.transportType=a.stat("googTransportType")),r(a),o(a))}i(null,n)};e.getStats(s)},n=function(e,t,n,i){var o=function(e){i(e)},r=function(e){var i,o=t.audioBytesTransferred||0;e.audioInputLevel?(n.audioSentBytes=Number(e.bytesSent),n.audioSentPackets=Number(e.packetsSent),n.audioSentPacketsLost=Number(e.packetsLost),n.audioRtt=Number(e.googRtt),n.audioCodec=e.googCodecName):e.audioOutputLevel&&(n.audioBytesTransferred=Number(e.bytesReceived),n.audioCodec=e.googCodecName),n.audioBytesTransferred&&(i=n.audioBytesTransferred-o,n.avgAudioBitrate=Math.round(8*i/(n.period/1e3)))},s=function(e){var i,o=t.videoBytesTransferred||0;e.googFrameHeightSent?(n.videoSentBytes=Number(e.bytesSent),n.videoSentPackets=Number(e.packetsSent),n.videoSentPacketsLost=Number(e.packetsLost),n.videoRtt=Number(e.googRtt),n.videoCodec=e.googCodecName,n.videoWidth=Number(e.googFrameWidthSent),n.videoHeight=Number(e.googFrameHeightSent)):e.googFrameHeightReceived&&(n.videoRecvBytes=Number(e.bytesReceived),n.videoRecvPackets=Number(e.packetsReceived),n.videoRecvPacketsLost=Number(e.packetsLost),n.videoRtt=Number(e.googRtt),n.videoCodec=e.googCodecName,n.videoWidth=Number(e.googFrameWidthReceived),n.videoHeight=Number(e.googFrameHeightReceived)),n.videoBytesTransferred&&(i=n.videoBytesTransferred-o,n.avgVideoBitrate=Math.round(8*i/(n.period/1e3))),e.googFrameRateSent?n.videoFrameRate=Number(e.googFrameRateSent):e.googFrameRateReceived&&(n.videoFrameRate=Number(e.googFrameRateReceived))},a=function(e){return void 0!==e.googFrameHeightSent||void 0!==e.googFrameHeightReceived||void 0!==n.videoBytesTransferred||void 0!==e.googFrameRateSent},l=function(e){return"true"===e.googActiveConnection};e.getStats(null,function(e){e.forEach(function(e){l(e)?(n.localCandidateType=e.googLocalCandidateType,n.remoteCandidateType=e.googRemoteCandidateType,n.transportType=e.googTransportType):a(e)?s(e):r(e)}),i(null,n)},o)},i=function(e,t,n,i){var o=function(e){i(e)},r=function(e){"outboundrtp"===e.type?(n.audioSentPackets=e.packetsSent,n.audioSentPacketsLost=e.packetsLost,n.audioSentBytes=e.bytesSent):"inboundrtp"===e.type&&(n.audioRecvPackets=e.packetsReceived,n.audioRecvPacketsLost=e.packetsLost,n.audioRecvBytes=e.bytesReceived)},s=function(e){"outboundrtp"===e.type?(n.videoSentPackets=e.packetsSent,n.videoSentPacketsLost=e.packetsLost,n.videoSentBytes=e.bytesSent):"inboundrtp"===e.type&&(n.videoRecvPackets=e.packetsReceived,n.videoRecvPacketsLost=e.packetsLost,n.videoRecvBytes=e.bytesReceived)};e.getStats(null,function(e){for(var t in e)if(e.hasOwnProperty(t)&&("outboundrtp"===e[t].type||"inboundrtp"===e[t].type)){var o=e[t];-1!==o.id.indexOf("rtp")&&(-1!==o.id.indexOf("audio")?r(o):-1!==o.id.indexOf("video")&&s(o))}i(null,n)},o)},o=function(r,s,a,l){return OTPlugin.isInstalled()?(o=n,n(r,s,a,l)):"Firefox"===t.$.env.name&&t.$.env.version>=27?(o=i,i(r,s,a,l)):(o=e,e(r,s,a,l))};t.PeerConnection.QOS=function(e){var n,i=t.$.now(),r=t.$.bind(function s(r){if(n){var a=t.$.now(),l={timeStamp:a,duration:Math.round(a-i),period:Math.round(a-r.timeStamp)},c=function(n,i){return n?void t.error("Failed to Parse QOS Stats: "+JSON.stringify(n)):(e(i,r),void setTimeout(t.$.bind(s,null,i),t.PeerConnection.QOS.INTERVAL))};o(n,r,l,c)}},this);this.startCollecting=function(e){e&&e.getStats&&(n=e,r({timeStamp:t.$.now()}))},this.stopCollecting=function(){n=null}},t.PeerConnection.QOS.INTERVAL=3e4}(),t.PeerConnections=function(){var e={};return{add:function(n,i,o){var r=n.id+"_"+i,s=e[r];return s||(s=e[r]={count:0,pc:new t.PeerConnection(o)}),s.count+=1,s.pc},remove:function(t,n){var i=t.id+"_"+n,o=e[i];o&&(o.count-=1,0===o.count&&(o.pc.disconnect(),delete e[i]))}}}(),t.SubscriberPeerConnection=function(e,n,i,o,r){var s,a,l,c,u,d,h,p,f=!1,g=!1;a=function(){this.destroy(),this.trigger("disconnected",this)},l=function(e){this.trigger("remoteStreamAdded",e,this)},c=function(e){this.trigger("remoteStreamRemoved",e,this)},u=function(e,t){this.trigger("error",null,e,this,t)},d=t.$.bind(function(e,r){if(!g){var s=e===t.Raptor.Actions.CANDIDATE||e===t.Raptor.Actions.OFFER||e===t.Raptor.Actions.ANSWER||e===t.Raptor.Actions.PRANSWER;if(s){var a=e===t.Raptor.Actions.CANDIDATE?r.candidate:r.sdp;g=-1!==a.indexOf("typ relay")}}switch(e){case t.Raptor.Actions.ANSWER:case t.Raptor.Actions.PRANSWER:this.trigger("connected"),n._.jsepAnswerP2p(i.id,o.widgetId,r.sdp);break;case t.Raptor.Actions.OFFER:n._.jsepOfferP2p(i.id,o.widgetId,r.sdp);break;case t.Raptor.Actions.CANDIDATE:n._.jsepCandidateP2p(i.id,o.widgetId,r)}},this),h=function(e){var t="get"+(e?"Video":"Audio")+"Tracks";return function(e){var n,i,o=s.remoteStreams();if(0!==o.length&&o[0][t])for(var r=0,a=o.length;a>r;++r){i=o[r],n=i[t]();for(var l=0,c=n.length;c>l;++l)n[l].enabled!==e&&n[l].setEnabled(e)}}},p=t.$.bind(function(e,t){this.trigger("qos",e,t)},this),t.$.eventing(this),this.destroy=function(){if(!f){if(f=!0,s){var r=s.unregisterMessageDelegate(d);0===r&&(n&&n.isConnected()&&i&&!i.destroyed&&n._.subscriberDestroy(i,o),this.subscribeToAudio(!1)),t.PeerConnections.remove(e,i.id)}s=null,this.off()}},this.getDataChannel=function(e,t,n){s.getDataChannel(e,t,n)},this.processMessage=function(e,t){s.processMessage(e,t)},this.getStats=function(e){s?s.getStats(e):e(new t.$.Error("Subscriber is not connected cannot getStats",1015))},this.subscribeToAudio=h(!1),this.subscribeToVideo=h(!0),this.hasRelayCandidates=function(){return g},this.init=function(){s=t.PeerConnections.add(e,i.streamId,{}),s.on({close:a,streamAdded:l,streamRemoved:c,error:u,qos:p},this);var h=s.registerMessageDelegate(d);if(s.remoteStreams().length>0)t.$.forEach(s.remoteStreams(),l,this);else if(1===h){var f;if(r.subscribeToVideo||r.subscribeToAudio){var g=i.getChannelsOfType("audio"),m=i.getChannelsOfType("video");f=t.$.map(g,function(e){return{id:e.id,type:e.type,active:r.subscribeToAudio}}).concat(t.$.map(m,function(e){return{id:e.id,type:e.type,active:r.subscribeToVideo,restrictFrameRate:void 0!==r.restrictFrameRate?r.restrictFrameRate:!1}}))}n._.subscriberCreate(i,o,f,t.$.bind(function(e,n){e&&this.trigger("error",e.message,this,"Subscribe"),s&&s.setIceServers(t.Raptor.parseIceServers(n))},this))}}},t.PublisherPeerConnection=function(e,n,i,o,r){var s,a,l,c,u,d=!1,h=n._.subscriberMap[e.id+"_"+i];a=function(){this.destroy(),this.trigger("disconnected",this)},l=function(e,t){this.trigger("error",null,e,this,t),this.destroy()},c=t.$.bind(function(e,o,r){if(!d){var s=e===t.Raptor.Actions.CANDIDATE||e===t.Raptor.Actions.OFFER||e===t.Raptor.Actions.ANSWER||e===t.Raptor.Actions.PRANSWER;if(s){var a=e===t.Raptor.Actions.CANDIDATE?o.candidate:o.sdp;d=-1!==a.indexOf("typ relay")}}switch(e){case t.Raptor.Actions.ANSWER:case t.Raptor.Actions.PRANSWER:n.sessionInfo.p2pEnabled?n._.jsepAnswerP2p(i,h,o.sdp):n._.jsepAnswer(i,o.sdp);break;case t.Raptor.Actions.OFFER:this.trigger("connected"),n._.jsepOffer(r,o.sdp);break;case t.Raptor.Actions.CANDIDATE:n.sessionInfo.p2pEnabled?n._.jsepCandidateP2p(i,h,o):n._.jsepCandidate(i,o)}},this),u=t.$.bind(function(t,n){this.trigger("qos",e,t,n)},this),t.$.eventing(this),this.getDataChannel=function(e,t,n){s.getDataChannel(e,t,n)},this.destroy=function(){s&&(s.off(),t.PeerConnections.remove(e,i)),s=null},this.processMessage=function(e,t){s.processMessage(e,t)},this.init=function(n){s=t.PeerConnections.add(e,i,{iceServers:n,channels:r}),s.on({close:a,error:l,qos:u},this),s.registerMessageDelegate(c),s.addLocalStream(o),this.remoteConnection=function(){return e},this.hasRelayCandidates=function(){return d}},this.getSenders=function(){return s.getSenders()}};var I=function(t,n){function i(){a||((r!==n.videoWidth||s!==n.videoHeight)&&(t.trigger("videoDimensionsChanged",{width:r,height:s},{width:n.videoWidth,height:n.videoHeight}),r=n.videoWidth,s=n.videoHeight),o())}function o(){t.whenTimeIncrements(function(){e.requestAnimationFrame(i)})}var r=n.videoWidth,s=n.videoHeight,a=!0;t.startObservingSize=function(){a=!1,o()},t.stopObservingSize=function(){a=!0}};if(function(e){function n(e,t){var n=document.createElement("video");if(n.setAttribute("autoplay",""),n.innerHTML=e,t){t.muted===!0&&(delete t.muted,n.muted="true");for(var i in t)t.hasOwnProperty(i)&&n.setAttribute(i,t[i])}return n}function i(e){return h[parseInt(e,10)]||"An unknown error occurred."}function o(n,o,s){var a,l="Chrome"===t.$.env.name?1:0,c=o.getVideoTracks().length>l?"timeupdate":"loadedmetadata",u=function(){clearTimeout(a),n.removeEventListener(c,d,!1),n.removeEventListener("error",h,!1),o.onended=null},d=function(){u(),s(null)},h=function(e){u(),r(n),s("There was an unexpected problem with the Video Stream: "+i(e.target.error.code))},p=function(){u(),r(n),s("Stream ended while trying to bind it to a video element.")};n.addEventListener(c,d,!1),n.addEventListener("error",h,!1),o.onended=p,void 0!==n.srcObject?n.srcObject=o:void 0!==n.mozSrcObject?n.mozSrcObject=o:n.src=e.URL.createObjectURL(o)}function r(t){void 0!==t.srcObject?t.srcObject=null:void 0!==t.mozSrcObject?t.mozSrcObject=null:e.URL.revokeObjectURL(t.src)}var s={0:"rotate(0deg)",270:"rotate(90deg)",90:"rotate(-90deg)",180:"rotate(180deg)"};t.VideoOrientation={ROTATED_NORMAL:0,ROTATED_LEFT:270,ROTATED_RIGHT:90,ROTATED_UPSIDE_DOWN:180};var a=50,l=2*Math.PI/360;t.VideoElement=function(e){var n,i,o=t.$.defaults(e&&!t.$.isFunction(e)?e:{},{fallbackText:"Sorry, Web RTC is not available in your browser"}),r=t.$.isFunction(arguments[arguments.length-1])?arguments[arguments.length-1]:void 0,s=t.$.bind(function(e){this.trigger("orientationChanged",e)},this),a=OTPlugin.isInstalled()?new c(o,r,s):new u(o,r,s),l=!1;t.$.eventing(this),a.on("videoDimensionsChanged",t.$.bind(function(e,t){this.trigger("videoDimensionsChanged",e,t)},this)),a.on("mediaStopped",t.$.bind(function(){this.trigger("mediaStopped")},this)),t.$.defineProperties(this,{domElement:{get:function(){return a.domElement()}},videoWidth:{get:function(){return a["video"+(this.isRotated()?"Height":"Width")]()}},videoHeight:{get:function(){return a["video"+(this.isRotated()?"Width":"Height")]()}},aspectRatio:{get:function(){return(this.videoWidth()+0)/this.videoHeight()}},isRotated:{get:function(){return a.isRotated()}},orientation:{get:function(){return a.orientation()},set:function(e){a.orientation(e)}},audioChannelType:{get:function(){return a.audioChannelType()},set:function(e){a.audioChannelType(e)}}}),this.imgData=function(){return a.imgData()},this.appendTo=function(e){return a.appendTo(e),this},this.bindToStream=function(e,o){return l=!1,n=e,a.bindToStream(e,t.$.bind(function(e){return e?void o(e):(l=!0,i&&(this.setAudioVolume(i),i=null),a.on("aspectRatioAvailable",t.$.bind(this.trigger,this,"aspectRatioAvailable")),void o(null))},this)),this},this.unbindStream=function(){return n?(n=null,a.unbindStream(),this):this},this.setAudioVolume=function(e){return l?a.setAudioVolume(t.$.roundFloat(e/100,2)):i=e,this},this.getAudioVolume=function(){return l?parseInt(100*a.getAudioVolume(),10):i||50},this.whenTimeIncrements=function(e,t){return a.whenTimeIncrements(e,t),this},this.onRatioAvailable=function(e){return a.onRatioAvailable(e),this},this.destroy=function(){return this.off(),void a.destroy()}};var c=function(e,n,i){var o,r,s=!1,l=[];t.$.eventing(this),d(this,function(){return o.domElement},i),this.domElement=function(){return o?o.domElement:void 0},this.videoWidth=function(){return o?o.videoWidth():void 0},this.videoHeight=function(){return o?o.videoHeight():void 0},this.imgData=function(){return o?o.getImgData():null},this.appendTo=function(e){return r=e,this},this.bindToStream=function(e,t){return r?(o=e._.render(),o.appendTo(r),o.show(function(e){if(!e){s=!0;for(var n;n=l.shift();)n()}t(e)}),this):void t("The VideoElement must attached to a DOM node before a stream can be bound")},this.unbindStream=function(){return o&&(o.destroy(),r=null,o=null),this},this.setAudioVolume=function(e){o&&o.volume(e)},this.getAudioVolume=function(){return o?o.volume():a},this.audioChannelType=function(){return"unknown"},this.whenTimeIncrements=function(e,n){t.$.callAsync(t.$.bind(e,n))},this.onRatioAvailable=function(e){s?e():l.push(e)},this.destroy=function(){return void this.unbindStream()}},u=function(e,s,l){var c,u=!1;t.$.eventing(this);var h=t.$.bind(function(e){var t="There was an unexpected problem with the Video Stream: "+i(e.target.error.code);s(t,this,"VideoElement")},this),p=function(){u||(t.warn("Video element paused, auto-resuming. If you intended to do this, use publishVideo(false) or subscribeToVideo(false) instead."),u=!0),c.play()};c=n(e.fallbackText,e.attributes);var f=!1,g=[];c.addEventListener("timeupdate",function m(){if(!c)return void event.target.removeEventListener("timeupdate",m);var e=c.videoWidth/c.videoHeight;if(!isNaN(e)){c.removeEventListener("timeupdate",m),f=!0;for(var t;t=g.shift();)t()}}),c.addEventListener("pause",p),I(this,c),d(this,function(){return c},l),this.domElement=function(){return c},this.videoWidth=function(){return c?c.videoWidth:0},this.videoHeight=function(){return c?c.videoHeight:0},this.imgData=function(){var e=t.$.createElement("canvas",{width:c.videoWidth,height:c.videoHeight,style:{display:"none"}});document.body.appendChild(e);try{e.getContext("2d").drawImage(c,0,0,e.width,e.height)}catch(n){return t.warn("Cannot get image data yet"),null}var i=e.toDataURL("image/png");return t.$.removeElement(e),t.$.trim(i.replace("data:image/png;base64,",""))},this.appendTo=function(e){return e.appendChild(c),this},this.bindToStream=function(e,t){var n=this;return o(c,e,function(i){return i?void t(i):(n.startObservingSize(),e.onended=function(){n.trigger("mediaStopped",this)},c&&c.addEventListener("error",h,!1),void t(null))}),this},this.unbindStream=function(){return c&&r(c),this.stopObservingSize(),this},this.setAudioVolume=function(e){c&&(c.volume=e)},this.getAudioVolume=function(){return c?c.volume:a},this.audioChannelType=function(e){return void 0!==e&&(c.mozAudioChannelType=e),"mozAudioChannelType"in c?c.mozAudioChannelType:"unknown"},this.whenTimeIncrements=function(e,n){if(c){var i,o;o=t.$.bind(function(){c&&(!i||i>=c.currentTime?i=c.currentTime:(c.removeEventListener("timeupdate",o,!1),e.call(n,this)))},this),c.addEventListener("timeupdate",o,!1)}},this.destroy=function(){return this.unbindStream(),void(c&&(c.removeEventListener("pause",p),t.$.removeElement(c),c=null))},this.onRatioAvailable=function(e){f?e():g.push(e)}},d=function(e,n,i,o){var r=o;t.$.defineProperties(e,{isRotated:{get:function(){return this.orientation()&&(270===this.orientation().videoOrientation||90===this.orientation().videoOrientation)}},orientation:{get:function(){return r},set:function(e){r=e;var o=s[e.videoOrientation]||s.ROTATED_NORMAL;switch(t.$.env.name){case"Chrome":case"Safari":n().style.webkitTransform=o;break;case"IE":if(t.$.env.version>=9)n().style.msTransform=o;else{var a=e.videoOrientation*l,c=n(),u=Math.cos(a),d=Math.sin(a);c.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+u+",M12="+-d+",M21="+d+",M22="+u+",SizingMethod='auto expand')"}break;default:n().style.transform=o}i(r)}},audioChannelType:{get:function(){return"mozAudioChannelType"in this.domElement?this.domElement.mozAudioChannelType:"unknown"},set:function(e){"mozAudioChannelType"in this.domElement&&(this.domElement.mozAudioChannelType=e)}}})},h={};e.MediaError&&(h[e.MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.",h[e.MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.",h[e.MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be  usable.",h[e.MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable.")}(e),!function(){function e(e,n,i,r,s){var a=t.$(".OT_video-element",e);if(a.length>0){var l={left:"",top:""};if(OTPlugin.isInstalled())l.width="100%",l.height="100%";else{r=r||o,r=s?1/r:r;var c,u,d=n/i;s?(u=n,c=u*r,l.width=c+"px",l.height=u+"px",l.top=(c+i)/2+"px"):d>r?(c=n,u=c/r,l.width=c+"px",l.height=u+"px",l.top=(-u+i)/2+"px"):(u=i,c=u*r,l.width=c+"px",l.height=u+"px",l.left=(-c+n)/2+"px")}a.css(l)}}function n(e,n,i,r,s){var a=t.$(".OT_video-element",e);if(a.length>0){var l={left:"",top:""};if(OTPlugin.isInstalled()){r=r||o;var c,u,d=n/i;d>r?(u=i,c=i*r,l.width=c+"px",l.height=u+"px",l.left=(n-c)/2+"px"):(c=n,u=c/r,l.width=c+"px",l.height=u+"px",l.top=(i-u)/2+"px")}else s?(l.width=i+"px",l.height=n+"px",l.top=i+"px"):(l.width="100%",l.height="100%");a.css(l)}}function i(e,n,i){var o=parseInt(n,10),c=parseInt(i,10);a>o||l>c?t.$.addClass(e,"OT_micro"):t.$.removeClass(e,"OT_micro"),r>o||s>c?t.$.addClass(e,"OT_mini"):t.$.removeClass(e,"OT_mini")}var o=4/3,r=128,s=128,a=64,l=64,c=function(e,n){var i,o;if(e&&e.nodeName?(i=e,i.getAttribute("id")&&0!==i.getAttribute("id").length||i.setAttribute("id","OT_"+t.$.uuid()),o=i.getAttribute("id")):e&&(i=t.$("#"+e).get(0),i&&(o=e)),o||(o="OT_"+t.$.uuid().replace(/-/g,"_")),i)if(null!=n&&"replace"!==n){var r=document.createElement("div");r.id="OT_"+t.$.uuid(),"append"===n?(i.appendChild(r),i=r):"before"===n?(i.parentNode.insertBefore(r,i),i=r):"after"===n&&(i.parentNode.insertBefore(r,i.nextSibling),i=r)}else t.$.emptyElement(i);else i=t.$.createElement("div",{id:o}),i.style.backgroundColor="#000000",document.body.appendChild(i);return i};t.WidgetView=function(o,r){var s,a,l,u,d,h,p,f={},g=c(o,r&&r.insertMode),m=document.createElement("div"),v={},b=!0,y=!1,w="cover",C=e;t.$.eventing(f),r&&(h=r.width,p=r.height,h&&"number"==typeof h&&(h+="px"),p&&"number"==typeof p&&(p+="px"),g.style.width=h?h:"264px",g.style.height=p?p:"198px",g.style.overflow="hidden",i(g,h||"264px",p||"198px"),(void 0===r.mirror||r.mirror)&&t.$.addClass(g,"OT_mirrored"),"contain"===r.fitMode?(w="contain",C=n):"cover"!==r.fitMode&&t.warn('Invalid fit value "'+r.fitMode+'" passed. Only "contain" and "cover" can be used.')),r.classNames&&t.$.addClass(g,r.classNames),t.$(g).addClass("OT_loading OT_fit-mode-"+w),t.$.addClass(m,"OT_widget-container"),m.style.width="100%",m.style.height="100%",g.appendChild(m),d=document.createElement("div"),t.$.addClass(d,"OT_video-loading"),m.appendChild(d),u=document.createElement("div"),t.$.addClass(u,"OT_video-poster"),m.appendChild(u),v.width=g.offsetWidth,v.height=g.offsetHeight,OTPlugin.isInstalled()||(s=t.$(g).observeSize(function(e){var t=e.width,n=e.height;i(g,t,n),a&&C(m,t,n,a.aspectRatio(),a.isRotated())})[0],l=t.$.observeNodeOrChildNodeRemoval(g,function(e){if(a){var n=t.$.some(e,function(e){return e===m||"VIDEO"===e.nodeName});n&&(a.destroy(),a=null),m&&(t.$.removeElement(m),m=null),s&&(s.disconnect(),s=null),l&&(l.disconnect(),l=null)}}));var _=function(){a&&C(m,g.offsetWidth,g.offsetHeight,a.aspectRatio(),a.isRotated())};return f.destroy=function(){s&&(s.disconnect(),s=null),l&&(l.disconnect(),l=null),a&&(a.destroy(),a=null),g&&(t.$.removeElement(g),g=null)},f.setBackgroundImageURI=function(e){"http:"!==e.substr(0,5)&&"https:"!==e.substr(0,6)&&"data:image/png;base64,"!==e.substr(0,22)&&(e="data:image/png;base64,"+e),t.$.css(u,"backgroundImage","url("+e+")"),t.$.css(u,"backgroundSize","contain"),t.$.css(u,"opacity","1.0")},r&&r.style&&r.style.backgroundImageURI&&f.setBackgroundImageURI(r.style.backgroundImageURI),f.bindVideo=function(e,n,i){a&&(a.destroy(),a=null);var o=n&&n.error?n.error:void 0;delete n.error;var r=new t.VideoElement({attributes:n},o);return n.audioVolume&&r.setAudioVolume(n.audioVolume),r.audioChannelType("telephony"),r.appendTo(m).bindToStream(e,function(e){return e?(r.destroy(),void i(e)):(a=r,r.domElement()&&t.$.css(r.domElement(),"height",""),r.on({orientationChanged:_,videoDimensionsChanged:function(e,t){_(),f.trigger("videoDimensionsChanged",e,t)},mediaStopped:function(){f.trigger("mediaStopped")}}),r.onRatioAvailable(_),void i(null,r))}),t.$.addClass(r.domElement(),"OT_video-element"),t.$.css(r.domElement(),"height","1px"),r},t.$.defineProperties(f,{video:{get:function(){return a}},showPoster:{get:function(){return!t.$.isDisplayNone(u)},set:function(e){e?t.$.show(u):t.$.hide(u)}},poster:{get:function(){return t.$.css(u,"backgroundImage")},set:function(e){t.$.css(u,"backgroundImage","url("+e+")")}},loading:{get:function(){return b},set:function(e){b=e,b?t.$.addClass(g,"OT_loading"):t.$.removeClass(g,"OT_loading")}},audioOnly:{get:function(){return y},set:function(e){y=e,y?t.$.addClass(g,"OT_audio-only"):t.$.removeClass(g,"OT_audio-only"),OTPlugin.isInstalled()&&setTimeout(_,0)}},domId:{get:function(){return g.getAttribute("id")}}}),f.domElement=g,f.addError=function(e,n,i){g.innerHTML="<p>"+e+(n?' <span class="ot-help-message">'+n+"</span>":"")+"</p>",t.$.addClass(g,i||"OT_subscriber_error"),g.querySelector("p").offsetHeight>g.offsetHeight&&(g.querySelector("span").style.display="none")},f}}(e),!t.properties)throw new Error("OT.properties does not exist, please ensure that you include a valid properties file.");t.useSSL=function(){return t.properties.supportSSL&&(e.location.protocol.indexOf("https")>=0||e.location.protocol.indexOf("chrome-extension")>=0)},t.properties=function(n){var i=t.$.clone(n);i.debug="true"===n.debug||n.debug===!0,i.supportSSL="true"===n.supportSSL||n.supportSSL===!0,e.OTProperties&&(e.OTProperties.cdnURL&&(i.cdnURL=e.OTProperties.cdnURL),e.OTProperties.cdnURLSSL&&(i.cdnURLSSL=e.OTProperties.cdnURLSSL),e.OTProperties.configURL&&(i.configURL=e.OTProperties.configURL),e.OTProperties.assetURL&&(i.assetURL=e.OTProperties.assetURL),e.OTProperties.cssURL&&(i.cssURL=e.OTProperties.cssURL)),i.assetURL||(i.assetURL=t.useSSL()?i.cdnURLSSL+"/webrtc/"+i.version:i.cdnURL+"/webrtc/"+i.version);var o="IE"===t.$.env.name&&t.$.env.version<=9;return o&&e.location.protocol.indexOf("https")<0||(i.apiURL=i.apiURLSSL,i.loggingURL=i.loggingURLSSL),i.configURL||(i.configURL=i.assetURL+"/js/dynamic_config.min.js"),i.cssURL||(i.cssURL=i.assetURL+"/css/TB.min.css"),i}(t.properties),!function(){var e,n,i=function(e){return!(t.$.isFunction(e.get)&&t.$.isFunction(e.set))},o=function(t){return n?void t(null,n):void e.get(t)};t.overrideGuidStorage=function(o){if(i(o))throw new Error("The storageInterface argument does not seem to be valid, it must implement get and set methods");e!==o&&(e=o,n&&e.set(n,function(e){e&&t.error("Failed to send initial Guid value ("+n+") to the newly assigned Guid Storage. The error was: "+e)}))},t._||(t._={}),t._.getClientGuid=function(i){o(function(o,r){return o?void i(o):(r?n||(n=r):(r=t.$.uuid(),e.set(r,function(e){return e?void i(e):void(n=r)})),void i(null,n))})},t.overrideGuidStorage({get:function(e){e(null,t.$.getCookie("opentok_client_id"))},set:function(e,n){t.$.setCookie("opentok_client_id",e),n(null)}})}(e),!function(){var e,n,i,o,r,s;e=function(){return navigator.getUserMedia?t.$.bind(navigator.getUserMedia,navigator):navigator.mozGetUserMedia?t.$.bind(navigator.mozGetUserMedia,navigator):navigator.webkitGetUserMedia?t.$.bind(navigator.webkitGetUserMedia,navigator):OTPlugin.isInstalled()?t.$.bind(OTPlugin.getUserMedia,OTPlugin):void 0}(),n={PERMISSION_DENIED:"PermissionDeniedError",NOT_SUPPORTED_ERROR:"NotSupportedError",MANDATORY_UNSATISFIED_ERROR:" ConstraintNotSatisfiedError",NO_DEVICES_FOUND:"NoDevicesFoundError",
HARDWARE_UNAVAILABLE:"HardwareUnavailableError",TrackStartError:"HardwareUnavailableError"},i={PermissionDeniedError:"End-user denied permission to hardware devices",PermissionDismissedError:"End-user dismissed permission to hardware devices",NotSupportedError:"A constraint specified is not supported by the browser.",ConstraintNotSatisfiedError:"It's not possible to satisfy one or more constraints passed into the getUserMedia function",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NoDevicesFoundError:"No voice or video input devices are available on this machine.",HardwareUnavailableError:"The selected voice or video devices are unavailable. Verify that the chosen devices are not in use by another application."},o=function(e,t){var n,o;return n=t.hasOwnProperty(e)?t[e]:e,o=i.hasOwnProperty(n)?i[n]:"Unknown Error while getting user media",{name:n,message:o}},r=function(e){var i;return t.$.isObject(e)&&e.name?(i=o(e.name,n),i.constraintName=e.constraintName):i="string"==typeof e?o(e,n):{message:"Unknown Error type while getting media"},i},s=function(e){if(!e||!t.$.isObject(e))return!0;for(var n in e)if(e.hasOwnProperty(n)&&e[n])return!1;return!0},t.$.getUserMedia=function(n,i,o,a,l,c,u){var d=e;if(t.$.isFunction(u)&&(d=u),s(n))return t.error("Couldn't get UserMedia: All constraints were false"),void o.call(null,{name:"NO_VALID_CONSTRAINTS",message:"Video and Audio was disabled, you need to enabled at least one"});var h=null,p=!1,f=function(){h&&clearTimeout(h),p&&l&&l()},g=function(){h=null,p=!0,a&&a()},m=function(e){f(),i.call(null,e)},v=function(e){f();var t=r(e);"PermissionDeniedError"===t.name||"PermissionDismissedError"===t.name?c.call(null,t):o.call(null,t)};try{d(n,m,v)}catch(b){return t.error("Couldn't get UserMedia: "+b.toString()),void v()}h=-1===location.protocol.indexOf("https")?setTimeout(g,100):setTimeout(g,500)}}(),!function(){var e=function(e){return function(t,n){n.querySelector("html").style.height=n.body.style.height="100%",e(t,n)}},n=function(e,n,i){var o=e.head||e.getElementsByTagName("head")[0],r=t.$.createElement("link",{type:"text/css",media:"screen",rel:"stylesheet",href:n});o.appendChild(r),t.$.on(r,"error",function(e){t.error("Could not load CSS for dialog",n,e&&e.message||e)}),t.$.on(r,"load",i)},i=function(e,i,o){var r=["//fonts.googleapis.com/css?family=Didact+Gothic",t.properties.cssURL].concat(i),s=r.length;t.$.forEach(r,function(t){n(e,t,function(){--s<=0&&o()})})},o=function(e,n,i){var o=t.$.createElement(i||"div",{"class":e},n,this);return o.on=t.$.bind(t.$.on,t.$,o),o.off=t.$.bind(t.$.off,t.$,o),o},r=function(e,n,i){var r=o.call(this,"",null,"input");return r=t.$(r).on("change",i),"IE"===t.$.env.name&&t.$.env.version<=8&&r.on("click",function(){r.first.blur(),r.first.focus()}),r.attr({name:n,id:n,type:"checkbox"}),r.first},s=function(e,t,n){var i=o.call(this,n||"",e,"a");return i.setAttribute("href",t),i};t.Dialogs={},t.Dialogs.Plugin={},t.Dialogs.Plugin.promptToInstall=function(){var n=new t.$.Modal(e(function(e,a){function l(){n.trigger("download"),setTimeout(function(){m.querySelector(".OT_dialog-messages-main").innerHTML="Plugin installation successful";var e=m.querySelectorAll(".OT_dialog-section");t.$.addClass(e[0],"OT_dialog-hidden"),t.$.removeClass(e[1],"OT_dialog-hidden")},3e3)}function c(){n.trigger("refresh")}function u(){f.checked?d():h()}function d(){y.enable(),y.on("click",l),C.enable(),C.on("click",c)}function h(){y.disable(),y.off("click",l),C.disable(),C.off("click",c)}var p,f,g,m,v=t.$.bind(o,a),b=function(e,n){var i="OT_dialog-button "+(n?"OT_dialog-button-"+n:"OT_dialog-button-large"),o=v(i,e);return o.enable=function(){return t.$.removeClass(this,"OT_dialog-button-disabled"),this},o.disable=function(){return t.$.addClass(this,"OT_dialog-button-disabled"),this},o},y=b("Download plugin"),w=b("cancel","small"),C=b("Refresh browser");t.$.addClass(w,"OT_dialog-no-natural-margin OT_dialog-button-block"),t.$.addClass(C,"OT_dialog-no-natural-margin"),y.disable(),C.disable(),w.on("click",function(){n.trigger("cancelButtonClicked"),n.close()}),g=v("OT_closeButton","&times;").on("click",function(){n.trigger("closeButtonClicked"),n.close()}).first;var _=e.location.protocol.indexOf("https")>=0?"https":"http";p=s.call(a,"end-user license agreement",_+"://tokbox.com/support/ie-eula"),f=r.call(a,null,"acceptEULA",u),m=v("OT_dialog-centering",[v("OT_dialog-centering-child",[v("OT_root OT_dialog OT_dialog-plugin-prompt",[g,v("OT_dialog-messages",[v("OT_dialog-messages-main","This app requires real-time communication")]),v("OT_dialog-section",[v("OT_dialog-single-button-with-title",[v("OT_dialog-button-title",[f,function(){var e=v("","accept","label");return e.setAttribute("for",f.id),e.style.margin="0 5px",e}(),p]),v("OT_dialog-actions-card",[y,w])])]),v("OT_dialog-section OT_dialog-hidden",[v("OT_dialog-button-title",["You can now enjoy webRTC enabled video via Internet Explorer."]),C])])])]),i(a,[],function(){a.body.appendChild(m)})}));return n},t.Dialogs.Plugin.promptToReinstall=function(){var n=new t.$.Modal(e(function(e,r){var s,a,l,c=t.$.bind(o,r);s=c("OT_closeButton","&times;").on("click",function(){n.trigger("closeButtonClicked"),n.close()}).first,a=c("OT_dialog-button OT_dialog-button-large OT_dialog-no-natural-margin","Okay").on("click",function(){n.trigger("okay")}).first,l=c("OT_dialog-centering",[c("OT_dialog-centering-child",[c("OT_ROOT OT_dialog OT_dialog-plugin-reinstall",[s,c("OT_dialog-messages",[c("OT_dialog-messages-main","Reinstall Opentok Plugin"),c("OT_dialog-messages-minor","Uh oh! Try reinstalling the OpenTok plugin again to enable real-time video communication for Internet Explorer.")]),c("OT_dialog-section",[c("OT_dialog-single-button",a)])])])]),i(r,[],function(){r.body.appendChild(l)})}));return n},t.Dialogs.Plugin.updateInProgress=function(){var n,r,s=0,a=new t.$.Modal(e(function(e,l){var c,u=t.$.bind(o,l);r=u("OT_dialog-plugin-upgrade-percentage","0%","strong"),n=u("OT_dialog-progress-bar-fill"),c=u("OT_dialog-centering",[u("OT_dialog-centering-child",[u("OT_ROOT OT_dialog OT_dialog-plugin-upgrading",[u("OT_dialog-messages",[u("OT_dialog-messages-main",["One moment please... ",r]),u("OT_dialog-progress-bar",n),u("OT_dialog-messages-minor OT_dialog-no-natural-margin","Please wait while the OpenTok plugin is updated")])])])]),i(l,[],function(){l.body.appendChild(c),null!=s&&a.setUpdateProgress(s)})}));return a.setUpdateProgress=function(e){n&&r?e>99?(t.$.css(n,"width",""),r.innerHTML="100%"):1>e?(t.$.css(n,"width","0%"),r.innerHTML="0%"):(t.$.css(n,"width",e+"%"),r.innerHTML=e+"%"):s=e},a},t.Dialogs.Plugin.updateComplete=function(n){var r=new t.$.Modal(e(function(e,s){var a,l,c=t.$.bind(o,s);a=c("OT_dialog-button OT_dialog-button-large OT_dialog-no-natural-margin","Reload").on("click",function(){r.trigger("reload")}).first;var u;u=n?["Update Failed.",n+""||"NO ERROR"]:["Update Complete.","The OpenTok plugin has been succesfully updated. Please reload your browser."],l=c("OT_dialog-centering",[c("OT_dialog-centering-child",[c("OT_root OT_dialog OT_dialog-plugin-upgraded",[c("OT_dialog-messages",[c("OT_dialog-messages-main",u[0]),c("OT_dialog-messages-minor",u[1])]),c("OT_dialog-single-button",a)])])]),i(s,[],function(){s.body.appendChild(l)})}));return r}}(),!function(e){var n={audio:"audioInput",video:"videoInput"};t.$.shouldAskForDevices=function(n){var i=e.MediaStreamTrack;null!=i&&t.$.isFunction(i.getSources)?e.MediaStreamTrack.getSources(function(e){var t=e.some(function(e){return"audio"===e.kind}),i=e.some(function(e){return"video"===e.kind});n.call(null,{video:i,audio:t})}):(t.$.shouldAskForDevices=function(e){setTimeout(t.$.bind(e,null,{video:!0,audio:!0}))},t.$.shouldAskForDevices(n))},t.$.getMediaDevices=function(i){t.$.hasCapabilities("getMediaDevices")?e.MediaStreamTrack.getSources(function(e){var o=t.$.filter(e,function(e){return null!=n[e.kind]});i(void 0,t.$.map(o,function(e){return{deviceId:e.id,label:e.label,kind:n[e.kind]}}))}):i(new Error("This browser does not support getMediaDevices APIs"))}}(e);var M=function(e){var t=document.createElement("link");t.type="text/css",t.media="screen",t.rel="stylesheet",t.href=e;var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(t)};t.Config=function(){var e,n,i,o=!1,r={},s={},a=document.head||document.getElementsByTagName("head")[0],l=function(){n&&(clearTimeout(n),n=null)},c=function(){l(),e&&(e.onload=e.onreadystatechange=null,a&&e.parentNode&&a.removeChild(e),e=void 0)},u=function(){(!e.readyState||/loaded|complete/.test(e.readyState))&&(l(),o||i._onLoadTimeout())},d=function(){c(),t.warn("TB DynamicConfig failed to load due to an error"),this.trigger("dynamicConfigLoadFailed")},h=function(e,t){return t&&s[t]&&s[t][e]?s[t][e]:r[e]};return i={loadTimeout:4e3,_onLoadTimeout:function(){c(),t.warn("TB DynamicConfig failed to load in "+i.loadTimeout+" ms"),this.trigger("dynamicConfigLoadFailed")},load:function(r){if(!r)throw new Error("You must pass a valid configUrl to Config.load");o=!1,setTimeout(function(){e=document.createElement("script"),e.async="async",e.src=r,e.onload=e.onreadystatechange=t.$.bind(u,i),e.onerror=t.$.bind(d,i),a.appendChild(e)},1),n=setTimeout(function(){i._onLoadTimeout()},this.loadTimeout)},isLoaded:function(){return o},reset:function(){this.off(),c(),o=!1,r={},s={}},replaceWith:function(e){c(),e||(e={}),r=e.global||{},s=e.partners||{},o||(o=!0),this.trigger("dynamicConfigChanged")},get:function(e,t,n){var i=h(e,n);return i?i[t]:null}},t.$.eventing(i),i}(),t.$.registerCapability("getUserMedia",function(){return"Node"===t.$.env?!1:!!(navigator.webkitGetUserMedia||navigator.mozGetUserMedia||OTPlugin.isInstalled())}),t.$.registerCapability("PeerConnection",function(){return"Node"===t.$.env?!1:"function"==typeof e.webkitRTCPeerConnection&&e.webkitRTCPeerConnection.prototype.addStream?!0:"function"==typeof e.mozRTCPeerConnection&&t.$.env.version>20?!0:OTPlugin.isInstalled()}),t.$.registerCapability("webrtc",function(){if(t.properties){var e=t.properties.minimumVersion||{},n=e[t.$.env.name.toLowerCase()];if(n&&t.$.env.versionGreaterThan(n))return t.debug("Support for",t.$.env.name,"is disabled because we require",n,"but this is",t.$.env.version),!1}return"Node"===t.$.env?!0:t.$.hasCapabilities("getUserMedia","PeerConnection")}),t.$.registerCapability("bundle",function(){return t.$.hasCapabilities("webrtc")&&("Chrome"===t.$.env.name||"Node"===t.$.env.name||OTPlugin.isInstalled())}),t.$.registerCapability("RTCPMux",function(){return t.$.hasCapabilities("webrtc")&&("Chrome"===t.$.env.name||"Node"===t.$.env.name||OTPlugin.isInstalled())}),t.$.registerCapability("getMediaDevices",function(){return t.$.isFunction(e.MediaStreamTrack)&&t.$.isFunction(e.MediaStreamTrack.getSources)}),t.$.registerCapability("audioOutputLevelStat",function(){return"Chrome"===t.$.env.name||"IE"===t.$.env.name}),t.$.registerCapability("webAudioCapableRemoteStream",function(){return"Firefox"===t.$.env.name}),t.$.registerCapability("webAudio",function(){return"AudioContext"in e}),t.Analytics=function(n){var i="1",o=new t.$.Analytics(n,t.debug,t._.getClientGuid);this.logError=function(n,r,s,a,l){l||(l={});var c=l.partnerId;t.Config.get("exceptionLogging","enabled",c)===!0&&t._.getClientGuid(function(u,d){if(!u){var h=t.$.extend({clientVersion:"js-"+t.properties.version.replace("v",""),guid:d,partnerId:c,source:e.location.href,logVersion:i,clientSystemTime:(new Date).getTime()},l);o.logError(n,r,s,a,h)}})},this.logEvent=function(n,r){var s=n.partnerId;n||(n={}),t._.getClientGuid(function(a,l){if(!a){var c=t.$.extend({clientVersion:"js-"+t.properties.version.replace("v",""),guid:l,partnerId:s,source:e.location.href,logVersion:i,clientSystemTime:(new Date).getTime()},n);o.logEvent(c,!1,r)}})},this.logQOS=function(n){var r=n.partnerId;n||(n={}),t._.getClientGuid(function(s,a){if(!s){var l=t.$.extend({clientVersion:"js-"+t.properties.version.replace("v",""),guid:a,partnerId:r,source:e.location.href,logVersion:i,clientSystemTime:(new Date).getTime(),duration:0},n);o.logQOS(l)}})}},t.ConnectivityAttemptPinger=function(e){var n,i,o,r="Initial",s=["Initial","Attempt","Success","Failure"],a=5e3,l=6,c=function(i){r=i;var o=!1;switch(r){case"Attempt":"Initial"!==n&&(o=!0),d();break;case"Success":"Attempt"!==n&&(o=!0),h();break;case"Failure":"Attempt"!==n&&(o=!0),h()}if(o){var s=e?t.$.clone(e):{};s.action="Internal Error",s.variation="Non-fatal",s.payload={debug:"Invalid sequence: "+e.action+" "+n+" -> "+r},t.analytics.logEvent(s)}},u=t.$.statable(this,s,"Failure",c),d=function(){o=0,i=setInterval(function(){if(l>o){var n=t.$.extend(e,{variation:"Attempting"});t.analytics.logEvent(n)}else h();o++},a)},h=function(){clearInterval(i)};this.setVariation=function(e){n=r,u(e)},this.stop=function(){h()}},t.StylableComponent=function(e,n,i,o){if(!e.trigger)throw new Error("OT.StylableComponent is dependent on the mixin OT.$.eventing. Ensure that this is included in the object before StylableComponent.");var r=!1,s=function(t,n,i){i?e.trigger("styleValueChanged",t,n,i):e.trigger("styleValueChanged",t,n)};i===!1&&(n={buttonDisplayMode:"off",nameDisplayMode:"off",audioLevelDisplayMode:"off"},r=!0,o({showControls:!1}));var a=new A(n,s);e.getStyle=function(e){return a.get(e)},e.setStyle=r?function(){return t.warn("Calling setStyle() has no effect because theshowControls option was set to false"),this}:function(e,t,n){var i={};return"string"!=typeof e?(a.setAll(e,n),i=e):(a.set(e,t),i[e]=t),o&&o(i),this}};var A=function(e,n){var i,o,r,s,a={};i=["showMicButton","showSpeakerButton","nameDisplayMode","buttonDisplayMode","backgroundImageURI","audioLevelDisplayMode"],o={buttonDisplayMode:["auto","mini","mini-auto","off","on"],nameDisplayMode:["auto","off","on"],audioLevelDisplayMode:["auto","off","on"],showSettingsButton:[!0,!1],showMicButton:[!0,!1],backgroundImageURI:null,showControlBar:[!0,!1],showArchiveStatus:[!0,!1],videoDisabledDisplayMode:["auto","off","on"]},r=function(e,n){return"backgroundImageURI"===e||o.hasOwnProperty(e)&&-1!==t.$.arrayIndexOf(o[e],n)},s=function(e){switch(e){case"true":return!0;case"false":return!1;default:return e}},this.getAll=function(){var e=t.$.clone(a);for(var n in e)e.hasOwnProperty(n)&&t.$.arrayIndexOf(i,n)<0&&delete e[n];return e},this.get=function(e){return e?a[e]:this.getAll()},this.setAll=function(e,i){var o,l;for(var c in e)e.hasOwnProperty(c)&&(l=s(e[c]),r(c,l)?(o=a[c],l!==o&&(a[c]=l,i||n(c,l,o))):t.warn("Style.setAll::Invalid style property passed "+c+" : "+l));return this},this.set=function(e,i){t.debug("setStyle: "+e.toString());var o,l=s(i);return r(e,l)?(o=a[e],l!==o&&(a[e]=l,n(e,i,o)),this):(t.warn("Style.set::Invalid style property passed "+e+" : "+l),this)},e&&this.setAll(e,!0)};t.generateSimpleStateMachine=function(e,n,i){var o=n.slice(),r=t.$.clone(i),s=function(e){return-1!==t.$.arrayIndexOf(o,e)},a=function(e,n){return r[e]&&-1!==t.$.arrayIndexOf(r[e],n)};return function(t){function n(e,n){t({message:e,newState:n,currentState:o,previousState:r})}function i(e){return s(e)?a(o,e)?!0:(n("'"+o+"' cannot transition to '"+e+"'",e),!1):(n("'"+e+"' is not a valid state",e),!1)}var o=e,r=null;this.current=o,this.set=function(e){i(e)&&(r=o,this.current=o=e)}}},!function(){var e,n,i="NotSubscribing";e=["NotSubscribing","Init","ConnectingToPeer","BindingRemoteStream","Subscribing","Failed","Destroyed"],n={NotSubscribing:["NotSubscribing","Init","Destroyed"],Init:["NotSubscribing","ConnectingToPeer","BindingRemoteStream","Destroyed"],ConnectingToPeer:["NotSubscribing","BindingRemoteStream","Failed","Destroyed"],BindingRemoteStream:["NotSubscribing","Subscribing","Failed","Destroyed"],Subscribing:["NotSubscribing","Failed","Destroyed"],Failed:["Destroyed"],Destroyed:[]},t.SubscribingState=t.generateSimpleStateMachine(i,e,n),t.SubscribingState.prototype.isDestroyed=function(){return"Destroyed"===this.current},t.SubscribingState.prototype.isFailed=function(){return"Failed"===this.current},t.SubscribingState.prototype.isSubscribing=function(){return"Subscribing"===this.current},t.SubscribingState.prototype.isAttemptingToSubscribe=function(){return-1!==t.$.arrayIndexOf(["Init","ConnectingToPeer","BindingRemoteStream"],this.current)}}(e),!function(){var e=["NotPublishing","GetUserMedia","BindingMedia","MediaBound","PublishingToSession","Publishing","Failed","Destroyed"],n={NotPublishing:["NotPublishing","GetUserMedia","Destroyed"],GetUserMedia:["BindingMedia","Failed","NotPublishing","Destroyed"],BindingMedia:["MediaBound","Failed","NotPublishing","Destroyed"],MediaBound:["NotPublishing","PublishingToSession","Failed","Destroyed"],PublishingToSession:["NotPublishing","Publishing","Failed","Destroyed"],Publishing:["NotPublishing","MediaBound","Failed","Destroyed"],Failed:["Destroyed"],Destroyed:[]},i="NotPublishing";t.PublishingState=t.generateSimpleStateMachine(i,e,n),t.PublishingState.prototype.isDestroyed=function(){return"Destroyed"===this.current},t.PublishingState.prototype.isAttemptingToPublish=function(){return-1!==t.$.arrayIndexOf(["GetUserMedia","BindingMedia","MediaBound","PublishingToSession"],this.current)},t.PublishingState.prototype.isPublishing=function(){return"Publishing"===this.current}}(e),!function(){t.Microphone=function(e,n){var i;t.$.defineProperties(this,{muted:{get:function(){return i},set:function(t){if(i!==t){i=t;for(var n=e.getAudioTracks(),o=0,r=n.length;r>o;++o)n[o].setEnabled(!i)}}}}),this.muted(void 0!==n?n===!0:e.getAudioTracks().length?!e.getAudioTracks()[0].enabled:!1)}}(e),t.IntervalRunner=function(t,n){var i=t,o=n,r=null;this.start=function(){r=e.setInterval(i,1e3/o)},this.stop=function(){e.clearInterval(r),r=null}},!function(){t.Event=t.$.Event(),t.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL:"signal",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",MEDIA_STOPPED:"mediaStopped",PUBLISHER_DESTROYED:"destroyed",SUBSCRIBER_DESTROYED:"destroyed",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",CLOSE_BUTTON_CLICK:"closeButtonClick",MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",ENV_LOADED:"envLoaded",ENV_UNLOADED:"envUnloaded",AUDIO_LEVEL_UPDATED:"audioLevelUpdated"},t.ExceptionCodes={JS_EXCEPTION:2e3,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,NOT_CONNECTED:1010,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,TERMS_OF_SERVICE_FAILURE:1026,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SUBSCRIBE:1501,UNABLE_TO_FORCE_DISCONNECT:1520,UNABLE_TO_FORCE_UNPUBLISH:1530,PUBLISHER_ICE_WORKFLOW_FAILED:1553,SUBSCRIBER_ICE_WORKFLOW_FAILED:1554,UNEXPECTED_SERVER_RESPONSE:2001},t.ExceptionEvent=function(e,n,i,o,r,s){t.Event.call(this,e),this.message=n,this.title=i,this.code=o,this.component=r,this.target=s},t.IssueReportedEvent=function(e,n){t.Event.call(this,e),this.issueId=n},t.EnvLoadedEvent=function(e){t.Event.call(this,e)};var e=!1;t.ConnectionEvent=function(n,i,o){t.Event.call(this,n,!1),t.$.canDefineProperty?Object.defineProperty(this,"connections",{get:function(){return e||(t.warn("OT.ConnectionEvent connections property is deprecated, use connection instead."),e=!0),[i]}}):this.connections=[i],this.connection=i,this.reason=o};var n=!1;t.StreamEvent=function(e,i,o,r){t.Event.call(this,e,r),t.$.canDefineProperty?Object.defineProperty(this,"streams",{get:function(){return n||(t.warn("OT.StreamEvent streams property is deprecated, use stream instead."),n=!0),[i]}}):this.streams=[i],this.stream=i,this.reason=o};var i=!1,o=!1,r=!1;t.SessionConnectEvent=function(e){t.Event.call(this,e,!1),t.$.canDefineProperty?Object.defineProperties(this,{connections:{get:function(){return i||(t.warn("OT.SessionConnectedEvent no longer includes connections. Listen for connectionCreated events instead."),i=!0),[]}},streams:{get:function(){return o||(t.warn("OT.SessionConnectedEvent no longer includes streams. Listen for streamCreated events instead."),i=!0),[]}},archives:{get:function(){return r||(t.warn("OT.SessionConnectedEvent no longer includes archives. Listen for archiveStarted events instead."),r=!0),[]}}}):(this.connections=[],this.streams=[],this.archives=[])},t.SessionDisconnectEvent=function(e,n,i){t.Event.call(this,e,i),this.reason=n},t.StreamPropertyChangedEvent=function(e,n,i,o,r){t.Event.call(this,e,!1),this.type=e,this.stream=n,this.changedProperty=i,this.oldValue=o,this.newValue=r},t.VideoDimensionsChangedEvent=function(e,n,i){t.Event.call(this,"videoDimensionsChanged",!1),this.type="videoDimensionsChanged",this.target=e,this.oldValue=n,this.newValue=i},t.ArchiveEvent=function(e,n){t.Event.call(this,e,!1),this.type=e,this.id=n.id,this.name=n.name,this.status=n.status,this.archive=n},t.ArchiveUpdatedEvent=function(e,n,i,o){t.Event.call(this,"updated",!1),this.target=e,this.changedProperty=n,this.oldValue=i,this.newValue=o},t.SignalEvent=function(e,n,i){t.Event.call(this,e?"signal:"+e:t.Event.names.SIGNAL,!1),this.data=n,this.from=i},t.StreamUpdatedEvent=function(e,n,i,o){t.Event.call(this,"updated",!1),this.target=e,this.changedProperty=n,this.oldValue=i,this.newValue=o},t.DestroyedEvent=function(e,n,i){t.Event.call(this,e,!1),this.target=n,this.reason=i},t.VideoEnabledChangedEvent=function(e,n){t.Event.call(this,e,!1),this.reason=n.reason},t.VideoDisableWarningEvent=function(e){t.Event.call(this,e,!1)},t.AudioLevelUpdatedEvent=function(e){t.Event.call(this,t.Event.names.AUDIO_LEVEL_UPDATED,!1),this.audioLevel=e},t.MediaStoppedEvent=function(e){t.Event.call(this,t.Event.names.MEDIA_STOPPED,!0),this.target=e}}(e);var O={},R={};t.registerScreenSharingExtensionHelper=function(e,n){R[e]=n,n.autoRegisters&&n.isSupportedInThisBrowser&&t.registerScreenSharingExtension(e)},t.registerScreenSharingExtension=function(e){var t=Array.prototype.slice.call(arguments,1);if(null==R[e])throw new Error("Unsupported kind passed to OT.registerScreenSharingExtension");var n=R[e].register.apply(R[e],t);O[e]=n};var P=function(){var e=t.$.find(t.$.keys(R),function(e){return R[e].isSupportedInThisBrowser});return void 0===e?{}:{name:e,proto:R[e],instance:O[e]}};t.pickScreenSharingHelper=function(){return P()},t.checkScreenSharingCapability=function(e){var t={supported:!1,extensionRequired:void 0,extensionRegistered:void 0,extensionInstalled:void 0,supportedSources:{}},n=P();return void 0===n.name?void setTimeout(e.bind(null,t)):(t.supported=!0,t.extensionRequired=n.proto.extensionRequired?n.name:void 0,t.supportedSources={screen:n.proto.sources.screen,application:n.proto.sources.application,window:n.proto.sources.window,browser:n.proto.sources.browser},n.instance?(t.extensionRegistered=t.extensionRequired?!0:void 0,void n.instance.isInstalled(function(n){t.extensionInstalled=t.extensionRequired?n:void 0,e(t)})):(t.extensionRegistered=!1,t.extensionRequired&&(t.extensionInstalled=!1),void setTimeout(e.bind(null,t))))},t.registerScreenSharingExtensionHelper("firefox",{isSupportedInThisBrowser:"Firefox"===t.$.env.name,autoRegisters:!0,extensionRequired:!1,getConstraintsShowsPermissionUI:!1,sources:{screen:!0,application:"Firefox"===t.$.env.name&&t.$.env.version>=34,window:"Firefox"===t.$.env.name&&t.$.env.version>=34,browser:"Firefox"===t.$.env.name&&t.$.env.version>=38},register:function(){return{isInstalled:function(e){e(!0)},getConstraints:function(e,t,n){t.video={mediaSource:e},t.browserWindow&&(t.video.browserWindow=t.browserWindow,delete t.browserWindow),"undefined"!=typeof t.scrollWithPage&&(t.video.scrollWithPage=t.scrollWithPage,delete t.scrollWithPage),n(void 0,t)}}}}),t.registerScreenSharingExtensionHelper("chrome",{isSupportedInThisBrowser:!!navigator.webkitGetUserMedia&&"undefined"!=typeof chrome,autoRegisters:!1,extensionRequired:!0,getConstraintsShowsPermissionUI:!0,sources:{screen:!0,application:!1,window:!1,browser:!1},register:function(n){if(!n)throw new Error("initChromeScreenSharingExtensionHelper: extensionID is required.");var i=!!navigator.webkitGetUserMedia&&"undefined"!=typeof chrome,o={},r=void 0,s="com.tokbox.screenSharing."+n,a=function(e,t){var n={payload:t,from:"jsapi"};return n[s]=e,n},l=function(e,n){var i,r=t.$.uuid();return o[r]=function(){clearTimeout(i),i=null,e.apply(null,arguments)},n&&(i=setTimeout(function(){delete o[r],e(new Error("Timeout waiting for response to request."))},n)),r},c=function(t){if(!t)throw new Error("isAvailable: callback is required.");if(i||setTimeout(t.bind(null,!1)),void 0!==r)setTimeout(t.bind(null,r));else{var n=l(function(e,n){r!==!0&&(r="extensionLoaded"===n),t(r)},2e3),o=a("isExtensionInstalled",{requestId:n});e.postMessage(o,"*")}},u=function(t,n,i){if(!i)throw new Error("getSourceId: callback is required");c(function(o){if(o){var r=l(function(e,t,o){"permissionDenied"===t?i(new Error("PermissionDeniedError")):(n.video||(n.video={}),n.video.mandatory||(n.video.mandatory={}),n.video.mandatory.chromeMediaSource="desktop",n.video.mandatory.chromeMediaSourceId=o.sourceId,i(void 0,n))});e.postMessage(a("getSourceId",{requestId:r,source:t}),"*")}else i(new Error("Extension is not installed"))})};return e.addEventListener("message",function(t){if(t.origin===e.location.origin&&null!=t.data&&"object"==typeof t.data&&"extension"===t.data.from){var n=t.data[s],i=t.data.payload;if(i&&i.requestId){var a=o[i.requestId];delete o[i.requestId],a&&a(null,n,i)}"extensionLoaded"===n&&(r=!0)}}),{isInstalled:c,getConstraints:u}}}),t.StreamChannel=function(e){this.id=e.id,this.type=e.type,this.active=t.$.castToBoolean(e.active),this.orientation=e.orientation||t.VideoOrientation.ROTATED_NORMAL,e.frameRate&&(this.frameRate=parseFloat(e.frameRate,10)),this.width=parseInt(e.width,10),this.height=parseInt(e.height,10),this.source=e.source||"camera",this.fitMode=e.fitMode||"cover",t.$.eventing(this,!0),this.update=function(e){var n={},i={};for(var o in e)if(e.hasOwnProperty(o)){var r=this[o];switch(o){case"active":this.active=t.$.castToBoolean(e[o]);break;case"disableWarning":this.disableWarning=t.$.castToBoolean(e[o]);break;case"frameRate":this.frameRate=parseFloat(e[o],10);break;case"width":case"height":this[o]=parseInt(e[o],10),n[o]=this[o],i[o]=r;break;case"orientation":this[o]=e[o],n[o]=this[o],i[o]=r;break;case"fitMode":this[o]=e[o];break;case"source":this[o]=e[o];break;default:return void t.warn("Tried to update unknown key "+o+" on "+this.type+" channel "+this.id)}this.trigger("update",this,o,r,this[o])}return t.$.keys(n).length&&this.trigger("update",this,"videoDimensions",i,n),!0}},!function(){var e=["name","archiving"];t.Stream=function(n,i,o,r,s,a){var l;this.id=this.streamId=n,this.name=i,this.creationTime=Number(o),this.connection=r,this.channel=a,this.publisher=t.publishers.find({streamId:this.id}),t.$.eventing(this);var c=t.$.bind(function(e,n,i,o){var r=n;switch(r){case"active":r="audio"===e.type?"hasAudio":"hasVideo",this[r]=o;break;case"disableWarning":if(r="audio"===e.type?"audioDisableWarning":"videoDisableWarning",this[r]=o,!this["audio"===e.type?"hasAudio":"hasVideo"])return;break;case"fitMode":r="defaultFitMode",this[r]=o;break;case"source":r="audio"===e.type?"audioType":"videoType",this[r]=o;break;case"orientation":case"width":case"height":return void(this.videoDimensions={width:e.width,height:e.height,orientation:e.orientation})}this.dispatchEvent(new t.StreamUpdatedEvent(this,r,i,o))},this),u=t.$.bind(function(){return this.publisher?this.publisher:t.subscribers.find(function(e){return e.stream.id===this.id&&e.session.id===s.id})},this);this.getChannelsOfType=function(e){return t.$.filter(this.channel,function(t){return t.type===e})},this.getChannel=function(e){for(var t=0;t<this.channel.length;++t)if(this.channel[t].id===e)return this.channel[t];return null};var d=this.getChannelsOfType("audio")[0],h=this.getChannelsOfType("video")[0];this.hasAudio=null!=d&&d.active,this.hasVideo=null!=h&&h.active,this.videoType=h&&h.source,this.defaultFitMode=h&&h.fitMode,this.videoDimensions={},h&&(this.videoDimensions.width=h.width,this.videoDimensions.height=h.height,this.videoDimensions.orientation=h.orientation,h.on("update",c),this.frameRate=h.frameRate),d&&d.on("update",c),this.setChannelActiveState=function(e,t,n){var i={active:t};n&&(i.activeReason=n),p(e,i)},this.setVideoDimensions=function(e,t){p("video",{width:e,height:t,orientation:0})},this.setRestrictFrameRate=function(e){p("video",{restrictFrameRate:e})};var p=t.$.bind(function(e,n){var i;if(this.publisher)i=function(e){s._.streamChannelUpdate(this,e,n)};else{var o=t.subscribers.find(function(e){return e.stream&&e.stream.id===this.id&&e.session.id===s.id},this);i=function(e){s._.subscriberChannelUpdate(this,o,e,n)}}t.$.forEach(this.getChannelsOfType(e),t.$.bind(i,this))},this);this.destroyed=!1,this.destroyedReason=void 0,this.destroy=function(e,n){l=e||"clientDisconnected",this.destroyed=!0,this.destroyedReason=l,n!==!0&&this.dispatchEvent(new t.DestroyedEvent("destroyed",this,l))},this._={},this._.updateProperty=t.$.bind(function(n,i){if(-1===t.$.arrayIndexOf(e,n))return void t.warn('Unknown stream property "'+n+'" was modified to "'+i+'".');var o=this[n],r=i;switch(n){case"name":this[n]=r;break;case"archiving":var s=u();s&&s._.archivingStatus(r),this[n]=r}var a=new t.StreamUpdatedEvent(this,n,o,r);this.dispatchEvent(a)},this),this._.update=t.$.bind(function(e){for(var t in e)e.hasOwnProperty(t)&&this._.updateProperty(t,e[t])},this),this._.updateChannel=t.$.bind(function(e,t){this.getChannel(e).update(t)},this)}}(e),!function(){var e,n,i;t.SessionInfo=function(e){var n=e[0];t.log("SessionInfo Response:"),t.log(e),this.sessionId=n.session_id,this.partnerId=n.partner_id,this.sessionStatus=n.session_status,this.messagingServer=n.messaging_server_url,this.messagingURL=n.messaging_url,this.symphonyAddress=n.symphony_address,this.p2pEnabled=!!(n.properties&&n.properties.p2p&&n.properties.p2p.preference&&"enabled"===n.properties.p2p.preference.value)},t.SessionInfo.get=function(o,r,s){var a,l=t.properties.apiURL+"/session/"+o.id+"?extended=true",c=t.$.now(),u=function(a){o.logEvent("Instrumentation",null,"gsi",t.$.now()-c);var l=e(a);l===!1?n(o,r,a):i(o,s,l,JSON.stringify(a))};"IE"===t.$.env.name&&t.$.env.version<10?(l=l+"&format=json&token="+encodeURIComponent(o.token)+"&version=1&cache="+t.$.uuid(),a={xdomainrequest:!0}):a={headers:{"X-TB-TOKEN-AUTH":o.token,"X-TB-VERSION":1}},o.logEvent("SessionInfo","Attempt"),t.$.getJSON(l,a,function(e,n){if(e){var r=n;i(o,s,new t.Error(e.target&&e.target.status||e.code,e.message||"Could not connect to the OpenTok API Server."),r)}else u(n)})};var o={};o[404]=t.ExceptionCodes.INVALID_SESSION_ID,o[409]=t.ExceptionCodes.TERMS_OF_SERVICE_FAILURE,o[400]=t.ExceptionCodes.INVALID_SESSION_ID,o[403]=t.ExceptionCodes.AUTHENTICATION_ERROR,e=function(e){if(t.$.isArray(e)){var n=t.$.filter(e,function(e){return null!=e.error}),i=n.length;if(0===i)return!1;var r,s=n[0].error.code;return o[s.toString()]?(s=o[s],r=n[0].error.errorMessage&&n[0].error.errorMessage.message):(s=t.ErrorCodes.UNEXPECTED_SERVER_RESPONSE,r="Unexpected server response. Try this operation again later."),{code:s,message:r}}return{code:null,message:"Unknown error: getSessionInfo JSON response was badly formed"}},n=function(e,n,i){e.logEvent("SessionInfo","Success",{messagingServer:i[0].messaging_server_url}),n(new t.SessionInfo(i))},i=function(e,t,n,i){
var o={reason:"GetSessionInfo",code:n.code||"No code",message:n.message+":"+(i||"Empty responseText from API server")};e.logConnectivityEvent("Failure",o),t(n,e)}}(e),!function(){function e(e,i,o,r){var s=n[o],a=r?t.$.clone(r):{};t.error("OT.exception :: title: "+s+" ("+o+") msg: "+i),a.partnerId||(a.partnerId=t.APIKEY);try{t.analytics.logError(o,"tb.exception",s,{details:i},a),t.dispatchEvent(new t.ExceptionEvent(t.Event.names.EXCEPTION,i,s,o,e,e))}catch(l){t.error("OT.exception :: Failed to dispatch exception - "+l.toString())}}t.Error=function(e,t){this.code=e,this.message=t};var n={1004:"Authentication error",1005:"Invalid Session ID",1006:"Connect Failed",1007:"Connect Rejected",1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Connection Failed",1014:"API Response Failure",1015:"Session connected, cannot test network",1021:"Request Timeout",1026:"Terms of Service Violation: Export Compliance",1500:"Unable to Publish",1503:"No TURN server found",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1553:"ICEWorkflow failed",1600:"createOffer, createAnswer, setLocalDescription, setRemoteDescription",2e3:"Internal Error",2001:"Unexpected Server Response",4e3:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"};t.getErrorTitleByCode=function(e){return n[+e]},t.handleJsException=function(t,n,i){i=i||{};var o,r=i.session;r?(o={sessionId:r.sessionId},r.isConnected()&&(o.connectionId=r.connection.connectionId),i.target||(i.target=r)):i.sessionId&&(o={sessionId:i.sessionId},i.target||(i.target=null)),e(i.target,t,n,o)},t.dispatchError=function(e,n,i,o){t.error(e,n),i&&t.$.isFunction(i)&&i.call(null,new t.Error(e,n)),t.handleJsException(n,e,{session:o})}}(e),!function(){function e(){var e=!1,n=OTPlugin.isSupported(),i=n?OTPlugin.isReady():!0,o=function(){return!t.$.isDOMUnloaded()&&t.$.isReady()&&e&&i},r=function(){o()&&t.dispatchEvent(new t.EnvLoadedEvent(t.Event.names.ENV_LOADED))},s=function(){t.$.onDOMUnload(a),t.Config.load(t.properties.configURL),r()},a=function(){t.dispatchEvent(new t.EnvLoadedEvent(t.Event.names.ENV_UNLOADED))},l=function(e){i=!0,e&&t.debug("TB Plugin failed to load or was not installed"),r()},c=function(){e=!0,t.Config.off("dynamicConfigChanged",c),t.Config.off("dynamicConfigLoadFailed",u),r()},u=function(){c()};t.Config.on("dynamicConfigChanged",c),t.Config.on("dynamicConfigLoadFailed",u),t.$.onDOMLoad(s),n&&OTPlugin.ready(l),this.onLoad=function(e,n){return o()?void e.call(n):void t.on(t.Event.names.ENV_LOADED,e,n)},this.onUnload=function(e,n){return this.isUnloaded()?void e.call(n):void t.on(t.Event.names.ENV_UNLOADED,e,n)},this.isUnloaded=function(){return t.$.isDOMUnloaded()}}var n=new e;t.onLoad=function(e,t){n.onLoad(e,t)},t.onUnload=function(e,t){n.onUnload(e,t)},t.isUnloaded=function(){return n.isUnloaded()}}();var N,L=document.location.hash;t.HAS_REQUIREMENTS=1,t.NOT_HAS_REQUIREMENTS=0,t.checkSystemRequirements=function(){t.debug("OT.checkSystemRequirements()");var e=t.$.hasCapabilities("websockets","webrtc")||OTPlugin.isInstalled();return e=e?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS,t.checkSystemRequirements=function(){return t.debug("OT.checkSystemRequirements()"),e},e===this.NOT_HAS_REQUIREMENTS&&t.analytics.logEvent({action:"checkSystemRequirements",variation:"notHasRequirements",partnerId:t.APIKEY,payload:{userAgent:t.$.env.userAgent}}),e},t.upgradeSystemRequirements=function(){t.onLoad(function(){if(OTPlugin.isSupported())return void t.Dialogs.Plugin.promptToInstall().on({download:function(){e.location=OTPlugin.pathToInstaller()},refresh:function(){location.reload()},closed:function(){}});var n="_upgradeFlash";document.body.appendChild(function(){var e=document.createElement("iframe");e.id=n,e.style.position="absolute",e.style.position="fixed",e.style.height="100%",e.style.width="100%",e.style.top="0px",e.style.left="0px",e.style.right="0px",e.style.bottom="0px",e.style.zIndex=1e3;try{e.style.backgroundColor="rgba(0,0,0,0.2)"}catch(i){e.style.backgroundColor="transparent",e.setAttribute("allowTransparency","true")}e.setAttribute("frameBorder","0"),e.frameBorder="0",e.scrolling="no",e.setAttribute("scrolling","no");var o=t.properties.minimumVersion[t.$.env.name.toLowerCase()],r=o>t.$.env.version;return e.src=t.properties.assetURL+"/html/upgrade.html#"+encodeURIComponent(r?"true":"false")+","+encodeURIComponent(JSON.stringify(t.properties.minimumVersion))+"|"+encodeURIComponent(document.location.href),e}()),N&&clearInterval(N),N=setInterval(function(){var e=document.location.hash,t=/^#?\d+&/;e!==L&&t.test(e)&&(L=e,"close_window"===e.replace(t,"")&&(document.body.removeChild(document.getElementById(n)),document.location.hash=""))},100)})},t.ConnectionCapabilities=function(e){var n=function(e){return e.supportsWebRTC=t.$.castToBoolean(e.supportsWebRTC),e},i=n(e);this.supportsWebRTC=i.supportsWebRTC},t.Capabilities=function(e){this.publish=-1!==t.$.arrayIndexOf(e,"publish")?1:0,this.subscribe=-1!==t.$.arrayIndexOf(e,"subscribe")?1:0,this.forceUnpublish=-1!==t.$.arrayIndexOf(e,"forceunpublish")?1:0,this.forceDisconnect=-1!==t.$.arrayIndexOf(e,"forcedisconnect")?1:0,this.supportsWebRTC=t.$.hasCapabilities("webrtc")?1:0,this.permittedTo=function(e){return this.hasOwnProperty(e)&&1===this[e]}},t.Connection=function(e,n,i,o,r){var s;this.id=this.connectionId=e,this.creationTime=n?Number(n):null,this.data=i,this.capabilities=new t.ConnectionCapabilities(o),this.permissions=new t.Capabilities(r),this.quality=null,t.$.eventing(this),this.destroy=t.$.bind(function(e,n){s=e||"clientDisconnected",n!==!0&&this.dispatchEvent(new t.DestroyedEvent("destroyed",this,s))},this),this.destroyed=function(){return void 0!==s},this.destroyedReason=function(){return s}},t.Connection.fromHash=function(e){return new t.Connection(e.id,e.creationTime,e.data,t.$.extend(e.capablities||{},{supportsWebRTC:!0}),e.permissions||[])},!function(){var e=8192,n=128;t.Signal=function(i,o,r){var s=function(e){return!/^[a-zA-Z0-9\-\._~]+$/.exec(e)},a=function(e){return e?e instanceof t.Connection||e instanceof t.Session?null:{code:400,reason:"The To field was invalid"}:{code:400,reason:"The signal to field was invalid. Either set it to a OT.Connection, OT.Session, or omit it entirely"}},l=function(e){var t=null;return null===e||void 0===e?t={code:400,reason:"The signal type was null or undefined. Either set it to a String value or omit it"}:e.length>n?t={code:413,reason:"The signal type was too long, the maximum length of it is "+n+" characters"}:s(e)&&(t={code:400,reason:"The signal type was invalid, it can only contain letters, numbers, '-', '_', and '~'."}),t},c=function(t){var n=null;if(null===t||void 0===t)n={code:400,reason:"The signal data was null or undefined. Either set it to a String value or omit it"};else try{JSON.stringify(t).length>e&&(n={code:413,reason:"The data field was too long, the maximum size of it is "+e+" characters"})}catch(i){n={code:400,reason:"The data field was not valid JSON"}}return n};this.toRaptorMessage=function(){var e=this.to;return e&&"string"!=typeof e&&(e=e.id),t.Raptor.Message.signals.create(t.APIKEY,i,e,this.type,this.data)},this.toHash=function(){return r},this.error=null,r&&(r.hasOwnProperty("data")&&(this.data=t.$.clone(r.data),this.error=c(this.data)),r.hasOwnProperty("to")&&(this.to=r.to,this.error||(this.error=a(this.to))),r.hasOwnProperty("type")&&(this.error||(this.error=l(r.type)),this.type=r.type)),this.valid=null===this.error}}(this),t.Raptor.Socket=function(e,n,i,o,r){var s,a,l,c,u,h=["disconnected","connecting","connected","error","disconnecting"],p=t.$.statable(this,h,"disconnected"),f=function(e){p(e?"error":"connected"),u.apply(null,arguments)},g=t.$.bind(function(e){var t="clientDisconnected";!this.is("disconnecting")&&l.is("error")&&(t="networkDisconnected"),e&&4001===e.code&&(t="networkTimedout"),p("disconnected"),c.onClose(t)},this),m=function(){};this.connect=function(n,r,d){if(!this.is("disconnected","error"))return void t.warn("Cannot connect the Raptor Socket as it is currently connected. You should disconnect first.");p("connecting"),s=r.sessionId,a=n,u=d;var h="/v2/partner/"+t.APIKEY+"/session/"+s;l=new t.Rumor.Socket(i,o),l.onClose(g),l.onMessage(t.$.bind(c.dispatch,c)),l.connect(e,t.$.bind(function(n){if(n)return void f({reason:"WebSocketConnection",code:n.code,message:n.message});l.onError(m),t.debug("Raptor Socket connected. Subscribing to "+h+" on "+i),l.subscribe([h]);var o=t.Raptor.Message.connections.create(t.APIKEY,s,l.id());this.publish(o,{"X-TB-TOKEN-AUTH":a},t.$.bind(function(n){if(n){var i,o,r=[400,403,409];n.code===t.ExceptionCodes.CONNECT_FAILED?(i=n.code,o=t.getErrorTitleByCode(n.code)):n.code&&t.$.arrayIndexOf(r,n.code)>-1?(i=t.ExceptionCodes.CONNECT_FAILED,o="Received error response to connection create message."):(i=t.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,o="Unexpected server response. Try this operation again later."),n.message="ConnectToSession:"+n.code+":Received error response to connection create message.";var a={reason:"ConnectToSession",code:i,message:o},l={action:"Connect",variation:"Failure",payload:a,sessionId:s,partnerId:t.APIKEY,connectionId:e};return t.analytics.logEvent(l),void f(a)}this.publish(t.Raptor.Message.sessions.get(t.APIKEY,s),function(n){if(n){var i,o,r=[400,403,409];n.code&&t.$.arrayIndexOf(r,n.code)>-1?(i=t.ExceptionCodes.CONNECT_FAILED,o="Received error response to session read"):(i=t.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,o="Unexpected server response. Try this operation again later.");var a={reason:"GetSessionState",code:n.code,message:o},l={action:"Connect",variation:"Failure",payload:a,sessionId:s,partnerId:t.APIKEY,connectionId:e};t.analytics.logEvent(l),f(a)}else f.apply(null,arguments)})},this))},this))},this.disconnect=function(e){this.is("disconnected")||(p("disconnecting"),l.disconnect(e))},this.publish=function(e,n,i){if(l.isNot("connected"))return void t.error("OT.Raptor.Socket: cannot publish until the socket is connected."+e);var r,s=t.$.uuid(),a={};return n&&(t.$.isFunction(n)?(a={},r=n):a=n),!r&&i&&t.$.isFunction(i)&&(r=i),r&&c.registerCallback(s,r),t.debug("OT.Raptor.Socket Publish (ID:"+s+") "),t.debug(e),l.publish([o],e,t.$.extend(a,{"Content-Type":"application/x-raptor+v2","TRANSACTION-ID":s,"X-TB-FROM-ADDRESS":l.id()})),s},this.streamCreate=function(e,n,i,o,r,a,l){var c=t.Raptor.Message.streams.create(t.APIKEY,s,n,e,i,o,r,a);this.publish(c,function(e,t){l(e,n,t)})},this.streamDestroy=function(e){this.publish(t.Raptor.Message.streams.destroy(t.APIKEY,s,e))},this.streamChannelUpdate=function(e,n,i){this.publish(t.Raptor.Message.streamChannels.update(t.APIKEY,s,e,n,i))},this.subscriberCreate=function(e,n,i,o){this.publish(t.Raptor.Message.subscribers.create(t.APIKEY,s,e,n,l.id(),i),o)},this.subscriberDestroy=function(e,n){this.publish(t.Raptor.Message.subscribers.destroy(t.APIKEY,s,e,n))},this.subscriberUpdate=function(e,n,i){this.publish(t.Raptor.Message.subscribers.update(t.APIKEY,s,e,n,i))},this.subscriberChannelUpdate=function(e,n,i,o){this.publish(t.Raptor.Message.subscriberChannels.update(t.APIKEY,s,e,n,i,o))},this.forceDisconnect=function(e,n){this.publish(t.Raptor.Message.connections.destroy(t.APIKEY,s,e),n)},this.forceUnpublish=function(e,n){this.publish(t.Raptor.Message.streams.destroy(t.APIKEY,s,e),n)},this.jsepCandidate=function(e,n){this.publish(t.Raptor.Message.streams.candidate(t.APIKEY,s,e,n))},this.jsepCandidateP2p=function(e,n,i){this.publish(t.Raptor.Message.subscribers.candidate(t.APIKEY,s,e,n,i))},this.jsepOffer=function(e,n){this.publish(t.Raptor.Message.offer(e,n))},this.jsepAnswer=function(e,n){this.publish(t.Raptor.Message.streams.answer(t.APIKEY,s,e,n))},this.jsepAnswerP2p=function(e,n,i){this.publish(t.Raptor.Message.subscribers.answer(t.APIKEY,s,e,n,i))},this.signal=function(e,n,i){var o=new t.Signal(s,l.id(),e||{});return o.valid?void this.publish(o.toRaptorMessage(),function(e){var r,s,a,l=[400,403,404,413];if(e)e.code&&t.$.arrayIndexOf(l,r.code)>-1?(s=e.code,a=e.message):(s=t.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,a="Unexpected server response. Try this operation again later."),r=new t.SignalError(s,a);else{var c=o.data?typeof o.data:null;i("signal","send",{type:c})}n&&t.$.isFunction(n)&&n(r,o.toHash())}):void(n&&t.$.isFunction(n)&&n(new d(o.error.code,o.error.reason),o.toHash()))},this.id=function(){return l&&l.id()},null==r&&(r=new t.Raptor.Dispatcher),c=r},t.GetStatsAudioLevelSampler=function(e){if(!t.$.hasCapabilities("audioOutputLevelStat"))throw new Error("The current platform does not provide the required capabilities");var n=e,i="audioOutputLevel";this.sample=function(e){n.getStats(function(t,n){if(!t)for(var o=0;o<n.length;o++){var r=n[o],s=parseFloat(r[i]);if(!isNaN(s))return void e(s/32768)}e(null)})}},t.AnalyserAudioLevelSampler=function(e){var n=this,i=null,o=null,r=null,s=function(t){var n=e.createMediaStreamSource(t),i=e.createAnalyser();return n.connect(i),i};t.$.defineProperties(n,{webRTCStream:{get:function(){return r},set:function(e){r=e,i=s(r),o=new Uint8Array(i.frequencyBinCount)}}}),this.sample=function(e){if(i){i.getByteTimeDomainData(o);for(var t=0,n=0;n<o.length;n++)t=Math.max(t,Math.abs(o[n]-128));e(t/128)}else e(null)}},t.AudioLevelTransformer=function(){var e=null;this.transform=function(t){e=null===e||t>=e?t:.3*t+.7*e;var n=Math.log(e)/Math.LN10/1.5+1;return Math.min(Math.max(n,0),1)}},t.audioContext=function(){var n=new e.AudioContext;return t.audioContext=function(){return n},n},t.Archive=function(e,n,i){this.id=e,this.name=n,this.status=i,this._={},t.$.eventing(this),this._.update=t.$.bind(function(e){for(var n in e)if(e.hasOwnProperty(n)){var i=this[n];this[n]=e[n];var o=new t.ArchiveUpdatedEvent(this,n,i,this[n]);this.dispatchEvent(o)}},this),this.destroy=function(){}},t.analytics=new t.Analytics(t.properties.loggingURL),t.Subscriber=function(e,n,i){var o,r,s,a,l,c,u,d,h,p,f,g,m,v,b,y=t.$.uuid(),w=e||y,C=n.session,_=n.stream,x=100,S=t.$.hasCapabilities("audioOutputLevelStat")||t.$.hasCapabilities("webAudioCapableRemoteStream"),k=!1,T=this;if(h=t.$.defaults({},n,{showControls:!0,fitMode:_.defaultFitMode||"cover"}),this.id=w,this.widgetId=y,this.session=C,this.stream=_=h.stream,this.streamId=_.id,f={timeStamp:t.$.now()},!C)return void t.handleJsException("Subscriber must be passed a session option",2e3,{session:C,target:this});t.$.eventing(this,!1),"function"==typeof i&&this.once("subscribeComplete",i),S&&this.on({"audioLevelUpdated:added":function(e){1===e&&v&&v.start()},"audioLevelUpdated:removed":function(e){0===e&&v&&v.stop()}});var $=function(e,n,i,o){var r=[{action:e,variation:n,payload:i,streamId:_?_.id:null,sessionId:C?C.sessionId:null,connectionId:C&&C.isConnected()?C.connection.connectionId:null,partnerId:C&&C.isConnected()?C.sessionInfo.partnerId:null,subscriberId:y}];o&&r.push(o),t.analytics.logEvent.apply(t.analytics,r)},E=function(e,n){"Attempt"!==e&&b||(b=new t.ConnectivityAttemptPinger({action:"Subscribe",sessionId:C?C.sessionId:null,connectionId:C&&C.isConnected()?C.connection.connectionId:null,partnerId:C.isConnected()?C.sessionInfo.partnerId:null,streamId:_?_.id:null})),b.setVariation(e),$("Subscribe",e,n)},D=t.$.bind(function(e){var n={streamType:"WebRTC",width:o?Number(t.$.width(o.domElement).replace("px","")):null,height:o?Number(t.$.height(o.domElement).replace("px","")):null,sessionId:C?C.sessionId:null,connectionId:C?C.connection.connectionId:null,mediaServerName:C?C.sessionInfo.messagingServer:null,p2pFlag:C?C.sessionInfo.p2pEnabled:!1,partnerId:C?C.apiKey:null,streamId:_.id,subscriberId:y,version:t.properties.version,duration:parseInt(t.$.now()-u,10),remoteConnectionId:_.connection.connectionId};t.analytics.logQOS(t.$.extend(n,e)),this.trigger("qos",e)},this),I=function(e){t.error("Subscriber State Change Failed: ",e.message),t.debug(e)},M=function(){if(!p.isSubscribing()&&r){t.debug("OT.Subscriber.onLoaded"),p.set("Subscribing"),u=t.$.now();var e={pcc:parseInt(u-d,10),hasRelayCandidates:c&&c.hasRelayCandidates()};$("createPeerConnection","Success",e),o.loading(!1),s.showAfterLoading(),k&&_.setRestrictFrameRate(!0),a&&"auto"===T.getStyle("audioLevelDisplayMode")&&a[o.audioOnly()?"show":"hide"](),this.trigger("subscribeComplete",null,this),this.trigger("loaded",this),E("Success",{streamId:_.id})}},A=function(){t.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection"),p.isAttemptingToSubscribe()?(p.set("Failed"),this.trigger("subscribeComplete",new t.Error(null,"ClientDisconnected"))):p.isSubscribing()&&p.set("Failed"),this.disconnect()},O=t.$.bind(function(e,n,i,o){var r;p.isAttemptingToSubscribe()?(r={reason:o?o:"PeerConnectionError",message:"Subscriber PeerConnection Error: "+n,hasRelayCandidates:c&&c.hasRelayCandidates()},$("createPeerConnection","Failure",r),p.set("Failed"),this.trigger("subscribeComplete",new t.Error(null,n))):p.isSubscribing()&&(p.set("Failed"),this.trigger("error",n)),this.disconnect();var s;s="ICEWorkflow"===o?t.ExceptionCodes.SUBSCRIBER_ICE_WORKFLOW_FAILED:t.ExceptionCodes.P2P_CONNECTION_FAILED,r={reason:o?o:"PeerConnectionError",message:"Subscriber PeerConnection Error: "+n,code:s},E("Failure",r),t.handleJsException("Subscriber PeerConnection Error: "+n,s,{session:C,target:this}),H.call(this,n)},this),R=function(e){t.debug("OT.Subscriber.onRemoteStreamAdded"),p.set("BindingRemoteStream"),this.subscribeToAudio(h.subscribeToAudio),g="loading",this.subscribeToVideo(h.subscribeToVideo,"loading");var n={error:O,audioVolume:x},i=e.getVideoTracks();i.length>0&&t.$.forEach(i,function(e){e.setEnabled(_.hasVideo&&h.subscribeToVideo)}),r=o.bindVideo(e,n,t.$.bind(function(e){return e?void O(null,e.message||e,c,"VideoElement"):(r&&r.orientation({width:_.videoDimensions.width,height:_.videoDimensions.height,videoOrientation:_.videoDimensions.orientation}),void M.call(this,null))},this)),t.$.hasCapabilities("webAudioCapableRemoteStream")&&m&&e.getAudioTracks().length>0&&m.webRTCStream(e),$("createPeerConnection","StreamAdded"),this.trigger("streamAdded",this)},P=function(e){t.debug("OT.Subscriber.onStreamRemoved"),r.stream===e&&(r.destroy(),r=null),this.trigger("streamRemoved",this)},N=function(){this.disconnect()},L=function(e){switch(e.changedProperty){case"videoDimensions":if(!r)break;r.orientation({width:e.newValue.width,height:e.newValue.height,videoOrientation:e.newValue.orientation}),this.dispatchEvent(new t.VideoDimensionsChangedEvent(this,e.oldValue,e.newValue));break;case"videoDisableWarning":s.videoDisabledIndicator.setWarning(e.newValue),this.dispatchEvent(new t.VideoDisableWarningEvent(e.newValue?"videoDisableWarning":"videoDisableWarningLifted"));break;case"hasVideo":W(!(_.hasVideo&&h.subscribeToVideo)),this.dispatchEvent(new t.VideoEnabledChangedEvent(_.hasVideo?"videoEnabled":"videoDisabled",{reason:"publishVideo"}));break;case"hasAudio":}},F=function(e){if(e===!1)return"off";var t=this.getStyle("buttonDisplayMode");return t===!1?"on":t},U=function(e,t){if(s)switch(e){case"nameDisplayMode":s.name.setDisplayMode(t),s.backingBar.setNameMode(t);break;case"videoDisabledDisplayMode":s.videoDisabledIndicator.setDisplayMode(t);break;case"showArchiveStatus":s.archive.setShowArchiveStatus(t);break;case"buttonDisplayMode":s.muteButton.setDisplayMode(t),s.backingBar.setMuteMode(t);break;case"audioLevelDisplayMode":s.audioLevel.setDisplayMode(t);break;case"bugDisplayMode":case"backgroundImageURI":o.setBackgroundImageURI(t)}},j=function(){var e={backingBar:new t.Chrome.BackingBar({nameMode:h.name?this.getStyle("nameDisplayMode"):"off",muteMode:F.call(this,this.getStyle("showMuteButton"))}),name:new t.Chrome.NamePanel({name:h.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new t.Chrome.MuteButton({muted:h.muted,mode:F.call(this,this.getStyle("showMuteButton"))}),archive:new t.Chrome.Archiving({show:this.getStyle("showArchiveStatus"),archiving:!1})};if(S){var n=new t.AudioLevelTransformer,i=function(e){a.setValue(n.transform(e.audioLevel))};a=new t.Chrome.AudioLevelMeter({mode:this.getStyle("audioLevelDisplayMode"),onActivate:function(){T.on("audioLevelUpdated",i)},onPassivate:function(){T.off("audioLevelUpdated",i)}}),e.audioLevel=a}e.videoDisabledIndicator=new t.Chrome.VideoDisabledIndicator({mode:this.getStyle("videoDisabledDisplayMode")}),s=new t.Chrome({parent:o.domElement}).set(e).on({muted:function(){V.call(this,!0)},unmuted:function(){V.call(this,!1)}},this),s.hideWhileLoading()},H=function(){o&&o.addError("The stream was unable to connect due to a network error.","Make sure your connection isn't blocked by a firewall.")};t.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",audioLevelDisplayMode:"auto",videoDisabledDisplayMode:"auto",backgroundImageURI:null,showArchiveStatus:!0,showMicButton:!0},h.showControls,function(e){$("SetStyle","Subscriber",e,.1)});var W=function(e){c&&c.subscribeToVideo(!e),o&&(o.audioOnly(e),o.showPoster(e)),a&&"auto"===T.getStyle("audioLevelDisplayMode")&&a[e?"show":"hide"]()},B=function(){var e=0;return function(){e%100===0&&$("getStats","Called"),e++}}();this.destroy=function(e,n){return p.isDestroyed()?void 0:("streamDestroyed"===e&&p.isAttemptingToSubscribe()&&this.trigger("subscribeComplete",new t.Error(null,"InvalidStreamID")),p.set("Destroyed"),v&&v.stop(),this.disconnect(),s&&(s.destroy(),s=null),o&&(o.destroy(),o=null,this.element=null),_&&!_.destroyed&&$("unsubscribe",null,{streamId:_.id}),this.id=w=null,this.stream=_=null,this.streamId=null,this.session=C=null,h=null,n!==!0&&this.dispatchEvent(new t.DestroyedEvent(t.Event.names.SUBSCRIBER_DESTROYED,this,e),t.$.bind(this.off,this)),this)},this.disconnect=function(){p.isDestroyed()||p.isFailed()||p.set("NotSubscribing"),r&&(r.destroy(),r=null),c&&(c.destroy(),c=null,$("disconnect","PeerConnection",{streamId:_.id}))},this.processMessage=function(e,n,i){t.debug("OT.Subscriber.processMessage: Received "+e+" message from "+n.id),t.debug(i),l!==n.id&&(l=n.id),c&&c.processMessage(e,i)},this.disableVideo=function(e){if(e){if("auto"!==g)return void t.info("Video was not re-enabled because it was manually disabled");t.info("Video has been re-enabled"),s.videoDisabledIndicator.disableVideo(!1)}else t.warn("Due to high packet loss and low bandwidth, video has been disabled");this.subscribeToVideo(e,"auto"),e||s.videoDisabledIndicator.disableVideo(!0);var n=e?{videoEnabled:!0}:{videoDisabled:!0};$("updateQuality","video",n)},this.getImgData=function(){return this.isSubscribing()?r.imgData():(t.error("OT.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing."),null)},this.getStats=function(e){return c?(B(),void c.getStats(function(n,i){if(n)return void e(n);var o={timestamp:0};t.$.forEach(i,function(e){if(t.getStatsHelpers.isInboundStat(e)){var n=t.getStatsHelpers.isVideoStat(e),i=t.getStatsHelpers.isAudioStat(e);(i||n)&&(o.timestamp=t.getStatsHelpers.normalizeTimestamp(e.timestamp)),n?o.video=t.getStatsHelpers.parseStatCategory(e):i&&(o.audio=t.getStatsHelpers.parseStatCategory(e))}}),e(null,o)})):void e(new t.$.Error("Subscriber is not connected cannot getStats",1015))},this.setAudioVolume=function(e){return e=parseInt(e,10),isNaN(e)?(t.error("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),this):(x=Math.max(0,Math.min(100,e)),x!==e&&t.warn("OT.Subscriber.setAudioVolume: value should be an integer between 0 and 100"),h.muted&&x>0&&(h.premuteVolume=e,V.call(this,!1)),r&&r.setAudioVolume(x),this)},this.getAudioVolume=function(){return h.muted?0:r?r.getAudioVolume():x},this.subscribeToAudio=function(e){var n=t.$.castToBoolean(e,!0);return c&&(c.subscribeToAudio(n&&!h.subscribeMute),C&&_&&n!==h.subscribeToAudio&&_.setChannelActiveState("audio",n&&!h.subscribeMute)),h.subscribeToAudio=n,this};var V=function(e){s.muteButton.muted(e),e!==h.mute&&("Chrome"===t.$.env.name||OTPlugin.isInstalled()?(h.subscribeMute=h.muted=e,this.subscribeToAudio(h.subscribeToAudio)):e?(h.premuteVolume=this.getAudioVolume(),h.muted=!0,this.setAudioVolume(0)):(h.premuteVolume||h.audioVolume)&&(h.muted=!1,this.setAudioVolume(h.premuteVolume||h.audioVolume)),h.mute=h.mute)},z={auto:"quality",publishVideo:"publishVideo",subscribeToVideo:"subscribeToVideo"};if(this.subscribeToVideo=function(e,n){var i=t.$.castToBoolean(e,!0);return W(!(i&&_.hasVideo)),i&&o&&o.video()&&(o.loading(i),o.video().whenTimeIncrements(function(){o.loading(!1)},this)),s&&s.videoDisabledIndicator&&s.videoDisabledIndicator.disableVideo(!1),c&&C&&_&&(i!==h.subscribeToVideo||n!==g)&&_.setChannelActiveState("video",i,n),h.subscribeToVideo=i,g=n,"loading"!==n&&this.dispatchEvent(new t.VideoEnabledChangedEvent(i?"videoEnabled":"videoDisabled",{reason:z[n]||"subscribeToVideo"})),this},this.isSubscribing=function(){return p.isSubscribing()},this.isWebRTC=!0,this.isLoading=function(){return o&&o.loading()},this.videoElement=function(){return r.domElement()},this.videoWidth=function(){return r.videoWidth()},this.videoHeight=function(){return r.videoHeight()},this.restrictFrameRate=function(e){return t.debug("OT.Subscriber.restrictFrameRate("+e+")"),$("restrictFrameRate",e.toString(),{streamId:_.id}),C.sessionInfo.p2pEnabled&&t.warn("OT.Subscriber.restrictFrameRate: Cannot restrictFrameRate on a P2P session"),"boolean"!=typeof e?t.error("OT.Subscriber.restrictFrameRate: expected a boolean value got a "+typeof e):(k=e,_.setRestrictFrameRate(e)),this},this.on("styleValueChanged",U,this),this._={archivingStatus:function(e){s&&s.archive.setArchiving(e)},getDataChannel:function(e,n,i){return c?void c.getDataChannel(e,n,i):void i(new t.$.Error("Cannot create a DataChannel before there is a publisher connection."))}},p=new t.SubscribingState(I),t.debug("OT.Subscriber: subscribe to "+_.id),p.set("Init"),!_)return t.error("OT.Subscriber: No stream parameter."),!1;if(_.on({updated:L,destroyed:N},this),l=_.connection.id,h.name=h.name||_.name,h.classNames="OT_root OT_subscriber",h.style&&this.setStyle(h.style,null,!0),h.audioVolume&&this.setAudioVolume(h.audioVolume),h.subscribeToAudio=t.$.castToBoolean(h.subscribeToAudio,!0),h.subscribeToVideo=t.$.castToBoolean(h.subscribeToVideo,!0),o=new t.WidgetView(e,h),this.id=w=o.domId(),this.element=o.domElement,j.call(this),d=t.$.now(),_.connection.id!==C.connection.id){if($("createPeerConnection","Attempt",""),p.set("ConnectingToPeer"),c=new t.SubscriberPeerConnection(_.connection,C,_,this,h),c.on({disconnected:A,error:O,remoteStreamAdded:R,remoteStreamRemoved:P,qos:D},this),c.init(),t.$.hasCapabilities("audioOutputLevelStat")?m=new t.GetStatsAudioLevelSampler(c,"out"):t.$.hasCapabilities("webAudioCapableRemoteStream")&&(m=new t.AnalyserAudioLevelSampler(t.audioContext())),m){var q=this;v=new t.IntervalRunner(function(){m.sample(function(e){null!==e&&t.$.requestAnimationFrame(function(){q.dispatchEvent(new t.AudioLevelUpdatedEvent(e))})})},60)}}else{$("createPeerConnection","Attempt","");var Y=C.getPublisherForStream(_);if(!Y||!Y._.webRtcStream())return this.trigger("subscribeComplete",new t.Error(null,"InvalidStreamID")),this;R.call(this,Y._.webRtcStream())}E("Attempt",{streamId:_.id})},t.Session=function(e,n){function i(e){return new t.$.RSVP.Promise(function(n,i){t.$.getJSON([t.properties.apiURL,"/v2/partner/",E,"/session/",I,"/connection/",A,"/testNetworkConfig"].join(""),{headers:{"X-TB-TOKEN-AUTH":e}},function(e,o){if(e){var r=JSON.parse(e.target.responseText);i(-1===r.code?new t.$.Error("Unexpected HTTP error codes "+e.target.status,"2001"):10001===r.code||10002===r.code?new t.$.Error(r.message,"1004"):new t.$.Error(r.message,r.code))}else n(o)})})}if(t.$.eventing(this),!t.checkSystemRequirements())return void t.upgradeSystemRequirements();null==n&&(n=e,e=null),this.id=this.sessionId=n;var o,r,s,a,l,c,u,d,h,p,f,g,m,v,b,y,w,C,_,x,S,k,T,$=!0,E=e,D=this,I=n,M=t.$.uuid(),A=t.$.uuid(),O=t.$.statable(this,["disconnected","connecting","connected","disconnecting"],"disconnected");this.connection=null,this.connections=new t.$.Collection,this.streams=new t.$.Collection,this.archives=new t.$.Collection,s=function(e,n){O("disconnected"),t.error(e),this.trigger("sessionConnectFailed",new t.Error(n||t.ExceptionCodes.CONNECT_FAILED,e)),t.handleJsException(e,n||t.ExceptionCodes.CONNECT_FAILED,{session:this})},a=function(e){var n=e.reason;"networkTimedout"===n?(n="networkDisconnected",this.logEvent("Connect","TimeOutDisconnect",{reason:e.reason})):this.logEvent("Connect","Disconnected",{reason:e.reason});var i=new t.SessionDisconnectEvent("sessionDisconnected",n);v(),b.call(this,n);var o=t.$.bind(function(){y.call(this,i.reason),i.isDefaultPrevented()||w.call(this,i.reason)},this);this.dispatchEvent(i,o)},l=function(e){e.id.match(/^symphony\./)||this.dispatchEvent(new t.ConnectionEvent(t.Event.names.CONNECTION_CREATED,e))},c=function(e,n){e.id.match(/^symphony\./)||e.id!==r.id()&&this.dispatchEvent(new t.ConnectionEvent(t.Event.names.CONNECTION_DESTROYED,e,n))},u=function(e){e.connection.id!==this.connection.id&&this.dispatchEvent(new t.StreamEvent(t.Event.names.STREAM_CREATED,e,null,!1))},d=function(e){var n=e.target,i=e.changedProperty,o=e.newValue;"videoDisableWarning"!==i&&"audioDisableWarning"!==i&&("orientation"===i&&(i="videoDimensions",o={width:o.width,height:o.height}),this.dispatchEvent(new t.StreamPropertyChangedEvent(t.Event.names.STREAM_PROPERTY_CHANGED,n,i,e.oldValue,o)))},h=function(e,n){if(e.connection.id===this.connection.id)return void t.$.forEach(t.publishers.where({streamId:e.id}),t.$.bind(function(e){e._.unpublishFromSession(this,n)},this));var i=new t.StreamEvent("streamDestroyed",e,n,!0),o=t.$.bind(function(){i.isDefaultPrevented()||t.$.forEach(t.subscribers.where({streamId:e.id}),function(e){e.session.id===this.id&&e.stream&&e.destroy("streamDestroyed")},this)},this);this.dispatchEvent(i,o)},p=function(e){this.dispatchEvent(new t.ArchiveEvent("archiveStarted",e))},f=function(e){this.dispatchEvent(new t.ArchiveEvent("archiveDestroyed",e))},g=function(e){var n=e.target,i=e.changedProperty,o=e.newValue;this.dispatchEvent("status"===i&&"stopped"===o?new t.ArchiveEvent("archiveStopped",n):new t.ArchiveEvent("archiveUpdated",n))},m=function(){D.token=o=null,O("disconnected"),D.connection=null,D.capabilities=new t.Capabilities([]),D.connections.destroy(),D.streams.destroy(),D.archives.destroy()},v=function(){A=t.$.uuid(),m()},b=function(e){t.$.forEach(t.publishers.where({session:this}),function(t){t.disconnect(e)}),t.$.forEach(t.subscribers.where({session:this}),function(e){e.disconnect()})},y=function(e){t.$.forEach(t.publishers.where({session:this}),function(t){t._.streamDestroyed(e)})},w=function(e){t.$.forEach(t.subscribers.where({session:this}),function(t){t.destroy(e)})},C=function(){t.debug("OT.Session: connecting to Raptor");var e=this.sessionInfo.messagingURL,n=t.properties.symphonyAddresss||this.sessionInfo.symphonyAddress;r=new t.Raptor.Socket(A,M,e,n,t.SessionDispatcher(this)),r.connect(o,this.sessionInfo,t.$.bind(function(e,n){return e?(r=void 0,this.logConnectivityEvent("Failure",e),void s.call(this,e.message,e.code)):(t.debug("OT.Session: Received session state from Raptor",n),this.connection=this.connections.get(r.id()),this.connection&&(this.capabilities=this.connection.permissions),O("connected"),this.logConnectivityEvent("Success",null,{connectionId:this.connection.id}),this.connection.on("destroyed",a,this),this.connections.on({add:l,remove:c},this),this.streams.on({add:u,remove:h,update:d},this),this.archives.on({add:p,remove:f,update:g},this),void this.dispatchEvent(new t.SessionConnectEvent(t.Event.names.SESSION_CONNECTED),t.$.bind(function(){this.connections._triggerAddEvents(),this.streams._triggerAddEvents(),this.archives._triggerAddEvents()},this)))},this))},_=function(){this.is("connecting")&&t.SessionInfo.get(this,t.$.bind(x,this),t.$.bind(function(e){s.call(this,e.message+(e.code?" ("+e.code+")":""),e.code)},this))},x=function(e){if(this.is("connecting")){var n=t.properties.sessionInfoOverrides;if(this.sessionInfo=e,null!=n&&"object"==typeof n&&(this.sessionInfo=t.$.defaults(n,this.sessionInfo)),
this.sessionInfo.partnerId&&this.sessionInfo.partnerId!==E){this.apiKey=E=this.sessionInfo.partnerId;var i="Authentication Error: The API key does not match the token or session.",o={code:t.ExceptionCodes.AUTHENTICATION_ERROR,message:i};this.logEvent("Failure","SessionInfo",o),s.call(this,i,t.ExceptionCodes.AUTHENTICATION_ERROR)}else C.call(this)}},S=t.$.bind(function(e){return this.capabilities.permittedTo(e)},this),T=t.$.bind(function(e,n,i){t.dispatchError(e,n,i,this)},this),this.logEvent=function(e,n,i,o){var r={action:e,variation:n,payload:i,sessionId:I,partnerId:E};r.connectionId=A,o&&(r=t.$.extend(o,r)),t.analytics.logEvent(r)},this.testNetwork=function(e,n,o){var r=o;if(o=function(e,t){e?D.logEvent("TestNetwork","Failure",{failureCode:e.name||e.message||"unknown"}):D.logEvent("TestNetwork","Success",t),r(e,t)},D.logEvent("TestNetwork","Attempt",{}),this.isConnected())return void o(new t.$.Error("Session connected, cannot test network",1015));var s,a,l=new t.$.RSVP.Promise(function(e,t){var i=n._.webRtcStream();if(i)e(i);else{var o=function(){s(),e(n._.webRtcStream())},r=function(e){e&&(s(),t(e))},s=function(){n.off("publishComplete",r),n.off("accessAllowed",o)};n.on("publishComplete",r),n.on("accessAllowed",o)}});t.$.RSVP.Promise.all([i(e),l]).then(function(e){var n=e[1];return s=e[0],t.webrtcTest({mediaConfig:s.media,localStream:n})}).then(function(e){return t.debug("Received stats from webrtcTest: ",e),e.bandwidth<s.media.thresholdBitsPerSecond?t.$.RSVP.Promise.reject(new t.$.Error("The detect bandwidth form the WebRTC stage of the test was not sufficient to run the HTTP stage of the test",1553)):void(a=e)}).then(function(){return a.extended?void 0:t.httpTest({httpConfig:s.http})}).then(function(e){var t={uploadBitsPerSecond:e?e.uploadBandwidth:a.bandwidth,downloadBitsPerSecond:e?e.downloadBandwidth:a.bandwidth,packetLossRatio:a.packetLostRatio,roundTripTimeMilliseconds:a.roundTripTime};o(null,t)})["catch"](function(e){o(e)})},this.logConnectivityEvent=function(e,n,i){if("Attempt"===e||!k){var o={action:"Connect",sessionId:I,partnerId:E};this.connection&&this.connection.id?o=event.connectionId=this.connection.id:A&&(o.connectionId=A),k=new t.ConnectivityAttemptPinger(o)}k.setVariation(e),this.logEvent("Connect",e,n,i)},this.connect=function(n){null==e&&arguments.length>1&&("string"==typeof arguments[0]||"number"==typeof arguments[0])&&"string"==typeof arguments[1]&&(E=n.toString(),n=arguments[1]);var i=arguments[arguments.length-1];if(this.is("connecting","connected"))return t.warn("OT.Session: Cannot connect, the session is already "+this.state),this;if(m(),O("connecting"),this.token=o=!t.$.isFunction(n)&&n,$?$=!1:M=t.$.uuid(),i&&t.$.isFunction(i)&&(this.once("sessionConnected",t.$.bind(i,null,null)),this.once("sessionConnectFailed",i)),null==E||t.$.isFunction(E))return setTimeout(t.$.bind(s,this,"API Key is undefined. You must pass an API Key to initSession.",t.ExceptionCodes.AUTHENTICATION_ERROR)),this;if(this.logConnectivityEvent("Attempt"),!I||t.$.isObject(I)||t.$.isArray(I)){var r;return I?(r="SessionID is not a string. You must use string as the session ID passed into OT.initSession().",I=I.toString()):r="SessionID is undefined. You must pass a sessionID to initSession.",setTimeout(t.$.bind(s,this,r,t.ExceptionCodes.INVALID_SESSION_ID)),this.logConnectivityEvent("Failure",{reason:"ConnectToSession",code:t.ExceptionCodes.INVALID_SESSION_ID,message:r}),this}return this.apiKey=E=E.toString(),0===t.APIKEY.length&&(t.APIKEY=E),_.call(this),this};var R=t.$.bind(function(e){r&&r.isNot("disconnected")?r.isNot("disconnecting")&&(O("disconnecting"),r.disconnect(e)):v()},this);this.disconnect=function(e){R(void 0!==e?e:!0)},this.destroy=function(e){this.streams.destroy(),this.connections.destroy(),this.archives.destroy(),R("unloaded"!==e)},this.publish=function(e,n,i){if("function"==typeof e&&(i=e,e=void 0),"function"==typeof n&&(i=n,n=void 0),this.isNot("connected"))return t.analytics.logError(1010,"OT.exception","We need to be connected before you can publish",null,{action:"Publish",variation:"Failure",payload:{reason:"unconnected",code:t.ExceptionCodes.NOT_CONNECTED,message:"We need to be connected before you can publish"},sessionId:I,streamId:e&&e.stream?e.stream.id:null,partnerId:E}),i&&t.$.isFunction(i)&&T(t.ExceptionCodes.NOT_CONNECTED,"We need to be connected before you can publish",i),null;if(!S("publish")){var o="This token does not allow publishing. The role must be at least `publisher` to enable this functionality",r={reason:"permission",code:t.ExceptionCodes.UNABLE_TO_PUBLISH,message:o};return this.logEvent("publish","Failure",r),T(t.ExceptionCodes.UNABLE_TO_PUBLISH,o,i),null}if(!e||"string"==typeof e||t.$.isElementNode(e))e=t.initPublisher(e,n);else{if(!(e instanceof t.Publisher))return void T(t.ExceptionCodes.UNABLE_TO_PUBLISH,"Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher",i);"session"in e&&e.session&&"sessionId"in e.session&&t.warn(e.session.sessionId===this.sessionId?"Cannot publish "+e.guid()+" again to "+this.sessionId+". Please call session.unpublish(publisher) first.":"Cannot publish "+e.guid()+" publisher already attached to "+e.session.sessionId+". Please call session.unpublish(publisher) first.")}return e.once("publishComplete",function(e){return e?void T(t.ExceptionCodes.UNABLE_TO_PUBLISH,"Session.publish :: "+e.message,i):void(i&&t.$.isFunction(i)&&i.apply(null,arguments))}),e._.publishToSession(this),e},this.unpublish=function(e){return e?void e._.unpublishFromSession(this,"unpublished"):void t.error("OT.Session.unpublish: publisher parameter missing.")},this.subscribe=function(e,n,i,o){if("function"==typeof n&&(o=n,n=void 0,i=void 0),"function"==typeof i&&(o=i,i=void 0),!this.connection||!this.connection.connectionId)return void T(t.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: Connection required to subscribe",o);if(!e)return void T(t.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: stream cannot be null",o);if(!e.hasOwnProperty("streamId"))return void T(t.ExceptionCodes.UNABLE_TO_SUBSCRIBE,"Session.subscribe :: invalid stream object",o);var r=new t.Subscriber(n,t.$.extend(i||{},{stream:e,session:this}),function(e){if(e){var n,i,r=[400,403];!e.code&&t.$.arrayIndexOf(r,e.code)>-1?(n=t.OT.ExceptionCodes.UNABLE_TO_SUBSCRIBE,i="Session.subscribe :: "+e.message):(n=t.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,i="Unexpected server response. Try this operation again later."),T(n,i,o)}else o&&t.$.isFunction(o)&&o.apply(null,arguments)});return t.subscribers.add(r),r},this.unsubscribe=function(e){if(!e){var n="OT.Session.unsubscribe: subscriber cannot be null";throw t.error(n),new Error(n)}return e.stream?(t.debug("OT.Session.unsubscribe: subscriber "+e.id),e.destroy(),!0):(t.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream"),!1)},this.getSubscribersForStream=function(e){return t.subscribers.where({streamId:e.id})},this.getPublisherForStream=function(e){var n,i;if("string"==typeof e)n=e;else{if("object"!=typeof e||!e||!e.hasOwnProperty("id"))throw i="Session.getPublisherForStream :: Invalid stream type",t.error(i),new Error(i);n=e.id}return t.publishers.where({streamId:n})[0]},this._={jsepCandidateP2p:function(e,t,n){return r.jsepCandidateP2p(e,t,n)},jsepCandidate:function(e,t){return r.jsepCandidate(e,t)},jsepOffer:function(e,t){return r.jsepOffer(e,t)},jsepOfferP2p:function(e,t,n){return r.jsepOfferP2p(e,t,n)},jsepAnswer:function(e,t){return r.jsepAnswer(e,t)},jsepAnswerP2p:function(e,t,n){return r.jsepAnswerP2p(e,t,n)},dispatchSignal:t.$.bind(function(e,n,i){var o=new t.SignalEvent(n,i,e);o.target=this,this.trigger(t.Event.names.SIGNAL,o),n&&this.dispatchEvent(o)},this),subscriberCreate:function(e,t,n,i){return r.subscriberCreate(e.id,t.widgetId,n,i)},subscriberDestroy:function(e,t){return r.subscriberDestroy(e.id,t.widgetId)},subscriberUpdate:function(e,t,n){return r.subscriberUpdate(e.id,t.widgetId,n)},subscriberChannelUpdate:function(e,t,n,i){return r.subscriberChannelUpdate(e.id,t.widgetId,n.id,i)},streamCreate:function(e,n,i,o,s){r.streamCreate(e,n,i,o,t.Config.get("bitrates","min",t.APIKEY),t.Config.get("bitrates","max",t.APIKEY),s)},streamDestroy:function(e){r.streamDestroy(e)},streamChannelUpdate:function(e,t,n){r.streamChannelUpdate(e.id,t.id,n)}},this.signal=function(e,n){var i=e,o=n;if(t.$.isFunction(i)&&(o=i,i=null),this.isNot("connected")){var s="Unable to send signal - you are not connected to the session.";return void T(500,s,o)}r.signal(i,o,this.logEvent),e&&e.data&&"string"!=typeof e.data&&t.warn("Signaling of anything other than Strings is deprecated. Please update the data property to be a string.")},this.forceDisconnect=function(e,n){if(this.isNot("connected")){var i="Cannot call forceDisconnect(). You are not connected to the session.";return void T(t.ExceptionCodes.NOT_CONNECTED,i,n)}var o="This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality";if(S("forceDisconnect")){var s="string"==typeof e?e:e.id;r.forceDisconnect(s,function(e){e?T(t.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,o,n):n&&t.$.isFunction(n)&&n.apply(null,arguments)})}else T(t.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,o,n)},this.forceUnpublish=function(e,n){if(this.isNot("connected")){var i="Cannot call forceUnpublish(). You are not connected to the session.";return void T(t.ExceptionCodes.NOT_CONNECTED,i,n)}var o="This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality";if(S("forceUnpublish")){var s="string"==typeof e?this.streams.get(e):e;r.forceUnpublish(s.id,function(e){e?T(t.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,o,n):n&&t.$.isFunction(n)&&n.apply(null,arguments)})}else T(t.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,o,n)},this.getStateManager=function(){t.warn("Fixme: Have not implemented session.getStateManager")},this.isConnected=function(){return this.is("connected")},this.capabilities=new t.Capabilities([])};var F={audio:!0,video:!0};t.Publisher=function(n){if(!t.checkSystemRequirements())return void t.upgradeSystemRequirements();var i,o,r,s,a,l,c,u,d,h,p,f,g,m,v,b,y,w,C=t.Publisher.nextId(),_={},x=!1,S=[1,7,15,30],k=t.$.hasCapabilities("webAudio"),T=n&&("screen"===n.videoSource||"window"===n.videoSource||"tab"===n.videoSource||"browser"===n.videoSource||"application"===n.videoSource),$=this;if(f=t.$.defaults(n||{},{publishAudio:T?!1:!0,publishVideo:!0,mirror:T?!1:!0,showControls:!0,fitMode:T?"contain":"cover",audioFallbackEnabled:T?!1:!0,maxResolution:T?{width:1920,height:1920}:void 0}),g={"320x240":{width:320,height:240},"640x480":{width:640,height:480},"1280x720":{width:1280,height:720}},T&&"https:"!==e.location.protocol&&t.warn("Screen Sharing typically requires pages to be loadever over HTTPS - unless this browser is configured locally to allow non-SSL pages, permission will be denied without user input."),m={timeStamp:t.$.now()},t.$.eventing(this),!T&&k){y=new t.AnalyserAudioLevelSampler(t.audioContext());var E=new t.IntervalRunner(function(){y.sample(function(e){t.$.requestAnimationFrame(function(){$.dispatchEvent(new t.AudioLevelUpdatedEvent(e))})})},60);this.on({"audioLevelUpdated:added":function(e){1===e&&E.start()},"audioLevelUpdated:removed":function(e){0===e&&E.stop()}})}var D=function(e,n,i,o){t.analytics.logEvent({action:e,variation:n,payload:i,sessionId:c?c.sessionId:null,connectionId:c&&c.isConnected()?c.connection.connectionId:null,partnerId:c?c.apiKey:t.APIKEY,streamId:a},o)},I=function(e,n){"Attempt"!==e&&w||(w=new t.ConnectivityAttemptPinger({action:"Publish",sessionId:c?c.sessionId:null,connectionId:c&&c.isConnected()?c.connection.connectionId:null,partnerId:c?c.apiKey:t.APIKEY,streamId:a})),"Failure"===e&&"Non-fatal"!==n.reason&&w.setVariation(e),D("Publish",e,n)},M=t.$.bind(function(e,n){var i={streamType:"WebRTC",sessionId:c?c.sessionId:null,connectionId:c&&c.isConnected()?c.connection.connectionId:null,partnerId:c?c.apiKey:t.APIKEY,streamId:a,width:o?Number(t.$.width(o.domElement).replace("px","")):void 0,height:o?Number(t.$.height(o.domElement).replace("px","")):void 0,version:t.properties.version,mediaServerName:c?c.sessionInfo.messagingServer:null,p2pFlag:c?c.sessionInfo.p2pEnabled:!1,duration:u?(new Date).getTime()-u.getTime():0,remoteConnectionId:e.id};t.analytics.logQOS(t.$.extend(i,n)),this.trigger("qos",n)},this),A=function(e){t.error("Publisher State Change Failed: ",e.message),t.debug(e)},O=t.$.bind(function(){v.isDestroyed()||(t.debug("OT.Publisher.onLoaded"),v.set("MediaBound"),o.loading(this.session?!s:!1),x=!0,Q.call(this),this.trigger("initSuccess"),this.trigger("loaded",this))},this),R=t.$.bind(function(e){var n=t.ExceptionCodes.P2P_CONNECTION_FAILED,i={reason:"Publisher PeerConnection Error: ",code:n,message:e};I("Failure",i),v.set("Failed"),this.trigger("publishComplete",new t.Error(n,"Publisher PeerConnection Error: "+e)),t.handleJsException("Publisher PeerConnection Error: "+e,t.ExceptionCodes.P2P_CONNECTION_FAILED,{session:c,target:this})},this),P=t.$.bind(function(e){t.debug("OT.Publisher.onStreamAvailable"),v.set("BindingMedia"),q(),l=e,d=new t.Microphone(l,!f.publishAudio),this.publishVideo(f.publishVideo&&l.getVideoTracks().length>0),this.accessAllowed=!0,this.dispatchEvent(new t.Event(t.Event.names.ACCESS_ALLOWED,!1));var n={muted:!0,error:W};r=o.bindVideo(l,n,function(e){return e?void R(e):void O()}),y&&l.getAudioTracks().length>0&&y.webRTCStream(l)},this),N=t.$.bind(function(e){t.error("OT.Publisher.onStreamAvailableError "+e.name+": "+e.message),v.set("Failed"),this.trigger("publishComplete",new t.Error(t.ExceptionCodes.UNABLE_TO_PUBLISH,e.message)),o&&o.destroy();var n={reason:"GetUserMedia",code:t.ExceptionCodes.UNABLE_TO_PUBLISH,message:"Publisher failed to access camera/mic: "+e.message};I("Failure",n),t.handleJsException(n.reason,n.code,{session:c,target:this})},this),L=t.$.bind(function(e){t.error("OT.Publisher.onScreenSharingError "+e.message),v.set("Failed"),this.trigger("publishComplete",new t.Error(t.ExceptionCodes.UNABLE_TO_PUBLISH,"Screensharing: "+e.message));var n={reason:"ScreenSharing",message:e.message};I("Failure",n)},this),U=t.$.bind(function(e){t.error("OT.Publisher.onStreamAvailableError Permission Denied"),v.set("Failed");var n="Publisher Access Denied: Permission Denied"+(e.message?": "+e.message:""),i=t.ExceptionCodes.UNABLE_TO_PUBLISH;this.trigger("publishComplete",new t.Error(i,n));var o={reason:"GetUserMedia",code:i,message:n};I("Failure",o),this.dispatchEvent(new t.Event(t.Event.names.ACCESS_DENIED))},this),j=t.$.bind(function(){D("accessDialog","Opened"),this.dispatchEvent(new t.Event(t.Event.names.ACCESS_DIALOG_OPENED,!0))},this),H=t.$.bind(function(){D("accessDialog","Closed"),this.dispatchEvent(new t.Event(t.Event.names.ACCESS_DIALOG_CLOSED,!1))},this),W=t.$.bind(function(e,n){t.error("OT.Publisher.onVideoError");var i=n+(e?" ("+e+")":"");D("stream",null,{reason:"Publisher while playing stream: "+i}),v.set("Failed"),v.isAttemptingToPublish()?this.trigger("publishComplete",new t.Error(t.ExceptionCodes.UNABLE_TO_PUBLISH,i)):this.trigger("error",i),t.handleJsException("Publisher error playing stream: "+i,t.ExceptionCodes.UNABLE_TO_PUBLISH,{session:c,target:this})},this),B=t.$.bind(function(e){t.debug("OT.Subscriber has been disconnected from the Publisher's PeerConnection"),this.cleanupSubscriber(e.remoteConnection().id)},this),V=t.$.bind(function(e,n,i,o){var r;r="ICEWorkflow"===o?t.ExceptionCodes.PUBLISHER_ICE_WORKFLOW_FAILED:t.ExceptionCodes.UNABLE_TO_PUBLISH;var s={reason:o?o:"PeerConnectionError",code:r,message:(o?o:"")+":Publisher PeerConnection with connection "+(i&&i.remoteConnection&&i.remoteConnection().id)+" failed: "+n,hasRelayCandidates:i.hasRelayCandidates()};v.isPublishing()?s.reason="Non-fatal":this.trigger("publishComplete",new t.Error(t.ExceptionCodes.UNABLE_TO_PUBLISH,s.message)),I("Failure",s),t.handleJsException("Publisher PeerConnection Error: "+n,r,{session:c,target:this}),delete _[i.remoteConnection().id]},this),z=t.$.bind(function(e){this.stream=s=e,s.on("destroyed",this.disconnect,this),v.set("Publishing"),o.loading(!x),u=new Date,this.trigger("publishComplete",null,this),this.dispatchEvent(new t.StreamEvent("streamCreated",e,null,!1));var n={streamType:"WebRTC"};I("Success",n)},this),q=function(){l&&(l.stop(),l=null)},Y=t.$.bind(function(e){var n=_[e.id];if(!n){var i=t.$.now();D("createPeerConnection","Attempt"),e.on("destroyed",t.$.bind(this.cleanupSubscriber,this,e.id)),n=_[e.id]=new t.PublisherPeerConnection(e,c,a,l,f.channels),n.on({connected:function(){var e={pcc:parseInt(t.$.now()-i,10),hasRelayCandidates:n.hasRelayCandidates()};D("createPeerConnection","Success",e)},disconnected:B,error:V,qos:M},this),n.init(b)}return n},this),G=function(e){if(e===!1)return"off";var t=this.getStyle("buttonDisplayMode");return t===!1?"on":t},K=function(e,t){if(h)switch(e){case"nameDisplayMode":h.name.setDisplayMode(t),h.backingBar.setNameMode(t);break;case"showArchiveStatus":D("showArchiveStatus","styleChange",{mode:t?"on":"off"}),h.archive.setShowArchiveStatus(t);break;case"buttonDisplayMode":h.muteButton.setDisplayMode(t),h.backingBar.setMuteMode(t);break;case"audioLevelDisplayMode":h.audioLevel.setDisplayMode(t);break;case"backgroundImageURI":o.setBackgroundImageURI(t)}},Q=function(){this.getStyle("showArchiveStatus")||D("showArchiveStatus","createChrome",{mode:"off"});var e={backingBar:new t.Chrome.BackingBar({nameMode:f.name?this.getStyle("nameDisplayMode"):"off",muteMode:G.call(this,this.getStyle("buttonDisplayMode"))}),name:new t.Chrome.NamePanel({name:f.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new t.Chrome.MuteButton({muted:f.publishAudio===!1,mode:G.call(this,this.getStyle("buttonDisplayMode"))}),archive:new t.Chrome.Archiving({show:this.getStyle("showArchiveStatus"),archiving:!1})};if(k){var n=new t.AudioLevelTransformer,i=function(e){p.setValue(n.transform(e.audioLevel))};p=new t.Chrome.AudioLevelMeter({mode:this.getStyle("audioLevelDisplayMode"),onActivate:function(){$.on("audioLevelUpdated",i)},onPassivate:function(){$.off("audioLevelUpdated",i)}}),e.audioLevel=p}h=new t.Chrome({parent:o.domElement}).set(e).on({muted:t.$.bind(this.publishAudio,this,!1),unmuted:t.$.bind(this.publishAudio,this,!0)}),p&&"auto"===this.getStyle("audioLevelDisplayMode")&&p[o.audioOnly()?"show":"hide"]()},X=t.$.bind(function(){h&&(h.destroy(),h=null),this.disconnect(),d=null,r&&(r.destroy(),r=null),q(),o&&(o.destroy(),o=null),c&&this._.unpublishFromSession(c,"reset"),this.id=i=null,this.stream=s=null,x=!1,this.session=c=null,v.isDestroyed()||v.set("NotPublishing")},this);t.StylableComponent(this,{showArchiveStatus:!0,nameDisplayMode:"auto",buttonDisplayMode:"auto",audioLevelDisplayMode:T?"off":"auto",backgroundImageURI:null},f.showControls,function(e){D("SetStyle","Publisher",e,.1)});var J=function(e){o&&(o.audioOnly(e),o.showPoster(e)),p&&"auto"===$.getStyle("audioLevelDisplayMode")&&p[e?"show":"hide"]()};this.publish=function(e){if(t.debug("OT.Publisher: publish"),(v.isAttemptingToPublish()||v.isPublishing())&&X(),v.set("GetUserMedia"),f.constraints)t.warn("You have passed your own constraints not using ours");else if(f.constraints=t.$.clone(F),T&&(null!=f.audioSource&&t.warn("Invalid audioSource passed to Publisher - when using screen sharing no audioSource may be used"),f.audioSource=null),null===f.audioSource||f.audioSource===!1?(f.constraints.audio=!1,f.publishAudio=!1):("object"==typeof f.audioSource&&(null!=f.audioSource.deviceId?f.audioSource=f.audioSource.deviceId:t.warn("Invalid audioSource passed to Publisher. Expected either a device ID")),f.audioSource&&("object"!=typeof f.constraints.audio&&(f.constraints.audio={}),f.constraints.audio.mandatory||(f.constraints.audio.mandatory={}),f.constraints.audio.optional||(f.constraints.audio.optional=[]),f.constraints.audio.mandatory.sourceId=f.audioSource)),null===f.videoSource||f.videoSource===!1)f.constraints.video=!1,f.publishVideo=!1;else{"object"==typeof f.videoSource&&null==f.videoSource.deviceId&&(t.warn("Invalid videoSource passed to Publisher. Expected either a device ID or device."),f.videoSource=null);var r=function(){"object"!=typeof f.constraints.video&&(f.constraints.video={}),f.constraints.video.mandatory||(f.constraints.video.mandatory={}),f.constraints.video.optional||(f.constraints.video.optional=[])};if(f.videoSource){r();var a=f.constraints.video.mandatory;T||(a.sourceId=null!=f.videoSource.deviceId?f.videoSource.deviceId:f.videoSource)}f.resolution&&(g.hasOwnProperty(f.resolution)?(f.videoDimensions=g[f.resolution],r(),"Chrome"===t.$.env.name&&(f.constraints.video.optional=f.constraints.video.optional.concat([{minWidth:f.videoDimensions.width},{maxWidth:f.videoDimensions.width},{minHeight:f.videoDimensions.height},{maxHeight:f.videoDimensions.height}]))):t.warn("Invalid resolution passed to the Publisher. Got: "+f.resolution+' expecting one of "'+t.$.keys(g).join('","')+'"')),f.maxResolution&&(r(),f.maxResolution.width>1920&&(t.warn("Invalid maxResolution passed to the Publisher. maxResolution.width must be less than or equal to 1920"),f.maxResolution.width=1920),f.maxResolution.height>1920&&(t.warn("Invalid maxResolution passed to the Publisher. maxResolution.height must be less than or equal to 1920"),f.maxResolution.height=1920),f.videoDimensions=f.maxResolution,"Chrome"===t.$.env.name&&(r(),f.constraints.video.mandatory.maxWidth=f.videoDimensions.width,f.constraints.video.mandatory.maxHeight=f.videoDimensions.height)),void 0!==f.frameRate&&-1===t.$.arrayIndexOf(S,f.frameRate)?(t.warn("Invalid frameRate passed to the publisher got: "+f.frameRate+" expecting one of "+S.join(",")),delete f.frameRate):f.frameRate&&(r(),f.constraints.video.optional=f.constraints.video.optional.concat([{minFrameRate:f.frameRate},{maxFrameRate:f.frameRate}]))}return f.style&&this.setStyle(f.style,null,!0),f.name&&(f.name=f.name.toString()),f.classNames="OT_root OT_publisher",t.onLoad(function(){o=new t.WidgetView(e,f),$.id=i=o.domId(),$.element=o.domElement,o.on("videoDimensionsChanged",function(e,n){s&&s.setVideoDimensions(n.width,n.height),$.dispatchEvent(new t.VideoDimensionsChangedEvent($,e,n))}),o.on("mediaStopped",function(){var e=new t.MediaStoppedEvent($);$.dispatchEvent(e,function(){e.isDefaultPrevented()||(c?$._.unpublishFromSession(c,"mediaStopped"):$.destroy("mediaStopped"))})}),t.$.waterfall([function(e){T?t.checkScreenSharingCapability(function(i){if(i.supported)if(i.extensionRegistered===!1)L(new Error("Screen Sharing suppor in this browser requires an extension, but one has not been registered."));else if(i.extensionInstalled===!1)L(new Error("Screen Sharing suppor in this browser requires an extension, but the extension is not installed."));else{var o=t.pickScreenSharingHelper();o.proto.getConstraintsShowsPermissionUI&&j(),o.instance.getConstraints(n.videoSource,f.constraints,function(t,n){o.proto.getConstraintsShowsPermissionUI&&H(),t?"PermissionDeniedError"===t.message?U(t):L(t):(f.constraints=n,e())})}else L(new Error("Screen Sharing is not supported in this browser"))}):t.$.shouldAskForDevices(function(n){n.video||(t.warn("Setting video constraint to false, there are no video sources"),f.constraints.video=!1),n.audio||(t.warn("Setting audio constraint to false, there are no audio sources"),f.constraints.audio=!1),e()})},function(){v.isDestroyed()||t.$.getUserMedia(f.constraints,P,N,j,H,U)}])},this),this},this.publishAudio=function(e){return f.publishAudio=e,d&&d.muted(!e),h&&h.muteButton.muted(!e),c&&s&&s.setChannelActiveState("audio",e),this},this.publishVideo=function(e){var t=f.publishVideo;if(f.publishVideo=e,c&&s&&f.publishVideo!==t&&s.setChannelActiveState("video",e),l)for(var n=l.getVideoTracks(),i=0,o=n.length;o>i;++i)n[i].setEnabled(e);return J(!e),this},this.destroy=function(e,n){return v.isDestroyed()?void 0:(v.set("Destroyed"),X(),n!==!0&&this.dispatchEvent(new t.DestroyedEvent(t.Event.names.PUBLISHER_DESTROYED,this,e),t.$.bind(this.off,this)),this)},this.disconnect=function(){for(var e in _)this.cleanupSubscriber(e)},this.cleanupSubscriber=function(e){var t=_[e];t&&(t.destroy(),delete _[e],D("disconnect","PeerConnection",{subscriberConnection:e}))},this.processMessage=function(e,n,i){switch(t.debug("OT.Publisher.processMessage: Received "+e+" from "+n.id),t.debug(i),e){case"unsubscribe":this.cleanupSubscriber(i.content.connection.id);break;default:var o=Y(n);o.processMessage(e,i)}},this.getImgData=function(){return x?r.imgData():(t.error("OT.Publisher.getImgData: Cannot getImgData before the Publisher is publishing."),null)},this._={publishToSession:t.$.bind(function(e){this.session=c=e,a=t.$.uuid();var n=function(){var n,i;if(c){v.set("PublishingToSession");var o=t.$.bind(function(e,n,i){if(e){var o,r,s=[403,404,409];e.code&&t.$.arrayIndexOf(s,e.code)>-1?(o=t.ExceptionCodes.UNABLE_TO_PUBLISH,r=e.message):(o=t.ExceptionCodes.UNEXPECTED_SERVER_RESPONSE,r="Unexpected server response. Try this operation again later.");var l={reason:"Publish",code:o,message:r};return I("Failure",l),v.isAttemptingToPublish()&&this.trigger("publishComplete",new t.Error(o,r)),void t.handleJsException(e.message,o,{session:c,target:this})}this.streamId=a=n,b=t.Raptor.parseIceServers(i)},this);f.videoDimensions?(n=Math.min(f.videoDimensions.width,r.videoWidth()||640),i=Math.min(f.videoDimensions.height,r.videoHeight()||480)):(n=r.videoWidth()||640,i=r.videoHeight()||480);var s=[];null!==f.videoSource&&f.videoSource!==!1&&s.push(new t.StreamChannel({id:"video1",type:"video",active:f.publishVideo,orientation:t.VideoOrientation.ROTATED_NORMAL,frameRate:f.frameRate,width:n,height:i,source:T?"screen":"camera",fitMode:f.fitMode})),null!==f.audioSource&&f.audioSource!==!1&&s.push(new t.StreamChannel({id:"audio1",type:"audio",active:f.publishAudio})),e._.streamCreate(f.name||"",a,f.audioFallbackEnabled,s,o)}};return x?n.call(this):this.on("initSuccess",n,this),I("Attempt",{streamType:"WebRTC"}),this},this),unpublishFromSession:t.$.bind(function(e,n){return c&&e.id===c.id?(e.isConnected()&&this.stream&&e._.streamDestroy(this.stream.id),this.disconnect(),this.session=c=null,v.isDestroyed()||v.set("MediaBound"),w&&w.stop(),D("unpublish","Success",{sessionId:e.id}),this._.streamDestroyed(n),this):(t.warn("The publisher "+C+" is trying to unpublish from a session "+e.id+" it is not attached to (it is attached to "+(c&&c.id||"no session")+")"),this)},this),streamDestroyed:t.$.bind(function(e){if(t.$.arrayIndexOf(["reset"],e)<0){var n=new t.StreamEvent("streamDestroyed",s,e,!0),i=t.$.bind(function(){n.isDefaultPrevented()||this.destroy()},this);this.dispatchEvent(n,i)}},this),archivingStatus:t.$.bind(function(e){return h&&h.archive.setArchiving(e),e},this),webRtcStream:function(){return l},switchTracks:function(){return new Promise(function(e,n){t.$.getUserMedia(f.constraints,function(i){q(),l=i,d=new t.Microphone(l,!f.publishAudio);var s={muted:!0,error:W};r=o.bindVideo(l,s,function(e){e&&(R(e),n(e))}),y&&l.getAudioTracks().length>0&&y.webRTCStream(l);var a=[];Object.keys(_).forEach(function(e){var t=_[e];t.getSenders().forEach(function(e){"audio"===e.track.kind&&i.getAudioTracks().length?a.push(e.switchTracks(i.getAudioTracks()[0])):"video"===e.track.kind&&i.getVideoTracks().length&&a.push(e.switchTracks(i.getVideoTracks()[0]))})}),Promise.all(a).then(e,n)},function(e){N(e),n(e)},j,H,function(e){U(e),n(e)})})},switchAcquiredWindow:function(e){if("Firefox"!==t.$.env.name||t.$.env.version<38)throw new Error("switchAcquiredWindow is an experimental method and is not supported bythe current platform");"undefined"!=typeof e&&(f.constraints.video.browserWindow=e),D("SwitchAcquiredWindow","Attempt",{constraints:f.constraints});var n=$._.switchTracks();return n.then(function(){D("SwitchAcquiredWindow","Success",{constraints:f.constraints})},function(e){D("SwitchAcquiredWindow","Failure",{error:e,constraints:f.constraints})}),n},getDataChannel:function(e,n,i){var o=_[t.$.keys(_)[0]];return o?void o.getDataChannel(e,n,i):void i(new t.$.Error("Cannot create a DataChannel before there is a subscriber."))}},this.detectDevices=function(){t.warn("Fixme: Haven't implemented detectDevices")},this.detectMicActivity=function(){t.warn("Fixme: Haven't implemented detectMicActivity")},this.getEchoCancellationMode=function(){return t.warn("Fixme: Haven't implemented getEchoCancellationMode"),"fullDuplex"},this.setMicrophoneGain=function(){t.warn("Fixme: Haven't implemented setMicrophoneGain")},this.getMicrophoneGain=function(){return t.warn("Fixme: Haven't implemented getMicrophoneGain"),.5},this.setCamera=function(){t.warn("Fixme: Haven't implemented setCamera")},this.setMicrophone=function(){t.warn("Fixme: Haven't implemented setMicrophone")},this.guid=function(){return C},this.videoElement=function(){return r.domElement()},this.setStream=z,this.isWebRTC=!0,this.isLoading=function(){return o&&o.loading()},this.videoWidth=function(){return r.videoWidth()},this.videoHeight=function(){return r.videoHeight()},this.on("styleValueChanged",K,this),v=new t.PublishingState(A),this.accessAllowed=!1},t.Publisher.nextId=t.$.uuid,t.initSession=function(e,n){null==n&&(n=e,e=null),t.$.isArray(n)&&1===n.length&&(n=n[0]);var i=t.sessions.get(n);return i||(i=new t.Session(e,n),t.sessions.add(i)),i},t.initPublisher=function(e,n,i){t.debug("OT.initPublisher("+e+")"),"string"!=typeof e||document.getElementById(e)||(e=n,n=i,i=arguments[3]),"function"==typeof e?(i=e,n=void 0,e=void 0):t.$.isObject(e)&&!t.$.isElementNode(e)&&(i=n,n=e,e=void 0),"function"==typeof n&&(i=n,n=void 0);var o=new t.Publisher(n);t.publishers.add(o);var r=function(e){e?t.dispatchError(e.code,e.message,i,o.session):i&&t.$.isFunction(i)&&i.apply(null,arguments)},s=function(e){o.off("publishComplete",a),r(e)},a=function(e){o.off("initSuccess",s),e&&r(e)};return o.once("initSuccess",s),o.once("publishComplete",a),o.publish(e),o},t.getDevices=function(e){t.$.getMediaDevices(e)},t.reportIssue=function(){t.warn("ToDo: haven't yet implemented OT.reportIssue")},t.components={},t.onUnload(function(){t.publishers.destroy(),t.subscribers.destroy(),t.sessions.destroy("unloaded")}),M(t.properties.cssURL),"function"==typeof define&&define.amd&&define("TB",[],function(){return TB})}(e,e.OT)}(window||exports);var OTChromeScreenSharingExtensionHelper=function(e){if(!e)throw new Error("initChromeScreenSharingExtensionHelper: extensionID is required.");var t=!!navigator.webkitGetUserMedia&&"undefined"!=typeof chrome,n={},i=void 0,o="com.tokbox.screenSharing."+e,r=function(e,t){var n={payload:t,from:"jsapi"};return n[o]=e,n},s=function(e,t){var i,o=OT.$.uuid();return n[o]=function(){clearTimeout(i),i=null,e.apply(null,arguments)},t&&(i=setTimeout(function(){delete n[o],e(new Error("Timeout waiting for response to request."))},t)),o},a=function(e){if(!e)throw new Error("isAvailable: callback is required.");if(t||setTimeout(e.bind(null,!1)),void 0!==i)setTimeout(e.bind(null,i));else{var n=s(function(t,n,o){i!==!0&&(i="extensionLoaded"===n),e(i)},2e3),o=r("isExtensionInstalled",{requestId:n});window.postMessage(o,"*")}},l=function(e){if(!e)throw new Error("getSourceId: callback is required");a(function(t){if(t){var n=s(function(t,n,i){"permissionDenied"===n?e(new Error("PermissionDeniedError")):e(void 0,{kind:"chromeScreenSharing",deviceId:i.sourceId,label:"Screen Sharing"})});window.postMessage(r("getSourceId",{requestId:n}),"*")}else e(new Error("Extension is not installed"))})};return window.addEventListener("message",function(e){if(e.origin==window.location.origin&&null!=e.data&&"object"==typeof e.data&&"extension"===e.data.from){var t=e.data[o],r=e.data.payload;if(r&&r.requestId){var s=n[r.requestId];delete n[r.requestId],s&&s(null,t,r)}"extensionLoaded"===t&&(i=!0)}}),{isAvailable:a,getVideoSource:l}};if(function(){var e=function(e,t,n,i,o,r){var s={left:t+"px",top:n+"px",width:i+"px",height:o+"px"},a=function(){var t=e.querySelector(".OT_root");if(t){var n=t.style.width;t.style.width=i+"px",
t.style.width=n||""}};r&&$?($(e).stop(),$(e).animate(s,r.duration||200,r.easing||"swing",function(){a(),r.complete&&r.complete.call(this)})):OT.$.css(e,s),a()},t=function(e,t){var n=OT.$.css(e,t);return n?parseInt(n,10):0},n=function(e){var t=OT.$.height(e);return t?parseInt(t,10):0},i=function(e){var t=OT.$.width(e);return t?parseInt(t,10):0},o=function(n,i,o,r,s,a,l,c,u){var d,h=n.length,p=function(e,t){for(var n,r,s,a,l,c,u,p=1;h>=p;p++){var f=p,g=Math.ceil(h/f);u=Math.floor(o/g),c=Math.floor(i/f),tRatio=u/c,tRatio>t?(tRatio=t,u=c*tRatio):tRatio<e&&(tRatio=e,c=u/tRatio);var m=c*u*h;(void 0===n||m>n)&&(n=m,a=u,l=c,r=f,s=g)}return{maxArea:n,targetCols:r,targetRows:s,targetHeight:a,targetWidth:l,ratio:d}};if(a){var f=n.length>0&&n[0].querySelector("video");d=f&&f.videoHeight&&f.videoWidth?p(f.videoHeight/f.videoWidth,f.videoHeight/f.videoWidth):p(.75,.75)}else d=p(l,c);for(var g=d.targetRows*d.targetCols-h,m=g*d.targetWidth/2,v=(d.targetRows-1)*d.targetCols,b=(o-d.targetRows*d.targetHeight)/2,y=(i-d.targetCols*d.targetWidth)/2,w=0,C=0,_=0;_<n.length;_++){var x=n[_];_%d.targetCols===0?(w=y,_==v&&(w+=m),C+=0===_?b:d.targetHeight):w+=d.targetWidth,OT.$.css(x,"position","absolute");var S=d.targetWidth-t(x,"paddingLeft")-t(x,"paddingRight")-t(x,"marginLeft")-t(x,"marginRight")-t(x,"borderLeft")-t(x,"borderRight"),k=d.targetHeight-t(x,"paddingTop")-t(x,"paddingBottom")-t(x,"marginTop")-t(x,"marginBottom")-t(x,"borderTop")-t(x,"borderBottom");e(x,w+r,C+s,S,k,u)}},r=function(e){return"none"!==OT.$.css(e,"display")},s=function(e,s,a){if("none"!==OT.$.css(e,"display")){var l=e.getAttribute("id");l||(l="OT_"+OT.$.uuid(),e.setAttribute("id",l));var c=n(e)-t(e,"borderTop")-t(e,"borderBottom"),u=i(e)-t(e,"borderLeft")-t(e,"borderRight"),d=c/u,h=0,p=0,f=0,g=0,m=Array.prototype.filter.call(e.querySelectorAll("#"+l+">."+s.bigClass),r),v=Array.prototype.filter.call(e.querySelectorAll("#"+l+">*:not(."+s.bigClass+")"),r);if(m.length>0&&v.length>0){var b=m[0].querySelector("video");bigRatio=b&&b.videoHeight&&b.videoWidth?b.videoHeight/b.videoWidth:.75;var y,w;d>bigRatio?(y=u,w=Math.min(Math.floor(c*s.bigPercentage),u*bigRatio),p=w,f=c-p):(w=c,y=Math.min(u*s.bigPercentage,Math.floor(w/bigRatio)),h=y,g=u-h),s.bigFirst?(o(m,y,w,0,0,s.bigFixedRatio,s.bigMinRatio,s.bigMaxRatio,s.animate),o(v,u-h,c-p,h,p,s.fixedRatio,s.minRatio,s.maxRatio,s.animate)):(o(v,u-h,c-p,0,0,s.fixedRatio,s.minRatio,s.maxRatio,s.animate),o(m,y,w,g,f,s.bigFixedRatio,s.bigMinRatio,s.bigMaxRatio,s.animate))}else m.length>0&&0===v.length?o(m,u,c,0,0,s.bigFixedRatio,s.bigMinRatio,s.bigMaxRatio,s.animate):o(v,u-h,c-p,h,p,s.fixedRatio,s.minRatio,s.maxRatio,s.animate)}};if(!TB)throw new Error("You must include the OpenTok for WebRTC JS API before the layout-container library");TB.initLayoutContainer=function(e,t){return t=OT.$.defaults(t||{},{maxRatio:1.5,minRatio:9/16,fixedRatio:!1,animate:!1,bigClass:"OT_big",bigPercentage:.8,bigFixedRatio:!1,bigMaxRatio:1.5,bigMinRatio:9/16,bigFirst:!0}),e="string"==typeof e?OT.$(e):e,OT.onLoad(function(){s(e,t)}),{layout:s.bind(null,e,t)}}}(),!window.TB)throw new Error("You must include the TB library before the TB_Angular library");var OpenTokAngular=angular.module("opentok",[]).factory("TB",function(){return TB}).factory("OTSession",["TB","$rootScope",function(e,t){var n={streams:[],connections:[],publishers:[],init:function(i,o,r,s){this.session=e.initSession(o),n.session.on({sessionConnected:function(e){n.publishers.forEach(function(e){n.session.publish(e)})},streamCreated:function(e){t.$apply(function(){n.streams.push(e.stream),console.log("Stream: ",e.stream)})},streamDestroyed:function(e){t.$apply(function(){n.streams.splice(n.streams.indexOf(e.stream),1)})},sessionDisconnected:function(e){t.$apply(function(){n.streams.splice(0,n.streams.length)})},connectionCreated:function(e){t.$apply(function(){n.connections.push(e.connection)})},connectionDestroyed:function(e){t.$apply(function(){n.connections.splice(n.connections.indexOf(e.connection),1)})}}),this.session.connect(i,r,function(e){s&&s(e,n.session)}),this.trigger("init")}};return e.$.eventing(n),n}]).directive("otLayout",["$window","$parse","TB","OTSession",function(e,t,n,i){return{restrict:"E",link:function(o,r,s){var a=t(s.props)(),l=n.initLayoutContainer(r[0],a);o.$watch(function(){return r.children().length},l.layout),e.addEventListener("resize",l.layout),o.$on("otLayout",l.layout);var c=function(e){i.session.on("streamPropertyChanged",function(e){"videoDimensions"===e.changedProperty&&l.layout()})};i.session?c():i.on("init",c)}}}]).directive("otPublisher",["OTSession",function(e){return{restrict:"E",scope:{muteAudio:"=",muteVideo:"=",username:"=",props:"&"},link:function(t,n,i){var o=t.props()||{};o.width=o.width?o.width:angular.element(n).width(),o.height=o.height?o.height:angular.element(n).height(),o.name=t.username,o.style.nameDisplayMode="on";var r=angular.element(n).children();t.publisher=TB.initPublisher(i.apikey||e.session.apiKey,n[0],o,function(e){e&&t.$emit("otPublisherError",e,t.publisher)}),angular.element(n).append(r),t.publisher.on({accessDenied:function(e){t.$emit("otAccessDenied")},accessDialogOpened:function(e){t.$emit("otAccessDialogOpened")},accessDialogClosed:function(e){t.$emit("otAccessDialogClosed")},accessAllowed:function(e){angular.element(n).addClass("allowed"),t.$emit("otAccessAllowed")},loaded:function(e){t.$emit("otLayout")},streamCreated:function(e){t.$emit("otStreamCreated")},streamDestroyed:function(e){t.$emit("otStreamDestroyed")}}),t.$watch("muteAudio",function(e){null!=e&&"undefined"!=typeof e&&t.publisher.publishAudio(1==e?!1:!0)}),t.$watch("muteVideo",function(e){null!=e&&"undefined"!=typeof e&&t.publisher.publishVideo(1==e?!1:!0)}),t.$on("$destroy",function(){e.session?e.session.unpublish(t.publisher):t.publisher.destroy(),e.publishers=e.publishers.filter(function(e){return e!==t.publisher}),t.publisher=null}),e.session&&(e.session.connected||e.session.isConnected&&e.session.isConnected())&&e.session.publish(t.publisher,function(e){e&&t.$emit("otPublisherError",e,t.publisher)}),e.publishers.push(t.publisher)}}}]).directive("otSubscriber",["OTSession",function(e){return{restrict:"E",scope:{stream:"=",props:"&"},link:function(t,n,i){var o=t.stream,r=t.props()||{};r.width=r.width?r.width:angular.element(n).width(),r.height=r.height?r.height:angular.element(n).height(),r.style.nameDisplayMode="on";var s=angular.element(n).children(),a=e.session.subscribe(o,n[0],r,function(e){e&&t.$emit("otSubscriberError",e,a)});a.on("loaded",function(){t.$emit("otLayout")}),angular.element(n).append(s),t.$on("$destroy",function(){e.session.unsubscribe(a)})}}}]);if(function(e,t){"use strict";function n(e){return{$setViewValue:function(e){this.$viewValue=e},$viewValue:e}}e.module("luegg.directives",[]).directive("scrollGlue",function(){return{priority:1,require:["?ngModel"],restrict:"A",link:function(e,t,i,o){function r(){a.scrollTop=a.scrollHeight}function s(){return a.scrollTop+a.clientHeight==a.scrollHeight}var a=t[0],l=o[0]||n(!0);e.$watch(function(){l.$viewValue&&r()}),t.bind("scroll",function(){e.$apply(l.$setViewValue.bind(l,s()))})}}})}(angular),function(){"use strict";function e(){function e(e){e.submitButtonText&&""!==e.submitButtonText||(e.submitButtonText="Send"),e.title||(e.title="Chat")}var n='<div class="row chat-window" style="margin-left:10px;" ng-style="vm.windowStyle"> <div class="panel panel-primary"><div class="panel-heading" id="accordion"><span class="glyphicon glyphicon-comment"></span> &nbsp; {{vm.title}}<div class="btn-group pull-right"><a type="button" class="btn btn-default blue-steel btn-xs" ng-click="vm.toggle()"  data-parent="#accordion" href="javascript:;"><span ng-class="vm.chatButtonClass"></span></a><a type="button" class="btn btn-default red btn-xs" ng-click="vm.close()"  href="javascript:;"><span class="glyphicon glyphicon-remove"></span></a></div></div><div class="panel-body" ng-style="vm.panelStyle"><ul class="chat"><li ng-repeat="message in vm.messages" class="clearfix" ng-class="vm.username === message.username ? \'right\' : \'left\'"><span class="chat-img" ng-class="vm.username === message.username ? \'pull-right\' : \'pull-left\'"><img class="img-circle" ng-if="vm.username !== message.username" ng-src="{{vm.chatImage}}" width="40" height="40" /><img class="img-circle" ng-if="vm.username === message.username" ng-src="{{vm.userImage}}" width="40" height="40" /></span><div class="chat-body clearfix"><div ng-if="vm.username !== message.username" class="header"><strong class="primary-font">{{message.username}}</strong><small class="pull-right text-muted"></small></div><div ng-if="vm.username === message.username" class="header"><small class=" text-muted"></small><strong class="pull-right primary-font">{{message.username}}</strong></div><p>{{message.content}}</p></div></li></ul></div><div class="panel-footer"><form ng-submit="vm.submitFunction()"><div class="input-group"><input id="btn-input" type="text" class="form-control input-sm" ng-model="vm.writingMessage" placeholder="Type your message here..." /><span class="input-group-btn"><input type="submit" class="btn btn-warning btn-sm" value="{{vm.submitButtonText}}" /></span></div></form></div></div></div>',i={restrict:"EA",template:n,replace:!0,scope:{messages:"=",username:"=",userImage:"=",chatImage:"=",submitButtonText:"@",title:"=",submitFunction:"&",isShow:"="},link:e,controller:t,controllerAs:"vm"};return i}function t(e){function t(){i.windowStyle={display:"none"},e.isShow=!1}function n(){o?(i.chatButtonClass="glyphicon glyphicon-chevron-down",i.panelStyle={display:"block"},o=!1):(i.chatButtonClass="glyphicon glyphicon-chevron-up",i.panelStyle={display:"none"},o=!0)}console.log(e.isShow);var i=this,o=!1;i.messages=e.messages,i.username=e.username,i.submitButtonText=e.submitButtonText,i.userImage=e.userImage,i.chatImage=e.chatImage,i.isShow=e.isShow,i.title=e.title,i.writingMessage="",i.submitFunction=function(){e.submitFunction()(i.writingMessage,i.username),i.writingMessage=""},i.windowStyle=1==e.isShow?{display:"block"}:{display:"none"},i.panelStyle={display:"block"},i.chatButtonClass="glyphicon glyphicon-chevron-down",i.toggle=n,i.close=t}angular.module("irontec.simpleChat",["luegg.directives"]),angular.module("irontec.simpleChat").directive("irontecSimpleChat",e),t.$inject=["$scope"]}(),function(e){e.color={},e.color.make=function(t,n,i,o){var r={};return r.r=t||0,r.g=n||0,r.b=i||0,r.a=null!=o?o:1,r.add=function(e,t){for(var n=0;n<e.length;++n)r[e.charAt(n)]+=t;return r.normalize()},r.scale=function(e,t){for(var n=0;n<e.length;++n)r[e.charAt(n)]*=t;return r.normalize()},r.toString=function(){return r.a>=1?"rgb("+[r.r,r.g,r.b].join(",")+")":"rgba("+[r.r,r.g,r.b,r.a].join(",")+")"},r.normalize=function(){function e(e,t,n){return e>t?e:t>n?n:t}return r.r=e(0,parseInt(r.r),255),r.g=e(0,parseInt(r.g),255),r.b=e(0,parseInt(r.b),255),r.a=e(0,r.a,1),r},r.clone=function(){return e.color.make(r.r,r.b,r.g,r.a)},r.normalize()},e.color.extract=function(t,n){var i;do{if(i=t.css(n).toLowerCase(),""!=i&&"transparent"!=i)break;t=t.parent()}while(t.length&&!e.nodeName(t.get(0),"body"));return"rgba(0, 0, 0, 0)"==i&&(i="transparent"),e.color.parse(i)},e.color.parse=function(n){var i,o=e.color.make;if(i=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))return o(parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10));if(i=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return o(parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10),parseFloat(i[4]));if(i=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n))return o(2.55*parseFloat(i[1]),2.55*parseFloat(i[2]),2.55*parseFloat(i[3]));if(i=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return o(2.55*parseFloat(i[1]),2.55*parseFloat(i[2]),2.55*parseFloat(i[3]),parseFloat(i[4]));if(i=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n))return o(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n))return o(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));var r=e.trim(n).toLowerCase();return"transparent"==r?o(255,255,255,0):(i=t[r]||[0,0,0],o(i[0],i[1],i[2]))};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){function t(t,n){var i=n.children("."+t)[0];if(null==i&&(i=document.createElement("canvas"),i.className=t,e(i).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(n),!i.getContext)){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");i=window.G_vmlCanvasManager.initElement(i)}this.element=i;var o=this.context=i.getContext("2d"),r=window.devicePixelRatio||1,s=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;this.pixelRatio=r/s,this.resize(n.width(),n.height()),this.textContainer=null,this.text={},this._textCache={}}function n(n,o,r,s){function a(e,t){t=[me].concat(t);for(var n=0;n<e.length;++n)e[n].apply(this,t)}function l(){for(var n={Canvas:t},i=0;i<s.length;++i){var o=s[i];o.init(me,n),o.options&&e.extend(!0,oe,o.options)}}function c(t){e.extend(!0,oe,t),t&&t.colors&&(oe.colors=t.colors),null==oe.xaxis.color&&(oe.xaxis.color=e.color.parse(oe.grid.color).scale("a",.22).toString()),null==oe.yaxis.color&&(oe.yaxis.color=e.color.parse(oe.grid.color).scale("a",.22).toString()),null==oe.xaxis.tickColor&&(oe.xaxis.tickColor=oe.grid.tickColor||oe.xaxis.color),null==oe.yaxis.tickColor&&(oe.yaxis.tickColor=oe.grid.tickColor||oe.yaxis.color),null==oe.grid.borderColor&&(oe.grid.borderColor=oe.grid.color),null==oe.grid.tickColor&&(oe.grid.tickColor=e.color.parse(oe.grid.color).scale("a",.22).toString());var i,o,r,s=n.css("font-size"),l=s?+s.replace("px",""):13,c={style:n.css("font-style"),size:Math.round(.8*l),variant:n.css("font-variant"),weight:n.css("font-weight"),family:n.css("font-family")};for(r=oe.xaxes.length||1,i=0;r>i;++i)o=oe.xaxes[i],o&&!o.tickColor&&(o.tickColor=o.color),o=e.extend(!0,{},oe.xaxis,o),oe.xaxes[i]=o,o.font&&(o.font=e.extend({},c,o.font),o.font.color||(o.font.color=o.color),o.font.lineHeight||(o.font.lineHeight=Math.round(1.15*o.font.size)));for(r=oe.yaxes.length||1,i=0;r>i;++i)o=oe.yaxes[i],o&&!o.tickColor&&(o.tickColor=o.color),o=e.extend(!0,{},oe.yaxis,o),oe.yaxes[i]=o,o.font&&(o.font=e.extend({},c,o.font),o.font.color||(o.font.color=o.color),o.font.lineHeight||(o.font.lineHeight=Math.round(1.15*o.font.size)));for(oe.xaxis.noTicks&&null==oe.xaxis.ticks&&(oe.xaxis.ticks=oe.xaxis.noTicks),oe.yaxis.noTicks&&null==oe.yaxis.ticks&&(oe.yaxis.ticks=oe.yaxis.noTicks),oe.x2axis&&(oe.xaxes[1]=e.extend(!0,{},oe.xaxis,oe.x2axis),oe.xaxes[1].position="top",null==oe.x2axis.min&&(oe.xaxes[1].min=null),null==oe.x2axis.max&&(oe.xaxes[1].max=null)),oe.y2axis&&(oe.yaxes[1]=e.extend(!0,{},oe.yaxis,oe.y2axis),oe.yaxes[1].position="right",null==oe.y2axis.min&&(oe.yaxes[1].min=null),null==oe.y2axis.max&&(oe.yaxes[1].max=null)),oe.grid.coloredAreas&&(oe.grid.markings=oe.grid.coloredAreas),oe.grid.coloredAreasColor&&(oe.grid.markingsColor=oe.grid.coloredAreasColor),oe.lines&&e.extend(!0,oe.series.lines,oe.lines),oe.points&&e.extend(!0,oe.series.points,oe.points),oe.bars&&e.extend(!0,oe.series.bars,oe.bars),null!=oe.shadowSize&&(oe.series.shadowSize=oe.shadowSize),null!=oe.highlightColor&&(oe.series.highlightColor=oe.highlightColor),i=0;i<oe.xaxes.length;++i)m(ue,i+1).options=oe.xaxes[i];for(i=0;i<oe.yaxes.length;++i)m(de,i+1).options=oe.yaxes[i];for(var u in ge)oe.hooks[u]&&oe.hooks[u].length&&(ge[u]=ge[u].concat(oe.hooks[u]));a(ge.processOptions,[oe])}function u(e){ie=d(e),v(),b()}function d(t){for(var n=[],i=0;i<t.length;++i){var o=e.extend(!0,{},oe.series);null!=t[i].data?(o.data=t[i].data,delete t[i].data,e.extend(!0,o,t[i]),t[i].data=o.data):o.data=t[i],n.push(o)}return n}function h(e,t){var n=e[t+"axis"];return"object"==typeof n&&(n=n.n),"number"!=typeof n&&(n=1),n}function p(){return e.grep(ue.concat(de),function(e){return e})}function f(e){var t,n,i={};for(t=0;t<ue.length;++t)n=ue[t],n&&n.used&&(i["x"+n.n]=n.c2p(e.left));for(t=0;t<de.length;++t)n=de[t],n&&n.used&&(i["y"+n.n]=n.c2p(e.top));return void 0!==i.x1&&(i.x=i.x1),void 0!==i.y1&&(i.y=i.y1),i}function g(e){var t,n,i,o={};for(t=0;t<ue.length;++t)if(n=ue[t],n&&n.used&&(i="x"+n.n,null==e[i]&&1==n.n&&(i="x"),null!=e[i])){o.left=n.p2c(e[i]);break}for(t=0;t<de.length;++t)if(n=de[t],n&&n.used&&(i="y"+n.n,null==e[i]&&1==n.n&&(i="y"),null!=e[i])){o.top=n.p2c(e[i]);break}return o}function m(t,n){return t[n-1]||(t[n-1]={n:n,direction:t==ue?"x":"y",options:e.extend(!0,{},t==ue?oe.xaxis:oe.yaxis)}),t[n-1]}function v(){var t,n=ie.length,i=-1;for(t=0;t<ie.length;++t){var o=ie[t].color;null!=o&&(n--,"number"==typeof o&&o>i&&(i=o))}i>=n&&(n=i+1);var r,s=[],a=oe.colors,l=a.length,c=0;for(t=0;n>t;t++)r=e.color.parse(a[t%l]||"#666"),t%l==0&&t&&(c=c>=0?.5>c?-c-.2:0:-c),s[t]=r.scale("rgb",1+c);var u,d=0;for(t=0;t<ie.length;++t){if(u=ie[t],null==u.color?(u.color=s[d].toString(),++d):"number"==typeof u.color&&(u.color=s[u.color].toString()),null==u.lines.show){var p,f=!0;for(p in u)if(u[p]&&u[p].show){f=!1;break}f&&(u.lines.show=!0)}null==u.lines.zero&&(u.lines.zero=!!u.lines.fill),u.xaxis=m(ue,h(u,"x")),u.yaxis=m(de,h(u,"y"))}}function b(){function t(e,t,n){t<e.datamin&&t!=-b&&(e.datamin=t),n>e.datamax&&n!=b&&(e.datamax=n)}var n,i,o,r,s,l,c,u,d,h,f,g,m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,b=Number.MAX_VALUE;for(e.each(p(),function(e,t){t.datamin=m,t.datamax=v,t.used=!1}),n=0;n<ie.length;++n)s=ie[n],s.datapoints={points:[]},a(ge.processRawData,[s,s.data,s.datapoints]);for(n=0;n<ie.length;++n){if(s=ie[n],f=s.data,g=s.datapoints.format,!g){if(g=[],g.push({x:!0,number:!0,required:!0}),g.push({y:!0,number:!0,required:!0}),s.bars.show||s.lines.show&&s.lines.fill){var y=!!(s.bars.show&&s.bars.zero||s.lines.show&&s.lines.zero);g.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:y}),s.bars.horizontal&&(delete g[g.length-1].y,g[g.length-1].x=!0)}s.datapoints.format=g}if(null==s.datapoints.pointsize){s.datapoints.pointsize=g.length,c=s.datapoints.pointsize,l=s.datapoints.points;var w=s.lines.show&&s.lines.steps;for(s.xaxis.used=s.yaxis.used=!0,i=o=0;i<f.length;++i,o+=c){h=f[i];var C=null==h;if(!C)for(r=0;c>r;++r)u=h[r],d=g[r],d&&(d.number&&null!=u&&(u=+u,isNaN(u)?u=null:u==1/0?u=b:u==-(1/0)&&(u=-b)),null==u&&(d.required&&(C=!0),null!=d.defaultValue&&(u=d.defaultValue))),l[o+r]=u;if(C)for(r=0;c>r;++r)u=l[o+r],null!=u&&(d=g[r],d.autoscale!==!1&&(d.x&&t(s.xaxis,u,u),d.y&&t(s.yaxis,u,u))),l[o+r]=null;else if(w&&o>0&&null!=l[o-c]&&l[o-c]!=l[o]&&l[o-c+1]!=l[o+1]){for(r=0;c>r;++r)l[o+c+r]=l[o+r];l[o+1]=l[o-c+1],o+=c}}}}for(n=0;n<ie.length;++n)s=ie[n],a(ge.processDatapoints,[s,s.datapoints]);for(n=0;n<ie.length;++n){s=ie[n],l=s.datapoints.points,c=s.datapoints.pointsize,g=s.datapoints.format;var _=m,x=m,S=v,k=v;for(i=0;i<l.length;i+=c)if(null!=l[i])for(r=0;c>r;++r)u=l[i+r],d=g[r],d&&d.autoscale!==!1&&u!=b&&u!=-b&&(d.x&&(_>u&&(_=u),u>S&&(S=u)),d.y&&(x>u&&(x=u),u>k&&(k=u)));if(s.bars.show){var T;switch(s.bars.align){case"left":T=0;break;case"right":T=-s.bars.barWidth;break;default:T=-s.bars.barWidth/2}s.bars.horizontal?(x+=T,k+=T+s.bars.barWidth):(_+=T,S+=T+s.bars.barWidth)}t(s.xaxis,_,S),t(s.yaxis,x,k)}e.each(p(),function(e,t){t.datamin==m&&(t.datamin=null),t.datamax==v&&(t.datamax=null)})}function y(){n.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),"static"==n.css("position")&&n.css("position","relative"),re=new t("flot-base",n),se=new t("flot-overlay",n),le=re.context,ce=se.context,ae=e(se.element).unbind();var i=n.data("plot");i&&(i.shutdown(),se.clear()),n.data("plot",me)}function w(){oe.grid.hoverable&&(ae.mousemove(z),ae.bind("mouseleave",q)),oe.grid.clickable&&ae.click(Y),a(ge.bindEvents,[ae])}function C(){be&&clearTimeout(be),ae.unbind("mousemove",z),ae.unbind("mouseleave",q),ae.unbind("click",Y),a(ge.shutdown,[ae])}function _(e){function t(e){return e}var n,i,o=e.options.transform||t,r=e.options.inverseTransform;"x"==e.direction?(n=e.scale=pe/Math.abs(o(e.max)-o(e.min)),i=Math.min(o(e.max),o(e.min))):(n=e.scale=fe/Math.abs(o(e.max)-o(e.min)),n=-n,i=Math.max(o(e.max),o(e.min))),e.p2c=o==t?function(e){return(e-i)*n}:function(e){return(o(e)-i)*n},e.c2p=r?function(e){return r(i+e/n)}:function(e){return i+e/n}}function x(e){for(var t=e.options,n=e.ticks||[],i=t.labelWidth||0,o=t.labelHeight||0,r=i||("x"==e.direction?Math.floor(re.width/(n.length||1)):null),s=e.direction+"Axis "+e.direction+e.n+"Axis",a="flot-"+e.direction+"-axis flot-"+e.direction+e.n+"-axis "+s,l=t.font||"flot-tick-label tickLabel",c=0;c<n.length;++c){var u=n[c];if(u.label){var d=re.getTextInfo(a,u.label,l,null,r);i=Math.max(i,d.width),o=Math.max(o,d.height)}}e.labelWidth=t.labelWidth||i,e.labelHeight=t.labelHeight||o}function S(t){var n=t.labelWidth,i=t.labelHeight,o=t.options.position,r="x"===t.direction,s=t.options.tickLength,a=oe.grid.axisMargin,l=oe.grid.labelMargin,c=!0,u=!0,d=!0,h=!1;e.each(r?ue:de,function(e,n){n&&(n.show||n.reserveSpace)&&(n===t?h=!0:n.options.position===o&&(h?u=!1:c=!1),h||(d=!1))}),u&&(a=0),null==s&&(s=d?"full":5),isNaN(+s)||(l+=+s),r?(i+=l,"bottom"==o?(he.bottom+=i+a,t.box={top:re.height-he.bottom,height:i}):(t.box={top:he.top+a,height:i},he.top+=i+a)):(n+=l,"left"==o?(t.box={left:he.left+a,width:n},he.left+=n+a):(he.right+=n+a,t.box={left:re.width-he.right,width:n})),t.position=o,t.tickLength=s,t.box.padding=l,t.innermost=c}function k(e){"x"==e.direction?(e.box.left=he.left-e.labelWidth/2,e.box.width=re.width-he.left-he.right+e.labelWidth):(e.box.top=he.top-e.labelHeight/2,e.box.height=re.height-he.bottom-he.top+e.labelHeight)}function T(){var t,n=oe.grid.minBorderMargin;if(null==n)for(n=0,t=0;t<ie.length;++t)n=Math.max(n,2*(ie[t].points.radius+ie[t].points.lineWidth/2));var i={left:n,right:n,top:n,bottom:n};e.each(p(),function(e,t){t.reserveSpace&&t.ticks&&t.ticks.length&&("x"===t.direction?(i.left=Math.max(i.left,t.labelWidth/2),i.right=Math.max(i.right,t.labelWidth/2)):(i.bottom=Math.max(i.bottom,t.labelHeight/2),i.top=Math.max(i.top,t.labelHeight/2)))}),he.left=Math.ceil(Math.max(i.left,he.left)),he.right=Math.ceil(Math.max(i.right,he.right)),he.top=Math.ceil(Math.max(i.top,he.top)),he.bottom=Math.ceil(Math.max(i.bottom,he.bottom))}function $(){var t,n=p(),i=oe.grid.show;for(var o in he){var r=oe.grid.margin||0;he[o]="number"==typeof r?r:r[o]||0}a(ge.processOffset,[he]);for(var o in he)he[o]+="object"==typeof oe.grid.borderWidth?i?oe.grid.borderWidth[o]:0:i?oe.grid.borderWidth:0;if(e.each(n,function(e,t){var n=t.options;t.show=null==n.show?t.used:n.show,t.reserveSpace=null==n.reserveSpace?t.show:n.reserveSpace,E(t)}),i){var s=e.grep(n,function(e){return e.show||e.reserveSpace});for(e.each(s,function(e,t){D(t),I(t),M(t,t.ticks),x(t)}),t=s.length-1;t>=0;--t)S(s[t]);T(),e.each(s,function(e,t){k(t)})}pe=re.width-he.left-he.right,fe=re.height-he.bottom-he.top,e.each(n,function(e,t){_(t)}),i&&N(),B()}function E(e){var t=e.options,n=+(null!=t.min?t.min:e.datamin),i=+(null!=t.max?t.max:e.datamax),o=i-n;if(0==o){var r=0==i?1:.01;null==t.min&&(n-=r),(null==t.max||null!=t.min)&&(i+=r)}else{var s=t.autoscaleMargin;null!=s&&(null==t.min&&(n-=o*s,0>n&&null!=e.datamin&&e.datamin>=0&&(n=0)),null==t.max&&(i+=o*s,i>0&&null!=e.datamax&&e.datamax<=0&&(i=0)))}e.min=n,e.max=i}function D(t){var n,o=t.options;n="number"==typeof o.ticks&&o.ticks>0?o.ticks:.3*Math.sqrt("x"==t.direction?re.width:re.height);var r=(t.max-t.min)/n,s=-Math.floor(Math.log(r)/Math.LN10),a=o.tickDecimals;null!=a&&s>a&&(s=a);var l,c=Math.pow(10,-s),u=r/c;if(1.5>u?l=1:3>u?(l=2,u>2.25&&(null==a||a>=s+1)&&(l=2.5,++s)):l=7.5>u?5:10,l*=c,null!=o.minTickSize&&l<o.minTickSize&&(l=o.minTickSize),t.delta=r,t.tickDecimals=Math.max(0,null!=a?a:s),t.tickSize=o.tickSize||l,"time"==o.mode&&!t.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");if(t.tickGenerator||(t.tickGenerator=function(e){var t,n=[],o=i(e.min,e.tickSize),r=0,s=Number.NaN;do t=s,s=o+r*e.tickSize,n.push(s),++r;while(s<e.max&&s!=t);return n},t.tickFormatter=function(e,t){var n=t.tickDecimals?Math.pow(10,t.tickDecimals):1,i=""+Math.round(e*n)/n;if(null!=t.tickDecimals){var o=i.indexOf("."),r=-1==o?0:i.length-o-1;if(r<t.tickDecimals)return(r?i:i+".")+(""+n).substr(1,t.tickDecimals-r)}return i}),e.isFunction(o.tickFormatter)&&(t.tickFormatter=function(e,t){return""+o.tickFormatter(e,t)}),null!=o.alignTicksWithAxis){var d=("x"==t.direction?ue:de)[o.alignTicksWithAxis-1];if(d&&d.used&&d!=t){var h=t.tickGenerator(t);if(h.length>0&&(null==o.min&&(t.min=Math.min(t.min,h[0])),null==o.max&&h.length>1&&(t.max=Math.max(t.max,h[h.length-1]))),t.tickGenerator=function(e){var t,n,i=[];for(n=0;n<d.ticks.length;++n)t=(d.ticks[n].v-d.min)/(d.max-d.min),t=e.min+t*(e.max-e.min),i.push(t);return i},!t.mode&&null==o.tickDecimals){var p=Math.max(0,-Math.floor(Math.log(t.delta)/Math.LN10)+1),f=t.tickGenerator(t);f.length>1&&/\..*0$/.test((f[1]-f[0]).toFixed(p))||(t.tickDecimals=p)}}}}function I(t){var n=t.options.ticks,i=[];null==n||"number"==typeof n&&n>0?i=t.tickGenerator(t):n&&(i=e.isFunction(n)?n(t):n);var o,r;for(t.ticks=[],o=0;o<i.length;++o){var s=null,a=i[o];"object"==typeof a?(r=+a[0],a.length>1&&(s=a[1])):r=+a,null==s&&(s=t.tickFormatter(r,t)),isNaN(r)||t.ticks.push({v:r,label:s})}}function M(e,t){e.options.autoscaleMargin&&t.length>0&&(null==e.options.min&&(e.min=Math.min(e.min,t[0].v)),null==e.options.max&&t.length>1&&(e.max=Math.max(e.max,t[t.length-1].v)))}function A(){re.clear(),a(ge.drawBackground,[le]);var e=oe.grid;e.show&&e.backgroundColor&&R(),e.show&&!e.aboveData&&P();for(var t=0;t<ie.length;++t)a(ge.drawSeries,[le,ie[t]]),L(ie[t]);a(ge.draw,[le]),e.show&&e.aboveData&&P(),re.render(),K()}function O(e,t){for(var n,i,o,r,s=p(),a=0;a<s.length;++a)if(n=s[a],n.direction==t&&(r=t+n.n+"axis",e[r]||1!=n.n||(r=t+"axis"),e[r])){i=e[r].from,o=e[r].to;break}if(e[r]||(n="x"==t?ue[0]:de[0],i=e[t+"1"],o=e[t+"2"]),null!=i&&null!=o&&i>o){var l=i;i=o,o=l}return{from:i,to:o,axis:n}}function R(){le.save(),le.translate(he.left,he.top),le.fillStyle=ne(oe.grid.backgroundColor,fe,0,"rgba(255, 255, 255, 0)"),le.fillRect(0,0,pe,fe),le.restore()}function P(){var t,n,i,o;le.save(),le.translate(he.left,he.top);var r=oe.grid.markings;if(r)for(e.isFunction(r)&&(n=me.getAxes(),n.xmin=n.xaxis.min,n.xmax=n.xaxis.max,n.ymin=n.yaxis.min,n.ymax=n.yaxis.max,r=r(n)),t=0;t<r.length;++t){var s=r[t],a=O(s,"x"),l=O(s,"y");if(null==a.from&&(a.from=a.axis.min),null==a.to&&(a.to=a.axis.max),null==l.from&&(l.from=l.axis.min),null==l.to&&(l.to=l.axis.max),!(a.to<a.axis.min||a.from>a.axis.max||l.to<l.axis.min||l.from>l.axis.max)){a.from=Math.max(a.from,a.axis.min),a.to=Math.min(a.to,a.axis.max),l.from=Math.max(l.from,l.axis.min),l.to=Math.min(l.to,l.axis.max);var c=a.from===a.to,u=l.from===l.to;if(!c||!u)if(a.from=Math.floor(a.axis.p2c(a.from)),a.to=Math.floor(a.axis.p2c(a.to)),l.from=Math.floor(l.axis.p2c(l.from)),l.to=Math.floor(l.axis.p2c(l.to)),c||u){var d=s.lineWidth||oe.grid.markingsLineWidth,h=d%2?.5:0;le.beginPath(),le.strokeStyle=s.color||oe.grid.markingsColor,le.lineWidth=d,c?(le.moveTo(a.to+h,l.from),le.lineTo(a.to+h,l.to)):(le.moveTo(a.from,l.to+h),le.lineTo(a.to,l.to+h)),le.stroke()}else le.fillStyle=s.color||oe.grid.markingsColor,le.fillRect(a.from,l.to,a.to-a.from,l.from-l.to)}}n=p(),i=oe.grid.borderWidth;for(var f=0;f<n.length;++f){var g,m,v,b,y=n[f],w=y.box,C=y.tickLength;if(y.show&&0!=y.ticks.length){for(le.lineWidth=1,"x"==y.direction?(g=0,m="full"==C?"top"==y.position?0:fe:w.top-he.top+("top"==y.position?w.height:0)):(m=0,g="full"==C?"left"==y.position?0:pe:w.left-he.left+("left"==y.position?w.width:0)),y.innermost||(le.strokeStyle=y.options.color,le.beginPath(),v=b=0,"x"==y.direction?v=pe+1:b=fe+1,1==le.lineWidth&&("x"==y.direction?m=Math.floor(m)+.5:g=Math.floor(g)+.5),le.moveTo(g,m),le.lineTo(g+v,m+b),le.stroke()),le.strokeStyle=y.options.tickColor,le.beginPath(),t=0;t<y.ticks.length;++t){var _=y.ticks[t].v;v=b=0,isNaN(_)||_<y.min||_>y.max||"full"==C&&("object"==typeof i&&i[y.position]>0||i>0)&&(_==y.min||_==y.max)||("x"==y.direction?(g=y.p2c(_),b="full"==C?-fe:C,"top"==y.position&&(b=-b)):(m=y.p2c(_),v="full"==C?-pe:C,"left"==y.position&&(v=-v)),1==le.lineWidth&&("x"==y.direction?g=Math.floor(g)+.5:m=Math.floor(m)+.5),le.moveTo(g,m),le.lineTo(g+v,m+b))}le.stroke()}}i&&(o=oe.grid.borderColor,"object"==typeof i||"object"==typeof o?("object"!=typeof i&&(i={top:i,right:i,bottom:i,left:i}),"object"!=typeof o&&(o={top:o,right:o,bottom:o,left:o}),i.top>0&&(le.strokeStyle=o.top,le.lineWidth=i.top,le.beginPath(),le.moveTo(0-i.left,0-i.top/2),le.lineTo(pe,0-i.top/2),le.stroke()),i.right>0&&(le.strokeStyle=o.right,le.lineWidth=i.right,le.beginPath(),le.moveTo(pe+i.right/2,0-i.top),le.lineTo(pe+i.right/2,fe),le.stroke()),i.bottom>0&&(le.strokeStyle=o.bottom,le.lineWidth=i.bottom,le.beginPath(),le.moveTo(pe+i.right,fe+i.bottom/2),le.lineTo(0,fe+i.bottom/2),le.stroke()),i.left>0&&(le.strokeStyle=o.left,le.lineWidth=i.left,le.beginPath(),le.moveTo(0-i.left/2,fe+i.bottom),le.lineTo(0-i.left/2,0),le.stroke())):(le.lineWidth=i,le.strokeStyle=oe.grid.borderColor,le.strokeRect(-i/2,-i/2,pe+i,fe+i))),le.restore()}function N(){e.each(p(),function(e,t){var n,i,o,r,s,a=t.box,l=t.direction+"Axis "+t.direction+t.n+"Axis",c="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+l,u=t.options.font||"flot-tick-label tickLabel";if(re.removeText(c),t.show&&0!=t.ticks.length)for(var d=0;d<t.ticks.length;++d)n=t.ticks[d],!n.label||n.v<t.min||n.v>t.max||("x"==t.direction?(r="center",i=he.left+t.p2c(n.v),"bottom"==t.position?o=a.top+a.padding:(o=a.top+a.height-a.padding,s="bottom")):(s="middle",o=he.top+t.p2c(n.v),"left"==t.position?(i=a.left+a.width-a.padding,r="right"):i=a.left+a.padding),re.addText(c,i,o,n.label,u,null,null,r,s))})}function L(e){e.lines.show&&F(e),e.bars.show&&H(e),e.points.show&&U(e)}function F(e){function t(e,t,n,i,o){var r=e.points,s=e.pointsize,a=null,l=null;le.beginPath();for(var c=s;c<r.length;c+=s){var u=r[c-s],d=r[c-s+1],h=r[c],p=r[c+1];if(null!=u&&null!=h){if(p>=d&&d<o.min){if(p<o.min)continue;u=(o.min-d)/(p-d)*(h-u)+u,d=o.min}else if(d>=p&&p<o.min){if(d<o.min)continue;h=(o.min-d)/(p-d)*(h-u)+u,p=o.min}if(d>=p&&d>o.max){if(p>o.max)continue;u=(o.max-d)/(p-d)*(h-u)+u,d=o.max}else if(p>=d&&p>o.max){if(d>o.max)continue;h=(o.max-d)/(p-d)*(h-u)+u,p=o.max}if(h>=u&&u<i.min){if(h<i.min)continue;d=(i.min-u)/(h-u)*(p-d)+d,u=i.min}else if(u>=h&&h<i.min){if(u<i.min)continue;p=(i.min-u)/(h-u)*(p-d)+d,h=i.min}if(u>=h&&u>i.max){if(h>i.max)continue;d=(i.max-u)/(h-u)*(p-d)+d,u=i.max}else if(h>=u&&h>i.max){if(u>i.max)continue;p=(i.max-u)/(h-u)*(p-d)+d,h=i.max}(u!=a||d!=l)&&le.moveTo(i.p2c(u)+t,o.p2c(d)+n),a=h,l=p,le.lineTo(i.p2c(h)+t,o.p2c(p)+n)}}le.stroke()}function n(e,t,n){for(var i=e.points,o=e.pointsize,r=Math.min(Math.max(0,n.min),n.max),s=0,a=!1,l=1,c=0,u=0;!(o>0&&s>i.length+o);){
s+=o;var d=i[s-o],h=i[s-o+l],p=i[s],f=i[s+l];if(a){if(o>0&&null!=d&&null==p){u=s,o=-o,l=2;continue}if(0>o&&s==c+o){le.fill(),a=!1,o=-o,l=1,s=c=u+o;continue}}if(null!=d&&null!=p){if(p>=d&&d<t.min){if(p<t.min)continue;h=(t.min-d)/(p-d)*(f-h)+h,d=t.min}else if(d>=p&&p<t.min){if(d<t.min)continue;f=(t.min-d)/(p-d)*(f-h)+h,p=t.min}if(d>=p&&d>t.max){if(p>t.max)continue;h=(t.max-d)/(p-d)*(f-h)+h,d=t.max}else if(p>=d&&p>t.max){if(d>t.max)continue;f=(t.max-d)/(p-d)*(f-h)+h,p=t.max}if(a||(le.beginPath(),le.moveTo(t.p2c(d),n.p2c(r)),a=!0),h>=n.max&&f>=n.max)le.lineTo(t.p2c(d),n.p2c(n.max)),le.lineTo(t.p2c(p),n.p2c(n.max));else if(h<=n.min&&f<=n.min)le.lineTo(t.p2c(d),n.p2c(n.min)),le.lineTo(t.p2c(p),n.p2c(n.min));else{var g=d,m=p;f>=h&&h<n.min&&f>=n.min?(d=(n.min-h)/(f-h)*(p-d)+d,h=n.min):h>=f&&f<n.min&&h>=n.min&&(p=(n.min-h)/(f-h)*(p-d)+d,f=n.min),h>=f&&h>n.max&&f<=n.max?(d=(n.max-h)/(f-h)*(p-d)+d,h=n.max):f>=h&&f>n.max&&h<=n.max&&(p=(n.max-h)/(f-h)*(p-d)+d,f=n.max),d!=g&&le.lineTo(t.p2c(g),n.p2c(h)),le.lineTo(t.p2c(d),n.p2c(h)),le.lineTo(t.p2c(p),n.p2c(f)),p!=m&&(le.lineTo(t.p2c(p),n.p2c(f)),le.lineTo(t.p2c(m),n.p2c(f)))}}}}le.save(),le.translate(he.left,he.top),le.lineJoin="round";var i=e.lines.lineWidth,o=e.shadowSize;if(i>0&&o>0){le.lineWidth=o,le.strokeStyle="rgba(0,0,0,0.1)";var r=Math.PI/18;t(e.datapoints,Math.sin(r)*(i/2+o/2),Math.cos(r)*(i/2+o/2),e.xaxis,e.yaxis),le.lineWidth=o/2,t(e.datapoints,Math.sin(r)*(i/2+o/4),Math.cos(r)*(i/2+o/4),e.xaxis,e.yaxis)}le.lineWidth=i,le.strokeStyle=e.color;var s=W(e.lines,e.color,0,fe);s&&(le.fillStyle=s,n(e.datapoints,e.xaxis,e.yaxis)),i>0&&t(e.datapoints,0,0,e.xaxis,e.yaxis),le.restore()}function U(e){function t(e,t,n,i,o,r,s,a){for(var l=e.points,c=e.pointsize,u=0;u<l.length;u+=c){var d=l[u],h=l[u+1];null==d||d<r.min||d>r.max||h<s.min||h>s.max||(le.beginPath(),d=r.p2c(d),h=s.p2c(h)+i,"circle"==a?le.arc(d,h,t,0,o?Math.PI:2*Math.PI,!1):a(le,d,h,t,o),le.closePath(),n&&(le.fillStyle=n,le.fill()),le.stroke())}}le.save(),le.translate(he.left,he.top);var n=e.points.lineWidth,i=e.shadowSize,o=e.points.radius,r=e.points.symbol;if(0==n&&(n=1e-4),n>0&&i>0){var s=i/2;le.lineWidth=s,le.strokeStyle="rgba(0,0,0,0.1)",t(e.datapoints,o,null,s+s/2,!0,e.xaxis,e.yaxis,r),le.strokeStyle="rgba(0,0,0,0.2)",t(e.datapoints,o,null,s/2,!0,e.xaxis,e.yaxis,r)}le.lineWidth=n,le.strokeStyle=e.color,t(e.datapoints,o,W(e.points,e.color),0,!1,e.xaxis,e.yaxis,r),le.restore()}function j(e,t,n,i,o,r,s,a,l,c,u){var d,h,p,f,g,m,v,b,y;c?(b=m=v=!0,g=!1,d=n,h=e,f=t+i,p=t+o,d>h&&(y=h,h=d,d=y,g=!0,m=!1)):(g=m=v=!0,b=!1,d=e+i,h=e+o,p=n,f=t,p>f&&(y=f,f=p,p=y,b=!0,v=!1)),h<s.min||d>s.max||f<a.min||p>a.max||(d<s.min&&(d=s.min,g=!1),h>s.max&&(h=s.max,m=!1),p<a.min&&(p=a.min,b=!1),f>a.max&&(f=a.max,v=!1),d=s.p2c(d),p=a.p2c(p),h=s.p2c(h),f=a.p2c(f),r&&(l.fillStyle=r(p,f),l.fillRect(d,f,h-d,p-f)),u>0&&(g||m||v||b)&&(l.beginPath(),l.moveTo(d,p),g?l.lineTo(d,f):l.moveTo(d,f),v?l.lineTo(h,f):l.moveTo(h,f),m?l.lineTo(h,p):l.moveTo(h,p),b?l.lineTo(d,p):l.moveTo(d,p),l.stroke()))}function H(e){function t(t,n,i,o,r,s){for(var a=t.points,l=t.pointsize,c=0;c<a.length;c+=l)null!=a[c]&&j(a[c],a[c+1],a[c+2],n,i,o,r,s,le,e.bars.horizontal,e.bars.lineWidth)}le.save(),le.translate(he.left,he.top),le.lineWidth=e.bars.lineWidth,le.strokeStyle=e.color;var n;switch(e.bars.align){case"left":n=0;break;case"right":n=-e.bars.barWidth;break;default:n=-e.bars.barWidth/2}var i=e.bars.fill?function(t,n){return W(e.bars,e.color,t,n)}:null;t(e.datapoints,n,n+e.bars.barWidth,i,e.xaxis,e.yaxis),le.restore()}function W(t,n,i,o){var r=t.fill;if(!r)return null;if(t.fillColor)return ne(t.fillColor,i,o,n);var s=e.color.parse(n);return s.a="number"==typeof r?r:.4,s.normalize(),s.toString()}function B(){if(null!=oe.legend.container?e(oe.legend.container).html(""):n.find(".legend").remove(),oe.legend.show){for(var t,i,o=[],r=[],s=!1,a=oe.legend.labelFormatter,l=0;l<ie.length;++l)t=ie[l],t.label&&(i=a?a(t.label,t):t.label,i&&r.push({label:i,color:t.color}));if(oe.legend.sorted)if(e.isFunction(oe.legend.sorted))r.sort(oe.legend.sorted);else if("reverse"==oe.legend.sorted)r.reverse();else{var c="descending"!=oe.legend.sorted;r.sort(function(e,t){return e.label==t.label?0:e.label<t.label!=c?1:-1})}for(var l=0;l<r.length;++l){var u=r[l];l%oe.legend.noColumns==0&&(s&&o.push("</tr>"),o.push("<tr>"),s=!0),o.push('<td class="legendColorBox"><div style="border:1px solid '+oe.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+u.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+u.label+"</td>")}if(s&&o.push("</tr>"),0!=o.length){var d='<table style="font-size:smaller;color:'+oe.grid.color+'">'+o.join("")+"</table>";if(null!=oe.legend.container)e(oe.legend.container).html(d);else{var h="",p=oe.legend.position,f=oe.legend.margin;null==f[0]&&(f=[f,f]),"n"==p.charAt(0)?h+="top:"+(f[1]+he.top)+"px;":"s"==p.charAt(0)&&(h+="bottom:"+(f[1]+he.bottom)+"px;"),"e"==p.charAt(1)?h+="right:"+(f[0]+he.right)+"px;":"w"==p.charAt(1)&&(h+="left:"+(f[0]+he.left)+"px;");var g=e('<div class="legend">'+d.replace('style="','style="position:absolute;'+h+";")+"</div>").appendTo(n);if(0!=oe.legend.backgroundOpacity){var m=oe.legend.backgroundColor;null==m&&(m=oe.grid.backgroundColor,m=m&&"string"==typeof m?e.color.parse(m):e.color.extract(g,"background-color"),m.a=1,m=m.toString());var v=g.children();e('<div style="position:absolute;width:'+v.width()+"px;height:"+v.height()+"px;"+h+"background-color:"+m+';"> </div>').prependTo(g).css("opacity",oe.legend.backgroundOpacity)}}}}}function V(e,t,n){var i,o,r,s=oe.grid.mouseActiveRadius,a=s*s+1,l=null;for(i=ie.length-1;i>=0;--i)if(n(ie[i])){var c=ie[i],u=c.xaxis,d=c.yaxis,h=c.datapoints.points,p=u.c2p(e),f=d.c2p(t),g=s/u.scale,m=s/d.scale;if(r=c.datapoints.pointsize,u.options.inverseTransform&&(g=Number.MAX_VALUE),d.options.inverseTransform&&(m=Number.MAX_VALUE),c.lines.show||c.points.show)for(o=0;o<h.length;o+=r){var v=h[o],b=h[o+1];if(null!=v&&!(v-p>g||-g>v-p||b-f>m||-m>b-f)){var y=Math.abs(u.p2c(v)-e),w=Math.abs(d.p2c(b)-t),C=y*y+w*w;a>C&&(a=C,l=[i,o/r])}}if(c.bars.show&&!l){var _,x;switch(c.bars.align){case"left":_=0;break;case"right":_=-c.bars.barWidth;break;default:_=-c.bars.barWidth/2}for(x=_+c.bars.barWidth,o=0;o<h.length;o+=r){var v=h[o],b=h[o+1],S=h[o+2];null!=v&&(ie[i].bars.horizontal?p<=Math.max(S,v)&&p>=Math.min(S,v)&&f>=b+_&&b+x>=f:p>=v+_&&v+x>=p&&f>=Math.min(S,b)&&f<=Math.max(S,b))&&(l=[i,o/r])}}}return l?(i=l[0],o=l[1],r=ie[i].datapoints.pointsize,{datapoint:ie[i].datapoints.points.slice(o*r,(o+1)*r),dataIndex:o,series:ie[i],seriesIndex:i}):null}function z(e){oe.grid.hoverable&&G("plothover",e,function(e){return 0!=e.hoverable})}function q(e){oe.grid.hoverable&&G("plothover",e,function(e){return!1})}function Y(e){G("plotclick",e,function(e){return 0!=e.clickable})}function G(e,t,i){var o=ae.offset(),r=t.pageX-o.left-he.left,s=t.pageY-o.top-he.top,a=f({left:r,top:s});a.pageX=t.pageX,a.pageY=t.pageY;var l=V(r,s,i);if(l&&(l.pageX=parseInt(l.series.xaxis.p2c(l.datapoint[0])+o.left+he.left,10),l.pageY=parseInt(l.series.yaxis.p2c(l.datapoint[1])+o.top+he.top,10)),oe.grid.autoHighlight){for(var c=0;c<ve.length;++c){var u=ve[c];u.auto!=e||l&&u.series==l.series&&u.point[0]==l.datapoint[0]&&u.point[1]==l.datapoint[1]||J(u.series,u.point)}l&&X(l.series,l.datapoint,e)}n.trigger(e,[a,l])}function K(){var e=oe.interaction.redrawOverlayInterval;return-1==e?void Q():void(be||(be=setTimeout(Q,e)))}function Q(){be=null,ce.save(),se.clear(),ce.translate(he.left,he.top);var e,t;for(e=0;e<ve.length;++e)t=ve[e],t.series.bars.show?te(t.series,t.point):ee(t.series,t.point);ce.restore(),a(ge.drawOverlay,[ce])}function X(e,t,n){if("number"==typeof e&&(e=ie[e]),"number"==typeof t){var i=e.datapoints.pointsize;t=e.datapoints.points.slice(i*t,i*(t+1))}var o=Z(e,t);-1==o?(ve.push({series:e,point:t,auto:n}),K()):n||(ve[o].auto=!1)}function J(e,t){if(null==e&&null==t)return ve=[],void K();if("number"==typeof e&&(e=ie[e]),"number"==typeof t){var n=e.datapoints.pointsize;t=e.datapoints.points.slice(n*t,n*(t+1))}var i=Z(e,t);-1!=i&&(ve.splice(i,1),K())}function Z(e,t){for(var n=0;n<ve.length;++n){var i=ve[n];if(i.series==e&&i.point[0]==t[0]&&i.point[1]==t[1])return n}return-1}function ee(t,n){var i=n[0],o=n[1],r=t.xaxis,s=t.yaxis,a="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString();if(!(i<r.min||i>r.max||o<s.min||o>s.max)){var l=t.points.radius+t.points.lineWidth/2;ce.lineWidth=l,ce.strokeStyle=a;var c=1.5*l;i=r.p2c(i),o=s.p2c(o),ce.beginPath(),"circle"==t.points.symbol?ce.arc(i,o,c,0,2*Math.PI,!1):t.points.symbol(ce,i,o,c,!1),ce.closePath(),ce.stroke()}}function te(t,n){var i,o="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString(),r=o;switch(t.bars.align){case"left":i=0;break;case"right":i=-t.bars.barWidth;break;default:i=-t.bars.barWidth/2}ce.lineWidth=t.bars.lineWidth,ce.strokeStyle=o,j(n[0],n[1],n[2]||0,i,i+t.bars.barWidth,function(){return r},t.xaxis,t.yaxis,ce,t.bars.horizontal,t.bars.lineWidth)}function ne(t,n,i,o){if("string"==typeof t)return t;for(var r=le.createLinearGradient(0,i,0,n),s=0,a=t.colors.length;a>s;++s){var l=t.colors[s];if("string"!=typeof l){var c=e.color.parse(o);null!=l.brightness&&(c=c.scale("rgb",l.brightness)),null!=l.opacity&&(c.a*=l.opacity),l=c.toString()}r.addColorStop(s/(a-1),l)}return r}var ie=[],oe={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},re=null,se=null,ae=null,le=null,ce=null,ue=[],de=[],he={left:0,right:0,top:0,bottom:0},pe=0,fe=0,ge={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},me=this;me.setData=u,me.setupGrid=$,me.draw=A,me.getPlaceholder=function(){return n},me.getCanvas=function(){return re.element},me.getPlotOffset=function(){return he},me.width=function(){return pe},me.height=function(){return fe},me.offset=function(){var e=ae.offset();return e.left+=he.left,e.top+=he.top,e},me.getData=function(){return ie},me.getAxes=function(){var t={};return e.each(ue.concat(de),function(e,n){n&&(t[n.direction+(1!=n.n?n.n:"")+"axis"]=n)}),t},me.getXAxes=function(){return ue},me.getYAxes=function(){return de},me.c2p=f,me.p2c=g,me.getOptions=function(){return oe},me.highlight=X,me.unhighlight=J,me.triggerRedrawOverlay=K,me.pointOffset=function(e){return{left:parseInt(ue[h(e,"x")-1].p2c(+e.x)+he.left,10),top:parseInt(de[h(e,"y")-1].p2c(+e.y)+he.top,10)}},me.shutdown=C,me.destroy=function(){C(),n.removeData("plot").empty(),ie=[],oe=null,re=null,se=null,ae=null,le=null,ce=null,ue=[],de=[],ge=null,ve=[],me=null},me.resize=function(){var e=n.width(),t=n.height();re.resize(e,t),se.resize(e,t)},me.hooks=ge,l(me),c(r),y(),u(o),$(),A(),w();var ve=[],be=null}function i(e,t){return t*Math.floor(e/t)}var o=Object.prototype.hasOwnProperty;e.fn.detach||(e.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),t.prototype.resize=function(e,t){if(0>=e||0>=t)throw new Error("Invalid dimensions for plot, width = "+e+", height = "+t);var n=this.element,i=this.context,o=this.pixelRatio;this.width!=e&&(n.width=e*o,n.style.width=e+"px",this.width=e),this.height!=t&&(n.height=t*o,n.style.height=t+"px",this.height=t),i.restore(),i.save(),i.scale(o,o)},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.render=function(){var e=this._textCache;for(var t in e)if(o.call(e,t)){var n=this.getTextLayer(t),i=e[t];n.hide();for(var r in i)if(o.call(i,r)){var s=i[r];for(var a in s)if(o.call(s,a)){for(var l,c=s[a].positions,u=0;l=c[u];u++)l.active?l.rendered||(n.append(l.element),l.rendered=!0):(c.splice(u--,1),l.rendered&&l.element.detach());0==c.length&&delete s[a]}}n.show()}},t.prototype.getTextLayer=function(t){var n=this.text[t];return null==n&&(null==this.textContainer&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),n=this.text[t]=e("<div></div>").addClass(t).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),n},t.prototype.getTextInfo=function(t,n,i,o,r){var s,a,l,c;if(n=""+n,s="object"==typeof i?i.style+" "+i.variant+" "+i.weight+" "+i.size+"px/"+i.lineHeight+"px "+i.family:i,a=this._textCache[t],null==a&&(a=this._textCache[t]={}),l=a[s],null==l&&(l=a[s]={}),c=l[n],null==c){var u=e("<div></div>").html(n).css({position:"absolute","max-width":r,top:-9999}).appendTo(this.getTextLayer(t));"object"==typeof i?u.css({font:s,color:i.color}):"string"==typeof i&&u.addClass(i),c=l[n]={width:u.outerWidth(!0),height:u.outerHeight(!0),element:u,positions:[]},u.detach()}return c},t.prototype.addText=function(e,t,n,i,o,r,s,a,l){var c=this.getTextInfo(e,i,o,r,s),u=c.positions;"center"==a?t-=c.width/2:"right"==a&&(t-=c.width),"middle"==l?n-=c.height/2:"bottom"==l&&(n-=c.height);for(var d,h=0;d=u[h];h++)if(d.x==t&&d.y==n)return void(d.active=!0);d={active:!0,rendered:!1,element:u.length?c.element.clone():c.element,x:t,y:n},u.push(d),d.element.css({top:Math.round(n),left:Math.round(t),"text-align":a})},t.prototype.removeText=function(e,t,n,i,r,s){if(null==i){var a=this._textCache[e];if(null!=a)for(var l in a)if(o.call(a,l)){var c=a[l];for(var u in c)if(o.call(c,u))for(var d,h=c[u].positions,p=0;d=h[p];p++)d.active=!1}}else for(var d,h=this.getTextInfo(e,i,r,s).positions,p=0;d=h[p];p++)d.x==t&&d.y==n&&(d.active=!1)},e.plot=function(t,i,o){var r=new n(e(t),i,o,e.plot.plugins);return r},e.plot.version="0.8.3",e.plot.plugins=[],e.fn.plot=function(t,n){return this.each(function(){e.plot(this,t,n)})}}(jQuery),function(e,t,n){"$:nomunge";function i(n){a===!0&&(a=n||1);for(var l=r.length-1;l>=0;l--){var h=e(r[l]);if(h[0]==t||h.is(":visible")){var p=h.width(),f=h.height(),g=h.data(u);!g||p===g.w&&f===g.h||(h.trigger(c,[g.w=p,g.h=f]),a=n||!0)}else g=h.data(u),g.w=0,g.h=0}null!==o&&(a&&(null==n||1e3>n-a)?o=t.requestAnimationFrame(i):(o=setTimeout(i,s[d]),a=!1))}var o,r=[],s=e.resize=e.extend(e.resize,{}),a=!1,l="setTimeout",c="resize",u=c+"-special-event",d="pendingDelay",h="activeDelay",p="throttleWindow";s[d]=200,s[h]=20,s[p]=!0,e.event.special[c]={setup:function(){if(!s[p]&&this[l])return!1;var t=e(this);r.push(this),t.data(u,{w:t.width(),h:t.height()}),1===r.length&&(o=n,i())},teardown:function(){if(!s[p]&&this[l])return!1;for(var t=e(this),n=r.length-1;n>=0;n--)if(r[n]==this){r.splice(n,1);break}t.removeData(u),r.length||(a?cancelAnimationFrame(o):clearTimeout(o),o=null)},add:function(t){function i(t,i,r){var s=e(this),a=s.data(u)||{};a.w=i!==n?i:s.width(),a.h=r!==n?r:s.height(),o.apply(this,arguments)}if(!s[p]&&this[l])return!1;var o;return e.isFunction(t)?(o=t,i):(o=t.handler,void(t.handler=i))}},t.requestAnimationFrame||(t.requestAnimationFrame=function(){return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,n){return t.setTimeout(function(){e((new Date).getTime())},s[h])}}()),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(){return t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout}())}(jQuery,this),function(e){function t(e){function t(){var t=e.getPlaceholder();0!=t.width()&&0!=t.height()&&(e.resize(),e.setupGrid(),e.draw())}function n(e,n){e.getPlaceholder().resize(t)}function i(e,n){e.getPlaceholder().unbind("resize",t)}e.hooks.bindEvents.push(n),e.hooks.shutdown.push(i)}var n={};e.plot.plugins.push({init:t,options:n,name:"resize",version:"1.0"})}(jQuery),function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),o=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+o)},o);return e=i+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),angular.module("angular-svg-round-progress",[]),angular.module("angular-svg-round-progress").constant("roundProgressConfig",{max:50,semi:!1,rounded:!1,radius:100,color:"#45ccce",bgcolor:"#eaeaea",stroke:15,iterations:50,animation:"easeOutCubic"}),angular.module("angular-svg-round-progress").service("roundProgressService",[function(){var e={};e.isSupported=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var t=function(e,t,n,i){var o=(i-90)*Math.PI/180;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}};return e.updateState=function(e,n,i,o,r,s){if(!r)return o;var e=e>=n?n-1e-5:e,a=s?180:359.9999,l=0===n?0:e/n*a,c=r/2,u=t(c,c,i,l),d=t(c,c,i,0),h=180>=l?"0":"1",p=["M",u.x,u.y,"A",i,i,0,h,0,d.x,d.y].join(" ");return o.attr("d",p)},e.animations={linearEase:function(e,t,n,i){return n*e/i+t},easeInQuad:function(e,t,n,i){return n*(e/=i)*e+t},easeOutQuad:function(e,t,n,i){return-n*(e/=i)*(e-2)+t},easeInOutQuad:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,i){return n*(e/=i)*e*e+t},easeOutCubic:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t},easeInOutCubic:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,n,i){return n*(e/=i)*e*e*e+t},easeOutQuart:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},easeOutQuint:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t},easeOutSine:function(e,t,n,i){return n*Math.sin(e/i*(Math.PI/2))+t},easeInOutSine:function(e,t,n,i){return-n/2*(Math.cos(Math.PI*e/i)-1)+t},easeInExpo:function(e,t,n,i){return 0==e?t:n*Math.pow(2,10*(e/i-1))+t},easeOutExpo:function(e,t,n,i){return e==i?t+n:n*(-Math.pow(2,-10*e/i)+1)+t},easeInOutExpo:function(e,t,n,i){return 0==e?t:e==i?t+n:(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t},easeInCirc:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t},easeOutCirc:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t},easeInOutCirc:function(e,t,n,i){return(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(e,t,n,i){var o=1.70158,r=0,s=n;if(0==e)return t;if(1==(e/=i))return t+n;if(r||(r=.3*i),s<Math.abs(n)){s=n;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(n/s);return-(s*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-o)*Math.PI/r))+t},easeOutElastic:function(e,t,n,i){var o=1.70158,r=0,s=n;if(0==e)return t;if(1==(e/=i))return t+n;if(r||(r=.3*i),s<Math.abs(n)){s=n;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(n/s);return s*Math.pow(2,-10*e)*Math.sin(2*(e*i-o)*Math.PI/r)+n+t},easeInOutElastic:function(e,t,n,i){var o=1.70158,r=0,s=n;if(0==e)return t;if(2==(e/=i/2))return t+n;if(r||(r=.3*i*1.5),s<Math.abs(n)){s=n;var o=r/4}else var o=r/(2*Math.PI)*Math.asin(n/s);return 1>e?-.5*s*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-o)*Math.PI/r)+t:s*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*i-o)*Math.PI/r)*.5+n+t},easeInBack:function(e,t,n,i,o){return void 0==o&&(o=1.70158),n*(e/=i)*e*((o+1)*e-o)+t},easeOutBack:function(e,t,n,i,o){return void 0==o&&(o=1.70158),n*((e=e/i-1)*e*((o+1)*e+o)+1)+t},easeInOutBack:function(e,t,n,i,o){return void 0==o&&(o=1.70158),(e/=i/2)<1?n/2*e*e*(((o*=1.525)+1)*e-o)+t:n/2*((e-=2)*e*(((o*=1.525)+1)*e+o)+2)+t},easeInBounce:function(t,n,i,o){return i-e.animations.easeOutBounce(o-t,0,i,o)+n},easeOutBounce:function(e,t,n,i){return(e/=i)<1/2.75?7.5625*n*e*e+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(t,n,i,o){return o/2>t?.5*e.animations.easeInBounce(2*t,0,i,o)+n:.5*e.animations.easeOutBounce(2*t-o,0,i,o)+.5*i+n}},e}]),angular.module("angular-svg-round-progress").directive("roundProgress",["roundProgressService","roundProgressConfig",function(e,t){return e.isSupported?{restrict:"EA",scope:{current:"@",max:"=",semi:"=",rounded:"=",radius:"@",color:"@",bgcolor:"@",stroke:"@",iterations:"@",animation:"@"},link:function(n,i,o){var r,s,a=i.find("path"),l=i.find("circle"),c=angular.copy(t),u=function(){var e=c.semi,t=parseInt(c.radius),n=parseInt(c.stroke);r=2*t+2*n,i.css({width:r+"px",height:(e?r/2:r)+"px",overflow:"hidden"}),a.css({stroke:c.color,"stroke-width":n,"stroke-linecap":c.rounded?"round":"butt"}).attr("transform",e?"translate(0,"+r+") rotate(-90)":""),l.attr({cx:t+n,cy:t+n,r:t}).css({stroke:c.bgcolor,"stroke-width":n})},d=function(t,i){if(!angular.isDefined(t))return!1;if(0>t)return s=i,n.current=0;if(t>c.max)return s=i,n.current=c.max;var o=c.max,l=c.radius,u=c.semi,d=e.animations[c.animation],h=i===t?0:i||0,p=t-h,f=0,g=parseInt(c.iterations);angular.isNumber(s)&&(h=s,p=t-s,s=null),function m(){e.updateState(d(f,h,p,g),o,l,a,r,u),g>f&&(requestAnimationFrame(m),f++)}()};n.$watchCollection("[current, max, semi, rounded, radius, color, bgcolor, stroke, iterations]",function(e,t,n){angular.forEach(n,function(e,t){t.indexOf("$")&&n!==e&&angular.isDefined(e)&&(c[t]=e)}),u(),d(e[0],t[0])})},replace:!0,template:['<svg class="round-progress" xmlns="http://www.w3.org/2000/svg">','<circle fill="none"/>','<path fill="none"/>',"</svg>"].join("\n")}:{restrict:"EA",template:'<div class="round-progress"></div>',replace:!0}}]),angular.module("angular-flot",[]).directive("flot",function(){return{restrict:"EA",template:"<div></div>",scope:{dataset:"=",options:"=",callback:"="},link:function(e,t,n){var i,o,r,s,a,l,c,u,d;if(a=null,c=n.width||"100%",i=n.height||"100%",(null!=(u=e.options)&&null!=(d=u.legend)?d.container:void 0)instanceof jQuery)throw'Please use a jQuery expression string with the "legend.container" option.';return e.dataset||(e.dataset=[]),e.options||(e.options={legend:{show:!1}}),l=$(t.children()[0]),l.css({width:c,height:i}),o=function(){var t;return t=$.plot(l,e.dataset,e.options),e.callback&&e.callback(t),t},r=function(e){return a?(a.setData(e),a.setupGrid(),a.draw()):a=o()},e.$watch("dataset",r,!0),s=function(){return a=o()},l.bind("plothover",function(e,t,n){if($("<div id='tooltip'></div>").css({position:"absolute",display:"none",border:"1px solid #fdd",padding:"2px","background-color":"#fee",opacity:.8}).appendTo("body"),n){var i=(n.datapoint[0],n.datapoint[1]);$("#tooltip").html(n.series.label+" = "+i).css({top:n.pageY+5,left:n.pageX+5}).fadeIn(200)}else $("#tooltip").hide()}),e.$watch("options",s,!0)}}}),!function(){"use strict";var e={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isControl:function(t){var n=t.which;switch(n){case e.SHIFT:case e.CTRL:case e.ALT:return!0}return t.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e},isVerticalMovement:function(t){return~[e.UP,e.DOWN].indexOf(t)},isHorizontalMovement:function(t){return~[e.LEFT,e.RIGHT,e.BACKSPACE,e.DELETE].indexOf(t)}};void 0===angular.element.prototype.querySelectorAll&&(angular.element.prototype.querySelectorAll=function(e){return angular.element(this[0].querySelectorAll(e))}),angular.module("ui.select",[]).constant("uiSelectConfig",{theme:"bootstrap",searchEnabled:!0,placeholder:"",refreshDelay:1e3}).service("uiSelectMinErr",function(){var e=angular.$$minErr("ui.select");return function(){var t=e.apply(this,arguments),n=t.message.replace(new RegExp("\nhttp://errors.angularjs.org/.*"),"");return new Error(n)}}).service("RepeatParser",["uiSelectMinErr","$parse",function(e,t){var n=this;n.parse=function(n){var i=n.match(/^\s*(?:([\s\S]+?)\s+as\s+)?([\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!i)throw e("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);return{itemName:i[2],source:t(i[3]),trackByExp:i[4],modelMapper:t(i[1]||i[2])}},n.getGroupNgRepeatExpression=function(){return"$group in $select.groups"},n.getNgRepeatExpression=function(e,t,n,i){var o=e+" in "+(i?"$group.items":t);return n&&(o+=" track by "+n),o}}]).controller("uiSelectCtrl",["$scope","$element","$timeout","RepeatParser","uiSelectMinErr",function(t,n,i,o,r){function s(){d.resetSearchInput&&(d.search=h,d.selected&&d.items.length&&!d.multiple&&(d.activeIndex=d.items.indexOf(d.selected)))}function a(t){var n=!0;switch(t){case e.DOWN:!d.open&&d.multiple?d.activate(!1,!0):d.activeIndex<d.items.length-1&&d.activeIndex++;break;case e.UP:!d.open&&d.multiple?d.activate(!1,!0):d.activeIndex>0&&d.activeIndex--;break;case e.TAB:d.multiple||d.select(d.items[d.activeIndex]);break;case e.ENTER:d.open?d.select(d.items[d.activeIndex]):d.activate(!1,!0);break;case e.ESC:d.close();break;default:n=!1}return n}function l(t){function n(){switch(t){case e.LEFT:return~d.activeMatchIndex?u:s;case e.RIGHT:return~d.activeMatchIndex&&a!==s?l:(d.activate(),!1);case e.BACKSPACE:return~d.activeMatchIndex?(d.removeChoice(a),u):s;case e.DELETE:return~d.activeMatchIndex?(d.removeChoice(d.activeMatchIndex),a):!1}}var i=c(p[0]),o=d.selected.length,r=0,s=o-1,a=d.activeMatchIndex,l=d.activeMatchIndex+1,u=d.activeMatchIndex-1,h=a;return i>0||d.search.length&&t==e.RIGHT?!1:(d.close(),h=n(),d.activeMatchIndex=d.selected.length&&h!==!1?Math.min(s,Math.max(r,h)):-1,!0)}function c(e){return angular.isNumber(e.selectionStart)?e.selectionStart:e.value.length}function u(){var e=n.querySelectorAll(".ui-select-choices-content"),t=e.querySelectorAll(".ui-select-choices-row");if(t.length<1)throw r("choices","Expected multiple .ui-select-choices-row but got '{0}'.",t.length);var i=t[d.activeIndex],o=i.offsetTop+i.clientHeight-e[0].scrollTop,s=e[0].offsetHeight;o>s?e[0].scrollTop+=o-s:o<i.clientHeight&&(d.isGrouped&&0===d.activeIndex?e[0].scrollTop=0:e[0].scrollTop-=i.clientHeight-o)}var d=this,h="";d.placeholder=void 0,d.search=h,d.activeIndex=0,d.activeMatchIndex=-1,d.items=[],d.selected=void 0,d.open=!1,d.focus=!1,d.focusser=void 0,d.disabled=void 0,d.searchEnabled=void 0,d.resetSearchInput=void 0,d.refreshDelay=void 0,d.multiple=!1,d.isEmpty=function(){return angular.isUndefined(d.selected)||null===d.selected||""===d.selected};var p=n.querySelectorAll("input.ui-select-search");if(1!==p.length)throw r("searchInput","Expected 1 input.ui-select-search but got '{0}'.",p.length);d.activate=function(e,t){d.disabled||d.open||(t||s(),d.open=!0,d.activeMatchIndex=-1,d.activeIndex=d.activeIndex>=d.items.length?0:d.activeIndex,i(function(){d.search=e||d.search,p[0].focus()}))},d.findGroupByName=function(e){return d.groups&&d.groups.filter(function(t){return t.name===e})[0]},d.parseRepeatAttr=function(e,n){function i(e){d.groups=[],angular.forEach(e,function(e){var i=t.$eval(n),o=angular.isFunction(i)?i(e):e[i],r=d.findGroupByName(o);r?r.items.push(e):d.groups.push({name:o,items:[e]})}),d.items=[],d.groups.forEach(function(e){d.items=d.items.concat(e.items)})}function s(e){d.items=e}var a=n?i:s;d.parserResult=o.parse(e),d.isGrouped=!!n,d.itemProperty=d.parserResult.itemName,t.$watchCollection(d.parserResult.source,function(e){if(void 0===e||null===e)d.items=[];else{if(!angular.isArray(e))throw r("items","Expected an array but got '{0}'.",e);if(d.multiple){var t=e.filter(function(e){return d.selected.indexOf(e)<0});a(t)}else a(e);d.ngModel.$modelValue=null}}),d.multiple&&t.$watchCollection("$select.selected",function(e){if(e){var n=d.parserResult.source(t),i=n.filter(function(t){return e.indexOf(t)<0});a(i)}})};var f;d.refresh=function(e){void 0!==e&&(f&&i.cancel(f),f=i(function(){t.$eval(e)},d.refreshDelay))},d.setActiveItem=function(e){d.activeIndex=d.items.indexOf(e)},d.isActive=function(e){return d.items.indexOf(e[d.itemProperty])===d.activeIndex},d.select=function(e){var n={};n[d.parserResult.itemName]=e,d.onSelectCallback(t,{$item:e,$model:d.parserResult.modelMapper(t,n)}),d.multiple?(d.selected.push(e),d.sizeSearchInput()):d.selected=e,d.close()},d.close=function(){d.open&&(s(),d.open=!1,i(function(){d.focusser[0].focus()},0,!1))},d.removeChoice=function(e){d.selected.splice(e,1),d.activeMatchIndex=-1,d.sizeSearchInput()},d.getPlaceholder=function(){return d.multiple&&d.selected.length?void 0:d.placeholder},d.sizeSearchInput=function(){var e=p[0],t=p.parent().parent()[0];p.css("width","10px"),i(function(){var n=t.clientWidth-e.offsetLeft-10;50>n&&(n=t.clientWidth),p.css("width",n+"px")},0,!1)},p.on("keydown",function(n){var i=n.which;t.$apply(function(){var t=!1;d.multiple&&e.isHorizontalMovement(i)&&(t=l(i)),!t&&d.items.length>0&&(t=a(i)),t&&i!=e.TAB&&(n.preventDefault(),n.stopPropagation())}),e.isVerticalMovement(i)&&d.items.length>0&&u()}),p.on("blur",function(){i(function(){d.activeMatchIndex=-1,d.activeIndex=0})}),t.$on("$destroy",function(){p.off("keydown blur")})}]).directive("uiSelect",["$document","uiSelectConfig","uiSelectMinErr","$compile","$parse",function(t,n,i,o,r){return{restrict:"EA",templateUrl:function(e,t){var i=t.theme||n.theme;return i+(angular.isDefined(t.multiple)?"/select-multiple.tpl.html":"/select.tpl.html")},replace:!0,transclude:!0,require:["uiSelect","ngModel"],scope:!0,controller:"uiSelectCtrl",controllerAs:"$select",link:function(n,s,a,l,c){function u(e){var t=!1;t=window.jQuery?window.jQuery.contains(s[0],e.target):s[0].contains(e.target),t||(d.close(),n.$digest())}var d=l[0],h=l[1];d.multiple=angular.isDefined(a.multiple),d.onSelectCallback=r(a.onSelect),h.$parsers.unshift(function(e){var t,i={};if(d.multiple){for(var o=[],r=e.length-1;r>=0;r--)i={},i[d.parserResult.itemName]=e[r],t=d.parserResult.modelMapper(n,i),o.unshift(t);return o}return i={},i[d.parserResult.itemName]=e,t=d.parserResult.modelMapper(n,i)}),h.$formatters.unshift(function(e){var t,i=d.parserResult.source(n,{$select:{search:""}}),o={};if(i){if(d.multiple){var r=[],s=function(e,i){if(e&&e.length){for(var s=e.length-1;s>=0;s--)if(o[d.parserResult.itemName]=e[s],t=d.parserResult.modelMapper(n,o),t==i)return r.unshift(e[s]),!0;return!1}};if(!e)return r;for(var a=e.length-1;a>=0;a--)s(d.selected,e[a])||s(i,e[a]);return r}var l=function(i){return o[d.parserResult.itemName]=i,t=d.parserResult.modelMapper(n,o),t==e};if(d.selected&&l(d.selected))return d.selected;for(var c=i.length-1;c>=0;c--)if(l(i[c]))return i[c]}return e}),d.ngModel=h;var p=angular.element("<input ng-disabled='$select.disabled' class='ui-select-focusser ui-select-offscreen' type='text' aria-haspopup='true' role='button' />");o(p)(n),d.focusser=p,d.multiple||(s.append(p),p.bind("focus",function(){n.$evalAsync(function(){d.focus=!0;

})}),p.bind("blur",function(){n.$evalAsync(function(){d.focus=!1})}),p.bind("keydown",function(t){return t.which===e.BACKSPACE?(t.preventDefault(),t.stopPropagation(),d.select(void 0),void n.$digest()):void(t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||((t.which==e.DOWN||t.which==e.UP||t.which==e.ENTER||t.which==e.SPACE)&&(t.preventDefault(),t.stopPropagation(),d.activate()),n.$digest()))}),p.bind("keyup input",function(t){t.which===e.TAB||e.isControl(t)||e.isFunctionKey(t)||t.which===e.ESC||t.which==e.ENTER||t.which===e.BACKSPACE||(d.activate(p.val()),p.val(""),n.$digest())})),n.$watch("searchEnabled",function(){var e=n.$eval(a.searchEnabled);d.searchEnabled=void 0!==e?e:!0}),a.$observe("disabled",function(){d.disabled=void 0!==a.disabled?a.disabled:!1}),a.$observe("resetSearchInput",function(){var e=n.$eval(a.resetSearchInput);d.resetSearchInput=void 0!==e?e:!0}),d.multiple?(n.$watchCollection("$select.selected",function(e){h.$setViewValue(e,null,!0)}),p.prop("disabled",!0)):n.$watch("$select.selected",function(e){h.$viewValue!==e&&h.$setViewValue(e)}),h.$render=function(){if(d.multiple&&!angular.isArray(h.$viewValue)){if(!angular.isUndefined(h.$viewValue)&&null!==h.$viewValue)throw i("multiarr","Expected model value to be array but got '{0}'",h.$viewValue);d.selected=[]}d.selected=h.$viewValue},t.on("click",u),n.$on("$destroy",function(){t.off("click",u)}),c(n,function(e){var t=angular.element("<div>").append(e),n=t.querySelectorAll(".ui-select-match");if(n.removeAttr("ui-select-match"),1!==n.length)throw i("transcluded","Expected 1 .ui-select-match but got '{0}'.",n.length);s.querySelectorAll(".ui-select-match").replaceWith(n);var o=t.querySelectorAll(".ui-select-choices");if(o.removeAttr("ui-select-choices"),1!==o.length)throw i("transcluded","Expected 1 .ui-select-choices but got '{0}'.",o.length);s.querySelectorAll(".ui-select-choices").replaceWith(o)})}}}]).directive("uiSelectChoices",["uiSelectConfig","RepeatParser","uiSelectMinErr","$compile",function(e,t,n,i){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme;return n+"/choices.tpl.html"},compile:function(o,r){if(!r.repeat)throw n("repeat","Expected 'repeat' expression.");return function(o,r,s,a,l){var c=s.groupBy;if(a.parseRepeatAttr(s.repeat,c),c){var u=r.querySelectorAll(".ui-select-choices-group");if(1!==u.length)throw n("rows","Expected 1 .ui-select-choices-group but got '{0}'.",u.length);u.attr("ng-repeat",t.getGroupNgRepeatExpression())}var d=r.querySelectorAll(".ui-select-choices-row");if(1!==d.length)throw n("rows","Expected 1 .ui-select-choices-row but got '{0}'.",d.length);d.attr("ng-repeat",t.getNgRepeatExpression(a.parserResult.itemName,"$select.items",a.parserResult.trackByExp,c)).attr("ng-mouseenter","$select.setActiveItem("+a.parserResult.itemName+")").attr("ng-click","$select.select("+a.parserResult.itemName+")");var h=r.querySelectorAll(".ui-select-choices-row-inner");if(1!==h.length)throw n("rows","Expected 1 .ui-select-choices-row-inner but got '{0}'.",h.length);h.attr("uis-transclude-append",""),i(r,l)(o),o.$watch("$select.search",function(e){e&&!a.open&&a.multiple&&a.activate(!1,!0),a.activeIndex=0,a.refresh(s.refresh)}),s.$observe("refreshDelay",function(){var t=o.$eval(s.refreshDelay);a.refreshDelay=void 0!==t?t:e.refreshDelay})}}}}]).directive("uisTranscludeAppend",function(){return{link:function(e,t,n,i,o){o(e,function(e){t.append(e)})}}}).directive("uiSelectMatch",["uiSelectConfig",function(e){return{restrict:"EA",require:"^uiSelect",replace:!0,transclude:!0,templateUrl:function(t){var n=t.parent().attr("theme")||e.theme,i=t.parent().attr("multiple");return n+(i?"/match-multiple.tpl.html":"/match.tpl.html")},link:function(t,n,i,o){i.$observe("placeholder",function(t){o.placeholder=void 0!==t?t:e.placeholder}),o.multiple&&o.sizeSearchInput()}}}]).filter("highlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,n){return n&&t?t.replace(new RegExp(e(n),"gi"),'<span class="ui-select-highlight">$&</span>'):t}})}(),angular.module("ui.select").run(["$templateCache",function(e){e.put("bootstrap/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content dropdown-menu" role="menu" aria-labelledby="dLabel" ng-show="$select.items.length > 0"><li class="ui-select-choices-group"><div class="divider" ng-show="$select.isGrouped && $index > 0"></div><div ng-show="$select.isGrouped" class="ui-select-choices-group-label dropdown-header">{{$group.name}}</div><div class="ui-select-choices-row" ng-class="{active: $select.isActive(this)}"><a href="javascript:void(0)" class="ui-select-choices-row-inner"></a></div></li></ul>'),e.put("bootstrap/match-multiple.tpl.html",'<span class="ui-select-match"><span ng-repeat="$item in $select.selected"><button style="margin-right: 3px;" class="ui-select-match-item btn btn-default btn-xs" tabindex="-1" ng-disabled="$select.disabled" ng-click="$select.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$select.activeMatchIndex === $index}"><span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$select.removeChoice($index)">&nbsp;&times;</span> <span uis-transclude-append=""></span></button></span></span>'),e.put("bootstrap/match.tpl.html",'<button type="button" class="btn btn-default form-control ui-select-match" tabindex="-1" ng-hide="$select.open" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}" ;="" ng-click="$select.activate()"><span ng-show="$select.searchEnabled && $select.isEmpty()" class="text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" ng-transclude=""></span> <span class="caret"></span></button>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$select.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-click="$select.activate()" ng-model="$select.search"></div><div class="ui-select-choices"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" class="form-control ui-select-search" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.searchEnabled && $select.open"><div class="ui-select-choices"></div></div>'),e.put("select2/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content select2-results"><li class="ui-select-choices-group" ng-class="{\'select2-result-with-children\': $select.isGrouped}"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label select2-result-label">{{$group.name}}</div><ul ng-class="{\'select2-result-sub\': $select.isGrouped, \'select2-result-single\': !$select.isGrouped}"><li class="ui-select-choices-row" ng-class="{\'select2-highlighted\': $select.isActive(this)}"><div class="select2-result-label ui-select-choices-row-inner"></div></li></ul></li></ul>'),e.put("select2/match-multiple.tpl.html",'<span class="ui-select-match"><li class="ui-select-match-item select2-search-choice" ng-repeat="$item in $select.selected" ng-class="{\'select2-search-choice-focus\':$select.activeMatchIndex === $index}"><span uis-transclude-append=""></span> <a href="#" class="ui-select-match-close select2-search-choice-close" ng-click="$select.removeChoice($index)" tabindex="-1"></a></li></span>'),e.put("select2/match.tpl.html",'<a class="select2-choice ui-select-match" ng-class="{\'select2-default\': $select.isEmpty()}" ng-click="$select.activate()"><span ng-show="$select.searchEnabled && $select.isEmpty()" class="select2-chosen">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="select2-chosen" ng-transclude=""></span> <span class="select2-arrow"><b></b></span></a>'),e.put("select2/select-multiple.tpl.html",'<div class="ui-select-multiple select2 select2-container select2-container-multi" ng-class="{\'select2-container-active select2-dropdown-open\': $select.open,\n                \'select2-container-disabled\': $select.disabled}"><ul class="select2-choices"><span class="ui-select-match"></span><li class="select2-search-field"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input ui-select-search" placeholder="{{$select.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-model="$select.search" ng-click="$select.activate()" style="width: 34px;"></li></ul><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="ui-select-choices"></div></div></div>'),e.put("select2/select.tpl.html",'<div class="select2 select2-container" ng-class="{\'select2-container-active select2-dropdown-open\': $select.open,\n                \'select2-container-disabled\': $select.disabled,\n                \'select2-container-active\': $select.focus }"><div class="ui-select-match"></div><div class="select2-drop select2-with-searchbox select2-drop-active" ng-class="{\'select2-display-none\': !$select.open}"><div class="select2-search" ng-show="$select.searchEnabled"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search select2-input" ng-model="$select.search"></div><div class="ui-select-choices"></div></div></div>'),e.put("selectize/choices.tpl.html",'<div ng-show="$select.open" class="ui-select-choices selectize-dropdown single"><div class="ui-select-choices-content selectize-dropdown-content"><div class="ui-select-choices-group optgroup"><div ng-show="$select.isGrouped" class="ui-select-choices-group-label optgroup-header">{{$group.name}}</div><div class="ui-select-choices-row" ng-class="{active: $select.isActive(this)}"><div class="option ui-select-choices-row-inner" data-selectable=""></div></div></div></div></div>'),e.put("selectize/match.tpl.html",'<div ng-hide="$select.searchEnabled && ($select.open || $select.isEmpty())" class="ui-select-match" ng-transclude=""></div>'),e.put("selectize/select.tpl.html",'<div class="selectize-control single"><div class="selectize-input" ng-class="{\'focus\': $select.open, \'disabled\': $select.disabled, \'selectize-focus\' : $select.focus}" ng-click="$select.activate()"><div class="ui-select-match"></div><input type="text" autocomplete="off" tabindex="-1" class="ui-select-search" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-hide="!$select.searchEnabled || ($select.selected && !$select.open)" ng-disabled="$select.disabled"></div><div class="ui-select-choices"></div></div>')}]),!function(){var e,t,n,i,o,r={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName.toUpperCase()?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,i,o,r,s;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),children:0,disabled:e.disabled}),r=e.childNodes,s=[],i=0,o=r.length;o>i;i++)n=r[i],s.push(this.add_option(n,t,e.disabled));return s},e.prototype.add_option=function(e,t,n){return"OPTION"===e.nodeName.toUpperCase()?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e.prototype.escapeExpression=function(e){var t,n;return null==e||e===!1?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(n,function(e){return t[e]||"&amp;"})):e},e}(),i.select_to_array=function(e){var t,n,o,r,s;for(n=new i,s=e.childNodes,o=0,r=s.length;r>o;o++)t=s[o],n.add_node(t);return n.parsed},t=function(){function e(t,n){this.form_field=t,this.options=null!=n?n:{},e.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0},e.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(){var e=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return e.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(){var e=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return e.blur_test()},100))},e.prototype.results_option_build=function(e){var t,n,i,o,r;for(t="",r=this.results_data,i=0,o=r.length;o>i;i++)n=r[i],t+=n.group?this.result_add_group(n):this.result_add_option(n),(null!=e?e.first:void 0)&&(n.selected&&this.is_multiple?this.choice_build(n):n.selected&&!this.is_multiple&&this.single_set_selected_text(n.text));return t},e.prototype.result_add_option=function(e){var t,n;return e.search_match&&this.include_option_in_results(e)?(t=[],e.disabled||e.selected&&this.is_multiple||t.push("active-result"),!e.disabled||e.selected&&this.is_multiple||t.push("disabled-result"),e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),n=""!==e.style.cssText?' style="'+e.style+'"':"",'<li class="'+t.join(" ")+'"'+n+' data-option-array-index="'+e.array_index+'">'+e.search_text+"</li>"):""},e.prototype.result_add_group=function(e){return(e.search_match||e.group_match)&&e.active_options>0?'<li class="group-result">'+e.search_text+"</li>":""},e.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.result_single_selected=null,this.results_build(),this.results_showing?this.winnow_results():void 0},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.winnow_results=function(){var e,t,n,i,o,r,s,a,l,c,u,d,h;for(this.no_results_clear(),o=0,s=this.get_search_text(),e=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i=this.search_contains?"":"^",n=new RegExp(i+e,"i"),c=new RegExp(e,"i"),h=this.results_data,u=0,d=h.length;d>u;u++)t=h[u],t.search_match=!1,r=null,this.include_option_in_results(t)&&(t.group&&(t.group_match=!1,t.active_options=0),null!=t.group_array_index&&this.results_data[t.group_array_index]&&(r=this.results_data[t.group_array_index],0===r.active_options&&r.search_match&&(o+=1),r.active_options+=1),(!t.group||this.group_search)&&(t.search_text=t.group?t.label:t.html,t.search_match=this.search_string_match(t.search_text,n),t.search_match&&!t.group&&(o+=1),t.search_match?(s.length&&(a=t.search_text.search(c),l=t.search_text.substr(0,a+s.length)+"</em>"+t.search_text.substr(a+s.length),t.search_text=l.substr(0,a)+"<em>"+l.substr(a)),null!=r&&(r.group_match=!0)):null!=t.group_array_index&&this.results_data[t.group_array_index].search_match&&(t.search_match=!0)));return this.result_clear_highlight(),1>o&&s.length?(this.update_results_content(""),this.no_results(s)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},e.prototype.search_string_match=function(e,t){var n,i,o,r;if(t.test(e))return!0;if(this.enable_split_word_search&&(e.indexOf(" ")>=0||0===e.indexOf("["))&&(i=e.replace(/\[|\]/g,"").split(" "),i.length))for(o=0,r=i.length;r>o;o++)if(n=i[o],t.test(n))return!0},e.prototype.choices_count=function(){var e,t,n,i;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,i=this.form_field.options,t=0,n=i.length;n>t;t++)e=i[t],e.selected&&(this.selected_option_count+=1);return this.selected_option_count},e.prototype.choices_click=function(e){return e.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},e.prototype.keyup_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},e.prototype.include_option_in_results=function(e){return this.is_multiple&&!this.display_selected_options&&e.selected?!1:!this.display_disabled_options&&e.disabled?!1:e.empty?!1:!0},e.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e}(),e=jQuery,e.fn.extend({chosen:function(i){return t.browser_is_supported()?this.each(function(){var t,o;t=e(this),o=t.data("chosen"),"destroy"===i&&o?o.destroy():o||t.data("chosen",new n(this,i))}):this}}),n=function(t){function n(){return o=n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},n.prototype.set_up_html=function(){var t,n;return t=["chosen-container"],t.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chosen-rtl"),n={"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=e("<div />",n),this.container.html(this.is_multiple?'<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>':'<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},n.prototype.register_observers=function(){var e=this;return this.container.bind("mousedown.chosen",function(t){e.container_mousedown(t)}),this.container.bind("mouseup.chosen",function(t){e.container_mouseup(t)}),this.container.bind("mouseenter.chosen",function(t){e.mouse_enter(t)}),this.container.bind("mouseleave.chosen",function(t){e.mouse_leave(t)}),this.search_results.bind("mouseup.chosen",function(t){e.search_results_mouseup(t)}),this.search_results.bind("mouseover.chosen",function(t){e.search_results_mouseover(t)}),this.search_results.bind("mouseout.chosen",function(t){e.search_results_mouseout(t)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(t){e.search_results_mousewheel(t)}),this.form_field_jq.bind("chosen:updated.chosen",function(t){e.results_update_field(t)}),this.form_field_jq.bind("chosen:activate.chosen",function(t){e.activate_field(t)}),this.form_field_jq.bind("chosen:open.chosen",function(t){e.container_mousedown(t)}),this.search_field.bind("blur.chosen",function(t){e.input_blur(t)}),this.search_field.bind("keyup.chosen",function(t){e.keyup_checker(t)}),this.search_field.bind("keydown.chosen",function(t){e.keydown_checker(t)}),this.search_field.bind("focus.chosen",function(t){e.input_focus(t)}),this.is_multiple?this.search_choices.bind("click.chosen",function(t){e.choices_click(t)}):this.container.bind("click.chosen",function(e){e.preventDefault()})},n.prototype.destroy=function(){return e(document).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},n.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},n.prototype.container_mousedown=function(t){return this.is_disabled||(t&&"mousedown"===t.type&&!this.results_showing&&t.preventDefault(),null!=t&&e(t.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!t||e(t.target)[0]!==this.selected_item[0]&&!e(t.target).parents("a.chosen-single").length||(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(document).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},n.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},n.prototype.search_results_mousewheel=function(e){var t,n,i;return t=-(null!=(n=e.originalEvent)?n.wheelDelta:void 0)||(null!=(i=e.originialEvent)?i.detail:void 0),null!=t?(e.preventDefault(),"DOMMouseScroll"===e.type&&(t=40*t),this.search_results.scrollTop(t+this.search_results.scrollTop())):void 0},n.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},n.prototype.close_field=function(){return e(document).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},n.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},n.prototype.test_active_click=function(t){return this.container.is(e(t.target).closest(".chosen-container"))?this.active_field=!0:this.close_field()},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=i.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},n.prototype.result_do_highlight=function(e){var t,n,i,o,r;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),i=parseInt(this.search_results.css("maxHeight"),10),r=this.search_results.scrollTop(),o=i+r,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight(),t>=o)return this.search_results.scrollTop(t-i>0?t-i:0);if(r>n)return this.search_results.scrollTop(n)}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results())},n.prototype.update_results_content=function(e){return this.search_results.html(e)},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},n.prototype.set_tab_index=function(){var e;return this.form_field.tabIndex?(e=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=e):void 0},n.prototype.set_label_behavior=function(){var t=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()}):void 0},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_results_mouseup=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n.length?(this.result_highlight=n,this.result_select(t),this.search_field.focus()):void 0},n.prototype.search_results_mouseover=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n?this.result_do_highlight(n):void 0},n.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},n.prototype.choice_build=function(t){var n,i,o=this;return n=e("<li />",{"class":"search-choice"}).html("<span>"+t.html+"</span>"),t.disabled?n.addClass("search-choice-disabled"):(i=e("<a />",{"class":"search-choice-close","data-option-array-index":t.array_index}),i.bind("click.chosen",function(e){return o.choice_destroy_link_click(e)}),n.append(i)),this.search_container.before(n)},n.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),t.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(e(t.target))},n.prototype.choice_destroy=function(e){return this.result_deselect(e[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()):void 0},n.prototype.results_reset=function(){return this.form_field.options[0].selected=!0,this.selected_option_count=null,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},n.prototype.result_select=function(e){var t,n,i;return this.result_highlight?(t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):(this.result_single_selected&&(this.result_single_selected.removeClass("result-selected"),i=this.result_single_selected[0].getAttribute("data-option-array-index"),this.results_data[i].selected=!1),this.result_single_selected=t),t.addClass("result-selected"),n=this.results_data[t[0].getAttribute("data-option-array-index")],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):this.single_set_selected_text(n.text),(e.metaKey||e.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},n.prototype.single_set_selected_text=function(e){return null==e&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),
this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(e)},n.prototype.result_deselect=function(e){var t;return t=this.results_data[e],this.form_field.options[t.options_index].disabled?!1:(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0)},n.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},n.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html()},n.prototype.winnow_results_set_highlight=function(){var e,t;return t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null!=e?this.result_do_highlight(e):void 0},n.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n)},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},n.prototype.keydown_arrow=function(){var e;return this.results_showing&&this.result_highlight?(e=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(e):void 0:this.results_show()},n.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},n.prototype.keydown_backstroke=function(){var e;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(e=this.search_container.siblings("li.search-choice").last(),e.length&&!e.hasClass("search-choice-disabled")?(this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},n.prototype.keydown_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow()}},n.prototype.search_field_scale=function(){var t,n,i,o,r,s,a,l,c;if(this.is_multiple){for(i=0,a=0,r="position:absolute; left: -1000px; top: -1000px; display:none;",s=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],l=0,c=s.length;c>l;l++)o=s[l],r+=o+":"+this.search_field.css(o)+";";return t=e("<div />",{style:r}),t.text(this.search_field.val()),e("body").append(t),a=t.width()+25,t.remove(),n=this.container.outerWidth(),a>n-10&&(a=n-10),this.search_field.css({width:a+"px"})}},n}(t)}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("localytics.directives",[]),angular.module("localytics.directives").directive("chosen",function(){var t,n,i,o;return n=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/,t=["noResultsText","allowSingleDeselect","disableSearchThreshold","disableSearch","enableSplitWordSearch","inheritSelectClasses","maxSelectedOptions","placeholderTextMultiple","placeholderTextSingle","searchContains","singleBackstrokeDelete","displayDisabledOptions","displaySelectedOptions","width"],o=function(e){return e.replace(/[A-Z]/g,function(e){return"_"+e.toLowerCase()})},i=function(e){var t;if(angular.isArray(e))return 0===e.length;if(angular.isObject(e))for(t in e)if(e.hasOwnProperty(t))return!1;return!0},{restrict:"A",require:"?ngModel",terminal:!0,link:function(r,s,a,l){var c,u,d,h,p,f,g,m,v,b,y,w,C;return s.addClass("localytics-chosen"),g=r.$eval(a.chosen)||{},angular.forEach(a,function(n,i){return e.call(t,i)>=0?g[o(i)]=r.$eval(n):void 0}),b=function(){return s.addClass("loading").attr("disabled",!0).trigger("chosen:updated")},y=function(){return s.removeClass("loading").attr("disabled",!1).trigger("chosen:updated")},c=null,u=null,h=!1,p=function(){return c?s.trigger("chosen:updated"):(c=s.chosen(g).data("chosen"),u=c.default_text)},v=function(){return h=!1,s.attr("data-placeholder",u)},d=function(){return h=!0,s.attr("data-placeholder",c.results_none_found).attr("disabled",!0).trigger("chosen:updated")},l?(m=l.$render,l.$render=function(){return m(),p()},a.multiple&&(C=function(){return l.$viewValue},r.$watch(C,l.$render,!0))):p(),a.$observe("disabled",function(){return s.trigger("chosen:updated")}),a.ngOptions&&l?(f=a.ngOptions.match(n),w=f[7],r.$watchCollection(w,function(e,t){return angular.isUndefined(e)?b():(h&&v(),y(),i(e)?d():void 0)})):void 0}}})}.call(this),function(e,t,n){"use strict";function i(e,n,i){o.directive(e,["$parse","$swipe",function(o,r){return function(s,a,l){function c(e){if(!u)return!1;var t=Math.abs(e.y-u.y);return e=(e.x-u.x)*n,d&&75>t&&e>0&&e>30&&.3>t/e}var u,d,h=o(l[e]),p=["touch"];t.isDefined(l.ngSwipeDisableMouse)||p.push("mouse"),r.bind(a,{start:function(e,t){u=e,d=!0},cancel:function(e){d=!1},end:function(e,t){c(e)&&s.$apply(function(){a.triggerHandler(i),h(s,{$event:t})})}},p)}}])}var o=t.module("ngTouch",[]);o.factory("$swipe",[function(){function e(e){var t=e.touches&&e.touches.length?e.touches:[e];return e=e.changedTouches&&e.changedTouches[0]||e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]||t[0].originalEvent||t[0],{x:e.clientX,y:e.clientY}}function n(e,n){var o=[];return t.forEach(e,function(e){(e=i[e][n])&&o.push(e)}),o.join(" ")}var i={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}};return{bind:function(t,i,o){var r,s,a,l,c=!1;o=o||["mouse","touch"],t.on(n(o,"start"),function(t){a=e(t),c=!0,s=r=0,l=a,i.start&&i.start(a,t)});var u=n(o,"cancel");u&&t.on(u,function(e){c=!1,i.cancel&&i.cancel(e)}),t.on(n(o,"move"),function(t){if(c&&a){var n=e(t);r+=Math.abs(n.x-l.x),s+=Math.abs(n.y-l.y),l=n,10>r&&10>s||(s>r?(c=!1,i.cancel&&i.cancel(t)):(t.preventDefault(),i.move&&i.move(n,t)))}}),t.on(n(o,"end"),function(t){c&&(c=!1,i.end&&i.end(e(t),t))})}}}]),o.config(["$provide",function(e){e.decorator("ngClickDirective",["$delegate",function(e){return e.shift(),e}])}]),o.directive("ngClick",["$parse","$timeout","$rootElement",function(e,n,i){function o(e,t,n){for(var i=0;i<e.length;i+=2){var o=e[i+1],r=n;if(25>Math.abs(e[i]-t)&&25>Math.abs(o-r))return e.splice(i,i+2),!0}return!1}function r(e){if(!(2500<Date.now()-a)){var t=e.touches&&e.touches.length?e.touches:[e],n=t[0].clientX,t=t[0].clientY;1>n&&1>t||c&&c[0]===n&&c[1]===t||(c&&(c=null),"label"===e.target.tagName.toLowerCase()&&(c=[n,t]),o(l,n,t)||(e.stopPropagation(),e.preventDefault(),e.target&&e.target.blur()))}}function s(e){e=e.touches&&e.touches.length?e.touches:[e];var t=e[0].clientX,i=e[0].clientY;l.push(t,i),n(function(){for(var e=0;e<l.length;e+=2)if(l[e]==t&&l[e+1]==i){l.splice(e,e+2);break}},2500,!1)}var a,l,c;return function(n,c,u){function d(){v=!1,c.removeClass("ng-click-active")}var h,p,f,g,m=e(u.ngClick),v=!1;c.on("touchstart",function(e){v=!0,h=e.target?e.target:e.srcElement,3==h.nodeType&&(h=h.parentNode),c.addClass("ng-click-active"),p=Date.now(),e=e.touches&&e.touches.length?e.touches:[e],e=e[0].originalEvent||e[0],f=e.clientX,g=e.clientY}),c.on("touchmove",function(e){d()}),c.on("touchcancel",function(e){d()}),c.on("touchend",function(e){var n=Date.now()-p,m=e.changedTouches&&e.changedTouches.length?e.changedTouches:e.touches&&e.touches.length?e.touches:[e],b=m[0].originalEvent||m[0],m=b.clientX,b=b.clientY,y=Math.sqrt(Math.pow(m-f,2)+Math.pow(b-g,2));v&&750>n&&12>y&&(l||(i[0].addEventListener("click",r,!0),i[0].addEventListener("touchstart",s,!0),l=[]),a=Date.now(),o(l,m,b),h&&h.blur(),t.isDefined(u.disabled)&&!1!==u.disabled||c.triggerHandler("click",[e])),d()}),c.onclick=function(e){},c.on("click",function(e,t){n.$apply(function(){m(n,{$event:t||e})})}),c.on("mousedown",function(e){c.addClass("ng-click-active")}),c.on("mousemove mouseup",function(e){c.removeClass("ng-click-active")})}}]),i("ngSwipeLeft",-1,"swipeleft"),i("ngSwipeRight",1,"swiperight")}(window,window.angular),angular.module("ui.slider",[]).value("uiSliderConfig",{}).directive("uiSlider",["uiSliderConfig","$timeout",function(e,t){return e=e||{},{require:"ngModel",compile:function(){return function(n,i,o,r){function s(e,t){return t?parseFloat(e):parseInt(e)}function a(){i.slider("destroy")}var l=angular.extend(n.$eval(o.uiSlider)||{},e),c={min:null,max:null},u=["min","max","step"],d=angular.isUndefined(o.useDecimals)?!1:!0,h=function(){angular.isArray(r.$viewValue)&&l.range!==!0&&(console.warn("Change your range option of ui-slider. When assigning ngModel an array of values then the range option should be set to true."),l.range=!0),angular.forEach(u,function(e){angular.isDefined(o[e])&&(l[e]=s(o[e],d))}),i.slider(l),h=angular.noop};angular.forEach(u,function(e){o.$observe(e,function(t){t&&(h(),i.slider("option",e,s(t,d)),r.$render())})}),o.$observe("disabled",function(e){h(),i.slider("option","disabled",!!e)}),n.$watch(o.uiSlider,function(e){h(),void 0!=e&&i.slider("option",e)},!0),t(h,0,!0),i.bind("slide",function(e,t){r.$setViewValue(t.values||t.value),n.$apply()}),r.$render=function(){h();var e=l.range===!0?"values":"value";l.range||!isNaN(r.$viewValue)||r.$viewValue instanceof Array?l.range&&!angular.isDefined(r.$viewValue)&&(r.$viewValue=[0,0]):r.$viewValue=0,l.range===!0&&(angular.isDefined(l.min)&&l.min>r.$viewValue[0]&&(r.$viewValue[0]=l.min),angular.isDefined(l.max)&&l.max<r.$viewValue[1]&&(r.$viewValue[1]=l.max),r.$viewValue[0]>r.$viewValue[1]&&(c.min>=r.$viewValue[1]&&(r.$viewValue[0]=c.min),c.max<=r.$viewValue[0]&&(r.$viewValue[1]=c.max)),c.min=r.$viewValue[0],c.max=r.$viewValue[1]),i.slider(e,r.$viewValue)},n.$watch(o.ngModel,function(){l.range===!0&&r.$render()},!0),i.bind("$destroy",a)}}}}]),!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",function(){this.includeCheatSheet=!0,this.templateTitle="Keyboard Shortcuts:",this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title">{{ title }}</h4><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(e,t,n,i,o){function r(e){var t={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};e=e.split("+");for(var n=0;n<e.length;n++)"mod"===e[n]&&(e[n]=i.navigator&&i.navigator.platform.indexOf("Mac")>=0?"command":"ctrl"),e[n]=t[e[n]]||e[n];return e.join(" + ")}function s(e,t,n,i,o,r){this.combo=e instanceof Array?e:[e],this.description=t,this.callback=n,this.action=i,this.allowIn=o,this.persistent=r}function a(){for(var e=f.hotkeys.length;e--;){var t=f.hotkeys[e];t&&!t.persistent&&u(t)}}function l(){f.helpVisible=!f.helpVisible,f.helpVisible?(y=d("esc"),u("esc"),c("esc",y.description,l)):(u("esc"),y!==!1&&c(y))}function c(e,t,n,i,o,r){var a,l=["INPUT","SELECT","TEXTAREA"],c=Object.prototype.toString.call(e);if("[object Object]"===c&&(t=e.description,n=e.callback,i=e.action,r=e.persistent,o=e.allowIn,e=e.combo),t instanceof Function?(i=n,n=t,t="$$undefined$$"):angular.isUndefined(t)&&(t="$$undefined$$"),void 0===r&&(r=!0),"function"==typeof n){a=n,o instanceof Array||(o=[]);for(var u,d=0;d<o.length;d++)o[d]=o[d].toUpperCase(),u=l.indexOf(o[d]),-1!==u&&l.splice(u,1);n=function(e){var t=!0,n=e.target||e.srcElement,i=n.nodeName.toUpperCase();if((" "+n.className+" ").indexOf(" mousetrap ")>-1)t=!0;else for(var o=0;o<l.length;o++)if(l[o]===i){t=!1;break}t&&p(a.apply(this,arguments))}}"string"==typeof i?Mousetrap.bind(e,p(n),i):Mousetrap.bind(e,p(n));var h=new s(e,t,n,i,o,r);return f.hotkeys.push(h),h}function u(e){var t=e instanceof s?e.combo:e;if(Mousetrap.unbind(t),angular.isArray(t)){for(var n=!0,i=t.length;i--;)n=u(t[i])&&n;return n}var o=f.hotkeys.indexOf(d(t));return o>-1?(f.hotkeys[o].combo.length>1?f.hotkeys[o].combo.splice(f.hotkeys[o].combo.indexOf(t),1):f.hotkeys.splice(o,1),!0):!1}function d(e){for(var t,n=0;n<f.hotkeys.length;n++)if(t=f.hotkeys[n],t.combo.indexOf(e)>-1)return t;return!1}function h(e){return e.$id in g||(g[e.$id]=[],e.$on("$destroy",function(){for(var t=g[e.$id].length;t--;)u(g[e.$id][t]),delete g[e.$id][t]})),{add:function(t){var n;return n=arguments.length>1?c.apply(this,arguments):c(t),g[e.$id].push(n),this}}}function p(e){return function(n,i){if(e instanceof Array){var o=e[0],r=e[1];e=function(){r.scope.$eval(o)}}t.$apply(function(){e(n,d(i))})}}Mousetrap.stopCallback=function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.contentEditable&&"true"==t.contentEditable},s.prototype.format=function(){for(var e=this.combo[0],t=e.split(/[\s]/),n=0;n<t.length;n++)t[n]=r(t[n]);return t};var f=t.$new();f.hotkeys=[],f.helpVisible=!1,f.title=this.templateTitle,f.toggleCheatSheet=l;var g=[];if(t.$on("$routeChangeSuccess",function(e,t){a(),t&&t.hotkeys&&angular.forEach(t.hotkeys,function(e){var n=e[2];("string"==typeof n||n instanceof String)&&(e[2]=[n,t]),e[5]=!1,c.apply(this,e)})}),this.includeCheatSheet){var m=o[0],v=e[0],b=angular.element(this.template);c(this.cheatSheetHotkey,this.cheatSheetDescription,l),(v===m||v===m.documentElement)&&(v=m.body),angular.element(v).append(n(b)(f))}var y=!1,w={add:c,del:u,get:d,bindTo:h,template:this.template,toggleCheatSheet:l,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,purgeHotkeys:a,templateTitle:this.templateTitle};return w}]}).directive("hotkey",["hotkeys",function(e){return{restrict:"A",link:function(t,n,i){var o,r;angular.forEach(t.$eval(i.hotkey),function(t,n){r="string"==typeof i.hotkeyAllowIn?i.hotkeyAllowIn.split(/[\s,]+/):[],o=n,e.add({combo:n,description:i.hotkeyDescription,callback:t,action:i.hotkeyAction,allowIn:r})}),n.bind("$destroy",function(){e.del(o)})}}}]).run(["hotkeys",function(){}])}(),function(e,t){function n(e,t,n){return e.addEventListener?void e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function i(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return S[e.which]?S[e.which]:k[e.which]?k[e.which]:String.fromCharCode(e.which).toLowerCase()}function o(e,t){return e.sort().join(",")===t.sort().join(",")}function r(e){e=e||{};var t,n=!1;for(t in I)e[t]?n=!0:I[t]=0;n||(O=!1)}function s(e,t,n,i,r,s){var a,l,c=[],u=n.type;if(!E[e])return[];for("keyup"==u&&p(e)&&(t=[e]),a=0;a<E[e].length;++a)if(l=E[e][a],(i||!l.seq||I[l.seq]==l.level)&&u==l.action&&("keypress"==u&&!n.metaKey&&!n.ctrlKey||o(t,l.modifiers))){var d=!i&&l.combo==r,h=i&&l.seq==i&&l.level==s;(d||h)&&E[e].splice(a,1),c.push(l)}return c}function a(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function l(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function c(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function u(e,t,n,i){P.stopCallback(t,t.target||t.srcElement,n,i)||e(t,n)===!1&&(l(t),c(t))}function d(e,t,n){var i,o=s(e,t,n),a={},l=0,c=!1;for(i=0;i<o.length;++i)o[i].seq&&(l=Math.max(l,o[i].level));for(i=0;i<o.length;++i)if(o[i].seq){if(o[i].level!=l)continue;c=!0,a[o[i].seq]=1,u(o[i].callback,n,o[i].combo,o[i].seq)}else c||u(o[i].callback,n,o[i].combo);var d="keypress"==n.type&&A;n.type!=O||p(e)||d||r(a),A=c&&"keydown"==n.type}function h(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=i(e);return t?"keyup"==e.type&&M===t?void(M=!1):void P.handleKey(t,a(e),e):void 0}function p(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function f(){clearTimeout(x),x=setTimeout(r,1e3)}function g(){if(!_){_={};for(var e in S)e>95&&112>e||S.hasOwnProperty(e)&&(_[S[e]]=e)}return _}function m(e,t,n){return n||(n=g()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function v(e,t,n,o){function s(t){return function(){O=t,++I[e],f()}}function a(t){u(n,t,e),"keyup"!==o&&(M=i(t)),setTimeout(r,10)}I[e]=0;for(var l=0;l<t.length;++l){var c=l+1===t.length,d=c?a:s(o||y(t[l+1]).action);w(t[l],d,o,e,l)}}function b(e){return"+"===e?["+"]:e.split("+")}function y(e,t){var n,i,o,r=[];for(n=b(e),o=0;o<n.length;++o)i=n[o],$[i]&&(i=$[i]),t&&"keypress"!=t&&T[i]&&(i=T[i],r.push("shift")),p(i)&&r.push(i);return t=m(i,r,t),{key:i,modifiers:r,action:t}}function w(e,t,n,i,o){D[e+":"+n]=t,e=e.replace(/\s+/g," ");var r,a=e.split(" ");return a.length>1?void v(e,a,t,n):(r=y(e,n),E[r.key]=E[r.key]||[],s(r.key,r.modifiers,{type:r.action},i,e,o),void E[r.key][i?"unshift":"push"]({callback:t,modifiers:r.modifiers,action:r.action,seq:i,level:o,combo:e}))}function C(e,t,n){for(var i=0;i<e.length;++i)w(e[i],t,n)}for(var _,x,S={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},k={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},T={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},$={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},E={},D={},I={},M=!1,A=!1,O=!1,R=1;20>R;++R)S[111+R]="f"+R;for(R=0;9>=R;++R)S[R+96]=R;n(t,"keypress",h),n(t,"keydown",h),n(t,"keyup",h);var P={bind:function(e,t,n){return e=e instanceof Array?e:[e],C(e,t,n),this},unbind:function(e,t){return P.bind(e,function(){},t)},trigger:function(e,t){return D[e+":"+t]&&D[e+":"+t]({},e),this},reset:function(){return E={},D={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},handleKey:d};e.Mousetrap=P,"function"==typeof define&&define.amd&&define(P)}(window,document),angular.module("toastr",[]).directive("toast",["$compile","$timeout","toastr",function(e,t,n){return{replace:!0,templateUrl:"templates/toastr/toastr.html",link:function(i,o){function r(e){return t(function(){n.remove(i.toastId)},e)}var s;if(i.toastClass=i.options.toastClass,i.titleClass=i.options.titleClass,i.messageClass=i.options.messageClass,i.options.closeHtml){var a=angular.element(i.options.closeHtml);a.addClass("toast-close-button"),a.attr("ng-click","close()"),e(a)(i),o.prepend(a)}i.init=function(){i.options.timeOut&&(s=r(i.options.timeOut))},o.on("mouseenter",function(){s&&t.cancel(s)}),i.tapToast=function(){i.options.tapToDismiss&&i.close()},i.close=function(){n.remove(i.toastId)},o.on("mouseleave",function(){(0!==i.options.timeOut||0!==i.options.extendedTimeOut)&&(s=r(i.options.extendedTimeOut))})}}}]).constant("toastrConfig",{allowHtml:!1,closeButton:!1,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",positionClass:"toast-top-right",tapToDismiss:!0,timeOut:5e3,titleClass:"toast-title",toastClass:"toast"}).factory("toastr",["$animate","$compile","$document","$rootScope","$sce","toastrConfig","$q",function(e,t,n,i,o,r,s){function a(e){if(e)g(e.toastId);else for(var t=0;t<b.length;t++)g(b[t].toastId)}function l(e,t,n){return f({iconClass:h().iconClasses.error,message:e,optionsOverride:n,title:t})}function c(e,t,n){return f({iconClass:h().iconClasses.info,message:e,optionsOverride:n,title:t})}function u(e,t,n){return f({iconClass:h().iconClasses.success,message:e,optionsOverride:n,title:t})}function d(e,t,n){return f({iconClass:h().iconClasses.warning,message:e,optionsOverride:n,title:t})}function h(){return angular.extend({},r)}function p(t){if(m)return y.promise;m=angular.element("<div></div>"),m.attr("id",t.containerId),m.addClass(t.positionClass),m.css({"pointer-events":"auto"});var i=n.find("body").eq(0);return e.enter(m,i,null,function(){y.resolve()}),y.promise}function f(n){function r(e,t,n){n.allowHtml?(e.scope.allowHtml=!0,e.scope.title=o.trustAsHtml(t.title),e.scope.message=o.trustAsHtml(t.message)):(e.scope.title=t.title,e.scope.message=t.message),e.scope.toastType=e.iconClass,e.scope.toastId=e.toastId,e.scope.options={extendedTimeOut:n.extendedTimeOut,messageClass:n.messageClass,tapToDismiss:n.tapToDismiss,timeOut:n.timeOut,titleClass:n.titleClass,toastClass:n.toastClass},n.closeButton&&(e.scope.options.closeHtml=n.closeHtml)}function s(e){var n=angular.element("<div toast></div>");return t(n)(e)}var a=h(),l={toastId:v++,scope:i.$new()};return l.iconClass=n.iconClass,n.optionsOverride&&(a=angular.extend(a,n.optionsOverride),l.iconClass=n.optionsOverride.iconClass||l.iconClass),r(l,n,a),l.el=s(l.scope),b.push(l),p(a).then(function(){e.enter(l.el,m,null,function(){l.scope.init()})}),l}function g(t){function n(e){for(var t=0;t<b.length;t++)if(b[t].toastId===e)return b[t]}var i=n(t);i&&e.leave(i.el,function(){i.scope.$destroy(),m&&0===m.children().length&&(b=[],m.remove(),m=null,y=s.defer())})}var m,v=0,b=[],y=s.defer(),w={clear:a,error:l,info:c,remove:g,success:u,warning:d};return w}]),angular.module("toastr").run(["$templateCache",function(e){"use strict";e.put("templates/toastr/toastr.html",'<div class="{{toastClass}} {{toastType}}" ng-click="tapToast()">\n  <div ng-switch on="allowHtml">\n    <div ng-switch-default ng-if="title" class="{{titleClass}}">{{title}}</div>\n    <div ng-switch-default class="{{messageClass}}">{{message}}</div>\n    <div ng-switch-when="true" ng-if="title" class="{{titleClass}}" ng-bind-html="title"></div>\n    <div ng-switch-when="true" class="{{messageClass}}" ng-bind-html="message"></div>\n  </div>\n</div>')}]),!function(e,t){"use strict";return"function"==typeof define&&define.amd?void define(["angular"],function(e){return t(e)}):t(e)}(angular||null,function(e){"use strict";var t=e.module("ngTable",[]);t.factory("ngTableParams",["$q","$log",function(t,n){var i=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},o=function(o,r){var s=this,a=function(){c.debugMode&&n.debug&&n.debug.apply(this,arguments)};this.data=[],this.parameters=function(t,n){if(n=n||!1,e.isDefined(t)){for(var o in t){var r=t[o];if(n&&o.indexOf("[")>=0){for(var s=o.split(/\[(.*)\]/).reverse(),c="",u=0,d=s.length;d>u;u++){var h=s[u];if(""!==h){var p=r;r={},r[c=h]=i(p)?parseFloat(p):p}}"sorting"===c&&(l[c]={}),l[c]=e.extend(l[c]||{},r[c])}else l[o]=i(t[o])?parseFloat(t[o]):t[o]}return a("ngTable: set parameters",l),this}return l},this.settings=function(t){return e.isDefined(t)?(e.isArray(t.data)&&(t.total=t.data.length),c=e.extend(c,t),a("ngTable: set settings",c),this):c},this.page=function(t){return e.isDefined(t)?this.parameters({page:t}):l.page},this.total=function(t){return e.isDefined(t)?this.settings({total:t}):c.total},this.count=function(t){return e.isDefined(t)?this.parameters({count:t,page:1}):l.count},this.filter=function(t){return e.isDefined(t)?this.parameters({filter:t}):l.filter},this.sorting=function(t){if(2==arguments.length){var n={};return n[t]=arguments[1],this.parameters({sorting:n}),this}return e.isDefined(t)?this.parameters({sorting:t}):l.sorting},this.isSortBy=function(t,n){return e.isDefined(l.sorting[t])&&l.sorting[t]==n},this.orderBy=function(){var e=[];for(var t in l.sorting)e.push(("asc"===l.sorting[t]?"+":"-")+t);return e},this.getData=function(t,n){t.resolve(e.isArray(this.data)&&e.isObject(n)?this.data.slice((n.page()-1)*n.count(),n.page()*n.count()):[])},this.getGroups=function(n,i){var o=t.defer();o.promise.then(function(t){var o={};e.forEach(t,function(t){var n=e.isFunction(i)?i(t):t[i];o[n]=o[n]||{data:[]},o[n].value=n,o[n].data.push(t)});var r=[];for(var s in o)r.push(o[s]);a("ngTable: refresh groups",r),n.resolve(r)}),this.getData(o,s)},this.generatePagesArray=function(e,t,n){var i,o,r,s,a,l;if(i=11,l=[],a=Math.ceil(t/n),a>1){l.push({type:"prev",number:Math.max(1,e-1),active:e>1}),l.push({type:"first",number:1,active:e>1}),r=Math.round((i-5)/2),s=Math.max(2,e-r),o=Math.min(a-1,e+2*r-(e-s)),s=Math.max(2,s-(2*r-(o-s)));for(var c=s;o>=c;)l.push(c===s&&2!==c||c===o&&c!==a-1?{type:"more",active:!1}:{type:"page",number:c,active:e!==c}),c++;l.push({type:"last",number:a,active:e!==a}),l.push({type:"next",number:Math.min(a,e+1),active:a>e})}return l},this.url=function(t){t=t||!1;var n=t?[]:{};for(var i in l)if(l.hasOwnProperty(i)){var o=l[i],r=encodeURIComponent(i);if("object"==typeof o){for(var s in o)if(!e.isUndefined(o[s])&&""!==o[s]){var a=r+"["+encodeURIComponent(s)+"]";t?n.push(a+"="+o[s]):n[a]=o[s]}}else e.isFunction(o)||e.isUndefined(o)||""===o||(t?n.push(r+"="+encodeURIComponent(o)):n[r]=encodeURIComponent(o))}return n},this.reload=function(){var e=t.defer(),n=this;c.$loading=!0,c.groupBy?c.getGroups(e,c.groupBy,this):c.getData(e,this),a("ngTable: reload data"),e.promise.then(function(e){c.$loading=!1,a("ngTable: current scope",c.$scope),n.data=c.groupBy?c.$scope.$groups=e:c.$scope.$data=e,c.$scope.pages=n.generatePagesArray(n.page(),n.total(),n.count()),c.$scope.$emit("ngTableAfterReloadData")})},this.reloadPages=function(){var e=this;c.$scope.pages=e.generatePagesArray(e.page(),e.total(),e.count())};var l=this.$params={page:1,count:1,filter:{},sorting:{},group:{},groupBy:null},c={$scope:null,$loading:!1,data:null,total:0,defaultSort:"desc",filterDelay:750,counts:[10,25,50,100],getGroups:this.getGroups,getData:this.getData};return this.settings(r),this.parameters(o,!0),this};return o}]);var n=["$scope","ngTableParams","$timeout",function(t,n,i){t.$loading=!1,t.params||(t.params=new n),t.params.settings().$scope=t;var o=function(){var e=0;return function(t,n){i.cancel(e),e=i(t,n)}}();t.$watch("params.$params",function(n,i){t.params.settings().$scope=t,e.equals(n.filter,i.filter)?t.params.reload():o(function(){t.params.$params.page=1,t.params.reload()},t.params.settings().filterDelay)},!0),t.sortBy=function(e,n){var i=t.parse(e.sortable);if(i){var o=t.params.settings().defaultSort,r="asc"===o?"desc":"asc",s=t.params.sorting()&&t.params.sorting()[i]&&t.params.sorting()[i]===o,a=n.ctrlKey||n.metaKey?t.params.sorting():{};a[i]=s?r:o,t.params.parameters({sorting:a})}}}];return t.directive("ngTable",["$compile","$q","$parse",function(t,i,o){return{restrict:"A",priority:1001,scope:!0,controller:n,compile:function(n){var i=[],r=0,s=null,a=n.find("thead");return e.forEach(e.element(n.find("tr")),function(t){t=e.element(t),t.hasClass("ng-table-group")||s||(s=t)}),s?(e.forEach(s.find("td"),function(t){var n=e.element(t);if(!n.attr("ignore-cell")||"true"!==n.attr("ignore-cell")){var s=function(e,t){return function(r){return o(n.attr("x-data-"+e)||n.attr("data-"+e)||n.attr(e))(r,{$columns:i})||t}},a=s("title"," "),l=s("header",!1),c=s("filter",!1)(),u=!1,d=!1;c&&c.$$name&&(d=c.$$name,delete c.$$name),c&&c.templateURL&&(u=c.templateURL,delete c.templateURL),n.attr("data-title-text",a()),i.push({id:r++,title:a,sortable:s("sortable",!1),"class":n.attr("x-data-header-class")||n.attr("data-header-class")||n.attr("header-class"),filter:c,filterTemplateURL:u,filterName:d,headerTemplateURL:l,filterData:n.attr("filter-data")?n.attr("filter-data"):null,show:n.attr("ng-show")?function(e){return o(n.attr("ng-show"))(e)}:function(){return!0}})}}),function(n,r,s){if(n.$loading=!1,n.$columns=i,n.$watch(s.ngTable,function(t){e.isUndefined(t)||(n.paramsModel=o(s.ngTable),n.params=t)},!0),n.parse=function(t){return e.isDefined(t)?t(n):""},s.showFilter&&n.$parent.$watch(s.showFilter,function(e){n.show_filter=e}),e.forEach(i,function(t){var i;if(t.filterData){if(i=o(t.filterData)(n,{$column:t}),!e.isObject(i)||!e.isObject(i.promise))throw new Error("Function "+t.filterData+" must be instance of $q.defer()");return delete t.filterData,i.promise.then(function(n){e.isArray(n)||(n=[]),n.unshift({title:"-",id:""}),t.data=n})}}),!r.hasClass("ng-table")){n.templates={header:s.templateHeader?s.templateHeader:"ng-table/header.html",pagination:s.templatePagination?s.templatePagination:"ng-table/pager.html"};var l=a.length>0?a:e.element(document.createElement("thead")).attr("ng-include","templates.header"),c=e.element(document.createElement("div")).attr({"ng-table-pagination":"params","template-url":"templates.pagination"});r.find("thead").remove(),r.addClass("ng-table").prepend(l).after(c),t(l)(n),t(c)(n)}}):void 0}}}]),t.directive("ngTablePagination",["$compile",function(t){return{restrict:"A",scope:{params:"=ngTablePagination",templateUrl:"="},replace:!1,link:function(n,i){n.params.settings().$scope.$on("ngTableAfterReloadData",function(){n.pages=n.params.generatePagesArray(n.params.page(),n.params.total(),n.params.count())},!0),n.$watch("templateUrl",function(o){if(!e.isUndefined(o)){var r=e.element(document.createElement("div"));r.attr({"ng-include":"templateUrl"}),i.append(r),t(r)(n)}})}}}]),e.module("ngTable").run(["$templateCache",function(e){e.put("ng-table/filters/select-multiple.html",'<select ng-options="data.id as data.title for data in column.data" multiple ng-multiple="true" ng-model="params.filter()[name]" ng-show="filter==\'select-multiple\'" class="filter filter-select-multiple form-control" name="{{column.filterName}}"> </select>'),e.put("ng-table/filters/select.html",'<select ng-options="data.id as data.title for data in column.data" ng-model="params.filter()[name]" ng-show="filter==\'select\'" class="filter filter-select form-control" name="{{column.filterName}}"> </select>'),e.put("ng-table/filters/text.html",'<input type="text" name="{{column.filterName}}" ng-model="params.filter()[name]" ng-if="filter==\'text\'" class="input-filter form-control"/>'),e.put("ng-table/header.html",'<tr> <th ng-repeat="column in $columns" ng-class="{ \'sortable\': parse(column.sortable), \'sort-asc\': params.sorting()[parse(column.sortable)]==\'asc\', \'sort-desc\': params.sorting()[parse(column.sortable)]==\'desc\' }" ng-click="sortBy(column, $event)" ng-show="column.show(this)" ng-init="template=column.headerTemplateURL(this)" class="header {{column.class}}"> <div ng-if="!template" ng-show="!template" ng-bind="parse(column.title)"></div> <div ng-if="template" ng-show="template"><div ng-include="template"></div></div> </th> </tr> <tr ng-show="show_filter" class="ng-table-filters"> <th ng-repeat="column in $columns" ng-show="column.show(this)" class="filter"> <div ng-repeat="(name, filter) in column.filter"> <div ng-if="column.filterTemplateURL" ng-show="column.filterTemplateURL"> <div ng-include="column.filterTemplateURL"></div> </div> <div ng-if="!column.filterTemplateURL" ng-show="!column.filterTemplateURL"> <div ng-include="\'ng-table/filters/\' + filter + \'.html\'"></div> </div> </div> </th> </tr>'),
e.put("ng-table/pager.html",'<div class="ng-cloak ng-table-pager"> <div ng-if="params.settings().counts.length" class="ng-table-counts btn-group pull-right"> <button ng-repeat="count in params.settings().counts" type="button" ng-class="{\'active\':params.count()==count}" ng-click="params.count(count)" class="btn btn-default"> <span ng-bind="count"></span> </button> </div> <ul class="pagination ng-table-pagination"> <li ng-class="{\'disabled\': !page.active}" ng-repeat="page in pages" ng-switch="page.type"> <a ng-switch-when="prev" ng-click="params.page(page.number)" href="">&laquo;</a> <a ng-switch-when="first" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="page" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="more" ng-click="params.page(page.number)" href="">&#8230;</a> <a ng-switch-when="last" ng-click="params.page(page.number)" href=""><span ng-bind="page.number"></span></a> <a ng-switch-when="next" ng-click="params.page(page.number)" href="">&raquo;</a> </li> </ul> </div> ')}]),t}),!function(e,t){return"function"==typeof define&&define.amd?void define("angular-file-upload",["angular"],function(e){return t(e)}):t(e)}("undefined"==typeof angular?null:angular,function(e){var t=e.module("angularFileUpload",[]);return t.value("fileUploaderOptions",{url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:!1}).factory("FileUploader",["fileUploaderOptions","$rootScope","$http","$window","$compile",function(t,n,i,o,r){function s(n){var i=e.copy(t);e.extend(this,i,n,{isUploading:!1,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}}),this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter}),this.filters.unshift({name:"folder",fn:this._folderFilter})}function a(t){var n=e.isElement(t),i=n?t.value:t,o=e.isString(i)?"FakePath":"Object",r="_createFrom"+o;this[r](i)}function l(t,n,i){var o=e.isElement(n),r=o?e.element(n):null,a=o?null:n;e.extend(this,{url:t.url,alias:t.alias,headers:e.copy(t.headers),formData:e.copy(t.formData),removeAfterUpload:t.removeAfterUpload,withCredentials:t.withCredentials,method:t.method},i,{uploader:t,file:new s.FileLikeObject(n),isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:0,index:null,_file:a,_input:r}),r&&this._replaceNode(r)}function c(t){e.extend(this,t),this.uploader._directives[this.prop].push(this),this._saveLinks(),this.bind()}function u(){u.super_.apply(this,arguments),this.uploader.isHTML5||this.element.removeAttr("multiple"),this.element.prop("value",null)}function d(){d.super_.apply(this,arguments)}function h(){h.super_.apply(this,arguments)}return s.prototype.isHTML5=!(!o.File||!o.FormData),s.prototype.addToQueue=function(t,n,i){var o=this.isArrayLikeObject(t)?t:[t],r=this._getFilters(i),a=this.queue.length,l=[];e.forEach(o,function(e){var t=new s.FileLikeObject(e);if(this._isValidFile(t,r,n)){var i=new s.FileItem(this,e,n);l.push(i),this.queue.push(i),this._onAfterAddingFile(i)}else{var o=this.filters[this._failFilterIndex];this._onWhenAddingFileFailed(t,o,n)}},this),this.queue.length!==a&&(this._onAfterAddingAll(l),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},s.prototype.removeFromQueue=function(e){var t=this.getIndexOfItem(e),n=this.queue[t];n.isUploading&&n.cancel(),this.queue.splice(t,1),n._destroy(),this.progress=this._getTotalProgress()},s.prototype.clearQueue=function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0},s.prototype.uploadItem=function(e){var t=this.getIndexOfItem(e),n=this.queue[t],i=this.isHTML5?"_xhrTransport":"_iframeTransport";n._prepareToUploading(),this.isUploading||(this.isUploading=!0,this[i](n))},s.prototype.cancelItem=function(e){var t=this.getIndexOfItem(e),n=this.queue[t],i=this.isHTML5?"_xhr":"_form";n&&n.isUploading&&n[i].abort()},s.prototype.uploadAll=function(){var t=this.getNotUploadedItems().filter(function(e){return!e.isUploading});t.length&&(e.forEach(t,function(e){e._prepareToUploading()}),t[0].upload())},s.prototype.cancelAll=function(){var t=this.getNotUploadedItems();e.forEach(t,function(e){e.cancel()})},s.prototype.isFile=function(e){var t=o.File;return t&&e instanceof t},s.prototype.isFileLikeObject=function(e){return e instanceof s.FileLikeObject},s.prototype.isArrayLikeObject=function(t){return e.isObject(t)&&"length"in t},s.prototype.getIndexOfItem=function(t){return e.isNumber(t)?t:this.queue.indexOf(t)},s.prototype.getNotUploadedItems=function(){return this.queue.filter(function(e){return!e.isUploaded})},s.prototype.getReadyItems=function(){return this.queue.filter(function(e){return e.isReady&&!e.isUploading}).sort(function(e,t){return e.index-t.index})},s.prototype.destroy=function(){e.forEach(this._directives,function(t){e.forEach(this._directives[t],function(e){e.destroy()},this)},this)},s.prototype.onAfterAddingAll=function(){},s.prototype.onAfterAddingFile=function(){},s.prototype.onWhenAddingFileFailed=function(){},s.prototype.onBeforeUploadItem=function(){},s.prototype.onProgressItem=function(){},s.prototype.onProgressAll=function(){},s.prototype.onSuccessItem=function(){},s.prototype.onErrorItem=function(){},s.prototype.onCancelItem=function(){},s.prototype.onCompleteItem=function(){},s.prototype.onCompleteAll=function(){},s.prototype._getTotalProgress=function(e){if(this.removeAfterUpload)return e||0;var t=this.getNotUploadedItems().length,n=t?this.queue.length-t:this.queue.length,i=100/this.queue.length,o=(e||0)*i/100;return Math.round(n*i+o)},s.prototype._getFilters=function(t){if(e.isUndefined(t))return this.filters;if(e.isArray(t))return t;var n=t.split(/\s*,/);return this.filters.filter(function(e){return-1!==n.indexOf(e.name)},this)},s.prototype._render=function(){n.$$phase||n.$apply()},s.prototype._folderFilter=function(e){return!(!e.size&&!e.type)},s.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit},s.prototype._isValidFile=function(e,t,n){return this._failFilterIndex=-1,t.length?t.every(function(t){return this._failFilterIndex++,t.fn.call(this,e,n)},this):!0},s.prototype._isSuccessCode=function(e){return e>=200&&300>e||304===e},s.prototype._transformResponse=function(t){return e.forEach(i.defaults.transformResponse,function(e){t=e(t)}),t},s.prototype._parseHeaders=function(t){function n(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function i(e){return e.toLowerCase()}var o,r,s,a={};return t?(e.forEach(t.split("\n"),function(e){s=e.indexOf(":"),o=i(n(e.substr(0,s))),r=n(e.substr(s+1)),o&&(a[o]=a[o]?a[o]+", "+r:r)}),a):a},s.prototype._xhrTransport=function(t){var n=t._xhr=new XMLHttpRequest,i=new FormData,o=this;o._onBeforeUploadItem(t),e.forEach(t.formData,function(t){e.forEach(t,function(e,t){i.append(t,e)})}),i.append(t.alias,t._file,t.file.name),n.upload.onprogress=function(e){var n=Math.round(e.lengthComputable?100*e.loaded/e.total:0);o._onProgressItem(t,n)},n.onload=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response),r=o._isSuccessCode(n.status)?"Success":"Error",s="_on"+r+"Item";o[s](t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.onerror=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response);o._onErrorItem(t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.onabort=function(){var e=o._parseHeaders(n.getAllResponseHeaders()),i=o._transformResponse(n.response);o._onCancelItem(t,i,n.status,e),o._onCompleteItem(t,i,n.status,e)},n.open(t.method,t.url,!0),n.withCredentials=t.withCredentials,e.forEach(t.headers,function(e,t){n.setRequestHeader(t,e)}),n.send(i),this._render()},s.prototype._iframeTransport=function(t){var n=e.element('<form style="display: none;" />'),i=e.element('<iframe name="iframeTransport'+Date.now()+'">'),o=t._input,r=this;t._form&&t._form.replaceWith(o),t._form=n,r._onBeforeUploadItem(t),o.prop("name",t.alias),e.forEach(t.formData,function(t){e.forEach(t,function(t,i){n.append(e.element('<input type="hidden" name="'+i+'" value="'+t+'" />'))})}),n.prop({action:t.url,method:"POST",target:i.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),i.bind("load",function(){try{var e=i[0].contentDocument.body.innerHTML}catch(n){}var o={response:e,status:200,dummy:!0},s=r._transformResponse(o.response),a={};r._onSuccessItem(t,s,o.status,a),r._onCompleteItem(t,s,o.status,a)}),n.abort=function(){var e,s={status:0,dummy:!0},a={};i.unbind("load").prop("src","javascript:false;"),n.replaceWith(o),r._onCancelItem(t,e,s.status,a),r._onCompleteItem(t,e,s.status,a)},o.after(n),n.append(o).append(i),n[0].submit(),this._render()},s.prototype._onWhenAddingFileFailed=function(e,t,n){this.onWhenAddingFileFailed(e,t,n)},s.prototype._onAfterAddingFile=function(e){this.onAfterAddingFile(e)},s.prototype._onAfterAddingAll=function(e){this.onAfterAddingAll(e)},s.prototype._onBeforeUploadItem=function(e){e._onBeforeUpload(),this.onBeforeUploadItem(e)},s.prototype._onProgressItem=function(e,t){var n=this._getTotalProgress(t);this.progress=n,e._onProgress(t),this.onProgressItem(e,t),this.onProgressAll(n),this._render()},s.prototype._onSuccessItem=function(e,t,n,i){e._onSuccess(t,n,i),this.onSuccessItem(e,t,n,i)},s.prototype._onErrorItem=function(e,t,n,i){e._onError(t,n,i),this.onErrorItem(e,t,n,i)},s.prototype._onCancelItem=function(e,t,n,i){e._onCancel(t,n,i),this.onCancelItem(e,t,n,i)},s.prototype._onCompleteItem=function(t,n,i,o){t._onComplete(n,i,o),this.onCompleteItem(t,n,i,o);var r=this.getReadyItems()[0];return this.isUploading=!1,e.isDefined(r)?void r.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())},s.isFile=s.prototype.isFile,s.isFileLikeObject=s.prototype.isFileLikeObject,s.isArrayLikeObject=s.prototype.isArrayLikeObject,s.isHTML5=s.prototype.isHTML5,s.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.super_=t},s.FileLikeObject=a,s.FileItem=l,s.FileDirective=c,s.FileSelect=u,s.FileDrop=d,s.FileOver=h,a.prototype._createFromFakePath=function(e){this.lastModifiedDate=null,this.size=null,this.type="like/"+e.slice(e.lastIndexOf(".")+1).toLowerCase(),this.name=e.slice(e.lastIndexOf("/")+e.lastIndexOf("\\")+2)},a.prototype._createFromObject=function(t){this.lastModifiedDate=e.copy(t.lastModifiedDate),this.size=t.size,this.type=t.type,this.name=t.name},l.prototype.upload=function(){this.uploader.uploadItem(this)},l.prototype.cancel=function(){this.uploader.cancelItem(this)},l.prototype.remove=function(){this.uploader.removeFromQueue(this)},l.prototype.onBeforeUpload=function(){},l.prototype.onProgress=function(){},l.prototype.onSuccess=function(){},l.prototype.onError=function(){},l.prototype.onCancel=function(){},l.prototype.onComplete=function(){},l.prototype._onBeforeUpload=function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},l.prototype._onProgress=function(e){this.progress=e,this.onProgress(e)},l.prototype._onSuccess=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(e,t,n)},l.prototype._onError=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(e,t,n)},l.prototype._onCancel=function(e,t,n){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(e,t,n)},l.prototype._onComplete=function(e,t,n){this.onComplete(e,t,n),this.removeAfterUpload&&this.remove()},l.prototype._destroy=function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input},l.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0},l.prototype._replaceNode=function(e){var t=r(e.clone())(e.scope());t.prop("value",null),e.css("display","none"),e.after(t)},c.prototype.events={},c.prototype.bind=function(){for(var e in this.events){var t=this.events[e];this.element.bind(e,this[t])}},c.prototype.unbind=function(){for(var e in this.events)this.element.unbind(e,this.events[e])},c.prototype.destroy=function(){var e=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(e,1),this.unbind()},c.prototype._saveLinks=function(){for(var e in this.events){var t=this.events[e];this[t]=this[t].bind(this)}},s.inherit(u,c),u.prototype.events={$destroy:"destroy",change:"onChange"},u.prototype.prop="select",u.prototype.getOptions=function(){},u.prototype.getFilters=function(){},u.prototype.isEmptyAfterSelection=function(){return!!this.element.attr("multiple")},u.prototype.onChange=function(){var e=this.uploader.isHTML5?this.element[0].files:this.element[0],t=this.getOptions(),n=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(e,t,n),this.isEmptyAfterSelection()&&this.element.prop("value",null)},s.inherit(d,c),d.prototype.events={$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"},d.prototype.prop="drop",d.prototype.getOptions=function(){},d.prototype.getFilters=function(){},d.prototype.onDrop=function(t){var n=this._getTransfer(t);if(n){var i=this.getOptions(),o=this.getFilters();this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._removeOverClass,this),this.uploader.addToQueue(n.files,i,o)}},d.prototype.onDragOver=function(t){var n=this._getTransfer(t);this._haveFiles(n.types)&&(n.dropEffect="copy",this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._addOverClass,this))},d.prototype.onDragLeave=function(t){t.target===this.element[0]&&(this._preventAndStop(t),e.forEach(this.uploader._directives.over,this._removeOverClass,this))},d.prototype._getTransfer=function(e){return e.dataTransfer?e.dataTransfer:e.originalEvent.dataTransfer},d.prototype._preventAndStop=function(e){e.preventDefault(),e.stopPropagation()},d.prototype._haveFiles=function(e){return e?e.indexOf?-1!==e.indexOf("Files"):e.contains?e.contains("Files"):!1:!1},d.prototype._addOverClass=function(e){e.addOverClass()},d.prototype._removeOverClass=function(e){e.removeOverClass()},s.inherit(h,c),h.prototype.events={$destroy:"destroy"},h.prototype.prop="over",h.prototype.overClass="nv-file-over",h.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())},h.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())},h.prototype.getOverClass=function(){return this.overClass},s}]).directive("nvFileSelect",["$parse","FileUploader",function(e,t){return{link:function(n,i,o){var r=n.$eval(o.uploader);if(!(r instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');var s=new t.FileSelect({uploader:r,element:i});s.getOptions=e(o.options).bind(s,n),s.getFilters=function(){return o.filters}}}}]).directive("nvFileDrop",["$parse","FileUploader",function(e,t){return{link:function(n,i,o){var r=n.$eval(o.uploader);if(!(r instanceof t))throw new TypeError('"Uploader" must be an instance of FileUploader');if(r.isHTML5){var s=new t.FileDrop({uploader:r,element:i});s.getOptions=e(o.options).bind(s,n),s.getFilters=function(){return o.filters}}}}}]).directive("nvFileOver",["FileUploader",function(e){return{link:function(t,n,i){var o=t.$eval(i.uploader);if(!(o instanceof e))throw new TypeError('"Uploader" must be an instance of FileUploader');var r=new e.FileOver({uploader:o,element:n});r.getOverClass=function(){return i.overClass||this.overClass}}}}]),t}),"undefined"==typeof jQuery)throw new Error("Jasny Bootstrap's JavaScript requires jQuery");+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}void 0===e.support.transition&&(e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one(e.support.transition.end,function(){n=!0});var o=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(o,t),this},e(function(){e.support.transition=t()}))}(window.jQuery),+function(e){"use strict";var t=function(n,i){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,i),this.state=null,this.placement=null,this.options.recalc&&(this.calcClone(),e(window).on("resize",e.proxy(this.recalc,this))),this.options.autohide&&e(document).on("click",e.proxy(this.autohide,this)),this.options.toggle&&this.toggle(),this.options.disablescrolling&&(this.options.disableScrolling=this.options.disablescrolling,delete this.options.disablescrolling)};t.DEFAULTS={toggle:!0,placement:"auto",autohide:!0,recalc:!0,disableScrolling:!0},t.prototype.offset=function(){switch(this.placement){case"left":case"right":return this.$element.outerWidth();case"top":case"bottom":return this.$element.outerHeight()}},t.prototype.calcPlacement=function(){function t(e,t){if("auto"===o.css(t))return e;if("auto"===o.css(e))return t;var n=parseInt(o.css(e),10),i=parseInt(o.css(t),10);return n>i?t:e}if("auto"!==this.options.placement)return void(this.placement=this.options.placement);this.$element.hasClass("in")||this.$element.css("visiblity","hidden !important").addClass("in");var n=e(window).width()/this.$element.width(),i=e(window).height()/this.$element.height(),o=this.$element;this.placement=n>=i?t("left","right"):t("top","bottom"),"hidden !important"===this.$element.css("visibility")&&this.$element.removeClass("in").css("visiblity","")},t.prototype.opposite=function(e){switch(e){case"top":return"bottom";case"left":return"right";case"bottom":return"top";case"right":return"left"}},t.prototype.getCanvasElements=function(){var t=this.options.canvas?e(this.options.canvas):this.$element,n=t.find("*").filter(function(){return"fixed"===e(this).css("position")}).not(this.options.exclude);return t.add(n)},t.prototype.slide=function(t,n,i){if(!e.support.transition){var o={};return o[this.placement]="+="+n,t.animate(o,350,i)}var r=this.placement,s=this.opposite(r);t.each(function(){"auto"!==e(this).css(r)&&e(this).css(r,(parseInt(e(this).css(r),10)||0)+n),"auto"!==e(this).css(s)&&e(this).css(s,(parseInt(e(this).css(s),10)||0)-n)}),this.$element.one(e.support.transition.end,i).emulateTransitionEnd(350)},t.prototype.disableScrolling=function(){var t=e("body").width(),n="padding-"+this.opposite(this.placement);if(void 0===e("body").data("offcanvas-style")&&e("body").data("offcanvas-style",e("body").attr("style")||""),e("body").css("overflow","hidden"),e("body").width()>t){var i=parseInt(e("body").css(n),10)+e("body").width()-t;setTimeout(function(){e("body").css(n,i)},1)}},t.prototype.show=function(){if(!this.state){var t=e.Event("show.bs.offcanvas");if(this.$element.trigger(t),!t.isDefaultPrevented()){this.state="slide-in",this.calcPlacement();var n=this.getCanvasElements(),i=this.placement,o=this.opposite(i),r=this.offset();-1!==n.index(this.$element)&&(e(this.$element).data("offcanvas-style",e(this.$element).attr("style")||""),this.$element.css(i,-1*r),this.$element.css(i)),n.addClass("canvas-sliding").each(function(){void 0===e(this).data("offcanvas-style")&&e(this).data("offcanvas-style",e(this).attr("style")||""),"static"===e(this).css("position")&&e(this).css("position","relative"),"auto"!==e(this).css(i)&&"0px"!==e(this).css(i)||"auto"!==e(this).css(o)&&"0px"!==e(this).css(o)||e(this).css(i,0)}),this.options.disableScrolling&&this.disableScrolling();var s=function(){"slide-in"==this.state&&(this.state="slid",n.removeClass("canvas-sliding").addClass("canvas-slid"),this.$element.trigger("shown.bs.offcanvas"))};setTimeout(e.proxy(function(){this.$element.addClass("in"),this.slide(n,r,e.proxy(s,this))},this),1)}}},t.prototype.hide=function(){if("slid"===this.state){var t=e.Event("hide.bs.offcanvas");if(this.$element.trigger(t),!t.isDefaultPrevented()){this.state="slide-out";var n=e(".canvas-slid"),i=(this.placement,-1*this.offset()),o=function(){"slide-out"==this.state&&(this.state=null,this.placement=null,this.$element.removeClass("in"),n.removeClass("canvas-sliding"),n.add(this.$element).add("body").each(function(){e(this).attr("style",e(this).data("offcanvas-style")).removeData("offcanvas-style")}),this.$element.trigger("hidden.bs.offcanvas"))};n.removeClass("canvas-slid").addClass("canvas-sliding"),setTimeout(e.proxy(function(){this.slide(n,i,e.proxy(o,this))},this),1)}}},t.prototype.toggle=function(){"slide-in"!==this.state&&"slide-out"!==this.state&&this["slid"===this.state?"hide":"show"]()},t.prototype.calcClone=function(){this.$calcClone=this.$element.clone().html("").addClass("offcanvas-clone").removeClass("in").appendTo(e("body"))},t.prototype.recalc=function(){if("none"!==this.$calcClone.css("display")&&("slid"===this.state||"slide-in"===this.state)){this.state=null,this.placement=null;var t=this.getCanvasElements();this.$element.removeClass("in"),t.removeClass("canvas-slid"),t.add(this.$element).add("body").each(function(){e(this).attr("style",e(this).data("offcanvas-style")).removeData("offcanvas-style")})}},t.prototype.autohide=function(t){0===e(t.target).closest(this.$element).length&&this.hide()};var n=e.fn.offcanvas;e.fn.offcanvas=function(n){return this.each(function(){var i=e(this),o=i.data("bs.offcanvas"),r=e.extend({},t.DEFAULTS,i.data(),"object"==typeof n&&n);o||i.data("bs.offcanvas",o=new t(this,r)),"string"==typeof n&&o[n]()})},e.fn.offcanvas.Constructor=t,e.fn.offcanvas.noConflict=function(){return e.fn.offcanvas=n,this},e(document).on("click.bs.offcanvas.data-api","[data-toggle=offcanvas]",function(t){var n,i=e(this),o=i.attr("data-target")||t.preventDefault()||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),r=e(o),s=r.data("bs.offcanvas"),a=s?"toggle":i.data();t.stopPropagation(),s?s.toggle():r.offcanvas(a)})}(window.jQuery),+function(e){"use strict";var t=function(n,i){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,i),this.$element.on("click.bs.rowlink","td:not(.rowlink-skip)",e.proxy(this.click,this))};t.DEFAULTS={target:"a"},t.prototype.click=function(t){var n=e(t.currentTarget).closest("tr").find(this.options.target)[0];if(e(t.target)[0]!==n)if(t.preventDefault(),n.click)n.click();else if(document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}};var n=e.fn.rowlink;e.fn.rowlink=function(n){return this.each(function(){var i=e(this),o=i.data("bs.rowlink");o||i.data("bs.rowlink",o=new t(this,n))})},e.fn.rowlink.Constructor=t,e.fn.rowlink.noConflict=function(){return e.fn.rowlink=n,this},e(document).on("click.bs.rowlink.data-api",'[data-link="row"]',function(t){if(0===e(t.target).closest(".rowlink-skip").length){var n=e(this);n.data("bs.rowlink")||(n.rowlink(n.data()),e(t.target).trigger("click.bs.rowlink"))}})}(window.jQuery),+function(e){"use strict";var t=void 0!==window.orientation,n=navigator.userAgent.toLowerCase().indexOf("android")>-1,i="Microsoft Internet Explorer"==window.navigator.appName,o=function(t,i){n||(this.$element=e(t),this.options=e.extend({},o.DEFAULTS,i),this.mask=String(this.options.mask),this.init(),this.listen(),this.checkVal())};o.DEFAULTS={mask:"",placeholder:"_",definitions:{9:"[0-9]",a:"[A-Za-z]",w:"[A-Za-z0-9]","*":"."}},o.prototype.init=function(){var t=this.options.definitions,n=this.mask.length;this.tests=[],this.partialPosition=this.mask.length,this.firstNonMaskPos=null,e.each(this.mask.split(""),e.proxy(function(e,i){"?"==i?(n--,this.partialPosition=e):t[i]?(this.tests.push(new RegExp(t[i])),null===this.firstNonMaskPos&&(this.firstNonMaskPos=this.tests.length-1)):this.tests.push(null)},this)),this.buffer=e.map(this.mask.split(""),e.proxy(function(e){return"?"!=e?t[e]?this.options.placeholder:e:void 0},this)),this.focusText=this.$element.val(),this.$element.data("rawMaskFn",e.proxy(function(){return e.map(this.buffer,function(e,t){return this.tests[t]&&e!=this.options.placeholder?e:null}).join("")},this))},o.prototype.listen=function(){if(!this.$element.attr("readonly")){var t=(i?"paste":"input")+".mask";this.$element.on("unmask.bs.inputmask",e.proxy(this.unmask,this)).on("focus.bs.inputmask",e.proxy(this.focusEvent,this)).on("blur.bs.inputmask",e.proxy(this.blurEvent,this)).on("keydown.bs.inputmask",e.proxy(this.keydownEvent,this)).on("keypress.bs.inputmask",e.proxy(this.keypressEvent,this)).on(t,e.proxy(this.pasteEvent,this))}},o.prototype.caret=function(e,t){if(0!==this.$element.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.$element.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this.$element[0].setSelectionRange)e=this.$element[0].selectionStart,t=this.$element[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},o.prototype.seekNext=function(e){for(var t=this.mask.length;++e<=t&&!this.tests[e];);return e},o.prototype.seekPrev=function(e){for(;--e>=0&&!this.tests[e];);return e},o.prototype.shiftL=function(e,t){var n=this.mask.length;if(!(0>e)){for(var i=e,o=this.seekNext(t);n>i;i++)if(this.tests[i]){if(!(n>o&&this.tests[i].test(this.buffer[o])))break;this.buffer[i]=this.buffer[o],this.buffer[o]=this.options.placeholder,o=this.seekNext(o)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,e))}},o.prototype.shiftR=function(e){for(var t=this.mask.length,n=e,i=this.options.placeholder;t>n;n++)if(this.tests[n]){var o=this.seekNext(n),r=this.buffer[n];if(this.buffer[n]=i,!(t>o&&this.tests[o].test(r)))break;i=r}},o.prototype.unmask=function(){this.$element.unbind(".mask").removeData("inputmask")},o.prototype.focusEvent=function(){this.focusText=this.$element.val();var e=this.mask.length,t=this.checkVal();this.writeBuffer();var n=this,i=function(){t==e?n.caret(0,t):n.caret(t)};i(),setTimeout(i,50)},o.prototype.blurEvent=function(){this.checkVal(),this.$element.val()!==this.focusText&&this.$element.trigger("change")},o.prototype.keydownEvent=function(e){var n=e.which;if(8==n||46==n||t&&127==n){var i=this.caret(),o=i.begin,r=i.end;return r-o===0&&(o=46!=n?this.seekPrev(o):r=this.seekNext(o-1),r=46==n?this.seekNext(r):r),this.clearBuffer(o,r),this.shiftL(o,r-1),!1}return 27==n?(this.$element.val(this.focusText),this.caret(0,this.checkVal()),!1):void 0},o.prototype.keypressEvent=function(e){var t=this.mask.length,n=e.which,i=this.caret();if(e.ctrlKey||e.altKey||e.metaKey||32>n)return!0;if(n){i.end-i.begin!==0&&(this.clearBuffer(i.begin,i.end),this.shiftL(i.begin,i.end-1));var o=this.seekNext(i.begin-1);if(t>o){var r=String.fromCharCode(n);if(this.tests[o].test(r)){this.shiftR(o),this.buffer[o]=r,this.writeBuffer();var s=this.seekNext(o);this.caret(s)}}return!1}},o.prototype.pasteEvent=function(){var e=this;setTimeout(function(){e.caret(e.checkVal(!0))},0)},o.prototype.clearBuffer=function(e,t){for(var n=this.mask.length,i=e;t>i&&n>i;i++)this.tests[i]&&(this.buffer[i]=this.options.placeholder)},o.prototype.writeBuffer=function(){return this.$element.val(this.buffer.join("")).val()},o.prototype.checkVal=function(e){for(var t=this.mask.length,n=this.$element.val(),i=-1,o=0,r=0;t>o;o++)if(this.tests[o]){for(this.buffer[o]=this.options.placeholder;r++<n.length;){var s=n.charAt(r-1);if(this.tests[o].test(s)){this.buffer[o]=s,i=o;break}}if(r>n.length)break}else this.buffer[o]==n.charAt(r)&&o!=this.partialPosition&&(r++,i=o);return!e&&i+1<this.partialPosition?(this.$element.val(""),this.clearBuffer(0,t)):(e||i+1>=this.partialPosition)&&(this.writeBuffer(),e||this.$element.val(this.$element.val().substring(0,i+1))),this.partialPosition?o:this.firstNonMaskPos};var r=e.fn.inputmask;e.fn.inputmask=function(t){return this.each(function(){var n=e(this),i=n.data("bs.inputmask");i||n.data("bs.inputmask",i=new o(this,t))})},e.fn.inputmask.Constructor=o,e.fn.inputmask.noConflict=function(){return e.fn.inputmask=r,this},e(document).on("focus.bs.inputmask.data-api","[data-mask]",function(){var t=e(this);t.data("bs.inputmask")||t.inputmask(t.data())})}(window.jQuery),+function(e){"use strict";var t="Microsoft Internet Explorer"==window.navigator.appName,n=function(t,n){if(this.$element=e(t),this.$input=this.$element.find(":file"),0!==this.$input.length){this.name=this.$input.attr("name")||n.name,this.$hidden=this.$element.find('input[type=hidden][name="'+this.name+'"]'),0===this.$hidden.length&&(this.$hidden=e('<input type="hidden">').insertBefore(this.$input)),this.$preview=this.$element.find(".fileinput-preview");var i=this.$preview.css("height");"inline"!==this.$preview.css("display")&&"0px"!==i&&"none"!==i&&this.$preview.css("line-height",i),this.original={exists:this.$element.hasClass("fileinput-exists"),preview:this.$preview.html(),hiddenVal:this.$hidden.val()},this.listen()}};n.prototype.listen=function(){this.$input.on("change.bs.fileinput",e.proxy(this.change,this)),e(this.$input[0].form).on("reset.bs.fileinput",e.proxy(this.reset,this)),this.$element.find('[data-trigger="fileinput"]').on("click.bs.fileinput",e.proxy(this.trigger,this)),this.$element.find('[data-dismiss="fileinput"]').on("click.bs.fileinput",e.proxy(this.clear,this))},n.prototype.change=function(t){var n=void 0===t.target.files?t.target&&t.target.value?[{name:t.target.value.replace(/^.+\\/,"")}]:[]:t.target.files;if(t.stopPropagation(),0===n.length)return void this.clear();this.$hidden.val(""),this.$hidden.attr("name",""),this.$input.attr("name",this.name);var i=n[0];if(this.$preview.length>0&&("undefined"!=typeof i.type?i.type.match(/^image\/(gif|png|jpeg)$/):i.name.match(/\.(gif|png|jpe?g)$/i))&&"undefined"!=typeof FileReader){var o=new FileReader,r=this.$preview,s=this.$element;o.onload=function(t){var o=e("<img>");o[0].src=t.target.result,n[0].result=t.target.result,s.find(".fileinput-filename").text(i.name),"none"!=r.css("max-height")&&o.css("max-height",parseInt(r.css("max-height"),10)-parseInt(r.css("padding-top"),10)-parseInt(r.css("padding-bottom"),10)-parseInt(r.css("border-top"),10)-parseInt(r.css("border-bottom"),10)),r.html(o),s.addClass("fileinput-exists").removeClass("fileinput-new"),s.trigger("change.bs.fileinput",n)},o.readAsDataURL(i)}else this.$element.find(".fileinput-filename").text(i.name),this.$preview.text(i.name),this.$element.addClass("fileinput-exists").removeClass("fileinput-new"),this.$element.trigger("change.bs.fileinput")},n.prototype.clear=function(e){if(e&&e.preventDefault(),this.$hidden.val(""),this.$hidden.attr("name",this.name),this.$input.attr("name",""),t){var n=this.$input.clone(!0);this.$input.after(n),this.$input.remove(),this.$input=n}else this.$input.val("");this.$preview.html(""),this.$element.find(".fileinput-filename").text(""),this.$element.addClass("fileinput-new").removeClass("fileinput-exists"),void 0!==e&&(this.$input.trigger("change"),this.$element.trigger("clear.bs.fileinput"))},n.prototype.reset=function(){this.clear(),this.$hidden.val(this.original.hiddenVal),this.$preview.html(this.original.preview),this.$element.find(".fileinput-filename").text(""),this.original.exists?this.$element.addClass("fileinput-exists").removeClass("fileinput-new"):this.$element.addClass("fileinput-new").removeClass("fileinput-exists"),this.$element.trigger("reset.bs.fileinput")},n.prototype.trigger=function(e){this.$input.trigger("click"),e.preventDefault()};var i=e.fn.fileinput;e.fn.fileinput=function(t){return this.each(function(){var i=e(this),o=i.data("bs.fileinput");o||i.data("bs.fileinput",o=new n(this,t)),"string"==typeof t&&o[t]();

})},e.fn.fileinput.Constructor=n,e.fn.fileinput.noConflict=function(){return e.fn.fileinput=i,this},e(document).on("click.fileinput.data-api",'[data-provides="fileinput"]',function(t){var n=e(this);if(!n.data("bs.fileinput")){n.fileinput(n.data());var i=e(t.target).closest('[data-dismiss="fileinput"],[data-trigger="fileinput"]');i.length>0&&(t.preventDefault(),i.trigger("click.bs.fileinput"))}})}(window.jQuery),!function(e,t){"use strict";function n(){var e={http:null,interval:600};this.http=function(n){if(!n)throw new Error("Argument must be a string containing a URL, or an object containing the HTTP request configuration.");t.isString(n)&&(n={url:n,method:"GET"}),n.cache=!1,e.http=n},this.interval=function(t){if(t=parseInt(t),isNaN(t)||0>=t)throw new Error("Interval must be expressed in seconds and be greater than 0.");e.interval=t},this.$get=function(n,i,o,r){function s(e,t){n.$broadcast("$keepaliveResponse",e,t)}function a(){n.$broadcast("$keepalive"),t.isObject(e.http)&&r(e.http).success(s).error(s)}var l={ping:null};return{_options:function(){return e},start:function(){o.cancel(l.ping),l.ping=o(a,1e3*e.interval)},stop:function(){o.cancel(l.ping)},ping:function(){a()}}},this.$get.$inject=["$rootScope","$log","$interval","$http"]}function i(){var e={idleDuration:1200,warningDuration:30,autoResume:!0,events:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart",keepalive:!0};this.activeOn=function(t){e.events=t},this.idleDuration=function(t){if(0>=t)throw new Error("idleDuration must be a value in seconds, greater than 0.");e.idleDuration=t},this.warningDuration=function(t){if(0>t)throw new Error("warning must be a value in seconds, greater than 0.");e.warningDuration=t},this.autoResume=function(t){e.autoResume=t===!0},this.keepalive=function(t){e.keepalive=t===!0},this.$get=function(t,n,i,o,r){function s(){e.keepalive&&(u.running&&r.ping(),r.start())}function a(){e.keepalive&&r.stop()}function l(){u.idling=!u.idling;var n=u.idling?"Start":"End";i.$broadcast("$idle"+n),u.idling?(a(),u.countdown=e.warningDuration,c(),u.warning=t(c,1e3,e.warningDuration)):s(),t.cancel(u.idle)}function c(){u.countdown<=0?i.$broadcast("$idleTimeout"):i.$broadcast("$idleWarn",u.countdown),u.countdown--}var u={idle:null,warning:null,idling:!1,running:!1,countdown:null},d={_options:function(){return e},running:function(){return u.running},idling:function(){return u.idling},watch:function(){t.cancel(u.idle),t.cancel(u.warning),u.idling?l():u.running||s(),u.running=!0,u.idle=t(l,1e3*e.idleDuration)},unwatch:function(){t.cancel(u.idle),t.cancel(u.warning),u.idling=!1,u.running=!1}},h=function(){u.running&&e.autoResume&&d.watch()};return o.find("body").on(e.events,h),d},this.$get.$inject=["$interval","$log","$rootScope","$document","$keepalive"]}t.module("ngIdle.keepalive",[]).provider("$keepalive",n),t.module("ngIdle.idle",[]).provider("$idle",i),t.module("ngIdle.ngIdleCountdown",[]).directive("ngIdleCountdown",function(){return{restrict:"A",scope:{value:"=ngIdleCountdown"},link:function(e){e.$on("$idleWarn",function(t,n){e.value=n}),e.$on("$idleTimeout",function(){e.value=0})}}}),t.module("ngIdle",["ngIdle.keepalive","ngIdle.idle","ngIdle.ngIdleCountdown"])}(window,window.angular),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.io=e()}}(function(){var e;return function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,n){function i(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=o(e),r=i.source,c=i.id;return t.forceNew||t["force new connection"]||!1===t.multiplex?(a("ignoring socket cache for %s",r),n=s(r,t)):(l[c]||(a("new io instance for %s",r),l[c]=s(r,t)),n=l[c]),n.socket(i.path)}var o=e("./url"),r=e("socket.io-parser"),s=e("./manager"),a=e("debug")("socket.io-client");t.exports=n=i;var l=n.managers={};n.protocol=r.protocol,n.connect=i,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(e,t,n){function i(e,t){return this instanceof i?(e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=t.autoConnect!==!1,void(this.autoConnect&&this.open())):new i(e,t)}var o=(e("./url"),e("engine.io-client")),r=e("./socket"),s=e("component-emitter"),a=e("socket.io-parser"),l=e("./on"),c=e("component-bind"),u=(e("object-component"),e("debug")("socket.io-client:manager")),d=e("indexof"),h=e("backo2");t.exports=i,i.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},i.prototype.updateSocketIds=function(){for(var e in this.nsps)this.nsps[e].id=this.engine.id},s(i.prototype),i.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},i.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},i.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},i.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},i.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},i.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},i.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},i.prototype.open=i.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=o(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=l(t,"open",function(){n.onopen(),e&&e()}),r=l(t,"error",function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var i=new Error("Connection error");i.data=t,e(i)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;u("connect attempt will timeout after %d",s);var a=setTimeout(function(){u("connect attempt timed out after %d",s),i.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(i),this.subs.push(r),this},i.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(l(e,"data",c(this,"ondata"))),this.subs.push(l(this.decoder,"decoded",c(this,"ondecoded"))),this.subs.push(l(e,"error",c(this,"onerror"))),this.subs.push(l(e,"close",c(this,"onclose")))},i.prototype.ondata=function(e){this.decoder.add(e)},i.prototype.ondecoded=function(e){this.emit("packet",e)},i.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},i.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new r(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){t.id=n.engine.id,~d(n.connected,t)||n.connected.push(t)})}return t},i.prototype.destroy=function(e){var t=d(this.connected,e);~t&&this.connected.splice(t,1),this.connected.length||this.close()},i.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},i.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},i.prototype.cleanup=function(){for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},i.prototype.close=i.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},i.prototype.onclose=function(e){u("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},i.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},i.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(e,t,n){function i(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}t.exports=i},{}],5:[function(e,t,n){function i(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var o=e("socket.io-parser"),r=e("component-emitter"),s=e("to-array"),a=e("./on"),l=e("component-bind"),c=e("debug")("socket.io-client:socket"),u=e("has-binary");t.exports=n=i;var d={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},h=r.prototype.emit;r(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",l(this,"onopen")),a(e,"packet",l(this,"onpacket")),a(e,"close",l(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},i.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(d.hasOwnProperty(e))return h.apply(this,arguments),this;var t=s(arguments),n=o.EVENT;u(t)&&(n=o.BINARY_EVENT);var i={type:n,data:t};return"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:o.CONNECT})},i.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:this.onevent(e);break;case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:this.onack(e);break;case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=s(arguments);c("sending ack %j",i);var r=u(i)?o.BINARY_ACK:o.ACK;t.packet({type:r,id:e,data:i})}}},i.prototype.onack=function(e){c("calling ack %s with %j",e.id,e.data);var t=this.acks[e.id];t.apply(this,e.data),delete this.acks[e.id]},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(e,t,n){(function(n){function i(e,t){var i=e,t=t||n.location;return null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.hostname+e),/^(https?|wss?):\/\//.test(e)||(r("protocol-less url %s",e),e="undefined"!=typeof t?t.protocol+"//"+e:"https://"+e),r("parse %s",e),i=o(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/",i.id=i.protocol+"://"+i.host+":"+i.port,i.href=i.protocol+"://"+i.host+(t&&t.port==i.port?"":":"+i.port),i}var o=e("parseuri"),r=e("debug")("socket.io-client:url");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:10,parseuri:44}],7:[function(e,t,n){function i(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=i,i.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(e){this.ms=e},i.prototype.setMax=function(e){this.max=e},i.prototype.setJitter=function(e){this.jitter=e}},{}],8:[function(e,t,n){var i=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}},{}],9:[function(e,t,n){function i(e){return e?o(e):void 0}function o(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i,o=0;o<n.length;o++)if(i=n[o],i===t||i.fn===t){n.splice(o,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var i=0,o=n.length;o>i;++i)n[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],10:[function(e,t,n){function i(e){return i.enabled(e)?function(t){t=o(t);var n=new Date,r=n-(i[e]||n);i[e]=n,t=e+" "+t+" +"+i.humanize(r),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function o(e){return e instanceof Error?e.stack||e.message:e}t.exports=i,i.names=[],i.skips=[],i.enable=function(e){try{localStorage.debug=e}catch(t){}for(var n=(e||"").split(/[\s,]+/),o=n.length,r=0;o>r;r++)e=n[r].replace("*",".*?"),"-"===e[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$"))},i.disable=function(){i.enable("")},i.humanize=function(e){var t=1e3,n=6e4,i=60*n;return e>=i?(e/i).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},i.enabled=function(e){for(var t=0,n=i.skips.length;n>t;t++)if(i.skips[t].test(e))return!1;for(var t=0,n=i.names.length;n>t;t++)if(i.names[t].test(e))return!0;return!1};try{window.localStorage&&i.enable(localStorage.debug)}catch(r){}},{}],11:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":12}],12:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(e,t,n){(function(n){function i(e,t){if(!(this instanceof i))return new i(e,t);if(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=u(e),t.host=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.host){var o=t.host.split(":");t.hostname=o.shift(),o.length?t.port=o.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized||null,this.open()}function o(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r=e("./transports"),s=e("component-emitter"),a=e("debug")("engine.io-client:socket"),l=e("indexof"),c=e("engine.io-parser"),u=e("parseuri"),d=e("parsejson"),h=e("parseqs");t.exports=i,i.priorWebsocketSuccess=!1,s(i.prototype),i.protocol=c.protocol,i.Socket=i,i.Transport=e("./transport"),i.transports=e("./transports"),i.parser=e("engine.io-parser"),i.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=o(this.query);t.EIO=c.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return n},i.prototype.open=function(){var e;if(this.rememberUpgrade&&i.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},i.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},i.prototype.probe=function(e){function t(){if(h.onlyBinaryUpgrades){var t=!this.supportsBinary&&h.transport.supportsBinary;d=d||t}d||(a('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(t){if(!d)if("pong"==t.type&&"probe"==t.data){if(a('probe transport "%s" pong',e),h.upgrading=!0,h.emit("upgrading",u),!u)return;i.priorWebsocketSuccess="websocket"==u.name,a('pausing current transport "%s"',h.transport.name),h.transport.pause(function(){d||"closed"!=h.readyState&&(a("changing transport and sending upgrade packet"),c(),h.setTransport(u),u.send([{type:"upgrade"}]),h.emit("upgrade",u),u=null,h.upgrading=!1,h.flush())})}else{a('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=u.name,h.emit("upgradeError",n)}}))}function n(){d||(d=!0,c(),u.close(),u=null)}function o(t){var i=new Error("probe error: "+t);i.transport=u.name,n(),a('probe transport "%s" failed because of error: %s',e,t),h.emit("upgradeError",i)}function r(){o("transport closed")}function s(){o("socket closed")}function l(e){u&&e.name!=u.name&&(a('"%s" works - aborting "%s"',e.name,u.name),n())}function c(){u.removeListener("open",t),u.removeListener("error",o),u.removeListener("close",r),h.removeListener("close",s),h.removeListener("upgrading",l)}a('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),d=!1,h=this;i.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",o),u.once("close",r),this.once("close",s),this.once("upgrading",l),u.open()},i.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",i.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;t>e;e++)this.probe(this.upgrades[e])}},i.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(d(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},i.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},i.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},i.prototype.ping=function(){this.sendPacket("ping")},i.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},i.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},i.prototype.write=i.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},i.prototype.sendPacket=function(e,t,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var i={type:e,data:t};this.emit("packetCreate",i),this.writeBuffer.push(i),this.callbackBuffer.push(n),this.flush()}},i.prototype.close=function(){function e(){i.onClose("forced close"),a("socket closing - telling transport to close"),i.transport.close()}function t(){i.removeListener("upgrade",t),i.removeListener("upgradeError",t),e()}function n(){i.once("upgrade",t),i.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var i=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},i.prototype.onError=function(e){a("socket error %j",e),i.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},i.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){a('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},i.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;i>n;n++)~l(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(e,t,n){function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized}var o=e("engine.io-parser"),r=e("component-emitter");t.exports=i,r(i.prototype),i.timestamps=0,i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(e,t,n){(function(t){function i(e){var n,i=!1,a=!1,l=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,u=location.port;u||(u=c?443:80),i=e.hostname!=location.hostname||u!=e.port,a=e.secure!=c}if(e.xdomain=i,e.xscheme=a,n=new o(e),"open"in n&&!e.forceJSONP)return new r(e);if(!l)throw new Error("JSONP disabled");return new s(e)}var o=e("xmlhttprequest"),r=e("./polling-xhr"),s=e("./polling-jsonp"),a=e("./websocket");n.polling=i,n.websocket=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(e,t,n){(function(n){function i(){}function o(e){r.call(this,e),this.query=this.query||{},a||(n.___eio||(n.___eio=[]),a=n.___eio),this.index=a.length;var t=this;a.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=i)},!1)}var r=e("./polling"),s=e("component-inherit");t.exports=o;var a,l=/\n/g,c=/\\n/g;s(o,r),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t;var i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function n(){i(),t()}function i(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+o.iframeId+'">';r=document.createElement(t)}catch(e){r=document.createElement("iframe"),r.name=o.iframeId,r.src="javascript:0"}r.id=o.iframeId,o.form.appendChild(r),o.iframe=r}var o=this;if(!this.form){var r,s=document.createElement("form"),a=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=u,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),i(),e=e.replace(c,"\\\n"),this.area.value=e.replace(l,"\\n");try{this.form.submit()}catch(d){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-inherit":21}],17:[function(e,t,n){(function(n){function i(){}function o(e){if(l.call(this,e),n.location){var t="https:"==location.protocol,i=location.port;i||(i=t?443:80),this.xd=e.hostname!=n.location.hostname||i!=e.port,this.xs=e.secure!=t}}function r(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.create()}function s(){for(var e in r.requests)r.requests.hasOwnProperty(e)&&r.requests[e].abort();

}var a=e("xmlhttprequest"),l=e("./polling"),c=e("component-emitter"),u=e("component-inherit"),d=e("debug")("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=r,u(o,l),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,new r(e)},o.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,i=this.request({method:"POST",data:e,isBinary:n}),o=this;i.on("success",t),i.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=i},o.prototype.doPoll=function(){d("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},c(r.prototype),r.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),i=this;try{if(d("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async),this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},d("xhr data %s",this.data),t.send(this.data)}catch(o){return void setTimeout(function(){i.onError(o)},0)}n.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)},r.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},r.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},r.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},r.prototype.cleanup=function(e){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=i:this.xhr.onreadystatechange=i,e)try{this.xhr.abort()}catch(t){}n.document&&delete r.requests[this.index],this.xhr=null}},r.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}e="application/octet-stream"===t?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},r.prototype.hasXDR=function(){return"undefined"!=typeof n.XDomainRequest&&!this.xs&&this.enablesXDR},r.prototype.abort=function(){this.cleanup()},n.document&&(r.requestsCount=0,r.requests={},n.attachEvent?n.attachEvent("onunload",s):n.addEventListener&&n.addEventListener("beforeunload",s,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(e,t,n){function i(e){var t=e&&e.forceBase64;(!c||t)&&(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),r=e("parseqs"),s=e("engine.io-parser"),a=e("component-inherit"),l=e("debug")("engine.io-client:polling");t.exports=i;var c=function(){var t=e("xmlhttprequest"),n=new t({xdomain:!1});return null!=n.responseType}();a(i,o),i.prototype.name="polling",i.prototype.doOpen=function(){this.poll()},i.prototype.pause=function(e){function t(){l("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(l("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){l("pre-pause polling complete"),--i||t()})),this.writable||(l("we are currently writing - waiting to pause"),i++,this.once("drain",function(){l("pre-pause writing complete"),--i||t()}))}else t()},i.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},i.prototype.onData=function(e){var t=this;l("polling got data %s",e);var n=function(e,n,i){return"opening"==t.readyState&&t.onOpen(),"close"==e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},i.prototype.doClose=function(){function e(){l("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))},i.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")},t=this;s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+o.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(e,t,n){function i(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),r=e("engine.io-parser"),s=e("parseqs"),a=e("component-inherit"),l=e("debug")("engine.io-client:websocket"),c=e("ws");t.exports=i,a(i,o),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,n={agent:this.agent};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.ws=new c(e,t,n),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(i.prototype.onData=function(e){var t=this;setTimeout(function(){o.prototype.onData.call(t,e)},0)}),i.prototype.write=function(e){function t(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var i=0,o=e.length;o>i;i++)r.encodePacket(e[i],this.supportsBinary,function(e){try{n.ws.send(e)}catch(t){l("websocket closed before onclose event")}});setTimeout(t,0)},i.prototype.onClose=function(){o.prototype.onClose.call(this)},i.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},i.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===i.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(e,t,n){var i=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(r){}try{if("undefined"!=typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(r){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}},{"has-cors":40}],21:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],22:[function(e,t,n){function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,r=0;return e[0].replace(/%[a-z%]/g,function(e){"%"!==e&&(o++,"%c"===e&&(r=o))}),e.splice(r,0,i),e}function r(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(t){}}function a(){var e;try{e=localStorage.debug}catch(t){}return e}n=t.exports=e("./debug"),n.log=r,n.formatArgs=o,n.save=s,n.load=a,n.useColors=i,n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},{"./debug":23}],23:[function(e,t,n){function i(){return n.colors[u++%n.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,r=t-(c||t);e.diff=r,e.prev=c,e.curr=t,c=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=i());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,i){if("%"===t)return t;a++;var o=n.formatters[i];if("function"==typeof o){var r=s[a];t=o.call(e,r),s.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s));var l=o.log||n.log||console.log.bind(console);l.apply(e,s)}t.enabled=!1,o.enabled=!0;var r=n.enabled(e)?o:t;return r.namespace=e,r}function r(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),i=t.length,o=0;i>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function s(){n.enable("")}function a(e){var t,i;for(t=0,i=n.skips.length;i>t;t++)if(n.skips[t].test(e))return!1;for(t=0,i=n.names.length;i>t;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=o,n.coerce=l,n.disable=s,n.enable=r,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var c,u=0},{ms:24}],24:[function(e,t,n){function i(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"y":return n*d;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"h":return n*c;case"minutes":case"minute":case"m":return n*l;case"seconds":case"second":case"s":return n*a;case"ms":return n}}}function o(e){return e>=u?Math.round(e/u)+"d":e>=c?Math.round(e/c)+"h":e>=l?Math.round(e/l)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function r(e){return s(e,u,"day")||s(e,c,"hour")||s(e,l,"minute")||s(e,a,"second")||e+" ms"}function s(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,l=60*a,c=60*l,u=24*c,d=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?i(e):t["long"]?r(e):o(e)}},{}],25:[function(e,t,n){(function(t){function i(e,t){var i="b"+n.packets[e.type]+e.data.data;return t(i)}function o(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var o=e.data,r=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=v[e.type];for(var a=0;a<r.length;a++)s[a+1]=r[a];return i(s.buffer)}function r(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var o=new FileReader;return o.onload=function(){e.data=o.result,n.encodePacket(e,t,!0,i)},o.readAsArrayBuffer(e.data)}function s(e,t,i){if(!t)return n.encodeBase64Packet(e,i);if(m)return r(e,t,i);var o=new Uint8Array(1);o[0]=v[e.type];var s=new w([o.buffer,e.data]);return i(s)}function a(e,t,n){for(var i=new Array(e.length),o=h(e.length,n),r=function(e,n,o){t(n,function(t,n){i[e]=n,o(t,i)})},s=0;s<e.length;s++)r(s,e[s],o)}var l=e("./keys"),c=e("has-binary"),u=e("arraybuffer.slice"),d=e("base64-arraybuffer"),h=e("after"),p=e("utf8"),f=navigator.userAgent.match(/Android/i),g=/PhantomJS/i.test(navigator.userAgent),m=f||g;n.protocol=3;var v=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},b=l(v),y={type:"error",data:"parser error"},w=e("blob");n.encodePacket=function(e,n,r,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof r&&(a=r,r=null);var l=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&l instanceof ArrayBuffer)return o(e,n,a);if(w&&l instanceof t.Blob)return s(e,n,a);if(l&&l.base64)return i(e,a);var c=v[e.type];return void 0!==e.data&&(c+=r?p.encode(String(e.data)):String(e.data)),a(""+c)},n.encodeBase64Packet=function(e,i){var o="b"+n.packets[e.type];if(w&&e.data instanceof w){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];i(o+e)},r.readAsDataURL(e.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(a){for(var l=new Uint8Array(e.data),c=new Array(l.length),u=0;u<l.length;u++)c[u]=l[u];s=String.fromCharCode.apply(null,c)}return o+=t.btoa(s),i(o)},n.decodePacket=function(e,t,i){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(i)try{e=p.decode(e)}catch(o){return y}var r=e.charAt(0);return Number(r)==r&&b[r]?e.length>1?{type:b[r],data:e.substring(1)}:{type:b[r]}:y}var s=new Uint8Array(e),r=s[0],a=u(e,1);return w&&"blob"===t&&(a=new w([a])),{type:b[r],data:a}},n.decodeBase64Packet=function(e,n){var i=b[e.charAt(0)];if(!t.ArrayBuffer)return{type:i,data:{base64:!0,data:e.substr(1)}};var o=d.decode(e.substr(1));return"blob"===n&&w&&(o=new w([o])),{type:i,data:o}},n.encodePayload=function(e,t,i){function o(e){return e.length+":"+e}function r(e,i){n.encodePacket(e,s?t:!1,!0,function(e){i(null,o(e))})}"function"==typeof t&&(i=t,t=null);var s=c(e);return t&&s?w&&!m?n.encodePayloadAsBlob(e,i):n.encodePayloadAsArrayBuffer(e,i):e.length?void a(e,r,function(e,t){return i(t.join(""))}):i("0:")},n.decodePayload=function(e,t,i){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,i);"function"==typeof t&&(i=t,t=null);var o;if(""==e)return i(y,0,1);for(var r,s,a="",l=0,c=e.length;c>l;l++){var u=e.charAt(l);if(":"!=u)a+=u;else{if(""==a||a!=(r=Number(a)))return i(y,0,1);if(s=e.substr(l+1,r),a!=s.length)return i(y,0,1);if(s.length){if(o=n.decodePacket(s,t,!0),y.type==o.type&&y.data==o.data)return i(y,0,1);var d=i(o,l+r,c);if(!1===d)return}l+=r,a=""}}return""!=a?i(y,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){function i(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})}return e.length?void a(e,i,function(e,n){var i=n.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),o=new Uint8Array(i),r=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);n=i.buffer}o[r++]=t?0:1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)o[r++]=parseInt(a[s]);o[r++]=255;for(var i=new Uint8Array(n),s=0;s<i.length;s++)o[r++]=i[s]}),t(o.buffer)}):t(new ArrayBuffer(0))},n.encodePayloadAsBlob=function(e,t){function i(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);e=i.buffer,n[0]=0}for(var r=e instanceof ArrayBuffer?e.byteLength:e.size,s=r.toString(),a=new Uint8Array(s.length+1),o=0;o<s.length;o++)a[o]=parseInt(s[o]);if(a[s.length]=255,w){var l=new w([n.buffer,a.buffer,e]);t(null,l)}})}a(e,i,function(e,n){return t(new w(n))})},n.decodePayloadAsBinary=function(e,t,i){"function"==typeof t&&(i=t,t=null);for(var o=e,r=[],s=!1;o.byteLength>0;){for(var a=new Uint8Array(o),l=0===a[0],c="",d=1;255!=a[d];d++){if(c.length>310){s=!0;break}c+=a[d]}if(s)return i(y,0,1);o=u(o,2+c.length),c=parseInt(c);var h=u(o,0,c);if(l)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(p){var f=new Uint8Array(h);h="";for(var d=0;d<f.length;d++)h+=String.fromCharCode(f[d])}r.push(h),o=u(o,c)}var g=r.length;r.forEach(function(e,o){i(n.decodePacket(e,t,!0),o,g)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t}},{}],27:[function(e,t,n){function i(e,t,n){function i(e,o){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(r=!0,t(e),t=n):0!==i.count||r||t(null,o)}var r=!1;return n=n||o,i.count=e,0===e?t():i}function o(){}t.exports=i},{}],28:[function(e,t,n){t.exports=function(e,t,n){var i=e.byteLength;if(t=t||0,n=n||i,e.slice)return e.slice(t,n);if(0>t&&(t+=i),0>n&&(n+=i),n>i&&(n=i),t>=i||t>=n||0===i)return new ArrayBuffer(0);for(var o=new Uint8Array(e),r=new Uint8Array(n-t),s=t,a=0;n>s;s++,a++)r[a]=o[s];return r.buffer}},{}],29:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,i=new Uint8Array(t),o=i.length,r="";for(n=0;o>n;n+=3)r+=e[i[n]>>2],r+=e[(3&i[n])<<4|i[n+1]>>4],r+=e[(15&i[n+1])<<2|i[n+2]>>6],r+=e[63&i[n+2]];return o%3===2?r=r.substring(0,r.length-1)+"=":o%3===1&&(r=r.substring(0,r.length-2)+"=="),r},n.decode=function(t){var n,i,o,r,s,a=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),d=new Uint8Array(u);for(n=0;l>n;n+=4)i=e.indexOf(t[n]),o=e.indexOf(t[n+1]),r=e.indexOf(t[n+2]),s=e.indexOf(t[n+3]),d[c++]=i<<2|o>>4,d[c++]=(15&o)<<4|r>>2,d[c++]=(3&r)<<6|63&s;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(e,t,n){(function(e){function n(e,t){t=t||{};for(var n=new i,o=0;o<e.length;o++)n.append(e[o]);return t.type?n.getBlob(t.type):n.getBlob()}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,o=function(){try{var e=new Blob(["hi"]);return 2==e.size}catch(t){return!1}}(),r=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return o?e.Blob:r?n:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(e,t,n){(function(n){function i(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(o(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return!0}return!1}return t(e)}var o=e("isarray");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:32}],32:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],33:[function(t,n,i){(function(t){!function(o){function r(e){for(var t,n,i=[],o=0,r=e.length;r>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&r>o?(n=e.charCodeAt(o++),56320==(64512&n)?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),o--)):i.push(t);return i}function s(e){for(var t,n=e.length,i=-1,o="";++i<n;)t=e[i],t>65535&&(t-=65536,o+=y(t>>>10&1023|55296),t=56320|1023&t),o+=y(t);return o}function a(e,t){return y(e>>t&63|128)}function l(e){if(0==(4294967168&e))return y(e);var t="";return 0==(4294965248&e)?t=y(e>>6&31|192):0==(4294901760&e)?(t=y(e>>12&15|224),t+=a(e,6)):0==(4292870144&e)&&(t=y(e>>18&7|240),t+=a(e,12),t+=a(e,6)),t+=y(63&e|128)}function c(e){for(var t,n=r(e),i=n.length,o=-1,s="";++o<i;)t=n[o],s+=l(t);return s}function u(){if(b>=v)throw Error("Invalid byte index");var e=255&m[b];if(b++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(){var e,t,n,i,o;if(b>v)throw Error("Invalid byte index");if(b==v)return!1;if(e=255&m[b],b++,0==(128&e))return e;if(192==(224&e)){var t=u();if(o=(31&e)<<6|t,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=u(),n=u(),o=(15&e)<<12|t<<6|n,o>=2048)return o;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=u(),n=u(),i=u(),o=(15&e)<<18|t<<12|n<<6|i,o>=65536&&1114111>=o))return o;throw Error("Invalid UTF-8 detected")}function h(e){m=r(e),v=m.length,b=0;for(var t,n=[];(t=d())!==!1;)n.push(t);return s(n)}var p="object"==typeof i&&i,f="object"==typeof n&&n&&n.exports==p&&n,g="object"==typeof t&&t;(g.global===g||g.window===g)&&(o=g);var m,v,b,y=String.fromCharCode,w={version:"2.0.0",encode:c,decode:h};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return w});else if(p&&!p.nodeType)if(f)f.exports=w;else{var C={},_=C.hasOwnProperty;for(var x in w)_.call(w,x)&&(p[x]=w[x])}else o.utf8=w}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,i=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(i,"@").replace(o,"]").replace(r,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),i=0,o=n.length;o>i;i++){var r=n[i].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}},{}],36:[function(e,t,n){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var s=i.exec(e||""),a={},l=14;l--;)a[o[l]]=s[l]||"";return-1!=n&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},{}],37:[function(e,t,n){function i(e,t,n){var i;return i=t?new r(e,t):new r(e)}var o=function(){return this}(),r=o.WebSocket||o.MozWebSocket;t.exports=r?i:null,r&&(i.prototype=r.prototype)},{}],38:[function(e,t,n){(function(n){function i(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(o(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return!0}return!1}return t(e)}var o=e("isarray");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:39}],39:[function(e,t,n){t.exports=e(32)},{}],40:[function(e,t,n){var i=e("global");try{t.exports="XMLHttpRequest"in i&&"withCredentials"in new i.XMLHttpRequest}catch(o){t.exports=!1}},{global:41}],41:[function(e,t,n){t.exports=function(){return this}()},{}],42:[function(e,t,n){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],43:[function(e,t,n){var i=Object.prototype.hasOwnProperty;n.keys=Object.keys||function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},n.values=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(e[n]);return t},n.merge=function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);return e},n.length=function(e){return n.keys(e).length},n.isEmpty=function(e){return 0==n.length(e)}},{}],44:[function(e,t,n){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){for(var t=i.exec(e||""),n={},r=14;r--;)n[o[r]]=t[r]||"";return n}},{}],45:[function(e,t,n){(function(t){var i=e("isarray"),o=e("./is-buffer");n.deconstructPacket=function(e){function t(e){if(!e)return e;if(o(e)){var r={_placeholder:!0,num:n.length};return n.push(e),r}if(i(e)){for(var s=new Array(e.length),a=0;a<e.length;a++)s[a]=t(e[a]);return s}if("object"==typeof e&&!(e instanceof Date)){var s={};for(var l in e)s[l]=t(e[l]);return s}return e}var n=[],r=e.data,s=e;return s.data=t(r),s.attachments=n.length,{packet:s,buffers:n}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder){var o=t[e.num];return o}if(i(e)){for(var r=0;r<e.length;r++)e[r]=n(e[r]);return e}if(e&&"object"==typeof e){for(var s in e)e[s]=n(e[s]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function r(e,l,c){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var u=new FileReader;u.onload=function(){c?c[l]=this.result:a=this.result,--s||n(a)},u.readAsArrayBuffer(e)}else if(i(e))for(var d=0;d<e.length;d++)r(e[d],d,e);else if(e&&"object"==typeof e&&!o(e))for(var h in e)r(e[h],h,e)}var s=0,a=e;r(a),s||n(a)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":47,isarray:48}],46:[function(e,t,n){function i(){}function o(e){var t="",i=!1;return t+=e.type,(n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)&&(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(i=!0,t+=e.nsp),null!=e.id&&(i&&(t+=",",i=!1),t+=e.id),null!=e.data&&(i&&(t+=","),t+=d.stringify(e.data)),u("encoded %j as %s",e,t),t}function r(e,t){function n(e){var n=p.deconstructPacket(e),i=o(n.packet),r=n.buffers;r.unshift(i),t(r)}p.removeBlobs(e,n)}function s(){this.reconstructor=null}function a(e){var t={},i=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return c();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(var o="";"-"!=e.charAt(++i)&&(o+=e.charAt(i),i!=e.length););if(o!=Number(o)||"-"!=e.charAt(i))throw new Error("Illegal attachments");t.attachments=Number(o)}if("/"==e.charAt(i+1))for(t.nsp="";++i;){var r=e.charAt(i);if(","==r)break;if(t.nsp+=r,i==e.length)break}else t.nsp="/";var s=e.charAt(i+1);if(""!==s&&Number(s)==s){for(t.id="";++i;){var r=e.charAt(i);if(null==r||Number(r)!=r){--i;break}if(t.id+=e.charAt(i),i==e.length)break}t.id=Number(t.id)}if(e.charAt(++i))try{t.data=d.parse(e.substr(i))}catch(a){return c()}return u("decoded %s as %j",e,t),t}function l(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:n.ERROR,data:"parser error"}}var u=e("debug")("socket.io-parser"),d=e("json3"),h=(e("isarray"),e("component-emitter")),p=e("./binary"),f=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=i,n.Decoder=s,i.prototype.encode=function(e,t){if(u("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)r(e,t);else{var i=o(e);t([i])}},h(s.prototype),s.prototype.add=function(e){var t;if("string"==typeof e)t=a(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new l(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!f(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,this.emit("decoded",t))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},l.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=p.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},l.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(e,t,n){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,n){t.exports=e(32)},{}],49:[function(t,n,i){!function(t){function n(e){if(n[e]!==s)return n[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=n("json-stringify")&&n("json-parse");else{var i,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var r=u.stringify,l="function"==typeof r&&d;if(l){(i=function(){return 1}).toJSON=i;try{l="0"===r(0)&&"0"===r(new Number)&&'""'==r(new String)&&r(a)===s&&r(s)===s&&r()===s&&"1"===r(i)&&"[1]"==r([i])&&"[null]"==r([s])&&"null"==r(null)&&"[null,null,null]"==r([s,a,null])&&r({a:[i,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===r(null,i)&&"[\n 1,\n 2\n]"==r([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==r(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==r(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==r(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==r(new Date(-1))}catch(c){l=!1}}t=l}if("json-parse"==e){var h=u.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){i=h(o);var p=5==i.a.length&&1===i.a[0];if(p){try{p=!h('"	"')}catch(c){}if(p)try{p=1!==h("01")}catch(c){}if(p)try{p=1!==h("1.")}catch(c){}}}}catch(c){p=!1}t=p}}return n[e]=!!t}var o,r,s,a={}.toString,l="function"==typeof e&&e.amd,c="object"==typeof JSON&&JSON,u="object"==typeof i&&i&&!i.nodeType&&i;u&&c?(u.stringify=c.stringify,u.parse=c.parse):u=t.JSON=c||{};var d=new Date(-0xc782b5b800cec);try{d=-109252==d.getUTCFullYear()&&0===d.getUTCMonth()&&1===d.getUTCDate()&&10==d.getUTCHours()&&37==d.getUTCMinutes()&&6==d.getUTCSeconds()&&708==d.getUTCMilliseconds()}catch(h){}if(!n("json")){var p="[object Function]",f="[object Date]",g="[object Number]",m="[object String]",v="[object Array]",b="[object Boolean]",y=n("bug-string-char-index");if(!d)var w=Math.floor,C=[0,31,59,90,120,151,181,212,243,273,304,334],_=function(e,t){return C[t]+365*(e-1970)+w((e-1969+(t=+(t>1)))/4)-w((e-1901+t)/100)+w((e-1601+t)/400)};(o={}.hasOwnProperty)||(o=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=a?o=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,o=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,o.call(this,e)});var x={"boolean":1,number:1,string:1,undefined:1},S=function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!x[n]};if(r=function(e,t){var n,i,s,l=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(s in i)o.call(i,s)&&l++;return n=i=null,l?r=2==l?function(e,t){var n,i={},r=a.call(e)==p;for(n in e)r&&"prototype"==n||o.call(i,n)||!(i[n]=1)||!o.call(e,n)||t(n)}:function(e,t){var n,i,r=a.call(e)==p;for(n in e)r&&"prototype"==n||!o.call(e,n)||(i="constructor"===n)||t(n);(i||o.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],r=function(e,t){var n,r,s=a.call(e)==p,l=!s&&"function"!=typeof e.constructor&&S(e,"hasOwnProperty")?e.hasOwnProperty:o;for(n in e)s&&"prototype"==n||!l.call(e,n)||t(n);for(r=i.length;n=i[--r];l.call(e,n)&&t(n));}),r(e,t)},!n("json-stringify")){var k={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"
},T="000000",$=function(e,t){return(T+(t||0)).slice(-e)},E="\\u00",D=function(e){var t,n='"',i=0,o=e.length,r=o>10&&y;for(r&&(t=e.split(""));o>i;i++){var s=e.charCodeAt(i);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=k[s];break;default:if(32>s){n+=E+$(2,s.toString(16));break}n+=r?t[i]:y?e.charAt(i):e[i]}}return n+'"'},I=function(e,t,n,i,l,c,u){var d,h,p,y,C,x,S,k,T,E,M,A,O,R,P,N;try{d=t[e]}catch(L){}if("object"==typeof d&&d)if(h=a.call(d),h!=f||o.call(d,"toJSON"))"function"==typeof d.toJSON&&(h!=g&&h!=m&&h!=v||o.call(d,"toJSON"))&&(d=d.toJSON(e));else if(d>-1/0&&1/0>d){if(_){for(C=w(d/864e5),p=w(C/365.2425)+1970-1;_(p+1,0)<=C;p++);for(y=w((C-_(p,0))/30.42);_(p,y+1)<=C;y++);C=1+C-_(p,y),x=(d%864e5+864e5)%864e5,S=w(x/36e5)%24,k=w(x/6e4)%60,T=w(x/1e3)%60,E=x%1e3}else p=d.getUTCFullYear(),y=d.getUTCMonth(),C=d.getUTCDate(),S=d.getUTCHours(),k=d.getUTCMinutes(),T=d.getUTCSeconds(),E=d.getUTCMilliseconds();d=(0>=p||p>=1e4?(0>p?"-":"+")+$(6,0>p?-p:p):$(4,p))+"-"+$(2,y+1)+"-"+$(2,C)+"T"+$(2,S)+":"+$(2,k)+":"+$(2,T)+"."+$(3,E)+"Z"}else d=null;if(n&&(d=n.call(t,e,d)),null===d)return"null";if(h=a.call(d),h==b)return""+d;if(h==g)return d>-1/0&&1/0>d?""+d:"null";if(h==m)return D(""+d);if("object"==typeof d){for(R=u.length;R--;)if(u[R]===d)throw TypeError();if(u.push(d),M=[],P=c,c+=l,h==v){for(O=0,R=d.length;R>O;O++)A=I(O,d,n,i,l,c,u),M.push(A===s?"null":A);N=M.length?l?"[\n"+c+M.join(",\n"+c)+"\n"+P+"]":"["+M.join(",")+"]":"[]"}else r(i||d,function(e){var t=I(e,d,n,i,l,c,u);t!==s&&M.push(D(e)+":"+(l?" ":"")+t)}),N=M.length?l?"{\n"+c+M.join(",\n"+c)+"\n"+P+"}":"{"+M.join(",")+"}":"{}";return u.pop(),N}};u.stringify=function(e,t,n){var i,o,r,s;if("function"==typeof t||"object"==typeof t&&t)if((s=a.call(t))==p)o=t;else if(s==v){r={};for(var l,c=0,u=t.length;u>c;l=t[c++],s=a.call(l),(s==m||s==g)&&(r[l]=1));}if(n)if((s=a.call(n))==g){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else s==m&&(i=n.length<=10?n:n.slice(0,10));return I("",(l={},l[""]=e,l),o,r,i,"",[])}}if(!n("json-parse")){var M,A,O=String.fromCharCode,R={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw M=A=null,SyntaxError()},N=function(){for(var e,t,n,i,o,r=A,s=r.length;s>M;)switch(o=r.charCodeAt(M)){case 9:case 10:case 13:case 32:M++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=y?r.charAt(M):r[M],M++,e;case 34:for(e="@",M++;s>M;)if(o=r.charCodeAt(M),32>o)P();else if(92==o)switch(o=r.charCodeAt(++M)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=R[o],M++;break;case 117:for(t=++M,n=M+4;n>M;M++)o=r.charCodeAt(M),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||P();e+=O("0x"+r.slice(t,M));break;default:P()}else{if(34==o)break;for(o=r.charCodeAt(M),t=M;o>=32&&92!=o&&34!=o;)o=r.charCodeAt(++M);e+=r.slice(t,M)}if(34==r.charCodeAt(M))return M++,e;P();default:if(t=M,45==o&&(i=!0,o=r.charCodeAt(++M)),o>=48&&57>=o){for(48==o&&(o=r.charCodeAt(M+1),o>=48&&57>=o)&&P(),i=!1;s>M&&(o=r.charCodeAt(M),o>=48&&57>=o);M++);if(46==r.charCodeAt(M)){for(n=++M;s>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==M&&P(),M=n}if(o=r.charCodeAt(M),101==o||69==o){for(o=r.charCodeAt(++M),(43==o||45==o)&&M++,n=M;s>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==M&&P(),M=n}return+r.slice(t,M)}if(i&&P(),"true"==r.slice(M,M+4))return M+=4,!0;if("false"==r.slice(M,M+5))return M+=5,!1;if("null"==r.slice(M,M+4))return M+=4,null;P()}return"$"},L=function(e){var t,n;if("$"==e&&P(),"string"==typeof e){if("@"==(y?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=N(),"]"!=e;n||(n=!0))n&&(","==e?(e=N(),"]"==e&&P()):P()),","==e&&P(),t.push(L(e));return t}if("{"==e){for(t={};e=N(),"}"!=e;n||(n=!0))n&&(","==e?(e=N(),"}"==e&&P()):P()),(","==e||"string"!=typeof e||"@"!=(y?e.charAt(0):e[0])||":"!=N())&&P(),t[e.slice(1)]=L(N());return t}P()}return e},F=function(e,t,n){var i=U(e,t,n);i===s?delete e[t]:e[t]=i},U=function(e,t,n){var i,o=e[t];if("object"==typeof o&&o)if(a.call(o)==v)for(i=o.length;i--;)F(o,i,n);else r(o,function(e){F(o,e,n)});return n.call(e,t,o)};u.parse=function(e,t){var n,i;return M=0,A=""+e,n=L(N()),"$"!=N()&&P(),M=A=null,t&&a.call(t)==p?U((i={},i[""]=n,i),"",t):n}}}l&&e(function(){return u})}(this)},{}],50:[function(e,t,n){function i(e,t){var n=[];t=t||0;for(var i=t||0;i<e.length;i++)n[i-t]=e[i];return n}t.exports=i},{}]},{},[1])(1)}),void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(e,t,n){function i(n){var i=t.console;r[n]||(r[n]=!0,e.migrateWarnings.push(n),i&&i.warn&&!e.migrateMute&&(i.warn("JQMIGRATE: "+n),e.migrateTrace&&i.trace&&i.trace()))}function o(t,o,r,s){if(Object.defineProperty)try{return Object.defineProperty(t,o,{configurable:!0,enumerable:!0,get:function(){return i(s),r},set:function(e){i(s),r=e}}),n}catch(a){}e._definePropertyBroken=!0,t[o]=r}var r={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){r={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&i("jQuery is not compatible with Quirks Mode");var s=e("<input/>",{size:1}).attr("size")&&e.attrFn,a=e.attr,l=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},c=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},u=/^(?:input|button)$/i,d=/^[238]$/,h=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,p=/^(?:checked|selected)$/i;o(e,"attrFn",s||{},"jQuery.attrFn is deprecated"),e.attr=function(t,o,r,l){var c=o.toLowerCase(),f=t&&t.nodeType;return l&&(4>a.length&&i("jQuery.fn.attr( props, pass ) is deprecated"),t&&!d.test(f)&&(s?o in s:e.isFunction(e.fn[o])))?e(t)[o](r):("type"===o&&r!==n&&u.test(t.nodeName)&&t.parentNode&&i("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[c]&&h.test(c)&&(e.attrHooks[c]={get:function(t,i){var o,r=e.prop(t,i);return r===!0||"boolean"!=typeof r&&(o=t.getAttributeNode(i))&&o.nodeValue!==!1?i.toLowerCase():n},set:function(t,n,i){var o;return n===!1?e.removeAttr(t,i):(o=e.propFix[i]||i,o in t&&(t[o]=!0),t.setAttribute(i,i.toLowerCase())),i}},p.test(c)&&i("jQuery.fn.attr('"+c+"') may use property instead of attribute")),a.call(e,t,o,r))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?l.apply(this,arguments):("input"!==n&&"option"!==n&&i("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var o=(e.nodeName||"").toLowerCase();return"button"===o?c.apply(this,arguments):("input"!==o&&"option"!==o&&i("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t,n)}};var f,g,m=e.fn.init,v=e.parseJSON,b=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,n,o){var r;return t&&"string"==typeof t&&!e.isPlainObject(n)&&(r=b.exec(e.trim(t)))&&r[0]&&("<"!==t.charAt(0)&&i("$(html) HTML strings must start with '<' character"),r[3]&&i("$(html) HTML text after last tag is ignored"),"#"===r[0].charAt(0)&&(i("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),e.parseHTML)?m.call(this,e.parseHTML(r[2],n,!0),n,o):m.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?v.apply(this,arguments):(i("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(f=e.uaMatch(navigator.userAgent),g={},f.browser&&(g[f.browser]=!0,g.version=f.version),g.chrome?g.webkit=!0:g.webkit&&(g.safari=!0),e.browser=g),o(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(i,o){return o&&o instanceof e&&!(o instanceof t)&&(o=t(o)),e.fn.init.call(this,i,o,n)},t.fn.init.prototype=t.fn;var n=t(document);return i("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var y=e.fn.data;e.fn.data=function(t){var o,r,s=this[0];return!s||"events"!==t||1!==arguments.length||(o=e.data(s,t),r=e._data(s,t),o!==n&&o!==r||r===n)?y.apply(this,arguments):(i("Use of jQuery.fn.data('events') is deprecated"),r)};var w=/\/(java|ecma)script/i,C=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),C.apply(this,arguments)},e.clean||(e.clean=function(t,o,r,s){o=o||document,o=!o.nodeType&&o[0]||o,o=o.ownerDocument||o,i("jQuery.clean() is deprecated");var a,l,c,u,d=[];if(e.merge(d,e.buildFragment(t,o).childNodes),r)for(c=function(e){return!e.type||w.test(e.type)?s?s.push(e.parentNode?e.parentNode.removeChild(e):e):r.appendChild(e):n},a=0;null!=(l=d[a]);a++)e.nodeName(l,"script")&&c(l)||(r.appendChild(l),l.getElementsByTagName!==n&&(u=e.grep(e.merge([],l.getElementsByTagName("script")),c),d.splice.apply(d,[a+1,0].concat(u)),a+=u.length));return d});var _=e.event.add,x=e.event.remove,S=e.event.trigger,k=e.fn.toggle,T=e.fn.live,$=e.fn.die,E="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",D=RegExp("\\b(?:"+E+")\\b"),I=/(?:^|\s)hover(\.\S+|)\b/,M=function(t){return"string"!=typeof t||e.event.special.hover?t:(I.test(t)&&i("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(I,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&o(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,o,r){e!==document&&D.test(t)&&i("AJAX events should be attached to document: "+t),_.call(this,e,M(t||""),n,o,r)},e.event.remove=function(e,t,n,i,o){x.call(this,e,M(t)||"",n,i,o)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return i("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return k.apply(this,arguments);i("jQuery.fn.toggle(handler, handler...) is deprecated");var o=arguments,r=t.guid||e.guid++,s=0,a=function(n){var i=(e._data(this,"lastToggle"+t.guid)||0)%s;return e._data(this,"lastToggle"+t.guid,i+1),n.preventDefault(),o[i].apply(this,arguments)||!1};for(a.guid=r;o.length>s;)o[s++].guid=r;return this.click(a)},e.fn.live=function(t,n,o){return i("jQuery.fn.live() is deprecated"),T?T.apply(this,arguments):(e(this.context).on(t,this.selector,n,o),this)},e.fn.die=function(t,n){return i("jQuery.fn.die() is deprecated"),$?$.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,o){return n||D.test(e)||i("Global events are undocumented and deprecated"),S.call(this,e,t,n||document,o)},e.each(E.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window),angular.module("ui.date",[]).constant("uiDateConfig",{}).directive("uiDate",["uiDateConfig",function(e){"use strict";var t;return t={},angular.extend(t,e),{require:"?ngModel",link:function(t,n,i,o){var r=function(){return angular.extend({},e,t.$eval(i.uiDate))},s=function(){var e=!1,i=r();if(o){var s=i.onSelect||angular.noop;i.onSelect=function(i,r){t.$apply(function(){e=!0,o.$setViewValue(n.datepicker("getDate")),s(i,r),n.blur()})},i.beforeShow=function(){e=!0},i.onClose=function(t,n){e=!1},n.off("blur.datepicker").on("blur.datepicker",function(){e||t.$apply(function(){n.datepicker("setDate",n.datepicker("getDate")),o.$setViewValue(n.datepicker("getDate"))})}),o.$render=function(){var e=o.$viewValue;if(angular.isDefined(e)&&null!==e&&!angular.isDate(e))throw new Error("ng-Model value must be a Date object - currently it is a "+typeof e+" - use ui-date-format to convert it from a string");n.datepicker("setDate",e)}}n.datepicker("destroy"),n.datepicker(i),o&&o.$render()};t.$watch(r,s,!0)}}}]).constant("uiDateFormatConfig","").directive("uiDateFormat",["uiDateFormatConfig",function(e){var t={require:"ngModel",link:function(t,n,i,o){var r=i.uiDateFormat||e;r?(o.$formatters.push(function(e){return angular.isString(e)?jQuery.datepicker.parseDate(r,e):null}),o.$parsers.push(function(e){return e?jQuery.datepicker.formatDate(r,e):null})):(o.$formatters.push(function(e){return angular.isString(e)?new Date(e):null}),o.$parsers.push(function(e){return e?e.toISOString():null}))}};return t}]),function(){function e(e){for(var t,n,i=e.css("color"),e=e[0],o=!1;e&&!n&&!o;){try{t=$(e).css("background-color")}catch(r){t="transparent"}"transparent"!==t&&"rgba(0, 0, 0, 0)"!==t&&(n=t),o=e.body,e=e.parentNode}var s,e=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,o=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/;t=void 0,(t=i.match(e))?s={r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}:(t=i.match(o))&&(s={r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)});var a;return n?(t=void 0,(t=n.match(e))?a={r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}:(t=n.match(o))&&(a={r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)})):a=s&&127<Math.max.apply(null,[s.r,s.g,s.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255},t=function(e){return"rgb("+[e.r,e.g,e.b].join(", ")+")"},s&&a?(e=Math.max.apply(null,[s.r,s.g,s.b]),s=Math.max.apply(null,[a.r,a.g,a.b]),s=Math.round(s+-.75*(s-e)),s={r:s,g:s,b:s}):s?(s=Math.max.apply(null,[s.r,s.g,s.b]),e=1,s>127&&(e=-1),s=Math.round(s+96*e),s={r:s,g:s,b:s}):s={r:191,g:191,b:191},{color:i,"background-color":a?t(a):n,"decor-color":t(s)}}function t(e,t){this.x=e,this.y=t,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(e){return Math.round(e/Math.abs(e))};this.resizeTo=function(e){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=e,this.y=e*n(this.y);else if(0===this.y)this._length=e,this.x=e*n(this.x);else{var t=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(e,2)/(1+Math.pow(t,2))),t=t*i;this._length=e,this.x=i*n(this.x),this.y=t*n(this.y)}return this},this.angleTo=function(e){var t=this.getLength()*e.getLength();return 0===t?0:Math.acos(Math.min(Math.max((this.x*e.x+this.y*e.y)/t,-1),1))/Math.PI}}function n(e,n){this.x=e,this.y=n,this.getVectorToCoordinates=function(e,n){return new t(e-this.x,n-this.y)},this.getVectorFromCoordinates=function(e,t){return this.getVectorToCoordinates(e,t).reverse()},this.getVectorToPoint=function(e){return new t(e.x-this.x,e.y-this.y)},this.getVectorFromPoint=function(e){return this.getVectorToPoint(e).reverse()}}function i(e,t,n,i,o){if(this.data=e,this.context=t,e.length)for(var r,s,a=e.length,l=0;a>l;l++){r=e[l],s=r.x.length,n.call(t,r);for(var c=1;s>c;c++)i.call(t,r,c);o.call(t,r)}this.changed=function(){},this.startStrokeFn=n,this.addToStrokeFn=i,this.endStrokeFn=o,this.inStroke=!1,this._stroke=this._lastPoint=null,this.startStroke=function(e){if(e&&"number"==typeof e.x&&"number"==typeof e.y){this._stroke={x:[e.x],y:[e.y]},this.data.push(this._stroke),this._lastPoint=e,this.inStroke=!0;var t=this._stroke,n=this.startStrokeFn,i=this.context;return setTimeout(function(){n.call(i,t)},3),e}return null},this.addToStroke=function(e){if(this.inStroke&&"number"==typeof e.x&&"number"==typeof e.y&&4<Math.abs(e.x-this._lastPoint.x)+Math.abs(e.y-this._lastPoint.y)){var t=this._stroke.x.length;this._stroke.x.push(e.x),this._stroke.y.push(e.y),this._lastPoint=e;var n=this._stroke,i=this.addToStrokeFn,o=this.context;return setTimeout(function(){i.call(o,n,t)},3),e}return null},this.endStroke=function(){var e=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,e){var t=this._stroke,n=this.endStrokeFn,i=this.context,o=this.changed;return setTimeout(function(){n.call(i,t),o.call(i)},3),!0}return null}}function o(t,i,o){var l=this.$parent=$(t),t=this.eventTokens={};this.events=new a(this);var c=$.fn[r]("globalEvents"),u={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};$.extend(u,e(l)),i&&$.extend(u,i),this.settings=u;for(var d in o)o.hasOwnProperty(d)&&o[d].call(this,d);this.events.publish(r+".initializing"),this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(l),this.isCanvasEmulator=!1,o=this.canvas=this.initializeCanvas(u),i=$(o),this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(l),this.canvasContext=o.getContext("2d"),i.data(r+".this",this),l=(l=u.lineWidth)?l:Math.max(Math.round(o.width/400),2),u.lineWidth=l,this.lineCurveThreshold=3*u.lineWidth,u.cssclass&&""!=$.trim(u.cssclass)&&i.addClass(u.cssclass),this.fatFingerCompensation=0;var l=function(e){var t,i,o=function(o){return o=o.changedTouches&&0<o.changedTouches.length?o.changedTouches[0]:o,new n(Math.round(o.pageX+t),Math.round(o.pageY+i)+e.fatFingerCompensation)},r=new s(750,function(){e.dataEngine.endStroke()});return this.drawEndHandler=function(t){try{t.preventDefault()}catch(n){}r.clear(),e.dataEngine.endStroke()},this.drawStartHandler=function(n){n.preventDefault();var s=$(e.canvas).offset();t=-1*s.left,i=-1*s.top,e.dataEngine.startStroke(o(n)),r.kick()},this.drawMoveHandler=function(t){t.preventDefault(),e.dataEngine.inStroke&&(e.dataEngine.addToStroke(o(t)),r.kick())},this}.call({},this),h=l.drawEndHandler,p=l.drawStartHandler,f=l.drawMoveHandler,g=this.canvas,i=$(g);this.isCanvasEmulator?(i.bind("mousemove."+r,f),i.bind("mouseup."+r,h),i.bind("mousedown."+r,p)):(g.ontouchstart=function(e){g.onmousedown=void 0,g.onmouseup=void 0,g.onmousemove=void 0,this.fatFingerCompensation=u.minFatFingerCompensation&&-3*u.lineWidth>u.minFatFingerCompensation?-3*u.lineWidth:u.minFatFingerCompensation,p(e),g.ontouchend=h,g.ontouchstart=p,g.ontouchmove=f},g.onmousedown=function(e){g.ontouchstart=void 0,g.ontouchend=void 0,g.ontouchmove=void 0,p(e),g.onmousedown=p,g.onmouseup=h,g.onmousemove=f}),t[r+".windowmouseup"]=c.subscribe(r+".windowmouseup",l.drawEndHandler),this.events.publish(r+".attachingEventHandlers");var m=this,t=u.width.toString(10),v=r;return("ratio"===t||"%"===t.split("")[t.length-1])&&(this.eventTokens[v+".parentresized"]=c.subscribe(v+".parentresized",function(e,t,n){return function(){var i=t.width();if(i!==n){for(var o in e)e.hasOwnProperty(o)&&(c.unsubscribe(e[o]),delete e[o]);var r=m.settings;m.$parent.children().remove();for(o in m)m.hasOwnProperty(o)&&delete m[o];o=r.data;var s,a,l,u,d,h,i=1*i/n,p=[];for(a=0,l=o.length;l>a;a++){for(h=o[a],s={x:[],y:[]},u=0,d=h.x.length;d>u;u++)s.x.push(h.x[u]*i),s.y.push(h.y[u]*i);p.push(s)}r.data=p,t[v](r)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height))),this.resetCanvas(u.data),this.events.publish(r+".initialized"),this}var r="jSignature",s=function(e,t){var n;return this.kick=function(){clearTimeout(n),n=setTimeout(t,e)},this.clear=function(){clearTimeout(n)},this},a=function(e){this.topics={},this.context=e?e:this,this.publish=function(e,t,n,i){if(this.topics[e]){var o,r,s,a,l=this.topics[e],c=Array.prototype.slice.call(arguments,1),u=[];for(r=0,s=l.length;s>r;r++)a=l[r],o=a[0],a[1]&&(a[0]=function(){},u.push(r)),o.apply(this.context,c);for(r=0,s=u.length;s>r;r++)l.splice(u[r],1)}},this.subscribe=function(e,t,n){return this.topics[e]?this.topics[e].push([t,n]):this.topics[e]=[[t,n]],{topic:e,callback:t}},this.unsubscribe=function(e){if(this.topics[e.topic])for(var t=this.topics[e.topic],n=0,i=t.length;i>n;n++)t[n][0]===e.callback&&t.splice(n,1)}},l=function(e){var t=this.canvasContext,n=e.x[0],e=e.y[0],i=this.settings.lineWidth,o=t.fillStyle;t.fillStyle=t.strokeStyle,t.fillRect(n+i/-2,e+i/-2,i,i),t.fillStyle=o},c=function(e,i){var o=new n(e.x[i-1],e.y[i-1]),r=new n(e.x[i],e.y[i]),s=o.getVectorToPoint(r);if(i>1){var a,l=new n(e.x[i-2],e.y[i-2]),c=l.getVectorToPoint(o);if(c.getLength()>this.lineCurveThreshold){a=i>2?new n(e.x[i-3],e.y[i-3]).getVectorToPoint(l):new t(0,0);var u=.35*c.getLength(),d=c.angleTo(a.reverse()),h=s.angleTo(c.reverse());a=new t(a.x+c.x,a.y+c.y).resizeTo(Math.max(.05,d)*u);var p=new t(c.x+s.x,c.y+s.y).reverse().resizeTo(Math.max(.05,h)*u),c=this.canvasContext,u=l.x,h=l.y,d=o.x,f=o.y,g=l.x+a.x,l=l.y+a.y;a=o.x+p.x,p=o.y+p.y,c.beginPath(),c.moveTo(u,h),c.bezierCurveTo(g,l,a,p,d,f),c.stroke()}}s.getLength()<=this.lineCurveThreshold&&(s=this.canvasContext,l=o.x,o=o.y,a=r.x,r=r.y,s.beginPath(),s.moveTo(l,o),s.lineTo(a,r),s.stroke())},u=function(e){var i=e.x.length-1;if(i>0){var o=new n(e.x[i],e.y[i]),r=new n(e.x[i-1],e.y[i-1]),s=r.getVectorToPoint(o);if(s.getLength()>this.lineCurveThreshold){if(i>1){var e=new n(e.x[i-2],e.y[i-2]).getVectorToPoint(r),a=new t(e.x+s.x,e.y+s.y).resizeTo(s.getLength()/2),s=this.canvasContext,e=r.x,i=r.y,l=o.x,c=o.y,u=r.x+a.x,r=r.y+a.y,a=o.x,o=o.y;s.beginPath(),s.moveTo(e,i),s.bezierCurveTo(u,r,a,o,l,c)}else s=this.canvasContext,e=r.x,r=r.y,i=o.x,o=o.y,s.beginPath(),s.moveTo(e,r),s.lineTo(i,o);s.stroke()}}};o.prototype.resetCanvas=function(e){var t=this.canvas,n=this.settings,o=this.canvasContext,s=this.isCanvasEmulator,a=t.width,d=t.height;o.clearRect(0,0,a+30,d+30),o.shadowColor=o.fillStyle=n["background-color"],s&&o.fillRect(0,0,a+30,d+30),o.lineWidth=Math.ceil(parseInt(n.lineWidth,10)),o.lineCap=o.lineJoin="round",o.strokeStyle=n["decor-color"],o.shadowOffsetX=0,o.shadowOffsetY=0;var h=Math.round(d/5),p=1.5*h,f=d-h,a=a-1.5*h,d=d-h;o.beginPath(),o.moveTo(p,f),o.lineTo(a,d),o.stroke(),o.strokeStyle=n.color,s||(o.shadowColor=o.strokeStyle,o.shadowOffsetX=.5*o.lineWidth,o.shadowOffsetY=-.6*o.lineWidth,o.shadowBlur=0),e||(e=[]),o=this.dataEngine=new i(e,this,l,c,u),n.data=e,$(t).data(r+".data",e).data(r+".settings",n);var g=this.$parent,m=this.events,v=r;return o.changed=function(){m.publish(v+".change"),g.trigger("change")},o.changed(),!0},o.prototype.initializeCanvas=function(e){var t=document.createElement("canvas"),n=$(t);if(e.width===e.height&&"ratio"===e.height&&(e.width="100%"),n.css("margin",0).css("padding",0).css("border","none").css("height","ratio"!==e.height&&e.height?e.height.toString(10):1).css("width","ratio"!==e.width&&e.width?e.width.toString(10):1),n.appendTo(this.$parent),"ratio"===e.height?n.css("height",Math.round(n.width()/e.sizeRatio)):"ratio"===e.width&&n.css("width",Math.round(n.height()*e.sizeRatio)),n.addClass(r),t.width=n.width(),t.height=n.height(),e=t,e.getContext)e=!1;else{var n=e.ownerDocument.parentWindow,i=n.FlashCanvas?e.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(!i)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");if(e=i.initElement(e),i=1,n&&n.screen&&n.screen.deviceXDPI&&n.screen.logicalXDPI&&(i=1*n.screen.deviceXDPI/n.screen.logicalXDPI),1!==i)try{$(e).children("object").get(0).resize(Math.ceil(e.width*i),Math.ceil(e.height*i)),e.getContext("2d").scale(i,i)}catch(o){}e=!0}return this.isCanvasEmulator=e,t.onselectstart=function(e){return e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1},t};var d,h=window,p=function(e,t){var n=new Image,i=this;n.onload=function(){i.getContext("2d").drawImage(n,0,0,n.width<i.width?n.width:i.width,n.height<i.height?n.height:i.height)},n.src="data:"+t+","+e},f=function(e){return this.find("canvas."+r).add(this.filter("canvas."+r)).data(r+".this").resetCanvas(e),this},g=function(e,t){if(void 0!==t||"string"!=typeof e||"data:"!==e.substr(0,5)||(t=e.slice(5).split(",")[0],e=e.slice(6+t.length),t!==e)){var n=this.find("canvas."+r).add(this.filter("canvas."+r));if(!C.hasOwnProperty(t))throw Error(r+" is unable to find import plugin with for format '"+String(t)+"'");return 0!==n.length&&C[t].call(n[0],e,t,function(e){return function(){return e.resetCanvas.apply(e,arguments)}}(n.data(r+".this"))),this}},m=new a,v=r,b=function(){m.publish(v+".parentresized")};$(h).bind("resize."+v,function(){d&&clearTimeout(d),d=setTimeout(b,500)}).bind("mouseup."+v,function(){m.publish(v+".windowmouseup")});var y={},w={"default":function(){return this.toDataURL()},"native":function(e){return e},image:function(){var e=this.toDataURL();if("string"==typeof e&&4<e.length&&"data:"===e.slice(0,5)&&-1!==e.indexOf(",")){var t=e.indexOf(",");return[e.slice(5,t),e.substr(t+1)]}return[]}},C={"native":function(e,t,n){n(e)},image:p,"image/png;base64":p,"image/jpeg;base64":p,"image/jpg;base64":p},_={"export":w,"import":C,instance:y},x={init:function(e){return this.each(function(){var t,n=!1;for(t=this.parentNode;t&&!n;)n=t.body,t=t.parentNode;!n||new o(this,e,y)})},getSettings:function(){return this.find("canvas."+r).add(this.filter("canvas."+r)).data(r+".this").settings},clear:f,reset:f,addPlugin:function(e,t,n){return _.hasOwnProperty(e)&&(_[e][t]=n),this},listPlugins:function(e){var t=[];if(_.hasOwnProperty(e)){var n,e=_[e];for(n in e)e.hasOwnProperty(n)&&t.push(n)}return t},getData:function(e){var t=this.find("canvas."+r).add(this.filter("canvas."+r));return void 0===e&&(e="default"),0!==t.length&&w.hasOwnProperty(e)?w[e].call(t.get(0),t.data(r+".data")):void 0},importData:g,setData:g,globalEvents:function(){return m},events:function(){return this.find("canvas."+r).add(this.filter("canvas."+r)).data(r+".this").events}};$.fn[r]=function(e){return e&&"object"!=typeof e?"string"==typeof e&&x[e]?x[e].apply(this,Array.prototype.slice.call(arguments,1)):void $.error("Method "+String(e)+" does not exist on jQuery."+r):x.init.apply(this,arguments)}}(),function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(e){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[e]){var t=this.settings[e];"function"!=typeof t&&(t=function(){var e=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),t=e.width();return e.css("left",Math.round((this.canvas.width-t)/2)),t!==e.width()&&e.width(t),e});var n=t.call(this),i=this;i.events.subscribe("jSignature.change",function(){i.dataEngine.data.length?n.show():n.hide()});var o=this,r=(this.events.topics.hasOwnProperty("jSignature.undo")?e:"jSignature")+".undo";n.bind("click",function(){o.events.publish(r)}),o.events.subscribe(r,function(){var e=o.dataEngine.data;e.length&&(e.pop(),o.resetCanvas(e))})}})})}(),function(){for(var e={},t={},n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),i=n.length/2,o=i-1;o>-1;o--)e[n[o]]=n[o+i],t[n[o+i]]=n[o];var r=function(t){for(var t=t.split(""),n=t.length,i=1;n>i;i++)t[i]=e[t[i]];return t.join("")},s=function(e){for(var t,n,o=[],s=0,a=1,l=e.length,c=0;l>c;c++)t=Math.round(e[c]),n=t-s,s=t,0>n&&a>0?(a=-1,o.push("Z")):n>0&&0>a&&(a=1,o.push("Y")),t=Math.abs(n),o.push(t>=i?r(t.toString(i)):t.toString(i));return o.join("")},a=function(n){for(var o,r=[],n=n.split(""),s=n.length,a=1,l=[],c=0,u=0;s>u;u++)o=n[u],o in e||"Z"===o||"Y"===o?(0!==l.length&&(l=parseInt(l.join(""),i)*a+c,r.push(l),c=l),"Z"===o?(a=-1,l=[]):"Y"===o?(a=1,l=[]):l=[o]):l.push(t[o]);return r.push(parseInt(l.join(""),i)*a+c),r},l=function(e){for(var t,n=[],i=e.length,o=0;i>o;o++)t=e[o],n.push(s(t.x)),n.push(s(t.y));return n.join("_")},c=function(e){for(var t=[],e=e.split("_"),n=e.length/2,i=0;n>i;i++)t.push({x:a(e[2*i]),y:a(e[2*i+1])});return t},n=function(e){return["image/jsignature;base30",l(e)]},o=function(e,t,n){"string"==typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),n(c(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var u=this.jQuery.fn.jSignature;u("addPlugin","export","base30",n),u("addPlugin","export","image/jsignature;base30",n),u("addPlugin","import","base30",o),u("addPlugin","import","image/jsignature;base30",o),this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:r,compressstrokeleg:s,uncompressstrokeleg:a,compressstrokes:l,uncompressstrokes:c,charmap:e})}.call("undefined"!=typeof window?window:this),function(){function e(e,t){this.x=e,this.y=t,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(e){return Math.round(e/Math.abs(e))};this.resizeTo=function(e){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=e,this.y=e*n(this.y);else if(0===this.y)this._length=e,this.x=e*n(this.x);else{var t=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(e,2)/(1+Math.pow(t,2))),t=t*i;this._length=e,this.x=i*n(this.x),this.y=t*n(this.y)}return this},this.angleTo=function(e){var t=this.getLength()*e.getLength();return 0===t?0:Math.acos(Math.min(Math.max((this.x*e.x+this.y*e.y)/t,-1),1))/Math.PI}}function t(t,n){this.x=t,this.y=n,this.getVectorToCoordinates=function(t,n){return new e(t-this.x,n-this.y)},this.getVectorFromCoordinates=function(e,t){return this.getVectorToCoordinates(e,t).reverse()},this.getVectorToPoint=function(t){return new e(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(e){return this.getVectorToPoint(e).reverse()}}function n(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function i(i,o,r){var o=o+1,s=new t(i.x[o-1],i.y[o-1]),a=new t(i.x[o],i.y[o]),a=s.getVectorToPoint(a),l=new t(i.x[o-2],i.y[o-2]),s=l.getVectorToPoint(s);return s.getLength()>r?(r=o>2?new t(i.x[o-3],i.y[o-3]).getVectorToPoint(l):new e(0,0),i=.35*s.getLength(),l=s.angleTo(r.reverse()),o=a.angleTo(s.reverse()),r=new e(r.x+s.x,r.y+s.y).resizeTo(Math.max(.05,l)*i),a=new e(s.x+a.x,s.y+a.y).reverse().resizeTo(Math.max(.05,o)*i),a=new e(s.x+a.x,s.y+a.y),["c",n(r.x,2),n(r.y,2),n(a.x,2),n(a.y,2),n(s.x,2),n(s.y,2)]):["l",n(s.x,2),n(s.y,2)]}function o(i,o){var r=i.x.length-1,s=new t(i.x[r],i.y[r]),a=new t(i.x[r-1],i.y[r-1]),s=a.getVectorToPoint(s);if(r>1&&s.getLength()>o){var r=new t(i.x[r-2],i.y[r-2]).getVectorToPoint(a),a=s.angleTo(r.reverse()),l=.35*s.getLength(),r=new e(r.x+s.x,r.y+s.y).resizeTo(Math.max(.05,a)*l);return["c",n(r.x,2),n(r.y,2),n(s.x,2),n(s.y,2),n(s.x,2),n(s.y,2)]}return["l",n(s.x,2),n(s.y,2)]}function r(e,t,r){for(var t=["M",n(e.x[0]-t,2),n(e.y[0]-r,2)],r=1,s=e.x.length-1;s>r;r++)t.push.apply(t,i(e,r,1));return s>0?t.push.apply(t,o(e,r,1)):0===s&&t.push.apply(t,["l",1,1]),t.join(" ")}function s(e){var t,n,i=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],o=e.length,s=[],a=[],l=n=t=0,c=0,u=[];if(0!==o){for(t=0;o>t;t++){l=e[t],c=[],n={x:[],y:[]};for(var d=void 0,h=void 0,d=0,h=l.x.length;h>d;d++)c.push({x:l.x[d],y:l.y[d]});for(c=simplify(c,.7,!0),d=0,h=c.length;h>d;d++)n.x.push(c[d].x),n.y.push(c[d].y);u.push(n),s=s.concat(n.x),a=a.concat(n.y)}e=Math.min.apply(null,s)-1,o=Math.max.apply(null,s)+1,s=Math.min.apply(null,a)-1,a=Math.max.apply(null,a)+1,l=0>e?0:e,c=0>s?0:s,t=o-e,n=a-s}for(i.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+t.toString()+'" height="'+n.toString()+'">'),t=0,o=u.length;o>t;t++)n=u[t],i.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+r(n,l,c)+'"/>');

return i.push("</svg>"),i.join("")}function a(e){return[d,s(e)]}function l(e){return[h,u(s(e))]}var c=window;if(("undefined"!=typeof exports?exports:c).simplify=function(e,t,n){if(t=void 0!==t?t*t:1,!n){for(var i,o=e.length,r=e[0],s=[r],n=1;o>n;n++){i=e[n];var a=i.x-r.x,l=i.y-r.y;a*a+l*l>t&&(s.push(i),r=i)}r!==i&&s.push(i),e=s}i=e;var c,u,n=i.length,o=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n),r=0,s=n-1,d=[],h=[],p=[];for(o[r]=o[s]=1;s;){for(l=0,a=r+1;s>a;a++){c=i[a];var f=i[r],g=i[s],m=f.x,v=f.y,f=g.x-m,b=g.y-v,y=void 0;(0!==f||0!==b)&&(y=((c.x-m)*f+(c.y-v)*b)/(f*f+b*b),y>1?(m=g.x,v=g.y):y>0&&(m+=f*y,v+=b*y)),f=c.x-m,b=c.y-v,c=f*f+b*b,c>l&&(u=a,l=c)}l>t&&(o[u]=1,d.push(r),h.push(u),d.push(u),h.push(s)),r=d.pop(),s=h.pop()}for(a=0;n>a;a++)o[a]&&p.push(i[a]);return e=p},"function"!=typeof u)var u=function(e){var t,n,i,o,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),s=0,a=0,l="",l=[];do t=e.charCodeAt(s++),n=e.charCodeAt(s++),i=e.charCodeAt(s++),o=t<<16|n<<8|i,t=o>>18&63,n=o>>12&63,i=o>>6&63,o&=63,l[a++]=r[t]+r[n]+r[i]+r[o];while(s<e.length);return l=l.join(""),e=e.length%3,(e?l.slice(0,e-3):l)+"===".slice(e||3)};var d="image/svg+xml",h="image/svg+xml;base64";if("undefined"==typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");c=$.fn.jSignature,c("addPlugin","export","svg",a),c("addPlugin","export",d,a),c("addPlugin","export","svgbase64",l),c("addPlugin","export",h,l)}(),function(e){!function(){function t(t){for(var n,i,o=t.css("color"),t=t[0],r=!1;t&&!i&&!r;){try{n=e(t).css("background-color")}catch(s){n="transparent"}"transparent"!==n&&"rgba(0, 0, 0, 0)"!==n&&(i=n),r=t.body,t=t.parentNode}var a,t=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,r=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/;n=void 0,(n=o.match(t))?a={r:parseInt(n[1],10),g:parseInt(n[2],10),b:parseInt(n[3],10)}:(n=o.match(r))&&(a={r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)});var l;return i?(n=void 0,(n=i.match(t))?l={r:parseInt(n[1],10),g:parseInt(n[2],10),b:parseInt(n[3],10)}:(n=i.match(r))&&(l={r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)})):l=a&&127<Math.max.apply(null,[a.r,a.g,a.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255},n=function(e){return"rgb("+[e.r,e.g,e.b].join(", ")+")"},a&&l?(t=Math.max.apply(null,[a.r,a.g,a.b]),a=Math.max.apply(null,[l.r,l.g,l.b]),a=Math.round(a+-.75*(a-t)),a={r:a,g:a,b:a}):a?(a=Math.max.apply(null,[a.r,a.g,a.b]),t=1,a>127&&(t=-1),a=Math.round(a+96*t),a={r:a,g:a,b:a}):a={r:191,g:191,b:191},{color:o,"background-color":l?n(l):i,"decor-color":n(a)}}function n(e,t){this.x=e,this.y=t,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(e){return Math.round(e/Math.abs(e))};this.resizeTo=function(e){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=e,this.y=e*n(this.y);else if(0===this.y)this._length=e,this.x=e*n(this.x);else{var t=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(e,2)/(1+Math.pow(t,2))),t=t*i;this._length=e,this.x=i*n(this.x),this.y=t*n(this.y)}return this},this.angleTo=function(e){var t=this.getLength()*e.getLength();return 0===t?0:Math.acos(Math.min(Math.max((this.x*e.x+this.y*e.y)/t,-1),1))/Math.PI}}function i(e,t){this.x=e,this.y=t,this.getVectorToCoordinates=function(e,t){return new n(e-this.x,t-this.y)},this.getVectorFromCoordinates=function(e,t){return this.getVectorToCoordinates(e,t).reverse()},this.getVectorToPoint=function(e){return new n(e.x-this.x,e.y-this.y)},this.getVectorFromPoint=function(e){return this.getVectorToPoint(e).reverse()}}function o(e,t,n,i,o){if(this.data=e,this.context=t,e.length)for(var r,s,a=e.length,l=0;a>l;l++){r=e[l],s=r.x.length,n.call(t,r);for(var c=1;s>c;c++)i.call(t,r,c);o.call(t,r)}this.changed=function(){},this.startStrokeFn=n,this.addToStrokeFn=i,this.endStrokeFn=o,this.inStroke=!1,this._stroke=this._lastPoint=null,this.startStroke=function(e){if(e&&"number"==typeof e.x&&"number"==typeof e.y){this._stroke={x:[e.x],y:[e.y]},this.data.push(this._stroke),this._lastPoint=e,this.inStroke=!0;var t=this._stroke,n=this.startStrokeFn,i=this.context;return setTimeout(function(){n.call(i,t)},3),e}return null},this.addToStroke=function(e){if(this.inStroke&&"number"==typeof e.x&&"number"==typeof e.y&&4<Math.abs(e.x-this._lastPoint.x)+Math.abs(e.y-this._lastPoint.y)){var t=this._stroke.x.length;this._stroke.x.push(e.x),this._stroke.y.push(e.y),this._lastPoint=e;var n=this._stroke,i=this.addToStrokeFn,o=this.context;return setTimeout(function(){i.call(o,n,t)},3),e}return null},this.endStroke=function(){var e=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,e){var t=this._stroke,n=this.endStrokeFn,i=this.context,o=this.changed;return setTimeout(function(){n.call(i,t),o.call(i)},3),!0}return null}}function r(n,o,r){var c=this.$parent=e(n),n=this.eventTokens={};this.events=new l(this);var u=e.fn[s]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};e.extend(d,t(c)),o&&e.extend(d,o),this.settings=d;for(var h in r)r.hasOwnProperty(h)&&r[h].call(this,h);this.events.publish(s+".initializing"),this.$controlbarUpper=e('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(c),this.isCanvasEmulator=!1,r=this.canvas=this.initializeCanvas(d),o=e(r),this.$controlbarLower=e('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(c),this.canvasContext=r.getContext("2d"),o.data(s+".this",this),c=(c=d.lineWidth)?c:Math.max(Math.round(r.width/400),2),d.lineWidth=c,this.lineCurveThreshold=3*d.lineWidth,d.cssclass&&""!=e.trim(d.cssclass)&&o.addClass(d.cssclass),this.fatFingerCompensation=0;var c=function(t){var n,o,r=function(e){return e=e.changedTouches&&0<e.changedTouches.length?e.changedTouches[0]:e,new i(Math.round(e.pageX+n),Math.round(e.pageY+o)+t.fatFingerCompensation)},s=new a(750,function(){t.dataEngine.endStroke()});return this.drawEndHandler=function(e){try{e.preventDefault()}catch(n){}s.clear(),t.dataEngine.endStroke()},this.drawStartHandler=function(i){i.preventDefault();var a=e(t.canvas).offset();n=-1*a.left,o=-1*a.top,t.dataEngine.startStroke(r(i)),s.kick()},this.drawMoveHandler=function(e){e.preventDefault(),t.dataEngine.inStroke&&(t.dataEngine.addToStroke(r(e)),s.kick())},this}.call({},this),p=c.drawEndHandler,f=c.drawStartHandler,g=c.drawMoveHandler,m=this.canvas,o=e(m);this.isCanvasEmulator?(o.bind("mousemove."+s,g),o.bind("mouseup."+s,p),o.bind("mousedown."+s,f)):(m.ontouchstart=function(e){m.onmousedown=void 0,m.onmouseup=void 0,m.onmousemove=void 0,this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?-3*d.lineWidth:d.minFatFingerCompensation,f(e),m.ontouchend=p,m.ontouchstart=f,m.ontouchmove=g},m.onmousedown=function(e){m.ontouchstart=void 0,m.ontouchend=void 0,m.ontouchmove=void 0,f(e),m.onmousedown=f,m.onmouseup=p,m.onmousemove=g}),n[s+".windowmouseup"]=u.subscribe(s+".windowmouseup",c.drawEndHandler),this.events.publish(s+".attachingEventHandlers");var v=this,n=d.width.toString(10),b=s;return("ratio"===n||"%"===n.split("")[n.length-1])&&(this.eventTokens[b+".parentresized"]=u.subscribe(b+".parentresized",function(e,t,n){return function(){var i=t.width();if(i!==n){for(var o in e)e.hasOwnProperty(o)&&(u.unsubscribe(e[o]),delete e[o]);var r=v.settings;v.$parent.children().remove();for(o in v)v.hasOwnProperty(o)&&delete v[o];o=r.data;var s,a,l,c,d,h,i=1*i/n,p=[];for(a=0,l=o.length;l>a;a++){for(h=o[a],s={x:[],y:[]},c=0,d=h.x.length;d>c;c++)s.x.push(h.x[c]*i),s.y.push(h.y[c]*i);p.push(s)}r.data=p,t[b](r)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height))),this.resetCanvas(d.data),this.events.publish(s+".initialized"),this}var s="jSignature",a=function(e,t){var n;return this.kick=function(){clearTimeout(n),n=setTimeout(t,e)},this.clear=function(){clearTimeout(n)},this},l=function(e){this.topics={},this.context=e?e:this,this.publish=function(e,t,n,i){if(this.topics[e]){var o,r,s,a,l=this.topics[e],c=Array.prototype.slice.call(arguments,1),u=[];for(r=0,s=l.length;s>r;r++)a=l[r],o=a[0],a[1]&&(a[0]=function(){},u.push(r)),o.apply(this.context,c);for(r=0,s=u.length;s>r;r++)l.splice(u[r],1)}},this.subscribe=function(e,t,n){return this.topics[e]?this.topics[e].push([t,n]):this.topics[e]=[[t,n]],{topic:e,callback:t}},this.unsubscribe=function(e){if(this.topics[e.topic])for(var t=this.topics[e.topic],n=0,i=t.length;i>n;n++)t[n][0]===e.callback&&t.splice(n,1)}},c=function(e){var t=this.canvasContext,n=e.x[0],e=e.y[0],i=this.settings.lineWidth,o=t.fillStyle;t.fillStyle=t.strokeStyle,t.fillRect(n+i/-2,e+i/-2,i,i),t.fillStyle=o},u=function(e,t){var o=new i(e.x[t-1],e.y[t-1]),r=new i(e.x[t],e.y[t]),s=o.getVectorToPoint(r);if(t>1){var a,l=new i(e.x[t-2],e.y[t-2]),c=l.getVectorToPoint(o);if(c.getLength()>this.lineCurveThreshold){a=t>2?new i(e.x[t-3],e.y[t-3]).getVectorToPoint(l):new n(0,0);var u=.35*c.getLength(),d=c.angleTo(a.reverse()),h=s.angleTo(c.reverse());a=new n(a.x+c.x,a.y+c.y).resizeTo(Math.max(.05,d)*u);var p=new n(c.x+s.x,c.y+s.y).reverse().resizeTo(Math.max(.05,h)*u),c=this.canvasContext,u=l.x,h=l.y,d=o.x,f=o.y,g=l.x+a.x,l=l.y+a.y;a=o.x+p.x,p=o.y+p.y,c.beginPath(),c.moveTo(u,h),c.bezierCurveTo(g,l,a,p,d,f),c.stroke()}}s.getLength()<=this.lineCurveThreshold&&(s=this.canvasContext,l=o.x,o=o.y,a=r.x,r=r.y,s.beginPath(),s.moveTo(l,o),s.lineTo(a,r),s.stroke())},d=function(e){var t=e.x.length-1;if(t>0){var o=new i(e.x[t],e.y[t]),r=new i(e.x[t-1],e.y[t-1]),s=r.getVectorToPoint(o);if(s.getLength()>this.lineCurveThreshold){if(t>1){var e=new i(e.x[t-2],e.y[t-2]).getVectorToPoint(r),a=new n(e.x+s.x,e.y+s.y).resizeTo(s.getLength()/2),s=this.canvasContext,e=r.x,t=r.y,l=o.x,c=o.y,u=r.x+a.x,r=r.y+a.y,a=o.x,o=o.y;s.beginPath(),s.moveTo(e,t),s.bezierCurveTo(u,r,a,o,l,c)}else s=this.canvasContext,e=r.x,r=r.y,t=o.x,o=o.y,s.beginPath(),s.moveTo(e,r),s.lineTo(t,o);s.stroke()}}};r.prototype.resetCanvas=function(t){var n=this.canvas,i=this.settings,r=this.canvasContext,a=this.isCanvasEmulator,l=n.width,h=n.height;r.clearRect(0,0,l+30,h+30),r.shadowColor=r.fillStyle=i["background-color"],a&&r.fillRect(0,0,l+30,h+30),r.lineWidth=Math.ceil(parseInt(i.lineWidth,10)),r.lineCap=r.lineJoin="round",r.strokeStyle=i["decor-color"],r.shadowOffsetX=0,r.shadowOffsetY=0;var p=Math.round(h/5),f=1.5*p,g=h-p,l=l-1.5*p,h=h-p;r.beginPath(),r.moveTo(f,g),r.lineTo(l,h),r.stroke(),r.strokeStyle=i.color,a||(r.shadowColor=r.strokeStyle,r.shadowOffsetX=.5*r.lineWidth,r.shadowOffsetY=-.6*r.lineWidth,r.shadowBlur=0),t||(t=[]),r=this.dataEngine=new o(t,this,c,u,d),i.data=t,e(n).data(s+".data",t).data(s+".settings",i);var m=this.$parent,v=this.events,b=s;return r.changed=function(){v.publish(b+".change"),m.trigger("change")},r.changed(),!0},r.prototype.initializeCanvas=function(t){var n=document.createElement("canvas"),i=e(n);if(t.width===t.height&&"ratio"===t.height&&(t.width="100%"),i.css("margin",0).css("padding",0).css("border","none").css("height","ratio"!==t.height&&t.height?t.height.toString(10):1).css("width","ratio"!==t.width&&t.width?t.width.toString(10):1),i.appendTo(this.$parent),"ratio"===t.height?i.css("height",Math.round(i.width()/t.sizeRatio)):"ratio"===t.width&&i.css("width",Math.round(i.height()*t.sizeRatio)),i.addClass(s),n.width=i.width(),n.height=i.height(),t=n,t.getContext)t=!1;else{var i=t.ownerDocument.parentWindow,o=i.FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(!o)throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");if(t=o.initElement(t),o=1,i&&i.screen&&i.screen.deviceXDPI&&i.screen.logicalXDPI&&(o=1*i.screen.deviceXDPI/i.screen.logicalXDPI),1!==o)try{e(t).children("object").get(0).resize(Math.ceil(t.width*o),Math.ceil(t.height*o)),t.getContext("2d").scale(o,o)}catch(r){}t=!0}return this.isCanvasEmulator=t,n.onselectstart=function(e){return e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1},n};var h,p=window,f=function(e,t){var n=new Image,i=this;n.onload=function(){i.getContext("2d").drawImage(n,0,0,n.width<i.width?n.width:i.width,n.height<i.height?n.height:i.height)},n.src="data:"+t+","+e},g=function(e){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").resetCanvas(e),this},m=function(e,t){if(void 0!==t||"string"!=typeof e||"data:"!==e.substr(0,5)||(t=e.slice(5).split(",")[0],e=e.slice(6+t.length),t!==e)){var n=this.find("canvas."+s).add(this.filter("canvas."+s));if(!_.hasOwnProperty(t))throw Error(s+" is unable to find import plugin with for format '"+String(t)+"'");return 0!==n.length&&_[t].call(n[0],e,t,function(e){return function(){return e.resetCanvas.apply(e,arguments)}}(n.data(s+".this"))),this}},v=new l,b=s,y=function(){v.publish(b+".parentresized")};e(p).bind("resize."+b,function(){h&&clearTimeout(h),h=setTimeout(y,500)}).bind("mouseup."+b,function(){v.publish(b+".windowmouseup")});var w={},C={"default":function(){return this.toDataURL()},"native":function(e){return e},image:function(){var e=this.toDataURL();if("string"==typeof e&&4<e.length&&"data:"===e.slice(0,5)&&-1!==e.indexOf(",")){var t=e.indexOf(",");return[e.slice(5,t),e.substr(t+1)]}return[]}},_={"native":function(e,t,n){n(e)},image:f,"image/png;base64":f,"image/jpeg;base64":f,"image/jpg;base64":f},x={"export":C,"import":_,instance:w},S={init:function(e){return this.each(function(){var t,n=!1;for(t=this.parentNode;t&&!n;)n=t.body,t=t.parentNode;!n||new r(this,e,w)})},getSettings:function(){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").settings},clear:g,reset:g,addPlugin:function(e,t,n){return x.hasOwnProperty(e)&&(x[e][t]=n),this},listPlugins:function(e){var t=[];if(x.hasOwnProperty(e)){var n,e=x[e];for(n in e)e.hasOwnProperty(n)&&t.push(n)}return t},getData:function(e){var t=this.find("canvas."+s).add(this.filter("canvas."+s));return void 0===e&&(e="default"),0!==t.length&&C.hasOwnProperty(e)?C[e].call(t.get(0),t.data(s+".data")):void 0},importData:m,setData:m,globalEvents:function(){return v},events:function(){return this.find("canvas."+s).add(this.filter("canvas."+s)).data(s+".this").events}};e.fn[s]=function(t){return t&&"object"!=typeof t?"string"==typeof t&&S[t]?S[t].apply(this,Array.prototype.slice.call(arguments,1)):void e.error("Method "+String(t)+" does not exist on jQuery."+s):S.init.apply(this,arguments)}}(),function(){e.fn.jSignature("addPlugin","instance","UndoButton",function(t){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[t]){var n=this.settings[t];"function"!=typeof n&&(n=function(){var t=e('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),n=t.width();return t.css("left",Math.round((this.canvas.width-n)/2)),n!==t.width()&&t.width(n),t});var i=n.call(this),o=this;o.events.subscribe("jSignature.change",function(){o.dataEngine.data.length?i.show():i.hide()});var r=this,s=(this.events.topics.hasOwnProperty("jSignature.undo")?t:"jSignature")+".undo";i.bind("click",function(){r.events.publish(s)}),r.events.subscribe(s,function(){var e=r.dataEngine.data;e.length&&(e.pop(),r.resetCanvas(e))})}})})}(),function(){for(var e={},t={},n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),i=n.length/2,o=i-1;o>-1;o--)e[n[o]]=n[o+i],t[n[o+i]]=n[o];var r=function(t){for(var t=t.split(""),n=t.length,i=1;n>i;i++)t[i]=e[t[i]];return t.join("")},s=function(e){for(var t,n,o=[],s=0,a=1,l=e.length,c=0;l>c;c++)t=Math.round(e[c]),n=t-s,s=t,0>n&&a>0?(a=-1,o.push("Z")):n>0&&0>a&&(a=1,o.push("Y")),t=Math.abs(n),o.push(t>=i?r(t.toString(i)):t.toString(i));return o.join("")},a=function(n){for(var o,r=[],n=n.split(""),s=n.length,a=1,l=[],c=0,u=0;s>u;u++)o=n[u],o in e||"Z"===o||"Y"===o?(0!==l.length&&(l=parseInt(l.join(""),i)*a+c,r.push(l),c=l),"Z"===o?(a=-1,l=[]):"Y"===o?(a=1,l=[]):l=[o]):l.push(t[o]);return r.push(parseInt(l.join(""),i)*a+c),r},l=function(e){for(var t,n=[],i=e.length,o=0;i>o;o++)t=e[o],n.push(s(t.x)),n.push(s(t.y));return n.join("_")},c=function(e){for(var t=[],e=e.split("_"),n=e.length/2,i=0;n>i;i++)t.push({x:a(e[2*i]),y:a(e[2*i+1])});return t},n=function(e){return["image/jsignature;base30",l(e)]},o=function(e,t,n){"string"==typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),n(c(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var u=this.jQuery.fn.jSignature;u("addPlugin","export","base30",n),u("addPlugin","export","image/jsignature;base30",n),u("addPlugin","import","base30",o),u("addPlugin","import","image/jsignature;base30",o),this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:r,compressstrokeleg:s,uncompressstrokeleg:a,compressstrokes:l,uncompressstrokes:c,charmap:e})}.call("undefined"!=typeof window?window:this),function(){function t(e,t){this.x=e,this.y=t,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};var n=function(e){return Math.round(e/Math.abs(e))};this.resizeTo=function(e){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=e,this.y=e*n(this.y);else if(0===this.y)this._length=e,this.x=e*n(this.x);else{var t=Math.abs(this.y/this.x),i=Math.sqrt(Math.pow(e,2)/(1+Math.pow(t,2))),t=t*i;this._length=e,this.x=i*n(this.x),this.y=t*n(this.y)}return this},this.angleTo=function(e){var t=this.getLength()*e.getLength();return 0===t?0:Math.acos(Math.min(Math.max((this.x*e.x+this.y*e.y)/t,-1),1))/Math.PI}}function n(e,n){this.x=e,this.y=n,this.getVectorToCoordinates=function(e,n){return new t(e-this.x,n-this.y)},this.getVectorFromCoordinates=function(e,t){return this.getVectorToCoordinates(e,t).reverse()},this.getVectorToPoint=function(e){return new t(e.x-this.x,e.y-this.y)},this.getVectorFromPoint=function(e){return this.getVectorToPoint(e).reverse()}}function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function o(e,o,r){var o=o+1,s=new n(e.x[o-1],e.y[o-1]),a=new n(e.x[o],e.y[o]),a=s.getVectorToPoint(a),l=new n(e.x[o-2],e.y[o-2]),s=l.getVectorToPoint(s);return s.getLength()>r?(r=o>2?new n(e.x[o-3],e.y[o-3]).getVectorToPoint(l):new t(0,0),e=.35*s.getLength(),l=s.angleTo(r.reverse()),o=a.angleTo(s.reverse()),r=new t(r.x+s.x,r.y+s.y).resizeTo(Math.max(.05,l)*e),a=new t(s.x+a.x,s.y+a.y).reverse().resizeTo(Math.max(.05,o)*e),a=new t(s.x+a.x,s.y+a.y),["c",i(r.x,2),i(r.y,2),i(a.x,2),i(a.y,2),i(s.x,2),i(s.y,2)]):["l",i(s.x,2),i(s.y,2)]}function r(e,o){var r=e.x.length-1,s=new n(e.x[r],e.y[r]),a=new n(e.x[r-1],e.y[r-1]),s=a.getVectorToPoint(s);if(r>1&&s.getLength()>o){var r=new n(e.x[r-2],e.y[r-2]).getVectorToPoint(a),a=s.angleTo(r.reverse()),l=.35*s.getLength(),r=new t(r.x+s.x,r.y+s.y).resizeTo(Math.max(.05,a)*l);return["c",i(r.x,2),i(r.y,2),i(s.x,2),i(s.y,2),i(s.x,2),i(s.y,2)]}return["l",i(s.x,2),i(s.y,2)]}function s(e,t,n){for(var t=["M",i(e.x[0]-t,2),i(e.y[0]-n,2)],n=1,s=e.x.length-1;s>n;n++)t.push.apply(t,o(e,n,1));return s>0?t.push.apply(t,r(e,n,1)):0===s&&t.push.apply(t,["l",1,1]),t.join(" ")}function a(e){var t,n,i=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],o=e.length,r=[],a=[],l=n=t=0,c=0,u=[];if(0!==o){for(t=0;o>t;t++){l=e[t],c=[],n={x:[],y:[]};for(var d=void 0,h=void 0,d=0,h=l.x.length;h>d;d++)c.push({x:l.x[d],y:l.y[d]});for(c=simplify(c,.7,!0),d=0,h=c.length;h>d;d++)n.x.push(c[d].x),n.y.push(c[d].y);u.push(n),r=r.concat(n.x),a=a.concat(n.y)}e=Math.min.apply(null,r)-1,o=Math.max.apply(null,r)+1,r=Math.min.apply(null,a)-1,a=Math.max.apply(null,a)+1,l=0>e?0:e,c=0>r?0:r,t=o-e,n=a-r}for(i.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+t.toString()+'" height="'+n.toString()+'">'),t=0,o=u.length;o>t;t++)n=u[t],i.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+s(n,l,c)+'"/>');return i.push("</svg>"),i.join("")}function l(e){return[h,a(e)]}function c(e){return[p,d(a(e))]}var u=window;if(("undefined"!=typeof exports?exports:u).simplify=function(e,t,n){if(t=void 0!==t?t*t:1,!n){for(var i,o=e.length,r=e[0],s=[r],n=1;o>n;n++){i=e[n];var a=i.x-r.x,l=i.y-r.y;a*a+l*l>t&&(s.push(i),r=i)}r!==i&&s.push(i),e=s}i=e;var c,u,n=i.length,o=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n),r=0,s=n-1,d=[],h=[],p=[];for(o[r]=o[s]=1;s;){for(l=0,a=r+1;s>a;a++){c=i[a];var f=i[r],g=i[s],m=f.x,v=f.y,f=g.x-m,b=g.y-v,y=void 0;(0!==f||0!==b)&&(y=((c.x-m)*f+(c.y-v)*b)/(f*f+b*b),y>1?(m=g.x,v=g.y):y>0&&(m+=f*y,v+=b*y)),f=c.x-m,b=c.y-v,c=f*f+b*b,c>l&&(u=a,l=c)}l>t&&(o[u]=1,d.push(r),h.push(u),d.push(u),h.push(s)),r=d.pop(),s=h.pop()}for(a=0;n>a;a++)o[a]&&p.push(i[a]);return e=p},"function"!=typeof d)var d=function(e){var t,n,i,o,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),s=0,a=0,l="",l=[];do t=e.charCodeAt(s++),n=e.charCodeAt(s++),i=e.charCodeAt(s++),o=t<<16|n<<8|i,t=o>>18&63,n=o>>12&63,i=o>>6&63,o&=63,l[a++]=r[t]+r[n]+r[i]+r[o];while(s<e.length);return l=l.join(""),e=e.length%3,(e?l.slice(0,e-3):l)+"===".slice(e||3)};var h="image/svg+xml",p="image/svg+xml;base64";if("undefined"==typeof e)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");u=e.fn.jSignature,u("addPlugin","export","svg",l),u("addPlugin","export",h,l),u("addPlugin","export","svgbase64",c),u("addPlugin","export",p,c)}()}(jQuery),angular.module("xeditable",[]).value("editableOptions",{theme:"default",buttons:"right",blurElem:"cancel",blurForm:"ignore",activate:"focus"}),angular.module("xeditable").directive("editableBsdate",["editableDirectiveFactory",function(e){return e({directiveName:"editableBsdate",inputTpl:'<input type="text">'})}]),angular.module("xeditable").directive("editableBstime",["editableDirectiveFactory",function(e){return e({directiveName:"editableBstime",inputTpl:"<timepicker></timepicker>",render:function(){this.parent.render.call(this);var e=angular.element('<div class="well well-small" style="display:inline-block;"></div>');e.attr("ng-model",this.inputEl.attr("ng-model")),this.inputEl.removeAttr("ng-model"),this.attrs.eNgChange&&(e.attr("ng-change",this.inputEl.attr("ng-change")),this.inputEl.removeAttr("ng-change")),this.inputEl.wrap(e)}})}]),angular.module("xeditable").directive("editableCheckbox",["editableDirectiveFactory",function(e){return e({directiveName:"editableCheckbox",inputTpl:'<input type="checkbox">',render:function(){this.parent.render.call(this),this.attrs.eTitle&&(this.inputEl.wrap("<label></label>"),this.inputEl.after(angular.element("<span></span>").text(this.attrs.eTitle)))},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableChecklist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableChecklist",inputTpl:"<span></span>",useCopy:!0,render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="checkbox" checklist-model="$parent.$data" checklist-value="'+e.locals.valueFn+'"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)}})}]),function(){var e="text|email|tel|number|url|search|color|date|datetime|time|month|week".split("|");angular.forEach(e,function(e){var t="editable"+e.charAt(0).toUpperCase()+e.slice(1);angular.module("xeditable").directive(t,["editableDirectiveFactory",function(n){return n({directiveName:t,inputTpl:'<input type="'+e+'">'})}])}),angular.module("xeditable").directive("editableRange",["editableDirectiveFactory",function(e){return e({directiveName:"editableRange",inputTpl:'<input type="range" id="range" name="range">',render:function(){this.parent.render.call(this),this.inputEl.after("<output>{{$data}}</output>")}})}])}(),angular.module("xeditable").directive("editableRadiolist",["editableDirectiveFactory","editableNgOptionsParser",function(e,t){return e({directiveName:"editableRadiolist",inputTpl:"<span></span>",render:function(){this.parent.render.call(this);var e=t(this.attrs.eNgOptions),n='<label ng-repeat="'+e.ngRepeat+'"><input type="radio" ng-model="$parent.$data" value="{{'+e.locals.valueFn+'}}"><span ng-bind="'+e.locals.displayFn+'"></span></label>';this.inputEl.removeAttr("ng-model"),this.inputEl.removeAttr("ng-options"),this.inputEl.html(n)},autosubmit:function(){var e=this;e.inputEl.bind("change",function(){setTimeout(function(){e.scope.$apply(function(){e.scope.$form.$submit()})},500)})}})}]),angular.module("xeditable").directive("editableSelect",["editableDirectiveFactory",function(e){return e({directiveName:"editableSelect",inputTpl:"<select></select>",autosubmit:function(){var e=this;e.inputEl.bind("change",function(){e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").directive("editableTextarea",["editableDirectiveFactory",function(e){return e({directiveName:"editableTextarea",inputTpl:"<textarea></textarea>",addListeners:function(){var e=this;e.parent.addListeners.call(e),e.single&&"no"!==e.buttons&&e.autosubmit()},autosubmit:function(){var e=this;e.inputEl.bind("keydown",function(t){(t.ctrlKey||t.metaKey)&&13===t.keyCode&&e.scope.$apply(function(){e.scope.$form.$submit()})})}})}]),angular.module("xeditable").factory("editableController",["$q","editableUtils",function(e,t){function n(e,n,i,o,r,s,a,l,c){var u,d,h=this;h.scope=e,h.elem=i,h.attrs=n,h.inputEl=null,h.editorEl=null,h.single=!0,h.error="",h.theme=r[s.theme]||r["default"],h.parent={},h.inputTpl="",h.directiveName="",h.useCopy=!1,h.single=null,h.buttons="right",h.init=function(t){if(h.single=t,h.name=n.eName||n[h.directiveName],!n[h.directiveName])throw"You should provide value for `"+h.directiveName+"` in editable element!";u=o(n[h.directiveName]),h.buttons=h.single?h.attrs.buttons||s.buttons:"no",n.eName&&h.scope.$watch("$data",function(e){h.scope.$form.$data[n.eName]=e}),n.onshow&&(h.onshow=function(){return h.catchError(o(n.onshow)(e))}),n.onhide&&(h.onhide=function(){return o(n.onhide)(e)}),n.oncancel&&(h.oncancel=function(){return o(n.oncancel)(e)}),n.onbeforesave&&(h.onbeforesave=function(){return h.catchError(o(n.onbeforesave)(e))}),n.onaftersave&&(h.onaftersave=function(){return h.catchError(o(n.onaftersave)(e))}),e.$parent.$watch(n[h.directiveName],function(e,t){h.handleEmpty()})},h.render=function(){var e=h.theme;h.inputEl=angular.element(h.inputTpl),h.controlsEl=angular.element(e.controlsTpl),h.controlsEl.append(h.inputEl),"no"!==h.buttons&&(h.buttonsEl=angular.element(e.buttonsTpl),h.submitEl=angular.element(e.submitTpl),h.cancelEl=angular.element(e.cancelTpl),h.buttonsEl.append(h.submitEl).append(h.cancelEl),h.controlsEl.append(h.buttonsEl),h.inputEl.addClass("editable-has-buttons")),h.errorEl=angular.element(e.errorTpl),h.controlsEl.append(h.errorEl),h.editorEl=angular.element(h.single?e.formTpl:e.noformTpl),h.editorEl.append(h.controlsEl);for(var i in n.$attr)if(!(i.length<=1)){var o=!1,r=i.substring(1,2);if("e"===i.substring(0,1)&&r===r.toUpperCase()&&(o=i.substring(1),"Form"!==o&&"NgSubmit"!==o)){o=o.substring(0,1).toLowerCase()+t.camelToDash(o.substring(1));var a=""===n[i]?o:n[i];h.inputEl.attr(o,a)}}h.inputEl.addClass("editable-input"),h.inputEl.attr("ng-model","$data"),h.editorEl.addClass(t.camelToDash(h.directiveName)),h.single&&(h.editorEl.attr("editable-form","$form"),h.editorEl.attr("blur",h.attrs.blur||("no"===h.buttons?"cancel":s.blurElem))),angular.isFunction(e.postrender)&&e.postrender.call(h)},h.setLocalValue=function(){h.scope.$data=h.useCopy?angular.copy(u(e.$parent)):u(e.$parent)},h.show=function(){return h.setLocalValue(),h.render(),i.after(h.editorEl),l(h.editorEl)(e),h.addListeners(),i.addClass("editable-hide"),h.onshow()},h.hide=function(){return h.editorEl.remove(),i.removeClass("editable-hide"),h.onhide()},h.cancel=function(){h.oncancel()},h.addListeners=function(){h.inputEl.bind("keyup",function(e){if(h.single)switch(e.keyCode){case 27:h.scope.$apply(function(){h.scope.$form.$cancel()})}}),h.single&&"no"===h.buttons&&h.autosubmit(),h.editorEl.bind("click",function(e){1===e.which&&h.scope.$form.$visible&&(h.scope.$form._clicked=!0)})},h.setWaiting=function(e){e?(d=!h.inputEl.attr("disabled")&&!h.inputEl.attr("ng-disabled")&&!h.inputEl.attr("ng-enabled"),d&&(h.inputEl.attr("disabled","disabled"),h.buttonsEl&&h.buttonsEl.find("button").attr("disabled","disabled"))):d&&(h.inputEl.removeAttr("disabled"),h.buttonsEl&&h.buttonsEl.find("button").removeAttr("disabled"))},h.activate=function(){setTimeout(function(){var e=h.inputEl[0];"focus"===s.activate&&e.focus&&e.focus(),"select"===s.activate&&e.select&&e.select()},0)},h.setError=function(t){angular.isObject(t)||(e.$error=t,h.error=t)},h.catchError=function(e,t){return angular.isObject(e)&&t!==!0?c.when(e).then(angular.bind(this,function(e){this.catchError(e,!0)}),angular.bind(this,function(e){this.catchError(e,!0)})):t&&angular.isObject(e)&&e.status&&200!==e.status&&e.data&&angular.isString(e.data)?(this.setError(e.data),e=e.data):angular.isString(e)&&this.setError(e),e},h.save=function(){u.assign(e.$parent,angular.copy(h.scope.$data))},h.handleEmpty=function(){var t=u(e.$parent),n=null===t||void 0===t||""===t||angular.isArray(t)&&0===t.length;i.toggleClass("editable-empty",n)},h.autosubmit=angular.noop,h.onshow=angular.noop,h.onhide=angular.noop,h.oncancel=angular.noop,h.onbeforesave=angular.noop,h.onaftersave=angular.noop}return n.$inject=["$scope","$attrs","$element","$parse","editableThemes","editableOptions","$rootScope","$compile","$q"],n}]),angular.module("xeditable").factory("editableDirectiveFactory",["$parse","$compile","editableThemes","$rootScope","$document","editableController","editableFormController",function(e,t,n,i,o,r,s){return function(t){return{restrict:"A",scope:!0,require:[t.directiveName,"?^form"],controller:r,link:function(n,r,a,l){var c,u=l[0],d=!1;if(l[1])c=l[1],d=!0;else if(a.eForm){var h=e(a.eForm)(n);if(h)c=h,d=!0;else for(var p=0;p<o[0].forms.length;p++)if(o[0].forms[p].name===a.eForm){c=null,d=!0;break}}if(angular.forEach(t,function(e,t){void 0!==u[t]&&(u.parent[t]=u[t])}),angular.extend(u,t),u.init(!d),n.$editable=u,r.addClass("editable"),d)if(c){if(n.$form=c,!n.$form.$addEditable)throw"Form with editable elements should have `editable-form` attribute.";n.$form.$addEditable(u)}else i.$$editableBuffer=i.$$editableBuffer||{},i.$$editableBuffer[a.eForm]=i.$$editableBuffer[a.eForm]||[],i.$$editableBuffer[a.eForm].push(u),n.$form=null;else n.$form=s(),n.$form.$addEditable(u),a.eForm&&(n.$parent[a.eForm]=n.$form),a.eForm||(r.addClass("editable-click"),r.bind("click",function(e){e.preventDefault(),e.editable=u,n.$apply(function(){n.$form.$show()})}))}}}}]),angular.module("xeditable").factory("editableFormController",["$parse","$document","$rootScope","editablePromiseCollection","editableUtils",function(e,t,n,i,o){var r=[];t.bind("click",function(e){if(1===e.which){for(var t=[],i=[],o=0;o<r.length;o++)r[o]._clicked?r[o]._clicked=!1:r[o].$waiting||("cancel"===r[o]._blur&&t.push(r[o]),"submit"===r[o]._blur&&i.push(r[o]));(t.length||i.length)&&n.$apply(function(){angular.forEach(t,function(e){
e.$cancel()}),angular.forEach(i,function(e){e.$submit()})})}});var s={$addEditable:function(e){this.$editables.push(e),e.elem.bind("$destroy",angular.bind(this,this.$removeEditable,e)),e.scope.$form||(e.scope.$form=this),this.$visible&&e.catchError(e.show())},$removeEditable:function(e){for(var t=0;t<this.$editables.length;t++)if(this.$editables[t]===e)return void this.$editables.splice(t,1)},$show:function(){if(!this.$visible){this.$visible=!0;var e=i();e.when(this.$onshow()),this.$setError(null,""),angular.forEach(this.$editables,function(t){e.when(t.show())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$activate),onFalse:angular.bind(this,this.$activate),onString:angular.bind(this,this.$activate)}),setTimeout(angular.bind(this,function(){this._clicked=!1,-1===o.indexOf(r,this)&&r.push(this)}),0)}},$activate:function(e){var t;if(this.$editables.length){if(angular.isString(e))for(t=0;t<this.$editables.length;t++)if(this.$editables[t].name===e)return void this.$editables[t].activate();for(t=0;t<this.$editables.length;t++)if(this.$editables[t].error)return void this.$editables[t].activate();this.$editables[0].activate()}},$hide:function(){this.$visible&&(this.$visible=!1,this.$onhide(),angular.forEach(this.$editables,function(e){e.hide()}),o.arrayRemove(r,this))},$cancel:function(){this.$visible&&(this.$oncancel(),angular.forEach(this.$editables,function(e){e.cancel()}),this.$hide())},$setWaiting:function(e){this.$waiting=!!e,angular.forEach(this.$editables,function(t){t.setWaiting(!!e)})},$setError:function(e,t){angular.forEach(this.$editables,function(n){e&&n.name!==e||n.setError(t)})},$submit:function(){function e(e){var t=i();t.when(this.$onbeforesave()),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:e?angular.bind(this,this.$save):angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})}if(!this.$waiting){this.$setError(null,"");var t=i();angular.forEach(this.$editables,function(e){t.when(e.onbeforesave())}),t.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,e,!0),onFalse:angular.bind(this,e,!1),onString:angular.bind(this,this.$activate)})}},$save:function(){angular.forEach(this.$editables,function(e){e.save()});var e=i();e.when(this.$onaftersave()),angular.forEach(this.$editables,function(t){e.when(t.onaftersave())}),e.then({onWait:angular.bind(this,this.$setWaiting),onTrue:angular.bind(this,this.$hide),onFalse:angular.bind(this,this.$hide),onString:angular.bind(this,this.$activate)})},$onshow:angular.noop,$oncancel:angular.noop,$onhide:angular.noop,$onbeforesave:angular.noop,$onaftersave:angular.noop};return function(){return angular.extend({$editables:[],$visible:!1,$waiting:!1,$data:{},_clicked:!1,_blur:null},s)}}]),angular.module("xeditable").directive("editableForm",["$rootScope","$parse","editableFormController","editableOptions",function(e,t,n,i){return{restrict:"A",require:["form"],compile:function(){return{pre:function(t,i,o,r){var s,a=r[0];o.editableForm?t[o.editableForm]&&t[o.editableForm].$show?(s=t[o.editableForm],angular.extend(a,s)):(s=n(),t[o.editableForm]=s,angular.extend(s,a)):(s=n(),angular.extend(a,s));var l=e.$$editableBuffer,c=a.$name;c&&l&&l[c]&&(angular.forEach(l[c],function(e){s.$addEditable(e)}),delete l[c])},post:function(e,n,o,r){var s;s=o.editableForm&&e[o.editableForm]&&e[o.editableForm].$show?e[o.editableForm]:r[0],o.onshow&&(s.$onshow=angular.bind(s,t(o.onshow),e)),o.onhide&&(s.$onhide=angular.bind(s,t(o.onhide),e)),o.oncancel&&(s.$oncancel=angular.bind(s,t(o.oncancel),e)),o.shown&&t(o.shown)(e)&&s.$show(),s._blur=o.blur||i.blurForm,o.ngSubmit||o.submit||(o.onbeforesave&&(s.$onbeforesave=function(){return t(o.onbeforesave)(e,{$data:s.$data})}),o.onaftersave&&(s.$onaftersave=function(){return t(o.onaftersave)(e,{$data:s.$data})}),n.bind("submit",function(t){t.preventDefault(),e.$apply(function(){s.$submit()})})),n.bind("click",function(e){1===e.which&&s.$visible&&(s._clicked=!0)})}}}}}]),angular.module("xeditable").factory("editablePromiseCollection",["$q",function(e){function t(){return{promises:[],hasFalse:!1,hasString:!1,when:function(t,n){if(t===!1)this.hasFalse=!0;else if(!n&&angular.isObject(t))this.promises.push(e.when(t));else{if(!angular.isString(t))return;this.hasString=!0}},then:function(t){function n(){a.hasString||a.hasFalse?!a.hasString&&a.hasFalse?o():r():i()}t=t||{};var i=t.onTrue||angular.noop,o=t.onFalse||angular.noop,r=t.onString||angular.noop,s=t.onWait||angular.noop,a=this;this.promises.length?(s(!0),e.all(this.promises).then(function(e){s(!1),angular.forEach(e,function(e){a.when(e,!0)}),n()},function(e){s(!1),r()})):n()}}}return t}]),angular.module("xeditable").factory("editableUtils",[function(){return{indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},arrayRemove:function(e,t){var n=this.indexOf(e,t);return n>=0&&e.splice(n,1),t},camelToDash:function(e){var t=/[A-Z]/g;return e.replace(t,function(e,t){return(t?"-":"")+e.toLowerCase()})},dashToCamel:function(e){var t=/([\:\-\_]+(.))/g,n=/^moz([A-Z])/;return e.replace(t,function(e,t,n,i){return i?n.toUpperCase():n}).replace(n,"Moz$1")}}}]),angular.module("xeditable").factory("editableNgOptionsParser",[function(){function e(e){var n;if(!(n=e.match(t)))throw"ng-options parse error";var i,o=n[2]||n[1],r=n[4]||n[6],s=n[5],a=(n[3]||"",n[2]?n[1]:r),l=n[7],c=n[8],u=c?n[8]:null;return void 0===s?(i=r+" in "+l,void 0!==c&&(i+=" track by "+u)):i="("+s+", "+r+") in "+l,{ngRepeat:i,locals:{valueName:r,keyName:s,valueFn:a,displayFn:o}}}var t=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e}]),angular.module("xeditable").factory("editableThemes",function(){var e={"default":{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span class="icon-ok icon-white"></span></button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span class="icon-remove"></span></button>'},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span></button>',cancelTpl:'<button type="button" class="btn btn-default" ng-click="$form.$cancel()"><span class="glyphicon glyphicon-remove"></span></button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableTime":case"editableMonth":case"editableWeek":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}}};return e}),!function(e){jQuery.fn.extend({slimScroll:function(n){var i={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px",animate:!0},o=e.extend(i,n);return this.each(function(){function i(t){if(u){var t=t||window.event,n=0;t.wheelDelta&&(n=-t.wheelDelta/120),t.detail&&(n=t.detail/3);var i=t.target||t.srcTarget||t.srcElement;e(i).closest("."+o.wrapperClass).is(C.parent())&&r(n,!0),t.preventDefault&&!w&&t.preventDefault(),w||(t.returnValue=!1)}}function r(e,t,n){w=!1;var i=e,r=C.outerHeight()-T.outerHeight();if(t&&(i=parseInt(T.css("top"))+e*parseInt(o.wheelStep)/100*T.outerHeight(),i=Math.min(Math.max(i,0),r),i=e>0?Math.ceil(i):Math.floor(i),T.css({top:i+"px"})),m=parseInt(T.css("top"))/(C.outerHeight()-T.outerHeight()),i=m*(C[0].scrollHeight-C.outerHeight()),n){i=e;var s=i/C[0].scrollHeight*C.outerHeight();s=Math.min(Math.max(s,0),r),T.css({top:s+"px"})}"scrollTo"in o&&o.animate?C.animate({scrollTop:i}):C.scrollTop(i),C.trigger("slimscrolling",~~i),l(),c()}function s(){window.addEventListener?(this.addEventListener("DOMMouseScroll",i,!1),this.addEventListener("mousewheel",i,!1)):document.attachEvent("onmousewheel",i)}function a(){g=Math.max(C.outerHeight()/C[0].scrollHeight*C.outerHeight(),y),T.css({height:g+"px"});var e=g==C.outerHeight()?"none":"block";T.css({display:e})}function l(){if(a(),clearTimeout(p),m==~~m){if(w=o.allowPageScroll,v!=m){var e=0==~~m?"top":"bottom";C.trigger("slimscroll",e)}}else w=!1;return v=m,g>=C.outerHeight()?void(w=!0):(T.stop(!0,!0).fadeIn("fast"),void(o.railVisible&&k.stop(!0,!0).fadeIn("fast")))}function c(){o.alwaysVisible||(p=setTimeout(function(){o.disableFadeOut&&u||d||h||(T.fadeOut("slow"),k.fadeOut("slow"))},1e3))}var u,d,h,p,f,g,m,v,b="<div></div>",y=30,w=!1,C=e(this);if("ontouchstart"in window&&window.navigator.msPointerEnabled&&C.css("-ms-touch-action","none"),C.parent().hasClass(o.wrapperClass)){var _=C.scrollTop();if(T=C.parent().find("."+o.barClass),k=C.parent().find("."+o.railClass),a(),e.isPlainObject(n)){if("height"in n&&"auto"==n.height){C.parent().css("height","auto"),C.css("height","auto");var x=C.parent().parent().height();C.parent().css("height",x),C.css("height",x)}if("scrollTo"in n)_=parseInt(o.scrollTo);else if("scrollBy"in n)_+=parseInt(o.scrollBy);else if("destroy"in n)return T.remove(),k.remove(),void C.unwrap();r(_,!1,!0)}}else{o.height="auto"==n.height?C.parent().height():n.height;var S=e(b).addClass(o.wrapperClass).css({position:"relative",overflow:"hidden",width:o.width,height:o.height});C.css({overflow:"hidden",width:o.width,height:o.height});var k=e(b).addClass(o.railClass).css({width:o.size,height:"100%",position:"absolute",top:0,display:o.alwaysVisible&&o.railVisible?"block":"none","border-radius":o.railBorderRadius,background:o.railColor,opacity:o.railOpacity,zIndex:90}),T=e(b).addClass(o.barClass).css({background:o.color,width:o.size,position:"absolute",top:0,opacity:o.opacity,display:o.alwaysVisible?"block":"none","border-radius":o.borderRadius,BorderRadius:o.borderRadius,MozBorderRadius:o.borderRadius,WebkitBorderRadius:o.borderRadius,zIndex:99}),$="right"==o.position?{right:o.distance}:{left:o.distance};k.css($),T.css($),C.wrap(S),C.parent().append(T),C.parent().append(k),o.railDraggable&&T.bind("mousedown",function(n){var i=e(document);return h=!0,t=parseFloat(T.css("top")),pageY=n.pageY,i.bind("mousemove.slimscroll",function(e){currTop=t+e.pageY-pageY,T.css("top",currTop),r(0,T.position().top,!1)}),i.bind("mouseup.slimscroll",function(){h=!1,c(),i.unbind(".slimscroll")}),!1}).bind("selectstart.slimscroll",function(e){return e.stopPropagation(),e.preventDefault(),!1}),"ontouchstart"in window&&window.navigator.msPointerEnabled&&(C.bind("MSPointerDown",function(e){f=e.originalEvent.pageY}),C.bind("MSPointerMove",function(e){e.originalEvent.preventDefault();var t=(f-e.originalEvent.pageY)/o.touchScrollStep;r(t,!0),f=e.originalEvent.pageY})),k.hover(function(){l()},function(){c()}),T.hover(function(){d=!0},function(){d=!1}),C.hover(function(){u=!0,l(),c()},function(){u=!1,c()}),C.bind("touchstart",function(e){e.originalEvent.touches.length&&(f=e.originalEvent.touches[0].pageY)}),C.bind("touchmove",function(e){if(w||e.originalEvent.preventDefault(),e.originalEvent.touches.length){var t=(f-e.originalEvent.touches[0].pageY)/o.touchScrollStep;r(t,!0),f=e.originalEvent.touches[0].pageY}}),a(),"bottom"===o.start?(T.css({top:C.outerHeight()-T.outerHeight()}),r(0,!0)):"top"!==o.start&&(r(e(o.start).position().top,null,!0),o.alwaysVisible||T.hide()),s()}}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})}(jQuery),!function(){"use strict";function e(e){function t(t,i){var r,g,m=t==window,v=i&&void 0!==i.message?i.message:void 0;if(i=e.extend({},e.blockUI.defaults,i||{}),!i.ignoreIfBlocked||!e(t).data("blockUI.isBlocked")){if(i.overlayCSS=e.extend({},e.blockUI.defaults.overlayCSS,i.overlayCSS||{}),r=e.extend({},e.blockUI.defaults.css,i.css||{}),i.onOverlayClick&&(i.overlayCSS.cursor="pointer"),g=e.extend({},e.blockUI.defaults.themedCSS,i.themedCSS||{}),v=void 0===v?i.message:v,m&&p&&n(window,{fadeOut:0}),v&&"string"!=typeof v&&(v.parentNode||v.jquery)){var b=v.jquery?v[0]:v,y={};e(t).data("blockUI.history",y),y.el=b,y.parent=b.parentNode,y.display=b.style.display,y.position=b.style.position,y.parent&&y.parent.removeChild(b)}e(t).data("blockUI.onUnblock",i.onUnblock);var w,C,_,x,S=i.baseZ;w=e(u||i.forceIframe?'<iframe class="blockUI" style="z-index:'+S++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+i.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),C=e(i.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+S++ +';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+S++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),i.theme&&m?(x='<div class="blockUI '+i.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(S+10)+';display:none;position:fixed">',i.title&&(x+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),x+='<div class="ui-widget-content ui-dialog-content"></div>',x+="</div>"):i.theme?(x='<div class="blockUI '+i.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(S+10)+';display:none;position:absolute">',i.title&&(x+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),x+='<div class="ui-widget-content ui-dialog-content"></div>',x+="</div>"):x=m?'<div class="blockUI '+i.blockMsgClass+' blockPage" style="z-index:'+(S+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+i.blockMsgClass+' blockElement" style="z-index:'+(S+10)+';display:none;position:absolute"></div>',_=e(x),v&&(i.theme?(_.css(g),_.addClass("ui-widget-content")):_.css(r)),i.theme||C.css(i.overlayCSS),C.css("position",m?"fixed":"absolute"),(u||i.forceIframe)&&w.css("opacity",0);var k=[w,C,_],T=e(m?"body":t);e.each(k,function(){this.appendTo(T)}),i.theme&&i.draggable&&e.fn.draggable&&_.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var $=h&&(!e.support.boxModel||e("object,embed",m?null:t).length>0);if(d||$){if(m&&i.allowBodyStretch&&e.support.boxModel&&e("html,body").css("height","100%"),(d||!e.support.boxModel)&&!m)var E=l(t,"borderTopWidth"),D=l(t,"borderLeftWidth"),I=E?"(0 - "+E+")":0,M=D?"(0 - "+D+")":0;e.each(k,function(e,t){var n=t[0].style;if(n.position="absolute",2>e)m?n.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+i.quirksmodeOffsetHack+') + "px"'):n.setExpression("height",'this.parentNode.offsetHeight + "px"'),m?n.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):n.setExpression("width",'this.parentNode.offsetWidth + "px"'),M&&n.setExpression("left",M),I&&n.setExpression("top",I);else if(i.centerY)m&&n.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),n.marginTop=0;else if(!i.centerY&&m){var o=i.css&&i.css.top?parseInt(i.css.top,10):0,r="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+o+') + "px"';n.setExpression("top",r)}})}if(v&&(i.theme?_.find(".ui-widget-content").append(v):_.append(v),(v.jquery||v.nodeType)&&e(v).show()),(u||i.forceIframe)&&i.showOverlay&&w.show(),i.fadeIn){var A=i.onBlock?i.onBlock:c,O=i.showOverlay&&!v?A:c,R=v?A:c;i.showOverlay&&C._fadeIn(i.fadeIn,O),v&&_._fadeIn(i.fadeIn,R)}else i.showOverlay&&C.show(),v&&_.show(),i.onBlock&&i.onBlock();if(o(1,t,i),m?(p=_[0],f=e(i.focusableElements,p),i.focusInput&&setTimeout(s,20)):a(_[0],i.centerX,i.centerY),i.timeout){var P=setTimeout(function(){m?e.unblockUI(i):e(t).unblock(i)},i.timeout);e(t).data("blockUI.timeout",P)}}}function n(t,n){var r,s=t==window,a=e(t),l=a.data("blockUI.history"),c=a.data("blockUI.timeout");c&&(clearTimeout(c),a.removeData("blockUI.timeout")),n=e.extend({},e.blockUI.defaults,n||{}),o(0,t,n),null===n.onUnblock&&(n.onUnblock=a.data("blockUI.onUnblock"),a.removeData("blockUI.onUnblock"));var u;u=s?e("body").children().filter(".blockUI").add("body > .blockUI"):a.find(">.blockUI"),n.cursorReset&&(u.length>1&&(u[1].style.cursor=n.cursorReset),u.length>2&&(u[2].style.cursor=n.cursorReset)),s&&(p=f=null),n.fadeOut?(r=u.length,u.stop().fadeOut(n.fadeOut,function(){0===--r&&i(u,l,n,t)})):i(u,l,n,t)}function i(t,n,i,o){var r=e(o);if(!r.data("blockUI.isBlocked")){t.each(function(){this.parentNode&&this.parentNode.removeChild(this)}),n&&n.el&&(n.el.style.display=n.display,n.el.style.position=n.position,n.parent&&n.parent.appendChild(n.el),r.removeData("blockUI.history")),r.data("blockUI.static")&&r.css("position","static"),"function"==typeof i.onUnblock&&i.onUnblock(o,i);var s=e(document.body),a=s.width(),l=s[0].style.width;s.width(a-1).width(a),s[0].style.width=l}}function o(t,n,i){var o=n==window,s=e(n);if((t||(!o||p)&&(o||s.data("blockUI.isBlocked")))&&(s.data("blockUI.isBlocked",t),o&&i.bindEvents&&(!t||i.showOverlay))){var a="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";t?e(document).bind(a,i,r):e(document).unbind(a,r)}}function r(t){if("keydown"===t.type&&t.keyCode&&9==t.keyCode&&p&&t.data.constrainTabKey){var n=f,i=!t.shiftKey&&t.target===n[n.length-1],o=t.shiftKey&&t.target===n[0];if(i||o)return setTimeout(function(){s(o)},10),!1}var r=t.data,a=e(t.target);return a.hasClass("blockOverlay")&&r.onOverlayClick&&r.onOverlayClick(t),a.parents("div."+r.blockMsgClass).length>0?!0:0===a.parents().children().filter("div.blockUI").length}function s(e){if(f){var t=f[e===!0?f.length-1:0];t&&t.focus()}}function a(e,t,n){var i=e.parentNode,o=e.style,r=(i.offsetWidth-e.offsetWidth)/2-l(i,"borderLeftWidth"),s=(i.offsetHeight-e.offsetHeight)/2-l(i,"borderTopWidth");t&&(o.left=r>0?r+"px":"0"),n&&(o.top=s>0?s+"px":"0")}function l(t,n){return parseInt(e.css(t,n),10)||0}e.fn._fadeIn=e.fn.fadeIn;var c=e.noop||function(){},u=/MSIE/.test(navigator.userAgent),d=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),h=(document.documentMode||0,e.isFunction(document.createElement("div").style.setExpression));e.blockUI=function(e){t(window,e)},e.unblockUI=function(e){n(window,e)},e.growlUI=function(t,n,i,o){var r=e('<div class="growlUI"></div>');t&&r.append("<h1>"+t+"</h1>"),n&&r.append("<h2>"+n+"</h2>"),void 0===i&&(i=3e3);var s=function(t){t=t||{},e.blockUI({message:r,fadeIn:"undefined"!=typeof t.fadeIn?t.fadeIn:700,fadeOut:"undefined"!=typeof t.fadeOut?t.fadeOut:1e3,timeout:"undefined"!=typeof t.timeout?t.timeout:i,centerY:!1,showOverlay:!1,onUnblock:o,css:e.blockUI.defaults.growlCSS})};s(),r.css("opacity"),r.mouseover(function(){s({fadeIn:0,timeout:3e4});var t=e(".blockMsg");t.stop(),t.fadeTo(300,1)}).mouseout(function(){e(".blockMsg").fadeOut(1e3)})},e.fn.block=function(n){if(this[0]===window)return e.blockUI(n),this;var i=e.extend({},e.blockUI.defaults,n||{});return this.each(function(){var t=e(this);i.ignoreIfBlocked&&t.data("blockUI.isBlocked")||t.unblock({fadeOut:0})}),this.each(function(){"static"==e.css(this,"position")&&(this.style.position="relative",e(this).data("blockUI.static",!0)),this.style.zoom=1,t(this,n)})},e.fn.unblock=function(t){return this[0]===window?(e.unblockUI(t),this):this.each(function(){n(this,t)})},e.blockUI.version=2.66,e.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var p=null,f=[]}"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],e):e(jQuery)}(),function(e,t){"use strict";function n(e){var t=Array.prototype.slice.call(arguments,1);return e.prop?e.prop.apply(e,t):e.attr.apply(e,t)}function i(e,t,n){var i,o;for(i in n)n.hasOwnProperty(i)&&(o=i.replace(/ |$/g,t.eventNamespace),e.bind(o,n[i]))}function o(e,t,n){i(e,n,{focus:function(){t.addClass(n.focusClass)},blur:function(){t.removeClass(n.focusClass),t.removeClass(n.activeClass)},mouseenter:function(){t.addClass(n.hoverClass)},mouseleave:function(){t.removeClass(n.hoverClass),t.removeClass(n.activeClass)},"mousedown touchbegin":function(){e.is(":disabled")||t.addClass(n.activeClass)},"mouseup touchend":function(){t.removeClass(n.activeClass)}})}function r(e,t){e.removeClass(t.hoverClass+" "+t.focusClass+" "+t.activeClass)}function s(e,t,n){n?e.addClass(t):e.removeClass(t)}function a(e,t,n){var i="checked",o=t.is(":"+i);t.prop?t.prop(i,o):o?t.attr(i,i):t.removeAttr(i),s(e,n.checkedClass,o)}function l(e,t,n){s(e,n.disabledClass,t.is(":disabled"))}function c(e,t,n){switch(n){case"after":return e.after(t),e.next();case"before":return e.before(t),e.prev();case"wrap":return e.wrap(t),e.parent()}return null}function u(t,i,o){var r,s,a;return o||(o={}),o=e.extend({bind:{},divClass:null,divWrap:"wrap",spanClass:null,spanHtml:null,spanWrap:"wrap"},o),r=e("<div />"),s=e("<span />"),i.autoHide&&t.is(":hidden")&&"none"===t.css("display")&&r.hide(),o.divClass&&r.addClass(o.divClass),i.wrapperClass&&r.addClass(i.wrapperClass),o.spanClass&&s.addClass(o.spanClass),a=n(t,"id"),i.useID&&a&&n(r,"id",i.idPrefix+"-"+a),o.spanHtml&&s.html(o.spanHtml),r=c(t,r,o.divWrap),s=c(t,s,o.spanWrap),l(r,t,i),{div:r,span:s}}function d(t,n){var i;return n.wrapperClass?(i=e("<span />").addClass(n.wrapperClass),i=c(t,i,"wrap")):null}function h(){var t,n,i,o;return o="rgb(120,2,153)",n=e('<div style="width:0;height:0;color:'+o+'">'),e("body").append(n),i=n.get(0),t=window.getComputedStyle?window.getComputedStyle(i,"").color:(i.currentStyle||i.style||{}).color,n.remove(),t.replace(/ /g,"")!==o}function p(t){return t?e("<span />").text(t).html():""}function f(){return navigator.cpuClass&&!navigator.product}function g(){return void 0!==window.XMLHttpRequest?!0:!1}function m(e){var t;return e[0].multiple?!0:(t=n(e,"size"),!t||1>=t?!1:!0)}function v(){return!1}function b(e,t){var n="none";i(e,t,{"selectstart dragstart mousedown":v}),e.css({MozUserSelect:n,msUserSelect:n,webkitUserSelect:n,userSelect:n})}function y(e,t,n){var i=e.val();""===i?i=n.fileDefaultHtml:(i=i.split(/[\/\\]+/),i=i[i.length-1]),t.text(i)}function w(e,t,n){var i,o;for(i=[],e.each(function(){var e;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i.push({el:this,name:e,old:this.style[e]}),this.style[e]=t[e])}),n();i.length;)o=i.pop(),o.el.style[o.name]=o.old}function C(e,t){var n;n=e.parents(),n.push(e[0]),n=n.not(":visible"),w(n,{visibility:"hidden",display:"block",position:"absolute"},t)}function _(e,t){return function(){e.unwrap().unwrap().unbind(t.eventNamespace)}}var x=!0,S=!1,k=[{match:function(e){return e.is("a, button, :submit, :reset, input[type='button']")},apply:function(e,t){var s,a,c,d,h;return a=t.submitDefaultHtml,e.is(":reset")&&(a=t.resetDefaultHtml),d=e.is("a, button")?function(){return e.html()||a}:function(){return p(n(e,"value"))||a},c=u(e,t,{divClass:t.buttonClass,spanHtml:d()}),s=c.div,o(e,s,t),h=!1,i(s,t,{"click touchend":function(){var t,i,o,r;h||e.is(":disabled")||(h=!0,e[0].dispatchEvent?(t=document.createEvent("MouseEvents"),t.initEvent("click",!0,!0),i=e[0].dispatchEvent(t),e.is("a")&&i&&(o=n(e,"target"),r=n(e,"href"),o&&"_self"!==o?window.open(r,o):document.location.href=r)):e.click(),h=!1)}}),b(s,t),{remove:function(){return s.after(e),s.remove(),e.unbind(t.eventNamespace),e},update:function(){r(s,t),l(s,e,t),e.detach(),c.span.html(d()).append(e)}}}},{match:function(e){return e.is(":checkbox")},apply:function(e,t){var n,s,c;return n=u(e,t,{divClass:t.checkboxClass}),s=n.div,c=n.span,o(e,s,t),i(e,t,{"click touchend":function(){a(c,e,t)}}),a(c,e,t),{remove:_(e,t),update:function(){r(s,t),c.removeClass(t.checkedClass),a(c,e,t),l(s,e,t)}}}},{match:function(e){return e.is(":file")},apply:function(t,s){function a(){y(t,p,s)}var d,h,p,g;return d=u(t,s,{divClass:s.fileClass,spanClass:s.fileButtonClass,spanHtml:s.fileButtonHtml,spanWrap:"after"}),h=d.div,g=d.span,p=e("<span />").html(s.fileDefaultHtml),p.addClass(s.filenameClass),p=c(t,p,"after"),n(t,"size")||n(t,"size",h.width()/10),o(t,h,s),a(),f()?i(t,s,{click:function(){t.trigger("change"),setTimeout(a,0)}}):i(t,s,{change:a}),b(p,s),b(g,s),{remove:function(){return p.remove(),g.remove(),t.unwrap().unbind(s.eventNamespace)},update:function(){r(h,s),y(t,p,s),l(h,t,s)}}}},{match:function(e){if(e.is("input")){var t=(" "+n(e,"type")+" ").toLowerCase(),i=" color date datetime datetime-local email month number password search tel text time url week ";return i.indexOf(t)>=0}return!1},apply:function(e,t){var i,r;return i=n(e,"type"),e.addClass(t.inputClass),r=d(e,t),o(e,e,t),t.inputAddTypeAsClass&&e.addClass(i),{remove:function(){e.removeClass(t.inputClass),t.inputAddTypeAsClass&&e.removeClass(i),r&&e.unwrap()},update:v}}},{match:function(e){return e.is(":radio")},apply:function(t,s){var c,d,h;return c=u(t,s,{divClass:s.radioClass}),d=c.div,h=c.span,o(t,d,s),i(t,s,{"click touchend":function(){e.uniform.update(e(':radio[name="'+n(t,"name")+'"]'))}}),a(h,t,s),{remove:_(t,s),update:function(){r(d,s),a(h,t,s),l(d,t,s)}}}},{match:function(e){return e.is("select")&&!m(e)?!0:!1},apply:function(t,n){var s,a,c,d;return n.selectAutoWidth&&C(t,function(){d=t.width()}),s=u(t,n,{divClass:n.selectClass,spanHtml:(t.find(":selected:first")||t.find("option:first")).html(),spanWrap:"before"}),a=s.div,c=s.span,n.selectAutoWidth?C(t,function(){w(e([c[0],a[0]]),{display:"block"},function(){var e;e=c.outerWidth()-c.width(),a.width(d+e),c.width(d)})}):a.addClass("fixedWidth"),o(t,a,n),i(t,n,{change:function(){c.html(t.find(":selected").html()),a.removeClass(n.activeClass)},"click touchend":function(){var e=t.find(":selected").html();c.html()!==e&&t.trigger("change")},keyup:function(){c.html(t.find(":selected").html())}}),b(c,n),{remove:function(){return c.remove(),t.unwrap().unbind(n.eventNamespace),t},update:function(){n.selectAutoWidth?(e.uniform.restore(t),t.uniform(n)):(r(a,n),c.html(t.find(":selected").html()),l(a,t,n))}}}},{match:function(e){return e.is("select")&&m(e)?!0:!1},apply:function(e,t){var n;return e.addClass(t.selectMultiClass),n=d(e,t),o(e,e,t),{remove:function(){e.removeClass(t.selectMultiClass),n&&e.unwrap()},update:v}}},{match:function(e){return e.is("textarea")},apply:function(e,t){var n;return e.addClass(t.textareaClass),n=d(e,t),o(e,e,t),{remove:function(){e.removeClass(t.textareaClass),n&&e.unwrap()},update:v}}}];f()&&!g()&&(x=!1),e.uniform={defaults:{activeClass:"active",autoHide:!0,buttonClass:"button",checkboxClass:"checker",checkedClass:"checked",disabledClass:"disabled",eventNamespace:".uniform",fileButtonClass:"action",fileButtonHtml:"Choose File",fileClass:"uploader",fileDefaultHtml:"No file selected",filenameClass:"filename",focusClass:"focus",hoverClass:"hover",idPrefix:"uniform",inputAddTypeAsClass:!0,inputClass:"uniform-input",radioClass:"radio",resetDefaultHtml:"Reset",resetSelector:!1,selectAutoWidth:!0,selectClass:"selector",selectMultiClass:"uniform-multiselect",submitDefaultHtml:"Submit",textareaClass:"uniform",useID:!0,wrapperClass:null},elements:[]},e.fn.uniform=function(t){var n=this;return t=e.extend({},e.uniform.defaults,t),S||(S=!0,h()&&(x=!1)),x?(t.resetSelector&&e(t.resetSelector).mouseup(function(){window.setTimeout(function(){e.uniform.update(n)},10)}),this.each(function(){var n,i,o,r=e(this);if(r.data("uniformed"))return void e.uniform.update(r);for(n=0;k.length>n;n+=1)if(i=k[n],i.match(r,t))return o=i.apply(r,t),r.data("uniformed",o),void e.uniform.elements.push(r.get(0))})):this},e.uniform.restore=e.fn.uniform.restore=function(n){n===t&&(n=e.uniform.elements),e(n).each(function(){var t,n,i=e(this);n=i.data("uniformed"),n&&(n.remove(),t=e.inArray(this,e.uniform.elements),t>=0&&e.uniform.elements.splice(t,1),i.removeData("uniformed"))})},e.uniform.update=e.fn.uniform.update=function(n){n===t&&(n=e.uniform.elements),e(n).each(function(){var t,n=e(this);t=n.data("uniformed"),t&&t.update(n,t.options)})}}(jQuery),function(){var e=[].slice;!function(t,n){"use strict";var i;return i=function(){function e(e,n){null==n&&(n={}),this.$element=t(e),this.options=t.extend({},t.fn.bootstrapSwitch.defaults,n,{state:this.$element.is(":checked"),size:this.$element.data("size"),animate:this.$element.data("animate"),disabled:this.$element.is(":disabled"),readonly:this.$element.is("[readonly]"),onColor:this.$element.data("on-color"),offColor:this.$element.data("off-color"),onText:this.$element.data("on-text"),offText:this.$element.data("off-text"),labelText:this.$element.data("label-text"),baseClass:this.$element.data("base-class"),wrapperClass:this.$element.data("wrapper-class")}),this.$wrapper=t("<div>",{"class":function(e){return function(){var t;return t=[""+e.options.baseClass].concat(e._getClasses(e.options.wrapperClass)),t.push(e.options.state?""+e.options.baseClass+"-on":""+e.options.baseClass+"-off"),null!=e.options.size&&t.push(""+e.options.baseClass+"-"+e.options.size),e.options.animate&&t.push(""+e.options.baseClass+"-animate"),e.options.disabled&&t.push(""+e.options.baseClass+"-disabled"),e.options.readonly&&t.push(""+e.options.baseClass+"-readonly"),e.$element.attr("id")&&t.push(""+e.options.baseClass+"-id-"+e.$element.attr("id")),t.join(" ")}}(this)()}),this.$container=t("<div>",{"class":""+this.options.baseClass+"-container"}),this.$on=t("<span>",{html:this.options.onText,"class":""+this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor
}),this.$off=t("<span>",{html:this.options.offText,"class":""+this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor}),this.$label=t("<label>",{"for":this.$element.attr("id"),html:this.options.labelText,"class":""+this.options.baseClass+"-label"}),this.$element.on("init.bootstrapSwitch",function(t){return function(){return t.options.onInit.apply(e,arguments)}}(this)),this.$element.on("switchChange.bootstrapSwitch",function(t){return function(){return t.options.onSwitchChange.apply(e,arguments)}}(this)),this.$container=this.$element.wrap(this.$container).parent(),this.$wrapper=this.$container.wrap(this.$wrapper).parent(),this.$element.before(this.$on).before(this.$label).before(this.$off).trigger("init.bootstrapSwitch"),this._elementHandlers(),this._handleHandlers(),this._labelHandlers(),this._formHandler()}return e.prototype._constructor=e,e.prototype.state=function(e,t){return"undefined"==typeof e?this.options.state:this.options.disabled||this.options.readonly?this.$element:(e=!!e,this.$element.prop("checked",e).trigger("change.bootstrapSwitch",t),this.$element)},e.prototype.toggleState=function(e){return this.options.disabled||this.options.readonly?this.$element:this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",e)},e.prototype.size=function(e){return"undefined"==typeof e?this.options.size:(null!=this.options.size&&this.$wrapper.removeClass(""+this.options.baseClass+"-"+this.options.size),e&&this.$wrapper.addClass(""+this.options.baseClass+"-"+e),this.options.size=e,this.$element)},e.prototype.animate=function(e){return"undefined"==typeof e?this.options.animate:(e=!!e,this.$wrapper[e?"addClass":"removeClass"](""+this.options.baseClass+"-animate"),this.options.animate=e,this.$element)},e.prototype.disabled=function(e){return"undefined"==typeof e?this.options.disabled:(e=!!e,this.$wrapper[e?"addClass":"removeClass"](""+this.options.baseClass+"-disabled"),this.$element.prop("disabled",e),this.options.disabled=e,this.$element)},e.prototype.toggleDisabled=function(){return this.$element.prop("disabled",!this.options.disabled),this.$wrapper.toggleClass(""+this.options.baseClass+"-disabled"),this.options.disabled=!this.options.disabled,this.$element},e.prototype.readonly=function(e){return"undefined"==typeof e?this.options.readonly:(e=!!e,this.$wrapper[e?"addClass":"removeClass"](""+this.options.baseClass+"-readonly"),this.$element.prop("readonly",e),this.options.readonly=e,this.$element)},e.prototype.toggleReadonly=function(){return this.$element.prop("readonly",!this.options.readonly),this.$wrapper.toggleClass(""+this.options.baseClass+"-readonly"),this.options.readonly=!this.options.readonly,this.$element},e.prototype.onColor=function(e){var t;return t=this.options.onColor,"undefined"==typeof e?t:(null!=t&&this.$on.removeClass(""+this.options.baseClass+"-"+t),this.$on.addClass(""+this.options.baseClass+"-"+e),this.options.onColor=e,this.$element)},e.prototype.offColor=function(e){var t;return t=this.options.offColor,"undefined"==typeof e?t:(null!=t&&this.$off.removeClass(""+this.options.baseClass+"-"+t),this.$off.addClass(""+this.options.baseClass+"-"+e),this.options.offColor=e,this.$element)},e.prototype.onText=function(e){return"undefined"==typeof e?this.options.onText:(this.$on.html(e),this.options.onText=e,this.$element)},e.prototype.offText=function(e){return"undefined"==typeof e?this.options.offText:(this.$off.html(e),this.options.offText=e,this.$element)},e.prototype.labelText=function(e){return"undefined"==typeof e?this.options.labelText:(this.$label.html(e),this.options.labelText=e,this.$element)},e.prototype.baseClass=function(){return this.options.baseClass},e.prototype.wrapperClass=function(e){return"undefined"==typeof e?this.options.wrapperClass:(e||(e=t.fn.bootstrapSwitch.defaults.wrapperClass),this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" ")),this.$wrapper.addClass(this._getClasses(e).join(" ")),this.options.wrapperClass=e,this.$element)},e.prototype.destroy=function(){var e;return e=this.$element.closest("form"),e.length&&e.off("reset.bootstrapSwitch").removeData("bootstrap-switch"),this.$container.children().not(this.$element).remove(),this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch"),this.$element},e.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":function(e){return function(n,i){var o;return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),o=e.$element.is(":checked"),o!==e.options.state?(e.options.state=o,e.$wrapper.removeClass(o?""+e.options.baseClass+"-off":""+e.options.baseClass+"-on").addClass(o?""+e.options.baseClass+"-on":""+e.options.baseClass+"-off"),i?void 0:(e.$element.is(":radio")&&t("[name='"+e.$element.attr("name")+"']").not(e.$element).prop("checked",!1).trigger("change.bootstrapSwitch",!0),e.$element.trigger("switchChange.bootstrapSwitch",[o]))):void 0}}(this),"focus.bootstrapSwitch":function(e){return function(t){return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.$wrapper.addClass(""+e.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(e){return function(t){return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.$wrapper.removeClass(""+e.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(e){return function(t){if(t.which&&!e.options.disabled&&!e.options.readonly)switch(t.which){case 32:return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.toggleState();case 37:return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.state(!1);case 39:return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.state(!0)}}}(this)})},e.prototype._handleHandlers=function(){return this.$on.on("click.bootstrapSwitch",function(e){return function(){return e.state(!1),e.$element.trigger("focus.bootstrapSwitch")}}(this)),this.$off.on("click.bootstrapSwitch",function(e){return function(){return e.state(!0),e.$element.trigger("focus.bootstrapSwitch")}}(this))},e.prototype._labelHandlers=function(){return this.$label.on({"mousemove.bootstrapSwitch touchmove.bootstrapSwitch":function(e){return function(t){var n,i,o,r;return e.drag?(t.preventDefault(),i=t.pageX||t.originalEvent.touches[0].pageX,o=(i-e.$wrapper.offset().left)/e.$wrapper.width()*100,n=25,r=75,n>o?o=n:o>r&&(o=r),e.$container.css("margin-left",""+(o-r)+"%"),e.$element.trigger("focus.bootstrapSwitch")):void 0}}(this),"mousedown.bootstrapSwitch touchstart.bootstrapSwitch":function(e){return function(t){return e.drag||e.options.disabled||e.options.readonly?void 0:(t.preventDefault(),e.drag=!0,e.options.animate&&e.$wrapper.removeClass(""+e.options.baseClass+"-animate"),e.$element.trigger("focus.bootstrapSwitch"))}}(this),"mouseup.bootstrapSwitch touchend.bootstrapSwitch":function(e){return function(t){return e.drag?(t.preventDefault(),e.drag=!1,e.$element.prop("checked",parseInt(e.$container.css("margin-left"),10)>-(e.$container.width()/6)).trigger("change.bootstrapSwitch"),e.$container.css("margin-left",""),e.options.animate?e.$wrapper.addClass(""+e.options.baseClass+"-animate"):void 0):void 0}}(this),"mouseleave.bootstrapSwitch":function(e){return function(){return e.$label.trigger("mouseup.bootstrapSwitch")}}(this)})},e.prototype._formHandler=function(){var e;return e=this.$element.closest("form"),e.data("bootstrap-switch")?void 0:e.on("reset.bootstrapSwitch",function(){return n.setTimeout(function(){return e.find("input").filter(function(){return t(this).data("bootstrap-switch")}).each(function(){return t(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",!0)},e.prototype._getClasses=function(e){var n,i,o,r;if(!t.isArray(e))return[""+this.options.baseClass+"-"+e];for(i=[],o=0,r=e.length;r>o;o++)n=e[o],i.push(""+this.options.baseClass+"-"+n);return i},e}(),t.fn.bootstrapSwitch=function(){var n,o,r;return o=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],r=this,this.each(function(){var e,s;return e=t(this),s=e.data("bootstrap-switch"),s||e.data("bootstrap-switch",s=new i(this,o)),"string"==typeof o?r=s[o].apply(s,n):void 0}),r},t.fn.bootstrapSwitch.Constructor=i,t.fn.bootstrapSwitch.defaults={state:!0,size:null,animate:!0,disabled:!1,readonly:!1,onColor:"primary",offColor:"default",onText:"ON",offText:"OFF",labelText:"&nbsp;",baseClass:"bootstrap-switch",wrapperClass:"wrapper",onInit:function(){},onSwitchChange:function(){}}}(window.jQuery,window)}.call(this),!function(e){"undefined"==typeof e.fn.each2&&e.extend(e.fn,{each2:function(t){for(var n=e([0]),i=-1,o=this.length;++i<o&&(n.context=n[0]=this[i])&&t.call(n[0],i,n)!==!1;);return this}})}(jQuery),function(e,t){"use strict";function n(t){var n=e(document.createTextNode(""));t.before(n),n.before(t),n.remove()}function i(e){var t,n,i,o;if(!e||e.length<1)return e;for(t="",n=0,i=e.length;i>n;n++)o=e.charAt(n),t+=j[o]||o;return t}function o(e,t){for(var n=0,i=t.length;i>n;n+=1)if(s(e,t[n]))return n;return-1}function r(){var t=e(U);t.appendTo("body");var n={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),n}function s(e,n){return e===n?!0:e===t||n===t?!1:null===e||null===n?!1:e.constructor===String?e+""==n+"":n.constructor===String?n+""==e+"":!1}function a(t,n){var i,o,r;if(null===t||t.length<1)return[];for(i=t.split(n),o=0,r=i.length;r>o;o+=1)i[o]=e.trim(i[o]);return i}function l(e){return e.outerWidth(!1)-e.width()}function c(n){var i="keyup-change-value";n.on("keydown",function(){e.data(n,i)===t&&e.data(n,i,n.val())}),n.on("keyup",function(){var o=e.data(n,i);o!==t&&n.val()!==o&&(e.removeData(n,i),n.trigger("keyup-change"))})}function u(n){n.on("mousemove",function(n){var i=F;(i===t||i.x!==n.pageX||i.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function d(e,n,i){i=i||t;var o;return function(){var t=arguments;window.clearTimeout(o),o=window.setTimeout(function(){n.apply(i,t)},e)}}function h(e){var t,n=!1;return function(){return n===!1&&(t=e(),n=!0),t}}function p(e,t){var n=d(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){o(e.target,t.get())>=0&&n(e)})}function f(e){e[0]!==document.activeElement&&window.setTimeout(function(){var t,n=e[0],i=e.val().length;e.focus();var o=n.offsetWidth>0||n.offsetHeight>0;o&&n===document.activeElement&&(n.setSelectionRange?n.setSelectionRange(i,i):n.createTextRange&&(t=n.createTextRange(),t.collapse(!1),t.select()))},0)}function g(t){t=e(t)[0];var n=0,i=0;if("selectionStart"in t)n=t.selectionStart,i=t.selectionEnd-n;else if("selection"in document){t.focus();var o=document.selection.createRange();i=document.selection.createRange().text.length,o.moveStart("character",-t.value.length),n=o.text.length-i}return{offset:n,length:i}}function m(e){e.preventDefault(),e.stopPropagation()}function v(e){e.preventDefault(),e.stopImmediatePropagation()}function b(t){if(!P){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);P=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),P.attr("class","select2-sizer"),e("body").append(P)}return P.text(t.val()),P.width()}function y(t,n,i){var o,r,s=[];o=t.attr("class"),o&&(o=""+o,e(o.split(" ")).each2(function(){0===this.indexOf("select2-")&&s.push(this)})),o=n.attr("class"),o&&(o=""+o,e(o.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(r=i(this),r&&s.push(r))})),t.attr("class",s.join(" "))}function w(e,t,n,o){var r=i(e.toUpperCase()).indexOf(i(t.toUpperCase())),s=t.length;return 0>r?void n.push(o(e)):(n.push(o(e.substring(0,r))),n.push("<span class='select2-match'>"),n.push(o(e.substring(r,r+s))),n.push("</span>"),void n.push(o(e.substring(r+s,e.length))))}function C(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function _(n){var i,o=null,r=n.quietMillis||100,s=n.url,a=this;return function(l){window.clearTimeout(i),i=window.setTimeout(function(){var i=n.data,r=s,c=n.transport||e.fn.select2.ajaxDefaults.transport,u={type:n.type||"GET",cache:n.cache||!1,jsonpCallback:n.jsonpCallback||t,dataType:n.dataType||"json"},d=e.extend({},e.fn.select2.ajaxDefaults.params,u);i=i?i.call(a,l.term,l.page,l.context):null,r="function"==typeof r?r.call(a,l.term,l.page,l.context):r,o&&"function"==typeof o.abort&&o.abort(),n.params&&(e.isFunction(n.params)?e.extend(d,n.params.call(a)):e.extend(d,n.params)),e.extend(d,{url:r,dataType:n.dataType,data:i,success:function(e){var t=n.results(e,l.page);l.callback(t)}}),o=c.call(a,d)},r)}}function x(t){var n,i,o=t,r=function(e){return""+e.text};e.isArray(o)&&(i=o,o={results:i}),e.isFunction(o)===!1&&(i=o,o=function(){return i});var s=o();return s.text&&(r=s.text,e.isFunction(r)||(n=s.text,r=function(e){return e[n]})),function(t){var n,i=t.term,s={results:[]};return""===i?void t.callback(o()):(n=function(o,s){var a,l;if(o=o[0],o.children){a={};for(l in o)o.hasOwnProperty(l)&&(a[l]=o[l]);a.children=[],e(o.children).each2(function(e,t){n(t,a.children)}),(a.children.length||t.matcher(i,r(a),o))&&s.push(a)}else t.matcher(i,r(o),o)&&s.push(o)},e(o().results).each2(function(e,t){n(t,s.results)}),void t.callback(s))}}function S(n){var i=e.isFunction(n);return function(o){var r=o.term,s={results:[]};e(i?n():n).each(function(){var e=this.text!==t,n=e?this.text:this;(""===r||o.matcher(r,n))&&s.results.push(e?this:{id:this,text:this})}),o.callback(s)}}function k(t,n){if(e.isFunction(t))return!0;if(!t)return!1;if("string"==typeof t)return!0;throw new Error(n+" must be a string, function, or falsy value")}function T(t){if(e.isFunction(t)){var n=Array.prototype.slice.call(arguments,1);return t.apply(null,n)}return t}function $(t){var n=0;return e.each(t,function(e,t){t.children?n+=$(t.children):n++}),n}function E(e,n,i,o){var r,a,l,c,u,d=e,h=!1;if(!o.createSearchChoice||!o.tokenSeparators||o.tokenSeparators.length<1)return t;for(;;){for(a=-1,l=0,c=o.tokenSeparators.length;c>l&&(u=o.tokenSeparators[l],a=e.indexOf(u),!(a>=0));l++);if(0>a)break;if(r=e.substring(0,a),e=e.substring(a+u.length),r.length>0&&(r=o.createSearchChoice.call(this,r,n),r!==t&&null!==r&&o.id(r)!==t&&null!==o.id(r))){for(h=!1,l=0,c=n.length;c>l;l++)if(s(o.id(r),o.id(n[l]))){h=!0;break}h||i(r)}}return d!==e?e:void 0}function D(t,n){var i=function(){};return i.prototype=new t,i.prototype.constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,n),i}if(window.Select2===t){var I,M,A,O,R,P,N,L,F={x:0,y:0},I={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case I.LEFT:case I.RIGHT:case I.UP:case I.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case I.SHIFT:case I.CTRL:case I.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},U="<div class='select2-measure-scrollbar'></div>",j={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z"};N=e(document),R=function(){var e=1;return function(){return e++}}(),N.on("mousemove",function(e){F.x=e.pageX,F.y=e.pageY}),M=D(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var i,o,s=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&null!==n.element.data("select2")&&n.element.data("select2").destroy(),this.container=this.createContainer(),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+R()).replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.containerSelector="#"+this.containerId,this.container.attr("id",this.containerId),this.body=h(function(){return n.element.closest("body")}),y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",n.element.attr("style")),this.container.css(T(n.containerCss)),this.container.addClass(T(n.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",m),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(T(n.dropdownCssClass)),this.dropdown.data("select2",this),this.dropdown.on("click",m),this.results=i=this.container.find(s),this.search=o=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",m),u(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",s,this.bind(this.highlightUnderEvent)),this.dropdown.on("touchend",s,this.bind(this.selectHighlighted)),this.dropdown.on("touchmove",s,this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",s,this.bind(this.clearTouchMoved)),p(80,this.results),this.dropdown.on("scroll-debounced",s,this.bind(this.loadMoreIfNeeded)),e(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),e(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),e.fn.mousewheel&&i.mousewheel(function(e,t,n,o){var r=i.scrollTop();o>0&&0>=r-o?(i.scrollTop(0),m(e)):0>o&&i.get(0).scrollHeight-i.scrollTop()+o<=i.height()&&(i.scrollTop(i.get(0).scrollHeight-i.height()),m(e))}),c(o),o.on("keyup-change input paste",this.bind(this.updateResults)),o.on("focus",function(){o.addClass("select2-focused")}),o.on("blur",function(){o.removeClass("select2-focused")}),this.dropdown.on("mouseup",s,this.bind(function(t){e(t.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(t),this.selectHighlighted(t))})),this.dropdown.on("click mouseup mousedown focusin",function(e){e.stopPropagation()}),this.nextSearchTerm=t,e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==n.maximumInputLength&&this.search.attr("maxlength",n.maximumInputLength);var a=n.element.prop("disabled");a===t&&(a=!1),this.enable(!a);var l=n.element.prop("readonly");l===t&&(l=!1),this.readonly(l),L=L||r(),this.autofocus=n.element.prop("autofocus"),n.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",n.searchInputPlaceholder)},destroy:function(){var e=this.opts.element,n=e.data("select2");this.close(),this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),n!==t&&(n.container.remove(),n.liveRegion.remove(),n.dropdown.remove(),e.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:s(e.attr("locked"),"locked")||s(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(n){var i,o,r,l,c=this;if(i=n.element,"select"===i.get(0).tagName.toLowerCase()&&(this.select=o=n.element),o&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(i,o,r){var s,a=this.opts.id,l=this.liveRegion;(s=function(i,o,u){var d,h,p,f,g,m,v,b,y,w;for(i=n.sortResults(i,o,r),d=0,h=i.length;h>d;d+=1)p=i[d],g=p.disabled===!0,f=!g&&a(p)!==t,m=p.children&&p.children.length>0,v=e("<li></li>"),v.addClass("select2-results-dept-"+u),v.addClass("select2-result"),v.addClass(f?"select2-result-selectable":"select2-result-unselectable"),g&&v.addClass("select2-disabled"),m&&v.addClass("select2-result-with-children"),v.addClass(c.opts.formatResultCssClass(p)),v.attr("role","presentation"),b=e(document.createElement("div")),b.addClass("select2-result-label"),b.attr("id","select2-result-label-"+R()),b.attr("role","option"),w=n.formatResult(p,b,r,c.opts.escapeMarkup),w!==t&&(b.html(w),v.append(b)),m&&(y=e("<ul></ul>"),y.addClass("select2-result-sub"),s(p.children,y,u+1),v.append(y)),v.data("select2-data",p),o.append(v);l.text(n.formatMatches(i.length))})(o,i,0)}},e.fn.select2.defaults,n),"function"!=typeof n.id&&(r=n.id,n.id=function(e){return e[r]}),e.isArray(n.element.data("select2Tags"))){if("tags"in n)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+n.element.attr("id");n.tags=n.element.data("select2Tags")}if(o?(n.query=this.bind(function(e){var n,o,r,s={results:[],more:!1},a=e.term;r=function(t,n){var i;t.is("option")?e.matcher(a,t.text(),t)&&n.push(c.optionToData(t)):t.is("optgroup")&&(i=c.optionToData(t),t.children().each2(function(e,t){r(t,i.children)}),i.children.length>0&&n.push(i))},n=i.children(),this.getPlaceholder()!==t&&n.length>0&&(o=this.getPlaceholderOption(),o&&(n=n.not(o))),n.each2(function(e,t){r(t,s.results)}),e.callback(s)}),n.id=function(e){return e.id}):"query"in n||("ajax"in n?(l=n.element.data("ajax-url"),l&&l.length>0&&(n.ajax.url=l),n.query=_.call(n.element,n.ajax)):"data"in n?n.query=x(n.data):"tags"in n&&(n.query=S(n.tags),n.createSearchChoice===t&&(n.createSearchChoice=function(t){return{id:e.trim(t),text:e.trim(t)}}),n.initSelection===t&&(n.initSelection=function(t,i){var o=[];e(a(t.val(),n.separator)).each(function(){var t={id:this,text:this},i=n.tags;e.isFunction(i)&&(i=i()),e(i).each(function(){return s(this.id,t.id)?(t=this,!1):void 0}),o.push(t)}),i(o)}))),"function"!=typeof n.query)throw"query function not defined for Select2 "+n.element.attr("id");if("top"===n.createSearchChoicePosition)n.createSearchChoicePosition=function(e,t){e.unshift(t)};else if("bottom"===n.createSearchChoicePosition)n.createSearchChoicePosition=function(e,t){e.push(t)};else if("function"!=typeof n.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return n},monitorSource:function(){var e,n,i=this.opts.element;i.on("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),e=this.bind(function(){var e=i.prop("disabled");e===t&&(e=!1),this.enable(!e);var n=i.prop("readonly");n===t&&(n=!1),this.readonly(n),y(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(T(this.opts.containerCssClass)),y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(T(this.opts.dropdownCssClass))}),i.on("propertychange.select2",e),this.mutationCallback===t&&(this.mutationCallback=function(t){t.forEach(e)}),n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n!==t&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new n(this.mutationCallback),this.propertyObserver.observe(i.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(t){var n=e.Event("select2-selecting",{val:this.id(t),object:t});return this.opts.element.trigger(n),!n.isDefaultPrevented()},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){e===t&&(e=!0),this._enabled!==e&&(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(e){e===t&&(e=!1),this._readonly!==e&&(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface())},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,n,i,o,r,s=this.dropdown,a=this.container.offset(),l=this.container.outerHeight(!1),c=this.container.outerWidth(!1),u=s.outerHeight(!1),d=e(window),h=d.width(),p=d.height(),f=d.scrollLeft()+h,g=d.scrollTop()+p,m=a.top+l,v=a.left,b=g>=m+u,y=a.top-u>=d.scrollTop(),w=s.outerWidth(!1),C=f>=v+w,_=s.hasClass("select2-drop-above");_?(n=!0,!y&&b&&(i=!0,n=!1)):(n=!1,!b&&y&&(i=!0,n=!0)),i&&(s.hide(),a=this.container.offset(),l=this.container.outerHeight(!1),c=this.container.outerWidth(!1),u=s.outerHeight(!1),f=d.scrollLeft()+h,g=d.scrollTop()+p,m=a.top+l,v=a.left,w=s.outerWidth(!1),C=f>=v+w,s.show()),this.opts.dropdownAutoWidth?(r=e(".select2-results",s)[0],s.addClass("select2-drop-auto-width"),s.css("width",""),w=s.outerWidth(!1)+(r.scrollHeight===r.clientHeight?0:L.width),w>c?c=w:w=c,C=f>=v+w):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(t=this.body().offset(),m-=t.top,v-=t.left),C||(v=a.left+this.container.outerWidth(!1)-w),
o={left:v,width:c},n?(o.top=a.top-u,o.bottom="auto",this.container.addClass("select2-drop-above"),s.addClass("select2-drop-above")):(o.top=m,o.bottom="auto",this.container.removeClass("select2-drop-above"),s.removeClass("select2-drop-above")),o=e.extend(o,T(this.opts.dropdownCss)),s.css(o)},shouldOpen:function(){var t;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(t=e.Event("select2-opening"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){var t,i=this.containerId,o="scroll."+i,r="resize."+i,s="orientationchange."+i;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),t=e("#select2-drop-mask"),0==t.length&&(t=e(document.createElement("div")),t.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),t.hide(),t.appendTo(this.body()),t.on("mousedown touchstart click",function(i){n(t);var o,r=e("#select2-drop");r.length>0&&(o=r.data("select2"),o.opts.selectOnBlur&&o.selectHighlighted({noFocus:!0}),o.close(),i.preventDefault(),i.stopPropagation())})),this.dropdown.prev()[0]!==t[0]&&this.dropdown.before(t),e("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),t.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var a=this;this.container.parents().add(window).each(function(){e(this).on(r+" "+o+" "+s,function(){a.positionDropdown()})})},close:function(){if(this.opened()){var t=this.containerId,n="scroll."+t,i="resize."+t,o="orientationchange."+t;this.container.parents().add(window).each(function(){e(this).off(n).off(i).off(o)}),this.clearDropdownAlignmentPreference(),e("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return T(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var t,n,i,o,r,s,a,l=this.results;if(n=this.highlight(),!(0>n)){if(0==n)return void l.scrollTop(0);t=this.findHighlightableChoices().find(".select2-result-label"),i=e(t[n]),o=i.offset().top+i.outerHeight(!0),n===t.length-1&&(a=l.find("li.select2-more-results"),a.length>0&&(o=a.offset().top+a.outerHeight(!0))),r=l.offset().top+l.outerHeight(!0),o>r&&l.scrollTop(l.scrollTop()+(o-r)),s=i.offset().top-l.offset().top,0>s&&"none"!=i.css("display")&&l.scrollTop(l.scrollTop()+s)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)")},moveHighlight:function(t){for(var n=this.findHighlightableChoices(),i=this.highlight();i>-1&&i<n.length;){i+=t;var o=e(n[i]);if(o.hasClass("select2-result-selectable")&&!o.hasClass("select2-disabled")&&!o.hasClass("select2-selected")){this.highlight(i);break}}},highlight:function(t){var n,i,r=this.findHighlightableChoices();return 0===arguments.length?o(r.filter(".select2-highlighted")[0],r.get()):(t>=r.length&&(t=r.length-1),0>t&&(t=0),this.removeHighlight(),n=e(r[t]),n.addClass("select2-highlighted"),this.search.attr("aria-activedescendant",n.find(".select2-result-label").attr("id")),this.ensureHighlightVisible(),this.liveRegion.text(n.text()),i=n.data("select2-data"),void(i&&this.opts.element.trigger({type:"select2-highlight",val:this.id(i),choice:i})))},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var i=this.findHighlightableChoices();this.highlight(i.index(n))}else 0==n.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var e,t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,o=this,r=this.search.val(),s=this.context;0!==n.length&&(e=n.offset().top-t.offset().top-t.height(),e<=this.opts.loadMorePadding&&(n.addClass("select2-active"),this.opts.query({element:this.opts.element,term:r,page:i,context:s,matcher:this.opts.matcher,callback:this.bind(function(e){o.opened()&&(o.opts.populateResults.call(this,t,e.results,{term:r,page:i,context:s}),o.postprocessResults(e,!1,!1),e.more===!0?(n.detach().appendTo(t).text(T(o.opts.formatLoadMore,i+1)),window.setTimeout(function(){o.loadMoreIfNeeded()},10)):n.remove(),o.positionDropdown(),o.resultsPage=i,o.context=e.context,this.opts.element.trigger({type:"select2-loaded",items:e}))})})))},tokenize:function(){},updateResults:function(n){function i(){c.removeClass("select2-active"),h.positionDropdown(),h.liveRegion.text(u.find(".select2-no-results,.select2-selection-limit,.select2-searching").length?u.text():h.opts.formatMatches(u.find(".select2-result-selectable").length))}function o(e){u.html(e),i()}var r,a,l,c=this.search,u=this.results,d=this.opts,h=this,p=c.val(),f=e.data(this.container,"select2-last-term");if((n===!0||!f||!s(p,f))&&(e.data(this.container,"select2-last-term",p),n===!0||this.showSearchInput!==!1&&this.opened())){l=++this.queryCount;var g=this.getMaximumSelectionSize();if(g>=1&&(r=this.data(),e.isArray(r)&&r.length>=g&&k(d.formatSelectionTooBig,"formatSelectionTooBig")))return void o("<li class='select2-selection-limit'>"+T(d.formatSelectionTooBig,g)+"</li>");if(c.val().length<d.minimumInputLength)return o(k(d.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+T(d.formatInputTooShort,c.val(),d.minimumInputLength)+"</li>":""),void(n&&this.showSearch&&this.showSearch(!0));if(d.maximumInputLength&&c.val().length>d.maximumInputLength)return void o(k(d.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+T(d.formatInputTooLong,c.val(),d.maximumInputLength)+"</li>":"");d.formatSearching&&0===this.findHighlightableChoices().length&&o("<li class='select2-searching'>"+T(d.formatSearching)+"</li>"),c.addClass("select2-active"),this.removeHighlight(),a=this.tokenize(),a!=t&&null!=a&&c.val(a),this.resultsPage=1,d.query({element:d.element,term:c.val(),page:this.resultsPage,context:null,matcher:d.matcher,callback:this.bind(function(r){var a;if(l==this.queryCount){if(!this.opened())return void this.search.removeClass("select2-active");if(this.context=r.context===t?null:r.context,this.opts.createSearchChoice&&""!==c.val()&&(a=this.opts.createSearchChoice.call(h,c.val(),r.results),a!==t&&null!==a&&h.id(a)!==t&&null!==h.id(a)&&0===e(r.results).filter(function(){return s(h.id(this),h.id(a))}).length&&this.opts.createSearchChoicePosition(r.results,a)),0===r.results.length&&k(d.formatNoMatches,"formatNoMatches"))return void o("<li class='select2-no-results'>"+T(d.formatNoMatches,c.val())+"</li>");u.empty(),h.opts.populateResults.call(this,u,r.results,{term:c.val(),page:this.resultsPage,context:null}),r.more===!0&&k(d.formatLoadMore,"formatLoadMore")&&(u.append("<li class='select2-more-results'>"+h.opts.escapeMarkup(T(d.formatLoadMore,this.resultsPage))+"</li>"),window.setTimeout(function(){h.loadMoreIfNeeded()},10)),this.postprocessResults(r,n),i(),this.opts.element.trigger({type:"select2-loaded",items:r})}})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){f(this.search)},selectHighlighted:function(e){if(this._touchMoved)return void this.clearTouchMoved();var t=this.highlight(),n=this.results.find(".select2-highlighted"),i=n.closest(".select2-result").data("select2-data");i?(this.highlight(t),this.onSelect(i,e)):e&&e.noFocus&&this.close()},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==t?e.text():t)},getPlaceholderOption:function(){if(this.select){var e=this.select.children("option").first();if(this.opts.placeholderOption!==t)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===e.text()&&""===e.val())return e}},initContainerWidth:function(){function n(){var n,i,o,r,s,a;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(n=this.opts.element.attr("style"),n!==t)for(i=n.split(";"),r=0,s=i.length;s>r;r+=1)if(a=i[r].replace(/\s/g,""),o=a.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==o&&o.length>=1)return o[1];return"resolve"===this.opts.width?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var i=n.call(this);null!==i&&this.container.css("width",i)}}),A=D(M,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""));return t},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var n,i,o;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),n=this.search.get(0),n.createTextRange?(i=n.createTextRange(),i.collapse(!1),i.select()):n.setSelectionRange&&(o=this.search.val().length,n.setSelectionRange(o,o)),""===this.search.val()&&this.nextSearchTerm!=t&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){e("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,i,o=this.container,r=this.dropdown,s=R();this.showSearch(this.opts.minimumResultsForSearch<0?!1:!0),this.selection=t=o.find(".select2-choice"),this.focusser=o.find(".select2-focusser"),t.find(".select2-chosen").attr("id","select2-chosen-"+s),this.focusser.attr("aria-labelledby","select2-chosen-"+s),this.results.attr("id","select2-results-"+s),this.search.attr("aria-owns","select2-results-"+s),this.focusser.attr("id","s2id_autogen"+s),i=e("label[for='"+this.opts.element.attr("id")+"']"),this.focusser.prev().text(i.text()).attr("for",this.focusser.attr("id"));var a=this.opts.element.attr("title");this.opts.element.attr("title",a||i.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text(e("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){if(e.which===I.PAGE_UP||e.which===I.PAGE_DOWN)return void m(e);switch(e.which){case I.UP:case I.DOWN:return this.moveHighlight(e.which===I.UP?-1:1),void m(e);case I.ENTER:return this.selectHighlighted(),void m(e);case I.TAB:return void this.selectHighlighted({noFocus:!0});case I.ESC:return this.cancel(e),void m(e)}}})),this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==I.TAB&&!I.isControl(e)&&!I.isFunctionKey(e)&&e.which!==I.ESC){if(this.opts.openOnEnter===!1&&e.which===I.ENTER)return void m(e);if(e.which==I.DOWN||e.which==I.UP||e.which==I.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void m(e)}return e.which==I.DELETE||e.which==I.BACKSPACE?(this.opts.allowClear&&this.clear(),void m(e)):void 0}})),c(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),t.on("mousedown touchstart","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),v(e),this.close(),this.selection.focus())})),t.on("mousedown touchstart",this.bind(function(i){n(t),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),m(i)})),r.on("mousedown touchstart",this.bind(function(){this.search.focus()})),t.on("focus",this.bind(function(e){m(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(e.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(t){var n=this.selection.data("select2-data");if(n){var i=e.Event("select2-clearing");if(this.opts.element.trigger(i),i.isDefaultPrevented())return;var o=this.getPlaceholderOption();this.opts.element.val(o?o.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),t!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(n),choice:n}),this.triggerChange({removed:n}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.setPlaceholder(),e.nextSearchTerm=e.opts.nextSearchTerm(n,e.search.val()))})}},isPlaceholderOptionSelected:function(){var e;return this.getPlaceholder()?(e=this.getPlaceholderOption())!==t&&e.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===t||null===this.opts.element.val():!1},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=e.find("option").filter(function(){return this.selected&&!this.disabled});t(n.optionToData(i))}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var o=n.val(),r=null;t.query({matcher:function(e,n,i){var a=s(o,t.id(i));return a&&(r=i),a},callback:e.isFunction(i)?function(){i(r)}:e.noop})}),t},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===t?t:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==t){if(this.select&&this.getPlaceholderOption()===t)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,n){var i=0,o=this;if(this.findHighlightableChoices().each2(function(e,t){return s(o.id(t.data("select2-data")),o.opts.element.val())?(i=e,!1):void 0}),n!==!1&&this.highlight(t===!0&&i>=0?i:0),t===!0){var r=this.opts.minimumResultsForSearch;r>=0&&this.showSearch($(e.results)>=r)}},showSearch:function(t){this.showSearchInput!==t&&(this.showSearchInput=t,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!t),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!t),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",t))},onSelect:function(e,t){if(this.triggerSelect(e)){var n=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.nextSearchTerm=this.opts.nextSearchTerm(e,this.search.val()),this.close(),t&&t.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),s(n,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var n,i,o=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),o.empty(),null!==e&&(n=this.opts.formatSelection(e,o,this.opts.escapeMarkup)),n!==t&&o.append(n),i=this.opts.formatSelectionCssClass(e,o),i!==t&&o.addClass(i),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.container.addClass("select2-allowclear")},val:function(){var e,n=!1,i=null,o=this,r=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],arguments.length>1&&(n=arguments[1]),this.select)this.select.val(e).find("option").filter(function(){return this.selected}).each2(function(e,t){return i=o.optionToData(t),!1}),this.updateSelection(i),this.setPlaceholder(),n&&this.triggerChange({added:i,removed:r});else{if(!e&&0!==e)return void this.clear(n);if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){o.opts.element.val(e?o.id(e):""),o.updateSelection(e),o.setPlaceholder(),n&&o.triggerChange({added:e,removed:r})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e){var n,i=!1;return 0===arguments.length?(n=this.selection.data("select2-data"),n==t&&(n=null),n):(arguments.length>1&&(i=arguments[1]),void(e?(n=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),i&&this.triggerChange({added:e,removed:n})):this.clear(i)))}}),O=D(M,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=[];e.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(e,t){i.push(n.optionToData(t))}),t(i)}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var o=a(n.val(),t.separator),r=[];t.query({matcher:function(n,i,a){var l=e.grep(o,function(e){return s(e,t.id(a))}).length;return l&&r.push(a),l},callback:e.isFunction(i)?function(){for(var e=[],n=0;n<o.length;n++)for(var a=o[n],l=0;l<r.length;l++){var c=r[l];if(s(a,t.id(c))){e.push(c),r.splice(l,1);break}}i(e)}:e.noop})}),t},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},destroy:function(){e("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var t,n=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(n);var i=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(){i.search[0].focus(),i.selectChoice(e(this))}),this.search.attr("id","s2id_autogen"+R()),this.search.prev().text(e("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var n=t.find(".select2-search-choice-focus"),i=n.prev(".select2-search-choice:not(.select2-locked)"),o=n.next(".select2-search-choice:not(.select2-locked)"),r=g(this.search);if(n.length&&(e.which==I.LEFT||e.which==I.RIGHT||e.which==I.BACKSPACE||e.which==I.DELETE||e.which==I.ENTER)){var s=n;return e.which==I.LEFT&&i.length?s=i:e.which==I.RIGHT?s=o.length?o:null:e.which===I.BACKSPACE?this.unselect(n.first())&&(this.search.width(10),s=i.length?i:o):e.which==I.DELETE?this.unselect(n.first())&&(this.search.width(10),s=o.length?o:null):e.which==I.ENTER&&(s=null),this.selectChoice(s),m(e),void(s&&s.length||this.open())}if((e.which===I.BACKSPACE&&1==this.keydowns||e.which==I.LEFT)&&0==r.offset&&!r.length)return this.selectChoice(t.find(".select2-search-choice:not(.select2-locked)").last()),void m(e);if(this.selectChoice(null),this.opened())switch(e.which){case I.UP:case I.DOWN:return this.moveHighlight(e.which===I.UP?-1:1),void m(e);case I.ENTER:return this.selectHighlighted(),void m(e);case I.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case I.ESC:return this.cancel(e),void m(e)}if(e.which!==I.TAB&&!I.isControl(e)&&!I.isFunctionKey(e)&&e.which!==I.BACKSPACE&&e.which!==I.ESC){if(e.which===I.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),(e.which===I.PAGE_UP||e.which===I.PAGE_DOWN)&&m(e),e.which===I.ENTER&&m(e)}}})),this.search.on("keyup",this.bind(function(){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(t){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),t.stopImmediatePropagation(),this.opts.element.trigger(e.Event("select2-blur"))})),this.container.on("click",n,this.bind(function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),this.focusSearch(),t.preventDefault()))})),this.container.on("focus",n,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),n=this.getMaxSearchWidth();e!==t&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width(n>0?n:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),""===this.search.val()&&this.nextSearchTerm!=t&&(this.search.val(this.nextSearchTerm),this.search.select()),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],i=[],r=this;e(t).each(function(){o(r.id(this),n)<0&&(n.push(r.id(this)),i.push(this))}),t=i,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){r.addSelectedChoice(this)}),r.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts),null!=e&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,n){this.triggerSelect(e)&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),this.nextSearchTerm=this.opts.nextSearchTerm(e,this.search.val()),this.clearSearch(),this.updateResults(),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(e,!1,this.opts.closeOnSelect===!0),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.nextSearchTerm!=t&&(this.search.val(this.nextSearchTerm),this.updateResults(),this.search.select()),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),n&&n.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(n){var i,o,r=!n.locked,s=e("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),a=e("<li class='select2-search-choice select2-locked'><div></div></li>"),l=r?s:a,c=this.id(n),u=this.getVal();i=this.opts.formatSelection(n,l.find("div"),this.opts.escapeMarkup),i!=t&&l.find("div").replaceWith("<div>"+i+"</div>"),o=this.opts.formatSelectionCssClass(n,l.find("div")),o!=t&&l.addClass(o),r&&l.find(".select2-search-choice-close").on("mousedown",m).on("click dblclick",this.bind(function(t){this.isInterfaceEnabled()&&(this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),m(t),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),l.data("select2-data",n),l.insertBefore(this.searchContainer),u.push(c),this.setVal(u)},unselect:function(t){var n,i,r=this.getVal();if(t=t.closest(".select2-search-choice"),0===t.length)throw"Invalid argument: "+t+". Must be .select2-search-choice";if(n=t.data("select2-data")){var s=e.Event("select2-removing");if(s.val=this.id(n),s.choice=n,this.opts.element.trigger(s),s.isDefaultPrevented())return!1;for(;(i=o(this.id(n),r))>=0;)r.splice(i,1),this.setVal(r),this.select&&this.postprocessResults();return t.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(n),choice:n}),this.triggerChange({removed:n}),!0}},postprocessResults:function(e,t,n){var i=this.getVal(),r=this.results.find(".select2-result"),s=this.results.find(".select2-result-with-children"),a=this;r.each2(function(e,t){var n=a.id(t.data("select2-data"));o(n,i)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),s.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&n!==!1&&a.highlight(0),!this.opts.createSearchChoice&&!r.filter(".select2-result:not(.select2-selected)").length>0&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&k(a.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+T(a.opts.formatNoMatches,a.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-l(this.search)},resizeSearch:function(){var e,t,n,i,o,r=l(this.search);e=b(this.search)+10,t=this.search.offset().left,n=this.selection.width(),i=this.selection.offset().left,o=n-(t-i)-r,e>o&&(o=n-r),40>o&&(o=n-r),0>=o&&(o=e),this.search.width(Math.floor(o))},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),a(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){o(this,n)<0&&n.push(this)}),this.opts.element.val(0===n.length?"":n.join(this.opts.separator)))},buildChangeDetails:function(e,t){for(var t=t.slice(0),e=e.slice(0),n=0;n<t.length;n++)for(var i=0;i<e.length;i++)s(this.opts.id(t[n]),this.opts.id(e[i]))&&(t.splice(n,1),n>0&&n--,e.splice(i,1),i--);return{added:t,removed:e}},val:function(n,i){var o,r=this;if(0===arguments.length)return this.getVal();if(o=this.data(),o.length||(o=[]),!n&&0!==n)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(i&&this.triggerChange({added:this.data(),removed:o}));if(this.setVal(n),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),i&&this.triggerChange(this.buildChangeDetails(o,this.data()));else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e.map(t,r.id);r.setVal(n),r.updateSelection(t),r.clearSearch(),i&&r.triggerChange(r.buildChangeDetails(o,r.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),
this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t,n){var i,o,r=this;return 0===arguments.length?this.selection.children(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get():(o=this.data(),t||(t=[]),i=e.map(t,function(e){return r.opts.id(e)}),this.setVal(i),this.updateSelection(t),this.clearSearch(),void(n&&this.triggerChange(this.buildChangeDetails(o,this.data()))))}}),e.fn.select2=function(){var n,i,r,s,a,l=Array.prototype.slice.call(arguments,0),c=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],u=["opened","isFocused","container","dropdown"],d=["val","data"],h={search:"externalSearch"};return this.each(function(){if(0===l.length||"object"==typeof l[0])n=0===l.length?{}:e.extend({},l[0]),n.element=e(this),"select"===n.element.get(0).tagName.toLowerCase()?a=n.element.prop("multiple"):(a=n.multiple||!1,"tags"in n&&(n.multiple=a=!0)),i=a?new window.Select2["class"].multi:new window.Select2["class"].single,i.init(n);else{if("string"!=typeof l[0])throw"Invalid arguments to select2 plugin: "+l;if(o(l[0],c)<0)throw"Unknown method: "+l[0];if(s=t,i=e(this).data("select2"),i===t)return;if(r=l[0],"container"===r?s=i.container:"dropdown"===r?s=i.dropdown:(h[r]&&(r=h[r]),s=i[r].apply(i,l.slice(1))),o(l[0],u)>=0||o(l[0],d)&&1==l.length)return!1}}),s===t?this:s},e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,i){var o=[];return w(e.text,n.term,o,i),o.join("")},formatSelection:function(e,n,i){return e?i(e.text):t},sortResults:function(e){return e},formatResultCssClass:function(e){return e.css},formatSelectionCssClass:function(){return t},formatMatches:function(e){return e+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" or more character"+(1==n?"":"s")},formatInputTooLong:function(e,t){var n=e.length-t;return"Please delete "+n+" character"+(1==n?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results…"},formatSearching:function(){return"Searching…"},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==t?null:e.id},matcher:function(e,t){return i(""+t).toUpperCase().indexOf(i(""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:E,escapeMarkup:C,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(){return null},nextSearchTerm:function(){return t},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(e){return e.opts.minimumResultsForSearch<0?!1:!0}},e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:_,local:x,tags:S},util:{debounce:d,markMatch:w,escapeMarkup:C,stripDiacritics:i},"class":{"abstract":M,single:A,multi:O}}}}(jQuery),function(e,t,n){var i=function(i){function o(e){var t,n,r={};i.each(e,function(i){(t=i.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(t[1]+" ")&&(n=i.replace(t[0],t[2].toLowerCase()),r[n]=i,"o"===t[1]&&o(e[i]))}),e._hungarianMap=r}function r(e,t,s){e._hungarianMap||o(e);var a;i.each(t,function(o){a=e._hungarianMap[o],a===n||!s&&t[a]!==n||("o"===a.charAt(0)?(t[a]||(t[a]={}),i.extend(!0,t[a],t[o]),r(e[a],t[a],s)):t[a]=t[o])})}function s(e){var t=qe.defaults.oLanguage,n=e.sZeroRecords;!e.sEmptyTable&&n&&"No data available in table"===t.sEmptyTable&&Pe(e,e,"sZeroRecords","sEmptyTable"),!e.sLoadingRecords&&n&&"Loading..."===t.sLoadingRecords&&Pe(e,e,"sZeroRecords","sLoadingRecords"),e.sInfoThousands&&(e.sThousands=e.sInfoThousands),(e=e.sDecimal)&&Ve(e)}function a(e){if(pt(e,"ordering","bSort"),pt(e,"orderMulti","bSortMulti"),pt(e,"orderClasses","bSortClasses"),pt(e,"orderCellsTop","bSortCellsTop"),pt(e,"order","aaSorting"),pt(e,"orderFixed","aaSortingFixed"),pt(e,"paging","bPaginate"),pt(e,"pagingType","sPaginationType"),pt(e,"pageLength","iDisplayLength"),pt(e,"searching","bFilter"),e=e.aoSearchCols)for(var t=0,n=e.length;n>t;t++)e[t]&&r(qe.models.oSearch,e[t])}function l(e){pt(e,"orderable","bSortable"),pt(e,"orderData","aDataSort"),pt(e,"orderSequence","asSorting"),pt(e,"orderDataType","sortDataType")}function c(e){var e=e.oBrowser,t=i("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(i("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(i('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),n=t.find(".test");e.bScrollOversize=100===n[0].offsetWidth,e.bScrollbarLeft=1!==n.offset().left,t.remove()}function u(e,t,i,o,r,s){var a,l=!1;for(i!==n&&(a=i,l=!0);o!==r;)e.hasOwnProperty(o)&&(a=l?t(a,e[o],o,e):e[o],l=!0,o+=s);return a}function d(e,n){var o=qe.defaults.column,r=e.aoColumns.length,o=i.extend({},qe.models.oColumn,o,{nTh:n?n:t.createElement("th"),sTitle:o.sTitle?o.sTitle:n?n.innerHTML:"",aDataSort:o.aDataSort?o.aDataSort:[r],mData:o.mData?o.mData:r,idx:r});e.aoColumns.push(o),o=e.aoPreSearchCols,o[r]=i.extend({},qe.models.oSearch,o[r]),h(e,r,null)}function h(e,t,o){var t=e.aoColumns[t],s=e.oClasses,a=i(t.nTh);if(!t.sWidthOrig){t.sWidthOrig=a.attr("width")||null;var c=(a.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);c&&(t.sWidthOrig=c[1])}o!==n&&null!==o&&(l(o),r(qe.defaults.column,o),o.mDataProp!==n&&!o.mData&&(o.mData=o.mDataProp),o.sType&&(t._sManualType=o.sType),o.className&&!o.sClass&&(o.sClass=o.className),i.extend(t,o),Pe(t,o,"sWidth","sWidthOrig"),"number"==typeof o.iDataSort&&(t.aDataSort=[o.iDataSort]),Pe(t,o,"aDataSort"));var u=t.mData,d=k(u),h=t.mRender?k(t.mRender):null,o=function(e){return"string"==typeof e&&-1!==e.indexOf("@")};t._bAttrSrc=i.isPlainObject(u)&&(o(u.sort)||o(u.type)||o(u.filter)),t.fnGetData=function(e,t,i){var o=d(e,t,n,i);return h&&t?h(o,t,e,i):o},t.fnSetData=function(e,t,n){return T(u)(e,t,n)},e.oFeatures.bSort||(t.bSortable=!1,a.addClass(s.sSortableNone)),e=-1!==i.inArray("asc",t.asSorting),o=-1!==i.inArray("desc",t.asSorting),t.bSortable&&(e||o)?e&&!o?(t.sSortingClass=s.sSortableAsc,t.sSortingClassJUI=s.sSortJUIAscAllowed):!e&&o?(t.sSortingClass=s.sSortableDesc,t.sSortingClassJUI=s.sSortJUIDescAllowed):(t.sSortingClass=s.sSortable,t.sSortingClassJUI=s.sSortJUI):(t.sSortingClass=s.sSortableNone,t.sSortingClassJUI="")}function p(e){if(!1!==e.oFeatures.bAutoWidth){var t=e.aoColumns;me(e);for(var n=0,i=t.length;i>n;n++)t[n].nTh.style.width=t[n].sWidth}t=e.oScroll,(""!==t.sY||""!==t.sX)&&fe(e),Ue(e,null,"column-sizing",[e])}function f(e,t){var n=v(e,"bVisible");return"number"==typeof n[t]?n[t]:null}function g(e,t){var n=v(e,"bVisible"),n=i.inArray(t,n);return-1!==n?n:null}function m(e){return v(e,"bVisible").length}function v(e,t){var n=[];return i.map(e.aoColumns,function(e,i){e[t]&&n.push(i)}),n}function b(e){var t,i,o,r,s,a,l,c,u,d=e.aoColumns,h=e.aoData,p=qe.ext.type.detect;for(t=0,i=d.length;i>t;t++)if(l=d[t],u=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){for(o=0,r=p.length;r>o;o++){for(s=0,a=h.length;a>s&&(u[s]===n&&(u[s]=_(e,s,t,"type")),c=p[o](u[s],e),!(!c||"html"===c));s++);if(c){l.sType=c;break}}l.sType||(l.sType="string")}}function y(e,t,o,r){var s,a,l,c,u,h,p=e.aoColumns;if(t)for(s=t.length-1;s>=0;s--){h=t[s];var f=h.targets!==n?h.targets:h.aTargets;for(i.isArray(f)||(f=[f]),a=0,l=f.length;l>a;a++)if("number"==typeof f[a]&&0<=f[a]){for(;p.length<=f[a];)d(e);r(f[a],h)}else if("number"==typeof f[a]&&0>f[a])r(p.length+f[a],h);else if("string"==typeof f[a])for(c=0,u=p.length;u>c;c++)("_all"==f[a]||i(p[c].nTh).hasClass(f[a]))&&r(c,h)}if(o)for(s=0,e=o.length;e>s;s++)r(s,o[s])}function w(e,t,n,o){var r=e.aoData.length,s=i.extend(!0,{},qe.models.oRow,{src:n?"dom":"data"});s._aData=t,e.aoData.push(s);for(var t=e.aoColumns,s=0,a=t.length;a>s;s++)n&&x(e,r,s,_(e,r,s)),t[s].sType=null;return e.aiDisplayMaster.push(r),(n||!e.oFeatures.bDeferRender)&&A(e,r,n,o),r}function C(e,t){var n;return t instanceof i||(t=i(t)),t.map(function(t,i){return n=M(e,i),w(e,n.data,i,n.cells)})}function _(e,t,i,o){var r=e.iDraw,s=e.aoColumns[i],a=e.aoData[t]._aData,l=s.sDefaultContent,i=s.fnGetData(a,o,{settings:e,row:t,col:i});if(i===n)return e.iDrawError!=r&&null===l&&(Re(e,0,"Requested unknown parameter "+("function"==typeof s.mData?"{function}":"'"+s.mData+"'")+" for row "+t,4),e.iDrawError=r),l;if(i!==a&&null!==i||null===l){if("function"==typeof i)return i.call(a)}else i=l;return null===i&&"display"==o?"":i}function x(e,t,n,i){e.aoColumns[n].fnSetData(e.aoData[t]._aData,i,{settings:e,row:t,col:n})}function S(e){return i.map(e.match(/(\\.|[^\.])+/g),function(e){return e.replace(/\\./g,".")})}function k(e){if(i.isPlainObject(e)){var t={};return i.each(e,function(e,n){n&&(t[e]=k(n))}),function(e,i,o,r){var s=t[i]||t._;return s!==n?s(e,i,o,r):e}}if(null===e)return function(e){return e};if("function"==typeof e)return function(t,n,i,o){return e(t,n,i,o)};if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("[")||-1!==e.indexOf("("))){var o=function(e,t,i){var r,s;if(""!==i){s=S(i);for(var a=0,l=s.length;l>a;a++){if(i=s[a].match(ft),r=s[a].match(gt),i){for(s[a]=s[a].replace(ft,""),""!==s[a]&&(e=e[s[a]]),r=[],s.splice(0,a+1),s=s.join("."),a=0,l=e.length;l>a;a++)r.push(o(e[a],t,s));e=i[0].substring(1,i[0].length-1),e=""===e?r:r.join(e);break}if(r)s[a]=s[a].replace(gt,""),e=e[s[a]]();else{if(null===e||e[s[a]]===n)return n;e=e[s[a]]}}}return e};return function(t,n){return o(t,n,e)}}return function(t){return t[e]}}function T(e){if(i.isPlainObject(e))return T(e._);if(null===e)return function(){};if("function"==typeof e)return function(t,n,i){e(t,"set",n,i)};if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("[")||-1!==e.indexOf("("))){var t=function(e,i,o){var r,o=S(o);r=o[o.length-1];for(var s,a,l=0,c=o.length-1;c>l;l++){if(s=o[l].match(ft),a=o[l].match(gt),s){for(o[l]=o[l].replace(ft,""),e[o[l]]=[],r=o.slice(),r.splice(0,l+1),s=r.join("."),a=0,c=i.length;c>a;a++)r={},t(r,i[a],s),e[o[l]].push(r);return}a&&(o[l]=o[l].replace(gt,""),e=e[o[l]](i)),(null===e[o[l]]||e[o[l]]===n)&&(e[o[l]]={}),e=e[o[l]]}r.match(gt)?e[r.replace(gt,"")](i):e[r.replace(ft,"")]=i};return function(n,i){return t(n,i,e)}}return function(t,n){t[e]=n}}function $(e){return ct(e.aoData,"_aData")}function E(e){e.aoData.length=0,e.aiDisplayMaster.length=0,e.aiDisplay.length=0}function D(e,t,i){for(var o=-1,r=0,s=e.length;s>r;r++)e[r]==t?o=r:e[r]>t&&e[r]--;-1!=o&&i===n&&e.splice(o,1)}function I(e,t,i,o){var r,s=e.aoData[t];if("dom"!==i&&(i&&"auto"!==i||"dom"!==s.src)){var a,l=s.anCells;if(l)for(i=0,r=l.length;r>i;i++){for(a=l[i];a.childNodes.length;)a.removeChild(a.firstChild);l[i].innerHTML=_(e,t,i,"display")}}else s._aData=M(e,s).data;if(s._aSortData=null,s._aFilterData=null,e=e.aoColumns,o!==n)e[o].sType=null;else for(i=0,r=e.length;r>i;i++)e[i].sType=null;O(s)}function M(e,t){var n,o,r,s,a=[],l=[],c=t.firstChild,u=0,d=e.aoColumns,h=function(e,t,n){"string"==typeof e&&(t=e.indexOf("@"),-1!==t&&(e=e.substring(t+1),r["@"+e]=n.getAttribute(e)))},p=function(e){o=d[u],s=i.trim(e.innerHTML),o&&o._bAttrSrc?(r={display:s},h(o.mData.sort,r,e),h(o.mData.type,r,e),h(o.mData.filter,r,e),a.push(r)):a.push(s),u++};if(c)for(;c;)n=c.nodeName.toUpperCase(),("TD"==n||"TH"==n)&&(p(c),l.push(c)),c=c.nextSibling;else for(l=t.anCells,c=0,n=l.length;n>c;c++)p(l[c]);return{data:a,cells:l}}function A(e,n,i,o){var r,s,a,l,c,u=e.aoData[n],d=u._aData,h=[];if(null===u.nTr){for(r=i||t.createElement("tr"),u.nTr=r,u.anCells=h,r._DT_RowIndex=n,O(u),l=0,c=e.aoColumns.length;c>l;l++)a=e.aoColumns[l],s=i?o[l]:t.createElement(a.sCellType),h.push(s),(!i||a.mRender||a.mData!==l)&&(s.innerHTML=_(e,n,l,"display")),a.sClass&&(s.className+=" "+a.sClass),a.bVisible&&!i?r.appendChild(s):!a.bVisible&&i&&s.parentNode.removeChild(s),a.fnCreatedCell&&a.fnCreatedCell.call(e.oInstance,s,_(e,n,l),d,n,l);Ue(e,"aoRowCreatedCallback",null,[r,d,n])}u.nTr.setAttribute("role","row")}function O(e){var t=e.nTr,n=e._aData;if(t){if(n.DT_RowId&&(t.id=n.DT_RowId),n.DT_RowClass){var o=n.DT_RowClass.split(" ");e.__rowc=e.__rowc?ht(e.__rowc.concat(o)):o,i(t).removeClass(e.__rowc.join(" ")).addClass(n.DT_RowClass)}n.DT_RowData&&i(t).data(n.DT_RowData)}}function R(e){var t,n,o,r,s,a=e.nTHead,l=e.nTFoot,c=0===i("th, td",a).length,u=e.oClasses,d=e.aoColumns;for(c&&(r=i("<tr/>").appendTo(a)),t=0,n=d.length;n>t;t++)s=d[t],o=i(s.nTh).addClass(s.sClass),c&&o.appendTo(r),e.oFeatures.bSort&&(o.addClass(s.sSortingClass),!1!==s.bSortable&&(o.attr("tabindex",e.iTabIndex).attr("aria-controls",e.sTableId),Ee(e,s.nTh,t))),s.sTitle!=o.html()&&o.html(s.sTitle),He(e,"header")(e,o,s,u);if(c&&U(e.aoHeader,a),i(a).find(">tr").attr("role","row"),i(a).find(">tr>th, >tr>td").addClass(u.sHeaderTH),i(l).find(">tr>th, >tr>td").addClass(u.sFooterTH),null!==l)for(e=e.aoFooter[0],t=0,n=e.length;n>t;t++)s=d[t],s.nTf=e[t].cell,s.sClass&&i(s.nTf).addClass(s.sClass)}function P(e,t,o){var r,s,a,l,c=[],u=[],d=e.aoColumns.length;if(t){for(o===n&&(o=!1),r=0,s=t.length;s>r;r++){for(c[r]=t[r].slice(),c[r].nTr=t[r].nTr,a=d-1;a>=0;a--)!e.aoColumns[a].bVisible&&!o&&c[r].splice(a,1);u.push([])}for(r=0,s=c.length;s>r;r++){if(e=c[r].nTr)for(;a=e.firstChild;)e.removeChild(a);for(a=0,t=c[r].length;t>a;a++)if(l=d=1,u[r][a]===n){for(e.appendChild(c[r][a].cell),u[r][a]=1;c[r+d]!==n&&c[r][a].cell==c[r+d][a].cell;)u[r+d][a]=1,d++;for(;c[r][a+l]!==n&&c[r][a].cell==c[r][a+l].cell;){for(o=0;d>o;o++)u[r+o][a+l]=1;l++}i(c[r][a].cell).attr("rowspan",d).attr("colspan",l)}}}}function N(e){var t=Ue(e,"aoPreDrawCallback","preDraw",[e]);if(-1!==i.inArray(!1,t))he(e,!1);else{var t=[],o=0,r=e.asStripeClasses,s=r.length,a=e.oLanguage,l=e.iInitDisplayStart,c="ssp"==We(e),u=e.aiDisplay;e.bDrawing=!0,l!==n&&-1!==l&&(e._iDisplayStart=c?l:l>=e.fnRecordsDisplay()?0:l,e.iInitDisplayStart=-1);var l=e._iDisplayStart,d=e.fnDisplayEnd();if(e.bDeferLoading)e.bDeferLoading=!1,e.iDraw++,he(e,!1);else if(c){if(!e.bDestroying&&!W(e))return}else e.iDraw++;if(0!==u.length)for(a=c?e.aoData.length:d,c=c?0:l;a>c;c++){var h=u[c],p=e.aoData[h];if(null===p.nTr&&A(e,h),h=p.nTr,0!==s){var f=r[o%s];p._sRowStripe!=f&&(i(h).removeClass(p._sRowStripe).addClass(f),p._sRowStripe=f)}Ue(e,"aoRowCallback",null,[h,p._aData,o,c]),t.push(h),o++}else o=a.sZeroRecords,1==e.iDraw&&"ajax"==We(e)?o=a.sLoadingRecords:a.sEmptyTable&&0===e.fnRecordsTotal()&&(o=a.sEmptyTable),t[0]=i("<tr/>",{"class":s?r[0]:""}).append(i("<td />",{valign:"top",colSpan:m(e),"class":e.oClasses.sRowEmpty}).html(o))[0];Ue(e,"aoHeaderCallback","header",[i(e.nTHead).children("tr")[0],$(e),l,d,u]),Ue(e,"aoFooterCallback","footer",[i(e.nTFoot).children("tr")[0],$(e),l,d,u]),r=i(e.nTBody),r.children().detach(),r.append(i(t)),Ue(e,"aoDrawCallback","draw",[e]),e.bSorted=!1,e.bFiltered=!1,e.bDrawing=!1}}function L(e,t){var n=e.oFeatures,i=n.bFilter;n.bSort&&ke(e),i?Y(e,e.oPreviousSearch):e.aiDisplay=e.aiDisplayMaster.slice(),!0!==t&&(e._iDisplayStart=0),e._drawHold=t,N(e),e._drawHold=!1}function F(e){var t=e.oClasses,n=i(e.nTable),n=i("<div/>").insertBefore(n),o=e.oFeatures,r=i("<div/>",{id:e.sTableId+"_wrapper","class":t.sWrapper+(e.nTFoot?"":" "+t.sNoFooter)});e.nHolding=n[0],e.nTableWrapper=r[0],e.nTableReinsertBefore=e.nTable.nextSibling;for(var s,a,l,c,u,d,h=e.sDom.split(""),p=0;p<h.length;p++){if(s=null,a=h[p],"<"==a){if(l=i("<div/>")[0],c=h[p+1],"'"==c||'"'==c){for(u="",d=2;h[p+d]!=c;)u+=h[p+d],d++;"H"==u?u=t.sJUIHeader:"F"==u&&(u=t.sJUIFooter),-1!=u.indexOf(".")?(c=u.split("."),l.id=c[0].substr(1,c[0].length-1),l.className=c[1]):"#"==u.charAt(0)?l.id=u.substr(1,u.length-1):l.className=u,p+=d}r.append(l),r=i(l)}else if(">"==a)r=r.parent();else if("l"==a&&o.bPaginate&&o.bLengthChange)s=le(e);else if("f"==a&&o.bFilter)s=q(e);else if("r"==a&&o.bProcessing)s=de(e);else if("t"==a)s=pe(e);else if("i"==a&&o.bInfo)s=ne(e);else if("p"==a&&o.bPaginate)s=ce(e);else if(0!==qe.ext.feature.length)for(l=qe.ext.feature,d=0,c=l.length;c>d;d++)if(a==l[d].cFeature){s=l[d].fnInit(e);break}s&&(l=e.aanFeatures,l[a]||(l[a]=[]),l[a].push(s),r.append(s))}n.replaceWith(r)}function U(e,t){var n,o,r,s,a,l,c,u,d,h,p=i(t).children("tr");for(e.splice(0,e.length),r=0,l=p.length;l>r;r++)e.push([]);for(r=0,l=p.length;l>r;r++)for(n=p[r],o=n.firstChild;o;){if("TD"==o.nodeName.toUpperCase()||"TH"==o.nodeName.toUpperCase()){for(u=1*o.getAttribute("colspan"),d=1*o.getAttribute("rowspan"),u=u&&0!==u&&1!==u?u:1,d=d&&0!==d&&1!==d?d:1,s=0,a=e[r];a[s];)s++;for(c=s,h=1===u?!0:!1,a=0;u>a;a++)for(s=0;d>s;s++)e[r+s][c+a]={cell:o,unique:h},e[r+s].nTr=n}o=o.nextSibling}}function j(e,t,n){var i=[];n||(n=e.aoHeader,t&&(n=[],U(n,t)));for(var t=0,o=n.length;o>t;t++)for(var r=0,s=n[t].length;s>r;r++)!n[t][r].unique||i[r]&&e.bSortCellsTop||(i[r]=n[t][r].cell);return i}function H(e,t,n){if(Ue(e,"aoServerParams","serverParams",[t]),t&&i.isArray(t)){var o={},r=/(.*?)\[\]$/;i.each(t,function(e,t){var n=t.name.match(r);n?(n=n[0],o[n]||(o[n]=[]),o[n].push(t.value)):o[t.name]=t.value}),t=o}var s,a=e.ajax,l=e.oInstance;if(i.isPlainObject(a)&&a.data){s=a.data;var c=i.isFunction(s)?s(t):s,t=i.isFunction(s)&&c?c:i.extend(!0,t,c);delete a.data}c={data:t,success:function(t){var i=t.error||t.sError;i&&e.oApi._fnLog(e,0,i),e.json=t,Ue(e,null,"xhr",[e,t]),n(t)},dataType:"json",cache:!1,type:e.sServerMethod,error:function(t,n){var i=e.oApi._fnLog;"parsererror"==n?i(e,0,"Invalid JSON response",1):4===t.readyState&&i(e,0,"Ajax error",7),he(e,!1)}},e.oAjaxData=t,Ue(e,null,"preXhr",[e,t]),e.fnServerData?e.fnServerData.call(l,e.sAjaxSource,i.map(t,function(e,t){return{name:t,value:e}}),n,e):e.sAjaxSource||"string"==typeof a?e.jqXHR=i.ajax(i.extend(c,{url:a||e.sAjaxSource})):i.isFunction(a)?e.jqXHR=a.call(l,t,n,e):(e.jqXHR=i.ajax(i.extend(c,a)),a.data=s)}function W(e){return e.bAjaxDataGet?(e.iDraw++,he(e,!0),H(e,B(e),function(t){V(e,t)}),!1):!0}function B(e){var t,n,o,r,s=e.aoColumns,a=s.length,l=e.oFeatures,c=e.oPreviousSearch,u=e.aoPreSearchCols,d=[],h=Se(e);t=e._iDisplayStart,n=!1!==l.bPaginate?e._iDisplayLength:-1;var p=function(e,t){d.push({name:e,value:t})};p("sEcho",e.iDraw),p("iColumns",a),p("sColumns",ct(s,"sName").join(",")),p("iDisplayStart",t),p("iDisplayLength",n);var f={draw:e.iDraw,columns:[],order:[],start:t,length:n,search:{value:c.sSearch,regex:c.bRegex}};for(t=0;a>t;t++)o=s[t],r=u[t],n="function"==typeof o.mData?"function":o.mData,f.columns.push({data:n,name:o.sName,searchable:o.bSearchable,orderable:o.bSortable,search:{value:r.sSearch,regex:r.bRegex}}),p("mDataProp_"+t,n),l.bFilter&&(p("sSearch_"+t,r.sSearch),p("bRegex_"+t,r.bRegex),p("bSearchable_"+t,o.bSearchable)),l.bSort&&p("bSortable_"+t,o.bSortable);return l.bFilter&&(p("sSearch",c.sSearch),p("bRegex",c.bRegex)),l.bSort&&(i.each(h,function(e,t){f.order.push({column:t.col,dir:t.dir}),p("iSortCol_"+e,t.col),p("sSortDir_"+e,t.dir)}),p("iSortingCols",h.length)),s=qe.ext.legacy.ajax,null===s?e.sAjaxSource?d:f:s?d:f}function V(e,t){var i=t.sEcho!==n?t.sEcho:t.draw,o=t.iTotalRecords!==n?t.iTotalRecords:t.recordsTotal,r=t.iTotalDisplayRecords!==n?t.iTotalDisplayRecords:t.recordsFiltered;if(i){if(1*i<e.iDraw)return;e.iDraw=1*i}for(E(e),e._iRecordsTotal=parseInt(o,10),e._iRecordsDisplay=parseInt(r,10),i=z(e,t),o=0,r=i.length;r>o;o++)w(e,i[o]);e.aiDisplay=e.aiDisplayMaster.slice(),e.bAjaxDataGet=!1,N(e),e._bInitComplete||se(e,t),e.bAjaxDataGet=!0,he(e,!1)}function z(e,t){var o=i.isPlainObject(e.ajax)&&e.ajax.dataSrc!==n?e.ajax.dataSrc:e.sAjaxDataProp;return"data"===o?t.aaData||t[o]:""!==o?k(o)(t):t}function q(e){var n=e.oClasses,o=e.sTableId,r=e.oLanguage,s=e.oPreviousSearch,a=e.aanFeatures,l='<input type="search" class="'+n.sFilterInput+'"/>',c=r.sSearch,c=c.match(/_INPUT_/)?c.replace("_INPUT_",l):c+l,n=i("<div/>",{id:a.f?null:o+"_filter","class":n.sFilter}).append(i("<label/>").append(c)),a=function(){var t=this.value?this.value:"";t!=s.sSearch&&(Y(e,{sSearch:t,bRegex:s.bRegex,bSmart:s.bSmart,bCaseInsensitive:s.bCaseInsensitive}),e._iDisplayStart=0,N(e))},u=i("input",n).val(s.sSearch).attr("placeholder",r.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT","ssp"===We(e)?ve(a,400):a).bind("keypress.DT",function(e){return 13==e.keyCode?!1:void 0}).attr("aria-controls",o);return i(e.nTable).on("search.dt.DT",function(n,i){if(e===i)try{u[0]!==t.activeElement&&u.val(s.sSearch)}catch(o){}}),n[0]}function Y(e,t,i){var o=e.oPreviousSearch,r=e.aoPreSearchCols,s=function(e){o.sSearch=e.sSearch,o.bRegex=e.bRegex,o.bSmart=e.bSmart,o.bCaseInsensitive=e.bCaseInsensitive};if(b(e),"ssp"!=We(e)){for(Q(e,t.sSearch,i,t.bEscapeRegex!==n?!t.bEscapeRegex:t.bRegex,t.bSmart,t.bCaseInsensitive),s(t),t=0;t<r.length;t++)K(e,r[t].sSearch,t,r[t].bEscapeRegex!==n?!r[t].bEscapeRegex:r[t].bRegex,r[t].bSmart,r[t].bCaseInsensitive);G(e)}else s(t);e.bFiltered=!0,Ue(e,null,"search",[e])}function G(e){for(var t,n,i=qe.ext.search,o=e.aiDisplay,r=0,s=i.length;s>r;r++){for(var a=[],l=0,c=o.length;c>l;l++)n=o[l],t=e.aoData[n],i[r](e,t._aFilterData,n,t._aData,l)&&a.push(n);o.length=0,o.push.apply(o,a)}}function K(e,t,n,i,o,r){if(""!==t)for(var s=e.aiDisplay,i=X(t,i,o,r),o=s.length-1;o>=0;o--)t=e.aoData[s[o]]._aFilterData[n],i.test(t)||s.splice(o,1)}function Q(e,t,n,i,o,r){var s,i=X(t,i,o,r),o=e.oPreviousSearch.sSearch,r=e.aiDisplayMaster;if(0!==qe.ext.search.length&&(n=!0),s=Z(e),0>=t.length)e.aiDisplay=r.slice();else for((s||n||o.length>t.length||0!==t.indexOf(o)||e.bSorted)&&(e.aiDisplay=r.slice()),t=e.aiDisplay,n=t.length-1;n>=0;n--)i.test(e.aoData[t[n]]._sFilterRow)||t.splice(n,1)}function X(e,t,n,o){return e=t?e:J(e),n&&(e="^(?=.*?"+i.map(e.match(/"[^"]+"|[^ ]+/g)||"",function(e){return'"'===e.charAt(0)?e.match(/^"(.*)"$/)[1]:e}).join(")(?=.*?")+").*$"),RegExp(e,o?"i":"")}function J(e){return e.replace(nt,"\\$1")}function Z(e){var t,n,i,o,r,s,a,l,c=e.aoColumns,u=qe.ext.type.search;for(t=!1,n=0,o=e.aoData.length;o>n;n++)if(l=e.aoData[n],!l._aFilterData){for(s=[],i=0,r=c.length;r>i;i++)t=c[i],t.bSearchable?(a=_(e,n,i,"filter"),u[t.sType]&&(a=u[t.sType](a)),null===a&&(a=""),"string"!=typeof a&&a.toString&&(a=a.toString())):a="",a.indexOf&&-1!==a.indexOf("&")&&(mt.innerHTML=a,a=vt?mt.textContent:mt.innerText),a.replace&&(a=a.replace(/[\r\n]/g,"")),s.push(a);l._aFilterData=s,l._sFilterRow=s.join("  "),t=!0}return t}function ee(e){return{search:e.sSearch,smart:e.bSmart,regex:e.bRegex,caseInsensitive:e.bCaseInsensitive}}function te(e){return{sSearch:e.search,bSmart:e.smart,bRegex:e.regex,bCaseInsensitive:e.caseInsensitive}}function ne(e){var t=e.sTableId,n=e.aanFeatures.i,o=i("<div/>",{"class":e.oClasses.sInfo,id:n?null:t+"_info"});return n||(e.aoDrawCallback.push({fn:ie,sName:"information"}),o.attr("role","status").attr("aria-live","polite"),i(e.nTable).attr("aria-describedby",t+"_info")),o[0]}function ie(e){var t=e.aanFeatures.i;if(0!==t.length){var n=e.oLanguage,o=e._iDisplayStart+1,r=e.fnDisplayEnd(),s=e.fnRecordsTotal(),a=e.fnRecordsDisplay(),l=a?n.sInfo:n.sInfoEmpty;a!==s&&(l+=" "+n.sInfoFiltered),l+=n.sInfoPostFix,l=oe(e,l),n=n.fnInfoCallback,null!==n&&(l=n.call(e.oInstance,e,o,r,s,a,l)),i(t).html(l)}}function oe(e,t){var n=e.fnFormatNumber,i=e._iDisplayStart+1,o=e._iDisplayLength,r=e.fnRecordsDisplay(),s=-1===o;return t.replace(/_START_/g,n.call(e,i)).replace(/_END_/g,n.call(e,e.fnDisplayEnd())).replace(/_MAX_/g,n.call(e,e.fnRecordsTotal())).replace(/_TOTAL_/g,n.call(e,r)).replace(/_PAGE_/g,n.call(e,s?1:Math.ceil(i/o))).replace(/_PAGES_/g,n.call(e,s?1:Math.ceil(r/o)))}function re(e){var t,n,i,o=e.iInitDisplayStart,r=e.aoColumns;if(n=e.oFeatures,e.bInitialised){for(F(e),R(e),P(e,e.aoHeader),P(e,e.aoFooter),he(e,!0),n.bAutoWidth&&me(e),t=0,n=r.length;n>t;t++)i=r[t],i.sWidth&&(i.nTh.style.width=_e(i.sWidth));L(e),r=We(e),"ssp"!=r&&("ajax"==r?H(e,[],function(n){var i=z(e,n);for(t=0;t<i.length;t++)w(e,i[t]);e.iInitDisplayStart=o,L(e),he(e,!1),se(e,n)},e):(he(e,!1),se(e)))}else setTimeout(function(){re(e)},200)}function se(e,t){e._bInitComplete=!0,t&&p(e),Ue(e,"aoInitComplete","init",[e,t])}function ae(e,t){var n=parseInt(t,10);e._iDisplayLength=n,je(e),Ue(e,null,"length",[e,n])}function le(e){for(var t=e.oClasses,n=e.sTableId,o=e.aLengthMenu,r=i.isArray(o[0]),s=r?o[0]:o,o=r?o[1]:o,r=i("<select/>",{name:n+"_length","aria-controls":n,"class":t.sLengthSelect}),a=0,l=s.length;l>a;a++)r[0][a]=new Option(o[a],s[a]);var c=i("<div><label/></div>").addClass(t.sLength);return e.aanFeatures.l||(c[0].id=n+"_length"),c.children().append(e.oLanguage.sLengthMenu.replace("_MENU_",r[0].outerHTML)),i("select",c).val(e._iDisplayLength).bind("change.DT",function(){ae(e,i(this).val()),N(e)}),i(e.nTable).bind("length.dt.DT",function(t,n,o){e===n&&i("select",c).val(o)}),c[0]}function ce(e){var t=e.sPaginationType,n=qe.ext.pager[t],o="function"==typeof n,r=function(e){N(e)},t=i("<div/>").addClass(e.oClasses.sPaging+t)[0],s=e.aanFeatures;return o||n.fnInit(e,t,r),s.p||(t.id=e.sTableId+"_paginate",e.aoDrawCallback.push({fn:function(e){if(o){var t,i=e._iDisplayStart,a=e._iDisplayLength,l=e.fnRecordsDisplay(),c=-1===a,i=c?0:Math.ceil(i/a),a=c?1:Math.ceil(l/a),l=n(i,a),c=0;for(t=s.p.length;t>c;c++)He(e,"pageButton")(e,s.p[c],c,l,i,a)}else n.fnUpdate(e,r)},sName:"pagination"})),t}function ue(e,t,n){var i=e._iDisplayStart,o=e._iDisplayLength,r=e.fnRecordsDisplay();return 0===r||-1===o?i=0:"number"==typeof t?(i=t*o,i>r&&(i=0)):"first"==t?i=0:"previous"==t?(i=o>=0?i-o:0,0>i&&(i=0)):"next"==t?r>i+o&&(i+=o):"last"==t?i=Math.floor((r-1)/o)*o:Re(e,0,"Unknown paging action: "+t,5),t=e._iDisplayStart!==i,e._iDisplayStart=i,t&&(Ue(e,null,"page",[e]),n&&N(e)),t}function de(e){return i("<div/>",{id:e.aanFeatures.r?null:e.sTableId+"_processing","class":e.oClasses.sProcessing}).html(e.oLanguage.sProcessing).insertBefore(e.nTable)[0]}function he(e,t){e.oFeatures.bProcessing&&i(e.aanFeatures.r).css("display",t?"block":"none"),Ue(e,null,"processing",[e,t])}function pe(e){var t=i(e.nTable);t.attr("role","grid");var n=e.oScroll;if(""===n.sX&&""===n.sY)return e.nTable;var o=n.sX,r=n.sY,s=e.oClasses,a=t.children("caption"),l=a.length?a[0]._captionSide:null,c=i(t[0].cloneNode(!1)),u=i(t[0].cloneNode(!1)),d=t.children("tfoot");n.sX&&"100%"===t.attr("width")&&t.removeAttr("width"),d.length||(d=null),n=i("<div/>",{"class":s.sScrollWrapper}).append(i("<div/>",{"class":s.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:o?o?_e(o):null:"100%"}).append(i("<div/>",{"class":s.sScrollHeadInner}).css({"box-sizing":"content-box",width:n.sXInner||"100%"}).append(c.removeAttr("id").css("margin-left",0).append(t.children("thead")))).append("top"===l?a:null)).append(i("<div/>",{"class":s.sScrollBody}).css({overflow:"auto",height:r?_e(r):null,width:o?_e(o):null}).append(t)),d&&n.append(i("<div/>",{"class":s.sScrollFoot}).css({overflow:"hidden",border:0,width:o?o?_e(o):null:"100%"}).append(i("<div/>",{"class":s.sScrollFootInner}).append(u.removeAttr("id").css("margin-left",0).append(t.children("tfoot")))).append("bottom"===l?a:null));var t=n.children(),h=t[0],s=t[1],p=d?t[2]:null;return o&&i(s).scroll(function(){var e=this.scrollLeft;h.scrollLeft=e,d&&(p.scrollLeft=e)}),e.nScrollHead=h,e.nScrollBody=s,e.nScrollFoot=p,e.aoDrawCallback.push({fn:fe,sName:"scrolling"}),n[0]}function fe(e){var t,n,o,r,s,a,l=e.oScroll,c=l.sX,u=l.sXInner,d=l.sY,h=l.iBarWidth,p=i(e.nScrollHead),g=p[0].style,m=p.children("div"),v=m[0].style,b=m.children("table"),m=e.nScrollBody,y=i(m),w=m.style,C=i(e.nScrollFoot).children("div"),_=C.children("table"),x=i(e.nTHead),S=i(e.nTable),k=S[0],T=k.style,$=e.nTFoot?i(e.nTFoot):null,E=e.oBrowser,D=E.bScrollOversize,I=[],M=[],A=[],O=function(e){e=e.style,e.paddingTop="0",e.paddingBottom="0",e.borderTopWidth="0",e.borderBottomWidth="0",e.height=0};S.children("thead, tfoot").remove(),s=x.clone().prependTo(S),t=x.find("tr"),o=s.find("tr"),s.find("th, td").removeAttr("tabindex"),$&&(r=$.clone().prependTo(S),n=$.find("tr"),r=r.find("tr")),c||(w.width="100%",p[0].style.width="100%"),i.each(j(e,s),function(t,n){a=f(e,t),n.style.width=e.aoColumns[a].sWidth}),$&&ge(function(e){e.style.width=""},r),l.bCollapse&&""!==d&&(w.height=y[0].offsetHeight+x[0].offsetHeight+"px"),p=S.outerWidth(),""===c?(T.width="100%",D&&(S.find("tbody").height()>m.offsetHeight||"scroll"==y.css("overflow-y"))&&(T.width=_e(S.outerWidth()-h))):""!==u?T.width=_e(u):p==y.width()&&y.height()<S.height()?(T.width=_e(p-h),S.outerWidth()>p-h&&(T.width=_e(p))):T.width=_e(p),p=S.outerWidth(),ge(O,o),ge(function(e){A.push(e.innerHTML),I.push(_e(i(e).css("width")))},o),ge(function(e,t){e.style.width=I[t]},t),i(o).height(0),$&&(ge(O,r),ge(function(e){M.push(_e(i(e).css("width")))},r),ge(function(e,t){e.style.width=M[t]},n),i(r).height(0)),ge(function(e,t){e.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+A[t]+"</div>",e.style.width=I[t]},o),$&&ge(function(e,t){e.innerHTML="",e.style.width=M[t]},r),S.outerWidth()<p?(n=m.scrollHeight>m.offsetHeight||"scroll"==y.css("overflow-y")?p+h:p,D&&(m.scrollHeight>m.offsetHeight||"scroll"==y.css("overflow-y"))&&(T.width=_e(n-h)),(""===c||""!==u)&&Re(e,1,"Possible column misalignment",6)):n="100%",w.width=_e(n),g.width=_e(n),$&&(e.nScrollFoot.style.width=_e(n)),!d&&D&&(w.height=_e(k.offsetHeight+h)),d&&l.bCollapse&&(w.height=_e(d),l=c&&k.offsetWidth>m.offsetWidth?h:0,k.offsetHeight<m.offsetHeight&&(w.height=_e(k.offsetHeight+l))),l=S.outerWidth(),b[0].style.width=_e(l),v.width=_e(l),b=S.height()>m.clientHeight||"scroll"==y.css("overflow-y"),E="padding"+(E.bScrollbarLeft?"Left":"Right"),v[E]=b?h+"px":"0px",$&&(_[0].style.width=_e(l),C[0].style.width=_e(l),C[0].style[E]=b?h+"px":"0px"),y.scroll(),!e.bSorted&&!e.bFiltered||e._drawHold||(m.scrollTop=0)}function ge(e,t,n){for(var i,o,r=0,s=0,a=t.length;a>s;){for(i=t[s].firstChild,o=n?n[s].firstChild:null;i;)1===i.nodeType&&(n?e(i,o,r):e(i,r),r++),i=i.nextSibling,o=n?o.nextSibling:null;s++}}function me(t){var n,o,r=t.nTable,s=t.aoColumns,a=t.oScroll,l=a.sY,c=a.sX,u=a.sXInner,d=s.length,a=v(t,"bVisible"),h=i("th",t.nTHead),f=r.getAttribute("width"),g=r.parentNode,b=!1;for(n=0;n<a.length;n++)o=s[a[n]],null!==o.sWidth&&(o.sWidth=be(o.sWidthOrig,g),b=!0);if(b||c||l||d!=m(t)||d!=h.length){d=i(r).clone().empty().css("visibility","hidden").removeAttr("id").append(i(t.nTHead).clone(!1)).append(i(t.nTFoot).clone(!1)).append(i("<tbody><tr/></tbody>")),d.find("tfoot th, tfoot td").css("width","");var y=d.find("tbody tr"),h=j(t,d.find("thead")[0]);for(n=0;n<a.length;n++)o=s[a[n]],h[n].style.width=null!==o.sWidthOrig&&""!==o.sWidthOrig?_e(o.sWidthOrig):"";if(t.aoData.length)for(n=0;n<a.length;n++)b=a[n],o=s[b],i(we(t,b)).clone(!1).append(o.sContentPadding).appendTo(y);if(d.appendTo(g),c&&u?d.width(u):c?(d.css("width","auto"),d.width()<g.offsetWidth&&d.width(g.offsetWidth)):l?d.width(g.offsetWidth):f&&d.width(f),ye(t,d[0]),c){for(n=u=0;n<a.length;n++)o=s[a[n]],l=i(h[n]).outerWidth(),u+=null===o.sWidthOrig?l:parseInt(o.sWidth,10)+l-i(h[n]).width();d.width(_e(u)),r.style.width=_e(u)}for(n=0;n<a.length;n++)o=s[a[n]],(l=i(h[n]).width())&&(o.sWidth=_e(l));r.style.width=_e(d.css("width")),d.remove()}else for(n=0;d>n;n++)s[n].sWidth=_e(h.eq(n).width());f&&(r.style.width=_e(f)),!f&&!c||t._reszEvt||(i(e).bind("resize.DT-"+t.sInstance,ve(function(){p(t)})),t._reszEvt=!0)}function ve(e,t){var i,o,r=t||200;return function(){var t=this,s=+new Date,a=arguments;i&&i+r>s?(clearTimeout(o),o=setTimeout(function(){i=n,e.apply(t,a)},r)):i?(i=s,e.apply(t,a)):i=s}}function be(e,n){if(!e)return 0;var o=i("<div/>").css("width",_e(e)).appendTo(n||t.body),r=o[0].offsetWidth;return o.remove(),r}function ye(e,t){var n=e.oScroll;(n.sX||n.sY)&&(n=n.sX?0:n.iBarWidth,
t.style.width=_e(i(t).outerWidth()-n))}function we(e,t){var n=Ce(e,t);if(0>n)return null;var o=e.aoData[n];return o.nTr?o.anCells[t]:i("<td/>").html(_(e,n,t,"display"))[0]}function Ce(e,t){for(var n,i=-1,o=-1,r=0,s=e.aoData.length;s>r;r++)n=_(e,r,t,"display")+"",n=n.replace(bt,""),n.length>i&&(i=n.length,o=r);return o}function _e(e){return null===e?"0px":"number"==typeof e?0>e?"0px":e+"px":e.match(/\d$/)?e+"px":e}function xe(){if(!qe.__scrollbarWidth){var e=i("<p/>").css({width:"100%",height:200,padding:0})[0],t=i("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(e).appendTo("body"),n=e.offsetWidth;t.css("overflow","scroll"),e=e.offsetWidth,n===e&&(e=t[0].clientWidth),t.remove(),qe.__scrollbarWidth=n-e}return qe.__scrollbarWidth}function Se(e){var t,n,o,r,s,a,l=[],c=e.aoColumns;t=e.aaSortingFixed,n=i.isPlainObject(t);var u=[];for(o=function(e){e.length&&!i.isArray(e[0])?u.push(e):u.push.apply(u,e)},i.isArray(t)&&o(t),n&&t.pre&&o(t.pre),o(e.aaSorting),n&&t.post&&o(t.post),e=0;e<u.length;e++)for(a=u[e][0],o=c[a].aDataSort,t=0,n=o.length;n>t;t++)r=o[t],s=c[r].sType||"string",l.push({src:a,col:r,dir:u[e][1],index:u[e][2],type:s,formatter:qe.ext.type.order[s+"-pre"]});return l}function ke(e){var t,n,i,o,r=[],s=qe.ext.type.order,a=e.aoData,l=0,c=e.aiDisplayMaster;for(b(e),o=Se(e),t=0,n=o.length;n>t;t++)i=o[t],i.formatter&&l++,Ie(e,i.col);if("ssp"!=We(e)&&0!==o.length){for(t=0,n=c.length;n>t;t++)r[c[t]]=t;c.sort(l===o.length?function(e,t){var n,i,s,l,c=o.length,u=a[e]._aSortData,d=a[t]._aSortData;for(s=0;c>s;s++)if(l=o[s],n=u[l.col],i=d[l.col],n=i>n?-1:n>i?1:0,0!==n)return"asc"===l.dir?n:-n;return n=r[e],i=r[t],i>n?-1:n>i?1:0}:function(e,t){var n,i,l,c,u=o.length,d=a[e]._aSortData,h=a[t]._aSortData;for(l=0;u>l;l++)if(c=o[l],n=d[c.col],i=h[c.col],c=s[c.type+"-"+c.dir]||s["string-"+c.dir],n=c(n,i),0!==n)return n;return n=r[e],i=r[t],i>n?-1:n>i?1:0})}e.bSorted=!0}function Te(e){for(var t,n,i=e.aoColumns,o=Se(e),e=e.oLanguage.oAria,r=0,s=i.length;s>r;r++){n=i[r];var a=n.asSorting;t=n.sTitle.replace(/<.*?>/g,"");var l=n.nTh;l.removeAttribute("aria-sort"),n.bSortable&&(0<o.length&&o[0].col==r?(l.setAttribute("aria-sort","asc"==o[0].dir?"ascending":"descending"),n=a[o[0].index+1]||a[0]):n=a[0],t+="asc"===n?e.sSortAscending:e.sSortDescending),l.setAttribute("aria-label",t)}}function $e(e,t,o,r){var s=e.aaSorting,a=e.aoColumns[t].asSorting,l=function(e){var t=e._idx;return t===n&&(t=i.inArray(e[1],a)),t+1>=a.length?0:t+1};"number"==typeof s[0]&&(s=e.aaSorting=[s]),o&&e.oFeatures.bSortMulti?(o=i.inArray(t,ct(s,"0")),-1!==o?(t=l(s[o]),s[o][1]=a[t],s[o]._idx=t):(s.push([t,a[0],0]),s[s.length-1]._idx=0)):s.length&&s[0][0]==t?(t=l(s[0]),s.length=1,s[0][1]=a[t],s[0]._idx=t):(s.length=0,s.push([t,a[0]]),s[0]._idx=0),L(e),"function"==typeof r&&r(e)}function Ee(e,t,n,i){var o=e.aoColumns[n];Le(t,{},function(t){!1!==o.bSortable&&(e.oFeatures.bProcessing?(he(e,!0),setTimeout(function(){$e(e,n,t.shiftKey,i),"ssp"!==We(e)&&he(e,!1)},0)):$e(e,n,t.shiftKey,i))})}function De(e){var t,n,o=e.aLastSort,r=e.oClasses.sSortColumn,s=Se(e),a=e.oFeatures;if(a.bSort&&a.bSortClasses){for(a=0,t=o.length;t>a;a++)n=o[a].src,i(ct(e.aoData,"anCells",n)).removeClass(r+(2>a?a+1:3));for(a=0,t=s.length;t>a;a++)n=s[a].src,i(ct(e.aoData,"anCells",n)).addClass(r+(2>a?a+1:3))}e.aLastSort=s}function Ie(e,t){var n,i=e.aoColumns[t],o=qe.ext.order[i.sSortDataType];o&&(n=o.call(e.oInstance,e,t,g(e,t)));for(var r,s=qe.ext.type.order[i.sType+"-pre"],a=0,l=e.aoData.length;l>a;a++)i=e.aoData[a],i._aSortData||(i._aSortData=[]),(!i._aSortData[t]||o)&&(r=o?n[a]:_(e,a,t,"sort"),i._aSortData[t]=s?s(r):r)}function Me(e){if(e.oFeatures.bStateSave&&!e.bDestroying){var t={time:+new Date,start:e._iDisplayStart,length:e._iDisplayLength,order:i.extend(!0,[],e.aaSorting),search:ee(e.oPreviousSearch),columns:i.map(e.aoColumns,function(t,n){return{visible:t.bVisible,search:ee(e.aoPreSearchCols[n])}})};Ue(e,"aoStateSaveParams","stateSaveParams",[e,t]),e.oSavedState=t,e.fnStateSaveCallback.call(e.oInstance,e,t)}}function Ae(e){var t,n,o=e.aoColumns;if(e.oFeatures.bStateSave){var r=e.fnStateLoadCallback.call(e.oInstance,e);if(r&&r.time&&(t=Ue(e,"aoStateLoadParams","stateLoadParams",[e,r]),-1===i.inArray(!1,t)&&(t=e.iStateDuration,!(t>0&&r.time<+new Date-1e3*t)&&o.length===r.columns.length))){for(e.oLoadedState=i.extend(!0,{},r),e._iDisplayStart=r.start,e.iInitDisplayStart=r.start,e._iDisplayLength=r.length,e.aaSorting=[],i.each(r.order,function(t,n){e.aaSorting.push(n[0]>=o.length?[0,n[1]]:n)}),i.extend(e.oPreviousSearch,te(r.search)),t=0,n=r.columns.length;n>t;t++){var s=r.columns[t];o[t].bVisible=s.visible,i.extend(e.aoPreSearchCols[t],te(s.search))}Ue(e,"aoStateLoaded","stateLoaded",[e,r])}}}function Oe(e){var t=qe.settings,e=i.inArray(e,ct(t,"nTable"));return-1!==e?t[e]:null}function Re(t,n,i,o){if(i="DataTables warning: "+(null!==t?"table id="+t.sTableId+" - ":"")+i,o&&(i+=". For more information about this error, please see http://datatables.net/tn/"+o),n)e.console&&console.log&&console.log(i);else{if(t=qe.ext,"alert"!=(t.sErrMode||t.errMode))throw Error(i);alert(i)}}function Pe(e,t,o,r){i.isArray(o)?i.each(o,function(n,o){i.isArray(o)?Pe(e,t,o[0],o[1]):Pe(e,t,o)}):(r===n&&(r=o),t[o]!==n&&(e[r]=t[o]))}function Ne(e,t,n){var o,r;for(r in t)t.hasOwnProperty(r)&&(o=t[r],i.isPlainObject(o)?(i.isPlainObject(e[r])||(e[r]={}),i.extend(!0,e[r],o)):e[r]=n&&"data"!==r&&"aaData"!==r&&i.isArray(o)?o.slice():o);return e}function Le(e,t,n){i(e).bind("click.DT",t,function(t){e.blur(),n(t)}).bind("keypress.DT",t,function(e){13===e.which&&(e.preventDefault(),n(e))}).bind("selectstart.DT",function(){return!1})}function Fe(e,t,n,i){n&&e[t].push({fn:n,sName:i})}function Ue(e,t,n,o){var r=[];return t&&(r=i.map(e[t].slice().reverse(),function(t){return t.fn.apply(e.oInstance,o)})),null!==n&&i(e.nTable).trigger(n+".dt",o),r}function je(e){var t=e._iDisplayStart,n=e.fnDisplayEnd(),i=e._iDisplayLength;n===e.fnRecordsDisplay()&&(t=n-i),(-1===i||0>t)&&(t=0),e._iDisplayStart=t}function He(e,t){var n=e.renderer,o=qe.ext.renderer[t];return i.isPlainObject(n)&&n[t]?o[n[t]]||o._:"string"==typeof n?o[n]||o._:o._}function We(e){return e.oFeatures.bServerSide?"ssp":e.ajax||e.sAjaxSource?"ajax":"dom"}function Be(e,t){var n=[],n=Rt.numbers_length,i=Math.floor(n/2);return n>=t?n=dt(0,t):i>=e?(n=dt(0,n-2),n.push("ellipsis"),n.push(t-1)):(e>=t-1-i?n=dt(t-(n-2),t):(n=dt(e-1,e+2),n.push("ellipsis"),n.push(t-1)),n.splice(0,0,"ellipsis"),n.splice(0,0,0)),n.DT_el="span",n}function Ve(e){i.each({num:function(t){return Pt(t,e)},"num-fmt":function(t){return Pt(t,e,it)},"html-num":function(t){return Pt(t,e,Ze)},"html-num-fmt":function(t){return Pt(t,e,Ze,it)}},function(t,n){Ye.type.order[t+e+"-pre"]=n})}function ze(e){return function(){var t=[Oe(this[qe.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return qe.ext.internal[e].apply(this,t)}}var qe,Ye,Ge,Ke,Qe,Xe={},Je=/[\r\n]/g,Ze=/<.*?>/g,et=/^[\w\+\-]/,tt=/[\w\+\-]$/,nt=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),it=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ot=function(e){return e&&!0!==e&&"-"!==e?!1:!0},rt=function(e){var t=parseInt(e,10);return!isNaN(t)&&isFinite(e)?t:null},st=function(e,t){return Xe[t]||(Xe[t]=RegExp(J(t),"g")),"string"==typeof e?e.replace(/\./g,"").replace(Xe[t],"."):e},at=function(e,t,n){var i="string"==typeof e;return t&&i&&(e=st(e,t)),n&&i&&(e=e.replace(it,"")),ot(e)||!isNaN(parseFloat(e))&&isFinite(e)},lt=function(e,t,n){return ot(e)?!0:(ot(e)||"string"==typeof e)&&at(e.replace(Ze,""),t,n)?!0:null},ct=function(e,t,i){var o=[],r=0,s=e.length;if(i!==n)for(;s>r;r++)e[r]&&e[r][t]&&o.push(e[r][t][i]);else for(;s>r;r++)e[r]&&o.push(e[r][t]);return o},ut=function(e,t,i,o){var r=[],s=0,a=t.length;if(o!==n)for(;a>s;s++)r.push(e[t[s]][i][o]);else for(;a>s;s++)r.push(e[t[s]][i]);return r},dt=function(e,t){var i,o=[];t===n?(t=0,i=e):(i=t,t=e);for(var r=t;i>r;r++)o.push(r);return o},ht=function(e){var t,n,i,o=[],r=e.length,s=0;n=0;e:for(;r>n;n++){for(t=e[n],i=0;s>i;i++)if(o[i]===t)continue e;o.push(t),s++}return o},pt=function(e,t,i){e[t]!==n&&(e[i]=e[t])},ft=/\[.*?\]$/,gt=/\(\)$/,mt=i("<div>")[0],vt=mt.textContent!==n,bt=/<.*?>/g;qe=function(e){this.$=function(e,t){return this.api(!0).$(e,t)},this._=function(e,t){return this.api(!0).rows(e,t).data()},this.api=function(e){return new Ge(e?Oe(this[Ye.iApiIndex]):this)},this.fnAddData=function(e,t){var o=this.api(!0),r=i.isArray(e)&&(i.isArray(e[0])||i.isPlainObject(e[0]))?o.rows.add(e):o.row.add(e);return(t===n||t)&&o.draw(),r.flatten().toArray()},this.fnAdjustColumnSizing=function(e){var t=this.api(!0).columns.adjust(),i=t.settings()[0],o=i.oScroll;e===n||e?t.draw(!1):(""!==o.sX||""!==o.sY)&&fe(i)},this.fnClearTable=function(e){var t=this.api(!0).clear();(e===n||e)&&t.draw()},this.fnClose=function(e){this.api(!0).row(e).child.hide()},this.fnDeleteRow=function(e,t,i){var o=this.api(!0),e=o.rows(e),r=e.settings()[0],s=r.aoData[e[0][0]];return e.remove(),t&&t.call(this,r,s),(i===n||i)&&o.draw(),s},this.fnDestroy=function(e){this.api(!0).destroy(e)},this.fnDraw=function(e){this.api(!0).draw(!e)},this.fnFilter=function(e,t,i,o,r,s){r=this.api(!0),null===t||t===n?r.search(e,i,o,s):r.column(t).search(e,i,o,s),r.draw()},this.fnGetData=function(e,t){var i=this.api(!0);if(e!==n){var o=e.nodeName?e.nodeName.toLowerCase():"";return t!==n||"td"==o||"th"==o?i.cell(e,t).data():i.row(e).data()||null}return i.data().toArray()},this.fnGetNodes=function(e){var t=this.api(!0);return e!==n?t.row(e).node():t.rows().nodes().flatten().toArray()},this.fnGetPosition=function(e){var t=this.api(!0),n=e.nodeName.toUpperCase();return"TR"==n?t.row(e).index():"TD"==n||"TH"==n?(e=t.cell(e).index(),[e.row,e.columnVisible,e.column]):null},this.fnIsOpen=function(e){return this.api(!0).row(e).child.isShown()},this.fnOpen=function(e,t,n){return this.api(!0).row(e).child(t,n).show().child()[0]},this.fnPageChange=function(e,t){var i=this.api(!0).page(e);(t===n||t)&&i.draw(!1)},this.fnSetColumnVis=function(e,t,i){e=this.api(!0).column(e).visible(t),(i===n||i)&&e.columns.adjust().draw()},this.fnSettings=function(){return Oe(this[Ye.iApiIndex])},this.fnSort=function(e){this.api(!0).order(e).draw()},this.fnSortListener=function(e,t,n){this.api(!0).order.listener(e,t,n)},this.fnUpdate=function(e,t,i,o,r){var s=this.api(!0);return i===n||null===i?s.row(t).data(e):s.cell(t,i).data(e),(r===n||r)&&s.columns.adjust(),(o===n||o)&&s.draw(),0},this.fnVersionCheck=Ye.fnVersionCheck;var t=this,o=e===n,u=this.length;o&&(e={}),this.oApi=this.internal=Ye.internal;for(var p in qe.ext.internal)p&&(this[p]=ze(p));return this.each(function(){var p,f={},g=u>1?Ne(f,e,!0):e,m=0,v=this.getAttribute("id"),f=!1,b=qe.defaults;if("table"!=this.nodeName.toLowerCase())Re(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{a(b),l(b.column),r(b,b,!0),r(b.column,b.column,!0),r(b,g);var _=qe.settings,m=0;for(p=_.length;p>m;m++){if(_[m].nTable==this){if(p=g.bRetrieve!==n?g.bRetrieve:b.bRetrieve,o||p)return _[m].oInstance;if(g.bDestroy!==n?g.bDestroy:b.bDestroy){_[m].oInstance.fnDestroy();break}return void Re(_[m],0,"Cannot reinitialise DataTable",3)}if(_[m].sTableId==this.id){_.splice(m,1);break}}(null===v||""===v)&&(this.id=v="DataTables_Table_"+qe.ext._unique++);var x=i.extend(!0,{},qe.models.oSettings,{nTable:this,oApi:t.internal,oInit:g,sDestroyWidth:i(this)[0].style.width,sInstance:v,sTableId:v});_.push(x),x.oInstance=1===t.length?t:i(this).dataTable(),a(g),g.oLanguage&&s(g.oLanguage),g.aLengthMenu&&!g.iDisplayLength&&(g.iDisplayLength=i.isArray(g.aLengthMenu[0])?g.aLengthMenu[0][0]:g.aLengthMenu[0]),g=Ne(i.extend(!0,{},b),g),Pe(x.oFeatures,g,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" ")),Pe(x,g,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]),Pe(x.oScroll,g,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]),Pe(x.oLanguage,g,"fnInfoCallback"),Fe(x,"aoDrawCallback",g.fnDrawCallback,"user"),Fe(x,"aoServerParams",g.fnServerParams,"user"),Fe(x,"aoStateSaveParams",g.fnStateSaveParams,"user"),Fe(x,"aoStateLoadParams",g.fnStateLoadParams,"user"),Fe(x,"aoStateLoaded",g.fnStateLoaded,"user"),Fe(x,"aoRowCallback",g.fnRowCallback,"user"),Fe(x,"aoRowCreatedCallback",g.fnCreatedRow,"user"),Fe(x,"aoHeaderCallback",g.fnHeaderCallback,"user"),Fe(x,"aoFooterCallback",g.fnFooterCallback,"user"),Fe(x,"aoInitComplete",g.fnInitComplete,"user"),Fe(x,"aoPreDrawCallback",g.fnPreDrawCallback,"user"),v=x.oClasses,g.bJQueryUI?(i.extend(v,qe.ext.oJUIClasses,g.oClasses),g.sDom===b.sDom&&"lfrtip"===b.sDom&&(x.sDom='<"H"lfr>t<"F"ip>'),x.renderer?i.isPlainObject(x.renderer)&&!x.renderer.header&&(x.renderer.header="jqueryui"):x.renderer="jqueryui"):i.extend(v,qe.ext.classes,g.oClasses),i(this).addClass(v.sTable),(""!==x.oScroll.sX||""!==x.oScroll.sY)&&(x.oScroll.iBarWidth=xe()),!0===x.oScroll.sX&&(x.oScroll.sX="100%"),x.iInitDisplayStart===n&&(x.iInitDisplayStart=g.iDisplayStart,x._iDisplayStart=g.iDisplayStart),null!==g.iDeferLoading&&(x.bDeferLoading=!0,m=i.isArray(g.iDeferLoading),x._iRecordsDisplay=m?g.iDeferLoading[0]:g.iDeferLoading,x._iRecordsTotal=m?g.iDeferLoading[1]:g.iDeferLoading),""!==g.oLanguage.sUrl?(x.oLanguage.sUrl=g.oLanguage.sUrl,i.getJSON(x.oLanguage.sUrl,null,function(e){s(e),r(b.oLanguage,e),i.extend(!0,x.oLanguage,g.oLanguage,e),re(x)}),f=!0):i.extend(!0,x.oLanguage,g.oLanguage),null===g.asStripeClasses&&(x.asStripeClasses=[v.sStripeOdd,v.sStripeEven]);var m=x.asStripeClasses,S=i("tbody tr:eq(0)",this);-1!==i.inArray(!0,i.map(m,function(e){return S.hasClass(e)}))&&(i("tbody tr",this).removeClass(m.join(" ")),x.asDestroyStripes=m.slice());var k,_=[],m=this.getElementsByTagName("thead");if(0!==m.length&&(U(x.aoHeader,m[0]),_=j(x)),null===g.aoColumns)for(k=[],m=0,p=_.length;p>m;m++)k.push(null);else k=g.aoColumns;for(m=0,p=k.length;p>m;m++)d(x,_?_[m]:null);if(y(x,g.aoColumnDefs,k,function(e,t){h(x,e,t)}),S.length){var T=function(e,t){return e.getAttribute("data-"+t)?t:null};i.each(M(x,S[0]).cells,function(e,t){var i=x.aoColumns[e];if(i.mData===e){var o=T(t,"sort")||T(t,"order"),r=T(t,"filter")||T(t,"search");(null!==o||null!==r)&&(i.mData={_:e+".display",sort:null!==o?e+".@data-"+o:n,type:null!==o?e+".@data-"+o:n,filter:null!==r?e+".@data-"+r:n},h(x,e))}})}var $=x.oFeatures;if(g.bStateSave&&($.bStateSave=!0,Ae(x,g),Fe(x,"aoDrawCallback",Me,"state_save")),g.aaSorting===n)for(_=x.aaSorting,m=0,p=_.length;p>m;m++)_[m][1]=x.aoColumns[m].asSorting[0];if(De(x),$.bSort&&Fe(x,"aoDrawCallback",function(){if(x.bSorted){var e=Se(x),t={};i.each(e,function(e,n){t[n.src]=n.dir}),Ue(x,null,"order",[x,e,t]),Te(x)}}),Fe(x,"aoDrawCallback",function(){(x.bSorted||"ssp"===We(x)||$.bDeferRender)&&De(x)},"sc"),c(x),m=i(this).children("caption").each(function(){this._captionSide=i(this).css("caption-side")}),p=i(this).children("thead"),0===p.length&&(p=i("<thead/>").appendTo(this)),x.nTHead=p[0],p=i(this).children("tbody"),0===p.length&&(p=i("<tbody/>").appendTo(this)),x.nTBody=p[0],p=i(this).children("tfoot"),0===p.length&&0<m.length&&(""!==x.oScroll.sX||""!==x.oScroll.sY)&&(p=i("<tfoot/>").appendTo(this)),0===p.length||0===p.children().length?i(this).addClass(v.sNoFooter):0<p.length&&(x.nTFoot=p[0],U(x.aoFooter,x.nTFoot)),g.aaData)for(m=0;m<g.aaData.length;m++)w(x,g.aaData[m]);else(x.bDeferLoading||"dom"==We(x))&&C(x,i(x.nTBody).children("tr"));x.aiDisplay=x.aiDisplayMaster.slice(),x.bInitialised=!0,!1===f&&re(x)}}),t=null,this};var yt=[],wt=Array.prototype,Ct=function(e){var t,n,o=qe.settings,r=i.map(o,function(e){return e.nTable});return e?e.nTable&&e.oApi?[e]:e.nodeName&&"table"===e.nodeName.toLowerCase()?(t=i.inArray(e,r),-1!==t?[o[t]]:null):e&&"function"==typeof e.settings?e.settings().toArray():("string"==typeof e?n=i(e):e instanceof i&&(n=e),n?n.map(function(){return t=i.inArray(this,r),-1!==t?o[t]:null}).toArray():void 0):[]};Ge=function(e,t){if(!this instanceof Ge)throw"DT API must be constructed as a new object";var n=[],o=function(e){(e=Ct(e))&&n.push.apply(n,e)};if(i.isArray(e))for(var r=0,s=e.length;s>r;r++)o(e[r]);else o(e);this.context=ht(n),t&&this.push.apply(this,t.toArray?t.toArray():t),this.selector={rows:null,cols:null,opts:null},Ge.extend(this,this,yt)},qe.Api=Ge,Ge.prototype={concat:wt.concat,context:[],each:function(e){for(var t=0,n=this.length;n>t;t++)e.call(this,this[t],t,this);return this},eq:function(e){var t=this.context;return t.length>e?new Ge(t[e],this[e]):null},filter:function(e){var t=[];if(wt.filter)t=wt.filter.call(this,e,this);else for(var n=0,i=this.length;i>n;n++)e.call(this,this[n],n,this)&&t.push(this[n]);return new Ge(this.context,t)},flatten:function(){var e=[];return new Ge(this.context,e.concat.apply(e,this.toArray()))},join:wt.join,indexOf:wt.indexOf||function(e,t){for(var n=t||0,i=this.length;i>n;n++)if(this[n]===e)return n;return-1},iterator:function(e,t,i){var o,r,s,a,l,c,u,d=[],h=this.context,p=this.selector;for("string"==typeof e&&(i=t,t=e,e=!1),r=0,s=h.length;s>r;r++)if("table"===t)o=i(h[r],r),o!==n&&d.push(o);else if("columns"===t||"rows"===t)o=i(h[r],this[r],r),o!==n&&d.push(o);else if("column"===t||"column-rows"===t||"row"===t||"cell"===t)for(u=this[r],"column-rows"===t&&(c=Tt(h[r],p.opts)),a=0,l=u.length;l>a;a++)o=u[a],o="cell"===t?i(h[r],o.row,o.column,r,a):i(h[r],o,r,a,c),o!==n&&d.push(o);return d.length?(e=new Ge(h,e?d.concat.apply([],d):d),t=e.selector,t.rows=p.rows,t.cols=p.cols,t.opts=p.opts,e):this},lastIndexOf:wt.lastIndexOf||function(e,t){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(e){var t=[];if(wt.map)t=wt.map.call(this,e,this);else for(var n=0,i=this.length;i>n;n++)t.push(e.call(this,this[n],n));return new Ge(this.context,t)},pluck:function(e){return this.map(function(t){return t[e]})},pop:wt.pop,push:wt.push,reduce:wt.reduce||function(e,t){return u(this,e,t,0,this.length,1)},reduceRight:wt.reduceRight||function(e,t){return u(this,e,t,this.length-1,-1,-1)},reverse:wt.reverse,selector:null,shift:wt.shift,sort:wt.sort,splice:wt.splice,toArray:function(){return wt.slice.call(this)},to$:function(){return i(this)},toJQuery:function(){return i(this)},unique:function(){return new Ge(this.context,ht(this))},unshift:wt.unshift},Ge.extend=function(e,t,n){if(t&&(t instanceof Ge||t.__dt_wrapper)){var o,r,s,a=function(e,t,n){return function(){var i=t.apply(e,arguments);return Ge.extend(i,i,n.methodExt),i}};for(o=0,r=n.length;r>o;o++)s=n[o],t[s.name]="function"==typeof s.val?a(e,s.val,s):i.isPlainObject(s.val)?{}:s.val,t[s.name].__dt_wrapper=!0,Ge.extend(e,t[s.name],s.propExt)}},Ge.register=Ke=function(e,t){if(i.isArray(e))for(var n=0,o=e.length;o>n;n++)Ge.register(e[n],t);else for(var r,s,a=e.split("."),l=yt,n=0,o=a.length;o>n;n++){r=(s=-1!==a[n].indexOf("()"))?a[n].replace("()",""):a[n];var c;e:{c=0;for(var u=l.length;u>c;c++)if(l[c].name===r){c=l[c];break e}c=null}c||(c={name:r,val:{},methodExt:[],propExt:[]},l.push(c)),n===o-1?c.val=t:l=s?c.methodExt:c.propExt}},Ge.registerPlural=Qe=function(e,t,o){Ge.register(e,o),Ge.register(t,function(){var e=o.apply(this,arguments);return e===this?this:e instanceof Ge?e.length?i.isArray(e[0])?new Ge(e.context,e[0]):e[0]:n:e})},Ke("tables()",function(e){var t;if(e){t=Ge;var n=this.context;if("number"==typeof e)e=[n[e]];else var o=i.map(n,function(e){return e.nTable}),e=i(o).filter(e).map(function(){var e=i.inArray(this,o);return n[e]}).toArray();t=new t(e)}else t=this;return t}),Ke("table()",function(e){var e=this.tables(e),t=e.context;return t.length?new Ge(t[0]):e}),Qe("tables().nodes()","table().node()",function(){return this.iterator("table",function(e){return e.nTable})}),Qe("tables().body()","table().body()",function(){return this.iterator("table",function(e){return e.nTBody})}),Qe("tables().header()","table().header()",function(){return this.iterator("table",function(e){return e.nTHead})}),Qe("tables().footer()","table().footer()",function(){return this.iterator("table",function(e){return e.nTFoot})}),Qe("tables().containers()","table().container()",function(){return this.iterator("table",function(e){return e.nTableWrapper})}),Ke("draw()",function(e){return this.iterator("table",function(t){L(t,!1===e)})}),Ke("page()",function(e){return e===n?this.page.info().page:this.iterator("table",function(t){ue(t,e)})}),Ke("page.info()",function(){if(0===this.context.length)return n;var e=this.context[0],t=e._iDisplayStart,i=e._iDisplayLength,o=e.fnRecordsDisplay(),r=-1===i;return{page:r?0:Math.floor(t/i),pages:r?1:Math.ceil(o/i),start:t,end:e.fnDisplayEnd(),length:i,recordsTotal:e.fnRecordsTotal(),recordsDisplay:o}}),Ke("page.len()",function(e){return e===n?0!==this.context.length?this.context[0]._iDisplayLength:n:this.iterator("table",function(t){ae(t,e)})});var _t=function(e,t,n){if("ssp"==We(e)?L(e,t):(he(e,!0),H(e,[],function(n){E(e);for(var n=z(e,n),i=0,o=n.length;o>i;i++)w(e,n[i]);L(e,t),he(e,!1)})),n){var i=new Ge(e);i.one("draw",function(){n(i.ajax.json())})}};Ke("ajax.json()",function(){var e=this.context;return 0<e.length?e[0].json:void 0}),Ke("ajax.params()",function(){var e=this.context;return 0<e.length?e[0].oAjaxData:void 0}),Ke("ajax.reload()",function(e,t){return this.iterator("table",function(n){_t(n,!1===t,e)})}),Ke("ajax.url()",function(e){var t=this.context;return e===n?0===t.length?n:(t=t[0],t.ajax?i.isPlainObject(t.ajax)?t.ajax.url:t.ajax:t.sAjaxSource):this.iterator("table",function(t){i.isPlainObject(t.ajax)?t.ajax.url=e:t.ajax=e})}),Ke("ajax.url().load()",function(e,t){return this.iterator("table",function(n){_t(n,!1===t,e)})});var xt=function(e,t){var o,r,s,a,l,c,u=[];for(e&&"string"!=typeof e&&e.length!==n||(e=[e]),s=0,a=e.length;a>s;s++)for(r=e[s]&&e[s].split?e[s].split(","):[e[s]],l=0,c=r.length;c>l;l++)(o=t("string"==typeof r[l]?i.trim(r[l]):r[l]))&&o.length&&u.push.apply(u,o);return u},St=function(e){return e||(e={}),e.filter&&!e.search&&(e.search=e.filter),{search:e.search||"none",order:e.order||"current",page:e.page||"all"}},kt=function(e){for(var t=0,n=e.length;n>t;t++)if(0<e[t].length)return e[0]=e[t],e.length=1,e.context=[e.context[t]],e;return e.length=0,e},Tt=function(e,t){var n,o,r,s=[],a=e.aiDisplay;n=e.aiDisplayMaster;var l=t.search;if(o=t.order,r=t.page,"ssp"==We(e))return"removed"===l?[]:dt(0,n.length);if("current"==r)for(n=e._iDisplayStart,o=e.fnDisplayEnd();o>n;n++)s.push(a[n]);else if("current"==o||"applied"==o)s="none"==l?n.slice():"applied"==l?a.slice():i.map(n,function(e){return-1===i.inArray(e,a)?e:null});else if("index"==o||"original"==o)for(n=0,o=e.aoData.length;o>n;n++)"none"==l?s.push(n):(r=i.inArray(n,a),(-1===r&&"removed"==l||r>=0&&"applied"==l)&&s.push(n));return s};Ke("rows()",function(e,t){e===n?e="":i.isPlainObject(e)&&(t=e,e="");var t=St(t),o=this.iterator("table",function(n){var o=t;return xt(e,function(e){var t=rt(e);if(null!==t&&!o)return[t];var r=Tt(n,o);if(null!==t&&-1!==i.inArray(t,r))return[t];if(!e)return r;for(var t=[],s=0,a=r.length;a>s;s++)t.push(n.aoData[r[s]].nTr);return e.nodeName&&-1!==i.inArray(e,t)?[e._DT_RowIndex]:i(t).filter(e).map(function(){return this._DT_RowIndex}).toArray()})});return o.selector.rows=e,o.selector.opts=t,o}),Ke("rows().nodes()",function(){return this.iterator("row",function(e,t){return e.aoData[t].nTr||n})}),Ke("rows().data()",function(){return this.iterator(!0,"rows",function(e,t){return ut(e.aoData,t,"_aData")})}),Qe("rows().cache()","row().cache()",function(e){return this.iterator("row",function(t,n){var i=t.aoData[n];return"search"===e?i._aFilterData:i._aSortData})}),Qe("rows().invalidate()","row().invalidate()",function(e){return this.iterator("row",function(t,n){I(t,n,e)})}),Qe("rows().indexes()","row().index()",function(){return this.iterator("row",function(e,t){return t})}),Qe("rows().remove()","row().remove()",function(){var e=this;return this.iterator("row",function(t,n,o){var r=t.aoData;r.splice(n,1);for(var s=0,a=r.length;a>s;s++)null!==r[s].nTr&&(r[s].nTr._DT_RowIndex=s);i.inArray(n,t.aiDisplay),D(t.aiDisplayMaster,n),D(t.aiDisplay,n),D(e[o],n,!1),je(t)})}),Ke("rows.add()",function(e){var t=this.iterator("table",function(t){var n,i,o,r=[];for(i=0,o=e.length;o>i;i++)n=e[i],r.push(n.nodeName&&"TR"===n.nodeName.toUpperCase()?C(t,n)[0]:w(t,n));return r}),n=this.rows(-1);return n.pop(),n.push.apply(n,t.toArray()),n}),Ke("row()",function(e,t){return kt(this.rows(e,t))}),Ke("row().data()",function(e){var t=this.context;return e===n?t.length&&this.length?t[0].aoData[this[0]]._aData:n:(t[0].aoData[this[0]]._aData=e,I(t[0],this[0],"data"),this)}),Ke("row().node()",function(){var e=this.context;return e.length&&this.length?e[0].aoData[this[0]].nTr||null:null}),Ke("row.add()",function(e){e instanceof i&&e.length&&(e=e[0]);var t=this.iterator("table",function(t){return e.nodeName&&"TR"===e.nodeName.toUpperCase()?C(t,e)[0]:w(t,e)});return this.row(t[0])});var $t=function(e){var t=e.context;t.length&&e.length&&(e=t[0].aoData[e[0]],e._details&&(e._details.remove(),e._detailsShow=n,e._details=n))},Et=function(e,t){var n=e.context;if(n.length&&e.length){var i=n[0].aoData[e[0]];if(i._details){(i._detailsShow=t)?i._details.insertAfter(i.nTr):i._details.detach();var o=n[0],r=new Ge(o),s=o.aoData;r.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details"),0<ct(s,"_details").length&&(r.on("draw.dt.DT_details",function(e,t){o===t&&r.rows({page:"current"}).eq(0).each(function(e){e=s[e],e._detailsShow&&e._details.insertAfter(e.nTr)})}),r.on("column-visibility.dt.DT_details",function(e,t){if(o===t)for(var n,i=m(t),r=0,a=s.length;a>r;r++)n=s[r],n._details&&n._details.children("td[colspan]").attr("colspan",i)}),r.on("destroy.dt.DT_details",function(e,t){if(o===t)for(var n=0,i=s.length;i>n;n++)s[n]._details&&$t(s[n])}))}}};Ke("row().child()",function(e,t){var o=this.context;if(e===n)return o.length&&this.length?o[0].aoData[this[0]]._details:n;if(!0===e)this.child.show();else if(!1===e)$t(this);else if(o.length&&this.length){var r=o[0],o=o[0].aoData[this[0]],s=[],a=function(e,t){if(e.nodeName&&"tr"===e.nodeName.toLowerCase())s.push(e);else{var n=i("<tr><td/></tr>").addClass(t);i("td",n).addClass(t).html(e)[0].colSpan=m(r),s.push(n[0])}};if(i.isArray(e)||e instanceof i)for(var l=0,c=e.length;c>l;l++)a(e[l],t);else a(e,t);o._details&&o._details.remove(),o._details=i(s),o._detailsShow&&o._details.insertAfter(o.nTr)}return this}),Ke(["row().child.show()","row().child().show()"],function(){return Et(this,!0),this}),Ke(["row().child.hide()","row().child().hide()"],function(){return Et(this,!1),this}),Ke(["row().child.remove()","row().child().remove()"],function(){return $t(this),this}),Ke("row().child.isShown()",function(){var e=this.context;return e.length&&this.length?e[0].aoData[this[0]]._detailsShow||!1:!1});var Dt=/^(.+):(name|visIdx|visible)$/;Ke("columns()",function(e,t){e===n?e="":i.isPlainObject(e)&&(t=e,e="");var t=St(t),o=this.iterator("table",function(t){var n=e,o=t.aoColumns,r=ct(o,"sName"),s=ct(o,"nTh");return xt(n,function(e){var n=rt(e);if(""===e)return dt(o.length);if(null!==n)return[n>=0?n:o.length+n];var a="string"==typeof e?e.match(Dt):"";if(!a)return i(s).filter(e).map(function(){return i.inArray(this,s)}).toArray();switch(a[2]){case"visIdx":case"visible":return e=parseInt(a[1],10),0>e?(n=i.map(o,function(e,t){return e.bVisible?t:null}),[n[n.length+e]]):[f(t,e)];case"name":return i.map(r,function(e,t){return e===a[1]?t:null})}})});return o.selector.cols=e,o.selector.opts=t,o}),Qe("columns().header()","column().header()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].nTh})}),Qe("columns().footer()","column().footer()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].nTf})}),Qe("columns().data()","column().data()",function(){return this.iterator("column-rows",function(e,t,n,i,o){for(var n=[],i=0,r=o.length;r>i;i++)n.push(_(e,o[i],t,""));return n})}),Qe("columns().cache()","column().cache()",function(e){return this.iterator("column-rows",function(t,n,i,o,r){return ut(t.aoData,r,"search"===e?"_aFilterData":"_aSortData",n)})}),Qe("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(e,t,n,i,o){return ut(e.aoData,o,"anCells",t)})}),Qe("columns().visible()","column().visible()",function(e,t){return this.iterator("column",function(o,r){var s;if(e===n)s=o.aoColumns[r].bVisible;else{var a=o.aoColumns;s=a[r];var l,c,u,d=o.aoData;if(e===n)s=s.bVisible;else{if(s.bVisible!==e){if(e){var h=i.inArray(!0,ct(a,"bVisible"),r+1);for(l=0,c=d.length;c>l;l++)u=d[l].nTr,a=d[l].anCells,u&&u.insertBefore(a[r],a[h]||null)}else i(ct(o.aoData,"anCells",r)).detach();s.bVisible=e,P(o,o.aoHeader),P(o,o.aoFooter),(t===n||t)&&(p(o),(o.oScroll.sX||o.oScroll.sY)&&fe(o)),Ue(o,null,"column-visibility",[o,r,e]),Me(o)}s=void 0}}return s})}),Qe("columns().indexes()","column().index()",function(e){return this.iterator("column",function(t,n){return"visible"===e?g(t,n):n})}),Ke("columns.adjust()",function(){return this.iterator("table",function(e){p(e)})}),Ke("column.index()",function(e,t){if(0!==this.context.length){var n=this.context[0];if("fromVisible"===e||"toData"===e)return f(n,t);if("fromData"===e||"toVisible"===e)return g(n,t)}}),Ke("column()",function(e,t){return kt(this.columns(e,t))}),Ke("cells()",function(e,t,o){if(i.isPlainObject(e)&&(typeof e.row!==n?(o=t,t=null):(o=e,e=null)),i.isPlainObject(t)&&(o=t,t=null),null===t||t===n)return this.iterator("table",function(t){var r,s,a,l,c,u=e,d=St(o),h=t.aoData,p=Tt(t,d),d=ut(h,p,"anCells"),f=i([].concat.apply([],d)),g=t.aoColumns.length;return xt(u,function(e){if(null===e||e===n){for(s=[],a=0,l=p.length;l>a;a++)for(r=p[a],c=0;g>c;c++)s.push({row:r,column:c});return s}return i.isPlainObject(e)?[e]:f.filter(e).map(function(e,t){return r=t.parentNode._DT_RowIndex,{row:r,column:i.inArray(t,h[r].anCells)}}).toArray()})});var r,s,a,l,c,u=this.columns(t,o),d=this.rows(e,o),h=this.iterator("table",function(e,t){for(r=[],s=0,a=d[t].length;a>s;s++)for(l=0,c=u[t].length;c>l;l++)r.push({row:d[t][s],column:u[t][l]});return r});return i.extend(h.selector,{cols:t,rows:e,opts:o}),h}),Qe("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(e,t,n){return e.aoData[t].anCells[n]})}),Ke("cells().data()",function(){return this.iterator("cell",function(e,t,n){return _(e,t,n)})}),Qe("cells().cache()","cell().cache()",function(e){return e="search"===e?"_aFilterData":"_aSortData",this.iterator("cell",function(t,n,i){return t.aoData[n][e][i]})}),Qe("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(e,t,n){return{row:t,column:n,columnVisible:g(e,n)}})}),Ke(["cells().invalidate()","cell().invalidate()"],function(e){var t=this.selector;return this.rows(t.rows,t.opts).invalidate(e),this}),Ke("cell()",function(e,t,n){return kt(this.cells(e,t,n))}),Ke("cell().data()",function(e){var t=this.context,i=this[0];return e===n?t.length&&i.length?_(t[0],i[0].row,i[0].column):n:(x(t[0],i[0].row,i[0].column,e),I(t[0],i[0].row,"data",i[0].column),this)}),Ke("order()",function(e,t){var o=this.context;return e===n?0!==o.length?o[0].aaSorting:n:("number"==typeof e?e=[[e,t]]:i.isArray(e[0])||(e=Array.prototype.slice.call(arguments)),this.iterator("table",function(t){t.aaSorting=e.slice()}))}),Ke("order.listener()",function(e,t,n){return this.iterator("table",function(i){Ee(i,e,t,n)})}),Ke(["columns().order()","column().order()"],function(e){var t=this;return this.iterator("table",function(n,o){var r=[];i.each(t[o],function(t,n){r.push([n,e])}),n.aaSorting=r})}),Ke("search()",function(e,t,o,r){
var s=this.context;return e===n?0!==s.length?s[0].oPreviousSearch.sSearch:n:this.iterator("table",function(n){n.oFeatures.bFilter&&Y(n,i.extend({},n.oPreviousSearch,{sSearch:e+"",bRegex:null===t?!1:t,bSmart:null===o?!0:o,bCaseInsensitive:null===r?!0:r}),1)})}),Qe("columns().search()","column().search()",function(e,t,o,r){return this.iterator("column",function(s,a){var l=s.aoPreSearchCols;return e===n?l[a].sSearch:void(s.oFeatures.bFilter&&(i.extend(l[a],{sSearch:e+"",bRegex:null===t?!1:t,bSmart:null===o?!0:o,bCaseInsensitive:null===r?!0:r}),Y(s,s.oPreviousSearch,1)))})}),Ke("state()",function(){return this.context.length?this.context[0].oSavedState:null}),Ke("state.clear()",function(){return this.iterator("table",function(e){e.fnStateSaveCallback.call(e.oInstance,e,{})})}),Ke("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null}),Ke("state.save()",function(){return this.iterator("table",function(e){Me(e)})}),qe.versionCheck=qe.fnVersionCheck=function(e){for(var t,n,i=qe.version.split("."),e=e.split("."),o=0,r=e.length;r>o;o++)if(t=parseInt(i[o],10)||0,n=parseInt(e[o],10)||0,t!==n)return t>n;return!0},qe.isDataTable=qe.fnIsDataTable=function(e){var t=i(e).get(0),n=!1;return i.each(qe.settings,function(e,i){(i.nTable===t||i.nScrollHead===t||i.nScrollFoot===t)&&(n=!0)}),n},qe.tables=qe.fnTables=function(e){return jQuery.map(qe.settings,function(t){return!e||e&&i(t.nTable).is(":visible")?t.nTable:void 0})},qe.camelToHungarian=r,Ke("$()",function(e,t){var n=this.rows(t).nodes(),n=i(n);return i([].concat(n.filter(e).toArray(),n.find(e).toArray()))}),i.each(["on","one","off"],function(e,t){Ke(t+"()",function(){var e=Array.prototype.slice.call(arguments);e[0].match(/\.dt\b/)||(e[0]+=".dt");var n=i(this.tables().nodes());return n[t].apply(n,e),this})}),Ke("clear()",function(){return this.iterator("table",function(e){E(e)})}),Ke("settings()",function(){return new Ge(this.context,this.context)}),Ke("data()",function(){return this.iterator("table",function(e){return ct(e.aoData,"_aData")}).flatten()}),Ke("destroy()",function(t){return t=t||!1,this.iterator("table",function(n){var o,r=n.nTableWrapper.parentNode,s=n.oClasses,a=n.nTable,l=n.nTBody,c=n.nTHead,u=n.nTFoot,d=i(a),l=i(l),h=i(n.nTableWrapper),p=i.map(n.aoData,function(e){return e.nTr});n.bDestroying=!0,Ue(n,"aoDestroyCallback","destroy",[n]),t||new Ge(n).columns().visible(!0),h.unbind(".DT").find(":not(tbody *)").unbind(".DT"),i(e).unbind(".DT-"+n.sInstance),a!=c.parentNode&&(d.children("thead").detach(),d.append(c)),u&&a!=u.parentNode&&(d.children("tfoot").detach(),d.append(u)),d.detach(),h.detach(),n.aaSorting=[],n.aaSortingFixed=[],De(n),i(p).removeClass(n.asStripeClasses.join(" ")),i("th, td",c).removeClass(s.sSortable+" "+s.sSortableAsc+" "+s.sSortableDesc+" "+s.sSortableNone),n.bJUI&&(i("th span."+s.sSortIcon+", td span."+s.sSortIcon,c).detach(),i("th, td",c).each(function(){var e=i("div."+s.sSortJUIWrapper,this);i(this).append(e.contents()),e.detach()})),!t&&r&&r.insertBefore(a,n.nTableReinsertBefore),l.children().detach(),l.append(p),d.css("width",n.sDestroyWidth).removeClass(s.sTable),(o=n.asDestroyStripes.length)&&l.children().each(function(e){i(this).addClass(n.asDestroyStripes[e%o])}),r=i.inArray(n,qe.settings),-1!==r&&qe.settings.splice(r,1)})}),qe.version="1.10.2",qe.settings=[],qe.models={},qe.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0},qe.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null},qe.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null},qe.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(e){try{return JSON.parse((-1===e.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+e.sInstance+"_"+location.pathname))}catch(t){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(e,t){try{(-1===e.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+e.sInstance+"_"+location.pathname,JSON.stringify(t))}catch(n){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:i.extend({},qe.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null},o(qe.defaults),qe.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null},o(qe.defaults.column),qe.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:n,oAjaxData:n,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==We(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==We(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var e=this._iDisplayLength,t=this._iDisplayStart,n=t+e,i=this.aiDisplay.length,o=this.oFeatures,r=o.bPaginate;return o.bServerSide?!1===r||-1===e?t+i:Math.min(t+e,this._iRecordsDisplay):!r||n>i||-1===e?i:n},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}},qe.ext=Ye={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:qe.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:qe.version},i.extend(Ye,{afnFiltering:Ye.search,aTypes:Ye.type.detect,ofnSearch:Ye.type.search,oSort:Ye.type.order,afnSortData:Ye.order,aoFeatures:Ye.feature,oApi:Ye.internal,oStdClasses:Ye.classes,oPagination:Ye.pager}),i.extend(qe.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var It="",It="",Mt=It+"ui-state-default",At=It+"css_right ui-icon ui-icon-",Ot=It+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";i.extend(qe.ext.oJUIClasses,qe.ext.classes,{sPageButton:"fg-button ui-button "+Mt,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:Mt+" sorting_asc",sSortDesc:Mt+" sorting_desc",sSortable:Mt+" sorting",sSortableAsc:Mt+" sorting_asc_disabled",sSortableDesc:Mt+" sorting_desc_disabled",sSortableNone:Mt+" sorting_disabled",sSortJUIAsc:At+"triangle-1-n",sSortJUIDesc:At+"triangle-1-s",sSortJUI:At+"carat-2-n-s",sSortJUIAscAllowed:At+"carat-1-n",sSortJUIDescAllowed:At+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+Mt,sScrollFoot:"dataTables_scrollFoot "+Mt,sHeaderTH:Mt,sFooterTH:Mt,sJUIHeader:Ot+" ui-corner-tl ui-corner-tr",sJUIFooter:Ot+" ui-corner-bl ui-corner-br"});var Rt=qe.ext.pager;i.extend(Rt,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},simple_numbers:function(e,t){return["previous",Be(e,t),"next"]},full_numbers:function(e,t){return["first","previous",Be(e,t),"next","last"]},_numbers:Be,numbers_length:7}),i.extend(!0,qe.ext.renderer,{pageButton:{_:function(e,n,o,r,s,a){var l,c,u=e.oClasses,d=e.oLanguage.oPaginate,h=0,p=function(t,n){var r,f,g,m,v=function(t){ue(e,t.data.action,!0)};for(r=0,f=n.length;f>r;r++)if(m=n[r],i.isArray(m))g=i("<"+(m.DT_el||"div")+"/>").appendTo(t),p(g,m);else{switch(c=l="",m){case"ellipsis":t.append("<span>&hellip;</span>");break;case"first":l=d.sFirst,c=m+(s>0?"":" "+u.sPageButtonDisabled);break;case"previous":l=d.sPrevious,c=m+(s>0?"":" "+u.sPageButtonDisabled);break;case"next":l=d.sNext,c=m+(a-1>s?"":" "+u.sPageButtonDisabled);break;case"last":l=d.sLast,c=m+(a-1>s?"":" "+u.sPageButtonDisabled);break;default:l=m+1,c=s===m?u.sPageButtonActive:""}l&&(g=i("<a>",{"class":u.sPageButton+" "+c,"aria-controls":e.sTableId,"data-dt-idx":h,tabindex:e.iTabIndex,id:0===o&&"string"==typeof m?e.sTableId+"_"+m:null}).html(l).appendTo(t),Le(g,{action:m},v),h++)}};try{var f=i(t.activeElement).data("dt-idx");p(i(n).empty(),r),null!==f&&i(n).find("[data-dt-idx="+f+"]").focus()}catch(g){}}}});var Pt=function(e,t,n,i){return e&&"-"!==e?(t&&(e=st(e,t)),e.replace&&(n&&(e=e.replace(n,"")),i&&(e=e.replace(i,""))),1*e):-(1/0)};return i.extend(Ye.type.order,{"date-pre":function(e){return Date.parse(e)||0},"html-pre":function(e){return ot(e)?"":e.replace?e.replace(/<.*?>/g,"").toLowerCase():e+""},"string-pre":function(e){return ot(e)?"":"string"==typeof e?e.toLowerCase():e.toString?e.toString():""},"string-asc":function(e,t){return t>e?-1:e>t?1:0},"string-desc":function(e,t){return t>e?1:e>t?-1:0}}),Ve(""),i.extend(qe.ext.type.detect,[function(e,t){var n=t.oLanguage.sDecimal;return at(e,n)?"num"+n:null},function(e){if(e&&(!et.test(e)||!tt.test(e)))return null;var t=Date.parse(e);return null!==t&&!isNaN(t)||ot(e)?"date":null},function(e,t){var n=t.oLanguage.sDecimal;return at(e,n,!0)?"num-fmt"+n:null},function(e,t){var n=t.oLanguage.sDecimal;return lt(e,n)?"html-num"+n:null},function(e,t){var n=t.oLanguage.sDecimal;return lt(e,n,!0)?"html-num-fmt"+n:null},function(e){return ot(e)||"string"==typeof e&&-1!==e.indexOf("<")?"html":null}]),i.extend(qe.ext.type.search,{html:function(e){return ot(e)?e:"string"==typeof e?e.replace(Je," ").replace(Ze,""):""},string:function(e){return ot(e)?e:"string"==typeof e?e.replace(Je," "):e}}),i.extend(!0,qe.ext.renderer,{header:{_:function(e,t,n,o){i(e.nTable).on("order.dt.DT",function(i,r,s,a){e===r&&(i=n.idx,t.removeClass(n.sSortingClass+" "+o.sSortAsc+" "+o.sSortDesc).addClass("asc"==a[i]?o.sSortAsc:"desc"==a[i]?o.sSortDesc:n.sSortingClass))})},jqueryui:function(e,t,n,o){var r=n.idx;i("<div/>").addClass(o.sSortJUIWrapper).append(t.contents()).append(i("<span/>").addClass(o.sSortIcon+" "+n.sSortingClassJUI)).appendTo(t),i(e.nTable).on("order.dt.DT",function(i,s,a,l){e===s&&(t.removeClass(o.sSortAsc+" "+o.sSortDesc).addClass("asc"==l[r]?o.sSortAsc:"desc"==l[r]?o.sSortDesc:n.sSortingClass),t.find("span."+o.sSortIcon).removeClass(o.sSortJUIAsc+" "+o.sSortJUIDesc+" "+o.sSortJUI+" "+o.sSortJUIAscAllowed+" "+o.sSortJUIDescAllowed).addClass("asc"==l[r]?o.sSortJUIAsc:"desc"==l[r]?o.sSortJUIDesc:n.sSortingClassJUI))})}}}),qe.render={number:function(e,t,n,i){return{display:function(o){var r=0>o?"-":"",o=Math.abs(parseFloat(o)),s=parseInt(o,10),o=n?t+(o-s).toFixed(n).substring(2):"";return r+(i||"")+s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e)+o}}}},i.extend(qe.ext.internal,{_fnExternApiFunc:ze,_fnBuildAjax:H,_fnAjaxUpdate:W,_fnAjaxParameters:B,_fnAjaxUpdateDraw:V,_fnAjaxDataSrc:z,_fnAddColumn:d,_fnColumnOptions:h,_fnAdjustColumnSizing:p,_fnVisibleToColumnIndex:f,_fnColumnIndexToVisible:g,_fnVisbleColumns:m,_fnGetColumns:v,_fnColumnTypes:b,_fnApplyColumnDefs:y,_fnHungarianMap:o,_fnCamelToHungarian:r,_fnLanguageCompat:s,_fnBrowserDetect:c,_fnAddData:w,_fnAddTr:C,_fnNodeToDataIndex:function(e,t){return t._DT_RowIndex!==n?t._DT_RowIndex:null},_fnNodeToColumnIndex:function(e,t,n){return i.inArray(n,e.aoData[t].anCells)},_fnGetCellData:_,_fnSetCellData:x,_fnSplitObjNotation:S,_fnGetObjectDataFn:k,_fnSetObjectDataFn:T,_fnGetDataMaster:$,_fnClearTable:E,_fnDeleteIndex:D,_fnInvalidateRow:I,_fnGetRowElements:M,_fnCreateTr:A,_fnBuildHead:R,_fnDrawHead:P,_fnDraw:N,_fnReDraw:L,_fnAddOptionsHtml:F,_fnDetectHeader:U,_fnGetUniqueThs:j,_fnFeatureHtmlFilter:q,_fnFilterComplete:Y,_fnFilterCustom:G,_fnFilterColumn:K,_fnFilter:Q,_fnFilterCreateSearch:X,_fnEscapeRegex:J,_fnFilterData:Z,_fnFeatureHtmlInfo:ne,_fnUpdateInfo:ie,_fnInfoMacros:oe,_fnInitialise:re,_fnInitComplete:se,_fnLengthChange:ae,_fnFeatureHtmlLength:le,_fnFeatureHtmlPaginate:ce,_fnPageChange:ue,_fnFeatureHtmlProcessing:de,_fnProcessingDisplay:he,_fnFeatureHtmlTable:pe,_fnScrollDraw:fe,_fnApplyToChildren:ge,_fnCalculateColumnWidths:me,_fnThrottle:ve,_fnConvertToWidth:be,_fnScrollingWidthAdjust:ye,_fnGetWidestNode:we,_fnGetMaxLenString:Ce,_fnStringToCss:_e,_fnScrollBarWidth:xe,_fnSortFlatten:Se,_fnSort:ke,_fnSortAria:Te,_fnSortListener:$e,_fnSortAttachListener:Ee,_fnSortingClasses:De,_fnSortData:Ie,_fnSaveState:Me,_fnLoadState:Ae,_fnSettingsFromNode:Oe,_fnLog:Re,_fnMap:Pe,_fnBindAction:Le,_fnCallbackReg:Fe,_fnCallbackFire:Ue,_fnLengthOverflow:je,_fnRenderer:He,_fnDataSource:We,_fnRowAttributes:O,_fnCalculateEnd:function(){}}),i.fn.dataTable=qe,i.fn.dataTableSettings=qe.settings,i.fn.dataTableExt=qe.ext,i.fn.DataTable=function(e){return i(this).dataTable(e).api()},i.each(qe,function(e,t){i.fn.DataTable[e]=t}),i.fn.dataTable};"function"==typeof define&&define.amd?define("datatables",["jquery"],i):"object"==typeof exports?i(require("jquery")):jQuery&&!jQuery.fn.dataTable&&i(jQuery)}(window,document),function(e){e.fn.columnFilter=function(t){function n(e,t,n,i,o){if("undefined"==typeof t)return new Array;"undefined"==typeof n&&(n=!0),"undefined"==typeof i&&(i=!0),"undefined"==typeof o&&(o=!0);var r;r=1==i?e.aiDisplay:e.aiDisplayMaster;for(var s=new Array,a=0,l=r.length;l>a;a++){iRow=r[a];var c=oTable.fnGetData(iRow),u=c[t];(1!=o||0!=u.length)&&(1==n&&jQuery.inArray(u,s)>-1||s.push(u))}return s.sort()}function i(e){return properties.bUseColVis?e:oTable.fnSettings().oApi._fnVisibleToColumnIndex(oTable.fnSettings(),e)}function o(t,n,o,r,s,a){var l="text_filter";r&&(l="number_filter"),p=p.replace(/(^\s*)|(\s*$)/g,"");var c=t.fnSettings().aoPreSearchCols[h].sSearch,u="search_init ",g=p;""!=c&&"^"!=c&&(g=r&&"^"==c.charAt(0)?c.substr(1):c,u="");var m=e('<input type="text" class="'+u+l+'" value="'+g+'"/>');void 0!=a&&-1!=a&&m.attr("maxlength",a),f.html(m),f.wrapInner(r?'<span class="filter_column filter_number" />':'<span class="filter_column filter_text" />'),d[h]=p;var v=h;m.keyup(r&&!t.fnSettings().oFeatures.bServerSide?function(){t.fnFilter("^"+this.value,i(v),!0,!1),b()}:function(){if(t.fnSettings().oFeatures.bServerSide&&0!=s){var r=(t.fnSettings().aoPreSearchCols[v].sSearch,e(this).data("dt-iLastFilterLength"));"undefined"==typeof r&&(r=0);var a=this.value.length;if(Math.abs(a-r)<s)return;e(this).data("dt-iLastFilterLength",a)}t.fnFilter(this.value,i(v),n,o),b()}),m.focus(function(){e(this).hasClass("search_init")&&(e(this).removeClass("search_init"),this.value="")}),m.blur(function(){""==this.value&&(e(this).addClass("search_init"),this.value=d[v])})}function r(t){f.html(u(0));var n=t.attr("id")+"_range_from_"+h,o=e('<input type="text" class="number_range_filter" id="'+n+'" rel="'+h+'"/>');f.append(o),f.append(u(1));var r=t.attr("id")+"_range_to_"+h,s=e('<input type="text" class="number_range_filter" id="'+r+'" rel="'+h+'"/>');f.append(s),f.append(u(2)),f.wrapInner('<span class="filterColumn filter_number_range" />');var a=h;v.push(h),t.dataTableExt.afnFiltering.push(function(e,o,s){if(t.attr("id")!=e.sTableId)return!0;var l=1*document.getElementById(n).value,c=1*document.getElementById(r).value,u="-"==o[i(a)]?0:1*o[i(a)];return""==l&&""==c?!0:""==l&&c>=u?!0:u>=l&&""==c?!0:u>=l&&c>=u?!0:!1}),e("#"+n+",#"+r,f).keyup(function(){var e=1*document.getElementById(n).value,i=1*document.getElementById(r).value;0!=e&&0!=i&&e>i||(t.fnDraw(),b())})}function s(t){f.html(u(0));var n=t.attr("id")+"_range_from_"+h,o=e('<input type="text" style="width: 90px" class="date_range_filter date-picker"   id="'+n+'" rel="'+h+'"/>');f.append(o),f.append(u(1));var r=t.attr("id")+"_range_to_"+h,s=e('<input type="text" style="width: 90px" class="date_range_filter date-picker"  id="'+r+'" rel="'+h+'"/>');f.append(s),f.append(u(2)),f.wrapInner('<span class="filterColumn filter_date_range" />');var a=h;v.push(h),t.dataTableExt.afnFiltering.push(function(o,s,l){if(t.attr("id")!=o.sTableId)return!0;var c=e("#"+n).val(),u=moment(c,"DD/MM/YYYY"),d=e("#"+r).val(),h=moment(d,"DD/MM/YYYY");if(null==c&&null==d)return!0;var p=null;try{if(null==s[i(a)])return!1;p=moment(s[i(a)],"D/M/YYYY")}catch(f){return!1}return null==p?!1:""==c&&h>=p?!0:p>=u&&""==d?!0:p>=u&&h>=p?!0:!1}),e("#"+n+",#"+r,f).change(function(){t.fnDraw(),b()})}function a(t,i,o,r,s,a){null==i&&(i=n(t.fnSettings(),o,!0,!1,!0));var l=t.fnSettings().aoPreSearchCols[h].sSearch,c='<select class="search_init select_filter"><option value="" class="search_init">'+s+"</option>",u=0,d=i.length;for(u=0;d>u;u++)if("object"!=typeof i[u]){var p="";escape(i[u])==l&&(p="selected "),c+="<option "+p+' value="'+escape(i[u])+'">'+i[u]+"</option>"}else{var p="";a?(i[u].value==l&&(p="selected "),c+="<option "+p+'value="'+i[u].value+'">'+i[u].label+"</option>"):(escape(i[u].value)==l&&(p="selected "),c+="<option "+p+'value="'+escape(i[u].value)+'">'+i[u].label+"</option>")}var f=e(c+"</select>");r.html(f),r.wrapInner('<span class="filterColumn filter_select" />'),f.change(function(){""!=e(this).val()?e(this).removeClass("search_init"):e(this).addClass("search_init"),a?t.fnFilter(e(this).val(),o,a):t.fnFilter(unescape(e(this).val()),o),b()})}function l(e,t,n){var o=e.fnSettings();null!=t||""==o.sAjaxSource||o.oFeatures.bServerSide||o.aoDrawCallback.push({fn:function(t,r,s){return function(){return 2!=o.iDraw||null==o.sAjaxSource||""==o.sAjaxSource||o.oFeatures.bServerSide?void 0:a(e,null,i(t),r,s,n)}}(h,f,p),sName:"column_filter_"+h}),a(e,t,i(h),f,p,n)}function c(t,i){null==i&&(i=n(t.fnSettings(),h,!0,!0,!0));var o,r=h,s="",a=i.length,l=p.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("£","STERL").replace("@","AT").replace(/\s/g,"_");l=l.replace(/[^a-zA-Z 0-9]+/g,""),labelBtn=null!=properties.sFilterButtonText||void 0!=properties.sFilterButtonText?properties.sFilterButtonText:p;var c=10,u=12,d=Math.floor(a/u);a%u>0&&(d+=1);var g=100/d-2,m=c*d;1==d&&(g=20);var v='<div style="float:left; min-width: '+g+'%; " >',y="</div>",w=t.attr("id")+l,C="chkBtnOpen"+w,_=w+"-flt-toggle";for(s+='<button id="'+C+'" class="checkbox_filter" > '+labelBtn+"</button>",s+='<div id="'+_+'" title="'+p+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+m+'%; " >',s+=v,o=0;a>o;o++){o%u==0&&0!=o&&(s+=y+v),s+='<input class="search_init checkbox_filter" type="checkbox" id= "'+i[o]+'" name= "'+l+'" value="'+i[o]+'" >'+i[o]+"<br/>";var x=e(s);f.html(x),f.wrapInner('<span class="filterColumn filter_checkbox" />'),x.change(function(){var n="",o="|",s=e('input:checkbox[name="'+l+'"]:checked').size();e('input:checkbox[name="'+l+'"]:checked').each(function(t){(0==t&&1==s||0!=t&&t==s-1)&&(o=""),n=n.replace(/^\s+|\s+$/g,""),n=n+e(this).val()+o,o="|"});for(var c=0;a>c;c++)""!=n?e("#"+i[c]).removeClass("search_init"):e("#"+i[c]).addClass("search_init");t.fnFilter(n,r,!0,!1),b()})}e("#"+C).button(),e("#"+_).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return e('input:checkbox[name="'+l+'"]:checked').each(function(t){e(this).attr("checked",!1),e(this).addClass("search_init")}),t.fnFilter("",r,!0,!1),b(),!1}},{text:"Close",click:function(){e(this).dialog("close")}}]}),e("#"+C).click(function(){e("#"+_).dialog("open");var t=e(this);return e("#"+_).dialog("widget").position({my:"top",at:"bottom",of:t}),!1});var S=b;b=function(){var t=e("#"+C);e("#"+_).dialog("widget").position({my:"top",at:"bottom",of:t}),S()}}function u(e){switch(e){case 0:return g.substring(0,g.indexOf("{from}"));case 1:return g.substring(g.indexOf("{from}")+6,g.indexOf("{to}"));default:return g.substring(g.indexOf("{to}")+4)}}var d,h,p,f,g="From {from} to {to}",m=new Array,v=new Array,b=function(){};oTable=this;var y={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}"};return properties=e.extend(y,t),this.each(function(){if(oTable.fnSettings().oFeatures.bFilter){d=new Array;var t="tfoot tr";if("head:after"==properties.sPlaceHolder){var n=e("thead tr:last",oTable).detach();oTable.fnSettings().bSortCellsTop?n.appendTo(e("thead",oTable)):n.prependTo(e("thead",oTable)),t="thead tr:last"}else if("head:before"==properties.sPlaceHolder){var n=e("thead tr:first",oTable).detach();oTable.fnSettings().bSortCellsTop?n.appendTo(e("thead",oTable)):n.prependTo(e("thead",oTable)),t="thead tr:first"}for(e(t+" th",oTable).each(function(t){h=t;var n={type:"text",bRegex:!1,bSmart:!0,iMaxLenght:-1,iFilterLength:0};if(null!=properties.aoColumns){if(properties.aoColumns.length<h||null==properties.aoColumns[h])return;n=properties.aoColumns[h]}if(p=e(this).text(),null==n.sSelector?f=e(e(this)[0]):(f=e(n.sSelector),0==f.length&&(f=e(e(this)[0]))),null!=n)switch(g=null!=n.sRangeFormat?n.sRangeFormat:properties.sRangeFormat,n.type){case"null":break;case"number":o(oTable,!0,!1,!0,n.iFilterLength,n.iMaxLenght);break;case"select":1!=n.bRegex&&(n.bRegex=!1),l(oTable,n.values,n.bRegex);break;case"number-range":r(oTable);break;case"date-range":s(oTable);break;case"checkbox":c(oTable,n.values);break;case"text":default:bRegex=null==n.bRegex?!1:n.bRegex,bSmart=null==n.bSmart?!1:n.bSmart,o(oTable,bRegex,bSmart,!1,n.iFilterLength,n.iMaxLenght)}}),j=0;j<v.length;j++){var i=function(){var t=oTable.attr("id");return e("#"+t+"_range_from_"+v[j]).val()+properties.sRangeSeparator+e("#"+t+"_range_to_"+v[j]).val()};m.push(i)}if(oTable.fnSettings().oFeatures.bServerSide){var a=oTable.fnSettings().fnServerData;oTable.fnSettings().fnServerData=function(t,n,i){for(j=0;j<v.length;j++){var o=v[j];for(k=0;k<n.length;k++)n[k].name=="sSearch_"+o&&(n[k].value=m[j]())}if(n.push({name:"sRangeSeparator",value:properties.sRangeSeparator}),null!=a)try{a(t,n,i,oTable.fnSettings())}catch(r){a(t,n,i)}else e.getJSON(t,n,function(e){i(e)})}}}})}}(jQuery),$.extend(!0,$.fn.dataTable.defaults,{dom:"<'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",language:{lengthMenu:" _MENU_ records ",paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'}}}),$.extend($.fn.dataTableExt.oStdClasses,{sWrapper:"dataTables_wrapper",sFilterInput:"form-control input-small input-inline",sLengthSelect:"form-control input-xsmall input-inline"}),$.fn.dataTable.defaults.renderer="bootstrap",$.fn.dataTable.ext.renderer.pageButton.bootstrap=function(e,t,n,i,o,r){var s,a,l=new $.fn.dataTable.Api(e),c=e.oClasses,u=e.oLanguage.oPaginate,d=function(t,i){var h,p,f,g,m=function(e){e.preventDefault(),"ellipsis"!==e.data.action&&l.page(e.data.action).draw(!1)};for(h=0,p=i.length;p>h;h++)if(g=i[h],$.isArray(g))d(t,g);else{switch(s="",a="",g){case"ellipsis":s="&hellip;",a="disabled";break;case"first":s=u.sFirst,a=g+(o>0?"":" disabled");break;case"previous":s=u.sPrevious,a=g+(o>0?"":" disabled");break;case"next":s=u.sNext,a=g+(r-1>o?"":" disabled");break;case"last":s=u.sLast,a=g+(r-1>o?"":" disabled");break;default:s=g+1,a=o===g?"active":""}s&&(f=$("<li>",{"class":c.sPageButton+" "+a,"aria-controls":e.sTableId,tabindex:e.iTabIndex,id:0===n&&"string"==typeof g?e.sTableId+"_"+g:null}).append($("<a>",{href:"#"}).html(s)).appendTo(t),e.oApi._fnBindAction(f,{action:g},m))}};d($(t).empty().html('<ul class="pagination"/>').children("ul"),i)},$.fn.DataTable.TableTools&&($.extend(!0,$.fn.DataTable.TableTools.classes,{container:"DTTT btn-group",buttons:{normal:"btn btn-default",disabled:"disabled"},collection:{container:"DTTT_dropdown dropdown-menu",buttons:{normal:"",disabled:"disabled"}},print:{info:"DTTT_Print_Info"},select:{row:"active"}}),$.extend(!0,$.fn.DataTable.TableTools.DEFAULTS.oTags,{collection:{container:"ul",button:"li",liner:"a"}})),$.fn.dataTableExt.oApi.fnPagingInfo=function(e){return{iStart:e._iDisplayStart,iEnd:e.fnDisplayEnd(),iLength:e._iDisplayLength,iTotal:e.fnRecordsTotal(),iFilteredTotal:e.fnRecordsDisplay(),iPage:-1===e._iDisplayLength?0:Math.ceil(e._iDisplayStart/e._iDisplayLength),iTotalPages:-1===e._iDisplayLength?0:Math.ceil(e.fnRecordsDisplay()/e._iDisplayLength)}},$.extend($.fn.dataTableExt.oPagination,{bootstrap_full_number:{fnInit:function(e,t,n){var i=e.oLanguage.oPaginate,o=function(t){t.preventDefault(),e.oApi._fnPageChange(e,t.data.action)&&n(e)};$(t).append('<ul class="pagination"><li class="prev disabled"><a href="#" title="'+i.sFirst+'"><i class="fa fa-angle-double-left"></i></a></li><li class="prev disabled"><a href="#" title="'+i.sPrevious+'"><i class="fa fa-angle-left"></i></a></li><li class="next disabled"><a href="#" title="'+i.sNext+'"><i class="fa fa-angle-right"></i></a></li><li class="next disabled"><a href="#" title="'+i.sLast+'"><i class="fa fa-angle-double-right"></i></a></li></ul>');var r=$("a",t);$(r[0]).bind("click.DT",{action:"first"},o),$(r[1]).bind("click.DT",{action:"previous"},o),$(r[2]).bind("click.DT",{action:"next"},o),$(r[3]).bind("click.DT",{action:"last"},o)},fnUpdate:function(e,t){var n,i,o,r,s,a=5,l=e.oInstance.fnPagingInfo(),c=e.aanFeatures.p,u=Math.floor(a/2);for(l.iTotalPages<a?(r=1,s=l.iTotalPages):l.iPage<=u?(r=1,s=a):l.iPage>=l.iTotalPages-u?(r=l.iTotalPages-a+1,s=l.iTotalPages):(r=l.iPage-u+1,s=r+a-1),n=0,iLen=c.length;n<iLen;n++){for(l.iTotalPages<=0?$(".pagination",c[n]).css("visibility","hidden"):$(".pagination",c[n]).css("visibility","visible"),$("li:gt(1)",c[n]).filter(":not(.next)").remove(),i=r;s>=i;i++)o=i==l.iPage+1?'class="active"':"",$("<li "+o+'><a href="#">'+i+"</a></li>").insertBefore($("li.next:first",c[n])[0]).bind("click",function(n){n.preventDefault(),e._iDisplayStart=(parseInt($("a",this).text(),10)-1)*l.iLength,t(e)});0===l.iPage?$("li.prev",c[n]).addClass("disabled"):$("li.prev",c[n]).removeClass("disabled"),l.iPage===l.iTotalPages-1||0===l.iTotalPages?$("li.next",c[n]).addClass("disabled"):$("li.next",c[n]).removeClass("disabled")}}}}),$.extend($.fn.dataTableExt.oPagination,{bootstrap_extended:{fnInit:function(e,t,n){var i=e.oLanguage.oPaginate,o=(e.oInstance.fnPagingInfo(),function(t){t.preventDefault(),e.oApi._fnPageChange(e,t.data.action)&&n(e)});$(t).append('<div class="pagination-panel"> '+i.page+' <a href="#" class="btn btn-sm default prev disabled" title="'+i.previous+'"><i class="fa fa-angle-left"></i></a><input type="text" class="pagination-panel-input form-control input-mini input-inline input-sm" maxlenght="5" style="text-align:center; margin: 0 5px;"><a href="#" class="btn btn-sm default next disabled" title="'+i.next+'"><i class="fa fa-angle-right"></i></a> '+i.pageOf+' <span class="pagination-panel-total"></span></div>');var r=$("a",t);$(r[0]).bind("click.DT",{action:"previous"},o),$(r[1]).bind("click.DT",{action:"next"},o),$(".pagination-panel-input",t).bind("change.DT",function(t){var i=e.oInstance.fnPagingInfo();t.preventDefault();var o=parseInt($(this).val());o>0&&o<=i.iTotalPages?e.oApi._fnPageChange(e,o-1)&&n(e):$(this).val(i.iPage+1)}),$(".pagination-panel-input",t).bind("keypress.DT",function(t){var i=e.oInstance.fnPagingInfo();if(13==t.which){var o=parseInt($(this).val());o>0&&o<=e.oInstance.fnPagingInfo().iTotalPages?e.oApi._fnPageChange(e,o-1)&&n(e):$(this).val(i.iPage+1),t.preventDefault()}})},fnUpdate:function(e,t){var n,i,o,r,s,a=5,l=e.oInstance.fnPagingInfo(),c=e.aanFeatures.p,u=Math.floor(a/2);for(l.iTotalPages<a?(r=1,s=l.iTotalPages):l.iPage<=u?(r=1,s=a):l.iPage>=l.iTotalPages-u?(r=l.iTotalPages-a+1,s=l.iTotalPages):(r=l.iPage-u+1,s=r+a-1),n=0,iLen=c.length;n<iLen;n++){var d=$(c[n]).parents(".dataTables_wrapper");for(l.iTotal<=0?$(".dataTables_paginate, .dataTables_length",d).hide():$(".dataTables_paginate, .dataTables_length",d).show(),l.iTotalPages<=0?$(".dataTables_paginate, .dataTables_length .seperator",d).hide():$(".dataTables_paginate, .dataTables_length .seperator",d).show(),$(".pagination-panel-total",c[n]).html(l.iTotalPages),$(".pagination-panel-input",c[n]).val(l.iPage+1),$("li:gt(1)",c[n]).filter(":not(.next)").remove(),i=r;s>=i;i++)o=i==l.iPage+1?'class="active"':"",$("<li "+o+'><a href="#">'+i+"</a></li>").insertBefore($("li.next:first",c[n])[0]).bind("click",function(n){n.preventDefault(),e._iDisplayStart=(parseInt($("a",this).text(),10)-1)*l.iLength,t(e)});0===l.iPage?$("a.prev",c[n]).addClass("disabled"):$("a.prev",c[n]).removeClass("disabled"),l.iPage===l.iTotalPages-1||0===l.iTotalPages?$("a.next",c[n]).addClass("disabled"):$("a.next",c[n]).removeClass("disabled")}}}}),function(e,t){function n(){return new Date(Date.UTC.apply(Date,arguments));

}function i(){var e=new Date;return n(e.getFullYear(),e.getMonth(),e.getDate())}function o(e){return function(){return this[e].apply(this,arguments)}}function r(t,n){function i(e,t){return t.toLowerCase()}var o,r=e(t).data(),s={},a=new RegExp("^"+n.toLowerCase()+"([A-Z])");n=new RegExp("^"+n.toLowerCase());for(var l in r)n.test(l)&&(o=l.replace(a,i),s[o]=r[l]);return s}function s(t){var n={};if(f[t]||(t=t.split("-")[0],f[t])){var i=f[t];return e.each(p,function(e,t){t in i&&(n[t]=i[t])}),n}}var a=e(window),l=function(){var t={get:function(e){return this.slice(e)[0]},contains:function(e){for(var t=e&&e.valueOf(),n=0,i=this.length;i>n;n++)if(this[n].valueOf()===t)return n;return-1},remove:function(e){this.splice(e,1)},replace:function(t){t&&(e.isArray(t)||(t=[t]),this.clear(),this.push.apply(this,t))},clear:function(){this.splice(0)},copy:function(){var e=new l;return e.replace(this),e}};return function(){var n=[];return n.push.apply(n,arguments),e.extend(n,t),n}}(),c=function(t,n){this.dates=new l,this.viewDate=i(),this.focusDate=null,this._process_options(n),this.element=e(t),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=e(g.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("rlobdatepicker-inline").appendTo(this.element):this.picker.addClass("rlobdatepicker-dropdown dropdown-menu"),this.o.rtl&&(this.picker.addClass("rlobdatepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("fa-angle-left fa-angle-right")),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",function(e,t){return parseInt(t)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};c.prototype={constructor:c,_process_options:function(t){this._o=e.extend({},this._o,t);var n=this.o=e.extend({},this._o),i=n.language;switch(f[i]||(i=i.split("-")[0],f[i]||(i=h.language)),n.language=i,n.startView){case 2:case"decade":n.startView=2;break;case 1:case"year":n.startView=1;break;default:n.startView=0}switch(n.minViewMode){case 1:case"months":n.minViewMode=1;break;case 2:case"years":n.minViewMode=2;break;default:n.minViewMode=0}n.startView=Math.max(n.startView,n.minViewMode),n.multidate!==!0&&(n.multidate=Number(n.multidate)||!1,n.multidate=n.multidate!==!1?Math.max(0,n.multidate):1),n.multidateSeparator=String(n.multidateSeparator),n.weekStart%=7,n.weekEnd=(n.weekStart+6)%7;var o=g.parseFormat(n.format);n.startDate!==-(1/0)&&(n.startDate=n.startDate?n.startDate instanceof Date?this._local_to_utc(this._zero_time(n.startDate)):g.parseDate(n.startDate,o,n.language):-(1/0)),n.endDate!==1/0&&(n.endDate=n.endDate?n.endDate instanceof Date?this._local_to_utc(this._zero_time(n.endDate)):g.parseDate(n.endDate,o,n.language):1/0),n.daysOfWeekDisabled=n.daysOfWeekDisabled||[],e.isArray(n.daysOfWeekDisabled)||(n.daysOfWeekDisabled=n.daysOfWeekDisabled.split(/[,\s]*/)),n.daysOfWeekDisabled=e.map(n.daysOfWeekDisabled,function(e){return parseInt(e,10)});var r=String(n.orientation).toLowerCase().split(/\s+/g),s=n.orientation.toLowerCase();if(r=e.grep(r,function(e){return/^auto|left|right|top|bottom$/.test(e)}),n.orientation={x:"auto",y:"auto"},s&&"auto"!==s)if(1===r.length)switch(r[0]){case"top":case"bottom":n.orientation.y=r[0];break;case"left":case"right":n.orientation.x=r[0]}else s=e.grep(r,function(e){return/^left|right$/.test(e)}),n.orientation.x=s[0]||"auto",s=e.grep(r,function(e){return/^top|bottom$/.test(e)}),n.orientation.y=s[0]||"auto"},_events:[],_secondaryEvents:[],_applyEvents:function(e){for(var n,i,o,r=0;r<e.length;r++)n=e[r][0],2===e[r].length?(i=t,o=e[r][1]):3===e[r].length&&(i=e[r][1],o=e[r][2]),n.on(o,i)},_unapplyEvents:function(e){for(var n,i,o,r=0;r<e.length;r++)n=e[r][0],2===e[r].length?(o=t,i=e[r][1]):3===e[r].length&&(o=e[r][1],i=e[r][2]),n.off(i,o)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){-1===e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:e.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){-1===e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:e.proxy(this.keydown,this)}],[this.component,{click:e.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:e.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:e.proxy(function(e){this._focused_from=e.target},this)}],[this.element,{blur:e.proxy(function(e){this._focused_from=e.target},this)}]),this._secondaryEvents=[[this.picker,{click:e.proxy(this.click,this)}],[e(window),{resize:e.proxy(this.place,this)}],[e(document),{"mousedown touchstart":e.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(t,n){var i=n||this.dates.get(-1),o=this._utc_to_local(i);this.element.trigger({type:t,date:o,dates:e.map(this.dates,this._utc_to_local),format:e.proxy(function(e,t){0===arguments.length?(e=this.dates.length-1,t=this.o.format):"string"==typeof e&&(t=e,e=this.dates.length-1),t=t||this.o.format;var n=this.dates.get(e);return g.formatDate(n,t,this.o.language)},this)})},show:function(){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.place(),this._attachSecondaryEvents(),this._trigger("show")},hide:function(){this.isInline||this.picker.is(":visible")&&(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().rlobdatepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(e){return e&&new Date(e.getTime()+6e4*e.getTimezoneOffset())},_local_to_utc:function(e){return e&&new Date(e.getTime()-6e4*e.getTimezoneOffset())},_zero_time:function(e){return e&&new Date(e.getFullYear(),e.getMonth(),e.getDate())},_zero_utc_time:function(e){return e&&new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))},getDates:function(){return e.map(this.dates,this._utc_to_local)},getUTCDates:function(){return e.map(this.dates,function(e){return new Date(e)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,t),this._trigger("changeDate"),this.setValue()},setUTCDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,e.map(t,this._utc_to_local)),this._trigger("changeDate"),this.setValue()},setDate:o("setDates"),setUTCDate:o("setUTCDates"),setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e).change():this.component&&this.element.find("input").val(e).change()},getFormattedDate:function(n){n===t&&(n=this.o.format);var i=this.o.language;return e.map(this.dates,function(e){return g.formatDate(e,n,i)}).join(this.o.multidateSeparator)},setStartDate:function(e){this._process_options({startDate:e}),this.update(),this.updateNavArrows()},setEndDate:function(e){this._process_options({endDate:e}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this._process_options({daysOfWeekDisabled:e}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var t=this.picker.outerWidth(),n=this.picker.outerHeight(),i=10,o=a.width(),r=a.height(),s=a.scrollTop(),l=parseInt(this.element.parents().filter(function(){return"auto"!==e(this).css("z-index")}).first().css("z-index"))+10,c=this.component?this.component.parent().offset():this.element.offset(),u=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),d=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),h=c.left,p=c.top;this.picker.removeClass("rlobdatepicker-orient-top rlobdatepicker-orient-bottom rlobdatepicker-orient-right rlobdatepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("rlobdatepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(h-=t-d)):(this.picker.addClass("rlobdatepicker-orient-left"),c.left<0?h-=c.left-i:c.left+t>o&&(h=o-t-i));var f,g,m=this.o.orientation.y;"auto"===m&&(f=-s+c.top-n,g=s+r-(c.top+u+n),m=Math.max(f,g)===g?"top":"bottom"),this.picker.addClass("rlobdatepicker-orient-"+m),"top"===m?p+=u:p-=n+parseInt(this.picker.css("padding-top")),this.picker.css({top:p,left:h,zIndex:l})}},_allow_update:!0,update:function(){if(this._allow_update){var t=this.dates.copy(),n=[],i=!1;arguments.length?(e.each(arguments,e.proxy(function(e,t){t instanceof Date&&(t=this._local_to_utc(t)),n.push(t)},this)),i=!0):(n=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),n=n&&this.o.multidate?n.split(this.o.multidateSeparator):[n],delete this.element.data().date),n=e.map(n,e.proxy(function(e){return g.parseDate(e,this.o.format,this.o.language)},this)),n=e.grep(n,e.proxy(function(e){return e<this.o.startDate||e>this.o.endDate||!e},this),!0),this.dates.replace(n),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),i?this.setValue():n.length&&String(t)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&t.length&&this._trigger("clearDate"),this.fill()}},fillDow:function(){var e=this.o.weekStart,t="<tr>";if(this.o.calendarWeeks){var n='<th class="cw">&nbsp;</th>';t+=n,this.picker.find(".rlobdatepicker-days thead tr:first-child").prepend(n)}for(;e<this.o.weekStart+7;)t+='<th class="dow">'+f[this.o.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".rlobdatepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;12>t;)e+='<span class="month">'+f[this.o.language].monthsShort[t++]+"</span>";this.picker.find(".rlobdatepicker-months td").html(e)},setRange:function(t){t&&t.length?this.range=e.map(t,function(e){return e.valueOf()}):delete this.range,this.fill()},getClassNames:function(t){var n=[],i=this.viewDate.getUTCFullYear(),o=this.viewDate.getUTCMonth(),r=new Date;return t.getUTCFullYear()<i||t.getUTCFullYear()===i&&t.getUTCMonth()<o?n.push("old"):(t.getUTCFullYear()>i||t.getUTCFullYear()===i&&t.getUTCMonth()>o)&&n.push("new"),this.focusDate&&t.valueOf()===this.focusDate.valueOf()&&n.push("focused"),this.o.todayHighlight&&t.getUTCFullYear()===r.getFullYear()&&t.getUTCMonth()===r.getMonth()&&t.getUTCDate()===r.getDate()&&n.push("today"),-1!==this.dates.contains(t)&&n.push("active"),(t.valueOf()<this.o.startDate||t.valueOf()>this.o.endDate||-1!==e.inArray(t.getUTCDay(),this.o.daysOfWeekDisabled))&&n.push("disabled"),this.range&&(t>this.range[0]&&t<this.range[this.range.length-1]&&n.push("range"),-1!==e.inArray(t.valueOf(),this.range)&&n.push("selected")),n},fill:function(){var i,o=new Date(this.viewDate),r=o.getUTCFullYear(),s=o.getUTCMonth(),a=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),l=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),c=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,u=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,d=f[this.o.language].today||f.en.today||"",h=f[this.o.language].clear||f.en.clear||"";this.picker.find(".rlobdatepicker-days thead th.rlobdatepicker-switch").text(f[this.o.language].months[s]+" "+r),this.picker.find("tfoot th.today").text(d).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(h).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=n(r,s-1,28),m=g.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(m),p.setUTCDate(m-(p.getUTCDay()-this.o.weekStart+7)%7);var v=new Date(p);v.setUTCDate(v.getUTCDate()+42),v=v.valueOf();for(var b,y=[];p.valueOf()<v;){if(p.getUTCDay()===this.o.weekStart&&(y.push("<tr>"),this.o.calendarWeeks)){var w=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),C=new Date(Number(w)+(11-w.getUTCDay())%7*864e5),_=new Date(Number(_=n(C.getUTCFullYear(),0,1))+(11-_.getUTCDay())%7*864e5),x=(C-_)/864e5/7+1;y.push('<td class="cw">'+x+"</td>")}if(b=this.getClassNames(p),b.push("day"),this.o.beforeShowDay!==e.noop){var S=this.o.beforeShowDay(this._utc_to_local(p));S===t?S={}:"boolean"==typeof S?S={enabled:S}:"string"==typeof S&&(S={classes:S}),S.enabled===!1&&b.push("disabled"),S.classes&&(b=b.concat(S.classes.split(/\s+/))),S.tooltip&&(i=S.tooltip)}b=e.unique(b),y.push('<td class="'+b.join(" ")+'"'+(i?' title="'+i+'"':"")+">"+p.getUTCDate()+"</td>"),p.getUTCDay()===this.o.weekEnd&&y.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".rlobdatepicker-days tbody").empty().append(y.join(""));var k=this.picker.find(".rlobdatepicker-months").find("th:eq(1)").text(r).end().find("span").removeClass("active");e.each(this.dates,function(e,t){t.getUTCFullYear()===r&&k.eq(t.getUTCMonth()).addClass("active")}),(a>r||r>c)&&k.addClass("disabled"),r===a&&k.slice(0,l).addClass("disabled"),r===c&&k.slice(u+1).addClass("disabled"),y="",r=10*parseInt(r/10,10);var T=this.picker.find(".rlobdatepicker-years").find("th:eq(1)").text(r+"-"+(r+9)).end().find("td");r-=1;for(var $,E=e.map(this.dates,function(e){return e.getUTCFullYear()}),D=-1;11>D;D++)$=["year"],-1===D?$.push("old"):10===D&&$.push("new"),-1!==e.inArray(r,E)&&$.push("active"),(a>r||r>c)&&$.push("disabled"),y+='<span class="'+$.join(" ")+'">'+r+"</span>",r+=1;T.html(y)},updateNavArrows:function(){if(this._allow_update){var e=new Date(this.viewDate),t=e.getUTCFullYear(),n=e.getUTCMonth();switch(this.viewMode){case 0:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&t<=this.o.startDate.getUTCFullYear()&&n<=this.o.startDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&t>=this.o.endDate.getUTCFullYear()&&n>=this.o.endDate.getUTCMonth()?{visibility:"hidden"}:{visibility:"visible"});break;case 1:case 2:this.picker.find(".prev").css(this.o.startDate!==-(1/0)&&t<=this.o.startDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"}),this.picker.find(".next").css(this.o.endDate!==1/0&&t>=this.o.endDate.getUTCFullYear()?{visibility:"hidden"}:{visibility:"visible"})}}},click:function(t){t.preventDefault();var i,o,r,s=e(t.target).closest("span, td, th");if(1===s.length)switch(s[0].nodeName.toLowerCase()){case"th":switch(s[0].className){case"rlobdatepicker-switch":this.showMode(1);break;case"prev":case"next":var a=g.modes[this.viewMode].navStep*("prev"===s[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,a),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,a),1===this.viewMode&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var l=new Date;l=n(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0),this.showMode(-2);var c="linked"===this.o.todayBtn?null:"view";this._setDate(l,c);break;case"clear":var u;this.isInput?u=this.element:this.component&&(u=this.element.find("input")),u&&u.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()}break;case"span":s.is(".disabled")||(this.viewDate.setUTCDate(1),s.is(".month")?(r=1,o=s.parent().find("span").index(s),i=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(o),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(n(i,o,r))):(r=1,o=0,i=parseInt(s.text(),10)||0,this.viewDate.setUTCFullYear(i),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(n(i,o,r))),this.showMode(-1),this.fill());break;case"td":s.is(".day")&&!s.is(".disabled")&&(r=parseInt(s.text(),10)||1,i=this.viewDate.getUTCFullYear(),o=this.viewDate.getUTCMonth(),s.is(".old")?0===o?(o=11,i-=1):o-=1:s.is(".new")&&(11===o?(o=0,i+=1):o+=1),this._setDate(n(i,o,r)))}this.picker.is(":visible")&&this._focused_from&&e(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(e){var t=this.dates.contains(e);if(e?-1!==t?this.dates.remove(t):this.dates.push(e):this.dates.clear(),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(e,t){t&&"date"!==t||this._toggle_multidate(e&&new Date(e)),t&&"view"!==t||(this.viewDate=e&&new Date(e)),this.fill(),this.setValue(),this._trigger("changeDate");var n;this.isInput?n=this.element:this.component&&(n=this.element.find("input")),n&&n.change(),!this.o.autoclose||t&&"date"!==t||this.hide()},moveMonth:function(e,n){if(!e)return t;if(!n)return e;var i,o,r=new Date(e.valueOf()),s=r.getUTCDate(),a=r.getUTCMonth(),l=Math.abs(n);if(n=n>0?1:-1,1===l)o=-1===n?function(){return r.getUTCMonth()===a}:function(){return r.getUTCMonth()!==i},i=a+n,r.setUTCMonth(i),(0>i||i>11)&&(i=(i+12)%12);else{for(var c=0;l>c;c++)r=this.moveMonth(r,n);i=r.getUTCMonth(),r.setUTCDate(s),o=function(){return i!==r.getUTCMonth()}}for(;o();)r.setUTCDate(--s),r.setUTCMonth(i);return r},moveYear:function(e,t){return this.moveMonth(e,12*t)},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(this.picker.is(":not(:visible)"))return void(27===e.keyCode&&this.show());var t,n,o,r=!1,s=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;t=37===e.keyCode?-1:1,e.ctrlKey?(n=this.moveYear(this.dates.get(-1)||i(),t),o=this.moveYear(s,t),this._trigger("changeYear",this.viewDate)):e.shiftKey?(n=this.moveMonth(this.dates.get(-1)||i(),t),o=this.moveMonth(s,t),this._trigger("changeMonth",this.viewDate)):(n=new Date(this.dates.get(-1)||i()),n.setUTCDate(n.getUTCDate()+t),o=new Date(s),o.setUTCDate(s.getUTCDate()+t)),this.dateWithinRange(n)&&(this.focusDate=this.viewDate=o,this.setValue(),this.fill(),e.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;t=38===e.keyCode?-1:1,e.ctrlKey?(n=this.moveYear(this.dates.get(-1)||i(),t),o=this.moveYear(s,t),this._trigger("changeYear",this.viewDate)):e.shiftKey?(n=this.moveMonth(this.dates.get(-1)||i(),t),o=this.moveMonth(s,t),this._trigger("changeMonth",this.viewDate)):(n=new Date(this.dates.get(-1)||i()),n.setUTCDate(n.getUTCDate()+7*t),o=new Date(s),o.setUTCDate(s.getUTCDate()+7*t)),this.dateWithinRange(n)&&(this.focusDate=this.viewDate=o,this.setValue(),this.fill(),e.preventDefault());break;case 32:break;case 13:s=this.focusDate||this.dates.get(-1)||this.viewDate,this._toggle_multidate(s),r=!0,this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(r){this._trigger(this.dates.length?"changeDate":"clearDate");var a;this.isInput?a=this.element:this.component&&(a=this.element.find("input")),a&&a.change()}},showMode:function(e){e&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".rlobdatepicker-"+g.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var u=function(t,n){this.element=e(t),this.inputs=e.map(n.inputs,function(e){return e.jquery?e[0]:e}),delete n.inputs,e(this.inputs).rlobdatepicker(n).bind("changeDate",e.proxy(this.dateUpdated,this)),this.pickers=e.map(this.inputs,function(t){return e(t).data("rlobdatepicker")}),this.updateDates()};u.prototype={updateDates:function(){this.dates=e.map(this.pickers,function(e){return e.getUTCDate()}),this.updateRanges()},updateRanges:function(){var t=e.map(this.dates,function(e){return e.valueOf()});e.each(this.pickers,function(e,n){n.setRange(t)})},dateUpdated:function(t){if(!this.updating){this.updating=!0;var n=e(t.target).data("rlobdatepicker"),i=n.getUTCDate(),o=e.inArray(t.target,this.inputs),r=this.inputs.length;if(-1!==o){if(e.each(this.pickers,function(e,t){t.getUTCDate()||t.setUTCDate(i)}),i<this.dates[o])for(;o>=0&&i<this.dates[o];)this.pickers[o--].setUTCDate(i);else if(i>this.dates[o])for(;r>o&&i>this.dates[o];)this.pickers[o++].setUTCDate(i);this.updateDates(),delete this.updating}}},remove:function(){e.map(this.pickers,function(e){e.remove()}),delete this.element.data().rlobdatepicker}};var d=e.fn.rlobdatepicker;e.fn.rlobdatepicker=function(n){var i=Array.apply(null,arguments);i.shift();var o;return this.each(function(){var a=e(this),l=a.data("rlobdatepicker"),d="object"==typeof n&&n;if(!l){var p=r(this,"date"),f=e.extend({},h,p,d),g=s(f.language),m=e.extend({},h,g,p,d);if(a.is(".input-daterange")||m.inputs){var v={inputs:m.inputs||a.find("input").toArray()};a.data("rlobdatepicker",l=new u(this,e.extend(m,v)))}else a.data("rlobdatepicker",l=new c(this,m))}return"string"==typeof n&&"function"==typeof l[n]&&(o=l[n].apply(l,i),o!==t)?!1:void 0}),o!==t?o:this};var h=e.fn.rlobdatepicker.defaults={autoclose:!1,beforeShowDay:e.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},p=e.fn.rlobdatepicker.locale_opts=["format","rtl","weekStart"];e.fn.rlobdatepicker.Constructor=c;var f=e.fn.rlobdatepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},g={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,g.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(e){var t=e.replace(this.validParts,"\x00").split("\x00"),n=e.match(this.validParts);if(!t||!t.length||!n||0===n.length)throw new Error("Invalid date format.");return{separators:t,parts:n}},parseDate:function(i,o,r){function s(){var e=this.slice(0,h[u].length),t=h[u].slice(0,e.length);return e===t}if(!i)return t;if(i instanceof Date)return i;"string"==typeof o&&(o=g.parseFormat(o));var a,l,u,d=/([\-+]\d+)([dmwy])/,h=i.match(/([\-+]\d+)([dmwy])/g);if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(i)){for(i=new Date,u=0;u<h.length;u++)switch(a=d.exec(h[u]),l=parseInt(a[1]),a[2]){case"d":i.setUTCDate(i.getUTCDate()+l);break;case"m":i=c.prototype.moveMonth.call(c.prototype,i,l);break;case"w":i.setUTCDate(i.getUTCDate()+7*l);break;case"y":i=c.prototype.moveYear.call(c.prototype,i,l)}return n(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),0,0,0)}h=i&&i.match(this.nonpunctuation)||[],i=new Date;var p,m,v={},b=["yyyy","yy","M","MM","m","mm","d","dd"],y={yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){if(isNaN(e))return e;for(t-=1;0>t;)t+=12;for(t%=12,e.setUTCMonth(t);e.getUTCMonth()!==t;)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}};y.M=y.MM=y.mm=y.m,y.dd=y.d,i=n(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);var w=o.parts.slice();if(h.length!==w.length&&(w=e(w).filter(function(t,n){return-1!==e.inArray(n,b)}).toArray()),h.length===w.length){var C;for(u=0,C=w.length;C>u;u++){if(p=parseInt(h[u],10),a=w[u],isNaN(p))switch(a){case"MM":m=e(f[r].months).filter(s),p=e.inArray(m[0],f[r].months)+1;break;case"M":m=e(f[r].monthsShort).filter(s),p=e.inArray(m[0],f[r].monthsShort)+1}v[a]=p}var _,x;for(u=0;u<b.length;u++)x=b[u],x in v&&!isNaN(v[x])&&(_=new Date(i),y[x](_,v[x]),isNaN(_)||(i=_))}return i},formatDate:function(t,n,i){if(!t)return"";"string"==typeof n&&(n=g.parseFormat(n));var o={d:t.getUTCDate(),D:f[i].daysShort[t.getUTCDay()],DD:f[i].days[t.getUTCDay()],m:t.getUTCMonth()+1,M:f[i].monthsShort[t.getUTCMonth()],MM:f[i].months[t.getUTCMonth()],yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear()};o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m,t=[];for(var r=e.extend([],n.separators),s=0,a=n.parts.length;a>=s;s++)r.length&&t.push(r.shift()),t.push(o[n.parts[s]]);return t.join("")},headTemplate:'<thead><tr><th class="prev"><i class="fa fa-angle-left"></i></th><th colspan="5" class="rlobdatepicker-switch"></th><th class="next"><i class="fa fa-angle-right"></i></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};g.template='<div class="rlobdatepicker"><div class="rlobdatepicker-days"><table class=" table-condensed">'+g.headTemplate+"<tbody></tbody>"+g.footTemplate+'</table></div><div class="rlobdatepicker-months"><table class="table-condensed">'+g.headTemplate+g.contTemplate+g.footTemplate+'</table></div><div class="rlobdatepicker-years"><table class="table-condensed">'+g.headTemplate+g.contTemplate+g.footTemplate+"</table></div></div>",e.fn.rlobdatepicker.DPGlobal=g,e.fn.rlobdatepicker.noConflict=function(){return e.fn.rlobdatepicker=d,this},e(document).on("focus.rlobdatepicker.data-api click.rlobdatepicker.data-api",'[data-provide="rlobdatepicker"]',function(t){var n=e(this);n.data("rlobdatepicker")||(t.preventDefault(),n.rlobdatepicker("show"))}),e(function(){e('[data-provide="rlobdatepicker-inline"]').rlobdatepicker()})}(window.jQuery),!function(e,t,n,i){"use strict";var o="datepaginator",r=function(t,n){this._element=t,this.$element=e(t),this._init(n)};r.defaults={fillWidth:!0,highlightSelectedDate:!0,highlightToday:!0,hint:"dddd, Do MMMM YYYY",injectStyle:!0,itemWidth:35,navItemWidth:20,offDays:"Sat,Sun",offDaysFormat:"ddd",onSelectedDateChanged:null,selectedDate:moment().clone().startOf("day"),selectedDateFormat:"YYYY-MM-DD",selectedItemWidth:140,showCalendar:!0,showOffDays:!0,showStartOfWeek:!0,size:i,startOfWeek:"Mon",startOfWeekFormat:"ddd",squareEdges:!1,text:"ddd<br/>Do",textSelected:"dddd<br/>Do, MMMM YYYY",useBootstrap2:!1,width:0},r.prototype={setSelectedDate:function(e,t){this._setSelectedDate(moment(e,t?t:this.options.selectedDateFormat)),this._render()},remove:function(){this._destroy(),e.removeData(this,"plugin_"+o)},_init:function(t){this.options=e.extend({},r.defaults,t),this.options.width?this.options.fillWidth=!1:(this.options.width=this.$element.width(),this.options.fillWidth=!0),"string"==typeof this.options.selectedDate&&(this.options.selectedDate=moment(this.options.selectedDate,this.options.selectedDateFormat).clone().startOf("day")),"small"===this.options.size?this.options.size="sm":"large"===this.options.size&&(this.options.size="lg"),this._destroy(),this._subscribeEvents(),this._render()},_unsubscribeEvents:function(){this.$element.off("click"),this.$element.off("selectedDateChanged")},_subscribeEvents:function(){this._unsubscribeEvents(),this.$element.on("click",e.proxy(this._clickedHandler,this)),"function"==typeof this.options.onSelectedDateChanged&&this.$element.on("selectedDateChanged",this.options.onSelectedDateChanged),this.options.fillWidth&&e(t).on("resize",e.proxy(this._resize,this))},_destroy:function(){this.initialized&&(this.$calendar&&this.$calendar.rlobdatepicker("remove"),this.$wrapper.remove(),this.$wrapper=null,this._unsubscribeEvents()),this.initialized=!1},_clickedHandler:function(t){t.preventDefault();var n=e(t.target),i=n.attr("class");-1!=i.indexOf("dp-nav-left")?this._back():-1!=i.indexOf("dp-nav-right")?this._forward():-1!=i.indexOf("dp-item")&&this._select(n.attr("data-moment"))},_setSelectedDate:function(e){!1===e.isSame(this.options.selectedDate)&&(this.options.selectedDate=e.startOf("day"),this.$element.trigger("selectedDateChanged",[e.clone()]))},_back:function(){this._setSelectedDate(this.options.selectedDate.clone().subtract("day",1)),this._render()},_forward:function(){this._setSelectedDate(this.options.selectedDate.clone().add("day",1)),this._render()},_select:function(e){this._setSelectedDate(moment(e,this.options.selectedDateFormat)),this._render()},_calendarSelect:function(e){this._setSelectedDate(moment(e.date)),this._render()},_resize:function(){this.options.width=this.$element.width(),this._render()},_render:function(){var t=this;this.initialized?this.$calendar&&this.$calendar.rlobdatepicker("remove"):(this.$element.addClass(this.options.useBootstrap2?"pagination":"").removeClass("datepaginator datepaginator-sm datepaginator-lg").addClass("sm"===this.options.size?"datepaginator-sm":"lg"===this.options.size?"datepaginator-lg":"datepaginator"),this.$wrapper=e(this._template.list),this.$leftNav=e(this._template.listItem).append(e(this._template.navItem).addClass("dp-nav-left").addClass("sm"===this.options.size?"dp-nav-sm":"lg"===this.options.size?"dp-nav-lg":"").addClass(this.options.squareEdges?"dp-nav-square-edges":"").append(e(this._template.icon).addClass("fa-angle-left").addClass("dp-nav-left")).width(this.options.navItemWidth)),this.$rightNav=e(this._template.listItem).append(e(this._template.navItem).addClass("dp-nav-right").addClass("sm"===this.options.size?"dp-nav-sm":"lg"===this.options.size?"dp-nav-lg":"").addClass(this.options.squareEdges?"dp-nav-square-edges":"").append(e(this._template.icon).addClass("fa-angle-right").addClass("dp-nav-right")).width(this.options.navItemWidth)),this.$calendar=this.options.showCalendar?e(this._template.calendar):i,this._injectStyle(),this.initialized=!0),this.$element.empty().append(this.$wrapper.empty()),this.$wrapper.append(this.$leftNav),e.each(this._buildData(),function(n,i){var o=e(t._template.dateItem).attr("data-moment",i.m).attr("title",i.hint).width(i.itemWidth);i.isSelected&&t.options.highlightSelectedDate&&o.addClass("dp-selected"),i.isToday&&t.options.highlightToday&&o.addClass("dp-today"),i.isStartOfWeek&&t.options.showStartOfWeek&&o.addClass("dp-divider"),i.isOffDay&&t.options.showOffDays&&o.addClass("dp-off"),i.isSelected&&t.options.showCalendar&&o.append(t.$calendar),"sm"===t.options.size?o.addClass("dp-item-sm"):"lg"===t.options.size&&o.addClass("dp-item-lg"),o.append(i.text),t.$wrapper.append(e(t._template.listItem).append(o))}),this.$wrapper.append(this.$rightNav),this.$calendar&&this.$calendar.rlobdatepicker({autoclose:!0,forceParse:!0,startView:0,minView:0,todayHighlight:!0}).rlobdatepicker("update",this.options.selectedDate.toDate()).on("changeDate",e.proxy(this._calendarSelect,this))},_injectStyle:function(){this.options.injectStyle&&!n.getElementById("bootstrap-datepaginator-style")&&e("<style type='text/css' id='bootstrap-datepaginator-style'> "+this._css+" </style>").appendTo("head");

},_buildData:function(){for(var e=this.options.width-(this.options.selectedItemWidth-this.options.itemWidth+2*this.options.navItemWidth),t=Math.floor(e/this.options.itemWidth),n=parseInt(t/2),i=Math.floor(e/t),o=Math.floor(this.options.selectedItemWidth+(e-t*i)),r=moment().startOf("day"),s=this.options.selectedDate.clone().subtract("days",n),a=this.options.selectedDate.clone().add("days",t-n),l=new Array,c=s;c.isBefore(a);c.add("days",1))l[l.length]={m:c.clone().format(this.options.selectedDateFormat),isSelected:c.isSame(this.options.selectedDate)?!0:!1,isToday:c.isSame(r)?!0:!1,isOffDay:-1!==this.options.offDays.split(",").indexOf(c.format(this.options.offDaysFormat))?!0:!1,isStartOfWeek:-1!==this.options.startOfWeek.split(",").indexOf(c.format(this.options.startOfWeekFormat))?!0:!1,text:c.format(c.isSame(this.options.selectedDate)?this.options.textSelected:this.options.text),hint:c.format(this.options.hint),itemWidth:c.isSame(this.options.selectedDate)?o:i};return l},_template:{list:'<ul class="pagination"></ul>',listItem:"<li></li>",navItem:'<a href="#" class="dp-nav"></a>',dateItem:'<a href="#" class="dp-item"></a>',icon:'<i class="fa"></i>',calendar:'<i id="dp-calendar" class="glyphicon glyphicon-calendar"></i>'},_css:".datepaginator{font-size:12px;height:60px}.datepaginator-sm{font-size:10px;height:40px}.datepaginator-lg{font-size:14px;height:80px}.pagination{margin:0;padding:0;white-space:nowrap}.dp-nav{height:60px;padding:22px 0!important;width:20px;margin:0!important;text-align:center}.dp-nav-square-edges{border-radius:0!important}.dp-item{height:60px;padding:13px 0!important;width:35px;margin:0!important;border-left-style:hidden!important;text-align:center}.dp-item-sm{height:40px!important;padding:5px!important}.dp-item-lg{height:80px!important;padding:22px 0!important}.dp-nav-sm{height:40px!important;padding:11px 0!important}.dp-nav-lg{height:80px!important;padding:33px 0!important}a.dp-nav-right{border-left-style:hidden!important}.dp-divider{border-left:2px solid #ddd!important}.dp-off{background-color:#F0F0F0!important}.dp-today{background-color:#88B5DB!important;color:#fff!important}.dp-selected{background-color:#428bca!important;color:#fff!important;width:140px}#dp-calendar{padding:3px 5px 0 0!important;position:absolute;right:0;top:10}"};var s=function(e){t.console&&t.console.error(e)};e.fn[o]=function(t,n){return this.each(function(){var i=e.data(this,"plugin_"+o);"string"==typeof t?i?e.isFunction(i[t])&&"_"!==t.charAt(0)?("string"==typeof n&&(n=[n]),i[t].apply(i,n)):s("No such method : "+t):s("Not initialized, can not call method : "+t):i?i._init(t):e.data(this,"plugin_"+o,new r(this,t))})}}(jQuery,window,document);var UIDatepaginator=function(){return{init:function(){$("#datepaginator_sample_1").datepaginator(),$("#datepaginator_sample_2").datepaginator({size:"large"}),$("#datepaginator_sample_3").datepaginator({size:"small"}),$("#datepaginator_sample_4").datepaginator({onSelectedDateChanged:function(e,t){alert("Selected date: "+moment(t).format("Do, MMM YYYY"))}})}}}();!function(e){var t=function(t,i){if(this.$element=e(t),this.$note=e('<div class="alert"></div>'),this.options=e.extend(!0,{},e.fn.notify.defaults,i),this.options.transition?"fade"==this.options.transition?this.$note.addClass("in").addClass(this.options.transition):this.$note.addClass(this.options.transition):this.$note.addClass("fade").addClass("in"),this.$note.addClass(this.options.type?"alert-"+this.options.type:"alert-success"),this.options.message||""===this.$element.data("message")?"object"==typeof this.options.message?this.options.message.html?this.$note.html(this.options.message.html):this.options.message.text&&this.$note.text(this.options.message.text):this.$note.html(this.options.message):this.$note.html(this.$element.data("message")),this.options.closable){var o=e('<a class="close pull-right" href="#">&times;</a>');e(o).on("click",e.proxy(n,this)),this.$note.prepend(o)}return this},n=function(){return this.options.onClose(),e(this.$note).remove(),this.options.onClosed(),!1};t.prototype.show=function(){this.options.fadeOut.enabled&&this.$note.delay(this.options.fadeOut.delay||3e3).fadeOut("slow",e.proxy(n,this)),this.$element.append(this.$note),this.$note.alert()},t.prototype.hide=function(){this.options.fadeOut.enabled?this.$note.delay(this.options.fadeOut.delay||3e3).fadeOut("slow",e.proxy(n,this)):n.call(this)},e.fn.notify=function(e){return new t(this,e)},e.fn.notify.defaults={type:"success",closable:!0,transition:"fade",fadeOut:{enabled:!0,delay:3e3},message:null,onClose:function(){},onClosed:function(){}}}(window.jQuery),function(){var e,t,n,i,o,r,s,a,l=[].slice,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};s=function(){},t=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,n,i,o,r;if(i=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],this._callbacks=this._callbacks||{},n=this._callbacks[i])for(o=0,r=n.length;r>o;o++)t=n[o],t.apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var n,i,o,r,s;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(i=this._callbacks[e],!i)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(o=r=0,s=i.length;s>r;o=++r)if(n=i[o],n===t){i.splice(o,1);break}return this},e}(),e=function(e){function n(e,t){var o,r,s;if(this.element=e,this.version=n.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(n.instances.push(this),this.element.dropzone=this,o=null!=(s=n.optionsForElement(this.element))?s:{},this.options=i({},this.defaultOptions,o,null!=t?t:{}),this.options.forceFallback||!n.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(r=this.getExistingFallback())&&r.parentNode&&r.parentNode.removeChild(r),this.options.previewsContainer!==!1&&(this.previewsContainer=this.options.previewsContainer?n.getElement(this.options.previewsContainer,"previewsContainer"):this.element),this.options.clickable&&(this.clickableElements=this.options.clickable===!0?[this.element]:n.getElements(this.options.clickable,"clickable")),this.init()}var i,o;return u(n,e),n.prototype.Emitter=t,n.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],n.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload!",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return s},forceFallback:!1,fallback:function(){var e,t,i,o,r,s;for(this.element.className=""+this.element.className+" dz-browser-not-supported",s=this.element.getElementsByTagName("div"),o=0,r=s.length;r>o;o++)e=s[o],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=n.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),i=t.getElementsByTagName("span")[0],i&&(i.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,n,i;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},n=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=n*t.optHeight:null==t.optHeight&&(t.optHeight=1/n*t.optWidth),i=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):n>i?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*i):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/i),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:s,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:s,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,i,o,r,s,a,l,c,u,d,h,p,f;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=n.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),d=e.previewElement.querySelectorAll("[data-dz-name]"),r=0,l=d.length;l>r;r++)t=d[r],t.textContent=e.name;for(h=e.previewElement.querySelectorAll("[data-dz-size]"),s=0,c=h.length;c>s;s++)t=h[s],t.innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=n.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),i=function(t){return function(i){return i.preventDefault(),i.stopPropagation(),e.status===n.UPLOADING?n.confirm(t.options.dictCancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dictRemoveFileConfirmation?n.confirm(t.options.dictRemoveFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),p=e.previewElement.querySelectorAll("[data-dz-remove]"),f=[],a=0,u=p.length;u>a;a++)o=p[a],f.push(o.addEventListener("click",i));return f}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var n,i,o,r;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),r=e.previewElement.querySelectorAll("[data-dz-thumbnail]"),i=0,o=r.length;o>i;i++)n=r[i],n.alt=e.name,n.src=t;return setTimeout(function(t){return function(){return e.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(e,t){var n,i,o,r,s;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),r=e.previewElement.querySelectorAll("[data-dz-errormessage]"),s=[],i=0,o=r.length;o>i;i++)n=r[i],s.push(n.textContent=t);return s}},errormultiple:s,processing:function(e){return e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink)?e._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:s,uploadprogress:function(e,t,n){var i,o,r,s,a;if(e.previewElement){for(s=e.previewElement.querySelectorAll("[data-dz-uploadprogress]"),a=[],o=0,r=s.length;r>o;o++)i=s[o],a.push("PROGRESS"===i.nodeName?i.value=t:i.style.width=""+t+"%");return a}},totaluploadprogress:s,sending:s,sendingmultiple:s,success:function(e){return e.previewElement?e.previewElement.classList.add("dz-success"):void 0},successmultiple:s,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:s,complete:function(e){return e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement?e.previewElement.classList.add("dz-complete"):void 0},completemultiple:s,maxfilesexceeded:s,maxfilesreached:s,queuecomplete:s,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},i=function(){var e,t,n,i,o,r,s;for(i=arguments[0],n=2<=arguments.length?l.call(arguments,1):[],r=0,s=n.length;s>r;r++){t=n[r];for(e in t)o=t[e],i[e]=o}return i},n.prototype.getAcceptedFiles=function(){var e,t,n,i,o;for(i=this.files,o=[],t=0,n=i.length;n>t;t++)e=i[t],e.accepted&&o.push(e);return o},n.prototype.getRejectedFiles=function(){var e,t,n,i,o;for(i=this.files,o=[],t=0,n=i.length;n>t;t++)e=i[t],e.accepted||o.push(e);return o},n.prototype.getFilesWithStatus=function(e){var t,n,i,o,r;for(o=this.files,r=[],n=0,i=o.length;i>n;n++)t=o[n],t.status===e&&r.push(t);return r},n.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(n.QUEUED)},n.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(n.UPLOADING)},n.prototype.getActiveFiles=function(){var e,t,i,o,r;for(o=this.files,r=[],t=0,i=o.length;i>t;t++)e=o[t],(e.status===n.UPLOADING||e.status===n.QUEUED)&&r.push(e);return r},n.prototype.init=function(){var e,t,i,o,r,s,a;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(n.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(i=function(e){return function(){return e.hiddenFileInput&&document.body.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="dz-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0",document.body.appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,n,o,r;if(n=e.hiddenFileInput.files,n.length)for(o=0,r=n.length;r>o;o++)t=n[o],e.addFile(t);return i()})}}(this))(),this.URL=null!=(s=window.URL)?s:window.webkitURL,a=this.events,o=0,r=a.length;r>o;o++)e=a[o],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){return 0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length?setTimeout(function(){return e.emit("queuecomplete")},0):void 0}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(n){return t(n),e.emit("dragenter",n)}}(this),dragover:function(e){return function(n){var i;try{i=n.dataTransfer.effectAllowed}catch(o){}return n.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t(n),e.emit("dragover",n)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(n){return t(n),e.drop(n)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(i){return t!==e.element||i.target===e.element||n.elementInside(i.target,e.element.querySelector(".dz-message"))?e.hiddenFileInput.click():void 0}}})}}(this)),this.enable(),this.options.init.call(this)},n.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,n.instances.splice(n.instances.indexOf(this),1)},n.prototype.updateTotalUploadProgress=function(){var e,t,n,i,o,r,s,a;if(i=0,n=0,e=this.getActiveFiles(),e.length){for(a=this.getActiveFiles(),r=0,s=a.length;s>r;r++)t=a[r],i+=t.upload.bytesSent,n+=t.upload.total;o=100*i/n}else o=100;return this.emit("totaluploadprogress",o,n,i)},n.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},n.prototype.getFallbackForm=function(){var e,t,i,o;return(e=this.getExistingFallback())?e:(i='<div class="dz-fallback">',this.options.dictFallbackText&&(i+="<p>"+this.options.dictFallbackText+"</p>"),i+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=n.createElement(i),"FORM"!==this.element.tagName?(o=n.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),o.appendChild(t)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=o?o:t)},n.prototype.getExistingFallback=function(){var e,t,n,i,o,r;for(t=function(e){var t,n,i;for(n=0,i=e.length;i>n;n++)if(t=e[n],/(^| )fallback($| )/.test(t.className))return t},r=["div","form"],i=0,o=r.length;o>i;i++)if(n=r[i],e=t(this.element.getElementsByTagName(n)))return e},n.prototype.setupEventListeners=function(){var e,t,n,i,o,r,s;for(r=this.listeners,s=[],i=0,o=r.length;o>i;i++)e=r[i],s.push(function(){var i,o;i=e.events,o=[];for(t in i)n=i[t],o.push(e.element.addEventListener(t,n,!1));return o}());return s},n.prototype.removeEventListeners=function(){var e,t,n,i,o,r,s;for(r=this.listeners,s=[],i=0,o=r.length;o>i;i++)e=r[i],s.push(function(){var i,o;i=e.events,o=[];for(t in i)n=i[t],o.push(e.element.removeEventListener(t,n,!1));return o}());return s},n.prototype.disable=function(){var e,t,n,i,o;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),i=this.files,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(this.cancelUpload(e));return o},n.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},n.prototype.filesize=function(e){var t,n,i,o,r,s,a,l;for(s=["TB","GB","MB","KB","b"],i=o=null,n=a=0,l=s.length;l>a;n=++a)if(r=s[n],t=Math.pow(this.options.filesizeBase,4-n)/10,e>=t){i=e/Math.pow(this.options.filesizeBase,4-n),o=r;break}return i=Math.round(10*i)/10,"<strong>"+i+"</strong> "+o},n.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},n.prototype.drop=function(e){var t,n;e.dataTransfer&&(this.emit("drop",e),t=e.dataTransfer.files,t.length&&(n=e.dataTransfer.items,n&&n.length&&null!=n[0].webkitGetAsEntry?this._addFilesFromItems(n):this.handleFiles(t)))},n.prototype.paste=function(e){var t,n;return null!=(null!=e&&null!=(n=e.clipboardData)?n.items:void 0)?(this.emit("paste",e),t=e.clipboardData.items,t.length?this._addFilesFromItems(t):void 0):void 0},n.prototype.handleFiles=function(e){var t,n,i,o;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],o.push(this.addFile(t));return o},n.prototype._addFilesFromItems=function(e){var t,n,i,o,r;for(r=[],i=0,o=e.length;o>i;i++)n=e[i],r.push(null!=n.webkitGetAsEntry&&(t=n.webkitGetAsEntry())?t.isFile?this.addFile(n.getAsFile()):t.isDirectory?this._addFilesFromDirectory(t,t.name):void 0:null!=n.getAsFile&&(null==n.kind||"file"===n.kind)?this.addFile(n.getAsFile()):void 0);return r},n.prototype._addFilesFromDirectory=function(e,t){var n,i;return n=e.createReader(),i=function(e){return function(n){var i,o,r;for(o=0,r=n.length;r>o;o++)i=n[o],i.isFile?i.file(function(n){return e.options.ignoreHiddenFiles&&"."===n.name.substring(0,1)?void 0:(n.fullPath=""+t+"/"+n.name,e.addFile(n))}):i.isDirectory&&e._addFilesFromDirectory(i,""+t+"/"+i.name)}}(this),n.readEntries(i,function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0})},n.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):n.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},n.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=n.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(n){return n?(e.accepted=!1,t._errorProcessing([e],n)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},n.prototype.enqueueFiles=function(e){var t,n,i;for(n=0,i=e.length;i>n;n++)t=e[n],this.enqueueFile(t);return null},n.prototype.enqueueFile=function(e){if(e.status!==n.ADDED||e.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return e.status=n.QUEUED,this.options.autoProcessQueue?setTimeout(function(e){return function(){return e.processQueue()}}(this),0):void 0},n.prototype._thumbnailQueue=[],n.prototype._processingThumbnail=!1,n.prototype._enqueueThumbnail=function(e){return this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)):void 0},n.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this)))},n.prototype.removeFile=function(e){return e.status===n.UPLOADING&&this.cancelUpload(e),this.files=a(this.files,e),this.emit("removedfile",e),0===this.files.length?this.emit("reset"):void 0},n.prototype.removeAllFiles=function(e){var t,i,o,r;for(null==e&&(e=!1),r=this.files.slice(),i=0,o=r.length;o>i;i++)t=r[i],(t.status!==n.UPLOADING||e)&&this.removeFile(t);return null},n.prototype.createThumbnail=function(e,t){var n;return n=new FileReader,n.onload=function(i){return function(){return"image/svg+xml"===e.type?(i.emit("thumbnail",e,n.result),void(null!=t&&t())):i.createThumbnailFromUrl(e,n.result,t)}}(this),n.readAsDataURL(e)},n.prototype.createThumbnailFromUrl=function(e,t,n){var i;return i=document.createElement("img"),i.onload=function(t){return function(){var o,s,a,l,c,u,d,h;return e.width=i.width,e.height=i.height,a=t.options.resize.call(t,e),null==a.trgWidth&&(a.trgWidth=a.optWidth),null==a.trgHeight&&(a.trgHeight=a.optHeight),o=document.createElement("canvas"),s=o.getContext("2d"),o.width=a.trgWidth,o.height=a.trgHeight,r(s,i,null!=(c=a.srcX)?c:0,null!=(u=a.srcY)?u:0,a.srcWidth,a.srcHeight,null!=(d=a.trgX)?d:0,null!=(h=a.trgY)?h:0,a.trgWidth,a.trgHeight),l=o.toDataURL("image/png"),t.emit("thumbnail",e,l),null!=n?n():void 0}}(this),null!=n&&(i.onerror=n),i.src=t},n.prototype.processQueue=function(){var e,t,n,i;if(t=this.options.parallelUploads,n=this.getUploadingFiles().length,e=n,!(n>=t)&&(i=this.getQueuedFiles(),i.length>0)){if(this.options.uploadMultiple)return this.processFiles(i.slice(0,t-n));for(;t>e;){if(!i.length)return;this.processFile(i.shift()),e++}}},n.prototype.processFile=function(e){return this.processFiles([e])},n.prototype.processFiles=function(e){var t,i,o;for(i=0,o=e.length;o>i;i++)t=e[i],t.processing=!0,t.status=n.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},n.prototype._getFilesWithXhr=function(e){var t,n;return n=function(){var n,i,o,r;for(o=this.files,r=[],n=0,i=o.length;i>n;n++)t=o[n],t.xhr===e&&r.push(t);return r}.call(this)},n.prototype.cancelUpload=function(e){var t,i,o,r,s,a,l;if(e.status===n.UPLOADING){for(i=this._getFilesWithXhr(e.xhr),o=0,s=i.length;s>o;o++)t=i[o],t.status=n.CANCELED;for(e.xhr.abort(),r=0,a=i.length;a>r;r++)t=i[r],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else((l=e.status)===n.ADDED||l===n.QUEUED)&&(e.status=n.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));return this.options.autoProcessQueue?this.processQueue():void 0},o=function(){var e,t;return t=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},n.prototype.uploadFile=function(e){return this.uploadFiles([e])},n.prototype.uploadFiles=function(e){var t,r,s,a,l,c,u,d,h,p,f,g,m,v,b,y,w,C,_,x,S,k,T,$,E,D,I,M,A,O,R,P,N,L;for(_=new XMLHttpRequest,x=0,$=e.length;$>x;x++)t=e[x],t.xhr=_;g=o(this.options.method,e),w=o(this.options.url,e),_.open(g,w,!0),_.withCredentials=!!this.options.withCredentials,b=null,s=function(n){return function(){var i,o,r;for(r=[],i=0,o=e.length;o>i;i++)t=e[i],r.push(n._errorProcessing(e,b||n.options.dictResponseError.replace("{{statusCode}}",_.status),_));return r}}(this),y=function(n){return function(i){var o,r,s,a,l,c,u,d,h;if(null!=i)for(r=100*i.loaded/i.total,s=0,c=e.length;c>s;s++)t=e[s],t.upload={progress:r,total:i.total,bytesSent:i.loaded};else{for(o=!0,r=100,a=0,u=e.length;u>a;a++)t=e[a],(100!==t.upload.progress||t.upload.bytesSent!==t.upload.total)&&(o=!1),t.upload.progress=r,t.upload.bytesSent=t.upload.total;if(o)return}for(h=[],l=0,d=e.length;d>l;l++)t=e[l],h.push(n.emit("uploadprogress",t,r,t.upload.bytesSent));return h}}(this),_.onload=function(t){return function(i){var o;if(e[0].status!==n.CANCELED&&4===_.readyState){if(b=_.responseText,_.getResponseHeader("content-type")&&~_.getResponseHeader("content-type").indexOf("application/json"))try{b=JSON.parse(b)}catch(r){i=r,b="Invalid JSON response from server."}return y(),200<=(o=_.status)&&300>o?t._finished(e,b,i):s()}}}(this),_.onerror=function(t){return function(){return e[0].status!==n.CANCELED?s():void 0}}(this),v=null!=(A=_.upload)?A:_,v.onprogress=y,c={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&i(c,this.options.headers);for(a in c)l=c[a],_.setRequestHeader(a,l);if(r=new FormData,this.options.params){O=this.options.params;for(f in O)C=O[f],r.append(f,C)}for(S=0,E=e.length;E>S;S++)t=e[S],this.emit("sending",t,_,r);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,_,r),"FORM"===this.element.tagName)for(R=this.element.querySelectorAll("input, textarea, select, button"),
k=0,D=R.length;D>k;k++)if(d=R[k],h=d.getAttribute("name"),p=d.getAttribute("type"),"SELECT"===d.tagName&&d.hasAttribute("multiple"))for(P=d.options,T=0,I=P.length;I>T;T++)m=P[T],m.selected&&r.append(h,m.value);else(!p||"checkbox"!==(N=p.toLowerCase())&&"radio"!==N||d.checked)&&r.append(h,d.value);for(u=M=0,L=e.length-1;L>=0?L>=M:M>=L;u=L>=0?++M:--M)r.append(this._getParamName(u),e[u],e[u].name);return _.send(r)},n.prototype._finished=function(e,t,i){var o,r,s;for(r=0,s=e.length;s>r;r++)o=e[r],o.status=n.SUCCESS,this.emit("success",o,t,i),this.emit("complete",o);return this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},n.prototype._errorProcessing=function(e,t,i){var o,r,s;for(r=0,s=e.length;s>r;r++)o=e[r],o.status=n.ERROR,this.emit("error",o,t,i),this.emit("complete",o);return this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue?this.processQueue():void 0},n}(t),e.version="4.0.1",e.options={},e.optionsForElement=function(t){return t.getAttribute("id")?e.options[n(t.getAttribute("id"))]:void 0},e.instances=[],e.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},e.autoDiscover=!0,e.discover=function(){var t,n,i,o,r,s;for(document.querySelectorAll?i=document.querySelectorAll(".dropzone"):(i=[],t=function(e){var t,n,o,r;for(r=[],n=0,o=e.length;o>n;n++)t=e[n],r.push(/(^| )dropzone($| )/.test(t.className)?i.push(t):void 0);return r},t(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))),s=[],o=0,r=i.length;r>o;o++)n=i[o],s.push(e.optionsForElement(n)!==!1?new e(n):void 0);return s},e.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],e.isBrowserSupported=function(){var t,n,i,o,r;if(t=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(r=e.blacklistedBrowsers,i=0,o=r.length;o>i;i++)n=r[i],n.test(navigator.userAgent)&&(t=!1);else t=!1;else t=!1;return t},a=function(e,t){var n,i,o,r;for(r=[],i=0,o=e.length;o>i;i++)n=e[i],n!==t&&r.push(n);return r},n=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},e.createElement=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},e.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},e.getElement=function(e,t){var n;if("string"==typeof e?n=document.querySelector(e):null!=e.nodeType&&(n=e),null==n)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return n},e.getElements=function(e,t){var n,i,o,r,s,a,l,c;if(e instanceof Array){o=[];try{for(r=0,a=e.length;a>r;r++)i=e[r],o.push(this.getElement(i,t))}catch(u){n=u,o=null}}else if("string"==typeof e)for(o=[],c=document.querySelectorAll(e),s=0,l=c.length;l>s;s++)i=c[s],o.push(i);else null!=e.nodeType&&(o=[e]);if(null==o||!o.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return o},e.confirm=function(e,t,n){return window.confirm(e)?t():null!=n?n():void 0},e.isValidFile=function(e,t){var n,i,o,r,s;if(!t)return!0;for(t=t.split(","),i=e.type,n=i.replace(/\/.*$/,""),r=0,s=t.length;s>r;r++)if(o=t[r],o=o.trim(),"."===o.charAt(0)){if(-1!==e.name.toLowerCase().indexOf(o.toLowerCase(),e.name.length-o.length))return!0}else if(/\/\*$/.test(o)){if(n===o.replace(/\/.*$/,""))return!0}else if(i===o)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new e(this,t)})}),"undefined"!=typeof module&&null!==module?module.exports=e:window.Dropzone=e,e.ADDED="added",e.QUEUED="queued",e.ACCEPTED=e.QUEUED,e.UPLOADING="uploading",e.PROCESSING=e.UPLOADING,e.CANCELED="canceled",e.ERROR="error",e.SUCCESS="success",o=function(e){var t,n,i,o,r,s,a,l,c,u;for(a=e.naturalWidth,s=e.naturalHeight,n=document.createElement("canvas"),n.width=1,n.height=s,i=n.getContext("2d"),i.drawImage(e,0,0),o=i.getImageData(0,0,1,s).data,u=0,r=s,l=s;l>u;)t=o[4*(l-1)+3],0===t?r=l:u=l,l=r+u>>1;return c=l/s,0===c?1:c},r=function(e,t,n,i,r,s,a,l,c,u){var d;return d=o(t),e.drawImage(t,n,i,r,s,a,l,c,u/d)},i=function(e,t){var n,i,o,r,s,a,l,c,u;if(o=!1,u=!0,i=e.document,c=i.documentElement,n=i.addEventListener?"addEventListener":"attachEvent",l=i.addEventListener?"removeEventListener":"detachEvent",a=i.addEventListener?"":"on",r=function(n){return"readystatechange"!==n.type||"complete"===i.readyState?(("load"===n.type?e:i)[l](a+n.type,r,!1),!o&&(o=!0)?t.call(e,n.type||n):void 0):void 0},s=function(){var e;try{c.doScroll("left")}catch(t){return e=t,void setTimeout(s,50)}return r("poll")},"complete"!==i.readyState){if(i.createEventObject&&c.doScroll){try{u=!e.frameElement}catch(d){}u&&s()}return i[n](a+"DOMContentLoaded",r,!1),i[n](a+"readystatechange",r,!1),e[n](a+"load",r,!1)}},e._autoDiscoverFunction=function(){return e.autoDiscover?e.discover():void 0},i(window,e._autoDiscoverFunction)}.call(this),angular.module("ngDraggable",[]).service("ngDraggable",[function(){var e=this;e.inputEvent=function(e){return angular.isDefined(e.touches)?e.touches[0]:e}}]).directive("ngDrag",["$rootScope","$parse","$document","$window","ngDraggable",function(e,t,n,i,o){return{restrict:"A",link:function(r,s,a){r.value=a.ngDrag;var l,c,u,d,h,p,f,g,m=!1,v="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,b="touchstart mousedown",y="touchmove mousemove",w="touchend mouseup",C=r.$id,_=null,x=null,S=!1,k=null,T=t(a.ngDragSuccess)||null,$=angular.isDefined(a.allowTransform)?r.$eval(a.allowTransform):!0,E=t(a.ngDragData),D=angular.noop,I=function(){s.attr("draggable","false");var e=s.find("[ng-drag-handle]");e.length&&(g=e),M(!0)},M=function(e){e&&(r.$on("$destroy",A),r.$watch(a.ngDrag,O),r.$watch(a.ngCenterAnchor,R),g?g.on(b,N):s.on(b,N),v||"img"!=s[0].nodeName.toLowerCase()||s.on("mousedown",function(){return!1}))},A=function(e){M(!1)},O=function(e,t){S=e},R=function(e,t){angular.isDefined(e)&&(m=e||"true")},P=function(e){return angular.isDefined(angular.element(e.target).attr("ng-cancel-drag"))},N=function(e){S&&(P(e)||("mousedown"!=e.type||0==e.button)&&(v?(L(),k=setTimeout(function(){L(),F(e)},100),n.on(y,L),n.on(w,L)):F(e)))},L=function(){clearTimeout(k),n.off(y,L),n.off(w,L)},F=function(t){S&&(t.preventDefault(),l=s[0].getBoundingClientRect(),x=$?l:{left:document.body.scrollLeft,top:document.body.scrollTop},s.centerX=s[0].offsetWidth/2,s.centerY=s[0].offsetHeight/2,c=o.inputEvent(t).pageX,u=o.inputEvent(t).pageY,p=c-l.left,f=u-l.top,m?(d=c-s.centerX-i.pageXOffset,h=u-s.centerY-i.pageYOffset):(d=c-p-i.pageXOffset,h=u-f-i.pageYOffset),n.on(y,U),n.on(w,j),D=e.$on("draggable:_triggerHandlerMove",function(e,t){U(t)}))},U=function(t){S&&(t.preventDefault(),s.hasClass("dragging")||(_=E(r),s.addClass("dragging"),e.$broadcast("draggable:start",{x:c,y:u,tx:d,ty:h,event:t,element:s,data:_})),c=o.inputEvent(t).pageX,u=o.inputEvent(t).pageY,m?(d=c-s.centerX-x.left,h=u-s.centerY-x.top):(d=c-p-x.left,h=u-f-x.top),B(d,h),e.$broadcast("draggable:move",{x:c,y:u,tx:d,ty:h,event:t,element:s,data:_,uid:C}))},j=function(t){S&&(t.preventDefault(),e.$broadcast("draggable:end",{x:c,y:u,tx:d,ty:h,event:t,element:s,data:_,callback:H,uid:C}),s.removeClass("dragging"),s.parent().find(".drag-enter").removeClass("drag-enter"),W(),n.off(y,U),n.off(w,j),D())},H=function(e){T&&r.$apply(function(){T(r,{$data:_,$event:e})})},W=function(){s.css($?{transform:"","z-index":"","-webkit-transform":"","-ms-transform":""}:{position:"",top:"",left:""})},B=function(e,t){s.css($?{transform:"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 0, 1)","z-index":99999,"-webkit-transform":"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+t+", 0, 1)","-ms-transform":"matrix(1, 0, 0, 1, "+e+", "+t+")"}:{left:e+"px",top:t+"px",position:"fixed"})};I()}}}]).directive("ngDrop",["$parse","$timeout","$window","$document","ngDraggable",function(e,t,n,i,o){return{restrict:"A",link:function(n,o,r){n.value=r.ngDrop,n.isTouching=!1;var s=null,a=n.$id,l=!1,c=e(r.ngDropSuccess),u=e(r.ngDragStart),d=e(r.ngDragStop),h=e(r.ngDragMove),p=function(){f(!0)},f=function(e){e&&(n.$watch(r.ngDrop,m),n.$on("$destroy",g),n.$on("draggable:start",v),n.$on("draggable:move",b),n.$on("draggable:end",y))},g=function(e){f(!1)},m=function(e,t){l=e},v=function(e,i){l&&(w(i.x,i.y,i.element),r.ngDragStart&&t(function(){u(n,{$data:i.data,$event:i})}))},b=function(e,i){l&&(w(i.x,i.y,i.element),r.ngDragMove&&t(function(){h(n,{$data:i.data,$event:i})}))},y=function(e,i){return l&&a!==i.uid?(w(i.x,i.y,i.element)&&(i.callback&&i.callback(i),r.ngDropSuccess&&t(function(){c(n,{$data:i.data,$event:i,$target:n.$eval(n.value)})})),r.ngDragStop&&t(function(){d(n,{$data:i.data,$event:i})}),void C(!1,i.element)):void C(!1,i.element)},w=function(e,t,i){var r=_(e,t);return n.isTouching=r,r&&(s=o),C(r,i),r},C=function(e,t){e?(o.addClass("drag-enter"),t.addClass("drag-over")):s==o&&(s=null,o.removeClass("drag-enter"),t.removeClass("drag-over"))},_=function(e,t){var n=o[0].getBoundingClientRect();return e-=i[0].body.scrollLeft+i[0].documentElement.scrollLeft,t-=i[0].body.scrollTop+i[0].documentElement.scrollTop,e>=n.left&&e<=n.right&&t<=n.bottom&&t>=n.top};p()}}}]).directive("ngDragClone",["$parse","$timeout","ngDraggable",function(e,t,n){return{restrict:"A",link:function(e,t,n){var i,o=!0,r=null;e.clonedData={};var s=function(){i=t.find("img"),t.attr("draggable","false"),i.attr("draggable","false"),h(),a(!0)},a=function(t){t&&(e.$on("draggable:start",c),e.$on("draggable:move",u),e.$on("draggable:end",d),l())},l=function(){i.off("mousedown touchstart touchmove touchend touchcancel",f),i.on("mousedown touchstart touchmove touchend touchcancel",f)},c=function(n,i,s){o=!0,angular.isDefined(i.data.allowClone)&&(o=i.data.allowClone),o&&(e.$apply(function(){e.clonedData=i.data}),t.css("width",i.element[0].offsetWidth),t.css("height",i.element[0].offsetHeight),p(i.tx,i.ty)),r=t[0].getBoundingClientRect()},u=function(e,t){o&&(_tx=t.tx+r.left,_ty=t.ty+r.top,p(_tx,_ty))},d=function(e,t){o&&h()},h=function(){t.css({left:0,top:0,position:"fixed","z-index":-1,visibility:"hidden"})},p=function(e,n){t.css({transform:"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+n+", 0, 1)","z-index":99999,visibility:"visible","-webkit-transform":"matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+e+", "+n+", 0, 1)","-ms-transform":"matrix(1, 0, 0, 1, "+e+", "+n+")"})},f=function(e){var t=e;return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1};s()}}}]).directive("ngPreventDrag",["$parse","$timeout",function(e,t){return{restrict:"A",link:function(e,t,n){var i=function(){t.attr("draggable","false"),o(!0)},o=function(e){e&&t.on("mousedown touchstart touchmove touchend touchcancel",r)},r=function(e){var t=e.originalEvent;return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1};i()}}}]).directive("ngCancelDrag",[function(){return{restrict:"A",link:function(e,t,n){t.find("*").attr("ng-cancel-drag","ng-cancel-drag")}}}]).directive("ngDragScroll",["$window","$interval","$timeout","$document","$rootScope",function(e,t,n,i,o){return{restrict:"A",link:function(r,s,a){var l=null,c=null,u={verticalScroll:a.verticalScroll||!0,horizontalScroll:a.horizontalScroll||!0,activationDistance:a.activationDistance||75,scrollDistance:a.scrollDistance||50,scrollInterval:a.scrollInterval||250},d=function(){l=t(function(){if(c){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=0,l=0;if(u.horizontalScroll&&(c.clientX<u.activationDistance?a=-u.scrollDistance:c.clientX>t-u.activationDistance&&(a=u.scrollDistance)),u.verticalScroll&&(c.clientY<u.activationDistance?l=-u.scrollDistance:c.clientY>r-u.activationDistance&&(l=u.scrollDistance)),0!==a||0!==l){var d=i[0].documentElement.scrollLeft,h=i[0].documentElement.scrollTop,p=s.css("transform");s.css("transform","initial"),e.scrollBy(a,l);var f=i[0].documentElement.scrollLeft-d,g=i[0].documentElement.scrollTop-h;s.css("transform",p),n(function(){c.pageX+=f,c.pageY+=g,o.$emit("draggable:_triggerHandlerMove",c)})}}},u.scrollInterval)},h=function(){t.cancel(l),l=null};r.$on("draggable:start",function(e,t){t.element[0]===s[0]&&(l||d())}),r.$on("draggable:end",function(e,t){t.element[0]===s[0]&&l&&h()}),r.$on("draggable:move",function(e,t){t.element[0]===s[0]&&(c=t.event)})}}}]),function(e,t,n,i){"use strict";var o=t.module("ngDragDrop",[]).service("ngDragDropService",["$timeout","$parse",function(r,s){this.draggableScope=null,this.droppableScope=null,this.callEventCallback=function(e,t,i,o){function r(t){var i=-1!==t.indexOf("(")?t.indexOf("("):t.length,o=-1!==t.lastIndexOf(")")?t.lastIndexOf(")"):t.length,r=t.substring(i+1,o),a=t.match(/^[^.]+.\s*/)[0].slice(0,-1);return a=e[a]&&"function"==typeof e[a].constructor?a:null,{callback:t.substring(a&&a.length+1||0,i),args:n.map(r&&r.split(",")||[],function(t){return[s(t)(e)]}),constructor:a}}if(t){var a=r(t),l=a.callback,c=a.constructor,u=[i,o].concat(a.args);return(e[l]||e[c][l]).apply(e,u)}},this.invokeDrop=function(e,n,s,a){var l,c,u="",d="",h={},p={},f=null,g={},m={},v=null,b=this.droppableScope,y=this.draggableScope;u=e.ngattr("ng-model"),d=n.ngattr("ng-model"),l=y.$eval(u),c=b.$eval(d),v=n.find("[jqyoui-draggable]:last,[data-jqyoui-draggable]:last"),p=b.$eval(n.attr("jqyoui-droppable")||n.attr("data-jqyoui-droppable"))||[],h=y.$eval(e.attr("jqyoui-draggable")||e.attr("data-jqyoui-draggable"))||[],h.index=this.fixIndex(y,h,l),p.index=this.fixIndex(b,p,c),f=t.isArray(l)?h.index:null,g=t.isArray(l)?l[f]:l,h.deepCopy&&(g=t.copy(g)),m=t.isArray(c)&&p&&p.index!==i?c[p.index]:t.isArray(c)?{}:c,p.deepCopy&&(m=t.copy(m)),h.animate===!0?(this.move(e,v.length>0?v:n,null,"fast",p,null),this.move(v.length>0&&!p.multiple?v:[],e.parent("[jqyoui-droppable],[data-jqyoui-droppable]"),o.startXY,"fast",p,t.bind(this,function(){r(t.bind(this,function(){e.css({position:"relative",left:"",top:""}),v.css({position:"relative",left:"",top:"",display:"none"===v.css("display")?"":v.css("display")}),this.mutateDraggable(y,p,h,u,d,m,e),this.mutateDroppable(b,p,h,d,g,f),this.callEventCallback(b,p.onDrop,s,a)}))}))):r(t.bind(this,function(){this.mutateDraggable(y,p,h,u,d,m,e),this.mutateDroppable(b,p,h,d,g,f),this.callEventCallback(b,p.onDrop,s,a)}))},this.move=function(t,n,o,r,s,a){if(0===t.length)return a&&e.setTimeout(function(){a()},300),!1;var l=t.css("z-index"),c=t[s.containment||"offset"](),u=n.css("display"),d=n.hasClass("ng-hide");null===o&&n.length>0&&((n.attr("jqyoui-draggable")||n.attr("data-jqyoui-draggable"))!==i&&n.ngattr("ng-model")!==i&&n.is(":visible")&&s&&s.multiple?(o=n[s.containment||"offset"](),s.stack===!1?o.left+=n.outerWidth(!0):o.top+=n.outerHeight(!0)):(d&&n.removeClass("ng-hide"),o=n.css({visibility:"hidden",display:"block"})[s.containment||"offset"](),n.css({visibility:"",display:u}))),t.css({position:"absolute","z-index":9999}).css(c).animate(o,r,function(){d&&n.addClass("ng-hide"),t.css("z-index",l),a&&a()})},this.mutateDroppable=function(e,n,i,o,r,a){var l=e.$eval(o);e.dndDragItem=r,t.isArray(l)?(n&&n.index>=0?l[n.index]=r:l.push(r),i&&i.placeholder===!0&&(l[l.length-1].jqyoui_pos=a)):(s(o+" = dndDragItem")(e),i&&i.placeholder===!0&&(l.jqyoui_pos=a))},this.mutateDraggable=function(e,n,o,r,a,l,c){var u=t.equals(l,{})||!l,d=e.$eval(r);e.dndDropItem=l,o&&o.placeholder?"keep"!=o.placeholder&&(t.isArray(d)&&o.index!==i?d[o.index]=l:s(r+" = dndDropItem")(e)):t.isArray(d)?u?o&&o.placeholder!==!0&&"keep"!==o.placeholder&&d.splice(o.index,1):d[o.index]=l:(s(r+" = dndDropItem")(e),e.$parent&&s(r+" = dndDropItem")(e.$parent)),c.css({"z-index":"",left:"",top:""})},this.fixIndex=function(e,n,o){if(n.applyFilter&&t.isArray(o)&&o.length>0){var r=e[n.applyFilter](),s=r[n.index],a=i;return o.forEach(function(e,n){t.equals(e,s)&&(a=n)}),a}return n.index}}]).directive("jqyouiDraggable",["ngDragDropService",function(e){return{require:"?jqyouiDroppable",restrict:"A",link:function(n,i,r){var s,a,l,c=function(c,u){c?(s=n.$eval(i.attr("jqyoui-draggable")||i.attr("data-jqyoui-draggable"))||{},a=n.$eval(r.jqyouiOptions)||{},i.draggable({disabled:!1}).draggable(a).draggable({start:function(i,r){e.draggableScope=n,l=t.element(a.helper?r.helper:this).css("z-index"),t.element(a.helper?r.helper:this).css("z-index",9999),o.startXY=t.element(this)[s.containment||"offset"](),e.callEventCallback(n,s.onStart,i,r)},stop:function(i,o){t.element(a.helper?o.helper:this).css("z-index",l),e.callEventCallback(n,s.onStop,i,o)},drag:function(t,i){e.callEventCallback(n,s.onDrag,t,i)}})):i.draggable({disabled:!0})};n.$watch(function(){return n.$eval(r.drag)},c),c(),i.on("$destroy",function(){i.draggable({disabled:!0}).draggable("destroy")})}}}]).directive("jqyouiDroppable",["ngDragDropService","$q",function(e,n){return{restrict:"A",priority:1,link:function(i,o,r){var s,a=function(a,l){a?(s=i.$eval(t.element(o).attr("jqyoui-droppable")||t.element(o).attr("data-jqyoui-droppable"))||{},o.droppable({disabled:!1}).droppable(i.$eval(r.jqyouiOptions)||{}).droppable({over:function(t,n){e.callEventCallback(i,s.onOver,t,n)},out:function(t,n){e.callEventCallback(i,s.onOut,t,n)},drop:function(o,a){var l=null;l=s.beforeDrop?e.callEventCallback(i,s.beforeDrop,o,a):function(){var e=n.defer();return e.resolve(),e.promise}(),l.then(t.bind(this,function(){t.element(a.draggable).ngattr("ng-model")&&r.ngModel?(e.droppableScope=i,e.invokeDrop(t.element(a.draggable),t.element(this),o,a)):e.callEventCallback(i,s.onDrop,o,a)}),function(){a.draggable.css({left:"",top:""})})}})):o.droppable({disabled:!0})};i.$watch(function(){return i.$eval(r.drop)},a),a(),o.on("$destroy",function(){o.droppable({disabled:!0}).droppable("destroy")})}}}]);t.element.prototype.ngattr=function(e,n){var i=t.element(this).get(0);return i.getAttribute(e)||i.getAttribute("data-"+e)}}(window,window.angular,window.jQuery),angular.module("app.directive.common",["app.directive.mydatatable.common","app.directive.smartfloat.common"]).filter("offset",function(){return function(e,t){return e.length>0?(t=20*(t-1),e.slice(t,t+20)):void 0}}).filter("undefined",function(){return function(e){return e&&""!==e&&null!==e?e:"No"}}).filter("arrGetBy",function(){return function(e,t,n){for(var i=0,o=e.length;o>i;i++)if(e[i][t]==n)return e[i];return null}}).filter("startFrom",function(){return function(e,t){return t=+t,e?e.slice(t):e}}).filter("moment",function(){return function(e,t){var n=Array.prototype.slice.call(arguments,2),i=moment(e);return i[t].apply(i,n)}}).directive("accessibleForm",function(){return{restrict:"A",link:function(e,t){t.on("submit",function(){var e=angular.element(t[0].querySelectorAll(".ng-invalid")[0]),n=angular.element(t[0].querySelectorAll(".ng-invalid")[1]);void 0!=e[0]&&void 0==n[0]?e.focus():void 0!=n[0]&&e[0].childElementCount>0?n.focus():void 0!=n[0]&&e[0].childElementCount<=0?e.offset().top<n.offset().top?e.focus():n.focus():0})}}}).directive("fabric",function(){return{restrict:"EA",templateUrl:"common/views/directives/fabric.html",link:function(e,t,n){var i=new fabric.Canvas("c"),o=new fabric.Text("hello world",{fontSize:30,originX:"center",originY:"center"});new fabric.Group([o],{left:150,top:100,angle:-10}),i.add(o)}}}).directive("tooltip",function(){return{restrict:"A",link:function(e,t,n){$(t).hover(function(){$(t).tooltip("show")},function(){$(t).tooltip("hide")})}}}).directive("bootstrapSwitch",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){t.bootstrapSwitch(),t.on("switchChange.bootstrapSwitch",function(t,n){i&&e.$apply(function(){i.$setViewValue(n)})}),e.$watch(n.ngModel,function(e,n){e?t.bootstrapSwitch("state",!0,!0):t.bootstrapSwitch("state",!1,!0)})}}}]).directive("audiogram",function(e){return{restrict:"EA",scope:{data:"="},templateUrl:"common/views/directives/audioDiagram.html",link:function(e,t,n){e.id=n.audiogram,e.$watch("data",function(t){for(var n=t,i=800,o=430,r=40,s=30,a=100,l=[-10,0,10,20,30,40,50,60,70,80,90,100,110,120],i=n.length*a+a,c=Raphael(e.id,1e3,600),u=(c.path(["M",r,r,"L",i+r,r,"L",i+r,o,"L",r,o,"L",r,r]),r),d=0;d<l.length;++d)c.text(r/2,u,l[d]),u+=s,d<l.length-2&&c.path(["M",r,u,"L",i+r,u]);for(var u=a+r,d=0;d<n.length;++d)c.text(u,r/2,n[d]+"Hz"),c.path(["M",u,r,"L",u,o]),u+=d===n.length-1?2*a:a})}}}).directive("numbersOnly",function(){return{require:"ngModel",scope:{model:"=ngModel"},link:function(e,t,n,i){e.$watch("model",function(t,n){var i=String(t).split("");0!==i.length&&(1!==i.length||"-"!=i[0]&&"."!==i[0])&&(2!==i.length||"-."!==t)&&isNaN(t)&&(e.model=n)}),t.bind("keypress",function(e){32===e.keyCode&&e.preventDefault()})}}}).directive("radio",function(){return{restrict:"A",require:"?ngModel",scope:{model:"=ngModel",value:"=ngValue"},link:function(e,t,n){t.uniform(),e.$watch("model",function(n){n&&(n===e.value&&t.prop("checked",!0),angular.element.uniform.update(t))})}}}).directive("checkbox",function(){return{restrict:"A",require:"?ngModel",scope:{model:"=ngModel"},link:function(e,t,n){t.uniform(),e.$watch("model",function(e){e&&(t.prop("checked",!0),angular.element.uniform.update(t))})}}}).directive("minHeight",function(){return{restrict:"A",link:function(e,t,n){var i=angular.element(window).height();t.css("min-height",i+"px"),angular.element(window).resize(function(){var e=angular.element(window).height();t.css("min-height",e+"px")})}}}).directive("knob",function(){return{restrict:"A",link:function(e,t,n){$(t).val(e.number).knob()}}}).directive("syncClick",function(){return{restrict:"A",scope:{syncClick:"&"},link:function(e,t,n){t.on("click",function(){e.syncClick()})}}}).directive("draggable",function(e,t){var n=function(e,t){return e[t]||e.touches&&e.touches[0][t]||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0][t]};return{restrict:"A",scope:{drag:"="},link:function(t,i,o){t.$watch("drag",function(t){if(void 0!==t&&1==t)console.log("=========A============");else{console.log("=========B=============");var o=function(e){u=n(e,"pageY")-l,c=n(e,"pageX")-a,i.css({top:u+"px",left:c+"px"})},r=function d(t){e.unbind("mousemove touchmove",o),e.unbind("mouseup touchend",d)},s=i.css("position"),a=0,l=0,c=0,u=0;"relative"!==s&&"absolute"!==s&&(i.css("positon","relative"),s="relative"),i.on("mousedown touchstart",function(t){t.preventDefault();var s=n(t,"pageX"),c=n(t,"pageY");a=s-i.context.offsetLeft,l=c-i.context.offsetTop,e.on("mousemove touchmove",o),e.on("mouseup touchend",r),$(e[0].body).on("mouseleave",r)})}})}}}).directive("customDate",function(){return{restrict:"A",link:function(e,t,n){var i="dd/mm/yy";t.datepicker("birthday"===n.type?{dateFormat:i,changeMonth:!0,changeYear:!0,defaultDate:new Date(1990,8,6),yearRange:"1930:2100"}:{dateFormat:i,changeMonth:!0,changeYear:!0})}}}).directive("checkList",function(){return{restrict:"A",scope:{selectedItemsArray:"=",value:"@"},link:function(e,t){e.$watchCollection("selectedItemsArray",function(n){_.contains(n,e.value)?t.prop("checked",!0):t.prop("checked",!1)}),_.contains(e.selectedItemsArray,e.value)&&t.prop("checked",!0),t.on("change",function(){if(t.prop("checked"))_.contains(e.selectedItemsArray,e.value)||e.$apply(function(){e.selectedItemsArray.push(e.value)});else if(_.contains(e.selectedItemsArray,e.value)){var n=e.selectedItemsArray.indexOf(e.value);e.$apply(function(){e.selectedItemsArray.splice(n,1)})}})}}}).directive("sidebarRes",function(){return{restrict:"A",link:function(e,t,n){var i=angular.element(window).width();768>i?(t.find(".not-mobile").hide(),t.find(".mobile").show(),t.addClass("sidebar-mobile"),t.find("#main-menu").hide(),t.find(".sidebar-menu").css("min-height","0px"),t.find(".sidebar-menu").addClass("sidebar-mobile"),t.find(".sidebar-menu").css("position","relative"),t.addClass("sidebar-padding-left"),t.removeClass("sidebar-collapsed")):992>i?(t.find(".not-mobile").show(),t.find(".mobile").hide(),t.find("#main-menu").show(),t.addClass("sidebar-collapsed"),t.removeClass("sidebar-mobile"),t.find(".sidebar-menu").removeClass("sidebar-mobile"),t.find(".sidebar-menu").css("position","absolute"),t.removeClass("sidebar-padding-left")):(t.find(".not-mobile").show(),t.find(".mobile").hide(),t.find("#main-menu").show(),t.removeClass("sidebar-collapsed"),t.removeClass("sidebar-mobile"),t.find(".sidebar-menu").removeClass("sidebar-mobile"),t.find(".sidebar-menu").css("position","absolute"),t.removeClass("sidebar-padding-left")),angular.element(window).resize(function(){var e=angular.element(window).width();768>e?(t.find(".not-mobile").hide(),t.find(".mobile").show(),t.addClass("sidebar-mobile"),t.find("#main-menu").hide(),t.find(".sidebar-menu").css("min-height","0px"),t.find(".sidebar-menu").css("position","relative"),t.addClass("sidebar-padding-left"),t.removeClass("sidebar-collapsed")):992>e?(t.find(".not-mobile").show(),t.find(".mobile").hide(),t.find("#main-menu").show(),t.addClass("sidebar-collapsed"),t.removeClass("sidebar-mobile"),t.find(".sidebar-menu").removeClass("sidebar-mobile"),t.find(".sidebar-menu").css("position","absolute"),t.removeClass("sidebar-padding-left")):(t.find(".not-mobile").show(),t.find(".mobile").hide(),t.find("#main-menu").show(),t.removeClass("sidebar-collapsed"),t.removeClass("sidebar-mobile"),t.find(".sidebar-menu").removeClass("sidebar-mobile"),t.find(".sidebar-menu").css("position","absolute"),t.removeClass("sidebar-padding-left"))})}}}).directive("email",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.unshift(function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return"undefined"!=typeof e&&""!==e?t.test(e)?i.$setValidity("email",!0):i.$setValidity("email",!1):i.$setValidity("email",!0),e})}}}).directive("integer",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.unshift(function(e){return"undefined"!=typeof e&&""!==e&&null!==e?e>=0&&e%1===0?i.$setValidity("integer",!0):i.$setValidity("integer",!1):i.$setValidity("integer",!0),e})}}}).directive("ngLoading",function(e){return{restrict:"A",scope:!1,link:function(t,n,i){var o=n.html();t.$watch(i.ngLoading,function(i){i===!0?n.html('<div class="loading-circles"><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div><div class="loading-circle"></div></div>'):(n.html(o),e(n.contents())(t))})}}}).directive("match",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(e,t,n,i){e.$watch(function(){var t=i.$modelValue||i.$$invalidModelValue;return i.$pristine&&angular.isUndefined(t)||e.match===t},function(e){i.$setValidity("match",e)})}}}).directive("appFilereader",function(e){var t=Array.prototype.slice;return{restrict:"A",require:"?ngModel",link:function(n,i,o,r){r&&(r.$render=function(){},i.bind("change",function(n){function i(t){var n=e.defer(),i=new FileReader;return i.onload=function(e){n.resolve(e.target.result)},i.onerror=function(e){n.reject(e)},i.readAsDataURL(t),n.promise}var o=n.target;e.all(t.call(o.files,0).map(i)).then(function(e){r.$setViewValue(o.multiple?e:e.length?e[0]:null)})}))}}}).directive("pwCheck",[function(){return{require:"ngModel",link:function(e,t,n,i){var o="#"+n.pwCheck;t.add(o).on("keyup",function(){e.$apply(function(){var e=t.val()===$(o).val();i.$setValidity("pwmatch",e)})})}}}]).directive("customTimepicker",function(){return{require:"ngModel",restrict:"EA",scope:{ngModel:"="},link:function(e,t,n,i){t.timepicker({showPeriodLabels:!1,onSelect:function(t,n){e.ngModel=t,e.$apply()}})}}}).directive("ngRightClick",function(e){return function(t,n,i){var o=e(i.ngRightClick);n.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),o(t,{$event:e})})})}}).directive("floatLabel",function(){return{require:"ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,t,n){"timepicker"===n.type&&t.timepicker({showPeriodLabels:!1,onSelect:function(t,n){e.ngModel=t,e.$apply()}}),e.$watch("ngModel",function(i,o){"undefined"==typeof i||""===i||null===i?t.parent().removeClass("show-label"):(t.parent().addClass("show-label"),n.toDate?angular.element("#"+n.toDate).datepicker("option","minDate",e.ngModel):n.fromDate&&angular.element("#"+n.fromDate).datepicker("option","maxDate",e.ngModel))})}}}).directive("signature",function(e){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",reset:"="},link:function(e,t,n){var i=document.querySelector("#"+n.id),o=new SignaturePad(i);o.maxWidth=3,o.penColor="black",e.$watch("ngModel",function(e){"undefined"!=typeof e&&(o.isEmpty()||o.clear(),o.fromDataURL(e))}),o.onEnd=function(){e.$apply(function(){e.ngModel=o.toDataURL()})}}}}).filter("utc",function(){return function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}}).filter("empty",function(){return function(e){return"undefined"!=typeof e&&e?e:"###"}}).filter("filterdate",function(){return function(e,t){return moment(e).isValid()&&("undefined"!=typeof e||e)?moment(e).format(t):"###"}}).directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}).directive("customTr",function(){return{restrict:"EA",scope:{customTr:"=",customFr:"=",ngModel:"="},link:function(e,t,n){var i={required:"Field is required!",maxlength:"Too long!",number:"Required number!"};e.$watch("customTr",function(n,o){var r=!1;void 0!==e.customFr&&void 0!==e.customFr.$error&&null!==e.customFr.$error&&(angular.forEach(e.customFr.$error,function(e,n){e&&(r=!0,t.parent().hasClass("tooltipstered")&&angular.element(t.parent()).tooltipster("destroy"),angular.element(t.parent()).tooltipster({theme:"tooltip-error-theme",contentAsHTML:!0,content:i[n]}))}),r?(t.parent().find("i").hasClass("glyphicon glyphicon-exclamation-sign")?t.parent().find("i").hasClass("glyphicon glyphicon-exclamation-sign"):t.parent().find("label").append("&nbsp<i class='glyphicon glyphicon-exclamation-sign' style='color: #f3565d'></i>"),t.parent().find("label").css("color","#f3565d")):(t.parent().find("i").hasClass("glyphicon glyphicon-exclamation-sign")&&t.parent().find("i").hasClass("glyphicon glyphicon-exclamation-sign")&&t.parent().find("i").removeClass("glyphicon glyphicon-exclamation-sign"),t.parent().find("label").css("color","#404040"),t.parent().hasClass("tooltipstered")&&(angular.element(t.parent()).tooltipster("destroy"),angular.element(t.parent()).removeAttr("title"))))})}}}),angular.module("app.directive.mydatatable.common",[]).directive("myDataTable",function(e,t){return{restrict:"E",templateUrl:"common/views/mydatatable.html",scope:{options:"=options",row_click:"=rowclick",row_class:"=rowclass",num_rows:"=numrows",col_click:"=colclick"},controller:function(t,n,i){var o=t.options;if(o){t.search={};var r=function(){for(var e=[],t=0,n=o.columns.length;n>t;++t){var i=o.columns[t];i.not_submit||e.push(i.db_field?i.db_field:i.field)}return e},s=function(){for(var e=[],t=0,n=o.columns.length;n>t;++t){var i=o.columns[t];i.order&&e.push([i.field,i.order])}return console.log(e),e},a=function(e){var n=t.page_data.totalItems;n!=e.count&&(t.page_data.totalItems=e.count),t.data.items=e.list};t.ajaxGetData=function(){
var n=t.page_data.itemPerPage,i=(t.page_data.currentPage-1)*n,l=r(),c=s(),u={limit:n,offset:i,fields:l,order:c};o.use_filters&&(u.search=t.search),o.search&&(u.search||(u.search={}),angular.extend(u.search,o.search)),o.method&&"post"==o.method.toLowerCase()?e.all(o.api).post(u).then(a):e.one(o.api).get(u).then(a)},t.orderField=function(e){e.order&&(t.page_data.currentPage=1,e.order="ASC"==e.order?"DESC":"ASC",t.ajaxGetData())},t.enterFilter=function(){t.page_data.currentPage=1,t.ajaxGetData()},t.reload=function(){t.ajaxGetData(),t.data.more_items=[]},t.displayData=function(e,t){return t.format?t.format(e):e};var l=function(){t.data={more_items:[],items:[]},t.search={},t.limit_opt=[{value:5},{value:10},{value:20},{value:50}],t.page_data={totalItems:0,currentPage:1,maxSize:5,itemPerPage:5},t.num_rows&&(t.page_data.itemPerPage=t.num_rows),!o.not_load&&o.api&&t.ajaxGetData(),o.not_paging=o.not_paging?!0:!1,void 0!==o.scope&&null!==o.scope&&angular.extend(o.scope,t),t["static"]=o["static"]?!0:!1};l()}}}}),angular.module("app.directive.smartfloat.common",[]).directive("smartFloat",function(e){var t=/^\$?\d+.(\d{3})*(\,\d*)$/,n=/^\$?\d+,(\d{3})*(\.\d*)$/,i=/^\$?\d+(\.\d*)?$/,o=/^\$?\d+(\,\d*)?$/;return{require:"ngModel",link:function(r,s,a,l){l.$parsers.unshift(function(e){return t.test(e)?(l.$setValidity("float",!0),parseFloat(e.replace(".","").replace(",","."))):n.test(e)?(l.$setValidity("float",!0),parseFloat(e.replace(",",""))):i.test(e)?(l.$setValidity("float",!0),parseFloat(e)):o.test(e)?(l.$setValidity("float",!0),parseFloat(e.replace(",","."))):void l.$setValidity("float",!1)}),l.$formatters.unshift(function(t){return e("number")(parseFloat(t),2)})}}}),angular.module("app.loggedIn.home",["app.loggedIn.home.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.home",{url:"/home",templateUrl:"modules/home/views/home.html",controller:"HomeController"})}),angular.module("app.loggedIn.home.controller",[]).controller("HomeController",function($scope,$http,$state,$cookieStore,$modal){}),angular.module("app.loggedIn.appointment",["app.loggedIn.appointment.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.appointment",{url:"/appointment",templateUrl:"modules/appointment/views/index.html",controller:"AppointmentController"}).state("loggedIn.appointment_doctor",{url:"/appointment/doctor/:doctorId",templateUrl:"modules/appointment/views/doctor/index.html",controller:"AppointmentDoctorController"})}),angular.module("app.loggedIn.appointment.include",["app.loggedIn.appointment.models","app.loggedIn.appointment.controllers.index","app.loggedIn.appointment.controllers.detail","app.loggedIn.appointment.controllers.doctor","app.loggedIn.appointment.directives.calendar","app.loggedIn.appointment.directives.add"]),angular.module("app.loggedIn.appointment.models",[]).factory("AppointmentModel",function(Restangular){var mainModel={},mainApi=Restangular.all("api/meditek/v1/appointment");return mainModel.byDoctor=function(data){var instanceApi=mainApi.all("byDoctor");return instanceApi.post({data:data})},mainModel.add=function(data){var instanceApi=mainApi.all("add");return instanceApi.post({data:data})},mainModel.load=function(data){var instanceApi=mainApi.all("load");return instanceApi.post({data:data})},mainModel.detailLoad=function(data){var instanceApi=mainApi.all("detailLoad");return instanceApi.post({data:data})},mainModel.alertCenter=function(data){var instanceApi=mainApi.all("alertCenter");return instanceApi.post({data:data})},mainModel.alertSiteCenter=function(data){var instanceApi=mainApi.all("alertSiteCenter");return instanceApi.post({data:data})},mainModel.one=function(data){var instanceApi=mainApi.all("one");return instanceApi.post({data:data})},mainModel.getServiceColor=function(data){var instanceApi=mainApi.all("getServiceColor");return instanceApi.post({data:data})},mainModel}),angular.module("app.loggedIn.appointment.controllers.index",[]).controller("AppointmentController",function($scope,$state){}),angular.module("app.loggedIn.appointment.controllers.detail",[]).controller("AppointmentDetailController",function($scope,$state,$stateParams,PatientModel){var load=function(){PatientModel.byid({Patient_id:$stateParams.patientId}).then(function(response){$scope.patient.item=response.data},function(error){})};$scope.patient={load:function(){load()},item:null},$scope.patient.load()}),angular.module("app.loggedIn.appointment.controllers.doctor",[]).controller("AppointmentDoctorController",function($scope,$state,$timeout,$stateParams,$modal,toastr,$cookieStore,OutreferralModel,AppointmentModel,mdtRedimedsitesService,mdtDeptService,ConfigService){var loadSite=function(){mdtRedimedsitesService.list().then(function(response){$scope.site.list=response.data},function(error){})},loadClinical=function(){mdtDeptService.listAll().then(function(response){$scope.clinicalDept.list=response.data},function(error){})};$scope.goToOtherDoctor=function(doctor){$cookieStore.put("appointment",$scope.appointment.pre),$scope.appointment.load({site_id:data.site_id,datepicker:$scope.appointment.pre.datepicker,doctor_id:doctor.DOCTOR_ID,clinical_dept_id:$scope.appointment.pre.clinical_dept_id}),$scope.appointment.pre.doctor_id=doctor.DOCTOR_ID},$scope.loadAppointment=function(){$scope.appointment.load({site_id:data.site_id,datepicker:$scope.appointment.pre.datepicker,doctor_id:$scope.appointment.pre.doctor_id,clinical_dept_id:$scope.appointment.pre.clinical_dept_id})},$scope.dialogWaitingListAdd=function(col){angular.element("#popupMenu").css({display:"none"}),$modal.open({templateUrl:"waitingListAdd",controller:function($scope,$modalInstance){$scope.success=!1,$timeout(function(){$scope.doctor_id=col.DOCTOR_ID},200),$scope.$watch("success",function(success){success&&$modalInstance.close("success")})},size:"lg",resolve:{col:function(){return col}}})},angular.element("#appointment").on("click",function(){angular.element("#popupMenu").css({display:"none"})}),$scope.goToAppDetail=function(list,patient){$state.go("loggedIn.patient.appointment",{cal_id:list.CAL_ID,patient_id:patient.Patient_id})},$scope.rightAdd=function(app,col){angular.element("#popupMenu").css({display:"none"}),$scope.dialogAppointmentAdd(app,col)},$scope.onRightClick=function($event,app,col){angular.element("#popupMenu").css({display:"block",top:$event.pageY-68,left:$event.pageX-20}),$scope.appointment.selectedAppointment=angular.copy(app),$scope.appointment.selectedCol=angular.copy(col)},$scope.dialogAppointmentAdd=function(app,col){var modalInstance=$modal.open({templateUrl:"appointmentAdd",controller:function($scope,$modalInstance,app,options){$scope.appointment={app:app,col:col},$scope.options=options,$scope.params={permission:{create:!0,edit:!1}},$scope.patient=null,$scope.$watch("patient",function(patient){null!==patient&&$modalInstance.close(patient)})},size:"lg",resolve:{app:function(){return app},col:function(){return col},options:function(){return $scope.options}}});modalInstance.result.then(function(patient){if(patient){$scope.appointment.load({site_id:data.site_id,datepicker:data.datepicker,doctor_id:$stateParams.doctorId}),toastr.success("Added Successfully");var modalInstance=$modal.open({templateUrl:"notifyClaim",controller:function($scope,$modalInstance,new_patient,ClaimModel){$scope.selectClaim=function(){$modal.open({templateUrl:"claimSelect",controller:function($scope,$modalInstance,new_patient,col,toastr){var clickRow=function(row){var postData={Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,Claim_id:row.Claim_id};$modalInstance.close("success"),ClaimModel.addPatient(postData).then(function(response){toastr.success("You have choose claim")},function(error){})};$scope.claim={limit:10,reload:!1,Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,addSuccess:!1,clickRow:function(row){clickRow(row)}},$scope.$watch("claim.addSuccess",function(addSuccess){addSuccess&&$modalInstance.close("success")})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(success){"success"===success&&$modalInstance.close("cancel")})},$scope.addClaim=function(){$modal.open({templateUrl:"claimAdd",controller:function($scope,$modalInstance,new_patient,col,toastr){$scope.claim={Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,success:!1},$scope.$watch("claim.success",function(success){success&&(toastr.success("You have choose claim"),$modalInstance.close("success"))})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(success){"success"===success&&$modalInstance.close("cancel")})},$scope.cancel=function(){$modalInstance.close("cancel")}},size:"sm",backdrop:"static",keyboard:!1,resolve:{new_patient:function(){return patient}}});modalInstance.result.then(function(result){"cancel"===result&&col.IS_REFERRAL&&$modal.open({templateUrl:"notifyReferral",controller:function($scope,$modalInstance,new_patient){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.selectReferral=function(){$modal.open({templateUrl:"referralSelect",controller:function($scope,$modalInstance,new_patient,col,OutreferralModel){$scope.patientId=new_patient.Patient_id,$scope.reload=!1,$scope.calId=col.CAL_ID,$scope.doctorId=col.DOCTOR_ID,$scope.limit=10,$scope.addSuccess=!1,$timeout(function(){$scope.calId=col.CAL_ID},600),$scope.$watch("addSuccess",function(addSuccess){addSuccess&&$modalInstance.close("success")}),$scope.clickRow=function(row){var postData={CAL_ID:$scope.calId,outreferral_id:row.id,patient_id:$scope.patientId,isEnable:1};OutreferralModel.select(postData).then(function(response){toastr.success("You have choose Referral"),$modalInstance.close("success")},function(error){})}},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(result){"success"===result&&($modalInstance.dismiss("cancel"),scope.alertCenter.load())})},$scope.addReferral=function(){$modal.open({templateUrl:"referralAdd",controller:function($scope,$modalInstance,new_patient,col){$scope.patientId=new_patient.Patient_id,$scope.calId=col.CAL_ID,$scope.success=!1,$timeout(function(){$scope.doctorId=col.DOCTOR_ID},600),$scope.$watch("success",function(success){success&&(toastr.success("You have choose Referral"),$modalInstance.close("success"))})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(result){"success"===result&&($modalInstance.dismiss("cancel"),scope.alertCenter.load())})}},size:"sm",backdrop:"static",keyboard:!1,resolve:{new_patient:function(){return patient}}})})}})};var load=function(option){$scope.appointment.list=[],option.datepicker=ConfigService.convertToDB(option.datepicker),AppointmentModel.detailLoad(option).then(function(response){$scope.appointment.doctors=response.doctors,_.forEach(response.data,function(data){var flagTheme=-1,flagPatient=-1,i=0;if(_.forEach($scope.appointment.list,function(list){if(list.FROM_TIME===data.FROM_TIME){if(list.cal===data.CAL_ID)return void(flagPatient=i);flagTheme=i}i++}),data.Patient_id&&-1===flagPatient&&(flagPatient=1e3),-1!==flagPatient)if(1e3!==flagPatient)$scope.appointment.list[flagPatient].cal=data.CAL_ID,$scope.appointment.list[flagPatient].CAL_ID=data.CAL_ID,$scope.appointment.list[flagPatient].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,outreferral:data.outreferral,DOCTOR_ID:data.DOCTOR_ID,CAL_ID:data.CAL_ID}),$scope.appointment.list[flagPatient].PATIENTS="ok";else{var temp_index=0,flagIndex=!1;if(_.forEach($scope.appointment.list,function(list){return data.FROM_TIME===list.FROM_TIME?"###"===list.PATIENTS?($scope.appointment.list[temp_index].cal=data.CAL_ID,$scope.appointment.list[temp_index].CAL_ID=data.CAL_ID,$scope.appointment.list[temp_index].SERVICE_COLOR=data.SERVICE_COLOR,$scope.appointment.list[temp_index].patients=[],$scope.appointment.list[temp_index].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral,CAL_ID:data.CAL_ID}),$scope.appointment.list[temp_index].PATIENTS="ok",$scope.appointment.list[temp_index].IS_REFERRAL=data.IS_REFERRAL,void(flagIndex=!0)):($scope.appointment.list[temp_index].cal=data.CAL_ID,$scope.appointment.list[temp_index].CAL_ID=data.CAL_ID,$scope.appointment.list[temp_index].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral,CAL_ID:data.CAL_ID}),$scope.appointment.list[temp_index].PATIENTS="ok",void(flagIndex=!0)):void temp_index++}),!flagIndex){var doctor={SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID};doctor.patients.push({DOCTOR_ID:$stateParams.doctorId,Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral,CAL_ID:data.CAL_ID}),doctor.PATIENTS="ok",doctor.cal=data.CAL_ID,doctor.FROM_TIME=data.FROM_TIME,doctor.TO_TIME=data.TO_TIME,$scope.appointment.list.push(doctor)}}else if(-1!==flagTheme)$scope.appointment.list[flagTheme].patients=[],$scope.appointment.list[flagTheme].cal=data.CAL_ID,$scope.appointment.list[flagTheme].CAL_ID=data.CAL_ID,null!==data.Patient_id&&$scope.appointment.list[flagTheme].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral,CAL_ID:data.CAL_ID}),$scope.appointment.list[flagTheme].PATIENTS="MESS_SYS_010",$scope.appointment.list[flagTheme].SERVICE_ID=data.SERVICE_ID,$scope.appointment.list[flagTheme].CAL_ID=data.CAL_ID,$scope.appointment.list[flagTheme].SERVICE_COLOR=data.SERVICE_COLOR,$scope.appointment.list[flagTheme].IS_REFERRAL=data.IS_REFERRAL,$scope.appointment.list[flagTheme].CLINICAL_DEPT_ID=data.CLINICAL_DEPT_ID,$scope.appointment.list[flagTheme].patients.length>0&&($scope.appointment.list[flagTheme].PATIENTS="ok");else{var doctor={SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID};doctor.patients.push({DOCTOR_ID:$stateParams.doctorId,Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral,CAL_ID:data.CAL_ID}),doctor.cal=data.CAL_ID,doctor.FROM_TIME=data.FROM_TIME,doctor.TO_TIME=data.TO_TIME,$scope.appointment.list.push(doctor)}})})};if($scope.site={list:[]},$scope.clinicalDept={list:[]},$scope.appointment={pre:{doctor_id:null,name:null,datepicker:null,site_id:null,clinical_dept_id:null},list:[],doctors:[],load:function(option){load(option)}},$cookieStore.get("appointment")){var data=$cookieStore.get("appointment");$scope.appointment.pre.datepicker=data.datepicker,$scope.appointment.pre.doctor_id=$stateParams.doctorId,$scope.appointment.pre.clinical_dept_id=data.clinical_dept_id,$scope.appointment.pre.site_id=data.site_id,OutreferralModel.DotorFromUserId($stateParams.doctorId).then(function(response){$scope.appointment.pre.name=response.data[0].NAME},function(error){}),$scope.appointment.load({site_id:data.site_id,datepicker:data.datepicker,doctor_id:$stateParams.doctorId,clinical_dept_id:data.clinical_dept_id}),loadSite(),loadClinical()}}),angular.module("app.loggedIn.appointment.directives.calendar",[]).directive("appointmentCalendar",function($modal,$timeout,$state,$cookieStore,$modal,toastr,AppointmentModel,mdtRedimedsitesService,mdtDeptService,ConfigService){return{restrict:"EA",templateUrl:"modules/appointment/directives/templates/calendar.html",scope:{options:"="},link:function(scope,elem,attrs){scope.servicedata={},scope.getServiceColor=function(){AppointmentModel.getServiceColor("data").then(function(response){scope.servicedata=response.data},function(error){})},scope.getServiceColor(),scope.addPatient=function(){$modal.open({templateUrl:"addPatient",controller:function($scope,$modalInstance,toastr,options){$scope.patientAddForm={params:{permission:{edit:!1,create:!0}}},$scope.options=options,$scope.$watch("onsuccess",function(success){success&&$modalInstance.close("success")})},size:"lg",resolve:{options:function(){return scope.options}}})},scope.goToCalendarDetail=function(doctor){$cookieStore.put("appointment",scope.appointment.search),$state.go("loggedIn.appointment_doctor",{doctorId:doctor.DOCTOR_ID})},scope.extendMinutes=function(hour,minute){hour=scope.convertToSeconds(hour);var seconds=hour+60*minute,sec_num=parseInt(seconds,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60);10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes);var time=hours+":"+minutes;return time},scope.convertToSeconds=function(time){var hour=parseInt(time.substring(0,2)),minute=parseInt(time.substring(3));return 3600*hour+60*minute},scope.differentTimeHours=function(hourOne,hourSecond){return 0!==hourSecond?(hourOne=scope.convertToSeconds(hourOne),hourSecond=scope.convertToSeconds(hourSecond),(hourSecond-hourOne)/60):0},scope.showDropdown=function(patient,col){$modal.open({templateUrl:"notifyAlert",controller:function($scope,patient,AlertModel,OutreferralModel){var postData={Patient_id:patient.Patient_id,CAL_ID:col.CAL_ID,limit:20,offset:0,Creation_date:"desc",name:"",description:""};$scope.alert={list:[]},$scope.outreferral={name:"It has Referral"};var refPostData={CAL_ID:col.CAL_ID,patient_id:patient.Patient_id};OutreferralModel.checkPatientCalendar(refPostData).then(function(response){0===response.data&&($scope.outreferral.name=1===response.service.IS_REFERRAL?"There is no referral":"This slot does not need referral")}),AlertModel.listFollowPatient(postData).then(function(response){$scope.alert.list=response.data},function(error){})},resolve:{patient:function(){return patient}}})},scope.goToAppDetail=function(CAL_ID,Patient_id){$state.go("loggedIn.patient.appointment",{cal_id:CAL_ID,patient_id:Patient_id}),$cookieStore.put("appointment",scope.appointment.search)};var search={datepicker:moment().format("DD/MM/YYYY"),site_id:1,clinical_dept_id:""},loadSite=function(){mdtRedimedsitesService.list().then(function(response){scope.site.list=response.data},function(error){})},loadClinical=function(){mdtDeptService.listAll().then(function(response){scope.clinicalDept.list=response.data},function(error){})},load=function(){var postData=angular.copy(scope.appointment.search);postData.datepicker=ConfigService.convertToDB(postData.datepicker),scope.appointment.list=[],scope.alertCenter.load(),AppointmentModel.load(postData).then(function(response){scope.doctor.headers=response.doctors;var doctor_array_temp=[];_.forEach(response.doctors,function(doctor){doctor_array_temp.push({DOCTOR_ID:doctor.DOCTOR_ID,left:0})});var min_calendar=9999;_.forEach(response.data,function(data){var flagTheme=-1,flagPatient=-1,i=0;if(_.forEach(scope.appointment.list,function(list){list.FROM_TIME===data.FROM_TIME&&_.forEach(list.cals,function(cal){return cal===data.CAL_ID?void(flagPatient=i):void(flagTheme=i)}),i++}),data.Patient_id&&-1===flagPatient&&(flagPatient=1e3),-1!==flagPatient)if(1e3!==flagPatient){var doctor_row=0;scope.appointment.list[flagPatient].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[flagPatient].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,outreferral:data.outreferral,DOCTOR_ID:data.DOCTOR_ID}),void(scope.appointment.list[flagPatient].doctors[doctor_row].PATIENTS="ok")):void doctor_row++})}else{var temp_index=0,flagIndex=!1;if(_.forEach(scope.appointment.list,function(list){data.FROM_TIME===list.FROM_TIME&&_.forEach(list.doctors,function(doc){if(doc.DOCTOR_ID===data.DOCTOR_ID){if("###"===doc.PATIENTS){var doctor_row=0;return scope.appointment.list[temp_index].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[temp_index].doctors[doctor_row].CAL_ID=data.CAL_ID,scope.appointment.list[temp_index].doctors[doctor_row].SERVICE_COLOR=data.SERVICE_COLOR,scope.appointment.list[temp_index].doctors[doctor_row].patients=[],scope.appointment.list[temp_index].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),scope.appointment.list[temp_index].doctors[doctor_row].PATIENTS="ok",void(scope.appointment.list[temp_index].doctors[doctor_row].IS_REFERRAL=data.IS_REFERRAL)):void doctor_row++}),void(flagIndex=!0)}var doctor_row=0;return scope.appointment.list[temp_index].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[temp_index].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),void(scope.appointment.list[temp_index].doctors[doctor_row].PATIENTS="ok")):void doctor_row++}),void(flagIndex=!0)}}),temp_index++}),!flagIndex){var doctors=[];_.forEach(response.doctors,function(doctor){doctors.push(doctor.DOCTOR_ID===data.DOCTOR_ID?{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}:{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,PATIENTS:"###"})});var doctor_row=0;_.forEach(doctors,function(doctor){doctor.DOCTOR_ID===data.DOCTOR_ID&&(doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),doctors[doctor_row].PATIENTS="ok"),doctor_row++});var cal=[];cal.push(data.CAL_ID);var object={FROM_TIME:data.FROM_TIME,TO_TIME:data.TO_TIME,cals:cal,doctors:doctors};scope.appointment.list.push(object)}}else if(-1!==flagTheme){var doctor_row=0;_.forEach(scope.appointment.list[flagTheme].doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[flagTheme].doctors[doctor_row].patients=[],scope.appointment.list[flagTheme].cals.push(data.CAL_ID),null!==data.Patient_id&&scope.appointment.list[flagTheme].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),scope.appointment.list[flagTheme].doctors[doctor_row].PATIENTS="MESS_SYS_010",scope.appointment.list[flagTheme].doctors[doctor_row].SERVICE_ID=data.SERVICE_ID,scope.appointment.list[flagTheme].doctors[doctor_row].CAL_ID=data.CAL_ID,scope.appointment.list[flagTheme].doctors[doctor_row].SERVICE_COLOR=data.SERVICE_COLOR,scope.appointment.list[flagTheme].doctors[doctor_row].IS_REFERRAL=data.IS_REFERRAL,scope.appointment.list[flagTheme].doctors[doctor_row].CLINICAL_DEPT_ID=data.CLINICAL_DEPT_ID,void(scope.appointment.list[flagTheme].doctors[doctor_row].patients.length>0&&(scope.appointment.list[flagTheme].doctors[doctor_row].PATIENTS="ok"))):void doctor_row++})}else{var doctors=[];_.forEach(response.doctors,function(doctor){doctors.push(doctor.DOCTOR_ID===data.DOCTOR_ID?{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}:{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,PATIENTS:"###"})});var differentTimeHours=scope.differentTimeHours(data.FROM_TIME,data.TO_TIME);min_calendar>=differentTimeHours&&(min_calendar=differentTimeHours);var i=0;_.forEach(doctor_array_temp,function(doctor){doctor.DOCTOR_ID===data.DOCTOR_ID&&(doctor_array_temp[i].left=scope.differentTimeHours(data.FROM_TIME,data.TO_TIME)),i++});var cal=[];cal.push(data.CAL_ID);var object={FROM_TIME:data.FROM_TIME,TO_TIME:data.TO_TIME,cals:cal,SERVICE_ID:data.SERVICE_ID,CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID,doctors:doctors};scope.appointment.list.push(object)}}),scope.appointment.new_list=[];var i=0;if(scope.appointment.list.length>0)var begin_from_time=scope.appointment.list[0].FROM_TIME;_.forEach(scope.appointment.list,function(list){if("undefined"!=typeof scope.appointment.list[i+1])var begin_to_time=scope.appointment.list[i+1].FROM_TIME;else var begin_to_time=scope.extendMinutes(begin_from_time,45);var diff=scope.differentTimeHours(begin_from_time,begin_to_time);scope.appointment.new_list.push(scope.appointment.list[i]);var new_list_length=scope.appointment.new_list.length,j=0;_.forEach(scope.appointment.new_list[new_list_length-1].doctors,function(doctor){scope.appointment.new_list[new_list_length-1].doctors[j].border="yes",j++});for(var diff_i=15;diff-15>=diff_i;diff_i+=15){var from_time=scope.extendMinutes(scope.appointment.list[i].FROM_TIME,diff_i);begin_from_time=from_time;var temp_doctors=angular.copy(scope.appointment.list[i].doctors),doc_i=0;_.forEach(temp_doctors,function(doctor){temp_doctors[doc_i].PATIENTS="###",doc_i++}),scope.appointment.new_list.push({FROM_TIME:from_time,doctors:temp_doctors})}begin_from_time=scope.extendMinutes(begin_from_time,15),i++}),scope.appointment.list=angular.copy(scope.appointment.new_list);var i=0;_.forEach(scope.appointment.list,function(list){var j=0;_.forEach(list.doctors,function(doctor){var k=0;_.forEach(doctor_array_temp,function(temp){doctor.DOCTOR_ID===temp.DOCTOR_ID&&("###"!==doctor.PATIENTS?(doctor_array_temp[k].left_temp=doctor_array_temp[k].left-15,doctor_array_temp[k].color=scope.appointment.list[i].doctors[j].SERVICE_COLOR,0===doctor_array_temp[k].left_temp&&(scope.appointment.list[i].doctors[j].height="35px")):doctor_array_temp[k].left_temp>0&&(scope.appointment.list[i].doctors[j].SERVICE_COLOR=doctor_array_temp[k].color,doctor_array_temp[k].left_temp-=15,0===doctor_array_temp[k].left_temp&&(scope.appointment.list[i].doctors[j].height="35px"))),k++}),j++}),i++});var i=0;_.forEach(scope.appointment.list,function(list){var j=0;_.forEach(list.doctors,function(doctor){"undefined"!=typeof scope.appointment.list[i].doctors[j].patients&&scope.appointment.list[i].doctors[j].patients.length>1&&"ok"===scope.appointment.list[i].doctors[j].PATIENTS&&(scope.appointment.list[i].doctors[j].height="auto"),j++}),i++})},function(error){})},dialogWaitingListAdd=function(col){angular.element("#popupMenu").css({display:"none"}),$modal.open({templateUrl:"waitingListAdd",controller:function($scope,$modalInstance,patient){$scope.success=!1,$timeout(function(){$scope.doctor_id=col.DOCTOR_ID,$scope.patient_id=patient.Patient_id},200),$scope.$watch("success",function(success){success&&$modalInstance.close("success")})},size:"lg",resolve:{col:function(){return col},patient:function(){return scope.appointment.selectedPatient}}})},dialogRightAdd=function(app,col){angular.element("#popupMenu").css({display:"none"}),dialogAdd(app,col)},dialogAdd=function(app,col){var modalInstance=$modal.open({templateUrl:"appointmentAdd",controller:function($scope,$modalInstance,app,options){$scope.appointment={app:app,col:col},$scope.options=options,$scope.params={permission:{create:!0,edit:!1}},$scope.patient=null,$scope.$watch("patient",function(patient){null!==patient&&$modalInstance.close(patient)})},size:"lg",resolve:{app:function(){return app},col:function(){return col},options:function(){return scope.options}}});modalInstance.result.then(function(patient){if(patient){scope.appointment.load(),scope.alertCenter.load(),toastr.success("Added Successfully");var modalInstance=$modal.open({templateUrl:"notifyClaim",controller:function($scope,$modalInstance,new_patient,ClaimModel){$scope.selectClaim=function(){$modal.open({templateUrl:"claimSelect",controller:function($scope,$modalInstance,new_patient,col,toastr){var clickRow=function(row){var postData={Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,Claim_id:row.Claim_id};$modalInstance.close("success"),ClaimModel.addPatient(postData).then(function(response){toastr.success("You have choose claim")},function(error){})};$scope.claim={limit:10,reload:!1,Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,addSuccess:!1,clickRow:function(row){clickRow(row)}},$scope.$watch("claim.addSuccess",function(addSuccess){addSuccess&&$modalInstance.close("success")})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(success){"success"===success&&$modalInstance.close("cancel")})},$scope.addClaim=function(){$modal.open({templateUrl:"claimAdd",controller:function($scope,$modalInstance,new_patient,col,toastr){$scope.claim={Patient_id:new_patient.Patient_id,CAL_ID:col.CAL_ID,success:!1},$scope.$watch("claim.success",function(success){success&&(toastr.success("You have choose claim"),$modalInstance.close("success"))})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(success){"success"===success&&$modalInstance.close("cancel")})},$scope.cancel=function(){$modalInstance.close("cancel")}},size:"sm",backdrop:"static",keyboard:!1,resolve:{new_patient:function(){return patient}}});modalInstance.result.then(function(result){"cancel"===result&&col.IS_REFERRAL&&$modal.open({templateUrl:"notifyReferral",controller:function($scope,$modalInstance,new_patient){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.selectReferral=function(){$modal.open({templateUrl:"referralSelect",controller:function($scope,$modalInstance,new_patient,col,OutreferralModel){$scope.patientId=new_patient.Patient_id,$scope.reload=!1,$scope.calId=col.CAL_ID,$scope.doctorId=col.DOCTOR_ID,$scope.limit=10,$scope.addSuccess=!1,$timeout(function(){$scope.calId=col.CAL_ID},600),$scope.$watch("addSuccess",function(addSuccess){addSuccess&&$modalInstance.close("success")}),$scope.clickRow=function(row){var postData={CAL_ID:$scope.calId,outreferral_id:row.id,patient_id:$scope.patientId,isEnable:1};OutreferralModel.select(postData).then(function(response){toastr.success("You have choose Referral"),$modalInstance.close("success")},function(error){})}},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(result){"success"===result&&($modalInstance.dismiss("cancel"),scope.alertCenter.load())})},$scope.addReferral=function(){$modal.open({templateUrl:"referralAdd",controller:function($scope,$modalInstance,new_patient,col){$scope.patientId=new_patient.Patient_id,$scope.calId=col.CAL_ID,$scope.success=!1,$timeout(function(){$scope.doctorId=col.DOCTOR_ID},600),$scope.$watch("success",function(success){success&&(toastr.success("You have choose Referral"),$modalInstance.close("success"))})},size:"lg",resolve:{new_patient:function(){return new_patient},col:function(){return col}}}).result.then(function(result){"success"===result&&($modalInstance.dismiss("cancel"),scope.alertCenter.load())})}},size:"sm",backdrop:"static",keyboard:!1,resolve:{new_patient:function(){return patient}}})})}})},onRightClick=function($event,app,col,patient){angular.element("#popupMenu").css({display:"block",top:$event.pageY-68,left:$event.pageX-20}),scope.appointment.selectedAppointment=angular.copy(app),scope.appointment.selectedCol=angular.copy(col),scope.appointment.selectedPatient=angular.copy(patient)};angular.element("#appointment").on("click",function(){angular.element("#popupMenu").css({display:"none"})}),scope.appointment={selectedAppointment:{},selectedCol:{},selectedPatient:{},onRightClick:function($event,app,col,patient){onRightClick($event,app,col,patient)},dialog:{rightAdd:function(app,col){dialogRightAdd(app,col)},add:function(app,col){dialogAdd(app,col)},chooseWaitingList:function(col){dialogWaitingListAdd(col)}},list:[],search:angular.copy(search),load:function(){load()}},$cookieStore.get("appointment")&&(scope.appointment.search=$cookieStore.get("appointment"),$cookieStore.remove("appointment")),scope.site={list:[],load:function(){loadSite()}},scope.doctor={
headers:[]},scope.clinicalDept={list:[],load:function(){loadClinical()}};var loadAlertCenter=function(){var postData=angular.copy(scope.appointment.search);postData.datepicker=ConfigService.convertToDB(postData.datepicker),scope.alertCenter.list=[],AppointmentModel.alertCenter(postData).then(function(response){_.forEach(response.data,function(row){var flag=-1,i=0;if(_.forEach(scope.alertCenter.list,function(list){return list.Patient_id===row.Patient_id?void(flag=i):void i++}),-1!==flag){if(row.ALERT_ID){var alert_flag=!0;if(_.forEach(scope.alertCenter.list[flag].alert,function(alert){alert.id===row.ALERT_ID&&(alert_flag=!1)}),alert_flag){var object={id:row.ALERT_ID,name:row.ALERT_NAME};scope.alertCenter.list[flag].alert.push(object)}var cal_flag=!0,i=0;if(_.forEach(scope.alertCenter.list[flag].cal,function(cal){cal.CAL_ID===row.CAL_ID&&(cal_flag=!1)}),cal_flag&&(scope.alertCenter.list[flag].test=row.IS_REFERRAL,scope.alertCenter.list[flag].cal.push({IS_REFERRAL:row.IS_REFERRAL,CAL_ID:row.CAL_ID,FROM_TIME:row.FROM_TIME,TO_TIME:row.TO_TIME,OUTREFERRAL:"no",DOCTOR_ID:row.DOCTOR_ID}),row.outreferral_id)){var cal_length=scope.alertCenter.list[flag].cal.length;scope.alertCenter.list[flag].cal[cal_length-1].OUTREFERRAL="yes"}}}else{var object={Patient_id:row.Patient_id,First_name:row.First_name,Sur_name:row.Sur_name,alert:[],cal:[]};row.ALERT_ID&&object.alert.push({id:row.ALERT_ID,name:row.ALERT_NAME}),row.CAL_ID&&(object.test=row.IS_REFERRAL,object.cal.push({IS_REFERRAL:row.IS_REFERRAL,DOCTOR_ID:row.DOCTOR_ID,CAL_ID:row.CAL_ID,FROM_TIME:row.FROM_TIME,TO_TIME:row.TO_TIME,OUTREFERRAL:"no"}),row.outreferral_id&&(object.cal[0].OUTREFERRAL="yes")),scope.alertCenter.list.push(object)}})},function(error){})};scope.clickArrow=function(){scope.alertCenter.arrow=!scope.alertCenter.arrow,scope.alertCenter.arrow?(angular.element("#alert-center").css({display:"none"}),angular.element(".un_arrow").css({right:0})):(angular.element("#alert-center").css({display:"block"}),angular.element(".un_arrow").css({right:"225px"}))},scope.alertCenter={load:function(){loadAlertCenter()},list:[],arrow:!1},scope.site.load(),scope.clinicalDept.load(),scope.appointment.load()}}}),angular.module("app.loggedIn.appointment.directives.add",[]).directive("appointmentAdd",function(ConfigService,sysServiceService,AppointmentModel,WaitingListModel,$modal,$state,toastr){return{restrict:"EA",scope:{params:"=",patient:"=",options:"="},templateUrl:"modules/appointment/directives/templates/add.html",link:function(scope,elem,attrs){var form={PHONE:"",APP_TYPE:"",STATUS:"",AVAILABLE:null,ARR_TIME:null,ATTEND_TIME:null,bill_to:null,ACC_TYPE:null,SERVICE_ID:scope.params.col.SERVICE_ID,NOTES:""},acc_type_load=function(){ConfigService.account_type_option().then(function(response){scope.acc_type.list=response.list},function(error){})},serviceLoad=function(){sysServiceService.byClinicalDepartment(scope.params.col.CLINICAL_DEPT_ID).then(function(response){scope.service.list=response.data},function(error){})},waitingListSelect=function(){$modal.open({templateUrl:"waitingListSelect",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){$modal.open({templateUrl:"notifyAppointment",controller:function($scope,$modalInstance){$scope.clickYes=function(){$modalInstance.close("success")},$scope.clickNo=function(){$modalInstance.dismiss("cancel")}}}).result.then(function(success){if("success"===success&&row){var postData={form:{},Patient_id:null};postData.form=angular.copy(scope.appointment.form),postData.form.ARR_TIME=ConfigService.convertToDB(postData.ARR_TIME),postData.form.ATTEND_TIME=ConfigService.convertToDB(postData.ATTEND_TIME),postData.form.CAL_ID=scope.params.col.CAL_ID,postData.Patient_id=row.Patient_id,AppointmentModel.add(postData).then(function(response){scope.patient=row},function(error){}),WaitingListModel.remove({id:row.id}).then(function(response){},function(error){})}})})},patientAdd=function(){$modal.open({templateUrl:"patientAdd",controller:function($scope,$modalInstance,options,cal_id){$scope.options=options,$scope.params={permission:{create:!0,edit:!1,calendar:!0},CAL_ID:cal_id},$scope.onsuccess="",$scope.$watch("onsuccess",function(patient_id){""!==patient_id&&$modalInstance.close(patient_id)})},size:"lg",resolve:{options:function(){return scope.options},cal_id:function(){return scope.params.col.CAL_ID}}}).result.then(function(status){if(""!==status){var postData={form:{},Patient_id:null};postData.form=angular.copy(scope.appointment.form),postData.form.ARR_TIME=ConfigService.convertToDB(postData.ARR_TIME),postData.form.ATTEND_TIME=ConfigService.convertToDB(postData.ATTEND_TIME),postData.form.CAL_ID=scope.params.col.CAL_ID,postData.Patient_id=status.Patient_id,AppointmentModel.add(postData).then(function(response){scope.patient=status},function(error){})}})},patientSelect=function(){$modal.open({templateUrl:"patientList",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}},size:"lg"}).result.then(function(row){$modal.open({templateUrl:"notifyAppointment",controller:function($scope,$modalInstance){$scope.clickYes=function(){$modalInstance.close("success")},$scope.clickNo=function(){$modalInstance.dismiss("cancel")}}}).result.then(function(success){if("success"===success&&row){var postData={form:{},Patient_id:null};postData.form=angular.copy(scope.appointment.form),postData.form.ARR_TIME=ConfigService.convertToDB(postData.ARR_TIME),postData.form.ATTEND_TIME=ConfigService.convertToDB(postData.ATTEND_TIME),postData.form.CAL_ID=scope.params.col.CAL_ID,postData.Patient_id=row.Patient_id,AppointmentModel.add(postData).then(function(response){scope.patient=row},function(error){})}})})};scope.acc_type={load:function(){acc_type_load()},list:[]},scope.service={load:function(){serviceLoad()},list:[]},scope.acc_type.load(),scope.service.load(),scope.appointment={form:form},scope.app_patient={dialog:{add:function(){patientAdd()},select:function(){patientSelect()},waitingListSelect:function(){waitingListSelect()}}}}}}),angular.module("app.loggedIn.alert",["app.loggedIn.alert.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.alert",{url:"/alert",templateUrl:"modules/alert/views/list.html",controller:"AlertListController"}).state("loggedIn.patient.alert",{"abstract":!0,url:"/patientalert"}).state("loggedIn.patient.alert.list",{url:"/list",views:{"main-content@loggedIn.patient":{templateUrl:"modules/alert/views/patient/list.html",controller:"AlertPatientListController"}}})}),angular.module("app.loggedIn.alert.include",["app.loggedIn.alert.controllers.list","app.loggedIn.alert.controllers.patientList","app.loggedIn.alert.model","app.loggedIn.alert.directives.patientList","app.loggedIn.alert.directives.list","app.loggedIn.alert.directives.add","app.loggedIn.alert.directives.edit"]),angular.module("app.loggedIn.alert.model",[]).factory("AlertModel",function(Restangular){var instanceService={},appApi=Restangular.all("api/meditek/v1/alert");return instanceService.listFollowPatient=function(data){var detailApi=appApi.all("listFollowPatient");return detailApi.post({data:data})},instanceService.listNoFollowPatient=function(data){var detailApi=appApi.all("listNoFollowPatient");return detailApi.post({data:data})},instanceService.list=function(data){var detailApi=appApi.all("list");return detailApi.post({data:data})},instanceService.add=function(data){var detailApi=appApi.all("add");return detailApi.post({data:data})},instanceService.edit=function(data){var detailApi=appApi.all("edit");return detailApi.post({data:data})},instanceService.remove=function(data){var detailApi=appApi.all("remove");return detailApi.post({data:data})},instanceService.one=function(data){var detailApi=appApi.all("one");return detailApi.post({data:data})},instanceService.select=function(data){var detailApi=appApi.all("select");return detailApi.post({data:data})},instanceService.disableAlert=function(data){var detailApi=appApi.all("disableAlert");return detailApi.post({data:data})},instanceService.disablePatientAlert=function(data){var detailApi=appApi.all("disablePatientAlert");return detailApi.post({data:data})},instanceService}),angular.module("app.loggedIn.alert.controllers.list",[]).controller("AlertAddDialog",function($scope,$modalInstance){$scope.alert={success:!1},$scope.$watch("alert.success",function(success){success&&$modalInstance.close("success")})}).controller("AlertListController",function($scope,$modal,toastr){var add=function(){$scope.alert.reload=!1,$modal.open({templateUrl:"dialogAlertAdd",controller:"AlertAddDialog",size:"lg"}).result.then(function(response){"success"===response&&(toastr.success("Added Successfully"),$scope.alert.reload=!0)})};$scope.alert={dialog:{add:function(){add()}},reload:!1,limit:20}}),angular.module("app.loggedIn.alert.controllers.patientList",[]).controller("AlertPatientSelectDialog",function($scope,$modalInstance,Patient_id,CAL_ID,AlertModel,toastr){var onSaveCheck=function(data){var postData=angular.copy(data);AlertModel.select(postData).then(function(response){toastr.success("Select Successfully"),$modalInstance.close("success")},function(error){})};$scope.alert={Patient_id:Patient_id,CAL_ID:CAL_ID,limit:10,onSaveCheck:function(data){onSaveCheck(data)}}}).controller("AlertPatientListController",function($scope,$modal,$stateParams,toastr){var select=function(){$scope.alert.reload=!1,$modal.open({templateUrl:"dialogAlertPatientSelect",controller:"AlertPatientSelectDialog",size:"lg",resolve:{Patient_id:function(){return $stateParams.patient_id},CAL_ID:function(){return $stateParams.cal_id}}}).result.then(function(response){"success"===response&&($scope.alert.reload=!0)})};$scope.alert={dialog:{select:function(){select()}},reload:!1,Patient_id:$stateParams.patient_id,CAL_ID:$stateParams.cal_id,limit:20}}),angular.module("app.loggedIn.alert.directives.list",[]).controller("AlertRemoveDialog",function($scope,$modalInstance,list){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(list)}}).controller("AlertEditDialog",function($scope,$modalInstance,list){$scope.alert={id:list.id,success:!1},$scope.$watch("alert.success",function(success){success&&$modalInstance.close("success")})}).directive("alertList",function($modal,AlertModel,toastr){return{restrict:"EA",scope:{limit:"=",reload:"="},templateUrl:"modules/alert/directives/templates/list.html",link:function(scope,elem,attrs){var search={page:1,limit:scope.limit,offset:0,max_size:5,name:"",description:"",Creation_date:"desc",isenable:""},disableAlert=function(l){AlertModel.disableAlert(l).then(function(response){scope.alert.load()},function(error){})},load=function(){var postData=angular.copy(scope.alert.search);AlertModel.list(postData).then(function(response){scope.alert.list=response.data,scope.alert.count=response.count},function(error){})},onSearch=function(){scope.alert.search.offset=0,scope.alert.load(),scope.alert.search.page=1},onOrderBy=function(option){switch(option.field){case"Creation_date":scope.alert.search.Creation_date=option.order}scope.alert.load()},remove=function(list){$modal.open({templateUrl:"dialogAlertRemove",controller:"AlertRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){AlertModel.remove(list).then(function(response){toastr.success("Delete Successfully"),scope.alert.load()},function(error){})})},edit=function(list){$modal.open({templateUrl:"dialogAlertEdit",controller:"AlertEditDialog",size:"lg",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.alert.load())})},onPage=function(page){scope.alert.search.offset=(page-1)*scope.alert.search.limit,scope.alert.load()};scope.alert={dialog:{remove:function(list){remove(list)},edit:function(list){edit(list)}},search:angular.copy(search),load:function(){load()},list:[],onSearch:function(){onSearch()},onOrderBy:function(option){onOrderBy(option)},onPage:function(page){onPage(page)},disableAlert:function(l){disableAlert(l)}},scope.alert.load(),scope.$watch("reload",function(reload){reload&&(scope.alert.search=angular.copy(search),scope.alert.load())})}}}),angular.module("app.loggedIn.alert.directives.patientList",[]).directive("alertPatientList",function($modal,$stateParams,AlertModel,toastr){return{restrict:"EA",scope:{patientId:"=",calId:"=",limit:"=",reload:"=",permission:"@",withoutPatient:"@",onSavecheck:"&"},templateUrl:"modules/alert/directives/templates/patientList.html",link:function(scope,elem,attrs){scope.action="undefined"==typeof scope.permission?{edit:!0,remove:!0,checkbox:!1}:scope.$eval(scope.permission);var search={page:1,limit:scope.limit,offset:0,max_size:5,name:"",description:"",Creation_date:"desc",Patient_id:scope.patientId,CAL_ID:scope.calId,isEnable:""},load=function(){if("undefined"!=typeof scope.withoutPatient&&scope.withoutPatient){var postData=angular.copy(scope.alert.search);console.log(postData),AlertModel.listNoFollowPatient(postData).then(function(response){scope.alert.list=response.data,scope.alert.count=response.count},function(error){})}else{var postData=angular.copy(scope.alert.search);AlertModel.listFollowPatient(postData).then(function(response){scope.alert.list=response.data,scope.alert.count=response.count},function(error){})}},onSearch=function(){scope.alert.search.offset=0,scope.alert.load(),scope.alert.search.page=1},onOrderBy=function(option){switch(option.field){case"Creation_date":scope.alert.search.Creation_date=option.order}scope.alert.load()},remove=function(list){$modal.open({templateUrl:"dialogAlertRemove",controller:"AlertRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){AlertModel.remove(list).then(function(response){toastr.success("Delete Successfully"),scope.alert.load()},function(error){})})},edit=function(list){$modal.open({templateUrl:"dialogAlertEdit",controller:"AlertEditDialog",size:"md",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.alert.load())})},onPage=function(page){scope.alert.search.offset=(page-1)*scope.alert.search.limit,scope.alert.load()},onCheckbox=function(option){if(option.value)scope.alert.checkbox.push({patient_id:scope.patientId,cal_id:$stateParams.cal_id,alert_id:option.list.id});else{var i=0;_.forEach(scope.alert.checkbox,function(checkbox){return checkbox.alert_id===option.list.id?void scope.alert.checkbox.splice(i,1):void i++})}},disablePatientAlert=function(l){var postData={alert_id:l.id,patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id,isEnable:l.isEnable};AlertModel.disablePatientAlert(postData).then(function(response){scope.alert.load()},function(error){})};scope.alert={dialog:{remove:function(list){remove(list)},edit:function(list){edit(list)}},search:angular.copy(search),load:function(){load()},list:[],checkbox:[],onSearch:function(){onSearch()},onOrderBy:function(option){onOrderBy(option)},onPage:function(page){onPage(page)},onCheckbox:function(option){onCheckbox(option)},disablePatientAlert:function(l){disablePatientAlert(l)},checkedit:scope.action.edit},scope.alert.load(),scope.$watch("reload",function(reload){reload&&(scope.alert.search=angular.copy(search),scope.alert.load())})}}}),angular.module("app.loggedIn.alert.directives.add",[]).directive("alertAdd",function($cookieStore,AlertModel,ConfigService){return{restrict:"EA",scope:{success:"="},templateUrl:"modules/alert/directives/templates/add.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={name:"",description:"",Created_by:user_id,Last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.alert.errors);var postData=angular.copy(scope.alert.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),AlertModel.add(postData).then(function(response){scope.success=!0},function(error){scope.alert.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.alert.errors)})};scope.alert={form:form,errors:[],save:function(){save()}}}}}),angular.module("app.loggedIn.alert.directives.edit",[]).directive("alertEdit",function($cookieStore,AlertModel,ConfigService){return{restrict:"EA",scope:{success:"=",alertId:"="},templateUrl:"modules/alert/directives/templates/edit.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={name:"",description:"",Created_by:user_id,Last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.alert.errors);var postData=angular.copy(scope.alert.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),AlertModel.edit(postData).then(function(response){scope.success=!0},function(error){scope.alert.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.alert.errors)})},load=function(){var postData={id:scope.alertId};AlertModel.one(postData).then(function(response){angular.extend(scope.alert.form,response.data),delete scope.alert.form.Creation_date},function(error){})};scope.alert={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.alert.load()}}}),angular.module("app.loggedIn.allergy",["app.loggedIn.allergy.controller","app.loggedIn.allergy.service","app.loggedIn.allergy.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.allergy",{url:"/allergy","abstract":!0,templateUrl:"modules/allergies/views/structure.html",controller:"AllergyController"}).state("loggedIn.patient.allergy",{"abstract":!0,views:{"main-content@loggedIn.patient":{templateUrl:"modules/allergies/views/structure.html",controller:"AllergyController"}}}).state("loggedIn.allergy.list",{url:"/list",views:{"main-content":{templateUrl:"modules/allergies/views/list.html",controller:"AllergyListController"}}}).state("loggedIn.patient.allergy.list",{url:"/allergy",views:{"main-content":{templateUrl:"modules/allergies/views/list.html",controller:"AllergyListController"}}})}),angular.module("app.loggedIn.allergy.controller",["app.loggedIn.allergy.list.controller"]).controller("AllergyController",function(){}),angular.module("app.loggedIn.allergy.list.controller",[]).controller("AllergyListController",function($scope,$stateParams,AllergyService,toastr){$scope.allergy_panel={},console.log("this is patient_id",$stateParams.patient_id),$stateParams.patient_id&&($scope.showAddExisted=!0),$scope.allergy={select:0,scope:$scope.patient_panel,options:{method:"post",scope:$scope.allergy_panel,columns:[{field:"allergy_id",is_hide:!0},{field:"allergy_name",label:"Allergy Name"},{field:"isEnable",is_hide:!0}],use_filters:!0,filters:{allergy_name:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.allergy.id=item.allergy_id,$scope.allergyEditForm.open()}}],actionsIsEnable:{show:!0,setEnable:function(item){item.isEnable=0==item.isEnable?1:0,console.log(item),AllergyService.update(item).then(function(data){(data.status="success")&&($scope.setListAllergy&&$scope.setListAllergy(),$scope.allergy_panel.reload())})}}}},$stateParams.patient_id?($scope.allergy.options.api="api/erm/v2/allergy/search_patient_allergy",$scope.allergy.options.search={Patient_id:$stateParams.patient_id}):$scope.allergy.options.api="api/erm/v2/allergy/search",$scope.allergySub=angular.copy($scope.allergy),$scope.allergyAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.setListAllergy&&$scope.setListAllergy(),$scope.allergy_panel.reload(),$scope.allergyAddForm.close()}},$scope.allergyEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.setListAllergy&&$scope.setListAllergy(),$scope.allergy_panel.reload(),$scope.allergyEditForm.close()}},$scope.patientAllergyForm={is_show:!1,open:function(){$scope.allergySub.options.use_actions=!1,$scope.allergySub.options.columns=[{field:"allergy_id",is_hide:!0},{field:"allergy_name",label:"Allergy name"},{field:"Creation_date",label:"Created date"}],$scope.allergySub.options.api="api/erm/v2/allergy/search_remain_allergy",this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.allergy_panel.reload(),$scope.patientAllergyForm.close()}},$scope.allergySelected=function(item){console.log("this is selected item",item);var postData={allergy_id:item.allergy_id,patient_id:$stateParams.patient_id};AllergyService.insertPatientAllergy(postData).then(function(response2){"success"===response2.status?(toastr.success("Allergy applied to patient","Successfully"),$scope.setListAllergy&&$scope.setListAllergy(),$scope.patientAllergyForm.close(),$scope.allergy_panel.reload()):toastr.error("Fail to apply allergy to patient","Error")})}}),angular.module("app.loggedIn.allergy.service",[]).factory("AllergyService",function(Restangular,ConfigService,$state){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insert=function(postData){var detailApi=v2_api.all("allergy/insert");return detailApi.post(postData)},instanceService.detail=function(postData){var detailApi=v2_api.all("allergy/detail");return detailApi.post({ID:postData})},instanceService.update=function(postData){var detailApi=v2_api.all("allergy/update");return detailApi.post(postData)},instanceService.insertPatientAllergy=function(postData){var detailApi=v2_api.all("allergy/insert_patient_allergy");return detailApi.post(postData)},instanceService}),angular.module("app.loggedIn.allergy.directive",["app.loggedIn.allergy.detail.directive"]),angular.module("app.loggedIn.allergy.detail.directive",[]).directive("allergyDetail",function(AllergyModel,AllergyService,ConfigService,toastr,$stateParams){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/allergies/directives/templates/detail.html",link:function(scope,element,attrs){var loadData=function(id){AllergyService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(AllergyModel),scope.mode={type:"add",text:"Add allergy"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit referral"})}var addProcess=function(postData){AllergyService.insert(postData).then(function(response){if("success"===response.status)if($stateParams.patient_id){var postData={allergy_id:response.data.allergy_id,patient_id:$stateParams.patient_id};AllergyService.insertPatientAllergy(postData).then(function(response2){"success"===response2.status?(toastr.success("Successfully add and apllied allergy to patient","Successfully"),scope.modelObjectMap=angular.copy(AllergyModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response)):toastr.error("Allergy add successfully but fail to apply allergy to patient","Error")})}else toastr.success("Add allergy successfully","Successfully"),scope.modelObjectMap=angular.copy(AllergyModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response);else toastr.error("Fail to add allergy","Error")})},editProcess=function(postData){AllergyService.update(postData).then(function(response){"success"===response.status&&(toastr.success("Edit allergy Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.certificate",["app.loggedIn.certificate.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.certificate",{"abstract":!0,templateUrl:"modules/certificate/views/structure.html",controller:"CertificateController"}).state("loggedIn.certificate.home",{url:"/certificate/home",views:{"main-content":{templateUrl:"modules/certificate/views/home.html",controller:"CertificateHomeController"}}}).state("loggedIn.certificate.referral",{url:"/certificate/referral",views:{"main-content":{templateUrl:"modules/certificate/views/referral.html",controller:"CertificateReferralController"}}}).state("loggedIn.certificate.scripts",{url:"/certificate/scripts",views:{"main-content":{templateUrl:"modules/certificate/views/scripts.html",controller:"CertificateScriptsController"}}})}),angular.module("app.loggedIn.certificate.controller",["app.loggedIn.certificate.home.controller","app.loggedIn.certificate.referral.controller","app.loggedIn.certificate.scripts.controller"]).controller("CertificateController",function($scope,ConfigService){}),angular.module("app.loggedIn.certificate.home.controller",[]).controller("CertificateHomeController",function($scope,ConfigService){}),angular.module("app.loggedIn.certificate.referral.controller",[]).controller("CertificateReferralController",function($scope,$state,$stateParams,$cookieStore,toastr,localStorageService,PatientService,ReceptionistService){$scope.accordion={patientDetails:!0,referral:!0};var Patient=localStorageService.get("patientTempInfo");Patient.CAL_ID=localStorageService.get("apptTempInfo").CAL_ID,$scope.referralObjectMap={patient_id:Patient.Patient_id,appointment_id:Patient.CAL_ID,CT_SCAN:0,X_RAY:0,MRI:0,ULTRASOUND:0,PATHOLOGY:0,CLINICAL_DETAILS:"",ALLERGIES:0,REQUESTING_PRACTITIONER:"",REPORT_URGENT:0,ELECTRONIC:0,FAX:0,MAIL:0,PHONE:0,RETURN_WITH_PATIENT:0,APPOINTMENT_DATE:null,Created_by:$cookieStore.get("userInfo").id,AssessmentName:"",AssessmentId:""},$scope.patient={},$scope.patient_id=0,$scope.appointment_id=0;var flag=!1,loadPage=function(){PatientService.getPatient(Patient.Patient_id).then(function(data){$scope.patient=data.data[0]}),PatientService.getReferral($scope.referralObjectMap).then(function(data){data.length>0&&($scope.referralObjectMap=data[0],flag=!0)}),$scope.isSubmited=!1};loadPage(),$scope.submitReferral=function(){0==flag?PatientService.insertReferral($scope.referralObjectMap).then(function(data){"OK"==data.status?(toastr.success("Referral created successfully.","Success"),$state.go("loggedIn.doctor.patients.detail.appt")):toastr.error("Server error.","Error")}):PatientService.updateReferral($scope.referralObjectMap).then(function(data){"OK"==data.status?(toastr.success("Referral created successfully.","Success"),$state.go("loggedIn.doctor.patients.detail.appt")):toastr.error("Server error.","Error")})}}),angular.module("app.loggedIn.certificate.scripts.controller",[]).controller("CertificateScriptsController",function($scope,$state,$cookieStore,toastr,PatientService,ReceptionistService,localStorageService){$scope.accordion={script:!0};var Patient=localStorageService.get("patientTempInfo");Patient.CAL_ID=localStorageService.get("apptTempInfo").CAL_ID,$scope.scriptObjectMap={patient_id:Patient.Patient_id,appointment_id:Patient.CAL_ID,prescriber:"",scriptNum:0,Medicare:"",isRefNo:0,EntitlementNo:"",isSafety:0,isConcessional:0,isPBS:0,isRPBS:0,isBrand:0,pharmacist:"",doctorSign:null,doctordate:null,patientSign:null,patientDate:"",agentAddress:"",AssessmentName:"",Created_by:$cookieStore.get("userInfo").id,AssessmentId:0},$scope.patient={},$scope.patient_id=0,$scope.appointment_id=0;var flag=!1,loadPage=function(){PatientService.getPatient(Patient.Patient_id).then(function(data){$scope.patient=data.data[0],console.log(data)}),PatientService.getScript($scope.scriptObjectMap).then(function(data){data.length>0&&($scope.scriptObjectMap=data[0],flag=!0)})};loadPage(),$scope.submitScript=function(){console.log($scope.scriptObjectMap),0==flag?PatientService.insertScript($scope.scriptObjectMap).then(function(data){"OK"==data.status?(toastr.success("Script created successfully.","Success"),$state.go("loggedIn.doctor.patients.detail.appt")):toastr.error("Server error.","Error")}):PatientService.updateScript($scope.scriptObjectMap).then(function(data){"OK"==data.status?(toastr.success("Script update successfully.","Success"),$state.go("loggedIn.doctor.patients.detail.appt")):toastr.error("Server error.","Error")})}}),angular.module("app.loggedIn.certificate.directive",["app.loggedIn.certificate.script.directive"]),angular.module("app.loggedIn.certificate.script.directive",[]).directive("scriptModule",function(){return{restrict:"EA",scope:{},templateUrl:"modules/certificate/directives/templates/script.html",link:function(scope,element,attrs){}}}),angular.module("app.loggedIn.claim",["app.loggedIn.claim.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.claim",{"abstract":!0,url:"/claim"}).state("loggedIn.patient.claim.list",{url:"/list",views:{"main-content@loggedIn.patient":{templateUrl:"modules/claim/views/patient/list.html",controller:"ClaimPatientListController"}}})}),angular.module("app.loggedIn.claim.include",["app.loggedIn.claim.directives.patientList","app.loggedIn.claim.directives.patientAdd","app.loggedIn.claim.directives.patientEdit","app.loggedIn.claim.controllers.patientList","app.loggedIn.claim.directives.patientShow","app.loggedIn.claim.model"]),angular.module("app.loggedIn.claim.model",[]).factory("ClaimModel",function(Restangular){var instanceService={},appApi=Restangular.all("api/meditek/v1/claim");return instanceService.listFollowPatient=function(data){var detailApi=appApi.all("listFollowPatient");return detailApi.post({data:data})},instanceService.listNoFollowPatient=function(data){var detailApi=appApi.all("listNoFollowPatient");return detailApi.post({data:data})},instanceService.getPatientInsurer=function(patientId){var detailApi=appApi.one("getPatientInsurer");return detailApi.get({patientId:patientId})},instanceService.add=function(data){var detailApi=appApi.all("add");return detailApi.post({data:data})},instanceService.addPatient=function(data){var detailApi=appApi.all("addPatient");return detailApi.post({data:data})},instanceService.edit=function(data){var detailApi=appApi.all("edit");return detailApi.post({data:data})},instanceService.remove=function(data){var detailApi=appApi.all("remove");return detailApi.post({data:data})},instanceService.one=function(data){var detailApi=appApi.all("one");return detailApi.post({data:data})},instanceService.OClose=function(data){var detailApi=appApi.all("oclose");return detailApi.post({data:data})},instanceService}),angular.module("app.loggedIn.claim.directives.patientAdd",[]).directive("claimPatientAdd",function($cookieStore,ClaimModel,ConfigService,InsurerService){return{restrict:"EA",scope:{patientId:"=",calId:"=",success:"="},templateUrl:"modules/claim/directives/templates/patientAdd.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={Patient_id:scope.patientId,Injury_name:"",Injury_date:null,How_Injury_Occurred:"",Location:"",Claim_date:null,Claim_no:"",Address:"",Case_manager:"",isCurr:"1",PO_number:"",Isenable:"1",Created_by:user_id,Last_updated_by:user_id,CAL_ID:scope.calId},save=function(){ConfigService.beforeSave(scope.claim.errors);var postData=angular.copy(scope.claim.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Injury_date&&(postData.Injury_date=ConfigService.convertToDB(postData.Injury_date)),postData.Claim_date&&(postData.Claim_date=ConfigService.convertToDB(postData.Claim_date)),ClaimModel.add(postData).then(function(response){scope.success=!0},function(error){scope.claim.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.claim.errors)})},loadInsurer=function(){var postData={Patient_id:scope.patientId};InsurerService.oneFollowPatient(postData).then(function(response){"undefined"!=typeof response.data?(scope.insurer.name=response.data.insurer_name,
form.insurer_id=response.data.id,form.Insurer=response.data.insurer_name):scope.insurer.name="No Insurer"},function(error){})};scope.claim={form:form,errors:[],save:function(){save()}},scope.insurer={load:function(){loadInsurer()},name:""},scope.insurer.load()}}}),angular.module("app.loggedIn.claim.directives.patientEdit",[]).directive("claimPatientEdit",function($cookieStore,$stateParams,ClaimModel,ConfigService,InsurerService){return{restrict:"EA",scope:{claimId:"=",patientId:"=",success:"="},templateUrl:"modules/claim/directives/templates/patientEdit.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={Patient_id:scope.patientId,Injury_name:"",Injury_date:null,How_Injury_Occurred:"",Location:"",Claim_date:null,Claim_no:"",Address:"",Case_manager:"",isCurr:"1",PO_number:"",Isenable:"0",Created_by:user_id,Last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.claim.errors);var postData=angular.copy(scope.claim.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Injury_date&&(postData.Injury_date=ConfigService.convertToDB(postData.Injury_date)),postData.Claim_date&&(postData.Claim_date=ConfigService.convertToDB(postData.Claim_date)),ClaimModel.edit(postData).then(function(response){scope.success=!0},function(error){scope.claim.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.claim.errors)})},loadInsurer=function(){var postData={Patient_id:scope.patientId};InsurerService.oneFollowPatient(postData).then(function(response){scope.insurer.name="undefined"!=typeof response.data?response.data.insurer_name:"No Insurer"},function(error){})},load=function(){var postData={Patient_id:scope.patientId,Claim_id:scope.claimId};ClaimModel.one(postData).then(function(response){angular.extend(scope.claim.form,response.data),scope.claim.form.Claim_date=ConfigService.convertToDate(scope.claim.form.Claim_date),scope.claim.form.Injury_date=ConfigService.convertToDate(scope.claim.form.Injury_date),scope.claim.form.isCurr=scope.claim.form.isCurr.toString(),scope.claim.form.Isenable=scope.claim.form.Isenable.toString(),delete scope.claim.form.Creation_date},function(error){})};scope.claim={errors:[],load:function(){load()},form:angular.copy(form),errors:[],save:function(){save()}},scope.insurer={load:function(){loadInsurer()},name:""},scope.claim.load(),scope.insurer.load()}}}),angular.module("app.loggedIn.claim.directives.patientList",[]).controller("ClaimPatientRemoveDialog",function($scope,$modalInstance,list){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(list)}}).controller("ClaimPatientEditDialog",function($scope,$modalInstance,$stateParams,list){$scope.claim={Claim_id:list.Claim_id,Patient_id:$stateParams.patient_id,success:!1},$scope.$watch("claim.success",function(success){success&&$modalInstance.close("success")})}).controller("ClaimPatientShowDialog",function($scope,$modalInstance,$stateParams,list){$scope.claim={Claim_id:list.Claim_id,Patient_id:$stateParams.patient_id,success:!1},$scope.$watch("claim.success",function(success){success&&$modalInstance.close("success")})}).directive("claimPatientList",function(ClaimModel,$modal,toastr,$stateParams){return{restrict:"EA",scope:{reload:"=",limit:"=",patientId:"=",calId:"=",withoutPatient:"@",permission:"@",onRowClick:"&",addSuccess:"="},templateUrl:"modules/claim/directives/templates/patientList.html",link:function(scope,elem,attrs){scope.action="undefined"==typeof scope.permission?{edit:!0,remove:!0,add:!0,show:!0}:scope.$eval(scope.permission),console.log(scope.action);var search={page:1,limit:scope.limit,offset:0,max_size:5,Claim_no:"",Claim_date:"desc",Injury_name:"",Injury_date:"asc",Patient_id:scope.patientId},load=function(){var postData=angular.copy(scope.claim.search);"undefined"!=typeof scope.withoutPatient&&scope.withoutPatient?ClaimModel.listNoFollowPatient(postData).then(function(response){scope.claim.list=response.data,scope.claim.count=response.count},function(error){}):ClaimModel.listFollowPatient(postData).then(function(response){scope.claim.list=response.data,scope.claim.count=response.count},function(error){})},onPage=function(page){scope.claim.search.offset=(page-1)*scope.claim.search.limit,scope.claim.load()},onSearch=function(){scope.claim.load(),scope.claim.search.page=1},onOrderBy=function(option){switch(option.field){case"Claim_date":scope.claim.search.Claim_date=option.order;break;case"Injury_date":scope.claim.search.Injury_date=option.order}scope.claim.load()},remove=function(list){$modal.open({templateUrl:"dialogClaimRemove",controller:"ClaimPatientRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){ClaimModel.remove(list).then(function(response){toastr.success("Deleted Successfully"),scope.claim.load()},function(error){})})},edit=function(list){$modal.open({templateUrl:"dialogClaimEdit",controller:"ClaimPatientEditDialog",size:"md",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.claim.load())})},add=function(){$modal.open({templateUrl:"claimAdd",controller:function($scope,$modalInstance,patientId,calId){$scope.claim={Patient_id:patientId,CAL_ID:calId,success:!1},$scope.$watch("claim.success",function(success){success&&$modalInstance.close("success")})},size:"lg",resolve:{patientId:function(){return scope.patientId},calId:function(){return scope.calId}}}).result.then(function(success){"success"===success&&(toastr.success("Add Successfully"),scope.addSuccess=!0)})},show=function(list){$modal.open({templateUrl:"dialogClaimShow",controller:"ClaimPatientShowDialog",size:"md",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.claim.load())})};scope.claim={dialog:{add:function(){add()},remove:function(list){remove(list)},edit:function(list){edit(list)},show:function(list){show(list)}},load:function(){load()},list:[],count:0,search:angular.copy(search),onPage:function(page){onPage(page)},onSearch:function(){onSearch()},onOrderBy:function(option){onOrderBy(option)}},scope.claim.load(),scope.$watch("reload",function(reload){scope.claim.search=angular.copy(search),reload&&scope.claim.load()})}}}),angular.module("app.loggedIn.claim.directives.patientShow",[]).directive("claimPatientShow",function($cookieStore,$stateParams,ClaimModel,ConfigService,InsurerService){return{restrict:"EA",scope:{claimId:"=",patientId:"=",success:"="},templateUrl:"modules/claim/directives/templates/patientShow.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={Patient_id:scope.patientId,Injury_name:"",Injury_date:null,How_Injury_Occurred:"",Location:"",Claim_date:null,Claim_no:"",Address:"",Case_manager:"",isCurr:"1",PO_number:"",Isenable:"0",Created_by:user_id,Last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.claim.errors);var postData=angular.copy(scope.claim.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Injury_date&&(postData.Injury_date=ConfigService.convertToDB(postData.Injury_date)),postData.Claim_date&&(postData.Claim_date=ConfigService.convertToDB(postData.Claim_date)),ClaimModel.edit(postData).then(function(response){scope.success=!0},function(error){scope.claim.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.claim.errors)})},loadInsurer=function(){var postData={Patient_id:scope.patientId};InsurerService.oneFollowPatient(postData).then(function(response){scope.insurer.name="undefined"!=typeof response.data?response.data.insurer_name:"No Insurer"},function(error){})},load=function(){var postData={Patient_id:scope.patientId,Claim_id:scope.claimId};ClaimModel.one(postData).then(function(response){angular.extend(scope.claim.form,response.data),scope.claim.form.Claim_date=ConfigService.convertToDate(scope.claim.form.Claim_date),scope.claim.form.Injury_date=ConfigService.convertToDate(scope.claim.form.Injury_date),scope.claim.form.isCurr=scope.claim.form.isCurr.toString(),scope.claim.form.Isenable=scope.claim.form.Isenable.toString(),delete scope.claim.form.Creation_date},function(error){})};scope.claim={errors:[],load:function(){load()},form:angular.copy(form),errors:[],save:function(){save()}},scope.insurer={load:function(){loadInsurer()},name:""},scope.claim.load(),scope.insurer.load()}}}),angular.module("app.loggedIn.claim.controllers.patientList",[]).controller("ClaimPatientListController",function($scope,$modal,$stateParams,toastr){var add=function(){$modal.open({templateUrl:"dialogClaimAdd",controller:"ClaimPatientAddDialog",size:"md",resolve:{patientId:function(){return $stateParams.patient_id},calId:function(){return $stateParams.cal_id}}}).result.then(function(response){"success"===response&&(toastr.success("Added Successfully"),$scope.claim.reload=!0)})};$scope.claim={dialog:{add:function(){add(),$scope.claim.reload=!1}},reload:!1,limit:20,Patient_id:$stateParams.patient_id,CAL_ID:$stateParams.cal_id}}).controller("ClaimPatientAddDialog",function($scope,$modalInstance,patientId,calId){$scope.patientId=patientId,$scope.calId=calId,$scope.success=!1,$scope.$watch("success",function(success){success&&$modalInstance.close("success")})}),angular.module("app.loggedIn.company",["app.loggedIn.company.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.company",{url:"/company",views:{"main-content@loggedIn.patient":{templateUrl:"modules/company/views/list.html",controller:"CompanyListController"}}}).state("loggedIn.patient.company.add",{url:"/add",views:{"@loggedIn":{templateUrl:"modules/company/views/add.html",controller:"CompanyAddController"}}}).state("loggedIn.patient.company.addCompanyNotFollow",{url:"/addCompany",views:{"@loggedIn":{templateUrl:"modules/company/views/addCompanyNotFollow.html"}}}).state("loggedIn.patient.company.addParent",{url:"/addParent",views:{"@loggedIn":{templateUrl:"modules/company/dialogs/addParent.html",controller:"CompanyAddParentDialgosController"}}}).state("loggedIn.patient.company.addInsurer",{url:"/addParent",views:{"@loggedIn":{templateUrl:"modules/company/dialogs/addInsurer.html",controller:"CompanyInsurerDialgosController"}}}).state("loggedIn.patient.company.listParent",{url:"/listParent",views:{"@loggedIn":{templateUrl:"modules/company/views/listParent.html",controller:"CompanyListParentController"}}}).state("loggedIn.patient.company.listInsurer",{url:"/listInsurer",views:{"@loggedIn":{templateUrl:"modules/company/views/listInsurer.html",controller:"CompanylistInsurerController"}}}).state("loggedIn.patient.company.edit",{url:"/:companyId/edit",views:{"@loggedIn":{templateUrl:"modules/company/views/edit.html",controller:"CompanyEditController"}}})}),angular.module("app.loggedIn.company.include",["app.loggedIn.company.directives.list","app.loggedIn.company.controllers.list","app.loggedIn.company.models","app.loggedIn.company.controllers.add","app.loggedIn.company.directives.add","app.loggedIn.company.controllers.edit","app.loggedIn.company.directives.edit","app.loggedIn.company.controllers.listParent","app.loggedIn.company.directives.listParent","app.loggedIn.company.controllers.listInsurer","app.loggedIn.company.directives.listInsurer","app.loggedIn.company.dialog.addParent","app.loggedIn.company.dialog.addInusrer","app.loggedIn.company.dialog.remove","app.loggedIn.company.services","app.loggedIn.company.directives.listNotFollow","app.loggedIn.company.controllers.listNotFollow","app.loggedIn.company.dialog.listNoFollow","app.loggedIn.company.directives.addCompanyNotFollow","app.loggedIn.company.dialog.addNewInusrer"]),angular.module("app.loggedIn.company.models",[]).factory("CompanyModel",function(Restangular){var instanceService={},mainApi=Restangular.all("api/meditek/v1/company");return instanceService.detail=function(data){var instanceApi=mainApi.all("detail");return instanceApi.post({data:data})},instanceService.list=function(data){var instanceApi=mainApi.all("list");return instanceApi.post({data:data})},instanceService.add=function(data){var instanceApi=mainApi.all("add");return instanceApi.post({data:data})},instanceService.addCompanyNotFollow=function(data){var instanceApi=mainApi.all("addCompanyNotFollow");return instanceApi.post({data:data})},instanceService.insertPatientCompanies=function(company_id,patient_id){var instanceApi=mainApi.all("insertPatientCompanies");return instanceApi.post({company_id:company_id,patient_id:patient_id})},instanceService.listParent=function(data){var instanceApi=mainApi.all("listParent");return instanceApi.post({data:data})},instanceService.byCompanyId=function(data){var instanceApi=mainApi.all("byCompanyId");return instanceApi.post({data:data})},instanceService.listInsurer=function(data){var instanceApi=mainApi.all("listInsurer");return instanceApi.post({data:data})},instanceService.edit=function(data){var instanceApi=mainApi.all("edit");return instanceApi.post({data:data})},instanceService.remove=function(data){var instanceApi=mainApi.all("remove");return instanceApi.post({data:data})},instanceService.removeInsurer=function(data){var instanceApi=mainApi.all("removeInsurer");return instanceApi.post({data:data})},instanceService.upCompanyPatient=function(data){var instanceApi=mainApi.all("upCompanyPatient");return instanceApi.post({data:data})},instanceService.disableInsurer=function(data){var instanceApi=mainApi.all("disableInsurer");return instanceApi.post({data:data})},instanceService.disableCompany=function(data){var instanceApi=mainApi.all("disableCompany");return instanceApi.post({data:data})},instanceService.updateInsurer=function(data){var instanceApi=mainApi.all("updateInsurer");return instanceApi.post({data:data})},instanceService.listNotFollow=function(data){var instanceApi=mainApi.all("listNotFollow");return instanceApi.post({data:data})},instanceService.AddlistNotFollow=function(data){var instanceApi=mainApi.all("AddlistNotFollow");return instanceApi.post({data:data})},instanceService.selectInsurer=function(data){var instanceApi=mainApi.all("selectInsurer");return instanceApi.post({data:data})},instanceService.getFromTime=function(data){var instanceApi=mainApi.all("getFromTime");return instanceApi.post({data:data})},instanceService}),angular.module("app.loggedIn.company.services",[]).factory("CompanyService",function(Restangular){var companyService={},companyApi=Restangular.all("api/erm"),mdtApi=Restangular.all("api/meditek/v1/company/"),restApi=Restangular.all("api/restful/Company");return companyService.mdtSearch=function(options){var funcApi=mdtApi.all("search");return funcApi.post(options)},companyService.mdtById=function(company_id){var funcApi=mdtApi.all("byId");return funcApi.post({company_id:company_id})},companyService.detail=function(id){var instanceApi=companyApi.one("v2/companies/detail");return instanceApi.get({id:id})},companyService.insert=function(data){var instanceApi=companyApi.all("v2/companies/insert");return instanceApi.post({data:data})},companyService.update=function(id,data){var instanceApi=companyApi.all("v2/companies/update");return instanceApi.post({id:id,data:data})},companyService["delete"]=function(id){var instanceApi=companyApi.all("v2/companies/delete");return instanceApi.post({id:id})},companyService.get=function(id){return restApi.one(""+id).get()},companyService}),angular.module("app.loggedIn.company.directives.list",[]).directive("listCompany",function(CompanyModel,$filter,$state,$stateParams,$modal,toastr){return{restrict:"EA",templateUrl:"modules/company/directives/templates/list.html",scope:{options:"=",limit:"@",onRowClick:"&",actionCenter:"="},link:function(scope,elem,attrs){var search={page:1,offset:0,limit:parseInt(scope.limit),company_id:$stateParams.companyId,patient_id:$stateParams.patient_id,Company_name:"",Industry:"",Addr:"",from_date:"",to_date:""};scope.onRowClick=function(row){scope.updateCompany.id=row.id,scope.updateCompany.to_date=null,scope.updateCompany.patient_id=$stateParams.patient_id;var postData=angular.copy(scope.updateCompany);CompanyModel.upCompanyPatient(postData).then(function(response){toastr.success("Change Active Company Successfully"),scope.company.load(),scope.actionCenter.runWhenFinish()},function(error){scope.company.errors=angular.copy(error.data.errors)})};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.remove(row).then(function(response){toastr.success("Delete Successfully"),scope.company.load()},function(error){})})};scope.clickEdit=function(row){$state.go("loggedIn.patient.company.edit",{companyId:row.id})};var load=function(){scope.company.loading=!0,CompanyModel.list(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count,scope.company.search.page=1,scope.company.company_idActive=response.data1[0].company_id},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.addClick=function(){$state.go("loggedIn.patient.company.add")},scope.addClick1=function(){$modal.open({templateUrl:"modules/company/views/add.html",controller:"CompanyAddController",size:"lg",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){scope.company.load()})};var onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value;break;case"country":scope.company.search.country=option.value}scope.company.load(),loadPage(1)},loadPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()};scope.disableCompany=function(row){var postData={patient_id:$stateParams.patient_id,company_id:row.id,isEnable:row.checkisEnable};CompanyModel.disableCompany(postData).then(function(response){scope.company.load()},function(error){})},scope.Select=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listNotFollowPatient.html",controller:"CompanyListNoFollowDialog",size:"",resolve:{listId:function(){return scope.company.list}}}).result.then(function(row){var postData={patient_id:$stateParams.patient_id,company_id:row.id};CompanyModel.AddlistNotFollow(postData).then(function(response){scope.company.load()})})},scope.company={search:search,error:"",count:0,loading:!1,list:[],company_idActive:"",load:function(){load()},loadPage:function(page){loadPage(page)},onSearch:function(option){onSearch(option)},remove:function(size){remove(size)}},scope.updateCompany={id:"",patient_id:""},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.list",[]).controller("CompanyListController",function($scope,$state){$scope.actionCenter={runWhenFinish:function(){$scope.getPatientInfo()}}}),angular.module("app.loggedIn.company.directives.listParent",[]).directive("listParent",function(CompanyModel,$filter,$state){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listParent.html",scope:{options:"=",limit:"@",onRowClick:"&",companyId:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",Company_id:scope.companyId,Industry:"",Addr:"",country:""},load=function(){scope.company.loading=!0,CompanyModel.listParent(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.addClick=function(){$state.go("loggedIn.patient.company.add")};var onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value}scope.company.load(),setPage(1)};scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listParent",[]).controller("CompanyListParentController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.listInsurer",[]).directive("listInsurer",function(CompanyModel,$filter,$state,$modal,toastr){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listInsurer.html",scope:{options:"=",limit:"@",onRowClick:"&",insurerArray:"=",responsedata:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",insurerArray:scope.insurerArray,Industry:"",address:""},load=function(){scope.company.loading=!0,CompanyModel.listInsurer(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})},onSearch=function(option){switch(option.field){case"insurer_name":scope.company.search.insurer_name=option.value;break;case"address":scope.company.search.address=option.value}scope.company.load(),setPage(1)};scope.addNewInsurer=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/addNewInsurer.html",controller:"CompanyAddNewInsurerDialgosController",size:""}).result.then(function(response){"success"===response.status&&CompanyModel.selectInsurer(response.data.insertId).then(function(response){scope.responsedata=response.data[0]})})},scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listInsurer",[]).controller("CompanylistInsurerController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.addCompanyNotFollow",[]).directive("addCompanyNotFollow",function(CompanyModel,$filter,$state,$modal,$stateParams,toastr,$cookieStore,ConfigService,$q){return{restrict:"EA",templateUrl:"modules/company/directives/templates/add.html",scope:{options:"=",onRowClick:"&",success:"=",actionCenter:"="},link:function(scope,elem,attrs){var actionCenter=scope.actionCenter,form={Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,Site_medic:null,User_id:$cookieStore.get("userInfo").id,isPO:null,isExtra:null,parent_id:null,listInsurerid:[]};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.clickDisable=function(row){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1))};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){toastr.success("Delete Successfully")},function(error){})})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return-1}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row));var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){},function(error){})})},save=function(){ConfigService.beforeSave(scope.company.errors);var postData=angular.copy(scope.company.form);postData.Insurer=""===scope.company.InsurerTemp?null:scope.company.InsurerTemp,postData.listInsurerid=scope.company.listTemp,CompanyModel.addCompanyNotFollow(postData).then(function(response){toastr.success("Add Company Successfully"),actionCenter.saveModal(postData.Company_name,response.data[0].id)},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})};scope.company={form:form,listInsurer:[],listTemp:[],errors:[],Company_name_Parent:"",InsurerTemp:"",checkColor:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)}},scope.cancel=function(){actionCenter.closeModal()}}}}),angular.module("app.loggedIn.company.directives.add",[]).directive("addCompany",function(CompanyModel,$filter,$state,$modal,$stateParams,toastr,$cookieStore,ConfigService){return{restrict:"EA",templateUrl:"modules/company/directives/templates/add.html",scope:{options:"=",onRowClick:"&",actionCenter:"="},link:function(scope,elem,attrs){var parent=document.getElementsByClassName("un_tn_modal_remove_background")[0].parentNode;parent.style.background="none",console.log(parent.style.background);var form={Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,Site_medic:[],User_id:$cookieStore.get("userInfo").id,isPO:null,isExtra:null,parent_id:null,listInsurerid:[],from_date:null,to_date:null,patient_id:$stateParams.patient_id,suburb:null};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.clickDisable=function(row){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1))};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){toastr.success("Delete Successfully")},function(error){})})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return-1}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row))})},save=function(){ConfigService.beforeSave(scope.company.errors),_.forEach(form.Site_medic,function(n){delete n.$$hashKey}),scope.company.form.Site_medic=form.Site_medic;var postData=angular.copy(scope.company.form);postData.Insurer=""===scope.company.InsurerTemp?null:scope.company.InsurerTemp,postData.listInsurerid=scope.company.listTemp,postData.from_date&&(postData.from_date=ConfigService.convertToDB(postData.from_date)),postData.to_date&&(postData.to_date=ConfigService.convertToDB(postData.to_date)),CompanyModel.add(postData).then(function(response){toastr.success("Add Company Successfully"),scope.actionCenter.closeModal()},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})},showListCompanyRep=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listCompanyRep.html",controller:function($scope,$modalInstance){$scope.list=form.Site_medic,$scope.onRowClick=function(data){swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Company Rep?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){form.Site_medic.splice(data,1)})},$scope.addlist=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance,toastr){$scope.formAdd=!0,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.submitItem=function(){form.Site_medic.push({name:$scope.listInfo.name}),console.log(form.Site_medic),toastr.success("Add Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.editItem=function(name,index){var name=name,index=index;$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance){$scope.formAdd=!1,$scope.listInfo={name:name},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.saveItem=function(){form.Site_medic[index].name=$scope.listInfo.name,console.log(form.Site_medic),toastr.success("Edit Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.close=function(){$modalInstance.dismiss("cancel")}},size:"md"})};scope.company={form:form,listInsurer:[],listTemp:[],errors:[],Company_name_Parent:"",InsurerTemp:"",checkColor:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)},showListCompanyRep:function(){showListCompanyRep()}},scope.cancel=function(){scope.actionCenter.closeModal()}}}}),angular.module("app.loggedIn.company.controllers.add",[]).controller("CompanyAddController",function($scope,$state,$modalInstance){$scope.actionCenter={closeModal:function(){$modalInstance.close("success")}}}),angular.module("app.loggedIn.company.directives.edit",[]).directive("editCompany",function($filter,$state,$stateParams,CompanyModel,$modal,toastr,$cookieStore,ConfigService){return{restrict:"EA",templateUrl:"modules/company/directives/templates/edit.html",scope:{options:"="},link:function(scope,elem,attrs){var form={id:$stateParams.companyId,patient_id:$stateParams.patient_id,Company_name:null,Industry:null,Addr:null,postcode:null,State:null,Description:null,latitude:null,longitude:null,country:null,result_email:null,invoice_email:null,PO_number:null,isProject:null,isCalendar:null,father_id:null,report_to_email:null,default_status:null,isInvoiceEmailToUser:null,
isAddContactEmailToResult:null,IMA:null,Site_name:null,Medic_contact_no:null,Email:null,CODE:null,Insurer:null,Phone:null,User_id:null,isPO:null,isExtra:null,parent_id:null,listInsurerid:[],from_date:null,to_date:null,suburb:null},load=function(row){scope.company.loading=!0,CompanyModel.byCompanyId(form).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.form=response.data[0],scope.company.form.User_id=$cookieStore.get("userInfo").id,scope.company.listInsurer=response.data1,scope.company.checkColor=scope.company.form.Insurer,_.forEach(scope.company.listInsurer,function(id){scope.company.listTemp.push(id.id)}),scope.company.Company_name_Parent=response.data2[0].Company_name,scope.company.form.from_date=ConfigService.convertToDate(scope.company.form.from_date),scope.company.form.to_date=ConfigService.convertToDate(scope.company.form.to_date),console.log(response.data[0].Site_medic),form.Site_medic=null==response.data[0].Site_medic||void 0==response.data[0].Site_medic||""==response.data[0].Site_medic?[]:JSON.parse(response.data[0].Site_medic),console.log(form.Site_medic)},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})};scope.onRowClick=function(row){var postData={Insurer:row.id,id:$stateParams.companyId};scope.company.InsurerTemp=row.id,scope.company.checkColor=row.id,CompanyModel.updateInsurer(postData).then(function(response){toastr.success("Active Insurer Successfully")},function(error){})},scope.disableInsurer=function(row){var postData={company_id:$stateParams.companyId,insurer_id:row.id,isEnable:row.checkisEnable};CompanyModel.disableInsurer(postData).then(function(response){},function(error){});for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listInsurer[i].checkisEnable=0==scope.company.listInsurer[i].checkisEnable?1:0)};var remove=function(row){$modal.open({templateUrl:"modules/company/dialogs/templates/remove.html",controller:"CompanyRemoveDialog",size:"sm",resolve:{row:function(){return row}}}).result.then(function(row){CompanyModel.removeInsurer(row).then(function(response){for(var i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(scope.company.listTemp.splice(i,1),scope.company.listInsurer.splice(i,1));toastr.success("Delete Successfully")},function(error){})})},save=function(){ConfigService.beforeSave(scope.company.errors),scope.company.form.patient_id=$stateParams.patient_id,_.forEach(form.Site_medic,function(n){delete n.$$hashKey}),scope.company.form.Site_medic=form.Site_medic;var postData=angular.copy(scope.company.form);console.log("chiennn",postData),postData.from_date&&(postData.from_date=ConfigService.convertToDB(postData.from_date)),postData.to_date&&(postData.to_date=ConfigService.convertToDB(postData.to_date)),postData.listInsurerid=scope.company.listInsurer,CompanyModel.edit(postData).then(function(response){toastr.success("Edit Company Successfully"),$state.go("loggedIn.patient.company")},function(error){scope.company.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.company.errors)})},addCompany=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addParent.html",controller:"CompanyAddParentDialgosController",size:"",resolve:{companyId:function(){return $stateParams.companyId}}}).result.then(function(row){scope.company.Company_name_Parent=row.Company_name,scope.company.form.parent_id=row.id,scope.company.form.father_id=row.id})},addInsurer=function(size){$modal.open({templateUrl:"modules/company/dialogs/templates/addInsurer.html",controller:"CompanyInsurerDialgosController",size:"",resolve:{insurerArray:function(){return scope.company.listTemp}}}).result.then(function(row){row.checkisEnable=1;for(var flag=0,i=0;i<=scope.company.listTemp.length;i++)scope.company.listTemp[i]==row.id&&(flag+=1);0>=flag&&(scope.company.listTemp.push(row.id),scope.company.listInsurer.push(row))})},showListCompanyRep=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/listCompanyRep.html",controller:function($scope,$modalInstance){$scope.list=form.Site_medic,$scope.onRowClick=function(data){swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Company Rep?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){form.Site_medic.splice(data,1)})},$scope.addlist=function(){$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance,toastr){$scope.formAdd=!0,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.submitItem=function(){form.Site_medic.push({name:$scope.listInfo.name}),console.log(form.Site_medic),toastr.success("Add Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.editItem=function(name,index){var name=name,index=index;$modal.open({templateUrl:"modules/company/dialogs/templates/companyRep.html",controller:function($scope,$modalInstance){$scope.formAdd=!1,$scope.listInfo={name:name},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.saveItem=function(){form.Site_medic[index].name=$scope.listInfo.name,console.log(form.Site_medic),toastr.success("Edit Company Rep Successfully"),$scope.close()}},size:"sm"})},$scope.close=function(){$modalInstance.dismiss("cancel")}},size:"md"})};scope.company={form:form,error:"",loading:!1,load:function(){load()},save:function(){save()},listInsurer:[],checkColor:"",listTemp:[],Company_name_Parent:"",save:function(){save()},addCompany:function(){addCompany()},addInsurer:function(){addInsurer()},remove:function(row){remove(row)},showListCompanyRep:function(){showListCompanyRep()}},scope.cancel=function(){$state.go("loggedIn.patient.company")},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.edit",[]).controller("CompanyEditController",function($scope,$state){}),angular.module("app.loggedIn.company.directives.listNotFollow",[]).directive("listCompanyNotfollow",function(CompanyModel,$filter,$state,$stateParams){return{restrict:"EA",templateUrl:"modules/company/directives/templates/listNotFollowPatient.html",scope:{options:"=",limit:"@",onRowClick:"&",listId:"=",actionCenter:"="},link:function(scope,elem,attrs){var setPage=function(page){scope.company.search.offset=(page-1)*scope.company.search.limit,scope.company.load()},search={page:1,offset:0,limit:7,max_size:5,Company_name:"",Industry:"",Addr:"",country:"",listId:scope.listId},load=function(){scope.company.loading=!0,CompanyModel.listNotFollow(search).then(function(response){scope.company.loading=!1,scope.company.error="",scope.company.list=response.data,scope.company.count=response.count},function(error){scope.company.loading=!1,scope.company.error=$filter("translate")(error.data.code)})},onSearch=function(option){switch(option.field){case"Company_name":scope.company.search.Company_name=option.value;break;case"Industry":scope.company.search.Industry=option.value;break;case"Addr":scope.company.search.Addr=option.value;break;case"country":scope.company.search.country=option.value}scope.company.load(),setPage(1)};scope.company={search:search,error:"",count:0,loading:!1,list:[],load:function(){load()},setPage:function(page){setPage(page)},onSearch:function(option){onSearch(option)}},scope.company.load()}}}),angular.module("app.loggedIn.company.controllers.listNotFollow",[]).controller("CompanyListNotFollowController",function($scope,$state){}),angular.module("app.loggedIn.company.dialog.addParent",[]).controller("CompanyAddParentDialgosController",function($scope,CompanyModel,$modalInstance,companyId){$scope.companyId=companyId,$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.addNewInusrer",[]).controller("CompanyAddNewInsurerDialgosController",function($scope,CompanyModel,$modalInstance){$scope.responsedata=null,$scope.success=!1,$scope.$watch("success",function(success){success&&$scope.$watch("responsedata",function(success){$modalInstance.close($scope.responsedata)})}),$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.addInusrer",[]).controller("CompanyInsurerDialgosController",function($scope,CompanyModel,$modalInstance,insurerArray){$scope.insurerArray=insurerArray,$scope.responsedata=null,$scope.$watch("responsedata",function(success){success&&$modalInstance.close($scope.responsedata)}),$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.listNoFollow",[]).controller("CompanyListNoFollowDialog",function($scope,CompanyModel,$modalInstance,listId){$scope.listId=listId,$scope.clickRow=function(row){$modalInstance.close(row)},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),angular.module("app.loggedIn.company.dialog.remove",[]).controller("CompanyRemoveDialog",function($scope,$modalInstance,row){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(row)}}),angular.module("app.loggedIn.patient.exercise.directives.list",[]).controller("ExerciseDialog",function($scope,$modalInstance,list){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(list)}}).controller("ExerciseAddDialog",function($scope,$modalInstance){$scope.exercise={success:!1},$scope.$watch("exercise.success",function(success){success&&$modalInstance.close("success")})}).controller("ExerciseEditDialog",function($scope,$modalInstance,list){$scope.exercise={id:list.Exercise_id,success:!1},$scope.$watch("exercise.success",function(success){success&&$modalInstance.close("success")})}).directive("listExercise",function($modal,ConsultationService,toastr,$stateParams){return{restrict:"EA",scope:{limit:"=",reload:"="},templateUrl:"modules/consultation/directives/templates/exercise/listExercise.html",link:function(scope,elem,attrs){var search={page:1,limit:scope.limit,offset:0,max_size:5,patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id},load=function(){var postData=angular.copy(scope.exercise.search);ConsultationService.listExercise(postData).then(function(response){scope.exercise.list=response.data,scope.exercise.count=response.count},function(error){})};scope.add=function(list){$modal.open({templateUrl:"dialogExerciseAdd",controller:"ExerciseAddDialog"}).result.then(function(list){scope.exercise.load(),toastr.success("Add Successfully")})},scope.edit=function(list){$modal.open({templateUrl:"dialogExerciseEdit",controller:"ExerciseEditDialog",resolve:{list:function(){return list}}}).result.then(function(list){scope.exercise.load(),toastr.success("Edit Successfully")})},scope["delete"]=function(list){$modal.open({templateUrl:"dialogExerciseRemove",controller:"ExerciseDialog",resolve:{list:function(){return list}}}).result.then(function(list){ConsultationService.deleteExercise(list).then(function(response){toastr.success("Delete Successfully"),scope.exercise.load()},function(error){})})};var onSearch=function(){scope.exercise.search.offset=0,scope.exercise.load(),scope.exercise.search.page=1},onPage=function(page){scope.exercise.search.offset=(page-1)*scope.exercise.search.limit,scope.exercise.load()};scope.exercise={search:angular.copy(search),load:function(){load()},list:[],onSearch:function(){onSearch()},onPage:function(page){onPage(page)}},scope.exercise.load()}}}).directive("addExercise",function($cookieStore,ConsultationService,ConfigService,$stateParams){return{restrict:"EA",scope:{success:"="},templateUrl:"modules/consultation/directives/templates/exercise/addExercise.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={exercise:"",lastest_weight:"",sets:"",reps:"",other:"",Created_by:user_id,Last_updated_by:user_id,patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id},save=function(){ConfigService.beforeSave(scope.exercise.errors);var postData=angular.copy(scope.exercise.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),ConsultationService.addExercise(postData).then(function(response){scope.success=!0},function(error){scope.exercise.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.exercise.errors)})},load=function(){};scope.exercise={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.exercise.load()}}}).directive("editExercise",function($cookieStore,ConsultationService,ConfigService,$stateParams){return{restrict:"EA",scope:{success:"=",exerciseId:"="},templateUrl:"modules/consultation/directives/templates/exercise/addExercise.html",link:function(scope,elem,attrs){var form=($cookieStore.get("userInfo").id,{exercise:"",lastest_weight:"",sets:"",reps:"",other:"",patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id}),save=function(){ConfigService.beforeSave(scope.exercise.errors);var postData=angular.copy(scope.exercise.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),ConsultationService.updateExercise(postData).then(function(response){scope.success=!0},function(error){scope.exercise.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.exercise.errors)})},load=function(){var postData={id:scope.exerciseId};ConsultationService.getOneExercise(postData).then(function(response){angular.extend(scope.exercise.form,response.data),delete scope.exercise.form.Creation_date},function(error){})};scope.exercise={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.exercise.load()}}}),angular.module("app.loggedIn.patient.consult.directives",[]).directive("consultDrawing",function($window,Restangular,ConfigService,$timeout,toastr,socket){return{restrict:"E",scope:{images:"=",patient:"=",actionCenterDrawing:"="},templateUrl:"modules/consultation/directives/templates/drawingConsult.html",link:function(scope,element,attrs){var lastX,lastY,canvas=element.context.querySelector("canvas"),imageLoader=element.context.querySelector("#imageLoader"),ctx=canvas.getContext("2d"),drawing=!1;scope.colors=[{color:"blue-ebonyclay"},{color:"green"},{color:"blue"},{color:"red"}],scope.color="black",scope.lineWidth=attrs.linewidth,scope.treeArr=[],canvas.width=attrs.width||element.width(),canvas.height=attrs.height||element.height(),Restangular.one("api/consultation/draw/templates").get().then(function(rs){if("success"==rs.status)for(var i=0;i<rs.data.length;i++){var node=rs.data[i];scope.treeArr.push({id:node.id,parent:null==node.parent?"#":node.parent,text:node.fileName,icon:1==node.isFolder?"fa fa-folder icon-state-warning":"fa fa-file icon-state-success"})}});var clearCanvas=function(){ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.restore()};scope.selectNodeCB=function(e){var idArr=String(e.target.id).split("_"),id=idArr[0];null!=id&&"undefined"!=typeof id&&""!=id&&Restangular.one("api/consultation/draw/template",id).get().then(function(rs){if("success"==rs.status){var img=new Image;img.onload=function(){ctx.drawImage(img,(canvas.width-img.width)/2,(canvas.height-img.height)/2)},img.src=rs.data}})},scope.changeColor=function(c){scope.color="blue-ebonyclay"==c?"black":c,scope.lineWidth=attrs.linewidth,scope.erasing=!1},scope.clear=function(){clearCanvas()},scope.erase=function(){scope.color=element.find("#myCanvas").css("background-color"),scope.lineWidth=50,scope.erasing=!0},scope.capture=function(){var imgData=canvas.toDataURL("image/png");Restangular.all("api/consultation/draw/saveImage").post({patient_id:scope.patient,imgData:imgData}).then(function(rs){"success"==rs.status?(scope.images.push(rs.id),toastr.success("Image Saved!"),scope.actionCenterDrawing&&scope.actionCenterDrawing.runWhenFinish&&scope.actionCenterDrawing.runWhenFinish()):toastr.error("Error!")})};var draw=function(lX,lY,cX,cY){ctx.lineCap="round",ctx.fillStyle="solid",ctx.strokeStyle=scope.color,ctx.lineWidth=scope.lineWidth,ctx.moveTo(lX,lY),ctx.lineTo(cX,cY),ctx.stroke()};angular.element(imageLoader).on("change",function(e){var reader=new FileReader;reader.onload=function(event){var img=new Image;img.onload=function(){ctx.drawImage(img,(canvas.width-img.width)/2,(canvas.height-img.height)/2)},img.src=event.target.result},reader.readAsDataURL(e.target.files[0])}),angular.element(canvas).on("mousedown mousemove mouseup mouseout touchstart touchmove touchend",function(event){if("mousemove"!==event.type||drawing)switch(event.preventDefault(),event.type){case"mousedown":case"touchstart":void 0!==event.offsetX?(lastX=event.offsetX,lastY=event.offsetY):(lastX=event.pageX-angular.element(canvas).offset().left,lastY=event.pageY-angular.element(canvas).offset().top),ctx.beginPath(),drawing=!0;break;case"mousemove":case"touchmove":drawing&&(void 0!==event.offsetX?(currentX=event.offsetX,currentY=event.offsetY):(currentX=event.pageX-angular.element(canvas).offset().left,currentY=event.pageY-angular.element(canvas).offset().top),draw(lastX,lastY,currentX,currentY),lastX=currentX,lastY=currentY);break;case"mouseup":case"touchend":case"mouseout":drawing=!1}})}}}).directive("consultationHistory",function(){return{restrict:"E",scope:{actionCenter:"="},templateUrl:"modules/consultation/directives/templates/consultation-history.html",controller:function($scope,ConsultationService){}}}),angular.module("app.loggedIn.patient.consult.services",[]).service("ConsultInfoService",function(){var consultInfoScripts=[],checkdata=[];this.getCheckdata=function(){return checkdata},this.setCheckdata=function(list){checkdata=angular.copy(list)},this.getConsultInfoScripts=function(){return consultInfoScripts},this.setConsultInfoScripts=function(list){consultInfoScripts=angular.copy(list)}}).factory("ConsultationService",function(Restangular){var services={},api=Restangular.all("api"),info={};return services.listExercise=function(data){return api.all("consultation/listExercise").post({data:data})},services.addExercise=function(data){return api.all("consultation/addExercise").post({data:data})},services.getOneExercise=function(data){return api.all("consultation/getOneExercise").post({data:data})},services.updateExercise=function(data){return api.all("consultation/updateExercise").post({data:data})},services.deleteExercise=function(data){return api.all("consultation/deleteExercise").post({data:data})},services.getPatientProblem=function(patientId){return api.all("consultation/getPatientProblem").post({patient_id:patientId})},services.submitConsult=function(info){return api.all("consultation/submit").post({info:info})},services.getPatientCompany=function(patientId){return api.all("consultation/patient/company").post({patient_id:patientId})},services.searchScript=function(info){return api.all("erm/v2/medicine/search").post({search:info})},services.getConsultInfo=function(){return info},services.setConsultInfo=function(consultInfo){info=angular.copy(consultInfo)},services.getListConsultOfPatient=function(patient_id){return api.all("consultation/listconsultofpatient").post({patient_id:patient_id})},services.beforeStartSession=function(postData){return api.all("consultation/beforeStartSession").post({postData:postData})},services.startSession=function(data){return api.all("consultation/startSession").post({data:data})},services.beforeFinishSession=function(data){return api.all("consultation/beforeFinishSession").post({data:data})},services.finishSession=function(data){return api.all("consultation/finishSession").post({data:data})},services.getApptPatient=function(data){return api.all("consultation/getApptPatient").post({data:data})},services.getByIdConsult=function(consult_id){return api.all("consultation/byidConsult").post({consult_id:consult_id})},services.checkConsultation=function(patient_id,cal_id){return api.all("consultation/check-consultation-patientID-calID").post({patient_id:patient_id,cal_id:cal_id})},services.getImgDrawingHistory=function(patient_id,cal_id){return api.all("consultation/get-img-drawing-history").post({patient_id:patient_id,cal_id:cal_id})},services.getListCor=function(data){return api.all("consultation/listCor").post({data:data})},services.postAddCor=function(data){return api.all("consultation/addCor").post({data:data})},services.postByIdCor=function(data){return api.all("consultation/byidCor").post({data:data})},services}),angular.module("app.loggedIn.patient.consult.itemsheetController",[]).controller("PatientConsultItemsheetController",function($filter,$cookieStore,$scope,$state,$modal,toastr,$stateParams,ConsultationService,PatientService,ReceptionistService,InvoiceService){alert("Controller PatientConsultItemsheetController khong con duoc du dung");var arrGetBy=$filter("arrGetBy");$scope.appointment={CAL_ID:$stateParams.cal_id,Patient_id:$stateParams.patient_id},$scope.items_search_panel={},$scope.deptItems=null,$scope.apptItems=[],$scope.extraItems=[],$scope.backClick=function(){$state.go("loggedIn.consult.patient",{patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id})};var isInDeptItems=function(item_id){for(var i=0,len=$scope.deptItems.length;len>i;++i)for(var cat=$scope.deptItems[i],j=0,len2=cat.items.length;len2>j;++j){var t_item=cat.items[j];if(item_id==t_item.ITEM_ID)return t_item}return!1};PatientService.initInvoice($scope.appointment.Patient_id,$scope.appointment.CAL_ID),ReceptionistService.apptDetail($scope.appointment.CAL_ID).then(function(response){return"success"===response.status?(delete response.data.Patient_id,angular.extend($scope.appointment,response.data),PatientService.getDeptItems($scope.appointment.CLINICAL_DEPT_ID)):void 0}).then(function(response){return"success"===response.status?($scope.deptItems=response.data.filter(function(item){return item.clnDeptItemList.ISENABLE}),InvoiceService.selectInvoiceLinesBySession($scope.appointment.Patient_id,$scope.appointment.CAL_ID)):void 0}).then(function(response){if("success"===response.status){$scope.apptItems=response.data;var item_id_list=[];return angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){item.PRICE=0,item.TIME_SPENT=0,item.QUANTITY=1,item_id_list.push(item.ITEM_ID)})}),angular.forEach($scope.apptItems,function(item){var t_item=isInDeptItems(item.ITEM_ID);t_item?(t_item.QUANTITY=item.QUANTITY,t_item.TIME_SPENT=item.TIME_SPENT,t_item.PRICE=item.PRICE,t_item.checked=1===item.is_enable?"1":"0",t_item.inserted="1"===t_item.checked):($scope.extraItems.push(item),item_id_list.push(item.ITEM_ID),item.checked=1===item.is_enable?"1":"0",item.inserted="1"===item.checked)}),ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,item_id_list)}}).then(function(response){if(response&&response.list){var list_fee=response.list;angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}),angular.forEach($scope.extraItems,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}}),$scope.itemOptions={click:function(item){"dept_item"!=item.type&&"extra_item"!=item.type&&($scope.extraItems.push(item),item.QUANTITY=1,item.TIME_SPENT=0,item.checked="1",ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,[item.ITEM_ID]).then(function(response){response.list.length>0?(item.PRICE=response.list[0].SCHEDULE_FEE,item.disable_fee=!0):(item.PRICE=0,item.disable_fee=!1)}))},"class":function(item){if(isInDeptItems(item.ITEM_ID))return item.type="dept_item","danger";var t_item=arrGetBy($scope.extraItems,"ITEM_ID",item.ITEM_ID);return t_item?(item.type="extra_item","info"):void 0},options:{api:"api/erm/v2/items/search",method:"post",scope:$scope.items_search_panel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}}},$scope.itemSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1}},$scope.submitClick=function(){var insertArr=[],fnInsertArr=function(item){var t={CLN_ITEM_ID:item.ITEM_ID,Patient_id:$scope.appointment.Patient_id,cal_id:$scope.appointment.CAL_ID,PRICE:item.PRICE,TIME_SPENT:item.TIME_SPENT?item.TIME_SPENT:0,QUANTITY:item.QUANTITY,is_enable:"1"==item.checked?1:0};insertArr.push(t)};angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,fnInsertArr)}),angular.forEach($scope.extraItems,fnInsertArr)}}),angular.module("app.loggedIn.patient.consult.scriptController",[]).controller("ScriptController",function($timeout,OutreferralModel,AppointmentModel,ConfigService,$cookieStore,$scope,$filter,$state,$modal,toastr,$modalInstance,ConsultationService,$stateParams,actual_doctor_id,script){var user_id=$cookieStore.get("userInfo").id;$scope.postData={CAL_ID:$stateParams.cal_id,DOCTOR_ID:null,user_name:null,Provider_no:null},$scope.scriptInfo={medication_name:null,start_date:null,dose:null,end_date:null,unit:null,qty:null,route:null,doctor_id:null,user_name:null,Provider_no:null,frequency:null,condition_Indication:null};var getUsername=function(){OutreferralModel.DotorFromUserId(user_id).then(function(response){$scope.scriptInfo.doctor_id=user_id,$scope.scriptInfo.user_name=response.data[0].NAME,$scope.scriptInfo.Provider_no=response.data[0].Provider_no},function(error){})};getUsername(),$scope.listUnit=ptnConst.unit,$scope.listRoute=ptnConst.route,$scope.listFrequency=ptnConst.frequency,$scope.medications=[],$scope.selectedMedication=null,$scope.checkMedication=!0,ConsultationService.searchScript({medicine_name:""}).then(function(rs){$scope.medications=rs.list;for(var i=0;i<$scope.medications.length;i++){var item=$scope.medications[i],unit="Unit: "+item.medicine_unit;$scope.medications[i].desc=unit}}),null!=script&&($scope.scriptInfo=angular.copy(script)),$scope.changeValue=function(){if(null!==$scope.scriptInfo.frequency&&null!==$scope.scriptInfo.dose&&null!==$scope.scriptInfo.start_date&&null!==$scope.scriptInfo.end_date){var start_date=ConfigService.convertToDB($scope.scriptInfo.start_date);start_date=moment(start_date).format("YYYY-MM-DD");var end_date=ConfigService.convertToDB($scope.scriptInfo.end_date);end_date=moment(end_date).format("YYYY-MM-DD");var a=moment(end_date),b=moment(start_date),diffInDays=a.diff(b,"days"),day=diffInDays+1,frequency=$scope.scriptInfo.frequency,dose=$scope.scriptInfo.dose;$scope.scriptInfo.qty=day*frequency*dose}},$scope.cancelClick=function(){$modalInstance.close({type:"cancel"})},$scope.okClick=function(){$scope.isSubmit=!0,$scope.medicationForm.$invalid||$modalInstance.close({type:"ok",value:$scope.scriptInfo})},$scope.$watch("selectedMedication",function(val){if("undefined"!=typeof val&&null!=val){var medicine=val.originalObject;$scope.scriptInfo.medication=medicine.medicine_name,$scope.scriptInfo.qty=1}})}).directive("number",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){if(void 0==inputValue)return"";var transformedInput=inputValue.replace(/[^0-9]/g,"");return transformedInput!=inputValue&&(modelCtrl.$setViewValue(transformedInput),modelCtrl.$render()),transformedInput}),element.bind("keypress",function(event){32===event.keyCode&&event.preventDefault()})}}}),angular.module("app.loggedIn.patient.consult.measurementController",[]).controller("MeasurementController",function($scope,$filter,$state,$modal,toastr,$modalInstance,$stateParams,measure){$scope.today=$filter("date")(new Date,"dd/MM/yyyy"),$scope.measurementInfo={measure_date:new Date,bp1:0,bp2:0,rate:0,height:0,weight:0,excessWt:0,bmi:0,waist:0,ratio:0,hips:0,neck:0,head_circ:0,cholesterol:0,psa:0,triglycerides:0,creatitine:0,hdl:0,acr:0,ldl:0,gfr:0,bsl:0,hbA1c:0,isMdrd:null,isCockroft_gault:null,microalbuminuria:0,potassium:0,fev1:0,fvc:0,gas_transfer:0,right_pressure:0,left_pressure:0,right_uncorrected:0,left_uncorrected:0,right_corrected:0,left_corrected:0},null!=measure&&($scope.measurementInfo=angular.copy(measure)),$scope.cancelClick=function(){$modalInstance.close({type:"cancel"})},$scope.okClick=function(){0==$scope.measurementInfo.isMdrd?$scope.measurementInfo.isCockroft_gault=1:1==$scope.measurementInfo.isMdrd&&($scope.measurementInfo.isCockroft_gault=0),$modalInstance.close({type:"ok",value:$scope.measurementInfo})},$scope.calculateBMI=function(height,weight){var w=null,h=null,bmi=0;w=null==weight||"undefined"==typeof weight||""==weight||isNaN(parseFloat(weight))?null:parseFloat(weight),h=null==height||"undefined"==typeof height||""==height||isNaN(parseFloat(height))?null:.01*parseFloat(height),null!=w&&null!=h?(bmi=w/(h*h),$scope.measurementInfo.bmi=$filter("number")(bmi,2)):$scope.measurementInfo.bmi=0}}),angular.module("app.loggedIn.patient.consult.consulthistoryController",[]).controller("ConsultHistoryController",function($scope,$state,ConsultationService,consults,$modalInstance){$scope.consultion={consults:consults},$scope.listConsult=consults,$scope.cancelDetail=function(){$modalInstance.close({type:"cancel"})}}),angular.module("app.loggedIn.patient.consult.controller",[]).controller("PatientConsultController",function(ConsultInfoService,InjuryManagementService,DoctorService,$filter,$rootScope,$interval,$window,$document,$cookieStore,$scope,$state,$modal,InsurerService,toastr,socket,OTSession,ReceptionistService,$stateParams,ConsultationService,PatientService,UserService,$interval,InvoiceService){function popup(url){return params="width="+screen.width,params+=", height="+screen.height,params+=", top=0, left=0",params+=", fullscreen=yes",(null==window.calling_screen||window.calling_screen.closed)&&(window.calling_screen=window.open(url,"RedimedCallingWindow",params),window.calling_screen.focus()),null==window.calling_screen||window.calling_screen.closed||window.calling_screen.open("","RedimedCallingWindow",""),!1}function refresh(patientId){ConsultationService.getPatientCompany(patientId).then(function(rs){exlog.log(rs),"success"==rs.status.toLowerCase()&&rs.info&&($scope.companyInfo=rs.info)},function(err){exlog.logErr(err)})}function cancelListenerHandler(){console.log("Remove Success")}$scope.templates=[],$scope.viewInjury=function(){InjuryManagementService.getInjuryById($scope.apptPatient.injury_id).then(function(rs){"success"==rs.status&&$modal.open({templateUrl:"modules/consultation/dialogs/dialog_injury_details.html",size:"md",resolve:{injuryInfo:function(){return rs.data}},controller:function($scope,$modalInstance,$stateParams,injuryInfo,InjuryManagementService){if($scope.info=injuryInfo,$scope.loadedImage=!1,$scope.injuryImages=[],$scope.imgArr=[],$scope.info.injury_date=moment.utc($scope.info.injury_date).format("DD/MM/YYYY - hh:mm:ss"),"undefined"!=typeof injuryInfo.injuryImg&&injuryInfo.injuryImg.length>0){$scope.loadedImage=!0;for(var i=0;i<injuryInfo.injuryImg.length;i++)$scope.imgArr.push({url:location.origin+"/api/im/image/"+injuryInfo.injuryImg[i].id,img:injuryInfo.injuryImg[i]})}$scope.cancelClick=function(){$modalInstance.close()},$scope.viewImage=function(img){$modal.open({templateUrl:"modules/injuryManagement/views/imageModal.html",size:"md",resolve:{imgObj:function(){return img}},controller:function($scope,$state,$modalInstance,UserService,socket,toastr,imgObj){$scope.img={image:location.origin+"/api/im/image/"+imgObj.id,description:imgObj.desc}}})}}})})},$scope.addTemplate=function(){$modal.open({templateUrl:"listTemplateDialog",controller:function($scope,$modalInstance,$stateParams){$scope.patient_id=$stateParams.patient_id,$scope.cal_id=$stateParams.cal_id,$scope.success=null,$scope.$watch("success",function(success){success&&$modalInstance.close(success);

})}}).result.then(function(success){console.log(success),$scope.templates.push(success)})},$scope.loadDataAddMakeReferral={},$scope.referralAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.loadDataAddMakeReferral.load(),$scope.referralAddForm.close()}},$scope.patient_id=$stateParams.patient_id,$scope.cal_id=$stateParams.cal_id,$scope.userInfo=$cookieStore.get("userInfo"),$scope.patientInfo={},$scope.companyInfo={},$scope.problemArr=[],$scope.isConsult=!0,$scope.tscripts=ConsultInfoService.getConsultInfoScripts(),$scope.checkdata=ConsultInfoService.getCheckdata(),$scope.checkdata.cal_id==$stateParams.cal_id&&$scope.checkdata.patient_id==$stateParams.patient_id?($scope.tscripts=ConsultInfoService.getConsultInfoScripts(),$scope.checkdata=ConsultInfoService.getCheckdata()):($scope.tscripts=[],$scope.checkdata=[]),$scope.consultInfo={patient_id:$scope.patient_id,cal_id:$scope.cal_id,problem_id:null,history:null,examination:null,treatment:null,diagnosis:null,investigation:null,specialist:null,progress_note:null,attendance_record:null,communication_record:null,measurements:[],scripts:$scope.tscripts,images:[]},$scope.loadConsultationInfo=function(){ConsultationService.checkConsultation($scope.patient_id,$scope.cal_id).then(function(data){"success"==data.status&&($scope.consultInfo.problem_id=data.data.problem_id,$scope.consultInfo.history=data.data.history,$scope.consultInfo.examination=data.data.examination,$scope.consultInfo.treatment=data.data.treatment_plan,$scope.consultInfo.diagnosis=data.data.diagnosis,$scope.consultInfo.investigation=data.data.investigation,$scope.consultInfo.specialist=data.data.specialist,$scope.consultInfo.progress_note=data.data.progress_note,$scope.consultInfo.attendance_record=data.data.attendance_record,$scope.consultInfo.communication_record=data.data.communication_record,$scope.consultInfo.consult_id=data.data.consult_id)})},$scope.loadConsultationInfo(),$scope.actionCenter={},$scope.setListConsultationOfPatient=function(){ConsultationService.getListConsultOfPatient($stateParams.patient_id).then(function(data){"success"==data.status&&($scope.actionCenter.listConsultOfPatient=data.data,console.log($scope.actionCenter.listConsultOfPatient))})},$scope.setListConsultationOfPatient(),$scope.actionCenter.showPopupHistory=function(data){$modal.open({templateUrl:"modules/consultation/dialogs/dialogs_consult_history.html",controller:"ConsultHistoryController",resolve:{consults:function(){return data}}})},$scope.actionCenter.showPopupHistoryPhysiotherapist=function(data){$modal.open({templateUrl:"modules/consultation/dialogs/dialogs_consult_history_physiotherapist.html",controller:"ConsultHistoryController",resolve:{consults:function(){return data}}})},$scope.actionCenter.showPopupHistoryExercisePhysiologist=function(data){$modal.open({templateUrl:"modules/consultation/dialogs/dialogs_consult_history_exercise_physiologist.html",controller:"ConsultHistoryController",resolve:{consults:function(){return data}}})},$scope.getImgDrawingHistory=function(){console.log($scope.cal_id),console.log($stateParams.patient_id),$scope.listImgDrawingHistory={},ConsultationService.getImgDrawingHistory($stateParams.patient_id,$scope.cal_id).then(function(data){"success"==data.status&&($scope.listImgDrawingHistory=data.data,console.log("aaaa",$scope.listImgDrawingHistory))})},$scope.getImgDrawingHistory(),$scope.loadImgDrawing=function(){$scope.getImgDrawingHistory()},$scope.showPopupConsultationHistory=function(){angular.element("#popupConsultationHistory").modal("show")},$scope.popupNewDrawing=function(){angular.element("#popupNewDrawing").modal("show")},$scope.actionCenterDrawing={runWhenFinish:function(){angular.element("#popupNewDrawing").modal("hide")}},$scope.currDate=$filter("date")(new Date,"dd/MM/yyyy hh:mm a"),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$scope.checkdata={cal_id:$stateParams.cal_id,patient_id:$stateParams.patient_id},console.log($scope.checkdata),ConsultInfoService.setConsultInfoScripts($scope.consultInfo.scripts),ConsultInfoService.setCheckdata($scope.checkdata)}),$scope.timerDisplay=null,$scope.problemAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&($scope.problemAddForm.close(),ConsultationService.getPatientProblem($scope.patient_id).then(function(rs){"success"==rs.status.toLowerCase()&&rs.data&&($scope.problemList=rs.data,$scope.consultInfo.problem_id=response.data.Problem_id,$scope.viewProblem(response.data.Problem_id))}))}},$scope.callInfo={isCalling:null,callUser:null},refresh($scope.patient_id),socket.removeListener("online",cancelListenerHandler()),socket.on("online",function(userList){refresh($scope.patient_id)}),PatientService.get($scope.patient_id).then(function(rs){if("success"==rs.status.toLowerCase()&&rs.data){var fName=[];fName.push(rs.data.First_name,rs.data.Sur_name,rs.data.Middle_name),$scope.patientInfo=rs.data,$scope.patientInfo.FullName=null!=rs.data.Title||""!=rs.data.Title?rs.data.Title+" . "+fName.join(" "):fName.join(" "),InsurerService.insurerByPatient($scope.patient_id).then(function(res){"success"==res.status.toLowerCase()&&res.data.length>0&&($scope.patientInfo.insurer=res.data[0].insurer_name)})}}),ConsultationService.getPatientProblem($scope.patient_id).then(function(rs){"success"==rs.status.toLowerCase()&&rs.data&&($scope.problemList=rs.data)}),$scope.viewProblem=function(id){if($scope.problemArr=[],null!=id){var index=_.findIndex($scope.problemList,{Problem_id:id});$scope.problemArr.push($scope.problemList[index])}else $scope.problemArr=[]},$scope.measureAction=function(type,index){if("new"==type){var modalInstance=$modal.open({templateUrl:"modules/consultation/views/modal/measureModal.html",size:"lg",controller:"MeasurementController",resolve:{measure:function(){return null}}});modalInstance.result.then(function(data){"ok"==data.type&&$scope.consultInfo.measurements.push(data.value)})}if("edit"==type){var modalInstance=$modal.open({templateUrl:"modules/consultation/views/modal/measureModal.html",size:"lg",controller:"MeasurementController",resolve:{measure:function(){return $scope.consultInfo.measurements[index]}}});modalInstance.result.then(function(data){"ok"==data.type&&($scope.consultInfo.measurements[index]=data.value)})}"delete"==type&&swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Measure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){$scope.consultInfo.measurements.splice(index,1)})},$scope.scriptAction=function(type,index){if("new"==type){var modalInstance=$modal.open({templateUrl:"modules/consultation/views/modal/scriptModal.html",windowClass:"consult-modal-window",controller:"ScriptController",resolve:{actual_doctor_id:function(){return $scope.actual_doctor_id},script:function(){return null}}});modalInstance.result.then(function(data){if("ok"==data.type&&null!==data.value.medication_name){for(var count=0,i=0;i<$scope.consultInfo.scripts.length;i++)$scope.consultInfo.scripts[i].medication_name===data.value.medication_name&&count++;0===count&&$scope.consultInfo.scripts.push(data.value)}})}if("edit"==type){var modalInstance=$modal.open({templateUrl:"modules/consultation/views/modal/scriptModal.html",windowClass:"consult-modal-window",controller:"ScriptController",resolve:{actual_doctor_id:function(){return $scope.actual_doctor_id},script:function(){return $scope.consultInfo.scripts[index]}}});modalInstance.result.then(function(data){"ok"==data.type&&($scope.consultInfo.scripts[index]=data.value)})}"delete"==type&&swal({title:"Confirm Delete",text:"Are You Sure Want To Delete This Script?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){$scope.consultInfo.scripts.splice(index,1)})},$scope.backClick=function(){var from=$cookieStore.get("fromState"),params={};(null!=from.fromParams||"undefined"!=typeof from.fromParams)&&angular.forEach(from.fromParams,function(value,key){params[key]=value}),$state.go(from.fromState.name,params)},$scope.makeCall=function(user){socket.removeListener("generateSessionSuccess",cancelListenerHandler()),socket.emit("generateSession",$scope.userInfo.id),socket.on("generateSessionSuccess",function(opentokRoom){opentokRoom&&popup($state.href("make_call",{apiKey:opentokRoom.apiKey,sessionId:opentokRoom.sessionId,token:opentokRoom.token,callUser:user.id,isCaller:1,patientId:$scope.patient_id}))})},$scope.dropzoneConfig={options:{url:"api/upload",addRemoveLinks:!0},eventHandlers:{sending:function(file,xhr,formData){formData.append("patient_id",$scope.patient_id)},success:function(file,response){"success"==response.status?(socket.emit("shareFile",response.id,response.fileName,$scope.callInfo.callUser),toastr.success("Upload File Successfully!")):toastr.error("Upload File Failed!")}}},$scope.selectedOpt=null,$scope.currWorkcover=null,$scope.first_opt=PatientService.workcoverSearchOpt("first",$scope.patient_id),$scope.progress_opt=PatientService.workcoverSearchOpt("progress",$scope.patient_id),$scope.final_opt=PatientService.workcoverSearchOpt("final",$scope.patient_id),$scope.general_opt=PatientService.workcoverSearchOpt("general",$scope.patient_id),$scope.viewWorkcover=function(i){switch($scope.selectedOpt=i,i){case 1:$scope.currWorkcover="First Assessment";break;case 2:$scope.currWorkcover="Progress Assessment";break;case 3:$scope.currWorkcover="Final Assessment";break;case 4:$scope.currWorkcover="General Assessment"}},$scope.addWorkcover=function(){if(null!=$scope.selectedOpt)switch($scope.selectedOpt){case 1:$state.go("loggedIn.waworkcover.first",{patient_id:$scope.patient_id,action:"add",cal_id:$scope.cal_id,wc_id:0});break;case 2:$state.go("loggedIn.waworkcover.progress",{patient_id:$scope.patient_id,action:"add",cal_id:$scope.cal_id,wc_id:0});break;case 3:$state.go("loggedIn.waworkcover.final",{patient_id:$scope.patient_id,action:"add",cal_id:$scope.cal_id,ass_id:0});break;case 4:$state.go("loggedIn.waworkcover.general",{patient_id:$scope.patient_id,action:"add",cal_id:$scope.cal_id,ass_id:0})}};var arrGetBy=$filter("arrGetBy");$scope.appointment={CAL_ID:$scope.cal_id,Patient_id:$scope.patient_id},$scope.items_search_panel={},$scope.deptItems=null,$scope.apptItems=[],$scope.extraItems=[];var isInDeptItems=function(item_id){if($scope.deptItems.length>0)for(var i=0,len=$scope.deptItems.length;len>i;++i)for(var cat=$scope.deptItems[i],j=0,len2=cat.items.length;len2>j;++j){var t_item=cat.items[j];if(item_id==t_item.ITEM_ID)return t_item}return!1};$scope.invoiceHeaderInfo=null,PatientService.initInvoice($scope.appointment.Patient_id,$scope.appointment.CAL_ID).then(function(data){InvoiceService.selectInvoiceHeaderBySession($scope.appointment.Patient_id,$scope.appointment.CAL_ID).then(function(data){"success"==data.status?$scope.invoiceHeaderInfo=data.data:(alert("Get Invoice Header Error."),exlog.logErr(data))},function(err){alert("Get Invoice Header Error."),exlog.logErr(err)})},function(err){alert("Init Invoice Error."),exlog.logErr(err)}),ReceptionistService.apptDetail($scope.appointment.CAL_ID).then(function(response){return"success"===response.status?(delete response.data.Patient_id,angular.extend($scope.appointment,response.data),PatientService.getDeptItems($scope.appointment.CLINICAL_DEPT_ID)):void 0}).then(function(response){return"success"===response.status?($scope.deptItems=response.data.filter(function(item){return item.clnDeptItemList.ISENABLE}),InvoiceService.selectInvoiceLinesBySession($scope.appointment.Patient_id,$scope.appointment.CAL_ID)):void 0}).then(function(response){if("success"===response.status){$scope.apptItems=response.data;var item_id_list=[];return angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){item.PRICE=0,item.TIME_SPENT=0,item.QUANTITY=1,item_id_list.push(item.ITEM_ID)})}),angular.forEach($scope.apptItems,function(item){var t_item=isInDeptItems(item.ITEM_ID);t_item?(t_item.QUANTITY=item.QUANTITY,t_item.TIME_SPENT=item.TIME_SPENT,t_item.PRICE=item.PRICE,t_item.checked=1===item.IS_ENABLE?"1":"0",t_item.inserted="1"===t_item.checked):($scope.extraItems.push(item),item_id_list.push(item.ITEM_ID),item.checked=1===item.IS_ENABLE?"1":"0",item.inserted="1"===item.checked)}),ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,item_id_list)}}).then(function(response){if(response&&response.list){var list_fee=response.list;angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}),angular.forEach($scope.extraItems,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}}),$scope.itemOptions={click:function(item){"dept_item"!=item.type&&"extra_item"!=item.type&&($scope.extraItems.push(item),item.QUANTITY=1,item.TIME_SPENT=0,item.checked="1",ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,[item.ITEM_ID]).then(function(response){response.list.length>0?(item.PRICE=response.list[0].SCHEDULE_FEE,item.disable_fee=!0):(item.PRICE=0,item.disable_fee=!1)}))},"class":function(item){if(isInDeptItems(item.ITEM_ID))return item.type="dept_item","danger";var t_item=arrGetBy($scope.extraItems,"ITEM_ID",item.ITEM_ID);return t_item?(item.type="extra_item","info"):void 0},options:{api:"api/erm/v2/items/search",method:"post",scope:$scope.items_search_panel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"TAX_ID",label:"Tax Id",is_hide:!0},{field:"TAX_CODE",label:"Tax code"},{field:"TAX_RATE",label:"Tax rate"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}}},$scope.itemSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1}},$scope.submitClick=function(){if(!$scope.invoiceHeaderInfo)return void alert("Error.Invoice Header Not Exist.");for(var i=0;i<$scope.consultInfo.measurements.length;i++)$scope.consultInfo.measurements[i].patient_id=$scope.patient_id,$scope.consultInfo.measurements[i].cal_id=$scope.cal_id;var consultInfoTemp=angular.copy($scope.consultInfo);consultInfoTemp.templates=$scope.templates,ConsultationService.submitConsult(consultInfoTemp).then(function(res){if("success"==res.status){toastr.success("Submit Consultation Success!"),$scope.loadConsultationInfo();var insertArr=[],fnInsertArr=function(item){var t={HEADER_ID:$scope.invoiceHeaderInfo.header_id,ITEM_ID:item.ITEM_ID,PRICE:item.PRICE,QUANTITY:item.QUANTITY,AMOUNT:item.PRICE*item.QUANTITY,TAX_ID:item.TAX_ID,TAX_CODE:item.TAX_CODE,TAX_RATE:item.TAX_RATE,TAX_AMOUNT:item.PRICE*item.QUANTITY*(item.TAX_RATE?item.TAX_RATE:0),TIME_SPENT:item.TIME_SPENT?item.TIME_SPENT:0,IS_ENABLE:"1"==item.checked?1:0};insertArr.push(t)};$scope.deptItems&&angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,fnInsertArr)}),$scope.extraItems&&angular.forEach($scope.extraItems,fnInsertArr);var postData={invoiceHeaderId:$scope.invoiceHeaderInfo.header_id,listLine:insertArr};InvoiceService.saveInvoiceLineSheet(postData).then(function(data){"success"==data.status?(toastr.success("Save invoice item success."),$scope.setListConsultationOfPatient(),$scope.getImgDrawingHistory()):(data.status="non-data")?toastr.warning("No invoice item."):toastr.error("Save invoice item error.")},function(err){toastr.error("Save invoice item error.")})}else toastr.success("Submit Consultation Failed!")})},$scope.apptPatient={},$scope.actual_doctor_id={},$scope.apptStatus=ptnConst.apptStatus,$scope.getApptPatient=function(){var postData={patientId:$scope.patient_id,calId:$scope.cal_id};ConsultationService.getApptPatient(postData).then(function(data){if("success"==data.status){if($scope.apptPatient=data.data,DoctorService.getById($scope.apptPatient.actual_doctor_id).then(function(data){void 0===data&&($scope.actual_doctor_id={NAME:null}),$scope.actual_doctor_id=data}),$scope.apptPatient.SESSION_START_TIME&&$scope.apptPatient.SESSION_END_TIME){var tempStart=moment(new Date($scope.apptPatient.SESSION_START_TIME)),tempEnd=moment(new Date($scope.apptPatient.SESSION_END_TIME)),x=tempEnd.diff(tempStart,"seconds");$scope.timerDisplay=kiss.msToTimer(x).display}$scope.apptPatient.appt_status==ptnConst.apptStatus.inConsult.value&&($scope.startSessionTime=$scope.apptPatient.SESSION_START_TIME)}else $scope.actual_doctor_id={NAME:null},exlog.log(data)},function(err){exlog.logErr(err)})},$scope.getApptPatient(),$scope.startSession=function(){function executeStart(){var startSessionTime=new Date,postData={patientId:$scope.patient_id,calId:$scope.cal_id,startSessionTime:moment(startSessionTime).format("YYYY/MM/DD HH:mm:ss")};ConsultationService.startSession(postData).then(function(data){"success"==data.status?($scope.apptPatient.appt_status=ptnConst.apptStatus.inConsult.value,toastr.success("Start progress success."),$scope.startSessionTime=startSessionTime,$scope.apptPatient.SESSION_START_TIME=startSessionTime,socket.emit("notifyReceptionist")):(exlog.logErr(data),toastr.error("Start progress error."))},function(err){exlog.logErr(err),toastr.error("Start progress error.")})}var doctorData={};doctorData.doctorId=$scope.apptPatient.DOCTOR_ID,$scope.apptPatient.actual_doctor_id&&(doctorData.actualDoctorId=$scope.apptPatient.actual_doctor_id),executeStart()},$scope.beforeFinishSession=function(){var postData={patientId:$scope.patient_id,calId:$scope.cal_id};ConsultationService.beforeFinishSession(postData).then(function(data){"success"==data.status?data.data.length>0?$scope.finishSession():$modal.open({templateUrl:"notifyChooseItem",controller:function($scope,$modalInstance){$scope.ok=function(){$modalInstance.dismiss("cancel")}},size:"sm"}):(exlog.logErr(data),toastr.error("Complete progress fail."))},function(err){exlog.logErr(err),toastr.error("Complete progress fail.")})},$scope.finishSession=function(){var endSessionTime=new Date,postData={patientId:$scope.patient_id,calId:$scope.cal_id,endSessionTime:moment(endSessionTime).format("YYYY/MM/DD HH:mm:ss")};ConsultationService.finishSession(postData).then(function(data){"success"==data.status?($scope.apptPatient.appt_status=ptnConst.apptStatus.completed.value,$scope.startSessionTime="close",$scope.apptPatient.SESSION_END_TIME=endSessionTime,toastr.success("Complete progress success."),socket.emit("notifyReceptionist")):(exlog.logErr(data),toastr.error("Complete progress fail."))},function(err){exlog.logErr(err),toastr.error("Complete progress fail.")})}}).directive("dropzone",function(){return function(scope,element,attrs){var config,dropzone;config=scope[attrs.dropzone],dropzone=new Dropzone(element[0],config.options),angular.forEach(config.eventHandlers,function(handler,event){dropzone.on(event,handler)})}}),angular.module("app.loggedIn.corres.list.controller",[]).controller("CorrespondenceController",function($scope,$state){}),angular.module("app.loggedIn.corres.list.directive",[]).directive("listCor",function(ConsultationService,ConfigService,$modal,$filter,$stateParams,$state,toastr){return{restrict:"EA",templateUrl:"modules/consultation/directives/template_cor/list.html",scope:{options:"="},link:function(scope,ele,attrs){var search={page:1,limit:20,offset:0,max_size:5,PATIENT_ID:$stateParams.patient_id,CAL_ID:$stateParams.cal_id},load=function(){ConsultationService.getListCor(search).then(function(response){scope.cor.list=response.data,scope.cor.list.Date=ConfigService.convertToDate_F(response.data.Date),scope.cor.count=response.count},function(error){})};scope.setPage=function(page){scope.cor.search.offset=(page-1)*scope.cor.search.limit,scope.cor.load()},scope.Action=function(type,index){"new"==type&&$modal.open({templateUrl:"CorAdd",controller:"CorrespondenceAddController"}).result.then(function(response){scope.cor.load()}),"update"==type&&(console.log("sdjkds ",index),$modal.open({templateUrl:"CorEdit",controller:"CorrespondenceEditController",resolve:{id:function(){return index}}}).result.then(function(response){scope.cor.load()}))},scope.cor={search:search,load:function(){load()},loading:!1,list:[],count:0,errors:[]},scope.cor.load()}}}),angular.module("app.loggedIn.corres.add.controller",[]).controller("CorrespondenceAddController",function($scope,$state,$modalInstance){$scope.addcor={success:!1},$scope.$watch("addcor.success",function(success){success&&$modalInstance.close("success")})}),angular.module("app.loggedIn.corres.add.directive",[]).directive("addCor",function(ConsultationService,ConfigService,$cookieStore,$modal,$filter,$stateParams,$state,toastr){return{restrict:"EA",templateUrl:"modules/consultation/directives/template_cor/add.html",scope:{options:"=",success:"="},link:function(scope,ele,attrs){var user_id=$cookieStore.get("userInfo").id,saveCor=function(){ConfigService.beforeSave(scope.scor.errors),scope.scor.errors=[];var postData=angular.copy(scope.scor.form);console.log("^^^^^^^, ",postData),postData.Date=moment().format("YYYY-MM-DD"),postData.Time=moment().format("hh:mm"),postData.CAL_ID=$stateParams.cal_id,postData.PATIENT_ID=$stateParams.patient_id,postData.Created_by=postData.Last_updated_by=user_id,postData.Creation_date=moment().format("YYYY-MM-DD"),postData.Last_update_date=moment().format("YYYY-MM-DD"),ConsultationService.postAddCor(postData).then(function(response){scope.success=!0,toastr.success("Saved Successfully")},function(error){scope.scor.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.scor.errors)})};scope.scor={save:function(params){saveCor(params)},errors:[],form:{Mode:"",Duration:"",Who:"",Details:"",Therapist:""}}}}}),angular.module("app.loggedIn.corres.edit.controller",[]).controller("CorrespondenceEditController",function($scope,$state,$modalInstance,id){$scope.editcor={success:!1,id:id},$scope.$watch("editcor.success",function(success){success&&$modalInstance.close("success")})}),angular.module("app.loggedIn.corres.edit.directive",[]).directive("editCor",function(ConsultationService,ConfigService,$cookieStore,$modal,$filter,$stateParams,$state,toastr){return{restrict:"EA",templateUrl:"modules/consultation/directives/template_cor/edit.html",scope:{options:"=",success:"=",id:"="},link:function(scope,ele,attrs){var user_id=$cookieStore.get("userInfo").id,saveCor=function(){ConfigService.beforeSave(scope.scor.errors),scope.scor.errors=[];var postData=angular.copy(scope.scor.form);console.log("^^^^^^^, ",postData),postData.Date=moment().format("YYYY-MM-DD"),postData.Time=moment().format("hh:mm"),postData.CAL_ID=$stateParams.cal_id,postData.PATIENT_ID=$stateParams.patient_id,postData.Created_by=postData.Last_updated_by=user_id,postData.Creation_date=moment().format("YYYY-MM-DD"),postData.Last_update_date=moment().format("YYYY-MM-DD"),ConsultationService.postAddCor(postData).then(function(response){scope.success=!0,toastr.success("Updated Successfully"),scope.scor.load()},function(error){scope.scor.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.scor.errors)})},load=function(){console.log("sdfsssssssdfd",scope.scor.form.ID),ConsultationService.postByIdCor(scope.id).then(function(response){console.log(response.data),scope.scor.form=angular.copy(response.data)},function(error){})};scope.scor={load:function(){load()},save:function(params){saveCor(params)},errors:[],form:{ID:"",Date:"",Time:"",Mode:"",Duration:"",Who:"",Details:"",Therapist:""}},scope.scor.load()}}}),angular.module("app.loggedIn.patient.consult",["app.loggedIn.patient.consult.controller","app.loggedIn.patient.consult.consulthistoryController","app.loggedIn.patient.consult.measurementController","app.loggedIn.patient.consult.scriptController","app.loggedIn.patient.consult.itemsheetController","app.loggedIn.patient.consult.services","app.loggedIn.patient.consult.directives","app.loggedIn.corres.list.controller","app.loggedIn.corres.list.directive","app.loggedIn.corres.add.controller","app.loggedIn.corres.add.directive","app.loggedIn.corres.edit.controller","app.loggedIn.corres.edit.directive","app.kiss.timer.directive","app.loggedIn.patient.exercise.directives.list"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.consult",{url:"/consult",views:{"main-content":{templateUrl:"modules/consultation/views/consult.html",controller:"PatientConsultController"}}})}),angular.module("app.loggedIn.department",["app.loggedIn.department.controller","app.loggedIn.department.services","app.loggedIn.department.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.department",{"abstract":!0,templateUrl:"modules/department/views/structure.html",controller:"DepartmentController"}).state("loggedIn.department.list",{url:"/department/list",views:{"main-content":{templateUrl:"modules/department/views/list.html",controller:"DepartmentListController"}}})}),angular.module("app.loggedIn.department.services",[]).factory("DepartmentService",function(Restangular){var instanceService={},appApi=Restangular.all("api/erm");return instanceService.detail=function(department_id){var detailApi=appApi.all("v2/dept/detail");return detailApi.post({CLINICAL_DEPT_ID:department_id})},instanceService.insert=function(data){var detailApi=appApi.all("v2/dept/insert");return detailApi.post(data)},instanceService.update=function(department_id,data){var detailApi=appApi.all("v2/dept/update");return detailApi.post(data)},instanceService["delete"]=function(department_id){var detailApi=appApi.all("v2/dept/delete");return detailApi.post(department_id)},instanceService.saveDeptHeaders=function(dept_id,header_list){for(var list=[],i=header_list.length-1;i>=0;i--)list.push(header_list[i].POPULAR_HEADER_ID);var detailApi=appApi.all("v2/dept/insert_dept_headers");return detailApi.post({dept_id:dept_id,headers:list})},instanceService.saveDeptServices=function(dept_id,service_list){for(var list=[],i=service_list.length-1;i>=0;i--)list.push(service_list[i].SERVICE_ID);var detailApi=appApi.all("v2/dept/insert_dept_services");return detailApi.post({dept_id:dept_id,services:list})},instanceService.disableDeptHeader=function(dept_id,header_id){if(dept_id&&header_id){var detailApi=appApi.all("v2/dept/update_dept_header");return detailApi.post({CLINICAL_DEPT_ID:dept_id,POPULAR_HEADER_ID:header_id,ISENABLE:0})}},instanceService.enableDeptHeader=function(dept_id,header_id){if(dept_id&&header_id){var detailApi=appApi.all("v2/dept/update_dept_header");return detailApi.post({CLINICAL_DEPT_ID:dept_id,POPULAR_HEADER_ID:header_id,ISENABLE:1})}},instanceService.disableDeptService=function(dept_id,service_id){if(dept_id&&service_id){var detailApi=appApi.all("v2/dept/update_dept_service");return detailApi.post({CLINICAL_DEPT_ID:dept_id,SERVICE_ID:service_id,ISENABLE:0})}},instanceService.enableDeptService=function(dept_id,service_id){if(dept_id&&service_id){var detailApi=appApi.all("v2/dept/update_dept_service");return detailApi.post({CLINICAL_DEPT_ID:dept_id,SERVICE_ID:service_id,ISENABLE:1})}},instanceService}),angular.module("app.loggedIn.department.directives",["app.loggedIn.department.detail.directive"]),angular.module("app.loggedIn.department.detail.directive",[]).directive("departmentDetail",function(ClnDepartmentModel,DepartmentService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess"},templateUrl:"modules/department/directives/templates/detail.html",link:function(scope,element,attrs){var loadData=function(id){DepartmentService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ClnDepartmentModel),scope.mode={type:"add",text:"Add Department"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Department"})}var addProcess=function(postData){DepartmentService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a new Department","Success"),scope.modelObjectMap=angular.copy(ClnDepartmentModel),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){var id=postData.id;delete postData.id,DepartmentService.update(id,postData).then(function(response){"success"===response.status&&(toastr.success("Edit Department Successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.department.controller",["app.loggedIn.department.list.controller"]).controller("DepartmentController",function($scope,ConfigService){}),angular.module("app.loggedIn.department.list.controller",[]).controller("DepartmentListController",function($scope,$state,$filter,DepartmentService,toastr){var arrGetBy=$filter("arrGetBy");$scope.departmentInfo={},$scope.header_panel={},$scope.dept_panel={},$scope.service_panel={},$scope.department={select:0,"class":function(item){return{danger:0==item.ISENABLE,selected:item.CLINICAL_DEPT_ID==$scope.department.select}},options:{scope:$scope.dept_panel,api:"api/erm/v2/dept/search",method:"post",columns:[{field:"CLINICAL_DEPT_ID",is_hide:!0},{field:"CLINICAL_DEPT_NAME",label:"Department name"},{field:"ISENABLE",is_hide:!0,label:"Is Enable",type:"checkbox"}],use_actions:!0,actions:[{"class":"fa fa-check",title:"Show",callback:function(item){$scope.department.select=item.CLINICAL_DEPT_ID,$scope.invheader.show(item.CLINICAL_DEPT_ID),$scope.services.show(item.CLINICAL_DEPT_ID)}},{"class":"fa fa-pencil",title:"Edit",callback:function(item){console.log(item),$scope.departmentInfo.id=item.CLINICAL_DEPT_ID,$scope.formEditDept.open()}},{"class":"fa fa-check",title:"Enable"},{"class":"fa fa-times",title:"Disable"}]}},$scope.formAddDept={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){console.log(response),"success"==response.status&&$scope.dept_panel.reload()}},$scope.formEditDept={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){console.log(response),"success"==response.status&&$scope.dept_panel.reload()}},$scope.services={show:function(dept_id){$scope.services.options.search={CLINICAL_DEPT_ID:dept_id},$scope.service_panel.reload(),$scope.searchService.select_list=[]},"class":function(item){return item.just_add?"info":0==item.clnDeptService.ISENABLE?"danger":void 0},options:{scope:$scope.service_panel,api:"api/erm/v2/dept/dept_service",method:"post",columns:[{field:"SERVICE_ID",is_hide:!0},{field:"SERVICE_NAME",label:"Service Name"},{field:"DESCRIPTION",label:"Description"},{field:"SERVICE_COLOR",label:"Color",type:"color"}],use_filters:!0,search:{CLINICAL_DEPT_ID:0},not_load:!0,"static":!0,use_actions:!0,actions:[{"class":"fa fa-check",title:"Enable",callback:function(item){return 1==item.clnDeptService.ISENABLE?void toastr.info("Header is enable !!!","Information"):void DepartmentService.enableDeptService($scope.department.select,item.SERVICE_ID).then(function(response){"success"==response.status&&(toastr.success("Save Successfully!!!","Success"),item.clnDeptService.ISENABLE=1)})}},{"class":"fa fa-times",title:"Disable",callback:function(item){return 0==item.clnDeptService.ISENABLE?void toastr.info("Header is disable !!!","Information"):void DepartmentService.disableDeptService($scope.department.select,item.SERVICE_ID).then(function(response){
"success"==response.status&&(toastr.success("Save Successfully!!!","Success"),item.clnDeptService.ISENABLE=0)})}}]}},$scope.invheader={show:function(dept_id){$scope.invheader.options.search={CLINICAL_DEPT_ID:dept_id},$scope.header_panel.reload(),$scope.searchHeader.select_list=[]},"class":function(item){return item.just_add?"info":0==item.clnDeptItemList.ISENABLE?"danger":void 0},options:{scope:$scope.header_panel,api:"api/erm/v2/dept/dept_header",method:"post",columns:[{field:"POPULAR_HEADER_ID",is_hide:!0},{field:"POPULAR_CODE",label:"Popular Code",width:"20%"},{field:"POPULAR_NAME",label:"Popular Name"}],use_filters:!0,search:{CLINICAL_DEPT_ID:0},not_load:!0,"static":!0,use_actions:!0,actions:[{"class":"fa fa-check",title:"Enable",callback:function(item){return 1==item.clnDeptItemList.ISENABLE?void toastr.info("Header is enable !!!","Information"):void DepartmentService.enableDeptHeader($scope.department.select,item.POPULAR_HEADER_ID).then(function(response){"success"==response.status&&(toastr.success("Save Successfully!!!","Success"),item.clnDeptItemList.ISENABLE=1)})}},{"class":"fa fa-times",title:"Disable",callback:function(item){return 0==item.clnDeptItemList.ISENABLE?void toastr.info("Header is disable !!!","Information"):void DepartmentService.disableDeptHeader($scope.department.select,item.POPULAR_HEADER_ID).then(function(response){"success"==response.status&&(toastr.success("Save Successfully!!!","Success"),item.clnDeptItemList.ISENABLE=0)})}}]}},$scope.searchHeader={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},select_list:[],"class":function(item){var t_item=arrGetBy($scope.header_panel.data.items,"POPULAR_HEADER_ID",item.POPULAR_HEADER_ID);if(t_item)return"success";var t_item=arrGetBy($scope.searchHeader.select_list,"POPULAR_HEADER_ID",item.POPULAR_HEADER_ID);return t_item?"info":void 0},click:function(item){var t_item=arrGetBy($scope.header_panel.data.items,"POPULAR_HEADER_ID",item.POPULAR_HEADER_ID);if(!t_item){var t_item=arrGetBy($scope.searchHeader.select_list,"POPULAR_HEADER_ID",item.POPULAR_HEADER_ID);t_item||(item.just_add=!0,$scope.searchHeader.select_list.push(item),$scope.header_panel.data.more_items.push(item))}},save:function(){DepartmentService.saveDeptHeaders($scope.department.select,$scope.searchHeader.select_list).then(function(response){"success"===response.status&&(toastr.success("Save Successfully!!!","Success"),$scope.header_panel.reload())})},options:{api:"api/erm/v2/items/header_search",method:"post",columns:[{field:"POPULAR_HEADER_ID",is_hide:!0},{field:"POPULAR_CODE",label:"Code"},{field:"POPULAR_NAME",label:"Name"},{field:"ISENABLE",label:"Is enable"}]}},$scope.searchService={is_show:!1,select_list:[],"class":function(item){},click:function(item){var t_item=arrGetBy($scope.service_panel.data.items,"SERVICE_ID",item.SERVICE_ID);if(!t_item){var t_item=arrGetBy($scope.searchService.select_list,"SERVICE_ID",item.SERVICE_ID);t_item||(item.just_add=!0,$scope.searchService.select_list.push(item),$scope.service_panel.data.more_items.push(item))}},open:function(){this.is_show=!0},close:function(){this.is_show=!1},save:function(){DepartmentService.saveDeptServices($scope.department.select,$scope.searchService.select_list).then(function(response){"success"===response.status&&(toastr.success("Save Successfully!!!","Success"),$scope.service_panel.reload())})}}}),angular.module("app.loggedIn.doctor",["app.loggedIn.doctor.controller","app.loggedIn.doctor.services","app.loggedIn.doctor.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.doctor",{"abstract":!0,templateUrl:"modules/doctor/views/structure.html",controller:"DoctorController"}).state("loggedIn.doctor.paperless",{url:"/doctor/paperless/:patient_id/:cal_id",views:{"main-content":{templateUrl:"modules/doctor/views/paperless.html",controller:"DoctorPaperlessController"}}}).state("loggedIn.doctor.home",{url:"/doctor/home",views:{"main-content":{templateUrl:"modules/doctor/views/home.html",controller:"DoctorHomeController"}}}).state("loggedIn.doctor.add",{url:"/doctor/add",views:{"main-content":{templateUrl:"modules/doctor/views/add.html",controller:"DoctorAddController"}}}).state("loggedIn.doctor.list",{url:"/doctor/list",views:{"main-content":{templateUrl:"modules/doctor/views/doclist.html",controller:"DoctorListController"}}}).state("loggedIn.doctor.timetable",{url:"/doctor/timetable",views:{"main-content":{templateUrl:"modules/doctor/views/timetable.html",controller:"DoctorTimetableController"}}}).state("loggedIn.doctor.timetable.detail",{"abstract":!0,url:"/:doctorId",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/structure-timetable.html",controller:"DoctorTimetableDetailController"}}}).state("loggedIn.doctor.timetable.detail.calendar",{url:"/calendar",views:{"main-content-timetable":{templateUrl:"modules/doctor/views/timetable-calendar.html",controller:"DoctorTimetableDetailCalendarController"}}}).state("loggedIn.doctor.timetable.detail.profile",{url:"/profile",views:{"main-content-timetable":{templateUrl:"modules/doctor/views/timetable-profile.html",controller:"DoctorTimetableDetailProfileController"}}}).state("loggedIn.doctor.timetable.detail.casual",{url:"/casual",views:{"main-content-timetable":{templateUrl:"modules/doctor/views/timetable-casual.html",controller:"DoctorTimetableDetailCasualController"}}}).state("loggedIn.doctor.timetable.detail.leave",{url:"/leave",views:{"main-content-timetable":{templateUrl:"modules/doctor/views/timetable-leave.html",controller:"DoctorTimetableDetailLeaveController"}}}).state("loggedIn.doctor.items",{url:"/doctor/items",views:{"main-content":{templateUrl:"modules/doctor/views/items.html",controller:"DoctorItemsController"}}}).state("loggedIn.doctor.items.cat",{url:"/cat",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/items-cat.html",controller:"DoctorItemsCatController"}}}).state("loggedIn.doctor.items.add",{url:"/add",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/items-form.html",controller:"DoctorItemsAddController"}}}).state("loggedIn.doctor.items.edit",{url:"/edit",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/items-form.html",controller:"DoctorItemsEditController"}}}).state("loggedIn.doctor.patients",{url:"/doctor/patients",views:{"main-content":{templateUrl:"modules/doctor/views/patients.html",controller:"DoctorPatientsController"}}}).state("loggedIn.doctor.patients.detail",{url:"/detail",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/patients-detail.html",controller:"DoctorPatientsDetailController"}}}).state("loggedIn.doctor.patients.detail.appt",{url:"/appt",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/patients-detail-appt.html",controller:"DoctorPatientsDetailApptController"}}}).state("loggedIn.doctor.patients.detail.appt.more",{url:"/more",views:{"main-content@loggedIn.doctor":{templateUrl:"modules/doctor/views/patients-detail-appt-more.html",controller:"DoctorPatientsDetailApptMoreController"}}})}),angular.module("app.loggedIn.doctor.services",[]).factory("DoctorService",function(Restangular){var doctorService={},doctorApi=Restangular.all("api/erm"),mdtApi=Restangular.all("api/meditek/v1/doctor/");Restangular.all("api/restful"),doctorService.mdtSearch=function(options){var funcApi=mdtApi.all("search");return funcApi.post(options)},doctorService.doctor_calendar_by_date=function(doctor_id,from,to){var instanceApi=doctorApi.all("v2/doctor/calendar_by_date");return instanceApi.post({doctor_id:doctor_id,fromDate:from,toDate:to})},doctorService.getApptWorkInProgress=function(doctor_id,from,to){var instanceApi=doctorApi.all("v2/doctor/appt_work_in_progress");return instanceApi.post({doctor_id:doctor_id,fromDate:from,toDate:to})},doctorService.catItemDept=function(items){for(var newlist=[],i=0,len=items.length;len>i;++i){var item=items[i];if(0==newlist.length||newlist[newlist.length-1].cat!=item.POPULAR_HEADER_ID){var t2={cat:item.POPULAR_HEADER_ID,cattitle:item.POPULAR_NAME,list:[]};newlist.push(t2)}var t={ITEM_ID:item.ITEM_ID,ITEM_CODE:item.ITEM_CODE,ITEM_NAME:item.ITEM_NAME,PRICE:item.PRICE?item.PRICE:0,QUANTITY:item.QUANTITY?item.QUANTITY:1,TIME_SPENT:item.TIME_SPENT?item.TIME_SPENT:0,inserted:item.inserted?!0:!1,appt_item_id:item.appt_item_id,checked:item.checked?"1":"0"};newlist[newlist.length-1].list.push(t)}return newlist},doctorService.insertItemAppt=function(appt_id,patient_id,items){appt_id||console.log("MISSING INFO APPT_ID");var instanceApi=doctorApi.all("v1/appointment/insert_items");return instanceApi.post({cal_id:appt_id,patient_id:patient_id,items:items})},doctorService.updateItemAppt=function(appt_id,items){var instanceApi=doctorApi.all("v1/appointment/update_items");return instanceApi.post({cal_id:appt_id,items:items})},doctorService.deleteItemAppt=function(appt_id,patient_id,items){var instanceApi=doctorApi.all("v1/appointment/delete_items");return instanceApi.post({cal_id:appt_id,patient_id:patient_id,items:items})},doctorService.getItemAppt=function(appt_id,patient_id){var instanceApi=doctorApi.all("v1/appointment/get_items");return instanceApi.post({appt_id:appt_id,patient_id:patient_id})},doctorService.getItemByDept=function(dept_id,isenable){var instanceApi=doctorApi.one("v1/items/list_by_dept"),enable=void 0!==isenable?parseInt(isenable):1;return instanceApi.get({dept_id:dept_id,isenable:enable})},doctorService.getItemHeader=function(dept_id){var instanceApi=doctorApi.one("v1/items/get_header_by_dept");return instanceApi.get({dept_id:dept_id})},doctorService.insertItemHeader=function(dept_id,data){var instanceApi=doctorApi.all("v1/items/insert_header");return instanceApi.post({dept_id:dept_id,data:data})},doctorService.deleteItemHeader=function(dept_id,header_id){var instanceApi=doctorApi.all("v1/items/delete_header");return instanceApi.post({dept_id:dept_id,header_id:header_id})},doctorService.updateItemHeader=function(data){var instanceApi=doctorApi.all("v1/items/update_header");return instanceApi.post({data:data})},doctorService.insertItem=function(header_id,data){var instanceApi=doctorApi.all("v1/items/insert");return instanceApi.post({h_item:header_id,data:data})},doctorService.getItemByCode=function(item_id){var instanceApi=doctorApi.all("v1/items/get_item_by_id"),postData={item_id:item_id};return instanceApi.post(postData)},doctorService.editItem=function(editItem,old_header_id,new_header_id){var instanceApi=doctorApi.all("v1/items/edit_item"),postData={editItem:editItem,old_header_id:old_header_id,new_header_id:new_header_id};return instanceApi.post(postData)},doctorService.getApptById=function(appt_id){var instanceApi=doctorApi.one("v1/appointment/get_by_id");return instanceApi.get({cal_id:appt_id})},doctorService.updateAppt=function(appt_id,data){var instanceApi=doctorApi.all("v1/appointment/update"),postData={cal_id:appt_id,data:data};return console.log(postData),instanceApi.post(postData)},doctorService.listCurPatients=function(doctor_id){var instanceApi=doctorApi.one("v1/doctors/list_patients");return instanceApi.get({doctor_id:doctor_id,current:1})},doctorService.searchItem=function(option){var opt={limit:option.limit,offset:option.offset,k:option.data.name,code:option.data.code,type:option.data.type},instanceApi=doctorApi.one("v1/items/search");return instanceApi.get(opt)},doctorService.getMaxId=function(){var maxApi=doctorApi.one("doctors/getMaxId");return maxApi.get()},doctorService.update=function(options){var updateApi=doctorApi.all("doctors/update");return updateApi.post(options)},doctorService.insert=function(options){var insertApi=doctorApi.all("doctors/insert");return insertApi.post(options)},doctorService.getByUserId=function(user_id){var instanceApi=doctorApi.all("v1/doctors/by_user_id");return instanceApi.post({user_id:user_id})},doctorService.listPatients=function(option){var listApi=doctorApi.all("v1/patients/search");return listApi.post(option)},doctorService.all=function(){var allApi=doctorApi.one("doctors/list");return allApi.get()},doctorService.listByClinical=function(options){var listApi=doctorApi.all("doctors/listByClinical");return listApi.post(options)},doctorService.getById=function(id){var getApi=doctorApi.all("doctors/getById");return getApi.post({id:id})},doctorService.search=function(options){var searchApi=doctorApi.all("doctors/search");return searchApi.post({search:options})},doctorService.timetable=function(doctor_id){var timeApi=doctorApi.all("doctors/timetable");return timeApi.post({doctor_id:doctor_id})},doctorService.timetableWeekById=function(options){var timeApi=doctorApi.all("doctors/timetableWeekById");return timeApi.post(options)},doctorService.changeTimetable=function(options){var timeApi=doctorApi.all("doctors/changeTimetable");return timeApi.post(options)},doctorService.insertTimetable=function(options){var timeApi=doctorApi.all("doctors/insertTimetable");return timeApi.post(options)},doctorService.removeTimetable=function(options){var timeApi=doctorApi.all("doctors/removeTimetable");return timeApi.post(options)},doctorService.changeTimetableWeek=function(options){var timeApi=doctorApi.all("doctors/changeTimetableWeek");return timeApi.post(options)},doctorService.insertTimetableWeek=function(options){var timeApi=doctorApi.all("doctors/insertTimetableWeek");return timeApi.post(options)},doctorService.removeTimetableWeek=function(options){var timeApi=doctorApi.all("doctors/removeTimetableWeek");return timeApi.post(options)},doctorService.generateTimetable=function(data){var generateApi=doctorApi.all("doctors/generateTimetable");return generateApi.post({data:data})},doctorService.getCasualCalendar=function(data){var casualApi=doctorApi.all("doctors/getCasualCalendar");return casualApi.post(data)},doctorService.changeCasual=function(options){var casualApi=doctorApi.all("doctors/changeCasual");return casualApi.post(options)},doctorService.overviewCalendar=function(doctor_id,from_time,to_time){var api=doctorApi.all("v2/timetable/overview_doctor");return api.post({doctor_id:doctor_id,from_time:from_time,to_time:to_time})},doctorService.deleteDateCalendar=function(doctor_id,date){var api=doctorApi.all("v2/timetable/delete_date");return api.post({doctor_id:doctor_id,date:date})},doctorService.addCalendar=function(postData){var result=doctorApi.all("appointment/insert-casual-calendar");return result.post({postData:postData})},doctorService.editCalendar=function(postData){var result=doctorApi.all("appointment/edit-casual-calendar");return result.post({postData:postData})},doctorService.leaveCalendar=function(doctor_id,from_time,to_time){var api=doctorApi.all("v2/timetable/doctor_leave");return api.post({doctor_id:doctor_id,from_time:from_time,to_time:to_time})};var leaveApi=Restangular.all("api/meditek/v1/appointment");return doctorService.leaveCal=function(data){var instanceApi=leaveApi.all("leaveCal");return instanceApi.post({data:data})},doctorService.beforeLeaveCal=function(data){var instanceApi=leaveApi.all("beforePostLeaveCal");return instanceApi.post({data:data})},doctorService}),angular.module("app.loggedIn.doctor.controller",["app.loggedIn.doctor.home.controller","app.loggedIn.doctor.list.controller","app.loggedIn.doctor.timetable.controller","app.loggedIn.doctor.patients.controller","app.loggedIn.doctor.items.controller","app.loggedIn.doctor.add.controller","app.loggedIn.doctor.paperless.controller","app.loggedIn.doctor.fachoose.controller"]).controller("DoctorController",function($scope,$filter,$cookieStore,MODE_ROW,ConfigService,DoctorService){$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,data:{NAME:"",Email:"",Phone:null}},$scope.rows=MODE_ROW,$scope.searchPatientsObject={doctor_id:0,limit:10,offset:0,maxSize:5,currentPage:1,data:{First_name:"",Sur_name:"",Middle_name:"",Post_code:null}},$scope.modelDoctorObject={NAME:"",Email:"",Phone:"",Signature:"",Title:"",First_name:"",Middle_name:"",Sur_name:"",CLINICAL_DEPT_ID:null,Provider_no:0,Provider_type:"",Appt_interval:0,isReceiveEmailAfterHour:"0",Qualification_id:"",Prescriber_no:0,Sign_off:"",Payee_provider_no:0,ABN_no:0,Default_bank_account_id:"",Medical_Registration_no:0,OSHC_ID:"",isAppointmentBook:"0",Isenable:"0",isNewCalendarSlot:"0",Address:""},$scope.setClassAppt=function(type){return null===type||"ChangePers"===type?"danger":"Done"===type?"success":"NotYet"===type?"warning":"Billing"===type?"info":void 0},$scope.apptStatus=ptnConst.apptStatus,$scope.setColorAppt=function(status){return status==ptnConst.apptStatus.booking.value?"un_tn_row_blue un_tn_row_hover_blue":status==ptnConst.apptStatus.checkedIn.value?"un_tn_row_violet un_tn_row_hover_violet":status==ptnConst.apptStatus.waiting.value?"un_tn_row_red un_tn_row_hover_red":status==ptnConst.apptStatus.inConsult.value?"un_tn_row_yellow un_tn_row_hover_yellow":status==ptnConst.apptStatus.completed.value?"un_tn_row_green un_tn_row_hover_green":status==ptnConst.apptStatus.urgent.value?"un_tn_row_red un_tn_row_hover_red":"un_tn_row_blank un_tn_row_hover_blank"},$scope.views={patient_info:"modules/doctor/views/patient-info.html",paperless:"modules/doctor/views/paperless.html",patient_path:"modules/patient/views/patient/"},$scope.modeFormItem={reset:function(){$scope.isSubmit=!1,$scope.modelObjectMap={ITEM_TYPE:"Services",Prefix:""},$scope.invalid={}},validate:function(){var date_pattern=/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/,isValidDateFormat=function(date){return date&&!date_pattern.test(date)};return $scope.invalid.ITEM_START_DATE=isValidDateFormat($scope.modelObjectMap.ITEM_START_DATE),$scope.invalid.ITEM_END_DATE=isValidDateFormat($scope.modelObjectMap.ITEM_END_DATE),$scope.invalid.ITEM_END_DATE||$scope.invalid.ITEM_START_DATE?!1:!0},init:function(){$scope.modeFormItem.reset(),$scope.doctorInfo=$cookieStore.get("doctorInfo");var dept_id=$scope.doctorInfo.CLINICAL_DEPT_ID,initOption=function(){$scope.options={},ConfigService.taxes_option().then(function(data){$scope.options.taxes=data}),ConfigService.prefix_headers_option("item").then(function(data){$scope.options.prefix_headers=data}),ConfigService.provider_types_option().then(function(data){$scope.options.provider_types=data}),ConfigService.inv_uoms_option().then(function(data){$scope.options.uoms=data}),DoctorService.getItemHeader(dept_id).then(function(data){$scope.options.item_headers=data})};initOption()},submit:function(callback){var t_start=$scope.modelObjectMap.ITEM_START_DATE,t_end=$scope.modelObjectMap.ITEM_END_DATE;$scope.modelObjectMap.ITEM_START_DATE=ConfigService.getCommonDateDatabase(t_start),$scope.modelObjectMap.ITEM_END_DATE=ConfigService.getCommonDateDatabase(t_end),$scope.modelObjectMap.ITEM_START_DATE||delete $scope.modelObjectMap.ITEM_START_DATE,$scope.modelObjectMap.ITEM_END_DATE||delete $scope.modelObjectMap.ITEM_END_DATE;var arrFilter=$filter("arrGetBy"),obj=arrFilter($scope.options.prefix_headers,"PREFIX_NAME",$scope.modelObjectMap.ITEM_TYPE);$scope.modelObjectMap.Prefix=obj.PREFIX,callback()}}}),angular.module("app.loggedIn.doctor.home.controller",[]).controller("DoctorHomeController",function($scope,socket,$state,$cookieStore,DoctorService,ConfigService,localStorageService,toastr,moment,$modal){function getDoctorInfo(){$scope.doctorInfo=$cookieStore.get("doctorInfo"),console.log("Doctor Info: ",$scope.doctorInfo),$scope.doctorInfo&&$scope.doctorInfo.doctor_id||alert("Not Doctor Information !!!"),init()}moment(),$scope.selectDate=moment().range(moment().subtract(1,"days"),moment()),$scope.loadCalendar=function(){var fromDate=moment($scope.selectDate.start.format("YYYY-MM-DD")),toDate=moment($scope.selectDate.end.format("YYYY-MM-DD")),doctor_id=$scope.doctorInfo.doctor_id;DoctorService.doctor_calendar_by_date(doctor_id,fromDate._i,toDate._i).then(function(data){"success"==data.status?($scope.list_appts=data.data,exlog.log($scope.list_appts),angular.forEach($scope.list_appts,function(value,key){var patientArr=[];patientArr.push(value.Title,value.First_name,value.Sur_name,value.Middle_name),value.PATIENT_NAME=patientArr.join(" ")})):(alert("error when load data."),exlog.logErr(data))},function(err){alert("error when load data."),exlog.logErr(data)})},$scope.goToApptDetail=function(item){return console.log("this is item",item),item.CAL_ID&&item.Patient_id?void $state.go("loggedIn.patient.consult",{patient_id:item.Patient_id,cal_id:item.CAL_ID}):void toastr.error("Unexpected error!","Error!")};var init=function(){$scope.loadCalendar()};$scope.checkIsDoctor=function(){$scope.userInfo=$cookieStore.get("userInfo"),$cookieStore.get("doctorInfo")&&$cookieStore.get("doctorInfo").doctor_id?getDoctorInfo():DoctorService.getByUserId($scope.userInfo.id).then(function(data){data&&($cookieStore.put("doctorInfo",{doctor_id:data.doctor_id,NAME:data.NAME,Provider_no:data.Provider_no,CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}),getDoctorInfo())})},$scope.checkIsDoctor(),socket.on("receiveNotifyDoctor",function(){$scope.checkIsDoctor()})}),angular.module("app.loggedIn.doctor.list.controller",[]).controller("DoctorListController",function($scope){$scope.doctor_panel={},$scope.doctor={},$scope.doctors={select:0,"class":function(doctor){return{selected:doctor.doco==$scope.doctors.select}},scope:$scope.doctor_panel,options:{api:"api/erm/v2/doctor/search",method:"post",scope:$scope.doctor_panel,columns:[{field:"doctor_id",is_hide:!0},{field:"NAME",label:"Full name"},{field:"Email",label:"Email"},{field:"Phone",label:"Phone"},{field:"Specialties",label:"Specialties",not_submit:!0,type:"custom",fn:function(item){if(!item.specialties||0==item.specialties.length)return"";var specialties=[];return angular.forEach(item.specialties,function(value,key){specialties.push(value.Specialties_name)}),specialties.join(", ")}}],use_filters:!0,filters:{NAME:{type:"text"},Email:{type:"text"},Phone:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(doctor){$scope.doctorEditForm.open(doctor.doctor_id)}}]}},$scope.doctorAddForm={is_show:!1,open:function(){$scope.params_doctor={permission:{create:!0,edit:!1}},this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.doctor_panel.reload()}},$scope.doctorEditForm={is_show:!1,open:function(doc_id){$scope.params_doctor={permission:{create:!1,edit:!0},id:doc_id},this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.doctor_panel.reload()}}}),angular.module("app.loggedIn.doctor.add.controller",[]).controller("DoctorAddController",function($scope,$state,$cookieStore,$stateParams,toastr,ConfigService,DoctorService){$scope.newId=0;var loadOption=function(){ConfigService.clinical_option().then(function(list){$scope.options.clinicals=list}),ConfigService.provider_type_option().then(function(list){$scope.options.providers=list.list}),ConfigService.qualification_option().then(function(list){$scope.options.qualifications=list.list}),ConfigService.account_type_option().then(function(list){$scope.options.account_types=list.list})};loadOption(),$scope.modelObjectMap={};var init=function(){$scope.modelObjectMap=angular.copy($scope.modelDoctorObject),$scope.modelObjectMap.Created_by=$cookieStore.get("userInfo").id,DoctorService.getMaxId().then(function(data){$scope.newId=data.data.doctor_id+1,$scope.modelObjectMap.doctor_id=$scope.newId})};init(),$scope.isSubmit=!1,$scope.step=1,$scope.label_step="Next",$scope.prevStep=function(){$scope.step>1&&($scope.label_step="Next",$scope.step--)},$scope.nextStep=function(){switch($scope.isSubmit=!0,$scope.step){case 1:$scope.mainForm.$invalid||($scope.isSubmit=!1,$scope.step=2,$scope.label_step="Insert");break;case 2:$scope.mainForm.$invalid||($scope.isSubmit=!1,DoctorService.insert($scope.modelObjectMap).then(function(response){"success"===response.status&&(toastr.success("Insert Successfully","Success"),$scope.step=1,$scope.label_step="Next",init(),$state.go("loggedIn.doctor.timetable.detail.profile",{doctorId:$scope.newId}))}))}}}),angular.module("app.loggedIn.doctor.timetable.controller",["app.loggedIn.doctor.timetable.detail.controller"]).controller("DoctorTimetableController",function($scope,$state){$scope.$watch("itemUpdate",function(newItem){"undefined"!=typeof newItem&&newItem===!0&&(angular.element("#TimetableDoctorAdd").fadeOut(),$state.go("loggedIn.doctor.timetable",null,{reload:!0}),$scope.itemUpdate=!1)}),$scope.params_doctor_add={permission:{create:!0,popup:!0},popupId:"TimetableDoctorAdd"},$scope.relationships={specialties:{count:0}},$scope.openPopup=function(option){if("doctor"===option.module)switch(option.type){case"add":angular.element("#"+$scope.params_doctor_add.popupId).fadeIn()}},$scope.accordion={oneAtATime:!1,specialties:!0},$scope.selectedDoctor={},$scope.selectDoctor=function(row){$scope.selectedDoctor=row,$state.go("loggedIn.doctor.timetable.detail.calendar",{doctorId:$scope.selectedDoctor.doctor_id})}}),angular.module("app.loggedIn.doctor.timetable.detail.controller",["app.loggedIn.doctor.timetable.detail.calendar.controller","app.loggedIn.doctor.timetable.detail.profile.controller","app.loggedIn.doctor.timetable.detail.casual.controller","app.loggedIn.doctor.timetable.detail.leave.controller"]).controller("DoctorTimetableDetailController",function($scope,$state,$stateParams,DoctorService,ConfigService){$scope.modelDetail={};var loadDetail=function(){DoctorService.getById($stateParams.doctorId).then(function(detail){$scope.modelDetail=detail})};loadDetail(),$scope.getActive=function(state){return state===$state.current.name?"active":""}}),angular.module("app.loggedIn.doctor.timetable.detail.calendar.controller",[]).controller("DoctorTimetableDetailCalendarController",function($scope){}),angular.module("app.loggedIn.doctor.timetable.detail.profile.controller",[]).controller("DoctorTimetableDetailProfileController",function($scope,$stateParams,toastr,ConfigService,DoctorService,PatientService){$scope.params={permission:{create:!1,edit:!0},id:$stateParams.doctorId};var loadOption=function(){ConfigService.clinical_option().then(function(list){$scope.options.clinicals=list}),ConfigService.provider_type_option().then(function(list){$scope.options.providers=list.list}),ConfigService.qualification_option().then(function(list){$scope.options.qualifications=list.list}),ConfigService.account_type_option().then(function(list){$scope.options.account_types=list.list})};loadOption(),$scope.getImage=function(image){PatientService.getSkinApp(image).then(function(response){})},$scope.modelObjectMap={};var sign_map="",init=function(){$scope.modelObjectMap=angular.copy($scope.modelDoctorObject),DoctorService.getById($stateParams.doctorId).then(function(detail){angular.extend($scope.modelObjectMap,detail),sign_map=$scope.modelObjectMap.Signature,$scope.modelObjectMap.isReceiveEmailAfterHour&&($scope.modelObjectMap.isReceiveEmailAfterHour=$scope.modelObjectMap.isReceiveEmailAfterHour.toString()),$scope.modelObjectMap.isAppointmentBook&&($scope.modelObjectMap.isAppointmentBook=$scope.modelObjectMap.isAppointmentBook.toString()),$scope.modelObjectMap.isNewCalendarSlot&&($scope.modelObjectMap.isNewCalendarSlot=$scope.modelObjectMap.isNewCalendarSlot.toString()),$scope.modelObjectMap.Isenable&&($scope.modelObjectMap.Isenable=$scope.modelObjectMap.Isenable.toString())})};init(),$scope.isSubmit=!1,$scope.step=1,$scope.label_step="Next",$scope.prevStep=function(){$scope.step>1&&($scope.label_step="Next",$scope.step--)},$scope.nextStep=function(){switch($scope.isSubmit=!0,$scope.step){case 1:$scope.mainForm.$invalid||($scope.isSubmit=!1,$scope.step=2,$scope.label_step="Update");break;case 2:$scope.mainForm.$invalid||($scope.isSubmit=!1,DoctorService.update($scope.modelObjectMap).then(function(response){"success"===response.status&&(toastr.success("Updated Successfully","Success"),$scope.step=1,$scope.label_step="Next",init())}))}},$scope.resetSignature=function(){$scope.modelObjectMap.Signature=sign_map},$scope.clearSignature=function(){$scope.modelObjectMap.Signature=""}}),angular.module("app.loggedIn.doctor.timetable.detail.leave.controller",[]).controller("DoctorTimetableDetailLeaveController",function($scope,$state,$stateParams,DoctorService,ConfigService,mdtDoctorService,mdtTimetableService,sysServiceService,REAL_DAY_OF_WEEK,toastr,$modal){$scope.list_day_of_week=[{value:"Monday"},{value:"Tuesday"},{value:"Wednesday"},{value:"Thursday"},{value:"Friday"},{value:"Saturday"}];var submitLeave=function(){ConfigService.beforeSave($scope.leave.errors);var postData=angular.copy($scope.leave.form);postData.from_date=ConfigService.convertToDB(postData.from_date),postData.to_date=ConfigService.convertToDB(postData.to_date),postData.doctor_id=$stateParams.doctorId;var modalInstance=$modal.open({templateUrl:"notifyToLeaveCalendar",controller:function($scope,postData,$modalInstance){$scope.fromDateDisplay=moment(postData.from_date,"YYYY-MM-DD").format("DD/MM/YYYY"),$scope.toDateDisplay=moment(postData.to_date,"YYYY-MM-DD").format("DD/MM/YYYY"),DoctorService.beforeLeaveCal(postData).then(function(data){"success"==data.status?$scope.bookedList=data.data:toastr.error("Fail.")},function(err){toastr.error("Fail.")}),$scope.ok=function(){$modalInstance.close(postData)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},resolve:{postData:function(){return postData}}});modalInstance.result.then(function(postData){postData&&DoctorService.leaveCal(postData).then(function(response){"success"==response.status?toastr.success("Success."):toastr.error("Fail.")},function(error){toastr.error("Fail."),$scope.leave.errors=error.data.errors,ConfigService.beforeError($scope.leave.errors)})})};$scope.leave={form:{from_date:null,to_date:null,doctor_id:""},errors:[],submitLeave:function(){submitLeave()}}}),angular.module("app.loggedIn.doctor.paperless.controller",[]).controller("DoctorPaperlessController",function($scope,$state,$modal,DocumentService,PatientService,$stateParams,localStorageService){var patient_id=$scope.patient_id=$stateParams.patient_id,cal_id=$scope.cal_id=$stateParams.cal_id;PatientService.get(patient_id).then(function(response){response.data&&localStorageService.set("tempPatient",response.data)}),$scope.navigator.add_general=function(){var params={patient_id:patient_id,cal_id:cal_id},str_state="loggedIn."+$scope.tab;$state.go(str_state,params)},$scope.faNewClick=function(){$modal.open({animation:!0,templateUrl:"modules/doctor/views/fachooseModal.html",controller:"FaChooseController"})},$scope.OptionGorgonMA=DocumentService.optionGorgonMA(patient_id),$scope.OptionGorgonFA=DocumentService.optionGorgonFA(patient_id),$scope.OptionGorgonUQ=DocumentService.optionGorgonUQ(patient_id),$scope.OptionGorgonMH=DocumentService.optionGorgonMH(patient_id),$scope.OptionMRS=DocumentService.optionMRS(patient_id),$scope.OptionFA=DocumentService.OptionFA(patient_id),$scope.OptionMA=DocumentService.OptionMA(patient_id),$scope.OptionCategory2=DocumentService.optionCategory2(patient_id),$scope.OptionCategory3=DocumentService.optionCategory3(patient_id),$scope.OptionIDS=DocumentService.OptionIDS(patient_id),$scope.Optionform18=DocumentService.Optionform18(patient_id),$scope.OptionSA1=DocumentService.OptionSA1(patient_id),$scope.OptionSA2=DocumentService.OptionSA2(patient_id),$scope.OptionMH=DocumentService.OptionMH(patient_id),$scope.OptionCOE=DocumentService.OptionCOE(patient_id)}),angular.module("app.loggedIn.doctor.timetable.detail.casual.controller",[]).controller("DoctorTimetableDetailCasualController",function($scope,$stateParams,DoctorService,ConfigService,mdtDoctorService,mdtTimetableService,sysServiceService,REAL_DAY_OF_WEEK,toastr,TimetableModel,$modal){var doctor_id=$stateParams.doctorId;$scope.objectMap={},$scope.objectMap.from_time=moment(new Date).toDate(),$scope.objectMap.to_time=moment(new Date).add(30,"days").toDate(),$scope.timetable={add:function(item){if(!item.list[0]||null!==item.list[0].CAL_ID){var object={CAL_ID:null,SITE_ID:1,DOCTOR_ID:doctor_id,FROM_TIME:"00:00",TO_TIME:"00:00",SERVICE_ID:1
};item.list.push(object)}},addRowData:function(item,cal){var from_time_part=moment(cal.FROM_TIME,"HHmm").format("HH:mm"),to_time_part=moment(cal.TO_TIME,"HHmm").format("HH:mm"),from_time=moment(item.DATE).format("YYYY-MM-DD")+" "+from_time_part+":00",to_time=moment(item.DATE).format("YYYY-MM-DD")+" "+to_time_part+":00",options={FROM_TIME:from_time,TO_TIME:to_time,SITE_ID:cal.SITE_ID,DOCTOR_ID:$stateParams.doctorId,CLINICAL_DEPT_ID:$scope.doctor.CLINICAL_DEPT_ID,SERVICE_ID:cal.SERVICE_ID};DoctorService.addCalendar(options).then(function(response){toastr.success("Add successfully !!!"),cal.CAL_ID=response.data},function(err){})},updateRow:function(item,cal){var from_time_part=moment(cal.FROM_TIME,"HHmm").format("HH:mm"),to_time_part=moment(cal.TO_TIME,"HHmm").format("HH:mm"),from_time=moment(item.DATE).format("YYYY-MM-DD")+" "+from_time_part+":00",to_time=moment(item.DATE).format("YYYY-MM-DD")+" "+to_time_part+":00",options={FROM_TIME:from_time,TO_TIME:to_time,SITE_ID:cal.SITE_ID,SERVICE_ID:cal.SERVICE_ID,CAL_ID:cal.CAL_ID};DoctorService.editCalendar(options).then(function(response){console.log(response),"success"==response.status?toastr.success("Edit successfully !!!"):toastr.error("Edit fail !!!")})},remove:function(options){if(null===options.cal.CAL_ID)$scope.data[options.parentIndex].list.splice(options.index,1);else{TimetableModel.beforeDeleteSelectedCalendar(options.cal.CAL_ID).then(function(data){if("success"==data.status){var bookedList=data.data,modalInstance=$modal.open({templateUrl:"notifyToDeleteSelectedCalendar",controller:function($scope,bookedList,$modalInstance){$scope.bookedList=bookedList,$scope.ok=function(){$modalInstance.close(bookedList)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},resolve:{bookedList:function(){return bookedList}}});modalInstance.result.then(function(bookedList){bookedList&&executeDelete()})}else toastr.error("Delete fail.")},function(err){toastr.error("Delete fail.")});var executeDelete=function(){TimetableModel.deleteSelectedCalendar(options.cal.CAL_ID).then(function(data){"success"==data.status?(toastr.success("Delete success."),$scope.data[options.parentIndex].list.splice(options.index,1)):toastr.error("Delete fail.")},function(err){toastr.error("Delete fail.")})}}},removeAllDay:function(item){var postData={doctorId:doctor_id,date:item.DATE},modalInstance=$modal.open({templateUrl:"notifyToDeleteAllCalendarInDate",controller:function($scope,item,$modalInstance){TimetableModel.beforeDeleteAllCalendarInDate(postData).then(function(data){"success"==data.status?$scope.bookedList=data.data:toastr.error("Delete fail.")},function(err){toastr.error("Delete fail.")}),$scope.ok=function(){$modalInstance.close(item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},resolve:{item:function(){return item}}});modalInstance.result.then(function(item){item&&TimetableModel.deleteAllCalendarInDate(postData).then(function(data){"success"==data.status?(item.list=[],toastr.success("Delete success.")):toastr.error("Delete fail.")},function(err){toastr.error("Delete fail.")})})},getAllCalendarInDate:function(item){var postData={doctorId:doctor_id,date:item.DATE},updateData={DOCTOR_ID:doctor_id},modalInstance=$modal.open({templateUrl:"changeServiceOfCalendarsInDate",controller:function($scope,$modalInstance,$stateParams){$scope.updateData=updateData,$scope.doctor={},mdtDoctorService.byId($stateParams.doctorId).then(function(response){$scope.doctor=response.data,sysServiceService.byClinicalDepartment(response.data.CLINICAL_DEPT_ID).then(function(response){$scope.services=response.data})}),TimetableModel.getAllCalendarInDate(postData).then(function(data){"success"==data.status?$scope.calendarsInDate=data.data:toastr.error("Error when get data.")},function(err){toastr.error("Error when get data.")}),$scope.ok=function(){$modalInstance.close(updateData)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},resolve:{updateData:function(){return updateData}}});modalInstance.result.then(function(updateData){updateData&&TimetableModel.updateServiceInDate(updateData).then(function(data){"success"==data.status?($scope.getAppointments(),toastr.success("Update success.")):toastr.error("Update fail.")},function(err){toastr.error("Update fail.")})})}},$scope.getAppointments=function(){toastr.info("Loading data from server");var str_from_time=moment($scope.objectMap.from_time).format("YYYY-MM-DD"),str_to_time=moment($scope.objectMap.to_time).format("YYYY-MM-DD"),get_date=new Date(str_from_time),get_to_date=new Date(str_to_time),timeDiff=Math.abs(get_to_date.getTime()-get_date.getTime()),num_date=Math.ceil(timeDiff/864e5)+1;if(console.log(num_date),console.log(timeDiff),1>num_date)return void alert("To time must be greater then from time");for(var cal_list=[],i=0;cal_list.length<num_date;++i){var run_date=new Date(get_date);run_date.setDate(get_date.getDate()+i);var str_date=run_date;cal_list.push({DATE:str_date,list:[]})}$scope.data=cal_list,DoctorService.overviewCalendar(doctor_id,str_from_time,str_to_time).then(function(response){for(var cal_list=response.data,i=0;i<cal_list.length;++i){var cal=cal_list[i],pos=_.findIndex($scope.data,function(item){return moment(item.DATE).format("DD/MM/YYYY")==cal.DATE});-1!==pos&&($scope.data[pos].list=cal.list)}})},$scope.getAppointments(),$scope.doctor={},mdtDoctorService.byId($stateParams.doctorId).then(function(response){$scope.doctor=response.data,sysServiceService.byClinicalDepartment(response.data.CLINICAL_DEPT_ID).then(function(response){$scope.options.clinical_depts=response.data})})}),angular.module("app.loggedIn.doctor.patients.controller",["app.loggedIn.doctor.patients.detail.controller"]).controller("DoctorPatientsController",function($scope,$state,$cookieStore,DoctorService,localStorageService,CompanyModel){var userInfo=$cookieStore.get("userInfo"),doctorInfo=$cookieStore.get("doctorInfo");$scope.isFilterBelowDoctor=1,doctorInfo||$state.go("loggedIn.home"),$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.loadList()},$scope.loadList=function(){DoctorService.getByUserId(userInfo.id).then(function(data){1==$scope.isFilterBelowDoctor?$scope.searchObjectMap.doctor_id=data.doctor_id:delete $scope.searchObjectMap.doctor_id,DoctorService.listPatients($scope.searchObjectMap).then(function(response){console.log(response),$scope.list=response})})},$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.goToTimetableDetail=function(list){localStorageService.set("patientTempInfo",list);var postData={datetime:moment().format("YYYY-MM-DD hh:mm:ss"),patient_id:list.Patient_id};CompanyModel.getFromTime(postData).then(function(response){-1==response.data?$state.go("loggedIn.patient.appointment",{patient_id:list.Patient_id,cal_id:-1}):$state.go("loggedIn.patient.appointment",{patient_id:list.Patient_id,cal_id:response.data.CAL_ID})},function(error){})};var init=function(){$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.list=[],$scope.loadList()};init()}),angular.module("app.loggedIn.doctor.patients.detail.controller",["app.loggedIn.doctor.patients.detail.appt.controller"]).controller("DoctorPatientsDetailController",function($scope,$state,$cookieStore,DoctorService,PatientService,localStorageService){$scope.goToApptDetail=function(row){var cal_id=row.CAL_ID,patient_id=$scope.patient.Patient_id;$state.go("loggedIn.patient.appointment",{patient_id:patient_id,cal_id:cal_id})};var doctorInfo=$cookieStore.get("doctorInfo"),init=function(){if(!doctorInfo)return void $state.go("loggedIn.doctor.patients");var doctor_id=doctorInfo.doctor_id;$scope.patient=localStorageService.get("patientTempInfo"),$scope.patient||$state.go("loggedIn.doctor.home"),PatientService.getAppointment($scope.patient.Patient_id,doctor_id).then(function(data){$scope.list_appt=data}),PatientService.getById($scope.patient.Patient_id).then(function(data){$scope.patient=data})};init()}),angular.module("app.loggedIn.doctor.patients.detail.appt.controller",["app.loggedIn.doctor.patients.detail.appt.more.controller"]).controller("DoctorPatientsDetailApptController",function($scope,$filter,$state,toastr,$cookieStore,ConfigService,DoctorService,PatientService,localStorageService){alert("form nay khong con su dung [tannv.dts@gmail.com]"),$scope.patient_detail_modules=[{name:"Patient",color:"blue-soft",desc:"Info",icon:"fa fa-user"},{name:"Companies",color:"red-soft",desc:"Total: 12",icon:"fa fa-building"},{name:"Claim",color:"green-soft",desc:"Available",icon:"fa fa-newspaper-o"},{name:"Outside Referral",color:"purple-soft",desc:"Total: 12",icon:"fa fa-envelope-o"}],$scope.patient_apt_modules=[{name:"Appointment",icon:"fa fa-bookmark-o",color:"blue soft",desc:"Info"},{name:"Paperless",icon:"fa fa-pencil-square-o",color:"red soft",desc:"Total: 12"},{name:"Workcover",icon:"fa fa-paper-plane-o",color:"green-soft",desc:"Has: 2"},{name:"Script, Referral",icon:"fa fa-envelope-square",color:"purple-soft",desc:"Has: 2"}],$scope.doctor_detail={permission:{create:"no"},Patient_id:localStorageService.get("patientTempInfo").Patient_id};var arrGetBy=$filter("arrGetBy"),active_item=function(){for(var i=0;i<$scope.list_appt_item.length;++i){var appt_item=$scope.list_appt_item[i],t_item=arrGetBy($scope.list_dept_item,"ITEM_ID",appt_item.ITEM_ID);t_item?(t_item.checked="1",t_item.inserted=!0,t_item.appt_item_id=appt_item.appt_item_id,t_item.QUANTITY=appt_item.QUANTITY?appt_item.QUANTITY:1):(t_item=arrGetBy($scope.extra_list,"ITEM_ID",appt_item.ITEM_ID),t_item?(t_item.chosen=!1,t_item.appt_item_id=appt_item.appt_item_id,t_item.QUANTITY=appt_item.QUANTITY?appt_item.QUANTITY:1):(appt_item.checked="1",appt_item.chosen=!1,$scope.extra_list.push(appt_item)))}for(var i=0;i<$scope.extra_list.length;++i){var extra_item=$scope.extra_list[i],t_item=arrGetBy($scope.list_dept_item,"ITEM_ID",extra_item.ITEM_ID);t_item&&$scope.extra_list.splice(i,1)}$scope.item_list=DoctorService.catItemDept($scope.list_dept_item),delete $scope.list_dept_item,delete $scope.list_appt_item},init=function(){$scope.patient=localStorageService.get("patientTempInfo"),$scope.patient||$state.go("loggedIn.doctor.home"),PatientService.getById($scope.patient.Patient_id).then(function(data){$scope.modelObjectMap=data,localStorageService.set("tempPatient",data),$scope.modelObjectMap.DOB=ConfigService.getCommonDateDefault($scope.modelObjectMap.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.getCommonDateDefault($scope.modelObjectMap.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.getCommonDateDefault($scope.modelObjectMap.Exp_pension)});var doctorInfo=$cookieStore.get("doctorInfo");$scope.apptInfo=localStorageService.get("apptTempInfo"),DoctorService.getApptById($scope.apptInfo.CAL_ID).then(function(data){$scope.apptInfo=data,localStorageService.set("tempAppt",data),$scope.apptChange={},$scope.apptChange.NOTES=data.NOTES,$scope.apptChange.APP_TYPE=data.APP_TYPE}),$scope.options.app_status=ConfigService.appt_status_option();var extra_list=localStorageService.get("itemsTempList");extra_list?($scope.extra_list=extra_list,localStorageService.remove("itemsTempList")):$scope.extra_list=[],DoctorService.getItemByDept(doctorInfo.CLINICAL_DEPT_ID).then(function(data){return $scope.list_dept_item=data,DoctorService.getItemAppt($scope.apptInfo.CAL_ID)}).then(function(data){$scope.list_appt_item=data,active_item()},function(err){console.error(err),toastr.error("Error, please Refresh Page !!!","Error")})};init();var reloadpage=function(){$state.go($state.current,{},{reload:!0})};$scope.saveItemsheet=function(){var insert_list=[],update_list=[],delete_list=[];for(var key in $scope.item_list){var cat=$scope.item_list[key];for(var key2 in cat.list){var item=cat.list[key2];item.inserted?"1"==item.checked?update_list.push({appt_item_id:item.appt_item_id,QUANTITY:item.QUANTITY}):delete_list.push(item.ITEM_ID):"1"==item.checked&&insert_list.push({CLN_ITEM_ID:item.ITEM_ID,QUANTITY:item.QUANTITY})}}for(var i=0,len=$scope.extra_list.length;len>i;++i){var item=$scope.extra_list[i];({CLN_ITEM_ID:item.ITEM_ID,QUANTITY:item.QUANTITY}),item.chosen&&"1"==item.checked?insert_list.push({CLN_ITEM_ID:item.ITEM_ID,QUANTITY:item.QUANTITY}):"1"==item.checked?update_list.push({appt_item_id:item.appt_item_id,QUANTITY:item.QUANTITY}):delete_list.push(item.ITEM_ID)}submitItemSheet(insert_list,update_list,delete_list)};var submitItemSheet=function(insert_list,update_list,delete_list){var cal_id=$scope.apptInfo.CAL_ID,is_insert=0==insert_list.length,is_delete=0==delete_list.length,is_update=0==update_list.length;is_insert||DoctorService.insertItemAppt(cal_id,insert_list).then(function(data){is_insert=!0,is_delete&&is_update&&(reloadpage(),toastr.success("Save Successfully!!!","Success"))}),is_delete||DoctorService.deleteItemAppt(cal_id,delete_list).then(function(data){is_delete=!0,is_insert&&is_update&&(reloadpage(),toastr.success("Save Successfully!!!","Success"))}),is_update||DoctorService.updateItemAppt(cal_id,update_list).then(function(data){is_update=!0,is_delete&&is_insert&&(reloadpage(),toastr.success("Save Successfully!!!","Success"))})};$scope.saveAppt=function(){console.log($scope.apptChange);var obj=arrGetBy($scope.options.app_status,"code",$scope.apptChange.APP_TYPE);return null==obj?void toastr.error("Cannot set status of appointment !!!","Error"):($scope.apptChange.STATUS=obj.title,void DoctorService.updateAppt($scope.apptInfo.CAL_ID,$scope.apptChange).then(function(res){return"success"!=res.status?void toastr.error("Cannot update this Appointment !!!","Error"):void toastr.success("Update Successfully!!!","Success")}))},$scope.updateCompany=function(company){PatientService.update({Patient_id:$scope.patient.Patient_id,company_id:company.id}).then(function(data){"success"==data.status&&(toastr.success("Save Successfully!!!","Success"),reloadpage()),console.log(data)})},$scope.company_search_options={api:"api/erm/v2/companies/search",method:"post",columns:[{field:"id",is_hide:!0},{field:"Company_name",label:"Company Name"},{field:"Industry"}],use_filters:!0,filters:{Company_name:{type:"text"},Industry:{type:"text"}}},$scope.chooseCompany=function(item){console.log(item),$scope.updateCompany(item)},$scope.show_company_form=!1,$scope.show_company_search=!1,$scope.openCompanySearch=function(){$scope.show_company_search=!0},$scope.closeCompanySearch=function(){$scope.show_company_search=!1},$scope.openCompanyForm=function(){$scope.show_company_form=!0},$scope.closeCompanyForm=function(){$scope.show_company_form=!1}}),angular.module("app.loggedIn.doctor.patients.detail.appt.more.controller",[]).controller("DoctorPatientsDetailApptMoreController",function($scope,$filter,$state,toastr,$cookieStore,ConfigService,DoctorService,localStorageService){var arrGetBy=$filter("arrGetBy");$scope.loadList=function(){DoctorService.searchItem($scope.searchObjectMap).then(function(data){for(var i=0,len=data.list.length;len>i;++i)data.list[i].chosen=arrGetBy($scope.chosenItems,"ITEM_ID",data.list[i].ITEM_ID)?!0:!1;$scope.data=data})},$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.setPageLimit=function(){$scope.searchObjectMap.offset=0,$scope.searchObjectMap.currentPage=1,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap={limit:10,offset:0,maxSize:5,currentPage:1,data:{name:"",code:"",type:""}},$scope.chosenItems=[],$scope.loadList()};var init=function(){$scope.patient=localStorageService.get("patientTempInfo"),$scope.options={},$scope.patient||$state.go("loggedIn.doctor.home"),ConfigService.prefix_headers_option("item").then(function(data){$scope.options.prefixs=data}),$scope.reset()};init(),$scope.removeItem=function(item,index){var t=arrGetBy($scope.data.list,"ITEM_ID",item.ITEM_ID);t&&(t.chosen=!1),$scope.chosenItems.splice(index,1)},$scope.chooseItem=function(item){item.chosen=!0,$scope.chosenItems.push(item),console.log($scope.chosenItems)},$scope.submit=function(){$scope.chosenItems.length>0&&localStorageService.set("itemsTempList",$scope.chosenItems),$state.go("loggedIn.doctor.patients.detail.appt")}}),angular.module("app.loggedIn.doctor.items.controller",["app.loggedIn.doctor.items.cat.controller","app.loggedIn.doctor.items.add.controller","app.loggedIn.doctor.items.edit.controller"]).controller("DoctorItemsController",function($scope,$state,$cookieStore,DoctorService,localStorageService){console.log("ITEMS PAGE "),$scope.objectMap={},$scope.navigateEdit=function(item){var updateMode={isUpdateMode:!0,item_id:item.ITEM_ID,header_code:item.POPULAR_HEADER_ID};localStorageService.set("updateData",updateMode),$state.go("loggedIn.doctor.items.edit")};var init=function(){$scope.doctorInfo=$cookieStore.get("doctorInfo");var dept_id=$scope.doctorInfo.CLINICAL_DEPT_ID;DoctorService.getItemByDept(dept_id,!1).then(function(data){console.log(data),$scope.item_list=data}),DoctorService.getItemHeader(dept_id).then(function(data){$scope.optCat=data,$scope.optCat.unshift({POPULAR_HEADER_ID:"",POPULAR_NAME:"-- All Categories --"})}),$scope.optEnable=[{code:"",title:"All"},{code:"1",title:"Enable"},{code:"0",title:"Disable"}],$scope.searchObj={ISENABLE:"1",POPULAR_HEADER_ID:""}};init()}),angular.module("app.loggedIn.doctor.items.add.controller",[]).controller("DoctorItemsAddController",function($scope,$cookieStore,toastr,ConfigService,DoctorService){var init=function(){$scope.info={action:"Add"},$scope.modeFormItem.init()},submitForm=function(){var header_id=$scope.POPULAR_HEADER_ID;console.log("DATA SUBMIT ",$scope.modelObjectMap),DoctorService.insertItem(header_id,$scope.modelObjectMap).then(function(data){"success"==data.status?(toastr.success("Insert Successfully!!!","Success"),$scope.modeFormItem.reset(),$scope.isSubmit=!1):($scope.modelObjectMap.ITEM_START_DATE="",$scope.modelObjectMap.ITEM_END_DATE="")})};$scope.save=function(){return $scope.isSubmit=!0,$scope.mainForm.$invalid||!$scope.modeFormItem.validate()?void toastr.error("Please Check Your Information !!!","Error"):void $scope.modeFormItem.submit(submitForm)},init()}),angular.module("app.loggedIn.doctor.items.edit.controller",[]).controller("DoctorItemsEditController",function($scope,$state,toastr,localStorageService,ConfigService,DoctorService){var old_header_id="",getData=function(item_id){DoctorService.getItemByCode(item_id).then(function(data){console.log(data),"success"==data.status?(console.log(data),data.result[0].ITEM_START_DATE=ConfigService.getCommonDateDefault(data.result[0].ITEM_START_DATE),data.result[0].ITEM_END_DATE=ConfigService.getCommonDateDefault(data.result[0].ITEM_END_DATE),angular.extend($scope.modelObjectMap,data.result[0])):toastr.error("Something happened!","Error")})},init=function(){$scope.modeFormItem.init(),$scope.isSubmit=!1,$scope.info={action:"Edit"};var updateMode=localStorageService.get("updateData");$scope.inUpdateMode=updateMode.isUpdateMode,null!=updateMode&&void 0!=updateMode&&null!=updateMode.item_id&&""!=updateMode.item_id&&void 0!=updateMode.item_id&&(getData(updateMode.item_id),$scope.POPULAR_HEADER_ID=updateMode.header_code,old_header_id=updateMode.header_code)},submitForm=function(){var new_header_id=$scope.POPULAR_HEADER_ID;console.log("DATA SUBMIT ",$scope.modelObjectMap),DoctorService.editItem($scope.modelObjectMap,old_header_id,new_header_id).then(function(data){"success"==data.status&&(toastr.success("Update Successfully!!!","Success"),$state.go("loggedIn.doctor.items"))})};$scope.editItem=function(){return $scope.isSubmit=!0,$scope.mainForm.$invalid||!$scope.modeFormItem.validate()?void toastr.error("Please Check Your Information !!!","Error"):(delete $scope.modelObjectMap.CREATION_DATE,delete $scope.modelObjectMap.Last_update_date,delete $scope.modelObjectMap.BENEFIT_START_DATE,delete $scope.modelObjectMap.EMSN_START_DATE,delete $scope.modelObjectMap.EMSN_END_DATE,delete $scope.modelObjectMap.EMSN_CHANGE_DATE,delete $scope.modelObjectMap.EMSN_CHANGE_DATE,delete $scope.modelObjectMap.DERIVED_FEE_START_DATE,delete $scope.modelObjectMap.DESCRIPTION_START_DATE,delete $scope.modelObjectMap.QFE_START_DATE,delete $scope.modelObjectMap.QFE_END_DATE,void $scope.modeFormItem.submit(submitForm))},init()}),angular.module("app.loggedIn.doctor.items.cat.controller",[]).controller("DoctorItemsCatController",function($scope,$cookieStore,DoctorService,toastr){$scope.validateCat=function(cat){return""!=cat.POPULAR_CODE.trim()&&""!=cat.POPULAR_NAME.trim()},$scope.resetNewCat=function(){$scope.isNewCat=!1,$scope.newCatObj=angular.copy($scope.newCat)},$scope.setNewCat=function(){$scope.isNewCat=!0},$scope.saveNewCat=function(){return $scope.validateCat($scope.newCatObj)?void DoctorService.insertItemHeader($scope.doctorInfo.CLINICAL_DEPT_ID,$scope.newCatObj).then(function(data){console.log(data),"success"==data.status&&($scope.newCatObj.POPULAR_HEADER_ID=data.header_id,$scope.list_cat.push($scope.newCatObj),$scope.resetNewCat(),toastr.success("Insert Successfully !!!","Success"))}):void toastr.error("Please Fill All Information !!!","Error")},$scope.saveEditCat=function(){return $scope.validateCat($scope.editCatObj)?void DoctorService.updateItemHeader($scope.editCatObj).then(function(data){console.log(data),"success"==data.status?(toastr.success("Update Successfully !!!","Success"),$scope.list_cat[$scope.editIndex]=angular.copy($scope.editCatObj),$scope.isEditCat=!1):toastr.error(data.message,"Error")}):void toastr.error("Please Fill All Information !!!","Error")},$scope.setEditCat=function(index){var item=$scope.list_cat[index];$scope.editIndex=index,$scope.editCatObj=angular.copy(item),$scope.editCatObj.ISENABLE+="",$scope.isEditCat=!0},$scope.setDeleteCat=function(item,index){var x=confirm("Do you really want to delete ?");x&&DoctorService.deleteItemHeader($scope.doctorInfo.CLINICAL_DEPT_ID,item.POPULAR_HEADER_ID).then(function(data){console.log(data),"success"==data.status?(toastr.success("Delete Successfully !!!","Success"),$scope.list_cat.splice(index,1)):toastr.error(data.message,"Error")})};var init=function(){$scope.doctorInfo=$cookieStore.get("doctorInfo"),DoctorService.getItemHeader($scope.doctorInfo.CLINICAL_DEPT_ID).then(function(data){console.log(data),$scope.list_cat=data}),$scope.newCat={POPULAR_CODE:"",POPULAR_NAME:"",ISENABLE:"1"},$scope.isEditCat=!1,$scope.resetNewCat()};init()}),angular.module("app.loggedIn.doctor.fachoose.controller",[]).controller("FaChooseController",function($scope,$stateParams,$state){var patient_id=$scope.patient_id=$stateParams.patient_id,cal_id=$scope.cal_id=$stateParams.cal_id;$scope.fa_panel={},$scope.fa={select:0,scope:$scope.fa_panel,options:{api:"api/erm/v2/fa/fa_choose_search",method:"post",scope:$scope.fa_panel,columns:[{field:"FA_ID",is_hide:!0},{field:"TYPE",label:"Type"},{field:"FA_NAME",label:"Name"}],search:{patient_id:patient_id,cal_id:cal_id},use_filters:!0,filters:{TYPE:{type:"text"},FA_NAME:{type:"text"}}}},$scope.clickRow=function(item){console.log("this is choosen item",item);var params={patient_id:patient_id,cal_id:cal_id,fa_id:item.FA_ID},str_state="loggedIn.FA";$state.go(str_state,params)}}),angular.module("app.loggedIn.doctor.directives",["app.loggedIn.doctor.list.directive","app.loggedIn.doctor.search.directive","app.loggedIn.doctor.itemsearch.directive"]),angular.module("app.loggedIn.doctor.search.directive",[]).directive("doctorSearch",function(DoctorService){return{restrict:"EA",scope:{clickRow:"&",isClose:"@"},templateUrl:"modules/doctor/directives/templates/search.html",link:function(scope,element,attrs){if(scope.list={},scope.isClose)var idClose="#"+scope.isClose;scope.params={pagination:{limit:10,offset:0,current_page:1,max_size:5},filters:[{type:"text",name:"NAME",value:""},{type:"text",name:"Email",value:""}],select:["doctor_id","NAME","Email"]},scope.closePopup=function(){angular.element(idClose).fadeOut()};var loadList=function(){DoctorService.mdtSearch(scope.params).then(function(response){"success"===response.status&&(scope.list=response)},function(error){alert("Error Server")})};loadList(),scope.refreshList=function(){loadList()},scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.doctor.list.directive",[]).directive("doctorList",function(){return{restrict:"EA",scope:{},templateUrl:"modules/doctor/directives/templates/list.html",link:function(scope,element,attrs){scope.data_options={api:"api/erm/doctors/search",method:"post",columns:[{field:"doctor_id",is_hide:!0},{field:"NAME",label:"Doctor Name"},{field:"Email",label:"Email"}],show_index:!0,use_filters:!0,filters:{NAME:{type:"text"},Email:{type:"text"}}},scope.clickRow=function(item){console.log(item)}}}}),angular.module("app.loggedIn.doctor.itemsearch.directive",[]).directive("itemSearch",function($filter,PatientService,OutsideReferralModel,ReceptionistService,toastr){var arrGetBy=$filter("arrGetBy");return{restrict:"EA",scope:{list:"=",extra:"=",appt:"="},template:'<my-data-table options="data_options" rowclass="set_row_class" rowclick="row_click">',controller:function($scope){$scope.data_options={api:"api/erm/v2/items/search",method:"post",columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code"},{field:"ITEM_NAME",label:"Item Name"},{field:"ITEM_TYPE",label:"Type"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"},ITEM_TYPE:{type:"text"}}},$scope.set_row_class=function(item){var t_item=arrGetBy($scope.list,"ITEM_ID",item.ITEM_ID);if(t_item)return"success";var t_item=arrGetBy($scope.extra,"ITEM_ID",item.ITEM_ID);return t_item?"success":void 0},$scope.row_click=function(item){if(void 0!==$scope.extra&&null!==$scope.extra){var t_item=arrGetBy($scope.extra,"ITEM_ID",item.ITEM_ID);if(!t_item){var t_item=arrGetBy($scope.list,"ITEM_ID",item.ITEM_ID);t_item||(item.QUANTITY=1,item.checked="1",item.chosen=!0,$scope.extra.push(item),ReceptionistService.itemFeeAppt($scope.appt.SERVICE_ID,[item.ITEM_ID]).then(function(response){var list_fee=response.list,t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item?(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0):(item.PRICE=0,item.disable_fee=!1)},function(err){console.log(err)}))}}}}}}),angular.module("app.loggedIn.document",["app.loggedIn.document.cat2.controllers","app.loggedIn.document.cat3.controllers","app.loggedIn.document.FA.controllers","app.loggedIn.document.MA.controllers","app.loggedIn.document.IDS.controllers","app.loggedIn.document.gorgonFA.controllers","app.loggedIn.document.gorgonMA.controllers","app.loggedIn.document.gorgonMH.controllers","app.loggedIn.document.gorgonUQ.controllers","app.loggedIn.document.services","app.loggedIn.document.MH.controllers","app.loggedIn.document.MRS.controllers","app.loggedIn.document.SA1.controllers","app.loggedIn.document.SA2.controllers","app.loggedIn.document.COE.controllers","app.loggedIn.document.demo.controllers","app.loggedIn.document.detail.controllers","app.loggedIn.document.addPatient.controllers","app.loggedIn.document.form18.controllers","app.loggedIn.document.newFA.controllers"]).config(function($stateProvider){$stateProvider.state("loggedIn.demo",{url:"/demo",templateUrl:"modules/document/views/DemoDocument.html",controller:"demoController"}).state("loggedIn.Detail",{url:"/detail",templateUrl:"modules/document/views/patientDetail.html",controller:"detailController"}).state("loggedIn.addPatient",{url:"/addPatient",templateUrl:"modules/document/views/addPatient.html",controller:"addPatientController"}).state("loggedIn.COE",{url:"/COE/:patient_id/:cal_id",templateUrl:"modules/document/views/COE.html",controller:"COEController"}).state("loggedIn.category2",{url:"/category2/:patient_id/:cal_id",templateUrl:"modules/document/views/category2.html",controller:"Cat2Controller"}).state("loggedIn.category3",{url:"/category3/:patient_id/:cal_id",templateUrl:"modules/document/views/category3.html",controller:"Cat3Controller"}).state("loggedIn.MA",{url:"/MA/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalAssessment.html",controller:"MAController"}).state("loggedIn.IDS",{url:"/IDS/:patient_id/:cal_id",templateUrl:"modules/document/views/instantScreen.html",controller:"IDSController"}).state("loggedIn.gorgonFA",{url:"/gorgonFA/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonFA.html",controller:"gorgonFAController"}).state("loggedIn.gorgonMA",{url:"/gorgonMA/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonMA.html",controller:"gorgonMAController"}).state("loggedIn.gorgonMH",{url:"/gorgonMH/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonMH.html",controller:"gorgonMHController"}).state("loggedIn.gorgonUQ",{url:"/gorgonUQ/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonUQ.html",controller:"gorgonUQController"}).state("loggedIn.Form18",{url:"/Form18/:patient_id/:cal_id",templateUrl:"modules/document/views/form18.html",controller:"form18Controller"}).state("loggedIn.MH",{url:"/MH/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalhistory.html",controller:"MHController"}).state("loggedIn.MRS",{url:"/MRS/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalresultsummary.html",controller:"MRSController"}).state("loggedIn.SA1",{url:"/SA1/:patient_id/:cal_id",templateUrl:"modules/document/views/audiogramresults1.html",controller:"SA1Controller"}).state("loggedIn.SA2",{url:"/SA2/:patient_id/:cal_id",templateUrl:"modules/document/views/audiogramresults2.html",controller:"SA2Controller"}).state("loggedIn.FA",{url:"/FA/:patient_id/:cal_id/:fa_id",templateUrl:"modules/document/views/newFunctionalAssessment.html",controller:"newFAController"}).state("loggedIn.newFA",{url:"/newFA/:patient_id/:cal_id/:fa_id",templateUrl:"modules/document/views/functionAssessment.html",controller:"FAController"})}),angular.module("app.loggedIn.document.services",[]).factory("DocumentService",function(Restangular,ConfigService,$state){var documentService={},api=Restangular.all("api");documentService.loadPatient=function(searchObj){var loadPatient=api.all("document/loadPatient");return loadPatient.post({searchObj:searchObj})},documentService.insertCOE=function(info){var insertCOE=api.all("document/insertCOE");return insertCOE.post({info:info})},documentService.updateCOE=function(info){var updateCOE=api.all("document/updateCOE");return updateCOE.post({info:info})},documentService.checkCOE=function(PatientID,calID){var checkCOE=api.all("document/checkCOE");return checkCOE.post({PatientID:PatientID,calID:calID})},documentService.insertFA=function(infoH,infoL,infoD,infoC,fa_id){var insertFA=api.all("document/insertFA");return insertFA.post({infoL:infoL,infoH:infoH,infoD:infoD,infoC:infoC,fa_id:fa_id})},documentService.updateFA=function(infoH,infoL,infoD,infoC){var updateFA=api.all("document/updateFA");return updateFA.post({infoL:infoL,infoH:infoH,infoD:infoD,infoC:infoC})},documentService.checkFA=function(PatientID,calID,FA_ID){var checkFA=api.all("document/checkFA");return checkFA.post({PatientID:PatientID,calID:calID,fa_id:FA_ID})},documentService.checkRating=function(id,age,gender,val){var checkRating=api.all("document/checkRating");return checkRating.post({id:id,age:age,gender:gender,value:val})},documentService.insertMA=function(info){var insertMA=api.all("document/insertMA");return insertMA.post({info:info})},documentService.editMA=function(info){var editMA=api.all("document/editMA");return editMA.post({info:info})},documentService.checkMA=function(PatientID,calID,idC){var checkMA=api.all("document/checkMA");return checkMA.post({PatientID:PatientID,calID:calID,idC:idC})},documentService.loadIDS=function(infoLoad){var loadIDS=api.all("document/loadIDS");return loadIDS.post({info:infoLoad})},documentService.insertIDS=function(infoAdd){var insertIDS=api.all("document/insertIDS");return insertIDS.post({info:infoAdd})},documentService.updateIDS=function(infoUp){
var checkIDS=api.all("document/updateIDS");return checkIDS.post({info:infoUp})},documentService.insertUQ=function(info){var insertUQ=api.all("document/insertUQ");return insertUQ.post({info:info})},documentService.updateUQ=function(info){var updateUQ=api.all("document/updateUQ");return updateUQ.post({info:info})},documentService.checkUser=function(PatientID,calID){var checkUser=api.all("document/checkUser");return checkUser.post({PatientID:PatientID,calID:calID})},documentService.insertGorgonFA=function(info){var insertGorgonFA=api.all("document/insertGorgonFA");return insertGorgonFA.post({info:info})},documentService.editGorgonFA=function(info){var edit=api.all("document/editGorgonFA");return edit.post({info:info})},documentService.checkGorgonFA=function(PatientID,calID){var checkGorgonFA=api.all("document/checkGorgonFA");return checkGorgonFA.post({PatientID:PatientID,calID:calID})},documentService.insertGorgonMA=function(info){var insertGorgonMA=api.all("document/insertGorgonMA");return insertGorgonMA.post({info:info})},documentService.editGorgonMA=function(info){var edit=api.all("document/editGorgonMA");return edit.post({info:info})},documentService.checkGorgonMA=function(PatientID,calID){var checkGorgonMA=api.all("document/checkGorgonMA");return checkGorgonMA.post({PatientID:PatientID,calID:calID})},documentService.loadMH=function(infoLoad){var info=api.all("document/loadMH");return info.post({info:infoLoad})},documentService.insertMH=function(infoAdd){var insertMH=api.all("document/insertMH");return insertMH.post({info:infoAdd})},documentService.editMH=function(infoEdit){var editMH=api.all("document/editMH");return editMH.post({info:infoEdit})},documentService.loadMRS=function(infoLoad){var loadMRS=api.all("document/loadMRS");return loadMRS.post({info:infoLoad})},documentService.insertMRS=function(infoAdd){var insertMRS=api.all("document/insertMRS");return insertMRS.post({info:infoAdd})},documentService.editMRS=function(infoEdit){var editMRS=api.all("document/editMRS");return editMRS.post({info:infoEdit})},documentService.loadForm18=function(infoLoad){var loadForm=api.all("document/loadForm18");return loadForm.post({info:infoLoad})},documentService.insertForm18=function(infoAdd){var insertForm18=api.all("document/insertForm18");return insertForm18.post({info:infoAdd})},documentService.editForm18=function(infoEdit){var editForm18=api.all("document/editForm18");return editForm18.post({info:infoEdit})},documentService.loadSA1=function(infoLoad){var loadSA1=api.all("document/loadSA1");return loadSA1.post({info:infoLoad})},documentService.insertSA1=function(infoAdd){var insertSA1=api.all("document/insertSA1");return insertSA1.post({info:infoAdd})},documentService.editSA1=function(infoEdit){var editSA1=api.all("document/editSA1");return editSA1.post({info:infoEdit})},documentService.loadSA2=function(infoLoad){var loadSA2=api.all("document/loadSA2");return loadSA2.post({info:infoLoad})},documentService.insertSA2=function(infoAdd){var insertSA2=api.all("document/insertSA2");return insertSA2.post({info:infoAdd})},documentService.editSA2=function(infoEdit){var editSA2=api.all("document/editSA2");return editSA2.post({info:infoEdit})},documentService.newAUD2=function(){var newAUD2=api.one("document/newAUD2");return newAUD2.get()},documentService.loadAUD2=function(){var loadAUD2=api.one("document/loadAUD2");return loadAUD2.get()},documentService.insertCat2=function(infoAdd){var insertCat2=api.all("document/insertCat2");return insertCat2.post({info:infoAdd})},documentService.loadCat2=function(infoFind){var loadCat2=api.all("document/loadCat2");return loadCat2.post({info:infoFind})},documentService.editCat2=function(infoUp){var editCat2=api.all("document/editCat2");return editCat2.post({info:infoUp})},documentService.loadCat3=function(infoFind){var info=api.all("document/loadCat3");return info.post({info:infoFind})},documentService.insertCat3=function(infoAdd){var info=api.all("document/insertCat3");return info.post({info:infoAdd})},documentService.findCat3=function(ids){var info=api.all("document/findCat3");return info.post({ids:ids})},documentService.editCat3=function(infoUp){var info=api.all("document/editCat3");return info.post({info:infoUp})},documentService.insertUQ=function(info){var insertUQ=api.all("document/insertUQ");return insertUQ.post({info:info})},documentService.loadGGMH=function(infoLoad){var info=api.all("document/loadGGMH");return info.post({info:infoLoad})},documentService.insertGGMH=function(infoAdd){var info=api.all("document/insertGGMH");return info.post({info:infoAdd})},documentService.editGGMH=function(infoUp){var info=api.all("document/editGGMH");return info.post({info:infoUp})},documentService.loadNewHeaderSections=function(fa_id){var info=api.all("document/newHeaderSections");return info.post({fa_id:fa_id})},documentService.loadNewLines=function(section_id,fa_id){var info=api.all("document/newLines");return info.post({section_id:section_id,fa_id:fa_id})},documentService.loadNewCommentsAndDetails=function(line_id){var info=api.all("document/newDetailsComments");return info.post({line_id:line_id})},documentService.autoRating=function(ratingData){var info=api.all("document/autoRating");return info.post({patient_age:ratingData.patient_age,patient_gender:ratingData.patient_gender,valueToRate:ratingData.valueToRate,rating_id:ratingData.rating_id})},documentService.checkExistFA=function(fa_id,patient_id,cal_id){var info=api.all("document/checkExistFA");return info.post({fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistHeaderSections=function(fa_id,patient_id,cal_id){var info=api.all("document/existHeaderSections");return info.post({fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistLines=function(section_id,fa_id,patient_id,cal_id){var info=api.all("document/existLines");return info.post({section_id:section_id,fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistCommentsAndDetails=function(line_id,patient_id,cal_id){var info=api.all("document/existDetailsComments");return info.post({line_id:line_id,patient_id:patient_id,cal_id:cal_id})},documentService.insertNewFA=function(insertData){var insertNewFA=api.all("document/insertNewFA");return insertNewFA.post({insertData:insertData})},documentService.updateNewFA=function(updateData,patient_id,cal_id){var updateNewFA=api.all("document/updateNewFA");return updateNewFA.post({updateData:updateData,patient_id:patient_id,cal_id:cal_id})},documentService.getDoctor=function(appt_info){var getDoctor=api.all("document/getDoctorFA");return getDoctor.post(appt_info)};var strPrefixAPI="api/erm/v2/paperless/";return documentService.optionGorgonMA=function(patient_id){return{api:strPrefixAPI+"gorgon_ma_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"GORGON_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonMA",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonFA=function(patient_id){return{api:strPrefixAPI+"gorgon_fa_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonFA",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonUQ=function(patient_id){return{api:strPrefixAPI+"gorgon_uq_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"Quest_Id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonUQ",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonMH=function(patient_id){return{api:strPrefixAPI+"gorgon_mh_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"Gorgon_Id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonMH",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionMRS=function(patient_id){return{api:strPrefixAPI+"mrs_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"mrs_id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MRS",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.optionCategory2=function(patient_id){return{api:strPrefixAPI+"category2_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"cat_id",is_hide:!0},{field:"DATE",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.DATE)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.category2",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.optionCategory3=function(patient_id){return{api:strPrefixAPI+"category3_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"cat_id",is_hide:!0},{field:"PATIENT_DATE",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.PATIENT_DATE)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.category3",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.Optionform18=function(patient_id){return{api:strPrefixAPI+"form18_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"GORGON_ID",is_hide:!0},{field:"TIME_TEST",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.TIME_TEST)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.Form18",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionSA1=function(patient_id){return{api:strPrefixAPI+"audiogram1_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"SA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.SA1",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionSA2=function(patient_id){return{api:strPrefixAPI+"audiogram2_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"SA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.SA2",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionMH=function(patient_id){return{api:strPrefixAPI+"medical_history_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"mh_id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MH",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.OptionCOE=function(patient_id){return{api:strPrefixAPI+"coe_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"coe_id",is_hide:!0},{field:"coeDate",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.COE",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.OptionIDS=function(patient_id){return{api:strPrefixAPI+"instant_drug_screen_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"IDAS_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.IDS",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionFA=function(patient_id){return{api:strPrefixAPI+"functional_assessment_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"FA_ID",is_hide:!0},{field:"FA_NAME",label:"Name"},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.FA",{patient_id:patient_id,cal_id:item.CAL_ID,fa_id:item.FA_ID})}},{"class":"fa fa-print",title:"Print",callback:function(item){window.open("http://testapp.redimed.com.au:3003/RedimedJavaREST/api/document/FA/"+item.FA_ID+"/"+item.CAL_ID+"/"+patient_id)}}]}},documentService.OptionMA=function(patient_id){return{api:strPrefixAPI+"medical_assessment_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"MA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MA",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService}),angular.module("app.loggedIn.document.cat2.controllers",[]).controller("Cat2Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$filter,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature},$scope.today=new Date;var patientInfo=localStorageService.get("tempPatient");(null===patientInfo||"undefined"===patientInfo)&&(toastr.error("Load information fail!","Error"),$state.go("loggedIn.home",null,{reload:!0}));var Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={cat_id:null,cal_id:CalID,DocId:null,patient_id:Patient_ID,Signature:null,has_declaration:null,has_safety:null,has_following:null,audiometric:null,q1_4:null,q1_4_c:null,q1_5_1:null,q1_5_2:null,q1_5_3:null,q1_5_3_c:null,q3_1_1:null,q3_1_1_c:null,q3_1_2:null,q3_1_2_c:null,q3_1_3_1:null,q3_1_3_2:null,q3_1_3_3:null,q3_1_3_4:null,q3_1_3_5:null,q3_1_3_6:null,q3_1_3_7:null,q3_1_3_8:null,q3_1_3_9:null,q3_1_3_10:null,q3_1_3_11:null,q3_1_3_12:null,q3_1_3_13:null,q3_1_3_14:null,q3_1_3_15:null,q3_1_3_16:null,q3_1_3_17:null,q3_1_3_18:null,q3_1_3_19:null,q3_1_3_20:null,q3_1_3_21:null,q3_1_3_22:null,q3_1_3_23:null,q3_1_4_1:null,q3_1_4_2:null,q3_1_4_3_1:null,q3_1_4_3_2:null,q3_1_4_3_3:null,q3_1_4_3_4:null,q3_1_4_3_5:null,q3_1_4_3_6:null,q3_1_4_3_7:null,q3_1_4_3_8:null,q3_1_5_1:null,q3_1_5_2:null,q3_1_5_3:null,q3_1_5_4:null,q3_1_5_5:null,q3_1_5_6:null,q3_1_5_7:null,q3_1_5_8:null,q3_1_5_9:null,q3_1_5_10:null,q3_1_6_1:null,q3_1_6_2:null,q3_1_6_3:null,q3_1_6_4:null,q3_1_6_5:null,q3_1_6_6:null,q3_1_6_7:null,q3_1_6_8:null,q3_1_6_9:null,q3_1_6_10:null,q3_1_6_c:null,q3_2:null,q4_2_1_1_1:null,q4_2_1_1_2:null,q4_2_1_2:null,q4_2_1_2_c:null,q4_2_1_3:null,q4_2_1_4:null,q4_2_2:null,q4_2_3:null,q4_2_4_c:null,q4_2_5_1:null,q4_2_5_2:null,q4_2_5_3_1:null,q4_2_5_3_2:null,q4_2_5_4_1:null,q4_2_5_4_2:null,q4_2_5_5:null,q4_2_5_6:null,q4_2_6_1:null,q4_2_6_2:null,q4_2_7_L_1:null,q4_2_7_L_2:null,q4_2_7_L_3:null,q4_2_7_L_4:null,q4_2_7_L_5:null,q4_2_7_L_6:null,q4_2_7_L_7:null,q4_2_7_L_8:null,q4_2_7_R_1:null,q4_2_7_R_2:null,q4_2_7_R_3:null,q4_2_7_R_4:null,q4_2_7_R_5:null,q4_2_7_R_6:null,q4_2_7_R_7:null,q4_2_7_R_8:null,q4_2_7:null,q4_2_8_c:null,q4_2_8_1_c:null,q4_2_8_2_1:null,q4_2_8_2_c:null,q4_2_8_3_1:null,q4_2_8_3_c:null,q4_2_8_4_1:null,q4_2_8_4_c:null,q4_2_8_5_1:null,q4_2_8_5_c:null,q4_2_8_6_1:null,q4_2_8_6_c:null,q4_2_8_7_1:null,q4_2_8_7_c:null,q4_2_8_8_1:null,q4_2_8_8_c:null,q4_2_8_9_1:null,q4_2_8_9_c:null,q4_2_9:0,q4_2_10_1:null,q4_2_10_2:null,q4_2_11:0,q4_2_12_1:0,q4_2_12_2:null,q4_2_13_1_1:null,q4_2_13_1_2:null,q4_2_13_1_3:null,q4_2_13_1_4:null,q4_2_13_1_5:null,q4_2_13_2:null,q4_2_13_3:null,q4_2_13_4:null,q4_2_13_5:null,q4_2_13_6:null,rel_cmt:null,rel_id:null,r1_1:null,r1_2:null,r1_3:null,r1_4_y:null,r1_5:null,r1_6:null,r1_7:null,r1_8:null,r1_8_c:null,r2_1:null,r2_2:null,r2_2_y:null,r2_3:null,r2_4:null,r2_5:null,r2_6:null,r2_7_c:null,r3_1:null,r3_2_c:null,r4_1:null,r4_2_c:null,r5_1:null,r5_2:null,DATE:new Date,DOCTOR_ID:null,Created_by:null,Last_updated_by:null};var oriInfo,info=$scope.info;DocumentService.loadCat2(info).then(function(response){if("fail"===response.status)$state.go("logged.home",null,{reload:!0}),toastr.error("Load fail!","Error");else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.apptInfo=response[0].appt,$scope.info.doctor=response[0].doctor,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].dataCat2,timeAppt=(new Date(response[0].appt.FROM_TIME).getHours()%12<=9?"0"+new Date(response[0].appt.FROM_TIME).getHours()%12:new Date(response[0].appt.FROM_TIME).getHours()%12)+" : "+(new Date(response[0].appt.FROM_TIME).getMinutes()<=9?"0"+new Date(response[0].appt.FROM_TIME).getMinutes():new Date(response[0].appt.FROM_TIME).getMinutes())+(new Date(response[0].appt.FROM_TIME).getHours()>12?" PM":" AM");$scope.info={apptInfo:response[0].appt,patient:response[0].patient,doctor:response[0].doctor,company:response[0].company,timeAppt:timeAppt,cat_id:data.cat_id,cal_id:data.cal_id,DocId:data.DocId,patient_id:data.patient_id,Signature:data.Signature,has_declaration:data.has_declaration,has_safety:data.has_safety,has_following:data.has_following,audiometric:data.audiometric,q1_4:data.q1_4,q1_4_c:data.q1_4_c,q1_5_1:data.q1_5_1,q1_5_2:data.q1_5_2,q1_5_3:data.q1_5_3,q1_5_3_c:data.q1_5_3_c,q3_1_1:data.q3_1_1,q3_1_1_c:data.q3_1_1_c,q3_1_2:data.q3_1_2,q3_1_2_c:data.q3_1_2_c,q3_1_3_1:data.q3_1_3_1,q3_1_3_2:data.q3_1_3_2,q3_1_3_3:data.q3_1_3_3,q3_1_3_4:data.q3_1_3_4,q3_1_3_5:data.q3_1_3_5,q3_1_3_6:data.q3_1_3_6,q3_1_3_7:data.q3_1_3_7,q3_1_3_8:data.q3_1_3_8,q3_1_3_9:data.q3_1_3_9,q3_1_3_10:data.q3_1_3_10,q3_1_3_11:data.q3_1_3_11,q3_1_3_12:data.q3_1_3_12,q3_1_3_13:data.q3_1_3_13,q3_1_3_14:data.q3_1_3_14,q3_1_3_15:data.q3_1_3_15,q3_1_3_16:data.q3_1_3_16,q3_1_3_17:data.q3_1_3_17,q3_1_3_18:data.q3_1_3_18,q3_1_3_19:data.q3_1_3_19,q3_1_3_20:data.q3_1_3_20,q3_1_3_21:data.q3_1_3_21,q3_1_3_22:data.q3_1_3_22,q3_1_3_23:data.q3_1_3_23,q3_1_4_1:data.q3_1_4_1,q3_1_4_2:data.q3_1_4_2,q3_1_4_3_1:data.q3_1_4_3_1,q3_1_4_3_2:data.q3_1_4_3_2,q3_1_4_3_3:data.q3_1_4_3_3,q3_1_4_3_4:data.q3_1_4_3_4,q3_1_4_3_5:data.q3_1_4_3_5,q3_1_4_3_6:data.q3_1_4_3_6,q3_1_4_3_7:data.q3_1_4_3_7,q3_1_4_3_8:data.q3_1_4_3_8,q3_1_5_1:data.q3_1_5_1,q3_1_5_2:data.q3_1_5_2,q3_1_5_3:data.q3_1_5_3,q3_1_5_4:data.q3_1_5_4,q3_1_5_5:data.q3_1_5_5,q3_1_5_6:data.q3_1_5_6,q3_1_5_7:data.q3_1_5_7,q3_1_5_8:data.q3_1_5_8,q3_1_5_9:data.q3_1_5_9,q3_1_5_10:data.q3_1_5_10,q3_1_6_1:data.q3_1_6_1,q3_1_6_2:data.q3_1_6_2,q3_1_6_3:data.q3_1_6_3,q3_1_6_4:data.q3_1_6_4,q3_1_6_5:data.q3_1_6_5,q3_1_6_6:data.q3_1_6_6,q3_1_6_7:data.q3_1_6_7,q3_1_6_8:data.q3_1_6_8,q3_1_6_9:data.q3_1_6_9,q3_1_6_10:data.q3_1_6_10,q3_1_6_c:data.q3_1_6_c,q3_2:data.q3_2,q4_2_1_1_1:data.q4_2_1_1_1,q4_2_1_1_2:data.q4_2_1_1_2,q4_2_1_2:data.q4_2_1_2,q4_2_1_2_c:data.q4_2_1_2_c,q4_2_1_3:data.q4_2_1_3,q4_2_1_4:data.q4_2_1_4,q4_2_2:data.q4_2_2,q4_2_3:data.q4_2_3,q4_2_4_c:data.q4_2_4_c,q4_2_5_1:data.q4_2_5_1,q4_2_5_2:data.q4_2_5_2,q4_2_5_3_1:data.q4_2_5_3_1,q4_2_5_3_2:data.q4_2_5_3_2,q4_2_5_4_1:data.q4_2_5_4_1,q4_2_5_4_2:data.q4_2_5_4_2,q4_2_5_5:data.q4_2_5_5,q4_2_5_6:data.q4_2_5_6,q4_2_6_1:data.q4_2_6_1,q4_2_6_2:data.q4_2_6_2,q4_2_7_L_1:data.q4_2_7_L_1,q4_2_7_L_2:data.q4_2_7_L_2,q4_2_7_L_3:data.q4_2_7_L_3,q4_2_7_L_4:data.q4_2_7_L_4,q4_2_7_L_5:data.q4_2_7_L_5,q4_2_7_L_6:data.q4_2_7_L_6,q4_2_7_L_7:data.q4_2_7_L_7,q4_2_7_L_8:data.q4_2_7_L_8,q4_2_7_R_1:data.q4_2_7_R_1,q4_2_7_R_2:data.q4_2_7_R_2,q4_2_7_R_3:data.q4_2_7_R_3,q4_2_7_R_4:data.q4_2_7_R_4,q4_2_7_R_5:data.q4_2_7_R_5,q4_2_7_R_6:data.q4_2_7_R_6,q4_2_7_R_7:data.q4_2_7_R_7,q4_2_7_R_8:data.q4_2_7_R_8,q4_2_7:data.q4_2_7,q4_2_8_c:data.q4_2_8_c,q4_2_8_1_c:data.q4_2_8_1_c,q4_2_8_2_1:data.q4_2_8_2_1,q4_2_8_2_c:data.q4_2_8_2_c,q4_2_8_3_1:data.q4_2_8_3_1,q4_2_8_3_c:data.q4_2_8_3_c,q4_2_8_4_1:data.q4_2_8_4_1,q4_2_8_4_c:data.q4_2_8_4_c,q4_2_8_5_1:data.q4_2_8_5_1,q4_2_8_5_c:data.q4_2_8_5_c,q4_2_8_6_1:data.q4_2_8_6_1,q4_2_8_6_c:data.q4_2_8_6_c,q4_2_8_7_1:data.q4_2_8_7_1,q4_2_8_7_c:data.q4_2_8_7_c,q4_2_8_8_1:data.q4_2_8_8_1,q4_2_8_8_c:data.q4_2_8_8_c,q4_2_8_9_1:data.q4_2_8_9_1,q4_2_8_9_c:data.q4_2_8_9_c,q4_2_9:data.q4_2_9,q4_2_10_1:data.q4_2_10_1,q4_2_10_2:data.q4_2_10_2,q4_2_11:data.q4_2_11,q4_2_12_1:data.q4_2_12_1,q4_2_12_2:data.q4_2_12_2,q4_2_13_1_1:data.q4_2_13_1_1,q4_2_13_1_2:data.q4_2_13_1_2,q4_2_13_1_3:data.q4_2_13_1_3,q4_2_13_1_4:data.q4_2_13_1_4,q4_2_13_1_5:data.q4_2_13_1_5,q4_2_13_2:data.q4_2_13_2,q4_2_13_3:data.q4_2_13_3,q4_2_13_4:data.q4_2_13_4,q4_2_13_5:data.q4_2_13_5,q4_2_13_6:data.q4_2_13_6,rel_cmt:data.rel_cmt,rel_id:data.rel_id,r1_1:data.r1_1,r1_2:data.r1_2,r1_3:data.r1_3,r1_4_y:data.r1_4_y,r1_5:data.r1_5,r1_6:data.r1_6,r1_7:data.r1_7,r1_8:data.r1_8,r1_8_c:data.r1_8_c,r2_1:data.r2_1,r2_2:data.r2_2,r2_2_y:data.r2_2_y,r2_3:data.r2_3,r2_4:data.r2_4,r2_5:data.r2_5,r2_6:data.r2_6,r2_7_c:data.r2_7_c,r3_1:data.r3_1,r3_2_c:data.r3_2_c,r4_1:data.r4_1,r4_2_c:data.r4_2_c,r5_1:data.r5_1,r5_2:data.r5_2,DATE:data.DATE,DOCTOR_ID:response[0].doctor.DOCTOR_ID,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.cat2Form.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(cat2Form){if(cat2Form.$error.pattern||cat2Form.$error.maxlength||cat2Form.$error.required)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;info.q4_2_9=$scope.info.q3_1_4_3_1+$scope.info.q3_1_4_3_2+$scope.info.q3_1_4_3_3+$scope.info.q3_1_4_3_4+$scope.info.q3_1_4_3_5+$scope.info.q3_1_4_3_6+$scope.info.q3_1_4_3_7+$scope.info.q3_1_4_3_8,info.q4_2_11=$scope.info.q3_1_5_1+$scope.info.q3_1_5_2+$scope.info.q3_1_5_3+$scope.info.q3_1_5_4+$scope.info.q3_1_5_5+$scope.info.q3_1_5_6+$scope.info.q3_1_5_7+$scope.info.q3_1_5_8+$scope.info.q3_1_5_9+$scope.info.q3_1_5_10,info.q4_2_12_1=$scope.info.q3_1_6_1+$scope.info.q3_1_6_2+$scope.info.q3_1_6_3+$scope.info.q3_1_6_4+$scope.info.q3_1_6_5+$scope.info.q3_1_6_6+$scope.info.q3_1_6_7+$scope.info.q3_1_6_8+$scope.info.q3_1_6_9+$scope.info.q3_1_6_10,$scope.isNew===!0?DocumentService.insertCat2(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.category2",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editCat2(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.category2",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}),angular.module("app.loggedIn.document.cat3.controllers",[]).controller("Cat3Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date;var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.PATIENT_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.PATIENT_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.PATIENT_SIGNATURE};var tempPatient=localStorageService.get("tempPatient");if("undefined"===tempPatient||null==tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={cat_id:null,cal_id:cal_id,patient_id:patient_id,has_declaration:null,has_following:null,audiometric:null,q1_4:null,q1_4_c:null,q1_5_1:null,q1_5_2:null,q1_5_3:null,s3_q1_1_1:null,s3_q1_1_2:null,s3_q1_2_1:null,s3_q1_2_2:null,s3_q1_3:null,s3_q1_4:null,s3_q2_1_1:null,s3_q2_1_2:null,s3_q2_1_3:null,s3_q2_1_4:null,s3_q2_1_5:null,s3_q2_1_6:null,s3_q2_1_7:null,s3_q2_1_8:null,s3_q2_2_1:null,s3_q2_2_2:null,s3_q2_2_3:null,s3_q2_2_4:null,s3_q2_2_5:null,s3_q2_2_6:null,s3_q2_2_7:null,s3_q2_2_8:null,s3_q2_3:null,s3_q3_1:null,s3_q3_2:null,s3_q3_3_1:null,s3_q3_3_2:null,s3_q3_4_1:null,s3_q3_4_2:null,s3_q3_5:null,s3_q3_6:null,s3_q4:null,s3_q5_1_1_1:null,s3_q5_1_1_2:null,s3_q5_1_1_3:null,s3_q5_1_1_4:null,s3_q5_1_2:null,s3_q5_2:null,s3_q5_3:null,s3_q5_4:null,s3_q5_5:null,s3_q5_6:null,s3_q6_c:null,s3_q6_1:null,s3_q6_2_1:null,s3_q6_2_2:null,s3_q6_3_1:null,s3_q6_3_2:null,s3_q6_4_1:null,s3_q6_4_2:null,s3_q6_5_1:null,s3_q6_5_2:null,s3_q6_6_1:null,s3_q6_6_2:null,s3_q6_7_1:null,s3_q6_7_2:null,s3_q6_8_1:null,s3_q6_8_2:null,s3_q6_9_1:null,s3_q6_9_2:null,s3_q7_1:null,s3_q7_2:null,s4_c:null,s4_1:null,s4_2:null,r1_1:null,r1_2:null,r1_3:null,r1_4_y:null,r1_5:null,r1_6:null,r1_7:null,r1_8:null,r1_8_c:null,r2_1:null,r2_2:null,r2_2_y:null,r2_3:null,r2_4:null,r2_5:null,r2_6:null,r2_7_c:null,r3_1:null,r3_2_c:null,r4_1:null,r4_2_c:null,r5_1:null,r5_2:null,DocId:null,q1_5_3_c:null,PATIENT_SIGNATURE:null,PATIENT_DATE:new Date,DOCTOR_ID:null,Created_by:null,Last_updated_by:null};var oriInfo,info=$scope.info;DocumentService.loadCat3(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.apptInfo=response[0].appt,$scope.info.doctor=response[0].doctor,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){var data=response[0].data;$scope.isNew=!1;var timeAppt=(new Date(response[0].appt.FROM_TIME).getHours()%12<=9?"0"+new Date(response[0].appt.FROM_TIME).getHours()%12:new Date(response[0].appt.FROM_TIME).getHours()%12)+" : "+(new Date(response[0].appt.FROM_TIME).getMinutes()<=9?"0"+new Date(response[0].appt.FROM_TIME).getMinutes():new Date(response[0].appt.FROM_TIME).getMinutes())+(new Date(response[0].appt.FROM_TIME).getHours()>12?" PM":" AM");$scope.info={timeAppt:timeAppt,apptInfo:response[0].appt,patient:response[0].patient,doctor:response[0].doctor,company:response[0].company,cat_id:data.cat_id,cal_id:data.cal_id,patient_id:data.patient_id,has_declaration:data.has_declaration,has_following:data.has_following,audiometric:data.audiometric,q1_4:data.q1_4,q1_4_c:data.q1_4_c,q1_5_1:data.q1_5_1,q1_5_2:data.q1_5_2,q1_5_3:data.q1_5_3,s3_q1_1_1:data.s3_q1_1_1,s3_q1_1_2:data.s3_q1_1_2,s3_q1_2_1:data.s3_q1_2_1,s3_q1_2_2:data.s3_q1_2_2,s3_q1_3:data.s3_q1_3,s3_q1_4:data.s3_q1_4,s3_q2_1_1:data.s3_q2_1_1,s3_q2_1_2:data.s3_q2_1_2,s3_q2_1_3:data.s3_q2_1_3,s3_q2_1_4:data.s3_q2_1_4,s3_q2_1_5:data.s3_q2_1_5,s3_q2_1_6:data.s3_q2_1_6,s3_q2_1_7:data.s3_q2_1_7,s3_q2_1_8:data.s3_q2_1_8,s3_q2_2_1:data.s3_q2_2_1,s3_q2_2_2:data.s3_q2_2_2,s3_q2_2_3:data.s3_q2_2_3,s3_q2_2_4:data.s3_q2_2_4,s3_q2_2_5:data.s3_q2_2_5,s3_q2_2_6:data.s3_q2_2_6,s3_q2_2_7:data.s3_q2_2_7,s3_q2_2_8:data.s3_q2_2_8,s3_q2_3:data.s3_q2_3,s3_q3_1:data.s3_q3_1,s3_q3_2:data.s3_q3_2,s3_q3_3_1:data.s3_q3_3_1,s3_q3_3_2:data.s3_q3_3_2,s3_q3_4_1:data.s3_q3_4_1,s3_q3_4_2:data.s3_q3_4_2,s3_q3_5:data.s3_q3_5,s3_q3_6:data.s3_q3_6,s3_q4:data.s3_q4,s3_q5_1_1_1:data.s3_q5_1_1_1,s3_q5_1_1_2:data.s3_q5_1_1_2,s3_q5_1_1_3:data.s3_q5_1_1_3,s3_q5_1_1_4:data.s3_q5_1_1_4,s3_q5_1_2:data.s3_q5_1_2,s3_q5_2:data.s3_q5_2,s3_q5_3:data.s3_q5_3,s3_q5_4:data.s3_q5_4,s3_q5_5:data.s3_q5_5,s3_q5_6:data.s3_q5_6,s3_q6_c:data.s3_q6_c,s3_q6_1:data.s3_q6_1,s3_q6_2_1:data.s3_q6_2_1,s3_q6_2_2:data.s3_q6_2_2,s3_q6_3_1:data.s3_q6_3_1,s3_q6_3_2:data.s3_q6_3_2,s3_q6_4_1:data.s3_q6_4_1,s3_q6_4_2:data.s3_q6_4_2,s3_q6_5_1:data.s3_q6_5_1,s3_q6_5_2:data.s3_q6_5_2,s3_q6_6_1:data.s3_q6_6_1,s3_q6_6_2:data.s3_q6_6_2,s3_q6_7_1:data.s3_q6_7_1,s3_q6_7_2:data.s3_q6_7_2,s3_q6_8_1:data.s3_q6_8_1,s3_q6_8_2:data.s3_q6_8_2,s3_q6_9_1:data.s3_q6_9_1,s3_q6_9_2:data.s3_q6_9_2,s3_q7_1:data.s3_q7_1,s3_q7_2:data.s3_q7_2,s4_c:data.s4_c,s4_1:data.s4_1,s4_2:data.s4_2,r1_1:data.r1_1,r1_2:data.r1_2,r1_3:data.r1_3,r1_4_y:data.r1_4_y,r1_5:data.r1_5,r1_6:data.r1_6,r1_7:data.r1_7,r1_8:data.r1_8,r1_8_c:data.r1_8_c,r2_1:data.r2_1,r2_2:data.r2_2,r2_2_y:data.r2_2_y,r2_3:data.r2_3,r2_4:data.r2_4,r2_5:data.r2_5,r2_6:data.r2_6,r2_7_c:data.r2_7_c,r3_1:data.r3_1,r3_2_c:data.r3_2_c,r4_1:data.r4_1,r4_2_c:data.r4_2_c,r5_1:data.r5_1,r5_2:data.r5_2,DocId:data.DocId,q1_5_3_c:data.q1_5_3_c,PATIENT_SIGNATURE:data.PATIENT_SIGNATURE,PATIENT_DATE:data.PATIENT_DATE,DOCTOR_ID:response[0].doctor.DOCTOR_ID,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.category3Form.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(category3Form){if(category3Form.$error.pattern||category3Form.$error.maxlength)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertCat3(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.category3",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editCat3(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.category3",null,{reload:!0})):"fail"===response.status?toastr.error("Update fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})})}}}}}),angular.module("app.loggedIn.document.FA.controllers",[]).controller("FAController",function($scope,$filter,$timeout,$state,ConfigService,DocumentService,$stateParams,localStorageService,$http,$cookieStore,toastr){
function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}var oriInfoH,oriInfoL,oriInfoD,oriInfoC,tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.infoH.ASSESSED_SIGN=tempSignature},$scope.clearClick=function(){$scope.infoH.ASSESSED_SIGN=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.infoH.ASSESSED_SIGN},$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,FA_ID=$stateParams.fa_id;$scope.listFA=[],$scope.infoH={},$scope.infoL={},$scope.infoS={},$scope.infoD={},$scope.infoC={},$scope.manage={},$scope.a={},$scope.total={};var rateTotal,value={},totalArr=[],age=getAge($scope.patientInfo.DOB),gender=$scope.patientInfo.Sex,val=0,sum=0,avg=0,total=0,dem=0;$scope.age=age;var date=new Date;$filter("date")(date,"ddMMyy"),$scope.rate=function(id){val=$scope.infoL.RATING_VALUE1[id],$scope.infoL.RATE1[id]=1==val?"Poor":2==val?"Fair":3==val?"Good":4==val?"Excellent":"",rateTotalFunction(id)};var rateTotalFunction=function(id){console.log("this is id",id),rateTotal=[],dem=0,console.log("this is total array",totalArr);for(var i in totalArr){total=0;for(var j in totalArr[i])"rating"!=j&&(j==id&&(totalArr[i][j]=$scope.infoL.RATING_VALUE1[id]),total+=1*totalArr[i][j]);$scope.infoL.RATING_VALUE1[i]=total,DocumentService.checkRating(totalArr[i].rating,age,gender,total).then(function(response){if("fail"!=response.status&&response.length>0){rateTotal.push(response[0].RATE),dem=0;for(var k in totalArr){for(var t=0;t<rateTotal.length;t++)t==dem&&($scope.infoL.RATE1[k]=rateTotal[t]);dem++}}else $scope.infoL.RATE1[i]=""})}};$scope.mathScore=function(idD,idL,score1,rating1,score2,rating2,type1,type2,rating_id,lineQuestion){if(1==score1)if(1==rating1){if(3==type1){sum=0,avg=0,value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])sum+=1*value[idL][i],avg++;val=sum/avg,$scope.infoL.SCORE1[idL]=val}else if(10==type1){console.log("this is idL",value[idL]);var max=0;value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])value[idL][i]>max&&(max=value[idL][i]);val=max,$scope.infoL.SCORE1[idL]=val}else 4==type1?"Recovery 1 min"===lineQuestion&&(val=$scope.infoD.VAL1_VALUE[idD]):6==type1&&(val=$scope.infoD.VAL1_VALUE[idD]);if(DocumentService.checkRating(rating_id,age,gender,val).then(function(response){console.log("this is response 1",response),"success"===response.status&&response.data.length>0?(console.log("this is response",response),$scope.infoL.RATING_VALUE1[idL]=response.data[0].VALUE,$scope.infoL.RATE1[idL]=response.data[0].RATE,console.log("this is response",response),rateTotalFunction(idL)):($scope.infoL.RATING_VALUE1[idL]=null,$scope.infoL.RATE1[idL]="",rateTotalFunction(idL))}),1==score2&&1==rating2&&3==type2){sum=0,avg=0,val=0,value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL2_VALUE[idD];for(var i in value[idL])sum+=1*value[idL][i],avg++;val=sum/avg,$scope.infoL.SCORE2[idL]=val,DocumentService.checkRating(rating_id,age,gender,val).then(function(response){"success"===response.status&&response.data.length>0?($scope.infoL.RATING_VALUE2[idL]=response.data[0].VALUE,$scope.infoL.RATE2[idL]=response.data[0].RATE):($scope.infoL.RATING_VALUE2[idL]=null,$scope.infoL.RATE2[idL]="")})}}else if(0==rating1&&9==type1){var max=0;value[idL]||(value[idL]=[]),value[idL][idD]=1*$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])value[idL][i]>max&&(max=value[idL][i]);$scope.manage[idL]=max}},$scope.infoH={PATIENT_ID:Patient_ID,CAL_ID:CalID,FA_ID:FA_ID,ENTITY_ID:null,FA_TYPE:null,FA_NAME:null,ISENABLE:null,Created_by:null,Last_updated_by:null,Risk:null,Comments:null,Recommend:null,Att_Flexibility:0,Att_Core_Stability:0,Att_Wirst_Elbow_func:0,Att_Shoulder_func:0,Att_Lower_Limb_func:0,Att_Balance:0,ASSESSED_ID:null,ASSESSED_SIGN:null,ASSESSED_DATE:null,ASSESSED_NAME:null,ITEM_ID:null},oriInfoH=angular.copy($scope.infoH),$scope.infoL={SCORE1:{},RATING_VALUE1:{},COMMENTS:{},SCORE2:{},RATING_VALUE2:{},RATE1:{},RATE2:{}},$scope.infoD={VAL1_VALUE:{},VAL1_CHECKBOX:{},VAL2_VALUE:{},VAL2_CHECKBOX:{},COMMENTS:{}},$scope.infoC.VALUE={},$scope.resetForm=function(){$scope.infoH=angular.copy(oriInfoH),$scope.infoL=angular.copy(oriInfoL),$scope.infoD=angular.copy(oriInfoD),$scope.infoC.VALUE=angular.copy(oriInfoC),$scope.FAForm.$setPristine()},$scope.infoChanged=function(){return 0==!angular.equals(oriInfoH,$scope.infoH)&&0==!angular.equals(oriInfoL,$scope.infoL)&&0==!angular.equals(oriInfoD,$scope.infoD)&&0==!angular.equals(oriInfoC,$scope.infoC.VALUE)?!1:!0};var insert=!0;DocumentService.checkFA($scope.infoH.PATIENT_ID,$scope.infoH.CAL_ID,$scope.infoH.FA_ID).then(function(response){if(console.log(response),"new"===response.status)$scope.isNew=!0,insert=!0,oriInfoH=angular.copy($scope.infoH),oriInfoL=angular.copy($scope.infoL),oriInfoD=angular.copy($scope.infoD),oriInfoC=angular.copy($scope.infoC.VALUE);else{if("update"!==response.status)return void toastr.error("Fail","Error");$scope.isNew=!1,insert=!1}var data=response.data[0],dataH=data.Header[0];data.Section,$scope.listFA.push({header_name:dataH.FA_NAME,section:[]});var i=0;angular.forEach(data.Section,function(dataS){$scope.listFA[0].section.push({section_id:dataS.SECTION_ID,section_name:dataS.SECTION_NAME,line:[]});var j=0;angular.forEach(data.Line,function(dataL){dataL.SECTION_ID==$scope.listFA[0].section[i].section_id&&($scope.listFA[0].section[i].line.push({line_id:dataL.LINE_ID,image:dataL.PICTURE,rating_id1:dataL.RATING_ID1,rating_id2:dataL.RATING_ID2,line_name:dataL.QUESTION,line_type:dataL.LineType,line_comment:dataL.IsCommentsText,line_isscore1:dataL.ISSCORE1,line_isscore2:dataL.ISSCORE2,line_israting1:dataL.ISRATING1,line_israting2:dataL.ISRATING2,score_type1:dataL.SCORE_TYPE1,score_type2:dataL.SCORE_TYPE2,detail:[],comment:[]}),0==insert&&($scope.infoL.COMMENTS[dataL.LINE_ID]=dataL.COMMENTS,$scope.infoL.SCORE1[dataL.LINE_ID]=dataL.SCORE1,$scope.infoL.SCORE2[dataL.LINE_ID]=dataL.SCORE2,$scope.infoL.RATING_VALUE1[dataL.LINE_ID]=dataL.RATING_VALUE1,$scope.infoL.RATING_VALUE2[dataL.LINE_ID]=dataL.RATING_VALUE2,$scope.infoL.RATE1[dataL.LINE_ID]=dataL.RATE1,$scope.infoL.RATE2[dataL.LINE_ID]=dataL.RATE2,value[dataL.LINE_ID]={}),angular.forEach(data.Detail,function(dataD){dataD.LINE_ID==$scope.listFA[0].section[i].line[j].line_id&&($scope.listFA[0].section[i].line[j].detail.push({detail_id:dataD.DETAIL_ID,image:dataD.PICTURE,detail_name:dataD.QUESTION,val1_yes:dataD.VAL1_ISCOMMENT_WHEN_YES,val1_no:dataD.VAL1_ISCOMMENT_WHEN_NO,val2_yes:dataD.VAL2_ISCOMMENT_WHEN_YES,val2_no:dataD.VAL2_ISCOMMENT_WHEN_NO,val1Validate:dataD.VAL1_VALUE_IS_NUMBER,val2Validate:dataD.VAL2_VALUE_IS_NUMBER,val1_name:dataD.VAL1_NAME,val2_name:dataD.VAL2_NAME,val1_isvalue:dataD.VAL1_ISVALUE,val2_isvalue:dataD.VAL2_ISVALUE,val1_ischeckbox:dataD.VAL1_ISCHECKBOX,val2_ischeckbox:dataD.VAL2_ISCHECKBOX,comment_text:dataD.IsCommentText,summary:dataD.LineTestRefer}),0==insert&&($scope.infoD.COMMENTS[dataD.DETAIL_ID]=dataD.COMMENTS,$scope.infoD.VAL1_CHECKBOX[dataD.DETAIL_ID]=dataD.VAL1_CHECKBOX,$scope.infoD.VAL2_CHECKBOX[dataD.DETAIL_ID]=dataD.VAL2_CHECKBOX,$scope.infoD.VAL2_VALUE[dataD.DETAIL_ID]=dataD.VAL2_VALUE,$scope.infoD.VAL1_VALUE[dataD.DETAIL_ID]=dataD.VAL1_VALUE,value[dataL.LINE_ID][dataD.DETAIL_ID]=[dataD.VAL1_VALUE,dataD.VAL2_VALUE],1==dataL.ISSCORE1&&0==dataL.ISRATING1&&9==dataL.SCORE_TYPE1&&$scope.mathScore(dataD.DETAIL_ID,dataL.LINE_ID,1,0,null,null,9,null,null),null!=dataD.LineTestRefer&&(totalArr[dataD.LINE_ID]||(totalArr[dataD.LINE_ID]=[]),totalArr[dataD.LINE_ID][dataD.LineTestRefer]=dataD.VAL1_VALUE,totalArr[dataD.LINE_ID].rating=dataL.RATING_ID1,rateTotalFunction(dataD.LINE_ID))))}),angular.forEach(data.Comment,function(dataC){dataC.LINE_ID==$scope.listFA[0].section[i].line[j].line_id&&($scope.listFA[0].section[i].line[j].comment.push({comment_id:dataC.FA_COMMENT_ID,comment_name:dataC.NAME,comment_type:dataC.Comment_Type}),0==insert&&($scope.infoC.VALUE[dataC.FA_COMMENT_ID]=dataC.VALUE))}),j++)}),i++}),0==insert&&($scope.infoH={PATIENT_ID:dataH.PATIENT_ID,CAL_ID:dataH.CAL_ID,FA_ID:dataH.FA_ID,ENTITY_ID:dataH.ENTITY_ID,Created_by:dataH.Created_by,Creation_date:dataH.Creation_date,Last_updated_by:dataH.Last_updated_by,Last_update_date:dataH.Last_update_date,Risk:dataH.Risk,Comments:dataH.Comments,Recommend:dataH.Recommend,Att_Flexibility:dataH.Att_Flexibility,Att_Core_Stability:dataH.Att_Core_Stability,Att_Wirst_Elbow_func:dataH.Att_Wirst_Elbow_func,Att_Shoulder_func:dataH.Att_Shoulder_func,Att_Lower_Limb_func:dataH.Att_Lower_Limb_func,Att_Balance:dataH.Att_Balance,ASSESSED_ID:dataH.ASSESSED_ID,ASSESSED_SIGN:dataH.ASSESSED_SIGN,ASSESSED_DATE:dataH.ASSESSED_DATE,ASSESSED_NAME:dataH.ASSESSED_NAME,ITEM_ID:dataH.ITEM_ID},oriInfoH=angular.copy($scope.infoH),oriInfoL=angular.copy($scope.infoL),oriInfoD=angular.copy($scope.infoD),oriInfoC=angular.copy($scope.infoC.VALUE))}),$scope.submitFA=function(FAForm){$scope.showClickedValidation=!0,FAForm.$invalid?toastr.error("Please Input All Required Information!","Error"):1==insert?(console.log($scope.infoH),console.log($scope.infoL),console.log($scope.infoD),console.log($scope.infoC),DocumentService.insertFA($scope.infoH,$scope.infoL,$scope.infoD,$scope.infoC,FA_ID).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.FA",null,{reload:!0})):toastr.error("Fail","Error")})):DocumentService.updateFA($scope.infoH,$scope.infoL,$scope.infoD,$scope.infoC).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.FA",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.MA.controllers",["fcsa-number"]).controller("MAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}$scope.dateOptions={formatYear:"yy",startingDay:1};var Patient_ID,CalID,oriInfo,clearInfo,sex,date,value;$scope.patientInfo=localStorageService.get("tempPatient"),CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id,sex=$scope.patientInfo.Sex,$scope.patientInfo.DOB=$filter("date")($scope.patientInfo.DOB,"dd/MM/yyyy"),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.MAForm.$setPristine()},$scope.clearForm=function(){$scope.info=angular.copy(clearInfo),$scope.MAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.infoClear=function(){return!angular.equals(clearInfo,$scope.info)},$scope.getColor=function(err){return $scope.showClickedValidation&&err?"red":void 0},$scope.Ratio=function(){value=$scope.info.WAIST/$scope.info.HIP,value>0&&100>value&&($scope.info.WHR=value.toFixed(2))};var weight,height;$scope.mathBMI=function(){height=$scope.info.HEIGHT,weight=$scope.info.WEIGHT,value=1e4*weight/(height*height),value=value.toFixed(1),value>0&&300>value?($scope.info.BMI=value,18.5>value?$scope.info.IS_BMI=0:value>=18.5&&24.9>=value?$scope.info.IS_BMI=1:value>=25&&29.9>=value?$scope.info.IS_BMI=2:value>=30&&($scope.info.IS_BMI=3)):($scope.info.BMI=null,$scope.info.IS_BMI=null)};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.COMMENT_SEC10=(null!=$scope.info.COMMENT_SEC4&&""!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4+"\n":"")+(null!=$scope.info.COMMENT_SEC5&&""!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5+"\n":"")+(null!=$scope.info.COMMENT_SEC6&&""!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6+"\n":"")+(null!=$scope.info.COMMENT_SEC7&&""!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7+"\n":"")+(null!=$scope.info.COMMENT_SEC8&&""!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8+"\n":"")+(null!=$scope.info.COMMENT_SEC9&&""!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9+"\n":"")+totalCom},$scope.totalComment=function(){$scope.info.COMMENT_SEC10||($scope.info.COMMENT_SEC10=(null!=$scope.info.COMMENT_SEC4&&""!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4+"\n":"")+(null!=$scope.info.COMMENT_SEC5&&""!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5+"\n":"")+(null!=$scope.info.COMMENT_SEC6&&""!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6+"\n":"")+(null!=$scope.info.COMMENT_SEC7&&""!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7+"\n":"")+(null!=$scope.info.COMMENT_SEC8&&""!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8+"\n":"")+(null!=$scope.info.COMMENT_SEC9&&""!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9+"\n":"")),len=(null!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4.length:0)+(null!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5.length:0)+(null!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6.length:0)+(null!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7.length:0)+(null!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8.length:0)+(null!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9.length:0),str=$scope.info.COMMENT_SEC10.replace("\n","");for(var i=0;5>i;i++)str=str.replace("\n","");totalCom=str.substr(len)};var insert=!0;DocumentService.checkMA(Patient_ID,CalID,$scope.patientInfo.company_id).then(function(response){"insert"===response.status?(insert=!0,$scope.isNew=!0,date=new Date,$scope.sites=response.site,$scope.info={PATIENT_ID:Patient_ID,CAL_ID:CalID,STICKER:null,HEIGHT:null,WEIGHT:null,BMI:null,WAIST:null,HIP:null,WHR:null,IS_BMI:null,BLOOD_SEC1:null,IS_BLOOD:null,RESTING_HEART_RATE:null,IS_RESTING_HEART_RATE:null,HEART_SOUNDS:null,PERIPHERAL:null,VEINS_OTHER:null,COMMENT_SEC1:null,RIGHT_DIST:null,RIGHT_DIST_CORRECT:null,LEFT_DIST:null,LEFT_DIST_CORRECT:null,RIGHT_NEAR:null,RIGHT_NEAR_CORRECT:null,LEFT_NEAR:null,LEFT_NEAR_CORRECT:null,COLOUR_SEC2:null,SCORE_SEC2:null,PERIPHERAL_SEC2:null,VISUAL_AIDS:null,COMMENT_SEC2:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,BLOOD_SUGAR_LEVEL:null,COMMENT_SEC3:null,SPIROMETRY:null,SYMMETRICAL:null,AUSCULTATION:null,EARS:null,HEARING:null,NOSE:null,THROAT:null,TEETH_GUMS:null,SKIN:null,DRUG:null,NAIL:null,SCAR:null,ABDOMEN:null,HERNIAL:null,LIVER:null,SPLEEN:null,KIDNEYS:null,BALANCE:null,COORDINATION:null,LYMPH:null,THYROID:null,COMMENT_SEC4:null,COMMENT_SEC5:null,COMMENT_SEC6:null,COMMENT_SEC7:null,COMMENT_SEC8:null,COMMENT_SEC9:"",AGE:getAge($scope.patientInfo.DOB),HYPER:0,SMOKER:0,KNOW:0,SEDENTARY:0,FAMILY:0,HISTORY:0,OBESITY:0,RISK:null,ECG:null,ECG_RESULT:null,GP:null,COMMENT_SEC10:null,DOCTOR_ID:response.docID,DOCTOR_NAME:response.docName,SIGN:response.docSign,LOCATION:null,Created_by:null,Creation_date:date,Last_updated_by:null,Last_update_date:null,DF_CODE:null,ISENABLE:null},$scope.companyName=response.nameCompany,oriInfo=angular.copy($scope.info)):"fail"===response.status?(toastr.error("Fail!","Fail"),$state.go("loggedIn.demo",null,{reload:!0})):"error"===response.status?(toastr.error("Error!","Error"),$state.go("loggedIn.demo",null,{reload:!0})):"update"===response.status&&(insert=!1,$scope.isNew=!1,$scope.companyName=response.nameCompany,$scope.sites=response.site,$scope.info=angular.copy(response.data),$scope.info.DOCTOR_NAME=response.docName,$scope.info.SIGN=response.docSign,$scope.totalComment(),oriInfo=angular.copy($scope.info)),clearInfo=1==$scope.isNew?angular.copy($scope.info):{PATIENT_ID:Patient_ID,CAL_ID:CalID,STICKER:null,HEIGHT:null,WEIGHT:null,BMI:null,WAIST:null,HIP:null,WHR:null,IS_BMI:null,BLOOD_SEC1:null,IS_BLOOD:null,RESTING_HEART_RATE:null,IS_RESTING_HEART_RATE:null,HEART_SOUNDS:null,PERIPHERAL:null,VEINS_OTHER:null,COMMENT_SEC1:null,RIGHT_DIST:null,RIGHT_DIST_CORRECT:null,LEFT_DIST:null,LEFT_DIST_CORRECT:null,RIGHT_NEAR:null,RIGHT_NEAR_CORRECT:null,LEFT_NEAR:null,LEFT_NEAR_CORRECT:null,COLOUR_SEC2:null,SCORE_SEC2:null,PERIPHERAL_SEC2:null,VISUAL_AIDS:null,COMMENT_SEC2:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,BLOOD_SUGAR_LEVEL:null,COMMENT_SEC3:null,SPIROMETRY:null,SYMMETRICAL:null,AUSCULTATION:null,EARS:null,HEARING:null,NOSE:null,THROAT:null,TEETH_GUMS:null,SKIN:null,DRUG:null,NAIL:null,SCAR:null,ABDOMEN:null,HERNIAL:null,LIVER:null,SPLEEN:null,KIDNEYS:null,BALANCE:null,COORDINATION:null,LYMPH:null,THYROID:null,COMMENT_SEC4:null,COMMENT_SEC5:null,COMMENT_SEC6:null,COMMENT_SEC7:null,COMMENT_SEC8:null,COMMENT_SEC9:"",AGE:getAge($scope.patientInfo.DOB),HYPER:0,SMOKER:0,KNOW:0,SEDENTARY:0,FAMILY:0,HISTORY:0,OBESITY:0,RISK:null,ECG:null,ECG_RESULT:null,GP:null,COMMENT_SEC10:null,DOCTOR_ID:response.docID,DOCTOR_NAME:response.docName,SIGN:response.docSign,Created_by:null,Creation_date:date,Last_updated_by:null,Last_update_date:null,DF_CODE:null,ISENABLE:null}}),$scope.submitMA=function(MAForm){$scope.showClickedValidation=!0,MAForm.$invalid?toastr.error("Please Input All Required Information!","Error"):1==insert?DocumentService.insertMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.MA",null,{reload:!0})):toastr.error("Add new fail!","Error")}):DocumentService.editMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.MA",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}),angular.module("app.loggedIn.document.IDS.controllers",[]).controller("IDSController",function($scope,$state,DocumentService,$http,$cookieStore,$stateParams,toastr,localStorageService,$state){var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.headers[0].SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.headers[0].SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.headers[0].SIGNATURE};var patientInfo=localStorageService.get("tempPatient"),Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={PATIENT_ID:Patient_ID,CAL_ID:CalID};var oriInfo,info=$scope.info;DocumentService.loadIDS(info).then(function(response){"fail"==response.status?($state.go("loggedIn.IDS",null,{reload:!0}),toastr.error("Load information fail!","Error")):"findNull"==response[0].status?$scope.isNew=!0:"findFound"==response[0].status?$scope.isNew=!1:($state.go("loggedIn.IDS",null,{reload:!0}),toastr.error("Error not status!","Error"));var data=response[0];$scope.info.headers=[],$scope.patientInfo=response[0].patient,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({IDAS_ID:dataH.IDAS_DF_ID||dataH.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,DOCTOR_ID:response[0].doctor.doctor_id,DF_CODE:dataH.DF_CODE,NAME:dataH.NAME,IDAS_DATE:dataH.IDAS_DATE||new Date,Temperature:dataH.Temperature,Creatinine:dataH.Creatinine,Drug_Test_Time:dataH.Drug_Test_Time,Expiry_Date:dataH.Expiry_Date||new Date,Notes:dataH.Notes,Alcohol_Test_Time:dataH.Alcohol_Test_Time,Reading:dataH.Reading,Positive_Negative:dataH.Positive_Negative,Reading2:dataH.Reading2,ITEM_ID:dataH.ITEM_ID,Created_by:dataH.Created_by,Last_updated_by:dataH.Last_updated_by,NAME_COMMENT:dataH.NAME_COMMENT,ISENABLE:dataH.ISENABLE,SIGNATURE:dataH.SIGNATURE,TesterName:response[0].doctor.NAME,TesterSign:response[0].doctor.Signature,TesterDate:dataH.TesterDate||new Date,groups:[]});var i=0;angular.forEach(data.groups,function(dataG,gIndex){($scope.info.headers[hIndex].IDAS_ID==dataG.IDAS_ID||$scope.info.headers[hIndex].IDAS_ID==dataG.IDAS_DF_ID)&&($scope.info.headers[hIndex].groups.push({IDAS_GROUP_ID:dataG.IDAS_GROUP_ID,IDAS_ID:dataG.IDAS_DF_ID||dataG.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,ORD:dataG.ORD,GROUP_NAME:dataG.GROUP_NAME,USER_TYPE:dataG.USER_TYPE,Created_by:dataG.Created_by,Last_updated_by:dataG.Last_updated_by,ISENABLE:dataG.ISENABLE,lines:[]}),angular.forEach(data.lines,function(dataL,lIndex){$scope.info.headers[hIndex].groups[i].IDAS_GROUP_ID==dataL.IDAS_GROUP_ID&&$scope.info.headers[hIndex].groups[i].lines.push({IDAS_LINE_ID:dataL.IDAS_LINE_ID,IDAS_GROUP_ID:dataL.IDAS_GROUP_ID,IDAS_ID:dataL.IDAS_DF_ID||dataL.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,ORD:dataL.ORD,QUESTION:dataL.QUESTION,YES_NO:dataL.YES_NO,Created_by:dataL.Created_by,Last_updated_by:dataL.Last_updated_by,ISENABLE:dataL.ISENABLE})}),i++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mhForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submitIDS=function(IDSForm){var info=$scope.info;IDSForm.$error.required||IDSForm.$error.maxlength||IDSForm.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertIDS(info).then(function(response){"success"==response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.IDS",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.updateIDS(info).then(function(response){"success"==response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.IDS",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}),angular.module("app.loggedIn.document.MH.controllers",[]).controller("MHController",function($scope,DocumentService,$http,$cookieStore,toastr,$state,localStorageService,$stateParams){var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!");else{$scope.today=new Date,$scope.info=[];var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.dec_signed=tempSignature},$scope.clearClick=function(){$scope.info.dec_signed=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.dec_signed};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.rmi_signed_witness=tempSignature1},$scope.clearClick1=function(){$scope.info.rmi_signed_witness=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.rmi_signed_witness};var tempSignature2;$scope.isSignature2=!1,$scope.showSignature2=function(){$scope.isSignature2=!$scope.isSignature2},$scope.cancelClick2=function(){$scope.isSignature2=!$scope.isSignature2,$scope.info.dec_signed_witness=tempSignature2},$scope.clearClick2=function(){$scope.info.dec_signed_witness=""},$scope.okClick2=function(){$scope.isSignature2=!$scope.isSignature2,tempSignature2=$scope.info.dec_signed_witness},$scope.info.Date=new Date,$scope.info.Statement_Date=new Date;var tempPatient=localStorageService.get("tempPatient")||[];if(null==tempPatient||"undefined"===tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={patient_id:patient_id,cal_id:cal_id};var oriInfo,clearInfo,clearWorks,clearMedications,medications=[{col1:null,col2:null,col3:null,stt:!0}],works=[{col1:null,col2:null,col3:null,col4:null,stt:!0}];clearWorks=works,clearMedications=medications;var info=$scope.info;DocumentService.loadMH(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.count_sec2=0,$scope.count_sec3=0;else if("findFound"===response[0].status){$scope.isNew=!1;var dataTemp=response[0].data;works=[{col1:dataTemp.s2_occupation1||null,col2:dataTemp.s2_startdate1||null,col3:dataTemp.s2_enddate1||null,col4:dataTemp.s2_employ1||null,stt:null==dataTemp.s2_occupation1?!1:!0},{col1:dataTemp.s2_occupation2||null,col2:dataTemp.s2_startdate2||null,col3:dataTemp.s2_enddate2||null,col4:dataTemp.s2_employ2||null,stt:null==dataTemp.s2_occupation2?!1:!0},{col1:dataTemp.s2_occupation3||null,col2:dataTemp.s2_startdate3||null,col3:dataTemp.s2_enddate3||null,col4:dataTemp.s2_employ3||null,stt:null==dataTemp.s2_occupation3?!1:!0},{col1:dataTemp.s2_occupation4||null,col2:dataTemp.s2_startdate4||null,col3:dataTemp.s2_enddate4||null,col4:dataTemp.s2_employ4||null,stt:null==dataTemp.s2_occupation4?!1:!0},{col1:dataTemp.s2_occupation5||null,col2:dataTemp.s2_startdate5||null,col3:dataTemp.s2_enddate5||null,col4:dataTemp.s2_employ5||null,stt:null==dataTemp.s2_occupation5?!1:!0}],medications=[{col1:dataTemp.s3_name1||null,col2:dataTemp.s3_reason1||null,col3:dataTemp.s3_regularly1,stt:null==dataTemp.s3_name1?!1:!0},{col1:dataTemp.s3_name2||null,col2:dataTemp.s3_reason2||null,col3:dataTemp.s3_regularly2,stt:null==dataTemp.s3_name2?!1:!0},{col1:dataTemp.s3_name3||null,col2:dataTemp.s3_reason3||null,col3:dataTemp.s3_regularly3,stt:null==dataTemp.s3_name3?!1:!0},{col1:dataTemp.s3_name4||null,col2:dataTemp.s3_reason4||null,col3:dataTemp.s3_regularly4,stt:null==dataTemp.s3_name4?!1:!0},{col1:dataTemp.s3_name5||null,col2:dataTemp.s3_reason5||null,col3:dataTemp.s3_regularly5,stt:null==dataTemp.s3_name5?!1:!0},{col1:dataTemp.s3_name6||null,col2:dataTemp.s3_reason6||null,col3:dataTemp.s3_regularly6,stt:null==dataTemp.s3_name6?!1:!0}];for(var i=0;i<=works.length-1;i++)0==works[i].stt&&(works.splice(i,1),i--);for(var j=0;j<=medications.length-1;j++)0==medications[j].stt&&(medications.splice(j,1),j--);$scope.count_sec2=works.length-1,$scope.count_sec3=medications.length-1}else $state.go("loggedIn.home",null,{reload:!0});var data=response[0].data;$scope.info={mh_id:data.mh_id||null,patient_id:patient_id,cal_id:cal_id,s1_relationship:data.s1_relationship||null,s1_job_location:data.s1_job_location||null,s2_occupation1:data.s2_occupation1||null,s2_startdate1:data.s2_startdate1||null,s2_enddate1:data.s2_enddate1||null,s2_employ1:data.s2_employ1||null,s2_occupation2:data.s2_occupation2||null,s2_startdate2:data.s2_startdate2||null,s2_enddate2:data.s2_enddate2||null,s2_employ2:data.s2_employ2||null,s2_occupation3:data.s2_occupation3||null,s2_startdate3:data.s2_startdate3||null,s2_enddate3:data.s2_enddate3||null,s2_employ3:data.s2_employ3||null,s2_occupation4:data.s2_occupation4||null,s2_startdate4:data.s2_startdate4||null,s2_enddate4:data.s2_enddate4||null,s2_employ4:data.s2_employ4||null,s2_occupation5:data.s2_occupation5||null,s2_startdate5:data.s2_startdate5||null,s2_enddate5:data.s2_enddate5||null,s2_employ5:data.s2_employ5||null,s2_samework:data.s2_samework||null,s2_sameworkenvironment:data.s2_sameworkenvironment||null,s2_comments:data.s2_comments||null,s3_name1:data.s3_name1||null,s3_reason1:data.s3_reason1||null,s3_regularly1:data.s3_regularly1||null,s3_name2:data.s3_name2||null,s3_reason2:data.s3_reason2||null,s3_regularly2:data.s3_regularly2||null,s3_name3:data.s3_name3||null,s3_reason3:data.s3_reason3||null,s3_regularly3:data.s3_regularly3||null,s3_name4:data.s3_name4||null,s3_reason4:data.s3_reason4||null,s3_regularly4:data.s3_regularly4||null,s3_name5:data.s3_name5||null,s3_reason5:data.s3_reason5||null,s3_regular5:data.s3_regularly5||null,s3_comments:data.s3_comments||null,s4_concerning:data.s4_concerning||null,s4_weight_altered:data.s4_weight_altered||null,s4_medicaltreatment:data.s4_medicaltreatment||null,s4_hospital:data.s4_hospital||null,s4_stranfustion:data.s4_stranfustion||null,s4_diabetes:data.s4_diabetes||null,s4_pressure:data.s4_pressure||null,s4_asthma:data.s4_asthma||null,s4_emphysema:data.s4_emphysema||null,s4_veins:data.s4_veins||null,s4_epilepsy:data.s4_epilepsy||null,s4_episodes:data.s4_episodes||null,s4_cancer_or_tumour:data.s4_cancer_or_tumour||null,s4_concussion_or_headinjury:data.s4_concussion_or_headinjury||null,s4_migraine:data.s4_migraine||null,s4_eczema:data.s4_eczema||null,s4_hepatitis:data.s4_hepatitis||null,s4_desease:data.s4_desease||null,s4_hormonal:data.s4_hormonal||null,s4_allergies:data.s4_allergies||null,s4_comments:data.s4_comments||null,s5_disease:data.s5_disease||null,s5_claim:data.s5_claim||null,s5_claim_comment:data.s5_claim_comment||null,s5_lodged:data.s5_lodged||null,s5_closed:data.s5_closed||null,s5_duties:data.s5_duties||null,s5_sickness:data.s5_sickness||null,s5_equipment:data.s5_equipment||null,s5_chermicals:data.s5_chermicals||null,s5_noise:data.s5_noise||null,s5_radiation:data.s5_radiation||null,s5_dust:data.s5_dust||null,s5_asbestos:data.s5_asbestos||null,s5_solvents:data.s5_solvents||null,s5_other:data.s5_other||null,s5_comments:data.s5_comments||null,s6_neck:data.s6_neck||null,s6_shoulder:data.s6_shoulder||null,s6_elbow:data.s6_elbow||null,s6_wrist_or_hand:data.s6_wrist_or_hand||null,s6_lower_black:data.s6_lower_black||null,s6_hip:data.s6_hip||null,s6_knee:data.s6_knee||null,s6_ankle_or_foot:data.s6_ankle_or_foot||null,s6_comments1:data.s6_comments1||null,s6_cervical:data.s6_cervical||null,s6_lower:data.s6_lower||null,s6_sciatica:data.s6_sciatica||null,s6_pins_needles:data.s6_pins_needles||null,s6_muscle_aches_pains:data.s6_muscle_aches_pains||null,s6_joint_aches_pains:data.s6_joint_aches_pains||null,s6_comments2:data.s6_comments2||null,s6_rsi:data.s6_rsi||null,s6_tennis:data.s6_tennis||null,s6_carpal:data.s6_carpal||null,s6_hernia:data.s6_hernia||null,s6_osteoarthritis:data.s6_osteoarthritis||null,s6_arthritis:data.s6_arthritis||null,s6_osteoporosis:data.s6_osteoporosis||null,s6_fibromyalgia:data.s6_fibromyalgia||null,s6_fractured_bones:data.s6_fractured_bones||null,s6_affects:data.s6_affects||null,s6_joint_or_bones:data.s6_joint_or_bones||null,s6_comments3:data.s6_comments3||null,s7_directfamily:data.s7_directfamily||null,s7_undergone:data.s7_undergone||null,s7_conditions:data.s7_conditions||null,s7_disease:data.s7_disease||null,s7_murmurs:data.s7_murmurs||null,s7_palpitations:data.s7_palpitations||null,s7_angina:data.s7_angina||null,s7_blood_presure:data.s7_blood_presure||null,s7_comments:data.s7_comments||null,s8_exercise:data.s8_exercise||null,s8_asthma:data.s8_asthma||null,s8_emphysema:data.s8_emphysema||null,s8_hay_fever:data.s8_hay_fever||null,s8_tuberculosis:data.s8_tuberculosis||null,s8_obstructive:data.s8_obstructive||null,s8_rheumatic_fever:data.s8_rheumatic_fever||null,s8_bronchitis:data.s8_bronchitis||null,s8_coughed_blood:data.s8_coughed_blood||null,s8_shortness:data.s8_shortness||null,s8_comments:data.s8_comments||null,s9_hearing:data.s9_hearing||null,s9_infections_or_discharge:data.s9_infections_or_discharge||null,s9_hearing_aid:data.s9_hearing_aid||null,s9_injury_or_condition:data.s9_injury_or_condition||null,s9_near_or_distance:data.s9_near_or_distance||null,s9_color_blind:data.s9_color_blind||null,s9_eyes_or_ears:data.s9_eyes_or_ears||null,s9_comments:data.s9_comments||null,s10_indigestion:data.s10_indigestion||null,s10_vomited_blood:data.s10_vomited_blood||null,s10_bowel_habit:data.s10_bowel_habit||null,s10_time_you_urinate:data.s10_time_you_urinate||null,s10_night_to_urinate:data.s10_night_to_urinate||null,s10_start_stop_urine:data.s10_start_stop_urine||null,s10_change_urine:data.s10_change_urine||null,s10_comments:data.s10_comments||null,s11_medicaltion_or_counselling:data.s11_medicaltion_or_counselling||null,s11_psychologist_or_psychiatrist:data.s11_psychologist_or_psychiatrist||null,s11_sleeping_tablets:data.s11_sleeping_tablets||null,s11_drug_or_alcohol:data.s11_drug_or_alcohol||null,s11_depression:data.s11_depression||null,s11_panic:data.s11_panic||null,s11_anxiety:data.s11_anxiety||null,s11_insomnia:data.s11_insomnia||null,s11_any_condition:data.s11_any_condition||null,s11_comments:data.s11_comments||null,
s12_narcolepsy:data.s12_narcolepsy||null,s12_exhaustion:data.s12_exhaustion||null,s12_shift_work:data.s12_shift_work||null,s12_environment:data.s12_environment||null,s12_very_hot_environment:data.s12_very_hot_environment||null,s12_illness:data.s12_illness||null,s12_sweat:data.s12_sweat||null,s12_hormonal:data.s12_hormonal||null,s12_stones_or_renal:data.s12_stones_or_renal||null,s12_comments:data.s12_comments||null,s13_ever_smoked:data.s13_ever_smoked||null,s13_each_date:data.s13_each_date||null,s13_one_date:data.s13_one_date||null,s13_many_cigarettes:data.s13_many_cigarettes||null,s13_start_stop_smoked:data.s13_start_stop_smoked||null,s13_exercise:data.s13_exercise||null,s13_aspect:data.s13_aspect||null,s13_comments:data.s13_comments||null,s14_tetanus:data.s14_tetanus||null,s14_helpa_helpb:data.s14_helpa_helpb||null,s14_comments:data.s14_comments||null,rmi_physical:data.rmi_physical||null,rmi_physical_initials:data.rmi_physical_initials||null,rmi_mental:data.rmi_mental||null,rmi_mental_initials:data.rmi_mental_initials||null,rmi_date:data.rmi_date||new Date,rmi_witness:data.rmi_witness||null,rmi_signed_witness:data.rmi_signed_witness||null,dec_signed:data.dec_signed||null,dec_witness:data.dec_witness||null,dec_signed_witness:data.dec_signed_witness||null,dec_date:data.dec_date||new Date,doctor_id:response[0].doctor.doctor_id||null,created_by:data.created_by||null,last_updated_by:data.last_updated_by||null,patient:response[0].patient||[],doctor:response[0].doctor||[],company:response[0].company||[],works:works||[],medications:medications||[]},oriInfo=angular.copy($scope.info),$scope.isNew?($scope.info.created_by=userInfo.id,clearInfo=angular.copy($scope.info)):($scope.info.last_updated_by=userInfo.id,clearInfo={mh_id:$scope.info.mh_id||null,patient_id:patient_id,cal_id:cal_id,s1_relationship:null,s1_job_location:null,s2_occupation1:null,s2_startdate1:null,s2_enddate1:null,s2_employ1:null,s2_occupation2:null,s2_startdate2:null,s2_enddate2:null,s2_employ2:null,s2_occupation3:null,s2_startdate3:null,s2_enddate3:null,s2_employ3:null,s2_occupation4:null,s2_startdate4:null,s2_enddate4:null,s2_employ4:null,s2_occupation5:null,s2_startdate5:null,s2_enddate5:null,s2_employ5:null,s2_samework:null,s2_sameworkenvironment:null,s2_comments:null,s3_name1:null,s3_reason1:null,s3_regularly1:null,s3_name2:null,s3_reason2:null,s3_regularly2:null,s3_name3:null,s3_reason3:null,s3_regularly3:null,s3_name4:null,s3_reason4:null,s3_regularly4:null,s3_name5:null,s3_reason5:null,s3_regular5:null,s3_comments:null,s4_concerning:null,s4_weight_altered:null,s4_medicaltreatment:null,s4_hospital:null,s4_stranfustion:null,s4_diabetes:null,s4_pressure:null,s4_asthma:null,s4_emphysema:null,s4_veins:null,s4_epilepsy:null,s4_episodes:null,s4_cancer_or_tumour:null,s4_concussion_or_headinjury:null,s4_migraine:null,s4_eczema:null,s4_hepatitis:null,s4_desease:null,s4_hormonal:null,s4_allergies:null,s4_comments:null,s5_disease:null,s5_claim:null,s5_claim_comment:null,s5_lodged:null,s5_closed:null,s5_duties:null,s5_sickness:null,s5_equipment:null,s5_chermicals:null,s5_noise:null,s5_radiation:null,s5_dust:null,s5_asbestos:null,s5_solvents:null,s5_other:null,s5_comments:null,s6_neck:null,s6_shoulder:null,s6_elbow:null,s6_wrist_or_hand:null,s6_lower_black:null,s6_hip:null,s6_knee:null,s6_ankle_or_foot:null,s6_comments1:null,s6_cervical:null,s6_lower:null,s6_sciatica:null,s6_pins_needles:null,s6_muscle_aches_pains:null,s6_joint_aches_pains:null,s6_comments2:null,s6_rsi:null,s6_tennis:null,s6_carpal:null,s6_hernia:null,s6_osteoarthritis:null,s6_arthritis:null,s6_osteoporosis:null,s6_fibromyalgia:null,s6_fractured_bones:null,s6_affects:null,s6_joint_or_bones:null,s6_comments3:null,s7_directfamily:null,s7_undergone:null,s7_conditions:null,s7_disease:null,s7_murmurs:null,s7_palpitations:null,s7_angina:null,s7_blood_presure:null,s7_comments:null,s8_exercise:null,s8_asthma:null,s8_emphysema:null,s8_hay_fever:null,s8_tuberculosis:null,s8_obstructive:null,s8_disease:null,s8_rheumatic_fever:null,s8_bronchitis:null,s8_coughed_blood:null,s8_shortness:null,s8_comments:null,s9_hearing:null,s9_infections_or_discharge:null,s9_hearing_aid:null,s9_injury_or_condition:null,s9_near_or_distance:null,s9_color_blind:null,s9_eyes_or_ears:null,s9_comments:null,s10_indigestion:null,s10_vomited_blood:null,s10_bowel_habit:null,s10_time_you_urinate:null,s10_night_to_urinate:null,s10_start_stop_urine:null,s10_change_urine:null,s10_comments:null,s11_medicaltion_or_counselling:null,s11_psychologist_or_psychiatrist:null,s11_sleeping_tablets:null,s11_drug_or_alcohol:null,s11_depression:null,s11_panic:null,s11_anxiety:null,s11_insomnia:null,s11_any_condition:null,s11_comments:null,s12_narcolepsy:null,s12_exhaustion:null,s12_shift_work:null,s12_environment:null,s12_very_hot_environment:null,s12_illness:null,s12_sweat:null,s12_hormonal:null,s12_stones_or_renal:null,s12_comments:null,s13_ever_smoked:null,s13_many_cigarettes:null,s13_start_stop_smoked:null,s13_exercise:null,s13_aspect:null,s13_comments:null,s14_tetanus:null,s14_helpa_helpb:null,s14_comments:null,rmi_physical:null,rmi_physical_initials:null,rmi_mental:null,rmi_mental_initials:null,rmi_date:new Date,rmi_witness:null,rmi_signed_witness:null,dec_signed:null,dec_witness:null,dec_signed_witness:null,dec_date:new Date,doctor_id:null,created_by:null,last_updated_by:null,patient:$scope.info.patient||[],doctor:$scope.info.doctor||[],company:$scope.info.company||[],works:clearWorks,medications:clearMedications})}),$scope.add_sec2=function(){$scope.count_sec2<4&&($scope.info.works.push({col1:null,col2:null,col3:null,col4:null,stt:!0}),++$scope.count_sec2)},$scope.del_sec2=function(index){$scope.info.works.splice(index,1),--$scope.count_sec2},$scope.add_sec3=function(){$scope.count_sec3<5&&($scope.info.medications.push({col1:null,col2:null,col3:null,stt:!0}),++$scope.count_sec3)},$scope.del_sec3=function(index){$scope.info.medications.splice(index,1),--$scope.count_sec3},$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mhForm.$setPristine()},$scope.maxDate=new Date,$scope.clearForm=function(){$scope.info=angular.copy(clearInfo),$scope.mhForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.infoClear=function(){return!angular.equals(clearInfo,$scope.info)},$scope.submit=function(mhForm){if(mhForm.$error.required||mhForm.$error.maxlength||mhForm.$error.pattern)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew?DocumentService.insertMH(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.MH",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):DocumentService.editMH(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.MH",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}}),angular.module("app.loggedIn.document.MRS.controllers",[]).controller("MRSController",function($filter,$scope,DocumentService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.MRS",null,{reload:!0});else{var tempSignature;if($scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.practitionSign=tempSignature},$scope.clearClick=function(){$scope.info.practitionSign=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.practitionSign},$scope.patientInfo=localStorageService.get("tempPatient"),null===$scope.patientInfo||"undefined"===$scope.patientInfo)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, Please try again","Error");else{var patient_id=$scope.patientInfo.Patient_id,cal_id=$stateParams.cal_id;$scope.patientInfo.DOB=$filter("date")($scope.patientInfo.DOB,"dd/MM/yyyy"),$scope.info={patient_id:patient_id,cal_id:cal_id,idC:$scope.patientInfo.company_id};var oriInfo,info=$scope.info;DocumentService.loadMRS(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.MRS",null,{raw:!0});else{if("not"==response.status)return toastr.error("You have to make Medical Assessment first","Error"),void $state.go("loggedIn.MA",null,{reload:!0});"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1)}if("findFound"===response[0].status||"findNull"===response[0].status){var data=response[0].data;$scope.companyName=response[0].nameCompany,$scope.patient=response[0].patient,$scope.doctor=response[0].doctor,$scope.appt=response[0].appt,$scope.info={mrs_id:data.mrs_id,patient_id:patient_id,cal_id:cal_id,sticker_here:data.sticker_here,proposed:data.proposed,as_height:response[0].dataMA.HEIGHT,as_weight:response[0].dataMA.WEIGHT,as_whr:response[0].dataMA.WHR,as_bmi:response[0].dataMA.BMI,as_height_weight:data.as_height_weight,as_medical_history:data.as_medical_history,as_medical_assessment:data.as_medical_assessment,as_functional_assessment:data.as_functional_assessment,as_hearing_test:data.as_hearing_test,as_spirometry:data.as_spirometry,as_drug_test:data.as_drug_test,as_other:data.as_other,ac_any_existing_or_active:data.ac_any_existing_or_active,ac_any_history:data.ac_any_history,ac_cardiovascular:data.ac_cardiovascular,ac_any_current_or_work_related:data.ac_any_current_or_work_related,ac_any_medical_or_functional:data.ac_any_medical_or_functional,ac_any_diagnosed_or_previous:data.ac_any_diagnosed_or_previous,ac_examiner_comment:data.ac_examiner_comment,risk_rating:data.risk_rating,rr_amber_comment:data.rr_amber_comment,rr_red_comment:data.rr_red_comment,mrs_review:data.mrs_review,mrs_doc_date:data.mrs_doc_date||new Date,doctor_id:$scope.doctor.doctor_id,created_by:$scope.isNew?userInfo.id:data.created_by,last_updated_by:$scope.isNew?data.last_updated_by:userInfo.id}}oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mrsForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(mrsForm){if(mrsForm.$error.pattern||mrsForm.$error.maxlength||mrsForm.$error.required)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertMRS(info).then(function(response){"fail"===response.status?toastr.error("Add new fail","Error"):"success"===response.status?(toastr.success("Add new success","Success"),$state.go("loggedIn.MRS",null,{reload:!0})):$state.go("loggedIn.MRS",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editMRS(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status&&(toastr.success("Update success!","Success"),$state.go("loggedIn.MRS",null,{reload:!0}))})}}}}}),angular.module("app.loggedIn.document.SA1.controllers",[]).controller("SA1Controller",function($scope,$state,DocumentService,$http,$cookieStore,toastr,$stateParams,localStorageService){$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date,$scope.info=[];var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.SA1",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var oriInfo;$scope.info={patient_id:Patient_ID,CAL_ID:CalID};var info=$scope.info;DocumentService.loadSA1(info).then(function(response){"fail"===response.status?$state.go("loggedIn.home",null,{reload:!0}):"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1);var data=response[0];$scope.info.headers=[],$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.appt=response[0].appt,$scope.info.site=response[0].site,$scope.info.company=response[0].company,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({patient_id:Patient_ID,CAL_ID:CalID,SA_ID:dataH.SA_ID,SA_NAME:dataH.SA_NAME,ISENABLE:dataH.ISENABLE,SA_CODE:dataH.SA_CODE,test_date:dataH.test_date||new Date,tester:dataH.tester||(null!==$scope.info.doctor.Title&&""!==$scope.info.doctor.Title?$scope.info.doctor.Title+" ":"")+(null!==$scope.info.doctor.First_name&&""!==$scope.info.doctor.First_name?$scope.info.doctor.First_name+" ":"")+(null!==$scope.info.doctor.Sur_name&&""!==$scope.info.doctor.Sur_name?$scope.info.doctor.Sur_name+" ":""),report_type:dataH.report_type,RECIPIENT_NAME:dataH.RECIPIENT_NAME,DOCTOR_ID:dataH.DOCTOR_ID||response[0].doctor.doctor_id,Signature:dataH.Signature,LOCATION_ID:dataH.LOCATION_ID,Created_by:$scope.isNew?userInfo.id:dataH.Created_by,Last_updated_by:$scope.isNew?dataH.Last_updated_by:userInfo.id,sections:[]}),$scope.info.Signature=$scope.info.headers[hIndex].Signature,$scope.info.test_date=$scope.info.headers[hIndex].test_date,$scope.info.RECIPIENT_NAME=$scope.info.headers[hIndex].RECIPIENT_NAME,$scope.info.tester=$scope.info.headers[hIndex].tester;var j=0;angular.forEach(data.sections,function(dataS){$scope.info.headers[hIndex].SA_ID===dataS.SA_ID&&($scope.info.headers[hIndex].sections.push({patient_id:Patient_ID,CAL_ID:CalID,SECTION_ID:dataS.SECTION_ID,SA_ID:dataS.SA_ID,SECTION_NAME:dataS.SECTION_NAME,ORD:dataS.ORD,USER_TYPE:dataS.USER_TYPE,ISENABLE:dataS.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataS.Created_by,Last_updated_by:$scope.isNew?dataS.Last_updated_by:userInfo.id,lines:[]}),angular.forEach(data.lines,function(dataL){$scope.info.headers[hIndex].sections[j].SECTION_ID===dataL.SECTION_ID&&$scope.info.headers[hIndex].sections[j].lines.push({patient_id:Patient_ID,CAL_ID:CalID,LINE_ID:dataL.LINE_ID,SECTION_ID:dataL.SECTION_ID,SA_ID:dataL.SA_ID,NAME:dataL.NAME||dataL.Name,VALUE_RIGHT:dataL.VALUE_RIGHT,VALUE_LEFT:dataL.VALUE_LEFT,ISENABLE:dataL.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataL.Created_by,Last_updated_by:$scope.isNew?dataL.Last_updated_by:userInfo.id})}),j++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.SA1.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(SA1){var info=$scope.info;SA1.$error.required||SA1.$error.maxlength||SA1.$error.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertSA1(info).then(function(response){"fail"===response.status?toastr.error("Add fail!","Error"):"success"===response.status?(toastr.success("Add success!","Success"),$state.go("loggedIn.SA1",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editSA1(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.SA1",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})})}}}),angular.module("app.loggedIn.document.SA2.controllers",[]).controller("SA2Controller",function($scope,$state,DocumentService,$http,$cookieStore,toastr,$stateParams,localStorageService){$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date,$scope.info=[];var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.SA1",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var oriInfo;$scope.info={patient_id:Patient_ID,CAL_ID:CalID};var info=$scope.info;DocumentService.loadSA2(info).then(function(response){"fail"===response.status?$state.go("loggedIn.home",null,{reload:!0}):"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1);var data=response[0];$scope.info.headers=[],$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.appt=response[0].appt,$scope.info.site=response[0].site,$scope.info.company=response[0].company,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({patient_id:Patient_ID,CAL_ID:CalID,SA_ID:dataH.SA_ID,SA_NAME:dataH.SA_NAME,ISENABLE:dataH.ISENABLE,SA_CODE:dataH.SA_CODE,test_date:dataH.test_date||new Date,tester:dataH.tester,report_type:dataH.report_type,RECIPIENT_NAME:dataH.RECIPIENT_NAME,DOCTOR_ID:dataH.DOCTOR_ID||response[0].doctor.doctor_id,Signature:dataH.Signature,LOCATION_ID:dataH.LOCATION_ID,Created_by:$scope.isNew?userInfo.id:dataH.Created_by,Last_updated_by:$scope.isNew?dataH.Last_updated_by:userInfo.id,sections:[]}),$scope.info.Signature=$scope.info.headers[hIndex].Signature,$scope.info.test_date=$scope.info.headers[hIndex].test_date,$scope.info.RECIPIENT_NAME=$scope.info.headers[hIndex].RECIPIENT_NAME,$scope.info.tester=$scope.info.headers[hIndex].tester;var j=0;angular.forEach(data.sections,function(dataS){$scope.info.headers[hIndex].SA_ID===dataS.SA_ID&&($scope.info.headers[hIndex].sections.push({patient_id:Patient_ID,CAL_ID:CalID,SECTION_ID:dataS.SECTION_ID,SA_ID:dataS.SA_ID,SECTION_NAME:dataS.SECTION_NAME,ORD:dataS.ORD,USER_TYPE:dataS.USER_TYPE,ISENABLE:dataS.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataS.Created_by,Last_updated_by:$scope.isNew?dataS.Last_updated_by:userInfo.id,lines:[]}),angular.forEach(data.lines,function(dataL){$scope.info.headers[hIndex].sections[j].SECTION_ID===dataL.SECTION_ID&&$scope.info.headers[hIndex].sections[j].lines.push({patient_id:Patient_ID,CAL_ID:CalID,LINE_ID:dataL.LINE_ID,SECTION_ID:dataL.SECTION_ID,SA_ID:dataL.SA_ID,NAME:dataL.NAME||dataL.Name,VALUE_RIGHT:dataL.VALUE_RIGHT,VALUE_LEFT:dataL.VALUE_LEFT,ISENABLE:dataL.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataL.Created_by,Last_updated_by:$scope.isNew?dataL.Last_updated_by:userInfo.id})}),j++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.SA2.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(SA2){var info=$scope.info;SA2.$error.required||SA2.$error.maxlength||SA2.$error.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertSA2(info).then(function(response){"fail"===response.status?toastr.error("Add fail!","Error"):"success"===response.status?(toastr.success("Add success!","Success"),$state.go("loggedIn.SA2",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editSA2(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.SA2",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})})}}}),angular.module("app.loggedIn.document.form18.controllers",[]).controller("form18Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist"),$state.go("loggedIn.home",null,{reload:!0});else{$scope.today=new Date;var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.PERSON_ARRANGING_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.PERSON_ARRANGING_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.PERSON_ARRANGING_SIGNATURE};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.WORKER_SIGNATURE=tempSignature1},$scope.clearClick1=function(){$scope.info.WORKER_SIGNATURE=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.WORKER_SIGNATURE};var patientInfo=localStorageService.get("tempPatient");if(null==patientInfo||"undefined"==patientInfo)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load some information fail, please try again!","Error");else{var Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={GORGON_ID:null,PATIENT_ID:Patient_ID,CAL_ID:CalID,DocId:null,TIME_TEST:new Date,WORK_COVER_NO:null,PERSON_ARRANGING_SIGNATURE:null,PERSON_ARRANGING_NAME:null,PERSON_ARRANGING_POSITION:null,DOCTOR_ID:null,WORKER_SIGNATURE:null};var oriInfo,info=$scope.info;DocumentService.loadForm18(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.demo",null,{reload:!0}),toastr.error("Load information fail, Please try again!","Error");else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.APPT=response[0].APPT,$scope.info.rmSite=response[0].rmSite,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].dataF18;$scope.info={doctorInfo:response[0].doctor,apptInfo:response[0].APPT,patient:response[0].patient,doctor:response[0].doctor,APPT:response[0].APPT,rmSite:response[0].rmSite,company:response[0].company,GORGON_ID:data.GORGON_ID,PATIENT_ID:data.PATIENT_ID,CAL_ID:data.CAL_ID,DocId:data.DocId,TIME_TEST:data.TIME_TEST,WORK_COVER_NO:data.WORK_COVER_NO,PERSON_ARRANGING_SIGNATURE:data.PERSON_ARRANGING_SIGNATURE,PERSON_ARRANGING_NAME:data.PERSON_ARRANGING_NAME,PERSON_ARRANGING_POSITION:data.PERSON_ARRANGING_POSITION,DOCTOR_ID:response[0].doctor.DOCTOR_ID,WORKER_SIGNATURE:data.WORKER_SIGNATURE,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.form18.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(form18){if(form18.$error.maxlength||form18.$error.required||form18.$error.pattern)toastr.error("Please Input All Required Information!","Success");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertForm18(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.Form18",null,{reload:!0})):"fail"===response.status?toastr.error("Add new fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editForm18(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.Form18",null,{reload:!0})):"fail"===response.status?toastr.error("Update fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})})}}}}}),angular.module("app.loggedIn.document.gorgonFA.controllers",[]).controller("gorgonFAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$window,$stateParams,localStorageService){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}var tempSignature,oriInfo;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.fsign=tempSignature},$scope.clearClick=function(){$scope.info.fsign=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.fsign},$scope.dateOptions={formatYear:"yy",startingDay:1};var date=new Date;$filter("date")(date,"dd/MM/yyyy"),$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,sex=$scope.patientInfo.Sex;$scope.print=function(){$window.location.href="/api/document/gorgonFA/print/7"};var value;$scope.grip=function(){value=0,$scope.info.c_Right3>0||$scope.info.c_Left3>0?(1*$scope.info.c_Right3>=$scope.info.c_Left3?value=$scope.info.c_Right3:1*$scope.info.c_Right3<$scope.info.c_Left3&&(value=$scope.info.c_Left3),"Male"==sex?40>value?$scope.info.c_Result3=1:value>=40&&45>=value?$scope.info.c_Result3=2:value>=46&&51>=value?$scope.info.c_Result3=3:value>=52&&55>=value?$scope.info.c_Result3=4:value>55&&($scope.info.c_Result3=5):"Female"==sex&&(23>value?$scope.info.c_Result3=1:value>=23&&26>=value?$scope.info.c_Result3=2:value>=27&&29>=value?$scope.info.c_Result3=3:value>=30&&33>=value?$scope.info.c_Result3=4:value>33&&($scope.info.c_Result3=5))):""==$scope.info.c_Left3?$scope.info.c_Result3=0:null==$scope.info.c_Left3?$scope.info.c_Result3=0:""==$scope.info.c_Right3?$scope.info.c_Result3=0:null==$scope.info.c_Right3&&($scope.info.c_Result3=0)},$scope.d_Push_ups=function(){value=$scope.info.d_Push_ups_total3,value>0?"Male"==sex?value>=1&&5>=value?$scope.info.d_Result3=1:value>=6&&8>=value?$scope.info.d_Result3=2:value>=9&&12>=value?$scope.info.d_Result3=3:value>=13&&15>=value?$scope.info.d_Result3=4:value>15&&($scope.info.d_Result3=5):"Female"==sex&&(value>=1&&2>=value?$scope.info.d_Result3=1:value>=3&&4>=value?$scope.info.d_Result3=2:value>=5&&6>=value?$scope.info.d_Result3=3:value>=7&&10>=value?$scope.info.d_Result3=4:value>10&&($scope.info.d_Result3=5)):$scope.info.d_Result3=0},$scope.e_total3=function(){value=$scope.info.e_total3,value?value>=0&&30>=value?$scope.info.e_Result3=1:value>30&&60>=value?$scope.info.e_Result3=2:value>60&&90>=value?$scope.info.e_Result3=3:value>90&&120>=value?$scope.info.e_Result3=4:value>120&&($scope.info.e_Result3=5):$scope.info.e_Result3=null},$scope.aSec4=function(){value=$scope.info.aSec4,value?0==value?$scope.info.aResult4=1:value>=1&&20>=value?$scope.info.aResult4=2:value>=21&&40>=value?$scope.info.aResult4=3:value>=41&&60>=value?$scope.info.aResult4=4:value>60&&($scope.info.aResult4=5):$scope.info.aResult4=null},$scope.bTotal4=function(){value=$scope.info.bTotal4,value?0==value?$scope.info.bResult4=1:value>=1&&9>=value?$scope.info.bResult4=2:value>=10&&14>=value?$scope.info.bResult4=3:value>=15&&19>=value?$scope.info.bResult4=4:value>=20&&($scope.info.bResult4=5):$scope.info.bResult4=null},$scope.cKneeling4=function(){value=$scope.info.cKneeling4,value?0==value?$scope.info.cResult4=1:value>=1&&10>=value?$scope.info.cResult4=2:value>=11&&20>=value?$scope.info.cResult4=3:value>=21&&30>=value?$scope.info.cResult4=4:value>30&&($scope.info.cResult4=5):$scope.info.cResult4=null},$scope.aMax=function(){value=$scope.info.aMax6,value?value>45?$scope.info.aResult6=5:value>=23&&45>=value?$scope.info.aResult6=4:value>=10&&22>=value?$scope.info.aResult6=3:value>=6&&9>=value?$scope.info.aResult6=2:value>=0&&5>=value&&($scope.info.aResult6=1):$scope.info.aResult6=null},$scope.bMax=function(){value=$scope.info.bMax6,value?value>23?$scope.info.bResult6=5:value>=12&&23>=value?$scope.info.bResult6=4:value>=6&&11>=value?$scope.info.bResult6=3:value>=4&&5>=value?$scope.info.bResult6=2:value>=0&&3>=value&&($scope.info.bResult6=1):$scope.info.bResult6=null},$scope.cStrenght5=function(){value=$scope.info.cStrenght5,value?0==value?$scope.info.cResult5=1:value>=1&&20>=value?$scope.info.cResult5=2:value>=21&&40>=value?$scope.info.cResult5=3:value>=41&&60>=value?$scope.info.cResult5=4:value>60&&($scope.info.cResult5=5):$scope.info.cResult5=null},$scope.dTotal5=function(){value=$scope.info.dTotal5,value?0==value?$scope.info.dResult5=1:value>=1&&5>=value?$scope.info.dResult5=2:value>5&&10>=value?$scope.info.dResult5=3:value>=11&&15>=value?$scope.info.dResult5=4:value>15&&($scope.info.dResult5=5):$scope.info.dResult5=null};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.LComment=(null!=$scope.info.Rom_Comments1&&""!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1+"\n":"")+(null!=$scope.info.Comments2&&""!=$scope.info.Comments2?$scope.info.Comments2+"\n":"")+totalCom},$scope.totalComment=function(){"undefined"==typeof $scope.info.LComment&&($scope.info.LComment=(null!=$scope.info.Rom_Comments1&&""!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1+"\n":"")+(null!=$scope.info.Comments2&&""!=$scope.info.Comments2?$scope.info.Comments2+"\n":"")),len=(null!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1.length:0)+(null!=$scope.info.Comments2?$scope.info.Comments2.length:0),str=$scope.info.LComment.replace("\n",""),str=str.replace("\n",""),totalCom=str.substr(len)},$scope.maxDateDOB=new Date(date.getFullYear()-1,date.getMonth(),date.getDate()),$scope.maxDate=date,$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonFAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)};var insert=!0,FName="",SName="",MName="";DocumentService.checkGorgonFA(Patient_ID,CalID).then(function(response){"not"==response.status?(toastr.error("You have to make Pre-employment Health Assessment first","Error"),$state.go("loggedIn.gorgonMA",null,{reload:!0})):"insert"===response.status?(insert=!0,$scope.isNew=!0,FName=null!=$scope.patientInfo.First_name?$scope.patientInfo.First_name:"",SName=null!=$scope.patientInfo.Sur_name?$scope.patientInfo.Sur_name:"",MName=null!=$scope.patientInfo.Middle_name?$scope.patientInfo.Middle_name:"",$scope.info={id:null,patientId:Patient_ID,fName:FName+" "+MName+" "+SName,age:null,JAF:null,DOB:$scope.patientInfo.DOB,DOA:date,IsConsentReason:null,fsign:null,fsignDate:date,Estimated:null,EstimatedComments:null,MS_HeartConditions:null,MS_HeartConditions_Comment:null,MS_Lung_Asthma:null,MS_Lung__Asthma_Comment:null,MS_Diabetes:null,MS_Diabetes_Comment:null,MS_Fits:null,MS_Fits_Comment:null,MS_Medication:null,MS_Medication_Comment:null,MS_Other:null,MS_Other_Comment:null,MS_ie_Comment:null,MS_Mx_Heart_Rage_1:null!=$scope.patientInfo.DOB?getAge($scope.patientInfo.DOB):0,MS_Mx_Heart_Rage_2:null,MS_Mx_Weight_1:response.data.WEIGHT,MS_MX_Weight_2:null,MS_Blood_Pressure_1:response.data.SYSTOLIC_BP,MS_Blood_Pressure_2:response.data.DIASTOLIC_BP,MS_Resting_Heart_Rate:response.data.PULSE,Rom_Neck1:null,Rom_Thoracic1:null,Rom_Lumbar1:null,Rom_Shoulder1:null,Rom_Elbow1:null,Rom_Wrist1:null,Rom_Fingers1:null,Rom_Hips1:null,Rom_Knees1:null,Rom_Ankles1:null,Rom_Comments1:null,Rom_Total1:0,Heart_Rate_30S2:null,Heart_Rate_1M2:null,Heart_Rate_1M_30S2:null,Heart_Rate_2M2:null,Heart_Rate_2M_30S2:null,Heart_Rate_3M2:null,Heart_Rate_1M_Post2:null,Step_Result2:null,Step_Correct2:null,Comments2:null,Total2:null,a_Right3:null,a_Left3:null,b_Right3:null,b_Left3:null,c_Grip3:null,c_Right3:null,c_Left3:null,c_Result3:0,d_Push_ups_total3:null,d_Result3:0,e_total3:null,e_Result3:0,Comments3:null,Total3:0,aSec4:null,aResult4:null,bTotal4:null,bCrepitus4:null,bResult4:null,cKneeling4:null,cResult4:null,Comments4:null,Total4:0,aPosture5:null,bHoverResult5:null,cStrenght5:null,cResult5:null,dTotal5:null,
dResult5:null,eWaitesBow5:null,eResult5:null,fRight5:null,fLeft5:null,gRight5:null,gFloat5:null,Total5:0,aMax6:null,aResult6:null,bMax6:null,bResult6:null,c_16:0,c_1Comment6:null,c_26:0,c_2Comment6:null,c_36:0,c_3Comment6:null,c_46:0,c_4Comment6:null,c_56:0,c_5Comment6:null,Comments6:null,Total6:0,Score1Comment:null,Score2Comment:null,Score3Comment:null,Score4Comment:null,Score5Comment:null,Score6Comment:null,Score7Comment:null,Score8Comment:null,FCAToTal:0,FCAResult:null,LEPDC:null,LAPC:null,LComment:null,DocId:response.docID,LName:response.docName,LPosition:"",Chest:0,Lsign:response.docSign,LDate:date,Created_by:null,Last_updated_by:null,CalId:CalID},oriInfo=angular.copy($scope.info)):"update"==response.status?(insert=!1,$scope.isNew=!1,$scope.info={id:response.data.id,patientId:response.data.patientId,fName:response.data.fName,JAF:response.data.JAF,DOB:response.data.DOB,DOA:response.data.DOA,IsConsentReason:response.data.IsConsentReason,fsign:response.data.fsign,fsignDate:response.data.fsignDate,Estimated:response.data.Estimated,EstimatedComments:response.data.EstimatedComments,MS_HeartConditions:response.data.MS_HeartConditions,MS_HeartConditions_Comment:response.data.MS_HeartConditions_Comment,MS_Lung_Asthma:response.data.MS_Lung_Asthma,MS_Lung__Asthma_Comment:response.data.MS_Lung__Asthma_Comment,MS_Diabetes:response.data.MS_Diabetes,MS_Diabetes_Comment:response.data.MS_Diabetes_Comment,MS_Fits:response.data.MS_Fits,MS_Fits_Comment:response.data.MS_Fits_Comment,MS_Medication:response.data.MS_Medication,MS_Medication_Comment:response.data.MS_Medication_Comment,MS_Other:response.data.MS_Other,MS_Other_Comment:response.data.MS_Other_Comment,MS_ie_Comment:response.data.MS_ie_Comment,MS_Mx_Heart_Rage_1:response.data.MS_Mx_Heart_Rage_1,MS_Mx_Heart_Rage_2:response.data.MS_Mx_Heart_Rage_2,MS_Mx_Weight_1:response.data.MS_Mx_Weight_1,MS_MX_Weight_2:response.data.MS_MX_Weight_2,MS_Blood_Pressure_1:response.data.MS_Blood_Pressure_1,MS_Blood_Pressure_2:response.data.MS_Blood_Pressure_2,MS_Resting_Heart_Rate:response.data.MS_Resting_Heart_Rate,Rom_Neck1:response.data["1Rom_Neck"],Rom_Thoracic1:response.data["1Rom_Thoracic"],Rom_Lumbar1:response.data["1Rom_Lumbar"],Rom_Shoulder1:response.data["1Rom_Shoulder"],Rom_Elbow1:response.data["1Rom_Elbow"],Rom_Wrist1:response.data["1Rom_Wrist"],Rom_Fingers1:response.data["1Rom_Fingers"],Rom_Hips1:response.data["1Rom_Hips"],Rom_Knees1:response.data["1Rom_Knees"],Rom_Ankles1:response.data["1Rom_Ankles"],Rom_Comments1:response.data["1Rom_Comments"],Rom_Total1:response.data["1Rom_Total"],Heart_Rate_30S2:response.data["2Heart_Rate_30S"],Heart_Rate_1M2:response.data["2Heart_Rate_1M"],Heart_Rate_1M_30S2:response.data["2Heart_Rate_1M_30S"],Heart_Rate_2M2:response.data["2Heart_Rate_2M"],Heart_Rate_2M_30S2:response.data["2Heart_Rate_2M_30S"],Heart_Rate_3M2:response.data["2Heart_Rate_3M"],Heart_Rate_1M_Post2:response.data["2Heart_Rate_1M_Post"],Step_Result2:response.data["2Step_Result"],Step_Correct2:response.data["2Step_Correct"],Comments2:response.data["2Comments"],Total2:response.data["2Total"],a_Right3:response.data["3a_Right"],a_Left3:response.data["3a_Left"],b_Right3:response.data["3b_Right"],b_Left3:response.data["3b_Left"],c_Grip3:response.data["3c_Grip"],c_Right3:response.data["3c_Right"],c_Left3:response.data["3c_Left"],c_Result3:response.data["3c_Result"],d_Push_ups_total3:response.data["3d_Push_ups_total"],d_Result3:response.data["3d_Result"],e_total3:response.data["3e_total"],e_Result3:response.data["3e_Result"],Comments3:response.data["3Comments"],Total3:response.data["3Total"],aSec4:response.data["4aSec"],aResult4:response.data["4aResult"],bTotal4:response.data["4bTotal"],bCrepitus4:response.data["4bCrepitus"],bResult4:response.data["4bResult"],cKneeling4:response.data["4cKneeling"],cResult4:response.data["4cResult"],Comments4:response.data["4Comments"],Total4:response.data["4Total"],aPosture5:response.data["5aPosture"],bHoverResult5:response.data["5bHoverResult"],cStrenght5:response.data["5cStrenght"],cResult5:response.data["5cResult"],dTotal5:response.data["5dTotal"],dResult5:response.data["5dResult"],eWaitesBow5:response.data["5eWaitesBow"],eResult5:response.data["5eResult"],fRight5:response.data["5fRight"],fLeft5:response.data["5fLeft"],gRight5:response.data["5gRight"],gFloat5:response.data["5gFloat"],Total5:response.data["5Total"],aMax6:response.data["6aMax"],aResult6:response.data["6aResult"],bMax6:response.data["6bMax"],bResult6:response.data["6bResult"],c_16:response.data["6c_1"],c_1Comment6:response.data["6c_1Comment"],c_26:response.data["6c_2"],c_2Comment6:response.data["6c_2Comment"],c_36:response.data["6c_3"],c_3Comment6:response.data["6c_3Comment"],c_46:response.data["6c_4"],c_4Comment6:response.data["6c_4Comment"],c_56:response.data["6c_5"],c_5Comment6:response.data["6c_5Comment"],Comments6:response.data["6Comments"],Total6:response.data["6Total"],Score1Comment:response.data.Score1Comment,Score2Comment:response.data.Score2Comment,Score3Comment:response.data.Score3Comment,Score4Comment:response.data.Score4Comment,Score5Comment:response.data.Score5Comment,Score6Comment:response.data.Score6Comment,Score7Comment:response.data.Score7Comment,Score8Comment:response.data.Score8Comment,FCAToTal:response.data.FCAToTal,FCAResult:response.data.FCAResult,LEPDC:response.data.LEPDC,LAPC:response.data.LAPC,LComment:response.data.LComment,Created_by:response.data.Created_by,Lsign:response.data.Lsign,LName:response.data.LName,LDate:response.data.LDate,LPosition:response.data.LPosition,Chest:response.data.Chest,Last_updated_by:response.data.Last_updated_by,CalId:response.data.CalId,DocId:response.data.DocId},oriInfo=angular.copy($scope.info),$scope.totalComment()):"error"==response.status&&toastr.error("Fail","Error")}),$scope.submitGorgonFA=function(gorgonFAForm){if($scope.showClickedValidation=!0,gorgonFAForm.$invalid)toastr.error("Please Input All Required Information!","Error");else if(1==insert){var info=$scope.info;DocumentService.insertGorgonFA(info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonFA",null,{reload:!0})):toastr.error("Fail","Error")})}else DocumentService.editGorgonFA($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonFA",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.gorgonMA.controllers",[]).controller("gorgonMAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.checkAudiogram=function(){1==$scope.info.AUDIOGRAM&&($scope.info.RIGHT_EAR_500=null,$scope.info.RIGHT_EAR_1000=null,$scope.info.RIGHT_EAR_1500=null,$scope.info.RIGHT_EAR_2000=null,$scope.info.RIGHT_EAR_3000=null,$scope.info.RIGHT_EAR_4000=null,$scope.info.RIGHT_EAR_6000=null,$scope.info.RIGHT_EAR_8000=null,$scope.info.LEFT_EAR_500=null,$scope.info.LEFT_EAR_1000=null,$scope.info.LEFT_EAR_1500=null,$scope.info.LEFT_EAR_2000=null,$scope.info.LEFT_EAR_3000=null,$scope.info.LEFT_EAR_4000=null,$scope.info.LEFT_EAR_6000=null,$scope.info.LEFT_EAR_8000=null)},$scope.checkSpirometry=function(){1==$scope.info.SPIROMETRY&&($scope.info.PRE_BR1_V1=null,$scope.info.PRE_BR1_V2=null,$scope.info.PRE_BR1_V3=null,$scope.info.PRE_BR1_V4=null,$scope.info.PRE_BR1_V5=null,$scope.info.PRE_BR1_V6=null,$scope.info.PRE_BR1_V7=null,$scope.info.PRE_BR2_V1=null,$scope.info.PRE_BR2_V2=null,$scope.info.PRE_BR2_V3=null,$scope.info.PRE_BR2_V4=null,$scope.info.PRE_BR2_V5=null,$scope.info.PRE_BR2_V6=null,$scope.info.PRE_BR2_V7=null)};var date=new Date;$filter("date")(date,"dd/MM/yyyy"),$scope.maxDate=new Date(date.getFullYear()-1,date.getMonth(),date.getDate()),$scope.info={GORGON_ID:null,PATIENT_ID:Patient_ID,PHOTO_ID:null,HAND_DOR:null,HEIGHT:null,WEIGHT:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,CANNABIS:null,OPIATES:null,AMPHETS:null,ANCOHOL:null,BENZOS:null,COCAIN:null,METHAMPH:null,AUDIOGRAM:0,SPIROMETRY:0,SPIROMETRY_STATIS:null,CANDIDATE_EVER:null,YES_TO_EITHER:null,SPI_EXAMINERS_COMMENTS:null,VA_UNCORRECTED_LEFT:null,VA_UNCORRECTED_RIGHT:null,VA_CORRECTED_LEFT:null,VA_CORRECTED_RIGHT:null,NV_UNCORRECTED_LEFT:null,NV_UNCORRECTED_RIGHT:null,NV_CORRECTED_LEFT:null,NV_CORRECTED_RIGHT:null,VF_LEFT:null,VF_RIGHT:null,ISHIHARA_RESPONSE:null,AS_Nil:0,AS_Wide:0,AS_Basal:0,AS_Wheezes:0,AS_Rub:0,EC_normal:0,EC_dermatitis:0,EC_fungal:0,EC_structural:0,EC_wax:0,TM_normal:0,TM_effusion:0,TM_wet:0,TM_dry:0,SYSTOLIC_BP:null,DIASTOLIC_BP:null,PULSE:null,HEART_RHYTHM:null,HEART_SOUNDS:null,PACEMAKER:null,CHEST:null,UPPER_ZONES:null,LOWER_ZONES:null,ECZEMA:null,PSORIASIS:null,TINEA:null,SOLAR_DAMAGE:null,FOLLICULITIS:null,EC_OTHER:null,SKIN_EXAMINERS_COMMENTS:null,SCARS_NIL:0,SCARS_APPENDIX:0,SCARS_GALLBLADDER:0,SCARS_HERNIA:0,SCARS_OTHER:0,HERNIAL:null,HERNIAL_LEFT:0,HERNIAL_RIGHT:0,RECTUS:null,MUSCLE_TONE:null,MUSCLE_POWER:null,MUSCLE_WASTING:null,TREMOR:null,GAIT:null,LOWER_LEFT:null,LOWER_RIGHT:null,CNS_COMMENTS:null,NECK_POSTURE:null,NECK_RHYTHM:null,NECK_FLEXION:null,NECK_EXTENSION:null,NECK_LATERAL:null,NECK_ROTATION:null,BACK_POSTURE:null,BACK_RHYTHM:null,BACK_FLEXION:null,BACK_EXTENSION:null,BACK_LATERAL:null,BACK_ROTATION:null,BACK_EXAMINERS_COMMENTS:null,SHOULDER:null,ELBOWS:null,WRISTS:null,KNEES:null,ANKLES:null,GRIP_STRENGTH:null,EPICONDYLES:null,HEEL_WALK:null,DUCK_WALK:null,TOE_WALK:null,RHOMBERGS:null,FUTHER_COMMENTS:null,LIMB_EXAMINERS_COMMENTS:null,GORGON_DATE:null,SIGNATURE:null,Created_by:null,Last_updated_by:null,CalId:CalID,EXAMINER_NAME:null,EXAMINER_ADDRESS:null,RIGHT_EAR_500:null,RIGHT_EAR_1000:null,RIGHT_EAR_1500:null,RIGHT_EAR_2000:null,RIGHT_EAR_3000:null,RIGHT_EAR_4000:null,RIGHT_EAR_6000:null,RIGHT_EAR_8000:null,LEFT_EAR_500:null,LEFT_EAR_1000:null,LEFT_EAR_1500:null,LEFT_EAR_2000:null,LEFT_EAR_3000:null,LEFT_EAR_4000:null,LEFT_EAR_6000:null,LEFT_EAR_8000:null,PRE_BR1_V1:null,PRE_BR1_V2:null,PRE_BR1_V3:null,PRE_BR1_V4:null,PRE_BR1_V5:null,PRE_BR1_V6:null,PRE_BR1_V7:null,PRE_BR2_V1:null,PRE_BR2_V2:null,PRE_BR2_V3:null,PRE_BR2_V4:null,PRE_BR2_V5:null,PRE_BR2_V6:null,PRE_BR2_V7:null,PROTEIN_COMMENT:null,GLUCOSE_COMMENT:null,BLOOD_COMMENT:null,DocId:null,docName:null,docSign:null};var oriInfo;$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonMAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.BLOOD_COMMENT=1==$scope.info.BLOOD?"":$scope.info.BLOOD_COMMENT,$scope.info.GLUCOSE_COMMENT=1==$scope.info.GLUCOSE?"":$scope.info.GLUCOSE_COMMENT,$scope.info.PROTEIN_COMMENT=1==$scope.info.PROTEIN?"":$scope.info.PROTEIN_COMMENT,$scope.info.SPI_EXAMINERS_COMMENTS=(null!=$scope.info.PROTEIN_COMMENT&&""!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT+"\n":"")+(null!=$scope.info.GLUCOSE_COMMENT&&""!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT+"\n":"")+(null!=$scope.info.BLOOD_COMMENT&&""!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT+"\n":"")+totalCom},$scope.totalComment=function(){"undefined"==typeof $scope.info.SPI_EXAMINERS_COMMENTS&&($scope.info.SPI_EXAMINERS_COMMENTS=(null!=$scope.info.PROTEIN_COMMENT&&""!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT+"\n":"")+(null!=$scope.info.GLUCOSE_COMMENT&&""!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT+"\n":"")+(null!=$scope.info.BLOOD_COMMENT&&""!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT+"\n":"")),len=(null!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT.length:0)+(null!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT.length:0)+(null!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT.length:0),str=$scope.info.SPI_EXAMINERS_COMMENTS.replace("\n",""),str=str.replace("\n",""),str=str.replace("\n",""),totalCom=str.substr(len)};var insert=!0;DocumentService.checkGorgonMA(Patient_ID,CalID).then(function(response){"insert"===response.status?(insert=!0,$scope.isNew=!0,$scope.info.DocId=response.DocId,$scope.info.docName=response.docName,$scope.info.docSign=response.docSign,oriInfo=angular.copy($scope.info),console.log($scope.info)):"update"==response.status?(insert=!1,$scope.isNew=!1,console.log(response.data),$scope.info=angular.copy(response.data),$scope.info.docName=response.docName,$scope.info.docSign=response.docSign,oriInfo=angular.copy($scope.info),$scope.totalComment()):"error"==response.status&&toastr.error("Fail","Error")}),$scope.submitGorgonMA=function(gorgonMAForm){$scope.showClickedValidation=!0,gorgonMAForm.$invalid?(toastr.error("Please Input All Required Information!","Error"),ConfigService.focus_input(gorgonMAForm)):1==insert?DocumentService.insertGorgonMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.gorgonMA",null,{reload:!0})):toastr.error("Add new fail!","Error")}):DocumentService.editGorgonMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.gorgonMA",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}),angular.module("app.loggedIn.document.gorgonMH.controllers",[]).controller("gorgonMHController",function($filter,DocumentService,$scope,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService,ConfigService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date;var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var tempPatient=localStorageService.get("tempPatient")||[];if(null===tempPatient||"undefined"===tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load some information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={Gorgon_Id:null,Patient_Id:patient_id,JobNo:null,Occupation:null,JobLocation:null,SpecificLocation:null,PhoneNumber:null,Q1_YearFrom1:new Date,Q1_YearFrom2:new Date,Q1_YearTo1:new Date,Q1_YearTo2:new Date,Q1_Job1:null,Q1_Job2:null,Q1_Employer1:null,Q1_Employer2:null,Q1_TypeOfWork:null,Q1_WorkPast:null,Q1_WorkEnvironment:null,Q1_AnyProblems:null,Q1_CauseProblems:null,Q1_Underground:null,Q1_GrainDust:null,Q1_RemoteEnv:null,Q1_AtHeights:null,Q1_WetConditions:null,Q1_Nickel:null,Q1_HumidConditions:null,Q1_FIFO:null,Q1_FIFODone:null,Q1_FIFOProblems:null,Q1_ShiftWork:null,Q1_ShiftWorkDone:null,Q1_ShiftWorkProblems:null,Q1_SafetyEquipment:null,Q1_ExaminersComments:null,Q2_Operation:null,Q2_Accident:null,Q2_SportsInjury:null,Q2_YesWhen:null,Q2_TimeOfWork:null,Q2_HowLongOff:null,Q2_HowLongModified:null,Q2_HowLongTreatment:null,Q2_NormalDuties:null,Q2_Compensation:null,Q2_PsychologicalProblems:null,Q2_ExaminersComments:null,Q2_DentalHealth:null,Q2_Diabetic:null,Q2_Seizure:null,Q2_Epileptic:null,Q2_Asthmatic:null,Q2_AnyScars:null,Q2_MedicAlert:null,Q3_NeckInjury:null,Q3_DiskInjury:null,Q3_Backache:null,Q3_Physio:null,Q3_BackInjury:null,Q3_Sciatica:null,Q3_BackSurgery:null,Q3_SwollenJoints:null,Q3_ArthriticKnee:null,Q3_Arm:null,Q3_HandInjury:null,Q3_LegInjury:null,Q3_KneeCartilage:null,Q3_KneeReconstruction:null,Q3_FootProblems:null,Q3_OtherBone:null,Q3_Rheumatism:null,Q3_RSI:null,Q3_Hernia:null,Q4_MentalHealth:null,Q4_Psychologist:null,Q4_DrugsProblems:null,Q4_Depression:null,Q4_PanicAttacks:null,Q4_NervousProblem:null,Q4_Anxiety:null,Q4_Insomnia:null,Q5_Eczema:null,Q5_Psoriasis:null,Q5_SkinProblem:null,Q5_Dermatitis:null,Q5_SkinCancers:null,Q6_Asthma:null,Q6_LungDisease:null,Q6_Artery:null,Q6_HighBloodPressure:null,Q6_DVT:null,Q6_UsedPuffer:null,Q6_CardiacPacemaker:null,Q6_Emphysema:null,Q6_HeartDisease:null,Q6_Bronchitis:null,Q6_CollapsedLung:null,Q6_HeartAttack:null,Q7_HeadInjury:null,Q7_Epilepsy:null,Q7_SevereHeadaches:null,Q7_NeurologicalDisorder:null,Q8_DOInsulin:null,Q8_DOMedication:null,Q8_DietControl:null,Q8_KidneyProblems:null,Q8_LiverDisease:null,Q8_HearingLoss:null,Q8_Exhaustion:null,Q8_Arthritis:null,Q8_BloodDisorder:null,Q8_Cancer:null,Q8_BowelProblems:null,Q8_Hepatitis:null,Q8_VisionProblem:null,Q8_ChronicIllness:null,Q9_Pregnant:null,Q9_BreastFeeding:null,Q9_ExaminersComments:null,Q10_Disabilities:null,Q11_Climb:null,Q11_Bend:null,Q11_WorkOverhead:null,Q11_WorkHeights:null,Q11_WorkIsolation:null,Q11_Instruments:null,Q11_WorkAwkward:null,Q11_Squat:null,Q11_Push:null,Q11_WorkUnderground:null,Q11_WorkDusty:null,Q11_WorkConfined:null,Q11_WorkGround:null,Q11_WorkVibration:null,Q12_LossFullBack:null,Q12_LossFullLeg:null,Q12_DifficultyHearing:null,Q12_LossEye:null,Q12_Glasses:null,Q12_OtherLoss:null,Q12_LossFullMovements:null,Q12_OtherProblem:null,Q12_LossFullArm:null,Q12_Psychological:null,Q12_Breathing:null,Q12_ChronicSkin:null,Q12_AlcoholMisuse:null,Q12_LossMobility:null,Q12_LossFullNeck:null,Q12_ExaminersComments:null,Q13_AdvisedToChange:null,Q13_AdvisedToChangeComment:null,Q13_AdvisedToLimit:null,Q13_AdvisedToLimitComment:null,Q13_OffInjury:null,Q13_OffInjuryComment:null,Q13_WhatWas:null,Q13_Medi_Vac:null,Q13_Details:null,Q13_ExaminersComments:null,Q14_WorkRelatedDisease:null,Q14_Year:null,Q14_HowLongOff:null,Q14_HowLongModified:null,Q14_HowLongTreatment:null,Q14_NormalDuties:null,Q14_Compensation:null,Q14_Psychological:null,Q14_Details:null,Q14_WCClaim:null,Q14_ExaminersComments:null,Q15_TakeMedications:null,Q15_ListMedication:null,Q16_HayFever:null,Q16_Eczema:null,Q16_Allergic:null,Q16_Adrenaline:null,Q16_Epipen:null,Q16_Asthma:null,Q17_QFever:null,Q17_HepatitisA:null,Q17_Tetanus:null,Q17_HepatitisB:null,Q17_ExaminersComments:null,Q18_IncreasedCough:null,Q18_ChestIllness:null,Q18_SOBHurrying:null,Q18_SOBwalking:null,Q18_SOBWakeUp:null,Q18_CESWheezy:null,Q18_CEFTight:null,Q18_GivenPuffer:null,Q18_LastTimePuffer:null,Q19_Smoke:null,Q19_SmokeDay:null,Q19_SmokeWeek:null,Q19_SmokeYear:null,Q20_DrinkWeek:null,Q20_DrinkMax:null,Q21_Exercise:null,Q21_PlaySport:null,Q21_SportDetails:null,Q21_IsFootball:null,Q21_IsGolf:null,Q21_IsTennis:null,Q21_IsSquash:null,Q21_IsBowls:null,Q21_IsGym:null,Q21_IsOther:null,Q22_SleepDisorder:null,Q22_Choking:null,Q22_UseCPAP:null,Q23_SittingReading:null,Q23_WatchingTV:null,Q23_Inactive:null,Q23_Passenger:null,Q23_LyingDown:null,Q23_SittingTalking:null,Q23_SittingQuietly:null,Q23_InACar:null,Q23_TotalScore:null,Signature:null,GorgonDate:new Date,Created_by:null,Last_updated_by:null,CalId:cal_id,DocId:null,Q21_IsComment:null,Q21Other1Comment:null,PATIENT_SIGNATURE:null};var oriInfo;$scope.totals=[{id:0},{id:1},{id:2},{id:3}],$scope.maxDate=new Date;var info=$scope.info;DocumentService.loadGGMH(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].data;$scope.info={patient:response[0].patient,Gorgon_Id:data.Gorgon_Id,Patient_Id:patient_id,JobNo:data.JobNo,Occupation:data.Occupation,JobLocation:data.JobLocation,SpecificLocation:data.SpecificLocation,PhoneNumber:data.PhoneNumber,Q1_YearFrom1:data.Q1_YearFrom1,Q1_YearFrom2:data.Q1_YearFrom2,Q1_YearTo1:data.Q1_YearTo1,Q1_YearTo2:data.Q1_YearTo2,Q1_Job1:data.Q1_Job1,Q1_Job2:data.Q1_Job2,Q1_Employer1:data.Q1_Employer1,Q1_Employer2:data.Q1_Employer2,Q1_TypeOfWork:data.Q1_TypeOfWork,Q1_WorkPast:data.Q1_WorkPast,Q1_WorkEnvironment:data.Q1_WorkEnvironment,Q1_AnyProblems:data.Q1_AnyProblems,Q1_CauseProblems:data.Q1_CauseProblems,Q1_Underground:data.Q1_Underground,Q1_GrainDust:data.Q1_GrainDust,Q1_RemoteEnv:data.Q1_RemoteEnv,Q1_AtHeights:data.Q1_AtHeights,Q1_WetConditions:data.Q1_WetConditions,Q1_Nickel:data.Q1_Nickel,Q1_HumidConditions:data.Q1_HumidConditions,Q1_FIFO:data.Q1_FIFO,Q1_FIFODone:data.Q1_FIFODone,Q1_FIFOProblems:data.Q1_FIFOProblems,Q1_ShiftWork:data.Q1_ShiftWork,Q1_ShiftWorkDone:data.Q1_ShiftWorkDone,Q1_ShiftWorkProblems:data.Q1_ShiftWorkProblems,Q1_SafetyEquipment:data.Q1_SafetyEquipment,Q1_ExaminersComments:data.Q1_ExaminersComments,Q2_Operation:data.Q2_Operation,Q2_Accident:data.Q2_Accident,Q2_SportsInjury:data.Q2_SportsInjury,Q2_YesWhen:data.Q2_YesWhen,Q2_TimeOfWork:data.Q2_TimeOfWork,Q2_HowLongOff:data.Q2_HowLongOff,Q2_HowLongModified:data.Q2_HowLongModified,Q2_HowLongTreatment:data.Q2_HowLongTreatment,Q2_NormalDuties:data.Q2_NormalDuties,Q2_Compensation:data.Q2_Compensation,Q2_PsychologicalProblems:data.Q2_PsychologicalProblems,Q2_ExaminersComments:data.Q2_ExaminersComments,Q2_DentalHealth:data.Q2_DentalHealth,Q2_Diabetic:data.Q2_Diabetic,Q2_Seizure:data.Q2_Seizure,Q2_Epileptic:data.Q2_Epileptic,Q2_Asthmatic:data.Q2_Asthmatic,Q2_AnyScars:data.Q2_AnyScars,Q2_MedicAlert:data.Q2_MedicAlert,Q3_NeckInjury:data.Q3_NeckInjury,Q3_DiskInjury:data.Q3_DiskInjury,Q3_Backache:data.Q3_Backache,Q3_Physio:data.Q3_Physio,Q3_BackInjury:data.Q3_BackInjury,Q3_Sciatica:data.Q3_Sciatica,Q3_BackSurgery:data.Q3_BackSurgery,Q3_SwollenJoints:data.Q3_SwollenJoints,Q3_ArthriticKnee:data.Q3_ArthriticKnee,Q3_Arm:data.Q3_Arm,Q3_HandInjury:data.Q3_HandInjury,Q3_LegInjury:data.Q3_LegInjury,Q3_KneeCartilage:data.Q3_KneeCartilage,Q3_KneeReconstruction:data.Q3_KneeReconstruction,Q3_FootProblems:data.Q3_FootProblems,Q3_OtherBone:data.Q3_OtherBone,Q3_Rheumatism:data.Q3_Rheumatism,Q3_RSI:data.Q3_RSI,Q3_Hernia:data.Q3_Hernia,Q4_MentalHealth:data.Q4_MentalHealth,Q4_Psychologist:data.Q4_Psychologist,Q4_DrugsProblems:data.Q4_DrugsProblems,Q4_Depression:data.Q4_Depression,Q4_PanicAttacks:data.Q4_PanicAttacks,Q4_NervousProblem:data.Q4_NervousProblem,Q4_Anxiety:data.Q4_Anxiety,Q4_Insomnia:data.Q4_Insomnia,Q5_Eczema:data.Q5_Eczema,Q5_Psoriasis:data.Q5_Psoriasis,Q5_SkinProblem:data.Q5_SkinProblem,Q5_Dermatitis:data.Q5_Dermatitis,Q5_SkinCancers:data.Q5_SkinCancers,Q6_Asthma:data.Q6_Asthma,Q6_LungDisease:data.Q6_LungDisease,Q6_Artery:data.Q6_Artery,Q6_HighBloodPressure:data.Q6_HighBloodPressure,Q6_DVT:data.Q6_DVT,Q6_UsedPuffer:data.Q6_UsedPuffer,Q6_CardiacPacemaker:data.Q6_CardiacPacemaker,Q6_Emphysema:data.Q6_Emphysema,Q6_HeartDisease:data.Q6_HeartDisease,Q6_Bronchitis:data.Q6_Bronchitis,Q6_CollapsedLung:data.Q6_CollapsedLung,Q6_HeartAttack:data.Q6_HeartAttack,Q7_HeadInjury:data.Q7_HeadInjury,Q7_Epilepsy:data.Q7_Epilepsy,Q7_SevereHeadaches:data.Q7_SevereHeadaches,Q7_NeurologicalDisorder:data.Q7_NeurologicalDisorder,Q8_DOInsulin:data.Q8_DOInsulin,Q8_DOMedication:data.Q8_DOMedication,Q8_DietControl:data.Q8_DietControl,Q8_KidneyProblems:data.Q8_KidneyProblems,Q8_LiverDisease:data.Q8_LiverDisease,Q8_HearingLoss:data.Q8_HearingLoss,Q8_Exhaustion:data.Q8_Exhaustion,Q8_Arthritis:data.Q8_Arthritis,Q8_BloodDisorder:data.Q8_BloodDisorder,Q8_Cancer:data.Q8_Cancer,Q8_BowelProblems:data.Q8_BowelProblems,Q8_Hepatitis:data.Q8_Hepatitis,Q8_VisionProblem:data.Q8_VisionProblem,Q8_ChronicIllness:data.Q8_ChronicIllness,Q9_Pregnant:data.Q9_Pregnant,Q9_BreastFeeding:data.Q9_BreastFeeding,Q9_ExaminersComments:data.Q9_ExaminersComments,Q10_Disabilities:data.Q10_Disabilities,Q11_Climb:data.Q11_Climb,Q11_Bend:data.Q11_Bend,Q11_WorkOverhead:data.Q11_WorkOverhead,Q11_WorkHeights:data.Q11_WorkHeights,Q11_WorkIsolation:data.Q11_WorkIsolation,Q11_Instruments:data.Q11_Instruments,Q11_WorkAwkward:data.Q11_WorkAwkward,Q11_Squat:data.Q11_Squat,Q11_Push:data.Q11_Push,Q11_WorkUnderground:data.Q11_WorkUnderground,Q11_WorkDusty:data.Q11_WorkDusty,Q11_WorkConfined:data.Q11_WorkConfined,Q11_WorkGround:data.Q11_WorkGround,Q11_WorkVibration:data.Q11_WorkVibration,Q12_LossFullBack:data.Q12_LossFullBack,Q12_LossFullLeg:data.Q12_LossFullLeg,Q12_DifficultyHearing:data.Q12_DifficultyHearing,Q12_LossEye:data.Q12_LossEye,Q12_Glasses:data.Q12_Glasses,Q12_OtherLoss:data.Q12_OtherLoss,Q12_LossFullMovements:data.Q12_LossFullMovements,Q12_OtherProblem:data.Q12_OtherProblem,Q12_LossFullArm:data.Q12_LossFullArm,Q12_Psychological:data.Q12_Psychological,Q12_Breathing:data.Q12_Breathing,Q12_ChronicSkin:data.Q12_ChronicSkin,Q12_AlcoholMisuse:data.Q12_AlcoholMisuse,Q12_LossMobility:data.Q12_LossMobility,Q12_LossFullNeck:data.Q12_LossFullNeck,Q12_ExaminersComments:data.Q12_ExaminersComments,Q13_AdvisedToChange:data.Q13_AdvisedToChange,Q13_AdvisedToChangeComment:data.Q13_AdvisedToChangeComment,Q13_AdvisedToLimit:data.Q13_AdvisedToLimit,Q13_AdvisedToLimitComment:data.Q13_AdvisedToLimitComment,Q13_OffInjury:data.Q13_OffInjury,Q13_OffInjuryComment:data.Q13_OffInjuryComment,Q13_WhatWas:data.Q13_WhatWas,Q13_Medi_Vac:data.Q13_Medi_Vac,Q13_Details:data.Q13_Details,Q13_ExaminersComments:data.Q13_ExaminersComments,Q14_WorkRelatedDisease:data.Q14_WorkRelatedDisease,Q14_Year:data.Q14_Year,Q14_HowLongOff:data.Q14_HowLongOff,Q14_HowLongModified:data.Q14_HowLongModified,Q14_HowLongTreatment:data.Q14_HowLongTreatment,Q14_NormalDuties:data.Q14_NormalDuties,Q14_Compensation:data.Q14_Compensation,Q14_Psychological:data.Q14_Psychological,Q14_Details:data.Q14_Details,Q14_WCClaim:data.Q14_WCClaim,Q14_ExaminersComments:data.Q14_ExaminersComments,Q15_TakeMedications:data.Q15_TakeMedications,Q15_ListMedication:data.Q15_ListMedication,Q16_HayFever:data.Q16_HayFever,Q16_Eczema:data.Q16_Eczema,Q16_checkAllergic:data.Q16_checkAllergic,Q16_Allergic:data.Q16_Allergic,Q16_Adrenaline:data.Q16_Adrenaline,Q16_Epipen:data.Q16_Epipen,Q16_Asthma:data.Q16_Asthma,Q17_QFever:data.Q17_QFever,Q17_HepatitisA:data.Q17_HepatitisA,Q17_Tetanus:data.Q17_Tetanus,Q17_HepatitisB:data.Q17_HepatitisB,Q17_ExaminersComments:data.Q17_ExaminersComments,Q18_IncreasedCough:data.Q18_IncreasedCough,Q18_ChestIllness:data.Q18_ChestIllness,Q18_SOBHurrying:data.Q18_SOBHurrying,Q18_SOBwalking:data.Q18_SOBwalking,Q18_SOBWakeUp:data.Q18_SOBWakeUp,Q18_CESWheezy:data.Q18_CESWheezy,Q18_CEFTight:data.Q18_CEFTight,Q18_GivenPuffer:data.Q18_GivenPuffer,Q18_LastTimePuffer:data.Q18_LastTimePuffer,Q19_Smoke:data.Q19_Smoke,Q19_SmokeDay:data.Q19_SmokeDay,Q19_SmokeWeek:data.Q19_SmokeWeek,Q19_SmokeYear:data.Q19_SmokeYear,Q20_DrinkWeek:data.Q20_DrinkWeek,Q20_DrinkMax:data.Q20_DrinkMax,Q21_Exercise:data.Q21_Exercise,Q21_PlaySport:data.Q21_PlaySport,Q21_SportDetails:data.Q21_SportDetails,Q21_IsFootball:data.Q21_IsFootball,Q21_IsGolf:data.Q21_IsGolf,Q21_IsTennis:data.Q21_IsTennis,Q21_IsSquash:data.Q21_IsSquash,Q21_IsBowls:data.Q21_IsBowls,Q21_IsGym:data.Q21_IsGym,Q21_IsOther:data.Q21_IsOther,Q22_SleepDisorder:data.Q22_SleepDisorder,Q22_Choking:data.Q22_Choking,Q22_UseCPAP:data.Q22_UseCPAP,Q23_SittingReading:data.Q23_SittingReading,Q23_WatchingTV:data.Q23_WatchingTV,Q23_Inactive:data.Q23_Inactive,Q23_Passenger:data.Q23_Passenger,Q23_LyingDown:data.Q23_LyingDown,Q23_SittingTalking:data.Q23_SittingTalking,Q23_SittingQuietly:data.Q23_SittingQuietly,Q23_InACar:data.Q23_InACar,Q23_TotalScore:data.Q23_TotalScore,Signature:data.Signature,GorgonDate:data.GorgonDate,Created_by:data.Created_by,Last_updated_by:userInfo.id,CalId:data.CalId,DocId:data.DocId,Q21_IsComment:data.Q21Other1Comment,Q21Other1Comment:data.Q21Other1Comment,PATIENT_SIGNATURE:data.PATIENT_SIGNATURE};for(var Examiner_Comments=$scope.info.Q9_ExaminersComments,temp=[],i=0;""!=Examiner_Comments&&null!=Examiner_Comments&&"undefined"!=Examiner_Comments;){var location=Examiner_Comments.search("\r\n");-1==location?(temp[i]=Examiner_Comments,Examiner_Comments=""):(temp[i]=Examiner_Comments.substring(0,location),Examiner_Comments=Examiner_Comments.substring(temp[i].length+2,Examiner_Comments.length)),i++}$scope.info.Q3_ExaminersComments=temp[0],$scope.info.Q4_ExaminersComments=temp[1],$scope.info.Q5_ExaminersComments=temp[2],$scope.info.Q6_ExaminersComments=temp[3],$scope.info.Q7_ExaminersComments=temp[4],$scope.info.Q8_ExaminersComments=temp[5],$scope.info.Q9_ExaminersComments_details=temp[6],oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonMHForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(gorgonMHForm){if($scope.info.Q23_TotalScore=$scope.info.Q23_SittingReading+$scope.info.Q23_WatchingTV+$scope.info.Q23_Inactive+$scope.info.Q23_Passenger+$scope.info.Q23_LyingDown+$scope.info.Q23_SittingTalking+$scope.info.Q23_SittingQuietly+$scope.info.Q23_InACar+0,$scope.info.Q9_ExaminersComments=(null!=$scope.info.Q3_ExaminersComments&&""!=$scope.info.Q3_ExaminersComments&&"undefined"!=$scope.info.Q3_ExaminersComments?$scope.info.Q3_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q4_ExaminersComments&&""!=$scope.info.Q4_ExaminersComments&&"undefined"!=$scope.info.Q4_ExaminersComments?$scope.info.Q4_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q5_ExaminersComments&&""!=$scope.info.Q5_ExaminersComments&&"undefined"!=$scope.info.Q5_ExaminersComments?$scope.info.Q5_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q6_ExaminersComments&&""!=$scope.info.Q6_ExaminersComments&&"undefined"!=$scope.info.Q6_ExaminersComments?$scope.info.Q6_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q7_ExaminersComments&&""!=$scope.info.Q7_ExaminersComments&&"undefined"!=$scope.info.Q7_ExaminersComments?$scope.info.Q7_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q8_ExaminersComments&&""!=$scope.info.Q8_ExaminersComments&&"undefined"!=$scope.info.Q8_ExaminersComments?$scope.info.Q8_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q9_ExaminersComments_details&&""!=$scope.info.Q9_ExaminersComments_details&&"undefined"!=$scope.info.Q9_ExaminersComments_details?$scope.info.Q9_ExaminersComments_details:""),gorgonMHForm.$error.maxlength||gorgonMHForm.$error.required)toastr.error("Please Input All Required Information!","Error"),ConfigService.focus_input(gorgonMHForm);else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertGGMH(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.gorgonMH",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editGGMH(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.gorgonMH",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}}),angular.module("app.loggedIn.document.gorgonUQ.controllers",[]).controller("gorgonUQController",function($scope,$filter,DocumentService,$http,$cookieStore,localStorageService,$state,toastr,$window,$stateParams){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}$scope.dateOptions={formatYear:"yy",startingDay:1},"undefined"!==$cookieStore.get("userInfo")?$cookieStore.get("userInfo"):"fail",$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={Patient_Id:Patient_ID,CalId:CalID};var oriInfo=angular.copy($scope.info);$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonUQForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.checkUseRespirator=function(value){1==value&&($scope.info.isEyeIrritation=null,$scope.info.isSkinAllergies=null,$scope.info.isAnxiety=null,$scope.info.isGeneralWeakness=null,$scope.info.isOtherProblem=null)},DocumentService.checkUser(Patient_ID,CalID).then(function(response){
if("fail"===response[0].status)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error");else if("findNull"===response[0].status){var date=new Date;$scope.isNew=!0,$scope.maxDate=new Date(date.getFullYear()-1,date.getMonth(),date.getDate())}else"findFound"===response[0].status?$scope.isNew=!1:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error"));var data=response[0].data;$scope.info={Quest_Id:data.Quest_Id,Patient_Id:Patient_ID,age:getAge($scope.patientInfo.DOB),sex:$scope.patientInfo.Sex,TodayDate:data.TodayDate||new Date,Height:data.Height,Weight:data.Weight,JobTitle:data.JobTitle,PhoneNumber:data.PhoneNumber,BestTime:data.BestTime,isReviewQuest:data.isReviewQuest,isNRP:data.isNRP,isOtherType:data.isOtherType,isRespirator:data.isRespirator,RespiratorType:data.RespiratorType,isSmoke:data.isSmoke,isSeizuresCondition:data.isSeizuresCondition,isDiabetes:data.isDiabetes,isAllergicReactions:data.isAllergicReactions,isClaustrophobia:data.isClaustrophobia,isTrouble:data.isTrouble,isAsbestosis:data.isAsbestosis,isAsthma:data.isAsthma,isBronchitis:data.isBronchitis,isEmphysema:data.isEmphysema,isPneumonia:data.isPneumonia,isTuberculosis:data.isTuberculosis,isSilicosis:data.isSilicosis,isPneumothorax:data.isPneumothorax,isLungCancer:data.isLungCancer,isBrokenRibs:data.isBrokenRibs,isInjuries:data.isInjuries,isOtherLung:data.isOtherLung,OtherLungComment:data.OtherLungComment,isSOB:data.isSOB,isSOBWalkingFast:data.isSOBWalkingFast,isSOBWalkingOther:data.isSOBWalkingOther,isStopForBreath:data.isStopForBreath,isSOBWashing:data.isSOBWashing,isSOBInterferes:data.isSOBInterferes,isCoughingPhlegm:data.isCoughingPhlegm,isCoughingMorning:data.isCoughingMorning,isCoughingLyingDown:data.isCoughingLyingDown,isCoughingUpBlood:data.isCoughingUpBlood,isWheezing:data.isWheezing,isWheezingInterferes:data.isWheezingInterferes,isChestPain:data.isChestPain,isOtherSymptomsPulmonary:data.isOtherSymptomsPulmonary,isHeartAttack:data.isHeartAttack,isStroke:data.isStroke,isAngina:data.isAngina,isHeartFailure:data.isHeartFailure,isSwelling:data.isSwelling,isHeartArrhythmia:data.isHeartArrhythmia,isBloodPressureHeart:data.isBloodPressureHeart,isOtherHeart:data.isOtherHeart,OtherHeartComment:data.OtherHeartComment,isFrequentPain:data.isFrequentPain,isPOTPhysical:data.isPOTPhysical,isPOTInterferes:data.isPOTInterferes,isMissingBeat:data.isMissingBeat,isHeartburn:data.isHeartburn,isOtherSymptomsHeart:data.isOtherSymptomsHeart,isBreathing:data.isBreathing,isHeartTrouble:data.isHeartTrouble,isBloodPressureMedication:data.isBloodPressureMedication,isSeizuresMedication:data.isSeizuresMedication,isEyeIrritation:data.isEyeIrritation,isSkinAllergies:data.isSkinAllergies,isAnxiety:data.isAnxiety,isGeneralWeakness:data.isGeneralWeakness,isOtherProblem:data.isOtherProblem,isTalk:data.isTalk,isLostVision:data.isLostVision,isContactLenses:data.isContactLenses,isWearGlasses:data.isWearGlasses,isColourBlind:data.isColourBlind,isOtherEye:data.isOtherEye,isInjuryEars:data.isInjuryEars,isHearingProblems:data.isHearingProblems,isDifficultyHearing:data.isDifficultyHearing,isHearingAid:data.isHearingAid,isOtherHearing:data.isOtherHearing,isBackInjury:data.isBackInjury,isWeaknessAny:data.isWeaknessAny,isBackPain:data.isBackPain,isDFMArmsLegs:data.isDFMArmsLegs,isDFMHead:data.isDFMHead,isPOSLeanForward:data.isPOSLeanForward,isPODHead:data.isPODHead,isDifficultyBending:data.isDifficultyBending,isDifficultySquatting:data.isDifficultySquatting,isClimbing:data.isClimbing,isOtherMuscle:data.isOtherMuscle,Department:data.Department,SocialSecurity:data.SocialSecurity,Supervisor:data.Supervisor,isAtmosphere:data.isAtmosphere,isContinuous:data.isContinuous,isOpen:data.isOpen,isClose:data.isClose,isSupplied:data.isSupplied,isCombination:data.isCombination,isAir_NonPow:data.isAir_NonPow,isAir_Pow:data.isAir_Pow,LevelOfWE:data.LevelOfWE,ExtentUsage:data.ExtentUsage,LengthOfTime:data.LengthOfTime,WorkCons:data.WorkCons,Safety:data.Safety,HealthCare:data.HealthCare,Class:data.Class,Restrictions:data.Restrictions,UQDate:data.UQDate||new Date,Created_by:data.Created_by,Creation_date:data.Creation_date,Last_updated_by:data.Last_updated_by,Last_update_date:data.Last_update_date,CalId:CalID,DocId:response[0].doctor.doctor_id,SIGNATURE:data.SIGNATURE,isUseRespirator:data.isUseRespirator,patient:response[0].patient,doctor:response[0].doctor},oriInfo=angular.copy($scope.info)}),$scope.submitGorgonUQ=function(gorgonUQForm){$scope.showClickedValidation=!0,gorgonUQForm.$error.required||gorgonUQForm.$error.pattern?toastr.error("Please Input All Required Information!","Error"):1==$scope.isNew?DocumentService.insertUQ($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonUQ",null,{reload:!0})):toastr.error("Fail","Error")}):0==$scope.isNew&&DocumentService.updateUQ($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonUQ",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.demo.controllers",[]).controller("demoController",function($scope,MODE_ROW,$filter,DocumentService,$http,$cookieStore,$state,toastr,localStorageService){$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.loadList()},$scope.loadList=function(){DocumentService.loadPatient($scope.searchObjectMap).then(function(response){"fail"!=response[status]?$scope.list=response:toastr.error("loading fail")})},$scope.goToTimetableDetail=function(list){localStorageService.set("tempPatient",list),$state.go("loggedIn.Detail")};var init=function(){$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,data:{NAME:"",Email:"",Phone:null}},$scope.rows=MODE_ROW,$scope.searchPatientsObject={doctor_id:0,limit:10,offset:0,maxSize:5,currentPage:1,data:{First_name:"",Sur_name:"",Middle_name:"",Post_code:null}},$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.list={},$scope.loadList(),$scope.dateOptions={formatYear:"yy",startingDay:1}};init()}),angular.module("app.loggedIn.document.detail.controllers",[]).controller("detailController",function($scope,$filter,DocumentService,$http,$cookieStore,$state,localStorageService){$scope.patient=localStorageService.get("tempPatient")}),angular.module("app.loggedIn.document.addPatient.controllers",[]).controller("addPatientController",function($scope,$filter,PatientService,ReceptionistService,toastr,$http,$cookieStore,$state,ConfigService){$scope.params={permission:{create:!0,edit:!1}},$scope.modelObjectMap={},$scope.modelObject={Title:"Mr",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:null,Country:"AU",DOB:"",Sex:"Male",Home_phone:null,Work_phone:null,Mobile:null,No_SMS:"0",Account_type:"",Account_holder:"",Account_Seft:null,Medicare_no:null,Ref:null,Exp_medicare:"",Private_fund_id:"",MemberShip_no:null,UPI:null,HCC_Pension_No:null,Exp_pension:"",DVA_No:null,Balance:null,Pays_Gap_Only:"1",Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:null},$scope.options={titles:ConfigService.title_option(),sexes:ConfigService.sex_option(),sms:ConfigService.yes_no_option(),countries:ConfigService.country_option(),gaps:ConfigService.yes_no_option(),acc_types:ConfigService.acc_type_option(),app_types:ConfigService.app_type_option()};var init=function(){$scope.modelObjectMap=angular.copy($scope.modelObject)};init(),$scope.insert_step=1,$scope.isSubmit=!1;var reset=function(){$scope.insert_step=1,$scope.modelObjectMap=angular.copy($scope.modelObject)};$scope.insertNextStep=function(form){switch($scope.isSubmit=!0,$scope.insert_step){case 1:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 2:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 3:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.modelObjectMap.DOB=ConfigService.getCommonDateDatabase($scope.modelObjectMap.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_pension),PatientService.insertPatient({patient:$scope.modelObjectMap}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),toastr.success("Insert Successfully !!!","Success"),void $state.go("loggedIn.demo"))}),$scope.isSubmit=!1)}},$scope.insertBackStep=function(){$scope.insert_step>1&&$scope.insert_step--}}),angular.module("app.loggedIn.document.COE.controllers",[]).controller("COEController",function($scope,$state,DocumentService,$http,$stateParams,$cookieStore,toastr,localStorageService,$filter){var tempSignature,insert=!0;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature1=tempSignature},$scope.clearClick=function(){$scope.info.Signature1=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature1};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.Signature2=tempSignature1},$scope.clearClick1=function(){$scope.info.Signature2=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.Signature2},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,date=new Date;$filter("date")(date,"dd/MM/yyyy"),$scope.info={coe_id:null,DocId:null,DOCTOR_ID:null,CalId:CalID,PatientId:Patient_ID,isEmployed:null,dateEmployed:date,inPosition:null,Signature1:null,coeName:null,coeTitle:null,coeDate:date,Signature2:null};var oriInfo=angular.copy($scope.info);$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.COEForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},DocumentService.checkCOE(Patient_ID,CalID).then(function(response){"fail"===response.status?(insert=!0,$scope.isNew=!0):(insert=!1,$scope.isNew=!1,$scope.info=response,console.log($scope.info),oriInfo=angular.copy($scope.info))}),$scope.submitCOE=function(COEForm){if($scope.showClickedValidation=!0,COEForm.$invalid)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;if(1==insert)DocumentService.insertCOE(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.COE",null,{reload:!0})):toastr.error("Add new fail!","Error")});else{var info=$scope.info;DocumentService.updateCOE(info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.COE",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}}}),angular.module("app.loggedIn.document.newFA.controllers",[]).controller("newFAController",function($scope,$stateParams,$cookieStore,DocumentService,PatientService,toastr,moment){$scope.editMode=null;var fa_id=1*$stateParams.fa_id,patient_id=1*$stateParams.patient_id,cal_id=1*$stateParams.cal_id;$scope.print_fa_id=fa_id,$scope.print_patient_id=patient_id,$scope.print_cal_id=cal_id,$scope.patient_age=null,$scope.header={},$scope.header.Comments="Meet all manual handling requirements with good technique.",$scope.header.ASSESSED_DATE=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.patient_info={},$scope.isSignatureShow=!1,$scope.clickedValidation=!1;var getNewFA=function(fa_id){var getHeaderId=fa_id;DocumentService.loadNewHeaderSections(getHeaderId).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.PATIENT_ID=patient_id,$scope.header.CAL_ID=cal_id,$scope.header.ASSESSED_SIGN="",$scope.header.ASSESSED_DATE=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.header.Comments="Meet all manual handling requirements with good technique.",getDoctorInfo(cal_id,patient_id),$scope.header.sections.forEach(function(section){section.PATIENT_ID=patient_id,section.CAL_ID=cal_id,DocumentService.loadNewLines(section.SECTION_ID,getHeaderId).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){if(line.PATIENT_ID=patient_id,line.CAL_ID=cal_id,null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}DocumentService.loadNewCommentsAndDetails(line.LINE_ID).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,line.details.forEach(function(detail){if(detail.PATIENT_ID=patient_id,detail.CAL_ID=cal_id,null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}(7===line.SCORE_TYPE1||9===line.SCORE_TYPE1)&&$scope.autoCalculationVal1(line,detail)}),line.comments.forEach(function(comment){comment.PATIENT_ID=patient_id,comment.CAL_ID=cal_id}))})}))})}))})},getExistFA=function(fa_id,patient_id,cal_id){var getHeaderId=fa_id;DocumentService.loadExistHeaderSections(getHeaderId,patient_id,cal_id).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.ASSESSED_DATE=moment($scope.header.ASSESSED_DATE).format("YYYY-MM-DD hh:mm:ss"),$scope.header.sections.forEach(function(section){DocumentService.loadExistLines(section.SECTION_ID,getHeaderId,patient_id,cal_id).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){if(null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}DocumentService.loadExistCommentsAndDetails(line.LINE_ID,patient_id,cal_id).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,line.details.forEach(function(detail){if(null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}}))})}))})}))})},getPatientInfo=function(patient_id){PatientService.getById(patient_id).then(function(result){null!==result&&(console.log("this is patient info",result),result.Sex="0"===result.Sex?"Male":"Female",$scope.patient_info=result,getPatientAge($scope.patient_info.DOB))})},getDoctorInfo=function(cal_id,patient_id){var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this assessment have no doctor link with it","Error!"):($scope.header.ASSESSED_NAME=result.data[0].Booking_Person,$scope.header.ASSESSED_SIGN=result.data[0].Signature)})},getPatientAge=function(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,console.log("this is patient age",age),$scope.patient_age=age},checkExistFA=function(fa_id,patient_id,cal_id){DocumentService.checkExistFA(fa_id,patient_id,cal_id).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error!"):"not existed"===result.status?(getNewFA(fa_id),$scope.editMode=!1):(getExistFA(fa_id,patient_id,cal_id),$scope.editMode=!0)})},init=function(){checkExistFA(fa_id,patient_id,cal_id),getPatientInfo(patient_id)};init();var calculateFunctionsVal1={calAvg:function(line){for(var sum=0,numberOfValue=0,i=0;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&(sum+=1*line.details[i].VAL1_VALUE,numberOfValue++);line.SCORE1=sum/numberOfValue,autoRatingVal1(line,line.SCORE1,0)},calMax:function(line){for(var max=1*line.details[0].VAL1_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&1*line.details[i].VAL1_VALUE>max&&(max=1*line.details[i].VAL1_VALUE);line.SCORE1=max,autoRatingVal1(line,line.SCORE1,0)},calMin:function(line){for(var min=1*line.details[0].VAL1_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&1*line.details[i].VAL1_VALUE<min&&(min=1*line.details[i].VAL1_VALUE);line.SCORE1=min,autoRatingVal1(line,line.SCORE1,0)}};$scope.autoCalculationVal1=function(line,detail){if(void 0!==detail&&(4===detail.VAL1_ISCHECKBOX||5===detail.VAL1_ISCHECKBOX)){line.RATING_VALUE1=0;for(var i=0;i<line.details.length;i++)if(4===line.details[i].VAL1_ISCHECKBOX)switch(line.details[i].VAL1_CHECKBOX){default:case"0":case"1":line.RATING_VALUE1+=0;break;case"2":line.RATING_VALUE1+=1}else if(5===line.details[i].VAL1_ISCHECKBOX)switch(line.details[i].VAL1_CHECKBOX){default:case"0":line.RATING_VALUE1+=0;break;case"1":line.RATING_VALUE1+=1;break;case"2":line.RATING_VALUE1+=2}switch(line.RATING_VALUE1){default:case 0:line.RATE1="";break;case 1:line.RATE1="Poor";break;case 2:line.RATE1="Fair";break;case 3:line.RATE1="Good";break;case 4:line.RATE1="Excellent"}autoSummary(line)}if(9!==line.SCORE_TYPE1||7!==detail.VAL1_ISVALUE&&8!==detail.VAL1_ISVALUE&&9!==detail.VAL1_ISVALUE&&10!==detail.VAL1_ISVALUE){if(7===line.SCORE_TYPE1&&(7===detail.VAL1_ISVALUE||8===detail.VAL1_ISVALUE||9===detail.VAL1_ISVALUE||10===detail.VAL1_ISVALUE)){var default_details_value=line.details[0].VAL1_VALUE,start_value=5;7!==line.details[0].VAL1_ISVALUE&&8!==line.details[0].VAL1_ISVALUE&&9!==line.details[0].VAL1_ISVALUE&&10!==line.details[0].VAL1_ISVALUE||2!==line.details.length||(line.details[1].VAL1_VALUE=angular.copy(default_details_value))}}else{var default_details_value=line.details[0].VAL1_VALUE,start_value=5;if(2===line.details)line.details[1].VAL1_VALUE=angular.copy(default_details_value);else for(var i=1;i<line.details.length;i++)line.details[i].VAL1_VALUE=angular.copy(start_value),default_details_value>start_value&&(start_value+=5)}if(1===line.ISSCORE1)switch(line.SCORE_TYPE1){case 3:calculateFunctionsVal1.calAvg(line);break;case 9:line.SCORE1=line.details[line.details.length-1].VAL1_VALUE;break;case 10:calculateFunctionsVal1.calMax(line);break;case 11:calculateFunctionsVal1.calMin(line);break;case 8:autoRatingVal1(line,1*line.SCORE1,0);break;case 12:break;default:line.SCORE1=line.details[line.details.length-1].VAL1_VALUE,autoRatingVal1(line,line.SCORE1,0)}};var calculateFunctionsVal2={calAvg:function(line){for(var sum=0,numberOfValue=0,i=0;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&(sum+=1*line.details[i].VAL2_VALUE,numberOfValue++);line.SCORE2=sum/numberOfValue,autoRatingVal2(line,line.SCORE2)},calMax:function(line){for(var max=1*line.details[0].VAL2_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&1*line.details[i].VAL2_VALUE>max&&(max=1*line.details[i].VAL2_VALUE);line.SCORE2=max,autoRatingVal2(line,line.SCORE2)},calMin:function(line){for(var min=1*line.details[0].VAL2_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&1*line.details[i].VAL2_VALUE<min&&(min=1*line.details[i].VAL2_VALUE);line.SCORE2=min,autoRatingVal2(line,line.SCORE2)}};$scope.autoCalculationVal2=function(line){if(1===line.ISSCORE2)switch(line.SCORE_TYPE1){case 3:calculateFunctionsVal2.calAvg(line);break;case 9:line.SCORE2=line.details[line.details.length-1].VAL2_VALUE;break;case 10:calculateFunctionsVal2.calMax(line);break;case 11:calculateFunctionsVal2.calMin(line);break;case 8:autoRatingVal2(line,line.SCORE2);break;default:line.SCORE2=line.details[line.details.length-1].VAL2_VALUE,autoRatingVal2(line,1*line.SCORE2)}};var autoRatingVal1=function(line,valueToRate,totalMode){if(null!==line.RATING_ID1&&""!==line.RATING_ID1){var ratingData={patient_age:$scope.patient_age,patient_gender:$scope.patient_info.Sex,valueToRate:valueToRate,rating_id:line.RATING_ID1};DocumentService.autoRating(ratingData).then(function(result){console.log("this is result",result),"error"===result.status?toastr.error("Something wrong with auto rating function.","Error!"):"unrated"===result.status?(line.RATE1="UNRATED",1!==totalMode&&(line.RATING_VALUE1=null,autoSummary(line))):3===line.SCORE_TYPE1?(console.log("rating result",result),line.RATE1=result.data[0].RATE,line.RATING_VALUE1=line.SCORE1<result.data[0].FROM_VALUE?1:line.SCORE1>result.data[0].TO_VALUE?3:2):(line.RATE1=result.data[0].RATE,1!==totalMode&&(line.RATING_VALUE1=result.data[0].VALUE,autoSummary(line)))})}else if(8===line.SCORE_TYPE1)switch(valueToRate){case 4:line.RATE1="Excellent",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 3:line.RATE1="Good",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 2:line.RATE1="Fair",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 1:line.RATE1="Poor",line.RATING_VALUE1=valueToRate,autoSummary(line)}},autoRatingVal2=function(line,valueToRate){if(null!==line.RATING_ID2&&""!==line.RATING_ID2){var ratingData={patient_age:$scope.patient_age,patient_gender:$scope.patient_info.Sex,valueToRate:line.SCORE2,rating_id:line.RATING_ID2};DocumentService.autoRating(ratingData).then(function(result){"error"===result.status?toastr.error("Something wrong with auto rating function.","Error!"):"unrated"===result.status?(line.RATE2="UNRATED",line.RATING_VALUE2=null):3===line.SCORE_TYPE1?(console.log("rating result",result),line.RATE2=result.data[0].RATE,line.RATING_VALUE2=line.SCORE2<result.data[0].FROM_VALUE?1:line.SCORE2>result.data[0].TO_VALUE?3:2):(line.RATE2=result.data[0].RATE,line.RATING_VALUE2=result.data[0].VALUE)})}else if(8===line.SCORE_TYPE2)switch(valueToRate){case 4:line.RATE2="Excellent",line.RATING_VALUE2=4;break;case 3:line.RATE2="Good",line.RATING_VALUE2=3;break;case 2:line.RATE2="Fair",line.RATING_VALUE2=2;break;case 1:line.RATE2="Poor",line.RATING_VALUE2=1}},autoSummary=function(line){for(var sectionId=line.SECTION_ID,lineId=line.LINE_ID,detailNeedChanged={},lineTotalInSummary={},i=0;i<$scope.header.sections.length;i++)if($scope.header.sections[i].SECTION_ID===sectionId){for(var j=0;j<$scope.header.sections[i].lines.length;j++)if(1===$scope.header.sections[i].lines[j].LineType){lineTotalInSummary=$scope.header.sections[i].lines[j];for(var k=0;k<$scope.header.sections[i].lines[j].details.length;k++)if($scope.header.sections[i].lines[j].details[k].LineTestRefer===lineId){detailNeedChanged=$scope.header.sections[i].lines[j].details[k];break}break}break}detailNeedChanged.VAL1_VALUE=line.RATING_VALUE1,detailNeedChanged.VAL2_VALUE=line.RATE1;for(var lineTotal=0,m=0;m<lineTotalInSummary.details.length;m++)lineTotal+=null!==lineTotalInSummary.details[m].VAL1_VALUE&&""!==lineTotalInSummary.details[m].VAL1_VALUE?1*lineTotalInSummary.details[m].VAL1_VALUE:0;lineTotalInSummary.RATING_VALUE1=lineTotal;var totalMode=1;console.log("this is lineTotalInSummary",lineTotalInSummary),autoRatingVal1(lineTotalInSummary,1*lineTotalInSummary.RATING_VALUE1,totalMode)};$scope.showSignature=function(){$scope.isSignatureShow=!0},$scope.okClick=function(){$scope.isSignatureShow=!1},$scope.cancelClick=function(){$scope.isSignatureShow=!1},$scope.clearClick=function(){$scope.header.PATIENT_SIGN=""},$scope.newFASubmit=function(){if($scope.clickedValidation=!0,$scope.FAForm.$invalid)toastr.error("Invalid fields!","Error!");else{var insertInfo=getInsertInformation($scope.header);console.log("this is insert info",insertInfo),DocumentService.insertNewFA(insertInfo).then(function(result){"success"===result.status?($scope.editMode=!0,toastr.success("Functional Assessment Submitted!","Success!"),init()):toastr.error("Failed to submit functional assessment!","Error!")})}},$scope.faUpdate=function(){if($scope.clickedValidation=!0,$scope.FAForm.$invalid)toastr.error("Invalid fields!","Error!");else{var updateInfo=getInsertInformation($scope.header);DocumentService.updateNewFA(updateInfo,patient_id,cal_id).then(function(result){"success"===result.status?toastr.success("Functional assessment updated!","Success!"):toastr.error("Failed to update functional assessment!","Error!")})}};var getInsertInformation=function(header){var insertHeader={},insertSections=[],insertLines=[],insertDetails=[],insertComments=[],dateFormatString="YYYY-MM-DD hh:mm:ss",tmpHeader=angular.copy(header);delete tmpHeader.sections,tmpHeader.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpHeader.Creation_date).format(dateFormatString),tmpHeader.Last_update_date=moment().format(dateFormatString),insertHeader=tmpHeader;for(var i=0;i<header.sections.length;i++){var tmpSection=angular.copy(header.sections[i]);delete tmpSection.lines,tmpSection.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpSection.Creation_date).format(dateFormatString),tmpSection.Last_update_date=moment().format(dateFormatString),insertSections.push(tmpSection);for(var j=0;j<header.sections[i].lines.length;j++){var tmpLine=angular.copy(header.sections[i].lines[j]);delete tmpLine.details,delete tmpLine.comments,delete tmpLine.previewPath,tmpLine.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpLine.Creation_date).format(dateFormatString),tmpLine.Last_update_date=moment().format(dateFormatString),insertLines.push(tmpLine);for(var k=0;k<header.sections[i].lines[j].details.length;k++){var tmpDetail=angular.copy(header.sections[i].lines[j].details[k]);delete tmpDetail.previewPath,tmpDetail.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpDetail.Creation_date).format(dateFormatString),tmpDetail.Last_update_date=moment().format(dateFormatString),insertDetails.push(tmpDetail)}for(var m=0;m<header.sections[i].lines[j].comments.length;m++){var tmpComment=angular.copy(header.sections[i].lines[j].comments[m]);tmpComment.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpComment.Creation_date).format(dateFormatString),tmpComment.Last_update_date=moment().format(dateFormatString),insertComments.push(tmpComment)}}}var submitInformations={insertHeader:insertHeader,insertSections:insertSections,insertLines:insertLines,insertDetails:insertDetails,insertComments:insertComments};return submitInformations}}),angular.module("app.loggedIn.fadefine",["app.loggedIn.fadefine.controller","app.loggedIn.fadefine.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.fadefine",{"abstract":!0,templateUrl:"modules/fadefine/views/home.html",controller:"FaDefineController"}).state("loggedIn.fadefine.list",{url:"/fa/list",views:{"main-content":{templateUrl:"modules/fadefine/views/list.html",controller:"FaDefineListController"}}}).state("loggedIn.fadefine.detail",{url:"/fa/:action/:headerId",views:{"main-content":{templateUrl:"modules/fadefine/views/detail.html",controller:"FaDefineDetailController"}}})}),angular.module("app.loggedIn.fadefine.controller",["app.loggedIn.fadefine.list.controller","app.loggedIn.fadefine.detail.controller","app.loggedIn.fadefine.imageDialog.controller"]).controller("FaDefineController",function($scope){}),angular.module("app.loggedIn.fadefine.list.controller",[]).controller("FaDefineListController",function($scope,$state,FaDefineService,toastr){$scope.fa_panel={},$scope.clickRow=function(item){$state.go("loggedIn.fadefine.detail",{action:"edit",headerId:item.FA_ID})},$scope.fa={select:0,scope:$scope.fa_panel,options:{api:"api/erm/v2/fa/search",method:"post",scope:$scope.fa_panel,columns:[{field:"FA_ID",is_hide:!0},{field:"TYPE",label:"Type"},{field:"FA_NAME",label:"Name"},{label:"Status",type:"status",isEnable:function(item){return item.ISENABLE},disableFn:function($event,item){$event.stopPropagation(),console.log("run here 1"),FaDefineService.changeFaStt(0,item.FA_ID).then(function(res){"success"===res.status&&$scope.fa_panel.reload()})},enableFn:function($event,item){$event.stopPropagation(),console.log("run here 2"),FaDefineService.changeFaStt(1,item.FA_ID).then(function(res){"success"===res.status&&$scope.fa_panel.reload()})}},{type:"button",btnlabel:"Clone to new definition",btnclass:"fa fa-files-o",btnfn:function(item){$state.go("loggedIn.fadefine.detail",{action:"add",headerId:item.FA_ID})}}],use_filters:!0,filters:{TYPE:{type:"text"},FA_NAME:{type:"text"}}}},$scope.newDefine=function(){$state.go("loggedIn.fadefine.detail",{action:"add",headerId:0})}}),angular.module("app.loggedIn.fadefine.detail.controller",["ngDraggable"]).controller("FaDefineDetailController",function($scope,$stateParams,$state,$modal,ConfigService,FaHeaderModel,FaSectionModel,FaLineModel,FaLineDetailModel,FaCommentModel,FaDefineService,toastr,moment){$scope.isEdit="edit"===$stateParams.action?!0:!1,$scope.header=angular.copy(FaHeaderModel),$scope.header.ISENABLE=1,$scope.header.FA_NAME="Untitled Function Assessment Header",$scope.header.Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.header.sections=[];var section_init=angular.copy(FaSectionModel);section_init.ISENABLE=1,section_init.lines=[];var line_init=angular.copy(FaLineModel);line_init.ISENABLE=1,line_init.details=[],line_init.comments=[];var line_detail_init=angular.copy(FaLineDetailModel);line_detail_init.ISENABLE=1;var line_comment_init=angular.copy(FaCommentModel);if(line_comment_init.ISENABLE=1,$scope.oneAtATime=!1,$scope.score_type_opt=ConfigService.score_type_option(),$scope.comment_type_opt=ConfigService.comment_type_option(),$scope.value_type_opt=ConfigService.value_type_option(),ConfigService.rank_type_option().then(function(result){$scope.rating_type_opt=result.list}),$scope.isSectionDropable=!0,"edit"===$stateParams.action&&$stateParams.headerId){var getHeaderId=$stateParams.headerId;FaDefineService.getHeaderAndSection(getHeaderId).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.action="edit",$scope.header.sections.forEach(function(section){section.action="edit",FaDefineService.getLines(section.SECTION_ID,getHeaderId).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){if(null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}line.action="edit",FaDefineService.getDetailsAndComments(line.LINE_ID).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,
line.details.forEach(function(detail){if(detail.action="edit",null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}}),line.comments.forEach(function(comment){comment.action="edit"}))})}))})}))})}else if("add"===$stateParams.action&&0!==$stateParams.headerId){var getHeaderId=$stateParams.headerId;FaDefineService.getHeaderAndSection(getHeaderId).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.FA_ID=null,$scope.header.Created_by=null,$scope.header.Creation_date=null,$scope.header.Last_updated_by=null,$scope.header.Last_update_date=null,$scope.header.sections.forEach(function(section){var sectionId=angular.copy(section.SECTION_ID);section.SECTION_ID=null,section.FA_ID=null,section.Created_by=null,section.Creation_date=null,section.Last_updated_by=null,section.Last_update_date=null,FaDefineService.getLines(sectionId,getHeaderId).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){var lineId=angular.copy(line.LINE_ID);if(line.LINE_ID=null,line.SECTION_ID=null,line.FA_ID=null,line.Created_by=null,line.Creation_date=null,line.Last_updated_by=null,line.Last_update_date=null,null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}FaDefineService.getDetailsAndComments(lineId).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,line.details.forEach(function(detail){if(detail.DETAIL_ID=null,detail.LINE_ID=null,detail.Created_by=null,detail.Creation_date=null,detail.Last_updated_by=null,detail.Last_update_date=null,null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}}),line.comments.forEach(function(comment){comment.FA_COMMENT_ID=null,comment.LINE_ID=null,comment.Created_by=null,comment.Creation_date=null,comment.Last_updated_by=null,comment.Last_update_date=null}))})}))})}))})}$scope.addSection=function(){var newSection=angular.copy(section_init);$scope.isEdit===!0&&(newSection.action="add"),newSection.SECTION_NAME="Untitled Section",newSection.Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.header.sections.push(newSection)},$scope.removeSection=function(section){var indexToRemove=$scope.header.sections.indexOf(section);if($scope.isEdit===!1)$scope.header.sections.splice(indexToRemove,1);else if("add"===section.action)$scope.header.sections.splice(indexToRemove,1);else{section.action="delete";for(var k=0;k<section.lines.length;k++)if("add"===section.lines[k].action)section.lines.splice(k,1);else{section.lines[k].action="delete";for(var i=0;i<section.lines[k].details.length;i++)"add"===section.lines[k].details[i].action?section.lines[k].details.splice(i,1):section.lines[k].details[i].action="delete";for(var j=0;j<section.lines[k].comments.length;j++)"add"===section.lines[k].comments[j].action?section.lines[k].comments.splice(j,1):section.lines[k].comments[j].action="delete"}}},$scope.addLine=function(section){var newLine=angular.copy(line_init);$scope.isEdit===!0&&(newLine.action="add"),newLine.QUESTION="Untitled line",newLine.Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"),section.lines.push(newLine)},$scope.removeLine=function(section,line){var indexToRemove=section.lines.indexOf(line);if($scope.isEdit===!1)section.lines.splice(indexToRemove,1);else if("add"===line.action)section.lines.splice(indexToRemove,1);else{line.action="delete";for(var i=0;i<line.details.length;i++)"add"===line.details[i].action?line.details.splice(i,1):line.details[i].action="delete";for(var j=0;j<line.comments.length;j++)"add"===line.comments[j].action?line.comments.splice(j,1):line.comments[j].action="delete"}},$scope.addDetail=function(line){var newDetail=angular.copy(line_detail_init);$scope.isEdit===!0&&(newDetail.action="add"),newDetail.QUESTION="Untitled detail",newDetail.Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"),line.details.push(newDetail)},$scope.removeDetail=function(detail,line){var indexToRemove=line.details.indexOf(detail);$scope.isEdit===!1?line.details.splice(indexToRemove,1):"add"===detail.action?line.details.splice(indexToRemove,1):detail.action="delete"},$scope.addComment=function(line){var newComment=angular.copy(line_comment_init);$scope.isEdit===!0&&(newComment.action="add"),newComment.NAME="Untitled comment",line.comments.push(newComment)},$scope.removeComment=function(comment,line){var indexToRemove=line.comments.indexOf(comment);$scope.isEdit===!1?line.comments.splice(indexToRemove,1):"add"===comment.action?line.comments.splice(indexToRemove,1):comment.action="delete"},$scope.value1TypeWatch=function(detail,val1_type){0===val1_type?(detail.VAL1_ISVALUE=1,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null):-1===val1_type?(detail.VAL1_NAME=null,detail.VAL1_ISVALUE=null,detail.VAL1_VALUE=null,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null,detail.VAL1_ISCOMMENT_WHEN_YES=null,detail.VAL1_ISCOMMENT_WHEN_NO=null,detail.VAL1_VALUE_IS_NUMBER=null):7===val1_type?(detail.VAL1_ISVALUE=val1_type,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null,detail.VAL1_NAME="Weight",detail.VAL1_VALUE_IS_NUMBER=1):8===val1_type?(detail.VAL1_ISVALUE=val1_type,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null,detail.VAL1_NAME="Distance",detail.VAL1_VALUE_IS_NUMBER=1):9===val1_type?(detail.VAL1_ISVALUE=val1_type,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null,detail.VAL1_NAME="Height",detail.VAL1_VALUE_IS_NUMBER=1):10===val1_type?(detail.VAL1_ISVALUE=val1_type,detail.VAL1_ISCHECKBOX=null,detail.VAL1_CHECKBOX=null,detail.VAL1_NAME="Weight",detail.VAL1_VALUE_IS_NUMBER=1):(detail.VAL1_ISVALUE=null,detail.VAL1_VALUE_IS_NUMBER=null,detail.VAL1_ISCHECKBOX=val1_type),1!==val1_type&&(detail.VAL1_ISCOMMENT_WHEN_YES=null,detail.VAL1_ISCOMMENT_WHEN_NO=null),console.log($scope.header)},$scope.value2TypeWatch=function(detail,val2_type){0===val2_type?(detail.VAL2_ISVALUE=1,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null):-1===val2_type?(detail.VAL2_NAME=null,detail.VAL2_ISVALUE=null,detail.VAL2_VALUE=null,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null,detail.VAL2_ISCOMMENT_WHEN_YES=null,detail.VAL2_ISCOMMENT_WHEN_NO=null,detail.VAL2_VALUE_IS_NUMBER=null):7===val2_type?(detail.VAL2_ISVALUE=val2_type,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null,detail.VAL2_NAME="Weight",detail.VAL2_VALUE_IS_NUMBER=1):8===val2_type?(detail.VAL2_ISVALUE=val2_type,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null,detail.VAL2_NAME="Distance",detail.VAL2_VALUE_IS_NUMBER=1):9===val2_type?(detail.VAL2_ISVALUE=val2_type,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null,detail.VAL2_NAME="Height",detail.VAL2_VALUE_IS_NUMBER=1):10===val2_type?(detail.VAL2_ISVALUE=val2_type,detail.VAL2_ISCHECKBOX=null,detail.VAL2_CHECKBOX=null,detail.VAL2_NAME="Weight",detail.VAL2_VALUE_IS_NUMBER=1):(detail.VAL2_ISVALUE=null,detail.VAL2_VALUE_IS_NUMBER=null,detail.VAL2_ISCHECKBOX=val2_type),1!==val2_type&&(detail.VAL2_ISCOMMENT_WHEN_YES=null,detail.VAL2_ISCOMMENT_WHEN_NO=null)},$scope.value1TypeInit=function(detail){return("add"!==$stateParams.action||"add"===$stateParams.action&&0!==$stateParams.headerId)&&(0!==detail.VAL1_ISVALUE&&null!==detail.VAL1_ISVALUE||0!==detail.VAL1_ISCHECKBOX&&null!==detail.VAL1_ISCHECKBOX)?7===detail.VAL1_ISVALUE?7:8===detail.VAL1_ISVALUE?8:9===detail.VAL1_ISVALUE?9:10===detail.VAL1_ISVALUE?10:1===detail.VAL1_ISVALUE?0:detail.VAL1_ISCHECKBOX:-1},$scope.value2TypeInit=function(detail){return("add"!==$stateParams.action||"add"===$stateParams.action&&0!==$stateParams.headerId)&&(0!==detail.VAL2_ISVALUE&&null!==detail.VAL2_ISVALUE||0!==detail.VAL2_ISCHECKBOX&&null!==detail.VAL2_ISCHECKBOX)?7===detail.VAL2_ISVALUE?7:8===detail.VAL2_ISVALUE?8:9===detail.VAL2_ISVALUE?9:10===detail.VAL2_ISVALUE?10:1===detail.VAL2_ISVALUE?0:detail.VAL2_ISCHECKBOX:-1},$scope.IsCommentTextWatch=function(detail,IsCommentTextValue){"0"===IsCommentTextValue&&(detail.VAL1_ISCOMMENT_WHEN_YES=null,detail.VAL1_ISCOMMENT_WHEN_NO=null,detail.VAL2_ISCOMMENT_WHEN_YES=null,detail.VAL2_ISCOMMENT_WHEN_NO=null)},$scope.moveDetailUp=function(detail,line){var index=line.details.indexOf(detail);line.details.splice(index,1),line.details.splice(index-1,0,detail)},$scope.moveDetailDown=function(detail,line){var index=line.details.indexOf(detail);line.details.splice(index,1),line.details.splice(index+1,0,detail)},$scope.moveCommentUp=function(comment,line){var index=line.comments.indexOf(comment);line.comments.splice(index,1),line.comments.splice(index-1,0,comment)},$scope.moveCommentDown=function(comment,line){var index=line.comments.indexOf(comment);line.comments.splice(index,1),line.comments.splice(index+1,0,comment)},$scope.moveLineUp=function(line,section){var index=section.lines.indexOf(line);section.lines.splice(index,1),section.lines.splice(index-1,0,line)},$scope.moveLineDown=function(line,section){var index=section.lines.indexOf(line);section.lines.splice(index,1),section.lines.splice(index+1,0,line)},$scope.onSectionDropComplete=function(index,movedSection,event,replacedSection,header){var movedSection=movedSection,replacedSection=replacedSection,oldIndex=header.sections.indexOf(movedSection),newIndex=index;header.sections[oldIndex]=replacedSection,header.sections[newIndex]=movedSection},$scope.addFaDefinition=function(){0===$scope.header.sections.length?toastr.error("Functional Assessment must have at least one section","Error!"):addOrder($scope.header).then(function(result){FaDefineService.insertFa($scope.header).then(function(res){"success"===res.status?(toastr.success("New functional assessment definition added","Success!"),$state.go("loggedIn.fadefine.list")):toastr.error("Failed to add new functional assessment definition","Error!")})},function(error){console.log(error)})},$scope.editDefinition=function(){0===$scope.header.sections.length?toastr.error("Functional Assessment must have at least one section","Error!"):addOrder($scope.header).then(function(result){console.log(result),FaDefineService.editFa(result).then(function(res){"success"===res.status?(toastr.success("Edit successfully!","Success!"),$state.go("loggedIn.fadefine.list")):toastr.error("Edit failed!","Error!")})})};var addOrder=function(header){return new Promise(function(resolve,reject){$scope.isEdit===!1?header.Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"):(header.Creation_date=""===header.Creation_date?moment().format("YYYY-MM-DD hh:mm:ss"):moment(header.Creation_date).format("YYYY-MM-DD hh:mm:ss"),header.Last_update_date=moment().format("YYYY-MM-DD hh:mm:ss"));for(var i=0;i<header.sections.length;i++)if(header.sections[i].ORD=i+1,$scope.isEdit===!1?header.sections[i].Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"):(header.sections[i].Creation_date=""===header.sections[i].Creation_date?moment().format("YYYY-MM-DD hh:mm:ss"):moment(header.sections[i].Creation_date).format("YYYY-MM-DD hh:mm:ss"),header.sections[i].Last_update_date=moment().format("YYYY-MM-DD hh:mm:ss")),0===header.sections[i].lines.length){if(i!==header.sections.length-1)continue;resolve(header)}else for(var j=0;j<header.sections[i].lines.length;j++)if(header.sections[i].lines[j].ORD=j+1,header.sections[i].lines[j].previewPath&&delete header.sections[i].lines[j].previewPath,$scope.isEdit===!1?header.sections[i].lines[j].Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"):(header.sections[i].lines[j].Creation_date=""===header.sections[i].lines[j].Creation_date?moment().format("YYYY-MM-DD hh:mm:ss"):moment(header.sections[i].lines[j].Creation_date).format("YYYY-MM-DD hh:mm:ss"),header.sections[i].lines[j].Last_update_date=moment().format("YYYY-MM-DD hh:mm:ss")),0===header.sections[i].lines[j].details.length){if(j!==header.sections[i].lines.length-1||i!==header.sections.length-1)continue;resolve(header)}else for(var k=0;k<header.sections[i].lines[j].details.length;k++)header.sections[i].lines[j].details[k].ORD=k+1,header.sections[i].lines[j].details[k].previewPath&&delete header.sections[i].lines[j].details[k].previewPath,$scope.isEdit===!1?header.sections[i].lines[j].details[k].Creation_date=moment().format("YYYY-MM-DD hh:mm:ss"):(header.sections[i].lines[j].details[k].Creation_date=""===header.sections[i].lines[j].details[k].Creation_date?moment().format("YYYY-MM-DD hh:mm:ss"):moment(header.sections[i].lines[j].details[k].Creation_date).format("YYYY-MM-DD hh:mm:ss"),header.sections[i].lines[j].details[k].Last_update_date=moment().format("YYYY-MM-DD hh:mm:ss")),k===header.sections[i].lines[j].details.length-1&&j===header.sections[i].lines.length-1&&i===header.sections.length-1&&resolve(header)})};$scope.openModal=function(data){var modalInstance=$modal.open({animation:!0,templateUrl:"modules/fadefine/views/imageModal.html",controller:"ImageDialogController",size:"lg"});modalInstance.result.then(function(selectedImg){data.PICTURE=selectedImg.realPath,selectedImg.previewPath&&null!==selectedImg.previewPath&&""!==selectedImg.previewPath?data.previewPath=selectedImg.previewPath:delete data.previewPath})}}),angular.module("app.loggedIn.fadefine.imageDialog.controller",[]).controller("ImageDialogController",function($scope,$timeout,$modalInstance,FileUploader,FaDefineService,toastr){var getImages=function(){FaDefineService.getImageFiles().then(function(result){(result.status="success")?($scope.images=[],result.files.forEach(function(file){var image={realPath:".\\download\\documentImage\\"+file,previewPath:"https://"+location.host+"/document/fa/images/"+file};$scope.images.push(image),console.log($scope.images)})):toastr.error("Unexpected error when getting images.","Error")})};getImages(),$scope.info_upload={total_size:0,progress_percent:0,pre_progress_percent:0},$scope.uploader=new FileUploader({url:"/api/erm/v2/fa/upload_image",autoUpload:!0,removeAfterUpload:!0,filters:[{name:"img_filter",fn:function(item){return"image/jpeg"===item.type||"image/png"===item.type?!0:(toastr.error("Only jpg, jpeg and png allowed!","Error!"),!1)}}],onSuccessItem:function(item,response,status,headers){var uploaded_percent=100*item.file.size/$scope.info_upload.total_size;$scope.info_upload.pre_progress_percent+=uploaded_percent,console.log($scope.info_upload.pre_progress_percent)},onProgressItem:function(item,progress){var uploaded_size=progress*item.file.size/100,uploaded_percent=100*uploaded_size/$scope.info_upload.total_size;$scope.info_upload.progress_percent=$scope.info_upload.pre_progress_percent+uploaded_percent},onCompleteAll:function(res){$scope.info_upload={total_size:0,progress_percent:0,pre_progress_percent:0},getImages()},onAfterAddingAll:function(items){angular.forEach(items,function(f){$scope.info_upload.total_size+=f.file.size}),$scope.info_upload.step_size=$scope.info_upload.total_size/100}}),$scope.openUploader=function(){$timeout(function(){$("#image_upload").click()},100)},$scope.chooseImage=function(image){$modalInstance.close(image)},$scope.chooseNoImg=function(){var noImg={realPath:null,previewPath:null};$modalInstance.close(noImg)}}),angular.module("app.loggedIn.fadefine.service",[]).factory("FaDefineService",function(Restangular){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insertFa=function(postData){var faApi=v2_api.all("fa/insert");return faApi.post(postData)},instanceService.deleteFa=function(headerId){var deleteFaApi=v2_api.all("fa/delete");return deleteFaApi.post({id:headerId})},instanceService.getHeaderAndSection=function(headerId){var getHeaderAndSectionApi=v2_api.all("fa/get_header_and_sections");return getHeaderAndSectionApi.post({id:headerId})},instanceService.getLines=function(sectionId,headerId){var getLinesApi=v2_api.all("fa/get_lines");return getLinesApi.post({sectionId:sectionId,headerId:headerId})},instanceService.getDetailsAndComments=function(lineId){var getDetailsAndCommentsApi=v2_api.all("fa/get_details_and_comments");return getDetailsAndCommentsApi.post({lineId:lineId})},instanceService.editFa=function(postData){var editFaApi=v2_api.all("fa/edit");return editFaApi.post(postData)},instanceService.changeFaStt=function(status,headerId){var changeFaSttApi=v2_api.all("fa/change_header_stt");return changeFaSttApi.post({headerId:headerId,status:status})},instanceService.getImageFiles=function(){var getImagesApi=v2_api.all("fa/get_images");return getImagesApi.post()},instanceService}),angular.module("app.loggedIn.pr",["app.loggedIn.pr.controller","app.loggedIn.pr.service","app.loggedIn.pr.directive","app.loggedIn.pr.prImportTaxList.directive","app.loggedIn.pr.prTaxList.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.pr",{url:"/pr",templateUrl:"modules/hrPayroll/views/pr.html",controller:"prController"}).state("loggedIn.pr.prTaxList",{url:"/taxlist",templateUrl:"modules/hrPayroll/views/prTaxList.html",controller:"prTaxListController"})}),angular.module("app.loggedIn.pr.controller",[]).controller("prController",function($scope,prService){}),angular.module("app.loggedIn.pr.directive",[]),angular.module("app.loggedIn.pr.prImportTaxList.directive",[]).directive("prImportTaxList",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{},templateUrl:"modules/hrPayroll/directives/prImportTaxList.html",controller:function($scope,prService,FileUploader){var uploader=$scope.uploader=new FileUploader({url:"/api/pr/fornightly-tax/import-tax-list"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.info("onWhenAddingFileFailed",item,filter,options)},uploader.onAfterAddingFile=function(fileItem){uploader.queue.splice(0,uploader.queue.length-1),console.info("onAfterAddingFile",fileItem)},uploader.onAfterAddingAll=function(addedFileItems){console.info("onAfterAddingAll",addedFileItems)},uploader.onBeforeUploadItem=function(item){console.info("onBeforeUploadItem",item)},uploader.onProgressItem=function(fileItem,progress){console.info("onProgressItem",fileItem,progress)},uploader.onProgressAll=function(progress){console.info("onProgressAll",progress)},uploader.onSuccessItem=function(fileItem,response,status,headers){console.info("onSuccessItem",fileItem,response,status,headers)},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){console.info("onCancelItem",fileItem,response,status,headers)},uploader.onCompleteItem=function(fileItem,response,status,headers){console.info("onCompleteItem",fileItem,response,status,headers)},uploader.onCompleteAll=function(){console.info("onCompleteAll")},console.info("uploader",uploader),$scope.importTaxList=function(){uploader.uploadAll()}}}}),angular.module("app.loggedIn.pr.service",[]).factory("prService",function(Restangular,$http,$q,$window){var prService={},api=Restangular.all("api");return prService.taxList={getAllTaxListHeader:function(){var result=api.one("pr/fornightly-tax/get-all-taxlist-header");return result.get()},getTaxListDetail:function(taxHeaderId,startIndex,numberOfItems){var result=api.all("pr/fornightly-tax/get-taxlist-detail");return result.post({taxHeaderId:taxHeaderId,startIndex:startIndex,numberOfItems:numberOfItems})}},prService}),angular.module("app.loggedIn.pr.prTaxList.controller",[]).controller("prTaxListController",function($scope,prService){$scope.getAllTaxListHeader=function(){$scope.taxList=[],prService.taxList.getAllTaxListHeader().then(function(data){$scope.taxList="success"==data.status?data.data:[]},function(err){$scope.taxList=[]})},$scope.getAllTaxListHeader(),$scope.taxListDetail=[],$scope.getTaxListDetail=function(taxHeaderId){prService.taxList.getTaxListDetail(taxHeaderId).then(function(data){$scope.taxListDetail="success"==data.status?data.data:[]},function(err){$scope.taxListDetail=[]})},$scope.selectedTaxList={},$scope.setSelectedTaxList=function(item){$scope.selectedTaxList=item,$scope.taxListLoader=new TaxListDetailLoader(item.id,100),$scope.taxListLoader.loadMore()};var TaxListDetailLoader=function(taxHeaderId,numberOfItems){this.taxListDetail=[],this.busy=!1,this.after=-1,this.taxHeaderId=taxHeaderId,this.numberOfItems=numberOfItems};TaxListDetailLoader.prototype.loadMore=function(){this.busy||(this.busy=!0,prService.taxList.getTaxListDetail(this.taxHeaderId,this.after+1,this.numberOfItems).then(function(data){"success"==data.status&&(this.taxListDetail=this.taxListDetail.concat(data.data),this.after=this.after+data.data.length,this.busy=!1)}.bind(this),function(err){}))}}),angular.module("app.loggedIn.function",["app.loggedIn.function.controller","app.loggedIn.function.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.function",{url:"/functions",templateUrl:"modules/function/views/function.html",controller:"FunctionController"})}),angular.module("app.loggedIn.function.services",[]).factory("FunctionService",function(Restangular){var functionService={},api=Restangular.all("api");return functionService.getList=function(){var list=api.one("function/list");return list.get()},functionService.saveFunction=function(f){var saveApi=api.all("function/edit");return saveApi.post({f:f})},functionService.insertFunction=function(f){var insertApi=api.all("function/new");return insertApi.post({f:f})},functionService.delFunction=function(id){var del=api.all("function/delete");return del.post({id:id})},functionService.getFunctionInfo=function(id){var info=api.all("function/id");return info.post({id:id})},functionService}),angular.module("app.loggedIn.function.controller",[]).controller("FunctionController",function($scope,$state,$modal,$filter,ngTableParams,FunctionService,$http,toastr){$scope.data=[],$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.tableParams=new ngTableParams({page:1,count:10},{total:response.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.editFunction=function(f){var modalInstance=$modal.open({templateUrl:"modules/function/views/functionDetails.html",controller:"EditFunctionController",size:"md",resolve:{functionId:function(){return f.function_id}}});modalInstance.result.then(function(){$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})},$scope.deleteFunction=function(f){FunctionService.delFunction(f.function_id).then(function(data){"success"===data.status?($scope.rs=[],toastr.success("Delete Function Successfully!","Success"),FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})):toastr.error("Delete Function Failed!","Error")})},$scope.addNewFunction=function(){var modalInstance=$modal.open({templateUrl:"modules/function/views/functionDetails.html",controller:"NewFunctionController",size:"md"});modalInstance.result.then(function(){$scope.rs=[],FunctionService.getList().then(function(response){$scope.data=response,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})}}).controller("NewFunctionController",function($scope,$filter,$state,$modalInstance,FunctionService,toastr){$scope.info={decription:null,definition:null,isWeb:"1",isMobile:"0"},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submitFunction=function(){$scope.showClickedValidation=!0,$scope.functionForm.$invalid?toastr.error("Please Input All Required Information!","Error"):FunctionService.insertFunction($scope.info).then(function(response){"success"===response.status?(toastr.success("Insert New Function Successfully!","Success"),$modalInstance.close()):toastr.error("Insert New Function Failed!","Error")})}}).controller("EditFunctionController",function($scope,$filter,$state,$modalInstance,FunctionService,functionId,toastr){$scope.info={function_id:functionId,decription:null,definition:null,isWeb:null,isMobile:null},FunctionService.getFunctionInfo(functionId).then(function(data){console.log(data),$scope.info=data,$scope.info.isWeb=1==data.isWeb?"1":"0",$scope.info.isMobile=1==data.isMobile?"1":"0"}),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submitFunction=function(){$scope.showClickedValidation=!0,$scope.functionForm.$invalid?toastr.error("Please Input All Required Information!","Error"):FunctionService.saveFunction($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit Function Successfully!","Success"),$modalInstance.close()):toastr.error("Edit Function Failed!","Error")})}}),angular.module("app.loggedIn.patient.injuryManagement",["app.loggedIn.patient.injuryManagement.map.controller","app.loggedIn.patient.injuryManagement.detail.controller","app.loggedIn.patient.injuryManagement.list.controller","app.loggedIn.patient.injuryManagement.bluetooth.controller","app.loggedIn.patient.injuryManagement.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.im_Map",{url:"/im/maps",views:{"main-content":{templateUrl:"modules/injuryManagement/views/injuryMap.html",controller:"InjuryMapController"}}}).state("loggedIn.patient.im_List",{url:"/im/list",views:{"main-content":{templateUrl:"modules/injuryManagement/views/injuryList.html",controller:"InjuryListController"}}}).state("loggedIn.patient.im_Bluetooth",{url:"/im/bluetooth",views:{"main-content":{templateUrl:"modules/injuryManagement/views/bluetooth.html",controller:"BluetoothController"}}}).state("loggedIn.patient.im_Detail",{url:"/im/details/:id",views:{"main-content":{templateUrl:"modules/injuryManagement/views/injuryDetails.html",controller:"InjuryDetailController"}}})}),angular.module("app.loggedIn.patient.injuryManagement.map.controller",[]).controller("InjuryMapController",function($scope,$filter,$state,InjuryManagementService,UserService,toastr,socket,$interval){function refreshMap(){$scope.injuryMarker=[],InjuryManagementService.getInjuryList().then(function(rs){if("success"==rs.status)for(var i=0;i<rs.data.length;i++)if("New"==rs.data[i].STATUS||"Waiting"==rs.data[i].STATUS){var icon,patient=rs.data[i],positionArr=[];null!=patient.latitude&&positionArr.push(patient.latitude),null!=patient.longitude&&positionArr.push(patient.longitude),"Waiting"==patient.STATUS?icon="modules/injuryManagement/icons/icon-orange.png":"New"==patient.STATUS&&(icon="modules/injuryManagement/icons/icon-blue.png"),$scope.patientData={id:patient.injury_id,patientId:patient.Patient_id,position:positionArr,pickupAddr:patient.pickup_address,FullName:patient.FullName,gender:patient.Sex,injuryDesc:patient.injury_description,status:patient.STATUS,icon:icon,driverUser:patient.driverUser,driverName:patient.driverName},$scope.injuryMarker.push($scope.patientData)}})}function refreshList(){$scope.search.patient="",$scope.search.driver="",$scope.search.dateRange=null,InjuryManagementService.getInjuryList().then(function(rs){if("success"==rs.status){for(var j=0;j<rs.data.length;j++)rs.data[j].background=colors[Math.floor(Math.random()*colors.length)],(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp}})}function getOnlineDriver(){InjuryManagementService.listDriver().then(function(rs){$scope.driverListTemp=[],rs.data&&($scope.driverListTemp=rs.data)})}function filterDate(from,to){$scope.injuryList=[],$scope.injuryListTemp=[],InjuryManagementService.searchByDate(from,to).then(function(rs){if("success"==rs.status){for(var j=0;j<rs.data.length;j++)rs.data[j].background=colors[Math.floor(Math.random()*colors.length)],(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp}})}$scope.injuryMarker=[],$scope.driverMarker=[],$scope.driverListTemp=[],$scope.injuryList=[],$scope.injuryListTemp=[],$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.map={driverId:null},$scope.search={patient:"",driver:"",isNew:!0,isWaiting:!0,isDone:!0,dateRange:null},$scope.searchInjury=function(s){$scope.injuryList=$filter("filter")($scope.injuryListTemp,{driverUser:s.driver,FullName:s.patient})},$scope.getDateRange=function(range){filterDate($filter("date")(range.start.toDate(),"yyyy-MM-dd"),$filter("date")(range.end.toDate(),"yyyy-MM-dd")),$scope.search.patient="",$scope.search.driver=""},getOnlineDriver();var colors=["#FF5E3A","#FF9500","#FFDB4C","#87FC70","#52EDC7","#1AD6FD","#C644FC","#898C90"];InjuryManagementService.getInjuryList().then(function(rs){if("success"==rs.status){for(var j=0;j<rs.data.length;j++)rs.data[j].background=colors[Math.floor(Math.random()*colors.length)],(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp;for(var i=0;i<rs.data.length;i++)if("New"==rs.data[i].STATUS||"Waiting"==rs.data[i].STATUS){var icon,patient=rs.data[i],positionArr=[];null!=patient.latitude&&positionArr.push(patient.latitude),null!=patient.longitude&&positionArr.push(patient.longitude),"Waiting"==patient.STATUS?icon="modules/injuryManagement/icons/icon-orange.png":"New"==patient.STATUS&&(icon="modules/injuryManagement/icons/icon-blue.png"),$scope.patientData={id:patient.injury_id,patientId:patient.Patient_id,position:positionArr,pickupAddr:patient.pickup_address,FullName:patient.FullName,gender:patient.Sex,injuryDesc:patient.injury_description,status:patient.STATUS,icon:icon,driverUser:patient.driverUser,driverName:patient.driverName},$scope.injuryMarker.push($scope.patientData)}}}),socket.on("driverLocation",function(data){var driverInfo=data.location;if($scope.driverList=[],"Driver"==driverInfo.userType){var addNewMarker=!0,positionArr=[],icon="modules/injuryManagement/icons/ambulance.png";positionArr.push(driverInfo.latitude),positionArr.push(driverInfo.longitude),$scope.driverData={driverId:driverInfo.id,position:positionArr,username:driverInfo.userName,icon:icon,patientList:data.patientList},$scope.$apply(function(){if($scope.driverMarker.length>0)for(var i=0;i<$scope.driverMarker.length;i++)$scope.driverMarker[i].driverId==$scope.driverData.driverId&&(addNewMarker=!1,$scope.driverMarker.splice(i,1),$scope.driverMarker.push($scope.driverData));1==addNewMarker&&$scope.driverMarker.push($scope.driverData)})}}),socket.on("driverLogout",function(userId){$scope.$apply(function(){for(var i=0;i<$scope.driverMarker.length;i++)$scope.driverMarker[i].driverId==userId&&$scope.driverMarker.splice(i,1)})}),$scope.showDetails=function(id){$state.go("loggedIn.patient.im_Detail",{id:id})},$scope.allocateDriver=function(injury){InjuryManagementService.allocateDriver($scope.map.driverId,injury.patientId,injury.id).then(function(rs){"success"==rs.status?(toastr.success("Send Notification Successfully!","Success"),$scope.map.driverId=null):toastr.error("Send Notification Failed!","Error")})},$scope.refreshMap=function(){refreshMap(),getOnlineDriver()},$scope.refreshList=function(){refreshList()},setInterval(refreshMap,6e4),setInterval(getOnlineDriver,6e4)}),angular.module("app.loggedIn.patient.injuryManagement.list.controller",[]).controller("InjuryListController",function($scope,$filter,$state,InjuryManagementService,UserService,toastr,socket,$stateParams,$cookieStore){
function refreshList(){$scope.search.driver="",$scope.search.dateRange=null,$scope.injuryList=[],$scope.injuryListTemp=[],InjuryManagementService.getInjuryListByPatient($scope.patient_id).then(function(rs){if("success"==rs.status)if(rs.data.length>0){$scope.haveData=!0;for(var j=0;j<rs.data.length;j++)(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp}else $scope.haveData=!1;else $scope.haveData=!1})}function filterDate(from,to){$scope.injuryList=[],$scope.injuryListTemp=[],InjuryManagementService.searchByDatePatient(from,to,$scope.patient_id).then(function(rs){if("success"==rs.status){for(var j=0;j<rs.data.length;j++)(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp}})}$scope.patient_id=$stateParams.patient_id,$scope.search={driver:"",dateRange:null},$scope.haveData=!1;var from=$cookieStore.get("fromState"),params={};(null!=from.fromParams||"undefined"!=typeof from.fromParams)&&angular.forEach(from.fromParams,function(value,key){params[key]=value}),$scope.goBack=function(){$state.go(from.fromState.name,params,{location:"replace",reload:!0})},$scope.refreshList=function(){refreshList()},$scope.showDetails=function(id){$state.go("loggedIn.patient.im_Detail",{id:id})},$scope.searchInjury=function(s){$scope.injuryList=$filter("filter")($scope.injuryListTemp,{driverUser:s.driver})},$scope.getDateRange=function(range){filterDate($filter("date")(range.start.toDate(),"yyyy-MM-dd"),$filter("date")(range.end.toDate(),"yyyy-MM-dd")),$scope.search.patient="",$scope.search.driver=""},InjuryManagementService.getInjuryListByPatient($scope.patient_id).then(function(rs){if("success"==rs.status)if(rs.data.length>0){$scope.haveData=!0;for(var j=0;j<rs.data.length;j++)(null==rs.data[j].driverUser||"undefined"==typeof rs.data[j].driverUser)&&(rs.data[j].driverUser="");$scope.injuryListTemp=rs.data,$scope.injuryList=$scope.injuryListTemp}else $scope.haveData=!1;else $scope.haveData=!1})}),angular.module("app.loggedIn.patient.injuryManagement.detail.controller",[]).controller("InjuryDetailController",function($scope,$http,$modal,$filter,$state,$stateParams,InjuryManagementService,toastr){$scope.injuryInfo={},$scope.injuryImages=[],$scope.loadedImage=!1,$scope.imgArr=[],InjuryManagementService.getInjuryById(injuryId).then(function(rs){if("success"==rs.status&&($scope.injuryInfo=rs.data[0],$scope.injuryInfo.injuryImg.length>0)){$scope.loadedImage=!0;for(var i=0;i<$scope.injuryInfo.injuryImg.length;i++)$scope.imgArr.push({url:location.origin+"/api/im/image/"+$scope.injuryInfo.injuryImg[i].id,img:$scope.injuryInfo.injuryImg[i]})}}),$scope.viewImage=function(img){$modal.open({templateUrl:"modules/injuryManagement/views/imageModal.html",size:"md",resolve:{imgObj:function(){return img}},controller:function($scope,$state,$modalInstance,UserService,socket,toastr,imgObj){$scope.img={image:location.origin+"/api/im/image/"+imgObj.id,description:imgObj.desc}}})}}),angular.module("app.loggedIn.patient.injuryManagement.bluetooth.controller",[]).controller("BluetoothController",function($scope,$filter,$state,InjuryManagementService,UserService,toastr,socket,$stateParams,$cookieStore,ngTableParams){$scope.patient_id=$stateParams.patient_id,$scope.deviceList=[];var colors=["blue-soft","red-soft","purple-soft","green-soft"],icons=["fa fa-plus-square","fa fa-medkit","fa fa-heart","fa fa-stethoscope"];$scope.haveData=!1,$scope.currDevice=null,$scope.chartData=[],socket.on("getMeasureData",function(rs){if(rs.info){var data=angular.copy(rs.info);delete data.deviceType,delete data.rawData,$scope.$apply(function(){$scope.onlineDevice=rs.info.deviceType,$scope.onlineData=data})}}),InjuryManagementService.getMedicalDevices().then(function(rs){if("success"==rs.status){for(var i=0;i<rs.data.length;i++)rs.data[i].color=colors[Math.floor(Math.random()*colors.length)],rs.data[i].icon=icons[Math.floor(Math.random()*icons.length)];$scope.deviceList=rs.data}}),$scope.updateMeasure=function(measure){var m={};m.notes=measure.notes,InjuryManagementService.editDeviceMeasure(m,measure.measure_id).then(function(rs){"success"==rs.status?toastr.success("Edit Success!"):toastr.error("Edit Failed!")})},$scope.chartOptions={series:{lines:{show:!0},points:{show:!0}},xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1}},$scope.changeHistory=function(dateRange){null!=$scope.data&&null!=$scope.currDevice&&getHistory($scope.currDevice.toLowerCase(),_.sortBy($scope.data,"measure_date"),moment(dateRange.start),moment(dateRange.end))},$scope.showHistory=function(device){$scope.data=null,$scope.haveData=!1,$scope.currDevice=device.device_name,InjuryManagementService.getDeviceDataByPatient(device.id,$scope.patient_id).then(function(rs){if("success"==rs.status)if(rs.data.length>0){$scope.haveData=!0;for(var deviceType=null,i=0;i<rs.data.length;i++)(null!=rs.data[i].measureData||""!=rs.data[i].measureData)&&(deviceType=rs.data[0].device_name.toLowerCase(),rs.data[i].jsonData=JSON.parse(rs.data[i].measureData));$scope.data=rs.data,$scope.historyDates=moment().range(moment().subtract(1,"days"),moment()),getHistory(deviceType,_.sortBy($scope.data,"measure_date"),moment().subtract(1,"days"),moment()),null!=$scope.data&&($scope.tableParams=new ngTableParams({page:1,count:10},{total:rs.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}))}else $scope.haveData=!1;else $scope.haveData=!1})};var getHistory=function(deviceType,data,from,to){var fromDate=moment(from).format("YYYY-MM-DD"),toDate=moment(to).format("YYYY-MM-DD"),pulse=[],spO2=[],fev1=[],fvc=[],pef=[],sys=[],dia=[],bpm=[],mmHg=[];$scope.chartData=[];for(var i=0;i<data.length;i++){var measureDate=$filter("date")(data[i].measure_date,"yyyy-MM-dd"),measureDateHrs=$filter("date")(data[i].measure_date,"dd/MM/yyyy-hh:mm a");switch(deviceType){case"pulse oximeter":(moment(measureDate).isBefore(toDate)&&moment(measureDate).isAfter(fromDate)||moment(measureDate).isSame(fromDate)||moment(measureDate).isSame(toDate))&&(pulse.push([measureDateHrs,data[i].jsonData.pulse]),spO2.push([measureDateHrs,data[i].jsonData.spO2]));break;case"spirometer":(moment(measureDate).isBefore(toDate)&&moment(measureDate).isAfter(fromDate)||moment(measureDate).isSame(fromDate)||moment(measureDate).isSame(toDate))&&(fev1.push([measureDateHrs,data[i].jsonData.FEV1]),fvc.push([measureDateHrs,data[i].jsonData.FVC]),pef.push([measureDateHrs,data[i].jsonData.PEF]));break;case"blood pressure":(moment(measureDate).isBefore(toDate)&&moment(measureDate).isAfter(fromDate)||moment(measureDate).isSame(fromDate)||moment(measureDate).isSame(toDate))&&(sys.push([measureDateHrs,data[i].jsonData.sys]),dia.push([measureDateHrs,data[i].jsonData.dia]),bpm.push([measureDateHrs,data[i].jsonData.bpm]),mmHg.push([measureDateHrs,data[i].jsonData.mmHg]))}}switch(deviceType){case"pulse oximeter":$scope.chartData.push({data:pulse,label:"Pulse"}),$scope.chartData.push({data:spO2,label:"SpO2"});break;case"spirometer":$scope.chartData.push({data:fev1,label:"FEV1"}),$scope.chartData.push({data:fvc,label:"FVC"}),$scope.chartData.push({data:pef,label:"PEF"});break;case"blood pressure":$scope.chartData.push({data:sys,label:"SYS"}),$scope.chartData.push({data:dia,label:"DIA"}),$scope.chartData.push({data:bpm,label:"BPM"}),$scope.chartData.push({data:mmHg,label:"mmHg"})}}}),angular.module("app.loggedIn.patient.injuryManagement.services",[]).factory("InjuryManagementService",function(Restangular){var imService={},api=Restangular.all("api");return imService.getInjuryList=function(){return api.one("im/list").get()},imService.getInjuryListByPatient=function(patient_id){return api.all("im/listByPatient").post({patient_id:patient_id})},imService.getInjuryById=function(id){return api.all("im/getById").post({injury_id:id})},imService.getImageByInjury=function(id){return api.all("im/images").post({injury_id:id})},imService.listDriver=function(){return api.one("im/getListDriver").get()},imService.allocateDriver=function(dId,pId,iId){return api.all("im/allocateDriver").post({driverId:dId,patientId:pId,injuryId:iId})},imService.searchByDate=function(from,to){return api.all("im/searchByDate").post({from:from,to:to})},imService.searchByDatePatient=function(from,to,patient_id){return api.all("im/searchByDatePatient").post({from:from,to:to,patient_id:patient_id})},imService.getMedicalDevices=function(){return api.one("im/getDevices").get()},imService.getDeviceDataByPatient=function(id,patientId){return api.all("medicalDevice/getData").post({id:id,patient_id:patientId})},imService.editDeviceMeasure=function(info,id){return api.all("medicalDevice/edit").post({id:id,info:info})},imService}),angular.module("app.loggedIn.insurer",["app.loggedIn.insurer.controller","app.loggedIn.insurer.services","app.loggedIn.insurer.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.insurer",{"abstract":!0,templateUrl:"modules/insurer/views/structure.html",controller:"InsurerController"}).state("loggedIn.insurer.list",{url:"/insurer/list",views:{"main-content":{templateUrl:"modules/insurer/views/list.html",controller:"InsurerListController"}}}).state("loggedIn.insurer.detail",{url:"/insurer/detail",views:{"main-content":{templateUrl:"modules/insurer/views/detail.html",controller:"InsurerDetailController"}}}).state("loggedIn.insurer.add",{url:"/insurer/add",views:{"main-content":{templateUrl:"modules/insurer/views/add.html",controller:"InsurerAddController"}}})}),angular.module("app.loggedIn.insurer.services",[]).factory("InsurerService",function(Restangular){var instanceService={},appApi=Restangular.all("api/erm"),insurerApi=Restangular.all("api/meditek/v1/insurer");return instanceService.detail=function(id){var instanceApi=appApi.one("v2/insurers/detail");return instanceApi.get({id:id})},instanceService.insert=function(data){var instanceApi=appApi.all("v2/insurers/insert");return instanceApi.post({data:data})},instanceService.update=function(id,data){var instanceApi=appApi.all("v2/insurers/update");return instanceApi.post({id:id,data:data})},instanceService["delete"]=function(id){var instanceApi=appApi.all("v2/insurer/delete");return instanceApi.post({id:id})},instanceService.oneFollowPatient=function(data){var instanceApi=insurerApi.all("oneFollowPatient");return instanceApi.post({data:data})},instanceService.oneFollowCompany=function(data){var instanceApi=insurerApi.all("oneFollowCompany");return instanceApi.post({data:data})},instanceService.insurerByPatient=function(patient_id){return insurerApi.all("getByPatient").post({patient_id:patient_id})},instanceService}),angular.module("app.loggedIn.insurer.directives",["app.loggedIn.insurer.detail.directive"]),angular.module("app.loggedIn.insurer.detail.directive",[]).directive("insurerDetail",function(InsurerModel,InsurerService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess",success:"=",responsedata:"="},templateUrl:"modules/insurer/directives/templates/detail.html",link:function(scope,element,attrs){var loadData=function(id){InsurerService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.row),scope.modelObjectMap.isenable+="",ConfigService.autoConvertData(scope.modelObjectMap)})};if(ConfigService.countries_option().then(function(result){scope.country_options=result.data}),scope.modelObjectMap=angular.copy(InsurerModel),scope.mode={type:"add",text:"Add Company"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Insurer"})}var addProcess=function(postData){InsurerService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a new Insurer","Success"),scope.modelObjectMap=angular.copy(InsurerModel),scope.isSubmit=!1,scope.success=!0,scope.responsedata=response,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){var id=postData.id;delete postData.id,InsurerService.update(id,postData).then(function(response){"success"===response.status&&(toastr.success("Edit Insurer Successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.insurer.controller",["app.loggedIn.insurer.list.controller","app.loggedIn.insurer.detail.controller","app.loggedIn.insurer.add.controller"]).controller("InsurerController",function($scope){}),angular.module("app.loggedIn.insurer.list.controller",[]).controller("InsurerListController",function($scope,$state,localStorageService){$scope.insurer_panel={},$scope.data_options={api:"api/erm/v2/insurers/search",method:"post",scope:$scope.insurer_panel,columns:[{field:"id",is_hide:!0},{field:"insurer_name",label:"Company Name"},{field:"address",label:"Address"},{field:"suburb",label:"Suburb"}]},$scope.add_form={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){$scope.insurer_panel.reload()}},$scope.edit_form={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){console.log("edit reloading"),$scope.insurer_panel.reload()}},$scope.clickRow=function(item){$scope.add_form.is_show&&$scope.add_form.close(),console.log(item),$scope.insurerInfo=item,$scope.edit_form.open()}}),angular.module("app.loggedIn.insurer.detail.controller",[]).controller("InsurerDetailController",function($scope,$state,localStorageService){$scope.insurerInfo=localStorageService.get("tempInsurerInfo"),$scope.insurerInfo||$state.go("loggedIn.insurer.list")}),angular.module("app.loggedIn.insurer.add.controller",[]).controller("InsurerAddController",function($scope,$state){}),angular.module("app.loggedIn.invoice",["app.loggedIn.invoice.directives","app.loggedIn.invoice.services","app.loggedIn.invoice.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.invoice",{"abstract":!0,templateUrl:"modules/invoice/views/structure.html",controller:"InvoiceController"}).state("loggedIn.invoice.list",{url:"/invoice/list",views:{"main-content":{templateUrl:"modules/invoice/views/list.html",controller:"InvoiceListController"}}})}),angular.module("app.loggedIn.invoice.services",[]).factory("InvoiceService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/erm/v2"),api=Restangular.all("api");return mdtService.headerDetail=function(id){var funcApi=mdtApi.all("invoice/detail");return funcApi.post({header_id:id})},mdtService.save=function(id,postData){var funcApi=mdtApi.all("invoice/save");return funcApi.post({header_id:id,status:postData.STATUS,lines:postData.lines,service_id:postData.SERVICE_ID,postData:postData})},mdtService.update=function(id,postData){var funcApi=mdtApi.all("invoice/update");return funcApi.post({header_id:id,data:postData})},mdtService.add=function(postData){var funcApi=mdtApi.all("invoice/add");return funcApi.post({data:postData})},mdtService.removeInvoiceLine=function(data){var funcApi=mdtApi.all("invoice/remove_invoice_line");return funcApi.post({data:data})},mdtService.getInvoiceHeader=function(invoiceHeaderId){var result=api.all("invoice/vn/get-invoice-header");return result.post({invoiceHeaderId:invoiceHeaderId})},mdtService.getInvoiceListLines=function(invoiceHeaderId){var result=api.all("invoice/vn/get-invoice-list-lines");return result.post({invoiceHeaderId:invoiceHeaderId})},mdtService.createInvoiceLine=function(postData){var result=mdtApi.all("invoice/create_invoice_line");return result.post({postData:postData})},mdtService.updateInvoiceLine=function(postData){var result=mdtApi.all("invoice/update_invoice_line");return result.post({postData:postData})},mdtService.saveInvoiceLineSheet=function(postData){var result=mdtApi.all("invoice/save_invoice_line_sheet");return result.post({postData:postData})},mdtService.selectInvoiceHeaderBySession=function(patientId,calId){var result=mdtApi.all("invoice/select_invoice_header_by_session");return result.post({patientId:patientId,calId:calId})},mdtService.selectInvoiceLinesBySession=function(patientId,calId){var result=mdtApi.all("invoice/select_invoice_lines_by_session");return result.post({patientId:patientId,calId:calId})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.invoice.controller",["app.loggedIn.invoice.list.controller"]).controller("InvoiceController",function($scope,ConfigService){}),angular.module("app.loggedIn.invoice.list.controller",[]).controller("InvoiceListController",function($scope,$state,toastr,ItemService,ConfigService){console.log($scope.options);var invoice_status=[{label:"-- All --"}].concat($scope.options.invoice_status);$scope.invoiceClass=function(item){return{warning:"approach"==item.STATUS,success:"done"==item.STATUS,danger:"enter"==item.STATUS||null==item.STATUS}},$scope.invoicePanel={},$scope.invoiceOption={api:"api/erm/v2/invoice/search",method:"post",scope:$scope.invoicePanel,columns:[{field:"header_id",is_hide:!0},{field:"cal_id",is_hide:!0},{field:"Patient_id",label:"Patient",type:"custom",fn:function(item){return item.patient?item.patient.Title+". "+item.patient.First_name:void 0}},{field:"AMOUNT",label:"Amount",type:"custom",fn:function(item){return item.AMOUNT?"$"+Number(item.AMOUNT.toFixed(2)):"$0"}},{field:"Company_id",label:"Company",type:"custom",fn:function(item){return item.company?item.company.Company_name:void 0}},{field:"Insurer_id",label:"Insurer",type:"custom",fn:function(item){return item.insurer?item.insurer.insurer_name:void 0}},{field:"DOCTOR_ID",label:"Doctor",type:"custom",fn:function(item){return item.doctor?item.doctor.NAME:void 0}},{field:"SITE_ID",label:"Site",type:"custom",fn:function(item){return item.site?item.site.Site_name:void 0}},{field:"SERVICE_ID",label:"Service",type:"custom",fn:function(item){return item.service?item.service.SERVICE_NAME:void 0}},{field:"CREATION_DATE",order:"ASC",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.CREATION_DATE)}},{field:"STATUS",label:"Status"}],use_filters:!0,filters:{STATUS:{type:"dropdown",values:invoice_status}},use_actions:!0,actions:[{"class":"fa fa-money",title:"Detail",callback:function(item){exlog.log(item),$state.go("loggedIn.patient.invoice_detail",{header_id:item.header_id,patient_id:item.Patient_id,cal_id:item.cal_id})}}]},$scope.invoiceParams={permission:{add:!0}},$scope.addFormInvoice={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(){$scope.addFormInvoice.close(),$scope.invoicePanel.reload()}}}),angular.module("app.loggedIn.invoice.directives",["app.loggedIn.invoice.detail.directive","app.loggedIn.invoice.tnInvoiceDetail.directive","app.loggedIn.invoice.search.directive","app.loggedIn.invoice.add.directive"]),angular.module("app.loggedIn.invoice.detail.directive",[]).directive("invoiceDetail",function(InvoiceHeaderModel,ConfigService,InvoiceService,ReceptionistService,toastr,$state,$timeout,$filter,CompanyService,$modal){var arrGetBy=$filter("arrGetBy");return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/invoice/directives/templates/detail.html",controller:function($scope){$scope.goToAppt=function(patient_id,cal_id){$state.go("loggedIn.patient.appointment",{patient_id:patient_id,cal_id:cal_id})},$scope.patientSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){console.log(item),$scope.InvoiceMap.Patient_id=item.Patient_id,$scope.InvoiceMap.Company_id=item.company_id,$scope.InvoiceMap.patient={full_name:item.First_name+" "+item.Sur_name},$scope.patientSearch.close(),CompanyService.get(item.company_id).then(function(response){if("success"==response.status&&response.data){var company=response.data;console.log(response.data),$scope.InvoiceMap.company={Company_name:company.Company_name}}}),$scope.patientClaim.options.search.Patient_id=item.Patient_id,$scope.patientClaimPanel.reload()}},$scope.doctorSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){$scope.InvoiceMap.DOCTOR_ID=item.doctor_id,$scope.InvoiceMap.DEPT_ID=item.CLINICAL_DEPT_ID,$scope.InvoiceMap.doctor={NAME:item.NAME},$scope.doctorSearch.close(),ConfigService.system_service_by_clinical(item.CLINICAL_DEPT_ID).then(function(response){$scope.opt_services=[{SERVICE_ID:"",SERVICE_NAME:"-- Choose Service --"}].concat(response)})}},$scope.patientClaimPanel={},$scope.patientClaim={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){var postData={claim_id:item.Claim_id};InvoiceService.update($scope.params.id,postData).then(function(response){"success"==response.status&&(toastr.success("Save Claim Successfully !!!","Success"),$scope.InvoiceMap.claim=item,$scope.InvoiceMap.Insurer_id=item.insurer_id,$scope.InvoiceMap.claim_id=item.Claim_id,$scope.InvoiceMap.insurer={insurer_name:item.Insurer},$scope.patientClaim.close())})},options:{api:"api/erm/v2/patients/claims",method:"post",scope:$scope.patientClaimPanel,columns:[{field:"Claim_id",is_hide:!0},{field:"Injury_name",label:"Injury"},{field:"Insurer"},{field:"insurer_site",is_hide:!0},{field:"insurer_id",is_hide:!0}],not_load:!0,search:{}}},$scope.doctorSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){$scope.InvoiceMap.DOCTOR_ID=item.doctor_id,$scope.InvoiceMap.DEPT_ID=item.CLINICAL_DEPT_ID,$scope.InvoiceMap.doctor={NAME:item.NAME},$scope.doctorSearch.close(),ConfigService.system_service_by_clinical(item.CLINICAL_DEPT_ID).then(function(response){$scope.opt_services=[{SERVICE_ID:"",SERVICE_NAME:"-- Choose Service --"}].concat(response)})}},$scope.itemSearchPanel={},$scope.itemSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){var t_item=arrGetBy($scope.InvoiceMap.lines,"ITEM_ID",item.ITEM_ID);t_item||(item.QUANTITY=1,item.TIME_SPENT=0,item.IS_ENABLE=1,item.invItem={ITEM_CODE:item.ITEM_CODE,ITEM_NAME:item.ITEM_NAME},ReceptionistService.itemFeeAppt($scope.InvoiceMap.SERVICE_ID,[item.ITEM_ID]).then(function(response){response.list.length>0?(item.PRICE=response.list[0].SCHEDULE_FEE,item.has_price=!0):(item.PRICE=0,item.has_price=!1);var postData={patientId:$scope.InvoiceMap.Patient_id,calId:$scope.InvoiceMap.cal_id,invoiceHeaderId:$scope.InvoiceMap.header_id,invoiceLine:item};InvoiceService.createInvoiceLine(postData).then(function(data){"success"==data.status?(toastr.success("Add item success.","Success"),angular.copy(data.data,item),$scope.InvoiceMap.lines.push(item)):(data.status="exist")?toastr.warning("Duplicate item","Warning"):(toastr.error("Add fail.","Error"),exlog.logErr(data))},function(err){toastr.error("Add fail.","Error"),exlog.logErr(err)})}))}},$scope.itemSearchOption={api:"api/erm/v2/items/search",method:"post",scope:$scope.itemSearchPanel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"TAX_ID",label:"Tax Id",is_hide:!0},{field:"TAX_CODE",label:"Tax Code"},{field:"TAX_RATE",label:"Tax Rate"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}}},link:function(scope,element,attrs){scope.showSave=!0,scope.statusDisable=!1,scope.claimShow=!0;var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&InvoiceService.headerDetail(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.InvoiceMap,response.data),ConfigService.autoConvertData(scope.InvoiceMap),console.log("this is InvoiceMap",scope.InvoiceMap),scope.InvoiceMap.patient.full_name=scope.InvoiceMap.patient.Title+". "+scope.InvoiceMap.patient.First_name+" "+scope.InvoiceMap.patient.Sur_name,scope.InvoiceMap.lines=scope.InvoiceMap.lines.filter(function(item){return 1==item.IS_ENABLE});for(var i=0,amount=0,len=scope.InvoiceMap.lines.length;len>i;++i){var line=scope.InvoiceMap.lines[i];amount+=line.AMOUNT}scope.InvoiceMap.AMOUNT=amount,"done"===scope.InvoiceMap.STATUS&&(scope.showSave=!1,scope.statusDisable=!0,scope.claimShow=!1),scope.patientClaim.options.search.Patient_id=scope.InvoiceMap.Patient_id,ConfigService.system_service_by_clinical(scope.InvoiceMap.doctor.CLINICAL_DEPT_ID).then(function(response){scope.opt_services=[{SERVICE_ID:"",SERVICE_NAME:"-- Choose Service --"}].concat(response)}),$timeout(scope.patientClaimPanel.reload,1e3)}),scope.InvoiceMap=angular.copy(InvoiceHeaderModel)};init(),scope.clickAction=function(){if(console.log("this is edit data:",scope.InvoiceMap),scope.params.permission.edit===!0)if(scope.InvoiceMap.lines&&0!==scope.InvoiceMap.lines.length){if("done"===scope.InvoiceMap.STATUS){var r=confirm('You cannot change this invoice information once you change the status to "Done". \n Are you sure?');if(0==r)return}InvoiceService.save(scope.params.id,scope.InvoiceMap).then(function(response){"fail"==response.status?toastr.error("Cannot send to ERP","Error"):toastr.success("Edit Successfully !!!","Success"),init()})}else toastr.error("Missing header / lines","Error!");else InvoiceService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init()},scope.removeInvoiceLine=function(item){var modalInstance=$modal.open({templateUrl:"notifyToRemoveInvoiceLine",controller:function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},size:"sm"});modalInstance.result.then(function(){var postData={invoiceLineId:item.line_id};InvoiceService.removeInvoiceLine(postData).then(function(data){"success"==data.status?(toastr.success("Remove success.","Success"),init()):(toastr.error("Remove fail.","Error"),exlog.logErr(data))},function(err){toastr.error("Remove fail.","Error"),exlog.logErr(err)})})},scope.updateInvoiceLine=function(item){var postData={invoiceLine:item};InvoiceService.updateInvoiceLine(postData).then(function(data){"success"==data.status?(toastr.success("Update success.","Success"),item.notSave=!1):(exlog.logErr(data),toastr.error("Update error.","Error"))},function(err){exlog.logErr(err),toastr.error("Update error.","Error")})},scope.handleWhenLineChanged=function(item){item.notSave=!0;for(var amount=0,i=0;i<scope.InvoiceMap.lines.length;i++){var line=scope.InvoiceMap.lines[i];line.AMOUNT=line.QUANTITY*line.PRICE,amount+=line.AMOUNT}scope.InvoiceMap.AMOUNT=amount},scope.removeClaim=function(){var postData={claim_id:null};InvoiceService.update(scope.params.id,postData).then(function(response){"success"==response.status&&(toastr.success("Remove Claim Successfully !!!","Success"),scope.InvoiceMap.claim=null,scope.InvoiceMap.claim_id=null)})}}}}),angular.module("app.loggedIn.invoice.tnInvoiceDetail.directive",[]).directive("tnInvoiceDetail",function(){return{restrict:"E",scope:{invoiceHeaderId:"="},templateUrl:"modules/invoice/directives/templates/tnInvoiceDetail.html",controller:function($scope,ConsultationService,InvoiceService){$scope.apptPatient=null,$scope.invoiceHeader=null,$scope.invoiceListLines=null,InvoiceService.getInvoiceHeader($scope.invoiceHeaderId).then(function(data){if("success"==data.status){$scope.invoiceHeader=data.data;var postData={patientId:$scope.invoiceHeader.Patient_id,calId:$scope.invoiceHeader.cal_id};return ConsultationService.getApptPatient(postData)}exlog.logErr(data)},function(err){exlog.logErr(err)}).then(function(data){return"success"==data.status?($scope.apptPatient=data.data,InvoiceService.getInvoiceListLines($scope.invoiceHeaderId)):void exlog.logErr(data)},function(err){exlog.logErr(err)}).then(function(data){"success"==data.status?($scope.invoiceListLines=data.data,exlog.alert($scope.invoiceListLines)):exlog.logErr(data)},function(err){exlog.logErr(err)})}}}),angular.module("app.loggedIn.invoice.search.directive",[]).directive("invoiceSearch",function(InvoiceService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/invoice/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"cal_id",value:""},{type:"text",name:"claim_id",value:""},{type:"text",name:"Patient_id",value:""}],select:["cal_id","claim_id","Patient_id"]}},loadList=function(){InvoiceService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.invoice.add.directive",[]).directive("invoiceAdd",function($stateParams,$modal,InvoiceHeaderModel,PatientService,ConfigService,InvoiceService,ReceptionistService,toastr,$filter,$state,CompanyService){var arrGetBy=$filter("arrGetBy");return{restrict:"EA",scope:{options:"=",params:"=",patient:"=",calendar:"=",onsuccess:"="},templateUrl:"modules/invoice/directives/templates/add.html",controller:function($scope){var init=function(){$scope.isSubmit=!1,$scope.InvoiceMap=angular.copy(InvoiceHeaderModel),$scope.InvoiceMap.SITE_ID=1,$scope.InvoiceMap.STATUS="enter",$scope.InvoiceMap.lines=[]};init(),$scope.patientSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){$scope.InvoiceMap.Patient_id=item.Patient_id,$scope.InvoiceMap.Company_id=item.company_id,$scope.InvoiceMap.patient={full_name:item.First_name+" "+item.Sur_name},$scope.patientSearch.close(),CompanyService.get(item.company_id).then(function(response){if("success"==response.status&&response.data){var company=response.data;$scope.InvoiceMap.company={Company_name:company.Company_name}}}),$scope.patientClaimPanel.reload()}},$scope.doctorSearch={open:function(){$modal.open({templateUrl:"popupDoctorSearch",controller:function($scope,$modalInstance){},size:"md"})},click:function(item){$scope.InvoiceMap.DOCTOR_ID=item.doctor_id,$scope.InvoiceMap.DEPT_ID=item.CLINICAL_DEPT_ID,$scope.InvoiceMap.doctor={NAME:item.NAME},$scope.doctorSearch.close(),ConfigService.system_service_by_clinical(item.CLINICAL_DEPT_ID).then(function(response){$scope.opt_services=[{SERVICE_ID:"",SERVICE_NAME:"-- Choose Service --"}].concat(response)})}},$scope.patientClaimPanel={},$scope.patientClaim={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){$scope.InvoiceMap.claim=item,$scope.InvoiceMap.Insurer_id=item.insurer_id,$scope.InvoiceMap.claim_id=item.Claim_id,$scope.InvoiceMap.insurer={insurer_name:item.Insurer},$scope.patientClaim.close()},options:{api:"api/erm/v2/patients/claims",method:"post",scope:$scope.patientClaimPanel,columns:[{field:"Claim_id",is_hide:!0},{field:"Injury_name",label:"Injury"},{field:"Insurer"},{field:"insurer_id",
is_hide:!0}],not_load:!1,search:{Patient_id:$scope.patient}}},$scope.itemSearchPanel={},$scope.itemSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},click:function(item){console.log($scope.InvoiceMap.lines);var t_item=arrGetBy($scope.InvoiceMap.lines,"ITEM_ID",item.ITEM_ID);t_item||(item.ITEM_NAME=item.ITEM_NAME.substring(0,50),item.QUANTITY=1,item.TIME_SPENT=0,item.IS_ENABLE=1,$scope.InvoiceMap.lines.push(item),ReceptionistService.itemFeeAppt($scope.InvoiceMap.SERVICE_ID,[item.ITEM_ID]).then(function(response){response.list.length>0?(item.PRICE=response.list[0].SCHEDULE_FEE,item.has_price=!0):(item.PRICE=0,item.has_price=!1)}))}},$scope.itemSearchOption={api:"api/erm/v2/items/search",method:"post",scope:$scope.itemSearchPanel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}},$scope.patient&&($scope.InvoiceMap.Patient_id=$scope.patient,PatientService.get($scope.patient).then(function(response){var p=response.data;response.data&&($scope.InvoiceMap.Company_id=p.company_id,$scope.InvoiceMap.patient={full_name:p.First_name+" "+p.Sur_name},CompanyService.get(p.company_id).then(function(response){if("success"==response.status&&response.data){var company=response.data;$scope.InvoiceMap.company={Company_name:company.Company_name}}}),$scope.patientClaim.options.search.Patient_id=p.Patient_id)})),$scope.calendar&&($scope.InvoiceMap.cal_id=$scope.calendar),$scope.isHeaderOk=function(opt){for(var fields=[{field:"SERVICE_ID",label:"Service"},{field:"doctor",label:"Doctor"},{field:"patient",label:"Patient"}],i=fields.length-1;i>=0;i--){var f=fields[i];if(!$scope.InvoiceMap[f.field])return opt&&"alert"==opt&&toastr.error("Please choose `"+f.label+"`","Error"),!1}return!0},$scope.amountBill=function(){for(var amount=0,i=0,len=$scope.InvoiceMap.lines.length;len>i;++i){var line=$scope.InvoiceMap.lines[i];line.AMOUNT=line.PRICE*line.QUANTITY,amount+=line.AMOUNT}return Math.round(100*amount)/100}},link:function(scope,element,attrs){scope.clickAction=function(){if(scope.isHeaderOk("alert")){var postData=angular.copy(scope.InvoiceMap);delete postData.doctor,delete postData.patient,delete postData.company;for(var insertArr=[],i=0;i<postData.lines.length;i++){var t={CLN_ITEM_ID:postData.lines[i].ITEM_ID,Patient_id:$stateParams.patient_id,cal_id:$stateParams.cal_id,PRICE:postData.lines[i].PRICE,TIME_SPENT:postData.lines[i].TIME_SPENT?postData.lines[i].TIME_SPENT:0,QUANTITY:postData.lines[i].QUANTITY,is_enable:1};insertArr.push(t)}InvoiceService.add(postData).then(function(response){"error"==response.status?toastr.error("Cannot Insert","Error"):"success"==response.status&&scope.onsuccess&&scope.onsuccess(),console.log(response)})}}}}}),angular.module("app.loggedIn.iso",["app.loggedIn.iso.controller","app.loggedIn.iso.main.controller","app.loggedIn.iso.service","app.loggedIn.iso.directive","app.loggedIn.iso.selectionUserName.directive","app.loggedIn.iso.selectionGroupUser.directive","app.loggedIn.iso.grantUserPermission.directive","app.loggedIn.isoSubmitStatusPendingController.controller","app.loggedIn.iso.userGroup.controller","app.loggedIn.iso.isoApproverListController.controller","app.loggedIn.iso.isoAdminController.controller","app.loggedIn.isoHierarchyApprovalController.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.iso",{url:"/iso",templateUrl:"modules/iso/views/iso.html",controller:"isoController"}).state("loggedIn.iso.main",{url:"/main",templateUrl:"modules/iso/views/isoMain.html",controller:"isoMainController"}).state("loggedIn.iso.isoSubmitStatusPending",{url:"/isoSubmitStatusPending",templateUrl:"modules/iso/views/isoSubmitStatusPending.html",controller:"isoSubmitStatusPendingController"}).state("loggedIn.iso.userGroup",{url:"/user-group",templateUrl:"modules/iso/views/isoUserGroup.html",controller:"isoUserGroupController"}).state("loggedIn.iso.isoApproverList",{url:"/approver-list",templateUrl:"modules/iso/views/isoApproverList.html",controller:"isoApproverListController"}).state("loggedIn.iso.isoAdminList",{url:"/isoAdminList",templateUrl:"modules/iso/views/isoAdminList.html",controller:"isoAdminController"}).state("loggedIn.iso.isoHierarchyApproval",{url:"/hierarchy-approval",templateUrl:"modules/iso/views/isoHierarchyApproval.html",controller:"isoHierarchyApprovalController"})}),angular.module("app.loggedIn.iso.controller",[]).controller("isoController",function($scope,isoService){$scope.permissionFunction=isoConst.permissionFunction,$scope.isoAdminFunction=isoConst.isoAdminFunction,isoTest&&($scope.permissionFunction[1]=angular.copy($scope.permissionFunction[0]),$scope.permissionFunction[2]=angular.copy($scope.permissionFunction[0]),$scope.permissionFunction[3]=angular.copy($scope.permissionFunction[0]),$scope.permissionFunction[4]=angular.copy($scope.permissionFunction[0])),$scope.checkInStatus=isoConst.checkInStatus,$scope.submitStatus=isoConst.submitStatus,$scope.isoPermission=isoConst.isoPermission,$scope.requestEditStatus=isoConst.requestEditStatus,$scope.isIsoAdminSystem=0,isoService.isoAdmin.checkIsAdminIsoSystem().then(function(data){$scope.isIsoAdminSystem="success"==data.status?1:0},function(err){$scope.isIsoAdminSystem=0}),$scope.isIsoAdminSystemMaster=0,isoService.isoAdmin.checkIsAdminIsoSystemMaster().then(function(data){$scope.isIsoAdminSystemMaster="success"==data.status?1:0},function(err){$scope.isIsoAdminSystemMaster=0}),$scope.isIsoApprover=0,isoService.isoApprover.checkIsIsoApprover().then(function(data){$scope.isIsoApprover="success"==data.status?1:0},function(err){$scope.isIsoApprover=0}),$scope.departmentList=[],isoService.core.getDepartmentList().then(function(data){$scope.departmentList="success"==data.status?data.data:[]},function(err){$scope.departmentList=[]}),$scope.documentTypeList=isoConst.documentTypeList}),angular.module("app.loggedIn.iso.main.controller",[]).controller("isoMainController",function($scope,$http,$state,$window,$cookieStore,FileUploader,toastr,isoService){$scope.testHierarchy=function(){var approvalInfo={userApprovalId:7,hierarchyHeaderId:199,hierarchyLineId:379,hierarchyNodeId:24,sourceLineId:69,status:"approved",isoNodeId:112};isoService.hierarchyApproval.approval(approvalInfo).then(function(data){exlog.alert(data)},function(err){})},$scope.userInfo=$cookieStore.get("userInfo"),$scope.nodeType=isoConst.nodeType;var msgPopup=isoMsg.popup;$scope.tempData={},$scope.tempData[-1]={},$scope.treeData={},$scope.isIsoAdminSystem=0,$scope.getTreeDir=function(){isoService.treeDir.getTreeDir($scope.userInfo.id,$scope.isIsoAdminSystem).then(function(data){if("success"==data.status){for(var i=0;i<data.data.length;i++)$scope.tempData[data.data[i].NODE_ID]=data.data[i];for(var i=data.data.length-1;i>=0;i--)console.log(">>>>>>>>>>>node_id:"+data.data[i].NODE_ID+">>>father:"+data.data[i].FATHER_NODE_ID),-1==data.data[i].FATHER_NODE_ID?$scope.tempData[data.data[i].FATHER_NODE_ID].relativePath="":$scope.tempData[data.data[i].FATHER_NODE_ID]&&($scope.tempData[data.data[i].FATHER_NODE_ID].relativePath||($scope.tempData[data.data[i].FATHER_NODE_ID].relativePath="\\"+$scope.tempData[data.data[i].FATHER_NODE_ID].NODE_NAME)),$scope.tempData[data.data[i].FATHER_NODE_ID]&&($scope.tempData[data.data[i].NODE_ID].relativePath=$scope.tempData[data.data[i].FATHER_NODE_ID].relativePath+"\\"+$scope.tempData[data.data[i].NODE_ID].NODE_NAME),$scope.tempData[data.data[i].FATHER_NODE_ID]&&$scope.tempData[data.data[i].NODE_ID].ACCESSIBLE_USER_ID!=$scope.userInfo.id&&isoNode.inheritPermission($scope.tempData[data.data[i].NODE_ID],$scope.tempData[data.data[i].FATHER_NODE_ID]);for(var i=0;i<data.data.length;i++)$scope.tempData[data.data[i].FATHER_NODE_ID]&&($scope.tempData[data.data[i].FATHER_NODE_ID].nodes||($scope.tempData[data.data[i].FATHER_NODE_ID].nodes={}),$scope.tempData[data.data[i].FATHER_NODE_ID].nodes[data.data[i].NODE_ID]=angular.copy(data.data[i]));$scope.treeData=$scope.tempData[-1].nodes}},function(err){})},isoService.isoAdmin.checkIsAdminIsoSystem().then(function(data){$scope.isIsoAdminSystem="success"==data.status?1:0},function(err){$scope.isIsoAdminSystem=0}).then(function(){$scope.getTreeDir()}),$scope.treeActions={createFolder:{name:"createFolder",url:"iso_create_folder_template.html",header:"Create Folder"},createDocument:{name:"createDocument",url:"iso_create_document_template.html",header:"Create Document"},grantNodePermission:{name:"grantNodePermission",url:"iso_grant_node_permission.html",header:"Grant Node Permission"},checkInDocument:{name:"checkInDocument",url:"iso_check_in_document.html",header:"Check In Document"},getFullVersionDocument:{name:"getFullVersionDocument",url:"iso_get_full_version_document.html",header:"Version Control",sizeLarge:!0},getFullCheckinDocument:{name:"getFullCheckinDocument",url:"iso_get_full_checkin_document.html",header:"Check In History",sizeLarge:!0},requestEditDocument:{name:"requestEditDocument",url:"iso_request_edit_document.html",header:"Request to Edit Document"},viewYourRequest:{name:"viewYourRequest",url:"iso_view_your_request.html",header:"Your Requests"},viewAllRequest:{name:"viewAllRequest",url:"iso_view_all_request.html",header:"All Requests"},forceCheckInDocument:{name:"forceCheckInDocument",url:"iso_force_check_in_document.html",header:"Force Check In Document"},createNewCheckInDocument:{name:"createNewCheckInDocument",url:"iso_create_new_check_in_document.html",header:"Create New Check In Document (skip Check Out)"},renameNode:{name:"renameNode",url:"iso_rename_node_template.html",header:"Rename"}},$scope.currentTreeAction={},$scope.selectedTreeNode={},$scope.showTreeActionsMenuPopup=function(node){angular.element("#document").fadeOut(),$scope.selectedTreeNode=node,console.log($scope.selectedTreeNode.PERMISSION),$scope.newFolder=angular.copy($scope.newFolderBlank),$scope.newDocument=angular.copy($scope.newDocumentBlank),$scope.newRequestEditDocument=angular.copy($scope.newRequestEditDocumentBlank),$("#iso-tree-actions-menu-popup").modal({show:!0,backdrop:"static"})},$scope.newFolderBlank={fatherNodeId:"",nodeType:$scope.nodeType.folder,nodeName:"",description:"",createdBy:$scope.userInfo.id,relativePath:""},$scope.newDocumentBlank={fatherNodeId:"",nodeType:$scope.nodeType.document,nodeName:"",docCode:"",description:"",createdBy:$scope.userInfo.id,relativePath:""},$scope.newRequestEditDocumentBlank={description:""},$scope.resetFlag=0,$scope.showTreeActionContentPopup=function(treeAction){switch(treeAction){case $scope.treeActions.createFolder.name:$scope.currentTreeAction=$scope.treeActions.createFolder,angular.element(".form-group").removeClass("has-success"),angular.element(".form-group").removeClass("has-error");break;case $scope.treeActions.createDocument.name:$scope.currentTreeAction=$scope.treeActions.createDocument,angular.element(".form-group").removeClass("has-success"),angular.element(".form-group").removeClass("has-error");break;case $scope.treeActions.grantNodePermission.name:$scope.currentTreeAction=$scope.treeActions.grantNodePermission,$scope.resetFlag=$scope.resetFlag+1;break;case $scope.treeActions.checkInDocument.name:$scope.currentTreeAction=$scope.treeActions.checkInDocument;break;case $scope.treeActions.getFullVersionDocument.name:$scope.currentTreeAction=$scope.treeActions.getFullVersionDocument,$scope.getFullVersionDoccument();break;case $scope.treeActions.getFullCheckinDocument.name:$scope.currentTreeAction=$scope.treeActions.getFullCheckinDocument,$scope.getFullCheckinDocument();break;case $scope.treeActions.requestEditDocument.name:$scope.currentTreeAction=$scope.treeActions.requestEditDocument;break;case $scope.treeActions.viewYourRequest.name:$scope.currentTreeAction=$scope.treeActions.viewYourRequest,$scope.selectedYourRequest.DESCRIPTION=null,$scope.getAllYourRequest($scope.selectedTreeNode.NODE_ID),console.log($scope.selectedTreeNode.NODE_ID);break;case $scope.treeActions.viewAllRequest.name:$scope.currentTreeAction=$scope.treeActions.viewAllRequest,$scope.selectedRequest.DESCRIPTION=null,$scope.getAllRequest($scope.selectedTreeNode.NODE_ID),console.log($scope.selectedTreeNode.NODE_ID);break;case $scope.treeActions.forceCheckInDocument.name:$scope.currentTreeAction=$scope.treeActions.forceCheckInDocument;break;case $scope.treeActions.createNewCheckInDocument.name:$scope.currentTreeAction=$scope.treeActions.createNewCheckInDocument;break;case $scope.treeActions.renameNode.name:$scope.currentTreeAction=$scope.treeActions.renameNode,$scope.newName={value:$scope.selectedTreeNode.NODE_NAME}}$("#iso-tree-actions-menu-popup").modal("hide"),$("#iso-tree-action-content-popup").modal({show:!0,backdrop:"static"})},$scope.newFolderBackErrorTemplate={name:""},$scope.beforeCreateFolder=function(){$scope.$broadcast("show-errors-check-validity"),$scope.actionContentForm.$valid&&null!=$scope.newFolder.nodeName&&""!=$scope.newFolder.nodeName&&($scope.newFolder.fatherNodeId=$scope.selectedTreeNode.NODE_ID,$scope.newFolder.relativePath=$scope.selectedTreeNode.relativePath+"\\"+$scope.newFolder.nodeName,$scope.newFolder.departmentId=null==$scope.selectedTreeNode.DEPARTMENT_ID?$scope.newFolder.department.DEPARTMENT_ID:$scope.selectedTreeNode.DEPARTMENT_ID,$scope.newFolderBackError=angular.copy($scope.newFolderBackErrorTemplate),isoService.treeDir.checkDupEntry($scope.newFolder.fatherNodeId,$scope.newFolder.nodeName).then(function(data){"success"==data.status&&(data.data.isDup?data.data.counts.NAME&&($scope.newFolderBackError.name="Name has been used!"):$scope.createFolder())}))},$scope.createFolder=function(){isoService.treeDir.createFolder($scope.selectedTreeNode.NODE_ID,$scope.newFolder).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,isoLang.createFolderSuccess),$scope.selectedTreeNode.nodes||($scope.selectedTreeNode.nodes={}),$scope.selectedTreeNode.nodes[data.data.NODE_ID]=angular.copy(data.data),null==$scope.selectedTreeNode.DEPARTMENT_ID?($scope.selectedTreeNode.nodes[data.data.NODE_ID].DEPARTMENT_ID=$scope.newFolder.department.DEPARTMENT_ID,$scope.selectedTreeNode.nodes[data.data.NODE_ID].DEPARTMENT_NAME=$scope.newFolder.department.DEPARTMENT_NAME):($scope.selectedTreeNode.nodes[data.data.NODE_ID].DEPARTMENT_ID=$scope.selectedTreeNode.DEPARTMENT_ID,$scope.selectedTreeNode.nodes[data.data.NODE_ID].DEPARTMENT_NAME=$scope.selectedTreeNode.DEPARTMENT_NAME),$scope.selectedTreeNode.nodes[data.data.NODE_ID].relativePath=$scope.selectedTreeNode.relativePath+"\\"+$scope.selectedTreeNode.nodes[data.data.NODE_ID].NODE_NAME,data.data.ACCESSIBLE_USER_ID||isoNode.inheritPermission($scope.selectedTreeNode.nodes[data.data.NODE_ID],$scope.selectedTreeNode)):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,isoLang.createFolderError),$("#iso-tree-action-content-popup").modal("hide")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,isoLang.createFolderError)})},$scope.newDocumentBackErrorTemplate={name:"",docCode:""},$scope.beforeCreateDocument=function(){$scope.$broadcast("show-errors-check-validity"),$scope.actionContentForm.$valid&&null!=$scope.newDocument.nodeName&&""!=$scope.newDocument.nodeName&&($scope.newDocument.nodeId=$scope.selectedTreeNode.NODE_ID,$scope.newDocument.fatherNodeId=$scope.selectedTreeNode.NODE_ID,$scope.newDocument.relativePath=$scope.selectedTreeNode.relativePath+"\\"+$scope.newDocument.nodeName,$scope.newDocument.departmentId=null==$scope.selectedTreeNode.DEPARTMENT_ID?$scope.newDocument.department.DEPARTMENT_ID:$scope.selectedTreeNode.DEPARTMENT_ID,$scope.newDocument.documentTypeValue=$scope.newDocument.documentType.value,$scope.newDocumentBackError=angular.copy($scope.newDocumentBackErrorTemplate),isoService.treeDir.checkDupEntry($scope.newDocument.fatherNodeId,$scope.newDocument.nodeName,$scope.newDocument.docCode).then(function(data){"success"==data.status&&(data.data.isDup?(data.data.counts.NAME&&($scope.newDocumentBackError.name="Name has been used!"),data.data.counts.CODE&&($scope.newDocumentBackError.docCode="Document Code has been used!")):$scope.createDocument())}))},$scope.createDocument=function(){uploader.queue[0]?(uploader.queue[0].formData[0]={},uploader.queue[0].formData[0]=$scope.newDocument,uploader.uploadAll()):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,isoLang.pleaseSelectFile)};var uploader=$scope.uploader=new FileUploader({url:"/api/iso/iso-tree-dir/create-document-with-file"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.info("onWhenAddingFileFailed",item,filter,options)},uploader.onAfterAddingFile=function(fileItem){uploader.queue.splice(0,uploader.queue.length-1),console.info("onAfterAddingFile",fileItem)},uploader.onAfterAddingAll=function(addedFileItems){console.info("onAfterAddingAll",addedFileItems)},uploader.onBeforeUploadItem=function(item){console.info("onBeforeUploadItem",item)},uploader.onProgressItem=function(fileItem,progress){console.info("onProgressItem",fileItem,progress)},uploader.onProgressAll=function(progress){console.info("onProgressAll",progress)},uploader.onSuccessItem=function(fileItem,response,status,headers){console.info("onSuccessItem",fileItem,response,status,headers)},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){console.info("onCancelItem",fileItem,response,status,headers)},uploader.onCompleteItem=function(fileItem,response,status,headers){$("#iso-tree-action-content-popup").modal("hide"),response.status&&("success"==response.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,isoLang.createDocumentSuccess),$scope.selectedTreeNode.nodes||($scope.selectedTreeNode.nodes={}),$scope.selectedTreeNode.nodes[response.data.NODE_ID]=angular.copy(response.data),null==$scope.selectedTreeNode.DEPARTMENT_ID?($scope.selectedTreeNode.nodes[response.data.NODE_ID].DEPARTMENT_ID=$scope.newDocument.department.DEPARTMENT_ID,$scope.selectedTreeNode.nodes[response.data.NODE_ID].DEPARTMENT_NAME=$scope.newDocument.department.DEPARTMENT_NAME):($scope.selectedTreeNode.nodes[response.data.NODE_ID].DEPARTMENT_ID=$scope.selectedTreeNode.DEPARTMENT_ID,$scope.selectedTreeNode.nodes[response.data.NODE_ID].DEPARTMENT_NAME=$scope.selectedTreeNode.DEPARTMENT_NAME),$scope.selectedTreeNode.nodes[response.data.NODE_ID].relativePath=$scope.selectedTreeNode.relativePath+"\\"+$scope.selectedTreeNode.nodes[response.data.NODE_ID].NODE_NAME):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,isoLang.createDocumentError)),uploader.queue.splice(0),console.info("onCompleteItem",fileItem,response,status,headers)},uploader.onCompleteAll=function(){console.info("onCompleteAll")},console.info("uploader",uploader),$scope.checkOutDocument=function(){isoService.checkOutIn.checkOutDocument($scope.selectedTreeNode.NODE_ID,$scope.selectedTreeNode.relativePath).then(function(data){$("#iso-tree-actions-menu-popup").modal("hide"),"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Check out success, document has locked"),$window.location.href="/api/iso/iso-check-out-in/download-check-out-document?nodeId="+$scope.selectedTreeNode.NODE_ID+"&relativePath="+$scope.selectedTreeNode.relativePath,$scope.selectedTreeNode.CHECK_IN_STATUS=data.data.CHECK_IN_STATUS,$scope.selectedTreeNode.CHECK_IN_NO=data.data.CHECK_IN_NO):"lock"==data.status?msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Document is locked"):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Check out fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Check out fail!")})},$scope.beforeCheckIn=function(){isoService.checkOutIn.canCheckInDocument($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status?"1"==data.info?$scope.showTreeActionContentPopup($scope.treeActions.checkInDocument.name):"0"==data.info?msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cannot check in because not check out"):"2"==data.info?msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"You cannot check in"):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error"):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error")},function(err){})},$scope.SubmitDocument=function(){isoService.hierarchyApproval.addHierarchyApprovalHeader($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status?(msgPopup("Submit Document",isoConst.msgPopupType.success,"Submit Document Success"),$scope.selectedTreeNode.SUBMIT_STATUS=isoConst.submitStatus.pending,$scope.selectedTreeNode.CHECK_IN_STATUS=isoConst.checkInStatus.lock):msgPopup("Submit Document",isoConst.msgPopupType.error,"Submit Document Error")},function(err){msgPopup("Submit Document",isoConst.msgPopupType.error,"Submit Document Error")})},$scope.cancelSubmitDocument=function(){isoService.checkOutIn.cancelSubmitDocument($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status?(msgPopup("Cancel Submit Document",isoConst.msgPopupType.success,"Cancel submit document success!"),$scope.selectedTreeNode.SUBMIT_STATUS=data.data.SUBMIT_STATUS,$scope.selectedTreeNode.CHECK_IN_STATUS=data.data.CHECK_IN_STATUS):msgPopup("Cancel Submit Document",isoConst.msgPopupType.error,"Cancel Submit Document Error")},function(err){msgPopup("Cancel Submit Document",isoConst.msgPopupType.error,"Cancel Submit Document Error")})},$scope.grantNodePermissionItem=function(nodeId,accessibleUserId,permission){isoService.treeUser.grantNodePermission(nodeId,accessibleUserId,permission).then(function(data){"success"==data.status?(alert("dung roi"),item.STATUS=data.status):(alert("sai roi"),item.STATUS=data.status)},function(err){item.STATUS="error"})},$scope.checkCanPermission=function(nodeId,userGrant,userIsGranted,permission){isoService.treeUser.checkCanPermission(nodeId,userGrant,userIsGranted,permission).then(function(data){},function(err){})},$scope.downloadNewestVersionDocument=function(){isoService.checkOutIn.downloadNewestVersionDocument($scope.selectedTreeNode.NODE_ID).then(function(){})},$scope.deleteNode=function(){isoService.treeDir.deleteNode($scope.selectedTreeNode.NODE_ID).then(function(data){if("success"==data.status){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Delete success!");var deletex=function(node){node.ISENABLE=0,node.nodes&&angular.forEach(node.nodes,function(value,key){deletex(value)})};deletex($scope.selectedTreeNode),$scope.getTreeDir()}else msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cannot delete!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cannot delete!")}).then(function(){$("#iso-tree-actions-menu-popup").modal("hide")})},$scope.restoreNode=function(){isoService.treeDir.restoreNode($scope.selectedTreeNode.NODE_ID).then(function(data){if("success"==data.status){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Restore success!");var restore=function(node){node.ISENABLE=1,node.nodes&&angular.forEach(node.nodes,function(value,key){restore(value)})};restore($scope.selectedTreeNode)}else msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cannot restore!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cannot restore!")}).then(function(){$("#iso-tree-actions-menu-popup").modal("hide")})},$scope.downloadFolderSelected=function(){var listNode=[],dequy=function(node){var item={NODE_ID:node.NODE_ID,relativePath:node.relativePath,NODE_TYPE:node.NODE_TYPE,NODE_NAME:node.NODE_NAME};listNode.push(item),node.nodes&&angular.forEach(node.nodes,function(values){dequy(values)})};dequy($scope.selectedTreeNode),console.log(listNode),isoService.treeDir.handlingCloneFolder($scope.selectedTreeNode.NODE_ID,listNode).then(function(data){"success"==data.status?isoService.treeDir.cloneFolder($scope.selectedTreeNode.NODE_ID,data.data.downloadPackName):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Download folder fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Download folder fail!")})},$scope.fullVersionDocumentData={},$scope.getFullVersionDoccument=function(){isoService.treeDir.getFullVersionDoccument($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status&&(console.log(data),$scope.fullVersionDocumentData=data.data)})},$scope.downloadVersionNo=function(FILE_NAME,CHECK_IN_FOLDER_STORAGE,NODE_ID){isoService.treeDir.handlingDownloadVersionDocument(FILE_NAME,CHECK_IN_FOLDER_STORAGE,NODE_ID)},$scope.fullCheckinDocumentData={},$scope.getFullCheckinDocument=function(){isoService.treeDir.getFullCheckinDoccument($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status&&(console.log(data),$scope.fullCheckinDocumentData=data.data)})},$scope.showDocumentInfo=function(Type,documentID){$scope.documentInfo=null,Type==$scope.nodeType.document?(console.log(Type),console.log(documentID),isoService.treeDir.selectDocument(documentID).then(function(data){"success"==data.status&&(console.log(data.data),data.data.Lasted_Edited_On=null!=data.data.LAST_UPDATED_DATE?moment(data.data.LAST_UPDATED_DATE).format("l"):null,$scope.documentInfo=data.data)}),angular.element("#document").fadeIn()):angular.element("#document").fadeOut()},$scope.closeDocument=function(){angular.element("#document").fadeOut()},$scope.sendRequestEditDocument=function(){$scope.newRequestEditDocument.nodeId=$scope.selectedTreeNode.NODE_ID,isoService.treeDir.sendRequestEditDocument($scope.newRequestEditDocument).then(function(data){"success"==data.status?msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Send request success!"):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Send request fail!"),$("#iso-tree-action-content-popup").modal("hide")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Send request fail!")})},$scope.listYourRequest=[],$scope.getAllYourRequest=function(nodeId){isoService.requestEdit.getAllRequestOfUserLogin(nodeId).then(function(data){$scope.listYourRequest="success"==data.status?data.data:[]},function(err){$scope.listYourRequest=[]})},$scope.selectedYourRequest={},$scope.setSelectedYourRequest=function(item){$scope.selectedYourRequest=item,isoService.replyEdit.updateAdminReply(item.ID,0).then(function(data){"success"==data.status&&(console.log($scope.selectedTreeNode.NODE_ID),$scope.selectedYourRequest.HAVE_NEW_ADMIN_REPLY=0,$scope.getNumberAdminReplyOfRequest(item.NODE_ID))})},$scope.cancelYourRequest=function(id){isoService.requestEdit.cancelRequest(id).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Cancel request success!"),$scope.getAllYourRequest($scope.selectedTreeNode.NODE_ID)):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cancel request fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Cancel request fail!")})},$scope.listAllRequest=[],$scope.getAllRequest=function(nodeId){isoService.requestEdit.getAllRequest(nodeId).then(function(data){"success"==data.status?($scope.listAllRequest=data.data,console.log($scope.listAllRequest)):$scope.listAllRequest=[]},function(err){$scope.listAllRequest=[]})},$scope.selectedRequest={},$scope.setSelectedRequest=function(item){$scope.selectedRequest=item,console.log($scope.selectedRequest),isoService.replyEdit.updateStaffReply(item.ID,0).then(function(data){"success"==data.status&&(console.log(item),$scope.selectedRequest.HAVE_NEW_STAFF_REPLY=0,$scope.getNumberStaffReplyOfRequest(item.NODE_ID))})},$scope.getNumberOfRequestUnread=function(nodeId){isoService.requestEdit.getNumberOfRequestUnread(nodeId).then(function(data){"success"==data.status&&($scope.selectedTreeNode.NUM_OF_REQUEST=data.data>0?data.data:null)},function(err){})},$scope.getNumberStaffReplyOfRequest=function(nodeId){isoService.replyEdit.getNumberStaffReplyOfRequest(nodeId).then(function(data){"success"==data.status&&(console.log(data.data),$scope.selectedTreeNode.NUM_STAFF_REPLY_OF_REQUEST=data.data.NUM_STAFF_REPLY_OF_REQUEST>0?data.data.NUM_STAFF_REPLY_OF_REQUEST:0)},function(err){})},$scope.getNumberAdminReplyOfRequest=function(nodeId){isoService.replyEdit.getNumberAdminReplyOfRequest(nodeId).then(function(data){"success"==data.status&&(console.log(data.data),$scope.selectedTreeNode.NUM_ADMIN_REPLY_OF_REQUEST=data.data.NUM_ADMIN_REPLY_OF_REQUEST>0?data.data.NUM_ADMIN_REPLY_OF_REQUEST:0)},function(err){})},$scope.setRequestIsRead=function(item){isoService.requestEdit.setRequestIsRead(item.ID).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Update success!"),$scope.getNumberOfRequestUnread(item.NODE_ID),item.IS_READ=1):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Update fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Update fail!")})},$scope.setRequestStar=function(item){var star=1==item.STAR?0:1;isoService.requestEdit.setRequestStar(item.ID,star).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Update success!"),item.STAR=star,$scope.getNumberOfRequestUnread(item.NODE_ID)):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Update fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Update fail!")})},$scope.releaseDocumentOneClick=function(){isoService.checkOutIn.submitDocument($scope.selectedTreeNode.NODE_ID).then(function(data){if("success"==data.status){var checkOutInId=data.data.checkOutInId;isoService.checkOutIn.approvedDocument($scope.selectedTreeNode.NODE_ID,checkOutInId).then(function(data){"success"==data.status?(msgPopup("Release",isoConst.msgPopupType.success,"Release Document Success"),$scope.selectedTreeNode.SUBMIT_STATUS=data.data.SUBMIT_STATUS,$scope.selectedTreeNode.CHECK_IN_STATUS=data.data.CHECK_IN_STATUS,$scope.selectedTreeNode.CURRENT_VERSION_ID=data.data.CURRENT_VERSION_ID,isoService.checkOutIn.sendEmailNotificationNewDocumentVersion($scope.selectedTreeNode.NODE_ID).then(function(data){},function(err){})):msgPopup("Release",isoConst.msgPopupType.error,"Release Error")},function(err){msgPopup("Release",isoConst.msgPopupType.error,"Release Error")})}else msgPopup("Release",isoConst.msgPopupType.error,"Release Document Error")},function(err){msgPopup("Release",isoConst.msgPopupType.error,"Release Document Error")})},$scope.forceReleaseDocumentOneClick=function(){isoService.checkOutIn.forceSubmitDocument($scope.selectedTreeNode.NODE_ID).then(function(data){if("success"==data.status){var checkOutInId=data.data.checkOutInId;isoService.checkOutIn.forceApprovedDocument($scope.selectedTreeNode.NODE_ID,checkOutInId).then(function(data){"success"==data.status?(msgPopup("Force Release",isoConst.msgPopupType.success,"Force Release Document Success"),$scope.selectedTreeNode.SUBMIT_STATUS=data.data.SUBMIT_STATUS,$scope.selectedTreeNode.CHECK_IN_STATUS=data.data.CHECK_IN_STATUS,$scope.selectedTreeNode.CURRENT_VERSION_ID=data.data.CURRENT_VERSION_ID,isoService.checkOutIn.sendEmailNotificationNewDocumentVersion($scope.selectedTreeNode.NODE_ID).then(function(data){},function(err){})):msgPopup("Force Release",isoConst.msgPopupType.error,"Force Release Error")},function(err){msgPopup("Force Release",isoConst.msgPopupType.error,"Force Release Error")})}else msgPopup("Force Release",isoConst.msgPopupType.error,"Force Release Document Error")},function(err){msgPopup("Force Release",isoConst.msgPopupType.error,"Force Release Document Error")})},$scope.makeCurrentVersion=function(nodeId,checkOutInId){isoService.checkOutIn.makeCurrentVersion(nodeId,checkOutInId).then(function(data){"success"==data.status?(msgPopup("Make Current Version",isoConst.msgPopupType.success,"Make Current Version Success"),$scope.getFullVersionDoccument()):msgPopup("Make Current Version",isoConst.msgPopupType.error,"Make Current Version Error");

},function(err){msgPopup("Make Current Version",isoConst.msgPopupType.error,"Make Current Version Error")})},$scope.forceCheckOutDocument=function(item){isoService.checkOutIn.forceCheckOutDocument(item.NODE_ID,item.ID).then(function(data){$("#iso-tree-actions-menu-popup").modal("hide"),"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Check out success, document has locked"),$scope.selectedTreeNode.CHECK_IN_STATUS=data.data.CHECK_IN_STATUS,$scope.selectedTreeNode.CHECK_IN_NO=data.data.CHECK_IN_NO,isoService.checkOutIn.downloadSpecificCheckIn(item.NODE_ID,item.ID)):"lock"==data.status?msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Document is locked"):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Check out fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Check out fail!")})},$scope.downloadSpecificCheckIn=function(item){isoService.checkOutIn.downloadSpecificCheckIn(item.NODE_ID,item.ID)},$scope.newName={value:""},$scope.changeNodeName=function(){$scope.actionContentForm.$valid&&isoService.treeDir.renameNode($scope.selectedTreeNode.NODE_ID,$scope.selectedTreeNode.NODE_NAME,$scope.newName.value).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Rename success!"),$scope.getTreeDir()):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Rename fail!")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Rename fail!")}).then(function(){$("#iso-tree-action-content-popup").modal("hide"),$scope.newName={value:""}})},$scope.deleteNodeForever=function(){isoService.treeDir.deleteNodeForever($scope.selectedTreeNode.NODE_ID).then(function(data){"success"==data.status?(msgPopup(isoLang.isoHeader,isoConst.msgPopupType.success,"Delete node forever success."),$scope.getTreeDir()):msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Delete node forever fail.")},function(err){msgPopup(isoLang.isoHeader,isoConst.msgPopupType.error,"Delete node forever fail.")}).then(function(){$("#iso-tree-actions-menu-popup").modal("hide")})}}),angular.module("app.loggedIn.iso.directive",[]).directive("isoDemoDirective",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{message:"@",type:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_fade_in_out_template.html",controller:function($scope){}}}).directive("isoNoticeFinishRenderDirectoryTree",function(){return function(scope,element,attrs){scope.$last&&($(".tree > ul").attr("role","tree").find("ul").attr("role","group"),$(".tree").find("li:has(ul)").addClass("parent_li").attr("role","treeitem").find(" > span").attr("title","Collapse this branch").unbind("click"),$(".tree").find("li:has(ul)").addClass("parent_li").attr("role","treeitem").find(" > span").attr("title","Collapse this branch").on("click",function(e){var children=$(this).parent("li.parent_li").find(" > ul > li");children.is(":visible")?(children.hide("fast"),$(this).attr("title","Expand this branch").find(" > i").addClass("fa-plus").removeClass("fa-minus")):(children.show("fast"),$(this).attr("title","Collapse this branch").find(" > i").addClass("fa-minus").removeClass("fa-plus")),e.stopPropagation()}))}}).directive("isoCheckInDocument",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedTreeNode:"=",isCreateNewCheckIn:"="},templateUrl:"modules/iso/directives/isoCheckInDocument.html",controller:function($scope,isoService,FileUploader){if($scope.checkInInfo={checkInComment:""},$scope.isCreateNewCheckIn===!0)var uploader=$scope.uploader=new FileUploader({url:"/api/iso/iso-check-out-in/create-new-check-in-document"});else var uploader=$scope.uploader=new FileUploader({url:"/api/iso/iso-check-out-in/check-in-document"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.info("onWhenAddingFileFailed",item,filter,options)},uploader.onAfterAddingFile=function(fileItem){uploader.queue.splice(0,uploader.queue.length-1),console.info("onAfterAddingFile",fileItem)},uploader.onAfterAddingAll=function(addedFileItems){console.info("onAfterAddingAll",addedFileItems)},uploader.onBeforeUploadItem=function(item){console.info("onBeforeUploadItem",item)},uploader.onProgressItem=function(fileItem,progress){console.info("onProgressItem",fileItem,progress)},uploader.onProgressAll=function(progress){console.info("onProgressAll",progress)},uploader.onSuccessItem=function(fileItem,response,status,headers){console.info("onSuccessItem",fileItem,response,status,headers)},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){console.info("onCancelItem",fileItem,response,status,headers)},uploader.onCompleteItem=function(fileItem,response,status,headers){$("#iso-tree-action-content-popup").modal("hide"),response.status&&("success"==response.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Check in success!"),$scope.selectedTreeNode.CHECK_IN_STATUS=response.data.CHECK_IN_STATUS,$scope.selectedTreeNode.CHECK_IN_NO=response.data.CHECK_IN_NO,$scope.selectedTreeNode.SUBMIT_STATUS=response.data.SUBMIT_STATUS,uploader.queue.splice(0)):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Check in fail!")),console.info("onCompleteItem",fileItem,response,status,headers)},uploader.onCompleteAll=function(){console.info("onCompleteAll")},console.info("uploader",uploader),$scope.checkIn=function(){$scope.checkInForm.$valid&&($scope.checkInInfo.nodeId=$scope.selectedTreeNode.NODE_ID,$scope.checkInInfo.relativePath=$scope.selectedTreeNode.relativePath,uploader.queue[0]?(uploader.queue[0].formData[0]={},uploader.queue[0].formData[0]=$scope.checkInInfo,uploader.uploadAll()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,isoLang.pleaseSelectFile))}}}}).directive("showErrors",function($timeout,showErrorsConfig){var getShowSuccess,linkFn;return getShowSuccess=function(options){var showSuccess;return showSuccess=showErrorsConfig.showSuccess,options&&null!=options.showSuccess&&(showSuccess=options.showSuccess),showSuccess},linkFn=function(scope,el,attrs,formCtrl){var blurred,inputEl,inputName,inputNgEl,options,showSuccess,toggleClasses;if(blurred=!1,options=scope.$eval(attrs.showErrors),showSuccess=getShowSuccess(options),inputEl=el[0].querySelector("[name]"),inputNgEl=angular.element(inputEl),inputName=inputNgEl.attr("name"),!inputName)throw"show-errors element has no child input elements with a 'name' attribute";return inputNgEl.bind("blur",function(){return blurred=!0,toggleClasses(formCtrl[inputName].$invalid)}),scope.$watch(function(){return formCtrl[inputName]&&formCtrl[inputName].$invalid},function(invalid){return blurred?toggleClasses(invalid):void 0}),scope.$on("show-errors-check-validity",function(){return toggleClasses(formCtrl[inputName].$invalid)}),scope.$on("show-errors-reset",function(){return $timeout(function(){return el.removeClass("has-error"),el.removeClass("has-success"),blurred=!1},0,!1)}),toggleClasses=function(invalid){return el.toggleClass("has-error",invalid),showSuccess?el.toggleClass("has-success",!invalid):void 0}},{restrict:"A",require:"^form",compile:function(elem,attrs){if(!elem.hasClass("form-group"))throw"show-errors element does not have the 'form-group' class";return linkFn}}}).provider("showErrorsConfig",function(){var _showSuccess;_showSuccess=!1,this.showSuccess=function(showSuccess){return _showSuccess=showSuccess},this.$get=function(){return{showSuccess:_showSuccess}}}).directive("isoReplyEditDocument",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{requestData:"=",adminData:"="},templateUrl:"modules/iso/directives/isoReplyEditDocument.html",controller:function($scope,isoService,$cookieStore){$scope.setListReply=function(IDREQUEST){isoService.replyEdit.getAllReplyEditDocument(IDREQUEST).then(function(data){"success"==data.status&&($scope.listReplyEditDocument=data.data,console.log($scope.listReplyEditDocument))})},$scope.$watch("requestData",function(oldValue,newValue){$scope.setListReply($scope.requestData)}),$scope.insertReply=function(comment){console.log($scope.adminData),console.log(isoConst.isoPermission.administrator);var value=1;isoService.replyEdit.insertReplyEditDocument($scope.requestData,comment).then(function(data){"success"==data.status&&($scope.adminData==isoConst.isoPermission.administrator?isoService.replyEdit.updateAdminReply($scope.requestData,value).then(function(data){"success"==data.status&&($scope.comment=null,$scope.setListReply($scope.requestData))}):isoService.replyEdit.updateStaffReply($scope.requestData,value).then(function(data){"success"==data.status&&($scope.comment=null,$scope.setListReply($scope.requestData))}))})}}}}),angular.module("app.loggedIn.iso.selectionUserName.directive",[]).directive("isoSelectionUserName",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{show:"=",selectedUserName:"="},templateUrl:"modules/iso/directives/isoSelectionUserName.html",controller:function($scope,isoService){$scope.userNameKey="",$scope.userNameList=[],$scope.filterUserName=function(){$scope.currentPage=1,$scope.handleUserNameListPaging()},$scope.handleUserNameListPaging=function(){$scope.userNameList=[],isoService.core.getCountUserName($scope.userNameKey).then(function(data){"success"==data.status&&($scope.totalItems=data.data.NUM_OF_USER_NAME,$scope.itemsPerPage=5,$scope.maxSize=7,isoService.core.getUserNameList($scope.userNameKey,$scope.currentPage,$scope.itemsPerPage).then(function(data){"success"==data.status&&($scope.userNameList=data.data)},function(err){}))},function(err){})},$scope.filterUserName(),$scope.autoInc=0,$scope.getSelectedUserName=function(user){$scope.selectedUserName.user_name=user.user_name,$scope.selectedUserName.id=user.id,$scope.autoInc++,$scope.selectedUserName.autoInc=$scope.autoInc,$scope.show=!1}}}}),angular.module("app.loggedIn.iso.selectionGroupUser.directive",[]).directive("isoSelectionGroupUser",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{show:"=",selectedGroup:"="},templateUrl:"modules/iso/directives/isoSelectionGroupUser.html",controller:function($scope,isoService){$scope.groupList=[],isoService.isoUserGroup.getUserGroupList().then(function(data){$scope.groupList="success"==data.status?data.data:[]},function(err){$scope.groupList=[]}),$scope.setSelectedGroup=function(group){$scope.selectedGroup.GROUP_NAME=group.GROUP_NAME,$scope.selectedGroup.GROUP_ID=group.GROUP_ID,$scope.show=!1}}}}),angular.module("app.loggedIn.iso.grantUserPermission.directive",[]).directive("isoGrantUserPermission",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedTreeNode:"="},templateUrl:"modules/iso/directives/isoGrantUserPermission.html",controller:function($scope,isoService,FileUploader){$scope.currentIsoCustom=currentIsoCustom,$scope.refreshNodePermission=function(){$scope.administratorUserList={},isoService.core.gerUsersInPermissionGroup($scope.selectedTreeNode.NODE_ID,isoConst.isoPermission.administrator).then(function(data){if("success"==data.status){for(var i=0;i<data.data.length;i++)$scope.administratorUserList[data.data[i].GROUP_NAME]||($scope.administratorUserList[data.data[i].GROUP_NAME]=[]),$scope.administratorUserList[data.data[i].GROUP_NAME].push(data.data[i]);exlog.log($scope.administratorUserList)}},function(err){}),$scope.createUserList={},isoService.core.gerUsersInPermissionGroup($scope.selectedTreeNode.NODE_ID,isoConst.isoPermission.create).then(function(data){if("success"==data.status)for(var i=0;i<data.data.length;i++)$scope.createUserList[data.data[i].GROUP_NAME]||($scope.createUserList[data.data[i].GROUP_NAME]=[]),$scope.createUserList[data.data[i].GROUP_NAME].push(data.data[i])},function(err){}),$scope.updateUserList={},isoService.core.gerUsersInPermissionGroup($scope.selectedTreeNode.NODE_ID,isoConst.isoPermission.update).then(function(data){if("success"==data.status)for(var i=0;i<data.data.length;i++)$scope.updateUserList[data.data[i].GROUP_NAME]||($scope.updateUserList[data.data[i].GROUP_NAME]=[]),$scope.updateUserList[data.data[i].GROUP_NAME].push(data.data[i])},function(err){}),$scope.readUserList={},isoService.core.gerUsersInPermissionGroup($scope.selectedTreeNode.NODE_ID,isoConst.isoPermission.read).then(function(data){if("success"==data.status)for(var i=0;i<data.data.length;i++)$scope.readUserList[data.data[i].GROUP_NAME]||($scope.readUserList[data.data[i].GROUP_NAME]=[]),$scope.readUserList[data.data[i].GROUP_NAME].push(data.data[i])},function(err){})},$scope.$watchCollection("selectedTreeNode",function(newValues,oldValues){$scope.selectedTreeNode&&$scope.refreshNodePermission()}),$scope.grantNodePermission=function(nodeId,user,permission){isoService.treeUser.checkCanPermission(nodeId,user.id,permission).then(function(data){"success"==data.status?1==data.info?isoService.treeUser.grantNodePermission(nodeId,user.id,permission).then(function(data){"success"==data.status?(permission<isoConst.isoPermission.notPermission?isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Add "+user.user_name+" to group success!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Remove "+user.user_name+" from group success!"),$scope.refreshNodePermission()):permission<isoConst.isoPermission.notPermission?isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add "+user.user_name+" to group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Remove "+user.user_name+" from group fail!")},function(err){permission<isoConst.isoPermission.notPermission?isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add "+user.user_name+" to group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Remove "+user.user_name+" from group fail!")}):permission<isoConst.isoPermission.notPermission?isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"You cannot grant permission to "+user.user_name):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"You cannot remove "+user.user_name+" from group"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")})},$scope.showSelectionAdminUserName=!1,$scope.newAdminUserName={},$scope.$watchCollection("newAdminUserName",function(oldValues,newValues){$scope.newAdminUserName&&$scope.newAdminUserName.user_name&&$scope.grantNodePermission($scope.selectedTreeNode.NODE_ID,$scope.newAdminUserName,isoConst.isoPermission.administrator)}),$scope.showSelectionCreateUserName=!1,$scope.newCreateUserName={},$scope.$watchCollection("newCreateUserName",function(oldValues,newValues){$scope.newCreateUserName&&$scope.newCreateUserName.user_name&&$scope.grantNodePermission($scope.selectedTreeNode.NODE_ID,$scope.newCreateUserName,isoConst.isoPermission.create)}),$scope.showSelectionUpdateUserName=!1,$scope.newUpdateUserName={},$scope.$watchCollection("newUpdateUserName",function(oldValues,newValues){$scope.newUpdateUserName&&$scope.newUpdateUserName.user_name&&$scope.grantNodePermission($scope.selectedTreeNode.NODE_ID,$scope.newUpdateUserName,isoConst.isoPermission.update)}),$scope.showSelectionReadUserName=!1,$scope.newReadUserName={},$scope.$watchCollection("newReadUserName",function(oldValues,newValues){$scope.newReadUserName&&$scope.newReadUserName.user_name&&$scope.grantNodePermission($scope.selectedTreeNode.NODE_ID,$scope.newReadUserName,isoConst.isoPermission.read)}),$scope.showSelectionAdminGroup=!1,$scope.newAdminGroup={},$scope.$watchCollection("newAdminGroup",function(oldValues,newValues){$scope.newAdminGroup&&$scope.newAdminGroup.GROUP_NAME&&isoService.treeUser.grantGroupUserPermission($scope.selectedTreeNode.NODE_ID,$scope.newAdminGroup.GROUP_ID,isoConst.isoPermission.administrator).then(function(data){"success"==data.status?"success"==data.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Add group success!"),$scope.refreshNodePermission()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")})}),$scope.showSelectionCreateGroup=!1,$scope.newCreateGroup={},$scope.$watchCollection("newCreateGroup",function(oldValues,newValues){$scope.newCreateGroup&&$scope.newCreateGroup.GROUP_NAME&&isoService.treeUser.grantGroupUserPermission($scope.selectedTreeNode.NODE_ID,$scope.newCreateGroup.GROUP_ID,isoConst.isoPermission.create).then(function(data){"success"==data.status?"success"==data.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Add group success!"),$scope.refreshNodePermission()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")})}),$scope.showSelectionUpdateGroup=!1,$scope.newUpdateGroup={},$scope.$watchCollection("newUpdateGroup",function(oldValues,newValues){$scope.newUpdateGroup&&$scope.newUpdateGroup.GROUP_NAME&&isoService.treeUser.grantGroupUserPermission($scope.selectedTreeNode.NODE_ID,$scope.newUpdateGroup.GROUP_ID,isoConst.isoPermission.update).then(function(data){"success"==data.status?"success"==data.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Add group success!"),$scope.refreshNodePermission()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")})}),$scope.showSelectionReadGroup=!1,$scope.newReadGroup={},$scope.$watchCollection("newReadGroup",function(oldValues,newValues){$scope.newReadGroup&&$scope.newReadGroup.GROUP_NAME&&isoService.treeUser.grantGroupUserPermission($scope.selectedTreeNode.NODE_ID,$scope.newReadGroup.GROUP_ID,isoConst.isoPermission.read).then(function(data){"success"==data.status?"success"==data.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Add group success!"),$scope.refreshNodePermission()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Add group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")})}),$scope.removePermission=function(u){var user={id:u.id,user_name:u.user_name};$scope.grantNodePermission($scope.selectedTreeNode.NODE_ID,user,isoConst.isoPermission.notPermission)},$scope.removePermissionOfGroup=function(groupId){return groupId?void isoService.treeUser.grantGroupUserPermission($scope.selectedTreeNode.NODE_ID,groupId,isoConst.isoPermission.notPermission).then(function(data){"success"==data.status?"success"==data.status?(isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.success,"Remove permission of this group success!"),$scope.refreshNodePermission()):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Remove permission of this group fail!"):isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")},function(err){isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")}):void isoMsg.popup(isoLang.isoHeader,isoConst.msgPopupType.error,"Error!")}}}});var isoTest=!1,isoCustomList={full:{admin:{value:0,display:"Admin"},create:{value:1,display:"Create"},update:{value:2,display:"Update"},read:{value:3,display:"Read"}},zipQms:{admin:{value:0,display:"Admin"},update:{value:2,display:"Staff"},read:{value:3,display:"Viewer"}}},currentIsoCustom=isoCustomList.zipQms,isoHelper={setSlimCroll:function(selector){$(selector).slimscroll({})}},isoConst={nodeType:{folder:"FOLDER",document:"DOC"},msgPopupType:{success:"success",error:"error"},dbError:{ER_DUP_ENTRY:"ER_DUP_ENTRY"},submitStatus:{pending:"PENDING",approved:"APPROVED",reject:"REJECTED",cancel:"CANCEL"},isoPermission:{administrator:0,create:1,update:2,read:3,notPermission:4},isoAdminFunction:{restoreFolder:!0,restoreDocument:!0,forceCheckInDocument:!0,forceReleaseDocumentOneClick:!0,createNewCheckInDocument:!0,deleteNodeForever:!0},userFunction:{createFolder:"createFolder",deleteFolder:"deleteFolder",cloneToPC:"cloneToPC",grantFolderPermission:"cloneFolderPermission",createDocument:"createDocument",checkOut:"checkOut",forceCheckOut:"forceCheckOut",checkIn:"checkIn",createNewCheckInDocument:"createNewCheckInDocument",submitDocument:"submitDocument",cancelSubmitDocument:"cancelSubmitDocument",requestEditDocument:"requestEditDocument",viewYourRequest:"viewYourRequest",viewAllRequest:"viewAllRequest",deleteDocument:"deleteDocument",grantDocumentPermission:"grantDocumentPermission",downloadNewestVersion:"downloadNewestVersion",releaseDocumentOneClick:"releaseDocumentOneClick",makeCurrentVersion:"makeCurrentVersion",renameNode:"renameNode"},permissionFunction:{0:{createFolder:!0,deleteFolder:!0,cloneToPC:!0,grantFolderPermission:!0,createDocument:!0,checkOut:!0,forceCheckOut:!0,checkIn:!0,submitDocument:!1,cancelSubmitDocument:!1,deleteDocument:!0,grantDocumentPermission:!0,downloadNewestVersion:!0,getFullVersionDoccument:!0,getFullCheckinDoccument:!0,viewAllRequest:!0,releaseDocumentOneClick:!0,makeCurrentVersion:!0,renameNode:!0},1:{createFolder:!1,deleteFolder:!1,cloneToPC:!0,createDocument:!1,checkOut:!1,forceCheckOut:!1,checkIn:!1,submitDocument:!1,cancelSubmitDocument:!1,deleteDocument:!1,downloadNewestVersion:!0,getFullVersionDoccument:!0,getFullCheckinDoccument:!0,requestEditDocument:!0,viewYourRequest:!0},2:{cloneToPC:!0,checkOut:!1,forceCheckOut:!1,checkIn:!1,submitDocument:!1,cancelSubmitDocument:!1,downloadNewestVersion:!0,getFullVersionDoccument:!0,getFullCheckinDoccument:!0,requestEditDocument:!0,viewYourRequest:!0},3:{cloneToPC:!0,downloadNewestVersion:!0,getFullVersionDoccument:!0,getFullCheckinDoccument:!0}},checkInStatus:{lock:"LOCK",unlock:"UNLOCK"},hierarchyApprovalStatus:{notYetReview:"not underReviewyet review",underReview:"under review",approved:"approved",rejected:"rejected"},requestEditStatus:{pending:"PENDING",accept:"ACCEPT",reject:"REJECT",cancel:"CANCEL"},documentTypeList:[{value:"Procedure"},{value:"User Manual"},{value:"Policy"},{value:"Templates"}]},isoLang={isoHeader:"ISO SYSTEM",createFolderSuccess:"Create folder success!",createFolderError:"Create folder error!",createDocumentSuccess:"Create document success!",createDocumentError:"Create document error!",pleaseSelectFile:"Please select file!"},isoMsg={popup:function(header,type,content){$("#iso-global-msg-popup .iso-global-msg-popup-header").text(header),type==isoConst.msgPopupType.success&&($("#iso-global-msg-popup .iso-global-msg-popup-success").show(),$("#iso-global-msg-popup .iso-global-msg-popup-error").hide(),$("#iso-global-msg-popup .iso-global-msg-popup-success .iso-global-msg-popup-content").text(content)),type==isoConst.msgPopupType.error&&($("#iso-global-msg-popup .iso-global-msg-popup-error").show(),$("#iso-global-msg-popup .iso-global-msg-popup-success").hide(),$("#iso-global-msg-popup .iso-global-msg-popup-error .iso-global-msg-popup-content").text(content)),$("#iso-global-msg-popup").modal({show:!0,backdrop:"static"})}},isoNode={inheritPermission:function(child,parent){parent&&parent.PERMISSION&&(child.PERMISSION=parent.PERMISSION)}},isoFolder={inheritPermission:function(child,parent){parent&&(child.ACCESSIBLE_USER_ID=parent.ACCESSIBLE_USER_ID,child.IS_READ=parent.IS_READ,child.IS_CREATE=parent.IS_CREATE,child.IS_UPDATE=parent.IS_UPDATE,child.IS_DELETE=parent.IS_DELETE,child.IS_GRANT_PERMISSION=parent.IS_GRANT_PERMISSION)}},isoDocument={inheritPermission:function(child,parent){parent&&(child.ACCESSIBLE_USER_ID=parent.ACCESSIBLE_USER_ID,child.IS_READ=parent.IS_READ,child.IS_CREATE=parent.IS_CREATE,child.IS_UPDATE=parent.IS_UPDATE,child.IS_DELETE=parent.IS_DELETE,child.IS_GRANT_PERMISSION=parent.IS_GRANT_PERMISSION)}};angular.module("app.loggedIn.isoSubmitStatusPendingController.controller",[]).controller("isoSubmitStatusPendingController",function($scope,$http,$state,$window,$cookieStore,FileUploader,toastr,isoService){isoService.checkOutIn.checkCanAccessApprovalPage().then(function(data){"success"!=data.status&&$state.go("loggedIn.iso.main")},function(err){$state.go("loggedIn.iso.main")}),$scope.checkInOutStatusPending={};var msgPopup=isoMsg.popup,getAllOutInStatusPending=function(){$scope.currentPage=1,$scope.handleListPaging()};$scope.handleListPaging=function(){isoService.checkOutIn.countOutIn().then(function(data){"success"==data.status&&($scope.totalItems=data.data[0].SumData,$scope.itemsPerPage=5,$scope.maxSize=7,isoService.checkOutIn.getAllOutInStatusPending($scope.currentPage,$scope.itemsPerPage).then(function(data){"success"==data.status&&($scope.checkInOutStatusPending=data.data)}))})},getAllOutInStatusPending(),$scope.approved=function(id,node_id){var info={ID:id,status:isoConst.submitStatus.approved,Node_ID:node_id};isoService.checkOutIn.approvedAndReject(info).then(function(data){"success"==data.status?(msgPopup("Approved",isoConst.msgPopupType.success,"Approved Success"),getAllOutInStatusPending()):msgPopup("Approved",isoConst.msgPopupType.error,"Approved Error")})},$scope.rejects=function(id,node_id){var info={ID:id,status:isoConst.submitStatus.reject,Node_ID:node_id};isoService.checkOutIn.approvedAndReject(info).then(function(data){"success"==data.status?(msgPopup("Reject",isoConst.msgPopupType.success,"Reject Success"),getAllOutInStatusPending()):msgPopup("Reject",isoConst.msgPopupType.Error,"Reject Error")})},$scope.downloadFile=function(nodeId,checkOutInId){isoService.checkOutIn.dowloadFile(nodeId,checkOutInId).then(function(data){})},$scope.approvedDocument=function(nodeId,checkOutInId){isoService.checkOutIn.approvedDocument(nodeId,checkOutInId).then(function(data){"success"==data.status?(msgPopup("Approved",isoConst.msgPopupType.success,"Approved Success"),getAllOutInStatusPending(),isoService.checkOutIn.sendEmailNotificationNewDocumentVersion(nodeId).then(function(data){},function(err){})):msgPopup("Approved",isoConst.msgPopupType.error,"Approved Error")},function(err){msgPopup("Approved",isoConst.msgPopupType.error,"Approved Error")})},$scope.rejectedDocument=function(checkOutInId){isoService.checkOutIn.rejectedDocument(checkOutInId).then(function(data){"success"==data.status?(msgPopup("Reject",isoConst.msgPopupType.success,"Reject Success"),getAllOutInStatusPending()):msgPopup("Reject",isoConst.msgPopupType.error,"Reject Error")},function(err){msgPopup("Reject",isoConst.msgPopupType.error,"Reject Error")})}}),angular.module("app.loggedIn.isoHierarchyApprovalController.controller",[]).controller("isoHierarchyApprovalController",function($scope,$http,$state,$window,$cookieStore,FileUploader,toastr,isoService){$scope.hierarchyApprovalStatus=isoConst.hierarchyApprovalStatus,$scope.submitStatus=isoConst.submitStatus,$scope.hierarchyApprovalTreeTemp={},$scope.hierarchyApprovalTree={},isoService.hierarchyApproval.getAllHierarchyLineForUser().then(function(data){if("success"==data.status){for(var i=0;i<data.data.length;i++){var item=data.data[i];$scope.hierarchyApprovalTreeTemp[item.APPR_LINE_ID]=item}for(var i=0;i<data.data.length;i++){var item=data.data[i];$scope.hierarchyApprovalTreeTemp[item.PREVIOUS_LINE_ID]&&($scope.hierarchyApprovalTreeTemp[item.PREVIOUS_LINE_ID].NEXT_LINE_ID=item.APPR_LINE_ID)}for(var i=0;i<data.data.length;i++){var item=data.data[i];$scope.hierarchyApprovalTreeTemp[item.NEXT_LINE_ID]&&($scope.hierarchyApprovalTreeTemp[item.NEXT_LINE_ID].nodes={},$scope.hierarchyApprovalTreeTemp[item.NEXT_LINE_ID].nodes[item.APPR_LINE_ID]=item)}angular.forEach($scope.hierarchyApprovalTreeTemp,function(value,key){null==value.NEXT_LINE_ID&&($scope.hierarchyApprovalTree[value.APPR_LINE_ID]=value)}),console.log(">>>>>"),console.log($scope.hierarchyApprovalTree)}},function(err){}),$scope.approved=function(line){var approvalInfo={hierarchyHeaderId:line.APPR_HEADER_ID,hierarchyLineId:line.APPR_LINE_ID,hierarchyNodeId:line.NODE_ID,sourceLineId:line.SOURCE_LINE_ID,status:isoConst.hierarchyApprovalStatus.approved,isoNodeId:line.SOURCE_HEADER_ID};isoService.hierarchyApproval.approval(approvalInfo).then(function(data){"success"==data.status?(line.STATUS=isoConst.hierarchyApprovalStatus.approved,isoMsg.popup("Approved",isoConst.msgPopupType.success,"Approved Document Success!"),data.info&&"release"==data.info&&isoService.checkOutIn.sendEmailNotificationNewDocumentVersion(line.SOURCE_HEADER_ID).then(function(data){},function(err){})):isoMsg.popup("Approved",isoConst.msgPopupType.error,"Approved Document fail!")},function(err){isoMsg.popup("Approved",isoConst.msgPopupType.error,"Approved Document fail!")})},$scope.rejected=function(line){var approvalInfo={hierarchyHeaderId:line.APPR_HEADER_ID,hierarchyLineId:line.APPR_LINE_ID,hierarchyNodeId:line.NODE_ID,sourceLineId:line.SOURCE_LINE_ID,status:isoConst.hierarchyApprovalStatus.rejected,isoNodeId:line.SOURCE_HEADER_ID};isoService.hierarchyApproval.approval(approvalInfo).then(function(data){"success"==data.status?(line.STATUS=isoConst.hierarchyApprovalStatus.rejected,isoMsg.popup("Rejected",isoConst.msgPopupType.success,"Rejected Document Success!")):isoMsg.popup("Rejected",isoConst.msgPopupType.error,"Rejected Document fail!")},function(err){isoMsg.popup("Rejected",isoConst.msgPopupType.error,"Rejected Document fail!")})},$scope.downloadFile=function(line){isoService.hierarchyApproval.downloadFileCheckOutIn(line.SOURCE_HEADER_ID,line.SOURCE_LINE_ID).then(function(data){})}}),angular.module("app.loggedIn.iso.userGroup.controller",[]).controller("isoUserGroupController",function($scope,isoService,$state){isoService.isoAdmin.checkIsAdminIsoSystem().then(function(data){"success"!=data.status&&$state.go("loggedIn.iso.main")},function(err){$state.go("loggedIn.iso.main")}),isoService.isoUserGroup.getUserGroupList().then(function(data){$scope.userGroupList="success"==data.status?data.data:[]},function(err){$scope.userGroupList=[]}),$scope.actions={editGroup:{name:"editGroup",header:"Edit Group",buttonLabel:"OK",url:"iso_user_group_edit_template.html"},addGroup:{name:"addGroup",header:"Add Group",buttonLabel:"Add",url:"iso_user_group_add_template.html"},editUser:{name:"editUser",header:"Edit User",buttonLabel:"OK",url:"iso_user_group_edit_user_template.html"},addUser:{name:"addUser",header:"Add User",buttonLabel:"Add",url:"iso_user_group_add_user_template.html"}},$scope.currentAction={},$scope.newGroupInfo={},$scope.newGroupUpdateTemplate={ISENABLE:1},$scope.newGroupItemInfo={},$scope.newGroupItemInfoTemplate={ISENABLE:1},$scope.showActionContentPopup=function(action){switch(action){case $scope.actions.editGroup.name:$scope.currentAction=$scope.actions.editGroup;break;case $scope.actions.addGroup.name:$scope.currentAction=$scope.actions.addGroup,$scope.newGroupInfo=angular.copy($scope.newGroupUpdateTemplate);break;case $scope.actions.editUser.name:$scope.currentAction=$scope.actions.editUser;break;case $scope.actions.addUser.name:$scope.currentAction=$scope.actions.addUser,$scope.newGroupItemInfo=angular.copy($scope.newGroupItemInfoTemplate)}$("#iso-user-group-content-popup").modal({show:!0,backdrop:"static"})},$scope.selectedGroup={},$scope.groupUpdateInfo={},$scope.setSelectedGroup=function(group){$scope.selectedGroup=group,$scope.groupUpdateInfo=angular.copy($scope.selectedGroup)},$scope.updateGroupInfo=function(){isoService.isoUserGroup.updateGroupInfo($scope.groupUpdateInfo).then(function(data){"success"==data.status?(isoMsg.popup("ISO User Groups",isoConst.msgPopupType.success,"Update success!"),$scope.selectedGroup.GROUP_NAME=data.data.GROUP_NAME,$scope.selectedGroup.ISENABLE=data.data.ISENABLE,1==$scope.groupUpdateInfo.ISENABLE?isoService.treeUser.enablePermissionOfGroup($scope.selectedGroup.GROUP_ID).then(function(data){},function(err){}):isoService.treeUser.disablePermissionOfGroup($scope.selectedGroup.GROUP_ID).then(function(data){},function(err){})):isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Update fail!");

},function(err){isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Update fail!")}).then(function(){$scope.groupUpdateInfo={},$("#iso-user-group-content-popup").modal("hide")})},$scope.addGroup=function(){isoService.isoUserGroup.addGroup($scope.newGroupInfo).then(function(data){"success"==data.status?(isoMsg.popup("ISO User Groups",isoConst.msgPopupType.success,"Add success!"),$scope.userGroupList.push(data.data),$scope.selectedGroup=$scope.userGroupList[$scope.userGroupList.length-1]):isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")},function(err){isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")}).then(function(){$scope.newGroupInfo=angular.copy($scope.newGroupUpdateTemplate),$("#iso-user-group-content-popup").modal("hide")})},$scope.getUserInGroup=function(groupId){isoService.isoUserGroup.getUsersInGroup(groupId).then(function(data){$scope.userList="success"==data.status?data.data:[]},function(err){$scope.userList=[]})},$scope.$watchCollection("selectedGroup",function(oldValues,newValues){$scope.selectedGroup&&$scope.getUserInGroup($scope.selectedGroup.GROUP_ID)}),$scope.selectedGroupItem={},$scope.groupItemUpdateInfo={},$scope.setSelectedGroupItem=function(user){$scope.selectedGroupItem=user,$scope.groupItemUpdateInfo=angular.copy($scope.selectedGroupItem),$scope.groupItemUpdateInfo.NEW_USER_ID=$scope.selectedGroupItem.USER_ID},$scope.showSelectionUser=!1,$scope.newUserSelected={},$scope.$watchCollection("newUserSelected",function(newValues,oldValues){$scope.newUserSelected&&$scope.newUserSelected.id&&($scope.groupItemUpdateInfo.NEW_USER_ID=$scope.newUserSelected.id,$scope.groupItemUpdateInfo.user_name=$scope.newUserSelected.user_name)}),$scope.grantPermissionForUserInGroup=function(groupId,userId){isoService.treeUser.grantPermissionForUserInGroup(groupId,userId).then(function(data){"success"==data.status||"fail"==data.status},function(err){})},$scope.removeAllPermissionOfUserInGroup=function(groupId,userId){isoService.treeUser.removeAllPermissionOfUserInGroup(groupId,userId).then(function(data){"success"==data.status},function(err){})},$scope.updateGroupItemInfo=function(){isoService.isoUserGroup.updateGroupItemInfo($scope.groupItemUpdateInfo).then(function(data){"success"==data.status?(isoMsg.popup("ISO User Groups",isoConst.msgPopupType.success,"Update success!"),$scope.selectedGroupItem.USER_ID=data.data.USER_ID,$scope.selectedGroupItem.user_name=data.data.user_name,$scope.selectedGroupItem.ISENABLE=data.data.ISENABLE,$scope.groupItemUpdateInfo.USER_ID!=$scope.groupItemUpdateInfo.NEW_USER_ID?1==$scope.groupItemUpdateInfo.ISENABLE?($scope.removeAllPermissionOfUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.USER_ID),$scope.grantPermissionForUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.NEW_USER_ID)):($scope.removeAllPermissionOfUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.USER_ID),$scope.removeAllPermissionOfUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.NEW_USER_ID)):1==$scope.groupItemUpdateInfo.ISENABLE?$scope.grantPermissionForUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.USER_ID):$scope.removeAllPermissionOfUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.USER_ID)):isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")},function(err){isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")}).then(function(){$scope.groupItemUpdateInfo={},$("#iso-user-group-content-popup").modal("hide")})},$scope.showSelectionUserForItem=!1,$scope.newUserSelectedForItem={},$scope.$watchCollection("newUserSelectedForItem",function(newValues,oldValues){$scope.newUserSelectedForItem&&$scope.newUserSelectedForItem.id&&($scope.newGroupItemInfo.USER_ID=$scope.newUserSelectedForItem.id,$scope.newGroupItemInfo.user_name=$scope.newUserSelectedForItem.user_name,$scope.newGroupItemInfo.GROUP_ID=$scope.selectedGroup.GROUP_ID)}),$scope.addGroupItem=function(){isoService.isoUserGroup.addGroupItem($scope.newGroupItemInfo).then(function(data){"success"==data.status?(isoMsg.popup("ISO User Groups",isoConst.msgPopupType.success,"Add success!"),$scope.userList.push(data.data),$scope.selectedGroupItem=$scope.userList[$scope.userList.length-1],$scope.grantPermissionForUserInGroup($scope.newGroupItemInfo.GROUP_ID,$scope.newGroupItemInfo.USER_ID)):isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")},function(err){isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Add fail!")}).then(function(){$scope.newGroupItemInfo=angular.copy($scope.newGroupItemInfoTemplate),$("#iso-user-group-content-popup").modal("hide")})},$scope.deleteGroupItem=function(item){isoService.isoUserGroup.deleteGroupItem(item.GROUP_ID,item.USER_ID).then(function(data){"success"==data.status&&data.info>0?(isoMsg.popup("ISO User Groups",isoConst.msgPopupType.success,"Delete success!"),$scope.getUserInGroup($scope.selectedGroup.GROUP_ID),$scope.removeAllPermissionOfUserInGroup($scope.groupItemUpdateInfo.GROUP_ID,$scope.groupItemUpdateInfo.USER_ID)):isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Delete fail!")},function(err){isoMsg.popup("ISO User Groups",isoConst.msgPopupType.error,"Delete fail!")})}}),angular.module("app.loggedIn.iso.isoApproverListController.controller",[]).controller("isoApproverListController",function($scope,$http,$state,$window,$cookieStore,toastr,isoService){isoTest||isoService.isoAdmin.checkIsAdminIsoSystem().then(function(data){"success"!=data.status&&$state.go("loggedIn.iso.main")},function(err){$state.go("loggedIn.iso.main")});var msgPopup=isoMsg.popup;$scope.approverList={},$scope.getApproverList=function(){isoService.isoApprover.getApproverList().then(function(data){"success"==data.status&&($scope.approverList=data.data)})},$scope.getApproverList(),$scope.addNewUserToApproverList=function(){$("#iso-approver-list-popup").modal({show:!0,backdrop:"static"}),$scope.showSelectionAdminUserName=!0},$scope.showSelectionAdminUserName=!1,$scope.newAdminUserName={},$scope.$watchCollection("newAdminUserName",function(newval,oldval){$scope.newAdminUserName&&$scope.newAdminUserName.user_name&&isoService.isoApprover.insertNewUserToApprover(newval.id).then(function(data){"success"==data.status?(msgPopup("Add New User To Approver",isoConst.msgPopupType.success,"Add New User Success"),$scope.getApproverList()):msgPopup("Add New User To Approver",isoConst.msgPopupType.error,"Add New User Error"),$("#iso-approver-list-popup").modal("hide")})}),$scope.changeEnable=function(id,enable){isoService.isoApprover.updateEnableApprover(id,enable).then(function(data){"success"==data.status?msgPopup("Update Enable Approver",isoConst.msgPopupType.success,"Update Enable Approver Success"):msgPopup("Update Enable Approver",isoConst.msgPopupType.error,"Update Enable Approver Error")})}}),angular.module("app.loggedIn.iso.isoAdminController.controller",[]).controller("isoAdminController",function($scope,$http,$state,$window,$cookieStore,toastr,isoService){var msgPopup=isoMsg.popup;$scope.userName=$cookieStore.get("userInfo").user_name,console.log($scope.userName),$scope.adminList={},$scope.getAdminList=function(){isoService.isoAdmin.getAdminList().then(function(data){"success"==data.status&&($scope.adminList=data.data)})},$scope.getAdminList(),$scope.newAdminUserName={},$scope.addNewUserToAdminList=function(){$("#iso-admin-insert-list-popup").modal({show:!0,backdrop:"static"}),$scope.newAdminUserName={},$scope.role=null},$scope.addAdmin=function(id,role){console.log(id),console.log(role),id&&role?(console.log("aaaaaaaaaa"),isoService.isoAdmin.insertNewUserToAdmin(id,role).then(function(data){"success"==data.status?(msgPopup("Add New User To Admin",isoConst.msgPopupType.success,"Add New User Success"),$scope.getAdminList()):msgPopup("Add New User To Admin",isoConst.msgPopupType.error,"Add New User Error"),$("#iso-admin-insert-list-popup").modal("hide")})):(msgPopup("Add New User To Admin",isoConst.msgPopupType.error,"Add New User Error"),$("#iso-admin-insert-list-popup").modal("hide"))},$scope.editAdmin=function(info){console.log(info),console.log(info.ISENABLE),$scope.newAdminUserName.user_name=info.user_name,$scope.idAdmin=info.ADMIN_ID,$scope.roleAdmin=info.ROLE,$scope.enableAdmin=info.ISENABLE,console.log($scope.idAdmin),$("#iso-admin-edit-list-popup").modal({show:!0,backdrop:"static"})},$scope.updateAdmin=function(adId,idAdminNew,adRole,adEnable){console.log(adId),console.log(adRole),console.log(adEnable),$scope.enableAdmin=adEnable,adId&&adRole?isoService.isoAdmin.updateEnableAdmin(adId,idAdminNew,adRole,adEnable).then(function(data){"success"==data.status?(console.log("okokokok"),$("#iso-admin-edit-list-popup").modal("hide"),msgPopup("Edit User To Admin",isoConst.msgPopupType.success,"Edit User Success"),$scope.getAdminList()):msgPopup("Edit User To Admin",isoConst.msgPopupType.error,"Edit User Error"),$("#iso-admin-edit-list-popup").modal("hide"),$scope.newAdminUserName={}}):(msgPopup("EDit User To Admin",isoConst.msgPopupType.error,"Add New User Error"),$("#iso-admin-edit-list-popup").modal("hide"))},$scope.deleteAdmin=function(id){isoService.isoAdmin.deleteAdminUser(id).then(function(data){"success"==data.status&&$scope.getAdminList()})}}),angular.module("app.loggedIn.iso.service",[]).factory("isoService",function(Restangular,$http,$q,$window){var isoService={},api=Restangular.all("api");return isoService.core={getCountUserName:function(userNameKey){var result=api.one("iso/core/get-count-user-name");return result.get({userNameKey:userNameKey})},getUserNameList:function(userNameKey,pageIndex,itemsPerPage){var result=api.one("iso/core/get-user-name-list");return result.get({userNameKey:userNameKey,pageIndex:pageIndex,itemsPerPage:itemsPerPage})},gerUsersInPermissionGroup:function(nodeId,groupValue){var result=api.all("iso/core/get-users-in-permission-group");return result.post({nodeId:nodeId,groupValue:groupValue})},getDepartmentList:function(){var result=api.one("iso/core/get-department-list");return result.get()}},isoService.treeDir={getTreeDir:function(accessibleUserId,isIsoAdmin){var result=api.all("iso/iso-tree-dir/get-tree-dir");return result.post({accessibleUserId:accessibleUserId,isIsoAdmin:isIsoAdmin})},createFolder:function(nodeId,newFolder){var result=api.all("iso/iso-tree-dir/create-folder");return result.post({nodeId:nodeId,info:newFolder})},checkDupEntry:function(fatherNodeId,nodeName,docCode){var result=api.all("iso/iso-tree-dir/check-dup-entry");return result.post({fatherNodeId:fatherNodeId,nodeName:nodeName,docCode:docCode})},deleteNode:function(nodeId){var result=api.all("iso/iso-tree-dir/delete-node");return result.post({nodeId:nodeId})},restoreNode:function(nodeId){var result=api.all("iso/iso-tree-dir/restore-node");return result.post({nodeId:nodeId})},handlingCloneFolder:function(nodeId,listNode){var result=api.all("iso/iso-tree-dir/handling-clone-folder");return result.post({nodeId:nodeId,listNode:listNode})},cloneFolder:function(nodeId,downloadPackName){$window.location.href="/api/iso/iso-tree-dir/clone-folder?downloadPackName="+downloadPackName+"&nodeId="+nodeId},getFullVersionDoccument:function(nodeId){var result=api.all("iso/iso-tree-dir/getFullVersionDoccument");return result.post({nodeId:nodeId})},getFullCheckinDoccument:function(nodeId){var result=api.all("iso/iso-tree-dir/getFullCheckinDoccument");return result.post({nodeId:nodeId})},selectDocument:function(nodeId){var result=api.all("iso/iso-tree-dir/select-document-info");return result.post({nodeId:nodeId})},handlingDownloadVersionDocument:function(FILE_NAME,CHECK_IN_FOLDER_STORAGE,nodeId){$window.location.href="/api/iso/iso-tree-dir/handlingDownloadVersionDocument?nodeId="+nodeId+"&FILE_NAME="+FILE_NAME+"&CHECK_IN_FOLDER_STORAGE="+CHECK_IN_FOLDER_STORAGE},sendRequestEditDocument:function(userRequestInfo){var result=api.all("iso/iso-tree-dir/send-request-to-edit-document");return result.post({userRequestInfo:userRequestInfo})},renameNode:function(nodeId,oldName,newName){var result=api.all("iso/iso-tree-dir/rename-node");return result.post({nodeId:nodeId,oldName:oldName,newName:newName})},deleteNodeForever:function(nodeId){var result=api.all("iso/iso-tree-dir/delete-node-forever");return result.post({nodeId:nodeId})},deleteNodeForever:function(nodeId){var result=api.all("iso/iso-tree-dir/delete-node-forever");return result.post({nodeId:nodeId})}},isoService.treeUser={grantNodePermission:function(nodeId,accessibleUserId,permission){var result=api.all("iso/iso-tree-users/grant-node-permission");return result.post({nodeId:nodeId,accessibleUserId:accessibleUserId,permission:permission})},checkCanPermission:function(nodeId,userIsGranted,permission){var result=api.all("iso/iso-tree-users/check-can-permission");return result.post({nodeId:nodeId,userIsGranted:userIsGranted,permission:permission})},grantGroupUserPermission:function(nodeId,groupId,permission){var result=api.all("iso/iso-tree-users/grant-user-group-permission");return result.post({nodeId:nodeId,groupId:groupId,permission:permission})},grantPermissionForUserInGroup:function(groupId,userIsGrantedId){var result=api.all("iso/iso-tree-users/grant-permission-for-user-in-group");return result.post({groupId:groupId,userIsGrantedId:userIsGrantedId})},removeAllPermissionOfUserInGroup:function(groupId,userIsGrantedId){var result=api.all("iso/iso-tree-users/remove-all-permission-of-user-of-group");return result.post({userIsGrantedId:userIsGrantedId,groupId:groupId})},disablePermissionOfGroup:function(groupId){var result=api.all("iso/iso-tree-users/disable-permission-of-group");return result.post({groupId:groupId})},enablePermissionOfGroup:function(groupId){var result=api.all("iso/iso-tree-users/enable-permission-of-group");return result.post({groupId:groupId})}},isoService.checkOutIn={checkOutDocument:function(nodeId,relativePath){var result=api.all("iso/iso-check-out-in/check-out-document");return result.post({nodeId:nodeId,relativePath:relativePath})},canCheckInDocument:function(nodeId){var result=api.one("iso/iso-check-out-in/can-check-in-document");return result.get({nodeId:nodeId})},selectIdFromCheckOutIn:function(NODE_ID){var result=api.one("iso/iso-check-out-in/selectIdFromCheckOutIn");return result.get({NODE_ID:NODE_ID})},submitDocument:function(nodeId){var result=api.all("iso/iso-check-out-in/submit-document");return result.post({nodeId:nodeId})},cancelSubmitDocument:function(nodeId){var result=api.all("iso/iso-check-out-in/cancel-submit-document");return result.post({nodeId:nodeId})},checkCanAccessApprovalPage:function(){var result=api.one("iso/iso-check-out-in/access-approval-page");return result.get()},getAllOutInStatusPending:function(pageIndex,itemsPerPage){var result=api.one("iso/iso-check-out-in/getAllOutInStatusPending");return result.get({pageIndex:pageIndex,itemsPerPage:itemsPerPage})},approvedDocument:function(nodeId,checkOutInId){var result=api.all("iso/iso-check-out-in/approved-document");return result.post({nodeId:nodeId,checkOutInId:checkOutInId})},rejectedDocument:function(checkOutInId){var result=api.all("iso/iso-check-out-in/rejected-document");return result.post({checkOutInId:checkOutInId})},approvedAndReject:function(info){var result=api.all("iso/iso-check-out-in/approvedAndReject");return result.post({data:info})},dowloadFile:function(nodeId,checkOutInId){$window.location.href="/api/iso/iso-check-out-in/downloadFileCheckOutIn?nodeId="+nodeId+"&checkOutInId="+checkOutInId},downloadNewestVersionDocument:function(Node_ID){$window.location.href="/api/iso/iso-check-out-in/downloadNewestVersionDocument?nodeId="+Node_ID},countOutIn:function(){var result=api.one("iso/iso-check-out-in/countOutInStatusPending");return result.get()},sendEmailNotificationNewDocumentVersion:function(nodeId){var result=api.all("iso/iso-check-out-in/send-email-all-user-document-release");return result.post({nodeId:nodeId})},makeCurrentVersion:function(nodeId,checkOutInId){var result=api.all("iso/iso-check-out-in/make-current-version");return result.post({nodeId:nodeId,checkOutInId:checkOutInId})},forceSubmitDocument:function(nodeId){var result=api.all("iso/iso-check-out-in/force-submit-document");return result.post({nodeId:nodeId})},forceApprovedDocument:function(nodeId,checkOutInId){var result=api.all("iso/iso-check-out-in/force-approved-document");return result.post({nodeId:nodeId,checkOutInId:checkOutInId})},forceCheckOutDocument:function(nodeId,checkOutInId){var result=api.all("iso/iso-check-out-in/force-check-out-document");return result.post({nodeId:nodeId,checkOutInId:checkOutInId})},downloadSpecificCheckIn:function(nodeId,checkOutInId){$window.location.href="/api/iso/iso-check-out-in/download-specific-check-in?nodeId="+nodeId+"&checkOutInId="+checkOutInId}},isoService.isoAdmin={checkIsAdminIsoSystemMaster:function(){var result=api.all("iso/iso-admin/check-is-admin-iso-system-master");return result.post()},checkIsAdminIsoSystem:function(){var result=api.all("iso/iso-admin/check-is-admin-iso-system");return result.post()},getAdminList:function(){var result=api.one("iso/iso-admin/getAdminList");return result.get()},insertNewUserToAdmin:function(id,role){var result=api.all("iso/iso-admin/insertNewUserToAdmin");return result.post({id:id,role:role})},updateEnableAdmin:function(id,idnew,role,enable){var result=api.all("iso/iso-admin/updateEnableAdmin");return result.post({id:id,idnew:idnew,role:role,enable:enable})},deleteAdminUser:function(id){var result=api.all("iso/iso-admin/deleteAdmin");return result.post({id:id})}},isoService.isoUserGroup={checkCanAccessUserGroupPage:function(){var result=api.one("iso/iso-user-group/access-user-group-page");return result.get()},getUserGroupList:function(){var result=api.one("iso/iso-user-group/get-user-group-list");return result.get()},updateGroupInfo:function(groupInfo){var result=api.all("iso/iso-user-group/update-group-info");return result.post({groupInfo:groupInfo})},addGroup:function(groupInfo){var result=api.all("iso/iso-user-group/add-group");return result.post({groupInfo:groupInfo})},getUsersInGroup:function(groupId){var result=api.all("iso/iso-user-group/get-user-in-group");return result.post({groupId:groupId})},updateGroupItemInfo:function(groupItemInfo){var result=api.all("iso/iso-user-group/update-group-item-info");return result.post({groupItemInfo:groupItemInfo})},addGroupItem:function(groupItemInfo){var result=api.all("iso/iso-user-group/add-group-item");return result.post({groupItemInfo:groupItemInfo})},deleteGroupItem:function(groupId,itemId){var result=api.all("iso/iso-user-group/delete-group-item");return result.post({groupId:groupId,itemId:itemId})}},isoService.isoApprover={getApproverList:function(){var result=api.one("iso/iso-approver/getApproverList");return result.get()},insertNewUserToApprover:function(id){var result=api.all("iso/iso-approver/insertNewUserToApprover");return result.post({id:id})},updateEnableApprover:function(id,enable){var result=api.all("iso/iso-approver/updateEnableApprover");return result.post({id:id,enable:enable})},checkIsIsoApprover:function(){var result=api.one("iso/iso-approver/check-is-iso-approver");return result.get()}},isoService.hierarchyApproval={addHierarchyApprovalHeader:function(isoNodeId){var result=api.all("iso/iso-hierarchy-approval/add-hierarchy-approval-header");return result.post({isoNodeId:isoNodeId})},approval:function(approvalInfo){var result=api.all("iso/iso-hierarchy-approval/approval");return result.post({approvalInfo:approvalInfo})},getAllHierarchyLineForUser:function(){var result=api.one("iso/iso-hierarchy-approval/get-all-hierarchy-line-for-user");return result.get()},downloadFileCheckOutIn:function(nodeId,checkOutInId){$window.location.href="/api/iso/iso-hierarchy-approval/download-file-check-out-in?nodeId="+nodeId+"&checkOutInId="+checkOutInId},sendEmailNotificationApprovalToNextNode:function(hierarchyLineId,hierarchyNodeId,isoNodeId,checkOutInId){var result=api.all("iso/iso-hierarchy-approval/send-email-notification-approval-to-next-node");return result.post({hierarchyLineId:hierarchyLineId,hierarchyNodeId:hierarchyNodeId,isoNodeId:isoNodeId,checkOutInId:checkOutInId})}},isoService.requestEdit={getAllRequestOfUserLogin:function(nodeId){var result=api.all("iso/iso-request-edit-document/get-all-request-of-user-login");return result.post({nodeId:nodeId})},cancelRequest:function(requestId){var result=api.all("iso/iso-request-edit-document/cancel-request");return result.post({requestId:requestId})},getAllRequest:function(nodeId){var result=api.all("iso/iso-request-edit-document/get-all-request");return result.post({nodeId:nodeId})},setRequestIsRead:function(requestId){var result=api.all("iso/iso-request-edit-document/set-request-is-read");return result.post({requestId:requestId})},setRequestStar:function(requestId,star){var result=api.all("iso/iso-request-edit-document/set-request-star");return result.post({requestId:requestId,star:star})},getNumberOfRequestUnread:function(nodeId){var result=api.one("iso/iso-request-edit-document/get-number-of-request-unread");return result.get({nodeId:nodeId})}},isoService.replyEdit={insertReplyEditDocument:function(IDREQUEST,DESCRIPTION){var result=api.all("iso/iso-reply-edit-document/insert-iso-reply-edit-document");return result.post({IDREQUEST:IDREQUEST,DESCRIPTION:DESCRIPTION})},getAllReplyEditDocument:function(IDREQUEST){var result=api.all("iso/iso-reply-edit-document/get-list-iso-reply-edit-document");return result.post({IDREQUEST:IDREQUEST})},updateAdminReply:function(ID,VALUE){var result=api.all("iso/iso-reply-edit-document/update-admin-reply");return result.post({ID:ID,VALUE:VALUE})},updateStaffReply:function(ID,VALUE){var result=api.all("iso/iso-reply-edit-document/updete-staff-reply");return result.post({ID:ID,VALUE:VALUE})},getNumberStaffReplyOfRequest:function(nodeId){var result=api.one("iso/iso-reply-edit-document/get-number-staff-reply-of-request");return result.get({nodeId:nodeId})},getNumberAdminReplyOfRequest:function(nodeId){var result=api.one("iso/iso-reply-edit-document/get-number-admin-reply-of-request");return result.get({nodeId:nodeId})},getHaveNewReply:function(ID){var result=api.one("iso/iso-reply-edit-document/get-have-new-reply");return result.get({ID:ID})}},isoService}),angular.module("app.loggedIn.item",["app.loggedIn.item.controller","app.loggedIn.item.services","app.loggedIn.item.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.item",{"abstract":!0,templateUrl:"modules/item/views/structure.html",controller:"ItemController"}).state("loggedIn.item.list",{url:"/item/list",views:{"main-content":{templateUrl:"modules/item/views/list.html",controller:"ItemListController"}}}).state("loggedIn.item.fee",{url:"/item/fee",views:{"main-content":{templateUrl:"modules/item/views/fee.html",controller:"ItemFeeController"}}}).state("loggedIn.item.fee.search",{url:"/search",views:{"main-content@loggedIn.item":{templateUrl:"modules/item/views/fee_search.html",controller:"ItemFeeSearchController"}}}).state("loggedIn.item.header",{url:"/item/header",views:{"main-content":{templateUrl:"modules/item/views/header.html",controller:"ItemHeaderController"}}})}),angular.module("app.loggedIn.item.services",[]).factory("ItemService",function(Restangular){var instanceService={},appApi=Restangular.all("api/erm");return instanceService.saveHeaderItems=function(header_id,item_list){for(var list=[],i=item_list.length-1;i>=0;i--)list.push(item_list[i].ITEM_ID);var data={header_id:header_id,items:list},detailApi=appApi.all("v2/items/insert_header_items");return detailApi.post(data)},instanceService.insertHeader=function(data){var detailApi=appApi.all("v2/items/insert_header");return detailApi.post(data)},instanceService.insert=function(data){var detailApi=appApi.all("v2/items/insert");return detailApi.post(data)},instanceService.insertFromSource=function(){var detailApi=appApi.all("v2/items/insert_from_source");return detailApi.post(data)},instanceService.detail=function(item_id){var detailApi=appApi.all("v2/items/detail");return detailApi.post({ITEM_ID:item_id})},instanceService.update=function(ITEM_ID,data){var detailApi=appApi.all("v2/items/update");return detailApi.post(data)},instanceService.getItemFees=function(item_id){var detailApi=appApi.one("v2/fees/get_item_fees");return detailApi.get({item_id:item_id})},instanceService.insertItemFees=function(item_id,fee_list){var list=[];console.log(fee_list);for(var i=fee_list.length-1;i>=0;i--)void 0!==fee_list[i].SCHEDULE_FEE&&list.push(fee_list[i]);var data={item_id:item_id,fees:list},detailApi=appApi.all("v2/fees/insert_item_fees");return detailApi.post(data)},instanceService.insertItemFundFees=function(item_id,fee_list){for(var list=[],i=fee_list.length-1;i>=0;i--)(void 0!==fee_list[i].FEE||void 0!==fee_list[i].PERCENT_FEE)&&list.push(fee_list[i]);var data={item_id:item_id,fees:list},detailApi=appApi.all("v2/fees/insert_item_fund_fees");return detailApi.post(data)},instanceService.updateTypePriceSource=function(type_id){var detailApi=appApi.all("v2/fees/update_type_price_source");return detailApi.post({FEE_TYPE_ID:type_id})},instanceService.updateGroupPriceSource=function(group_id){var detailApi=appApi.all("v2/fees/update_group_price_source");return detailApi.post({FEE_GROUP_ID:group_id})},instanceService.feegroupinsert=function(data){var detailApi=appApi.all("v2/fees/group/insert");return detailApi.post(data)},instanceService.feegroupdetail=function(group_id){console.log(group_id);var detailApi=appApi.all("v2/fees/group/detail");return detailApi.post({FEE_GROUP_ID:group_id})},instanceService.feegroupupdate=function(data){var detailApi=appApi.all("v2/fees/group/update");return detailApi.post(data)},instanceService.feetypeinsert=function(data){var detailApi=appApi.all("v2/fees/type/insert");return detailApi.post(data)},instanceService.feetypedetail=function(type_id){var detailApi=appApi.all("v2/fees/type/detail");return detailApi.post({FEE_TYPE_ID:type_id})},instanceService.feetypeupdate=function(data){var detailApi=appApi.all("v2/fees/type/update");return detailApi.post(data)},instanceService.privatefundsinsert=function(data){var detailApi=appApi.all("v2/fees/funds/insert");return detailApi.post(data)},instanceService.privatefundsdetail=function(pf_id){var detailApi=appApi.all("v2/fees/funds/detail");return detailApi.post({PF_id:pf_id})},instanceService.privatefundsupdate=function(data){var detailApi=appApi.all("v2/fees/funds/update");return detailApi.post(data)},instanceService.all_fee_types=function(){var detailApi=appApi.all("v2/fees/search_type_fees");return detailApi.post()},instanceService.importItemFromXML=function(){var detailApi=appApi.all("v2/items/import_from_source");return detailApi.post()},instanceService}),angular.module("app.loggedIn.item.directives",["app.loggedIn.item.detail.directive","app.loggedIn.item.search.directive","app.loggedIn.item.header_detail.directive","app.loggedIn.item.item_fees.directive","app.loggedIn.item.feegroup.detail.directive","app.loggedIn.item.feetype.detail.directive","app.loggedIn.item.privatefunds.detail.directive"]),angular.module("app.loggedIn.item.detail.directive",[]).directive("itemDetail",function(ItemModel,ItemService,ConfigService,toastr,$timeout){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess"},templateUrl:"modules/item/directives/templates/detail.html",controller:function($scope){$scope.fee_panel={},$scope.loadData=function(id){$scope.id=id,ItemService.detail(id).then(function(data){angular.extend($scope.modelObjectMap,data.data),ConfigService.autoConvertData($scope.modelObjectMap),$scope.fee_panel.reload(id)})}},link:function(scope,element,attrs){if(scope.modelObjectMap=angular.copy(ItemModel),scope.mode={type:"add",text:"Add Item"},scope.data){var data=scope.$eval(scope.data);data.id&&(scope.loadData(data.id),scope.mode={type:"edit",text:"Edit Item"})}var addProcess=function(postData){console.log(postData),ItemService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a new Item","Success"),scope.isSubmit=!1,scope.modelObjectMap=angular.copy(response.data),scope.mode={type:"edit",text:"Edit Item"},scope.fee_panel.reload(scope.modelObjectMap.ITEM_ID))},function(error){toastr.error("Fail to add a new Item","Error")})},editProcess=function(postData){var id=postData.id;delete postData.id,ItemService.update(id,postData).then(function(response){"success"===response.status&&(toastr.success("Edit Item Successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.item.search.directive",[]).directive("itemSearch",function(ItemModel,ItemService,ConfigService,toastr){}),angular.module("app.loggedIn.item.item_fees.directive",[]).directive("itemFees",function(ItemService,ConfigService,toastr){return{restrict:"EA",scope:{item_id:"=id",onsuccess:"=",panel:"="},templateUrl:"modules/item/directives/templates/item_fees.html",controller:function($scope){$scope.panel_types={},$scope.panel_funds={},$scope.private_funds={save:function(){var item_id=$scope.item_id;ItemService.insertItemFundFees(item_id,$scope.panel_funds.data.items).then(function(response){"success"==response.status&&toastr.success("Save successfully !!!","Success")})},options:{not_paging:!0,not_load:!0,scope:$scope.panel_funds,method:"post",api:"api/erm/v2/fees/get_item_fund_fees",columns:[{field:"PF_id",is_hide:!0},{field:"isAHSA",label:"AHSA",type:"checkbox",disabled:!0},{field:"isBUPA",label:"BUPA",type:"checkbox",disabled:!0},{field:"Fund_name",label:"Fund"},{field:"FEE",label:"Fee($)",type:"number"},{field:"PERCENT_FEE",label:"% Fee",type:"number"}],search:{item_id:$scope.item_id}}},$scope.fee_types={save:function(){var item_id=$scope.item_id;ItemService.insertItemFees(item_id,$scope.panel_types.data.items).then(function(response){"success"==response.status&&toastr.success("Save successfully !!!","Success")})},options:{not_paging:!0,not_load:!0,scope:$scope.panel_types,method:"post",api:"api/erm/v2/fees/get_item_fees",columns:[{db_field:"cln_fee_types.FEE_TYPE_ID",field:"FEE_TYPE_ID",is_hide:!0},{field:"FEE_TYPE_NAME",label:"Type"},{field:"SCHEDULE_FEE",label:"Fee",type:"number",disabled:!1}],search:{item_id:$scope.item_id}}},$scope.reload=function(item_id){$scope.item_id=item_id,$scope.panel_types.options.search.item_id=$scope.item_id,$scope.panel_types.reload(),$scope.panel_funds.options.search.item_id=$scope.item_id,$scope.panel_funds.reload()},console.log($scope.panel,$scope.item_id),$scope.panel&&angular.extend($scope.panel,$scope),console.log($scope.panel)}}}),angular.module("app.loggedIn.item.header_detail.directive",[]).directive("itemHeaderDetail",function(ItemHeaderModel,ItemService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",onsuccess:"=onsuccess"},templateUrl:"modules/item/directives/templates/header_detail.html",link:function(scope,element,attrs){var loadData=function(id){ItemService.detailHeader(id).then(function(data){angular.extend(scope.modelObjectMap,data.row),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ItemHeaderModel),scope.mode={type:"add",text:"Add Popular"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Item"})}var addProcess=function(postData){console.log(postData),ItemService.insertHeader(postData).then(function(response){console.log(response),"success"===response.status&&(toastr.success("Added a Popular","Success"),scope.modelObjectMap=angular.copy(ItemHeaderModel),scope.isSubmit=!1,scope.onsuccess&&(console.log(scope.onsuccess),
scope.onsuccess(response)))})},editProcess=function(postData){var id=postData.id;delete postData.id,ItemService.update(id,postData).then(function(response){"success"===response.status&&(toastr.success("Edit Item Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.item.feegroup.detail.directive",[]).directive("feeGroupDetail",function(FeeGroupModel,ItemService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess"},templateUrl:"modules/item/directives/templates/fee_group_detail.html",link:function(scope,element,attrs){var loadData=function(id){ItemService.feegroupdetail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(FeeGroupModel),scope.mode={type:"add",text:"Add Fee Group"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Fee Group"})}var addProcess=function(postData){ItemService.feegroupinsert(postData).then(function(response){"success"===response.status&&(toastr.success("Add successfully","Success"),scope.modelObjectMap=angular.copy(FeeGroupModel),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){postData.id,delete postData.id,ItemService.feegroupupdate(postData).then(function(response){"success"===response.status&&(toastr.success("Edit successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.item.feetype.detail.directive",[]).directive("feeTypeDetail",function(FeeTypesModel,ItemService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess"},templateUrl:"modules/item/directives/templates/fee_type_detail.html",link:function(scope,element,attrs){scope.groupOptions=scope.options.groupSelect.data.items;var loadData=function(id){ItemService.feetypedetail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(FeeTypesModel),scope.mode={type:"add",text:"Add Fee Type"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Fee Type"})}var addProcess=function(postData){ItemService.feetypeinsert(postData).then(function(response){"success"===response.status&&(toastr.success("Add successfully","Success"),scope.modelObjectMap=angular.copy(FeeTypesModel),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){postData.id,delete postData.id,ItemService.feetypeupdate(postData).then(function(response){"success"===response.status&&(toastr.success("Edit successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.item.privatefunds.detail.directive",[]).directive("privateFundsDetail",function(PrivateFundsModel,ItemService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",on_success:"=onsuccess"},templateUrl:"modules/item/directives/templates/private_fund_detail.html",link:function(scope,element,attrs){var loadData=function(id){ItemService.privatefundsdetail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap),scope.AHSAorBUPA="1"===scope.modelObjectMap.isAHSA?0:1})};if(scope.modelObjectMap=angular.copy(PrivateFundsModel),scope.mode={type:"add",text:"Add Private Funds"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit Private Funds"})}var addProcess=function(postData){ItemService.privatefundsinsert(postData).then(function(response){"success"===response.status&&(toastr.success("Add successfully","Success"),scope.modelObjectMap=angular.copy(PrivateFundsModel),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})},editProcess=function(postData){postData.id,delete postData.id,ItemService.privatefundsupdate(postData).then(function(response){"success"===response.status&&(toastr.success("Edit successfully","Success"),scope.isSubmit=!1,scope.on_success&&scope.on_success(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){console.log(scope.AHSAorBUPA),"0"===scope.AHSAorBUPA?(scope.modelObjectMap.isAHSA=1,scope.modelObjectMap.isBUPA=0):(scope.modelObjectMap.isAHSA=0,scope.modelObjectMap.isBUPA=1);var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.item.controller",["app.loggedIn.item.list.controller","app.loggedIn.item.header.controller","app.loggedIn.item.fee.controller","app.loggedIn.item.fee.search.controller"]).controller("ItemController",function($scope,ConfigService){$scope.data_options={api:"api/erm/v2/items/search",method:"post",columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"ITEM_TYPE",label:"Type",width:"15%"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"},ITEM_TYPE:{type:"text"}}}}),angular.module("app.loggedIn.item.list.controller",[]).controller("ItemListController",function($scope,$state,toastr,ItemService){$scope.item_panel={},$scope.itemInfo={},$scope.items={select:0,"class":function(item){return{selected:item.ITEM_ID==$scope.items.select}},options:{api:"api/erm/v2/items/search",method:"post",scope:$scope.item_panel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"ITEM_TYPE",label:"Type",width:"15%"},{field:"ISENABLE",label:"Enable",is_hide:!0}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"},ITEM_TYPE:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Info",callback:function(item){console.log(item),$scope.itemInfo.ITEM_ID=item.ITEM_ID,$scope.editForm.open()}},{"class":"fa fa-money",title:"Fees",callback:function(item){$scope.items.select=item.ITEM_ID,$scope.itemFees.panel.reload(item.ITEM_ID),$scope.itemFees.open()}}]}},$scope.itemFees={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},panel:{}},$scope.addForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){$scope.item_panel.reload()}},$scope.editForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){$scope.item_panel.reload()}},$scope.importItemsFromSource=function(){ItemService.insertFromSource().then(function(response){"success"==response.status&&toastr.success("Update successfully !!!")})}}),angular.module("app.loggedIn.item.header.controller",[]).controller("ItemHeaderController",function($scope,$filter,$state,toastr,ItemService){var arrGetBy=$filter("arrGetBy");$scope.header_color=function(item){return $scope.header_selected==item.POPULAR_HEADER_ID?"success":void 0},$scope.header_click=function(item){$scope.header_selected!=item.POPULAR_HEADER_ID&&($scope.header_selected=item.POPULAR_HEADER_ID,$scope.itemSearch.close(),$scope.showHeaderItem())},$scope.showHeaderItem=function(){$scope.selectList=[],$scope.item_panel.data.more_items=[],$scope.isShowHeaderItem=!0,$scope.item_options.search={POPULAR_HEADER_ID:$scope.header_selected},$scope.item_panel.reload()},$scope.itemHeaderClass=function(item){return item.just_add?"info":void 0},$scope.itemSearch={is_show:!1,open:function(){return 0==$scope.header_selected?void toastr.warning("Please select Header first","Warning"):void(this.is_show=!0)},close:function(){this.is_show=!1},save:function(){ItemService.saveHeaderItems($scope.header_selected,$scope.selectList).then(function(response){"success"===response.status&&(toastr.success("Save Successfully!!!","Success"),$scope.item_panel.reload())})}},$scope.headerAddForm={is_show:!1,open:function(){this.is_show=!0,$scope.itemSearch.close()},close:function(){this.is_show=!1},success:function(response){$scope.header_panel.data.items.unshift(response.data),$scope.headerAddForm.close(),$scope.header_click(response.data)}},$scope.success_add_header=function(response){console.log(response)},$scope.itemSearchClass=function(item){var t_item=arrGetBy($scope.item_panel.data.items,"ITEM_ID",item.ITEM_ID);if(t_item)return"success";var t_item=arrGetBy($scope.selectList,"ITEM_ID",item.ITEM_ID);return t_item?"info":void 0},$scope.itemSearchClick=function(item){var t_item=arrGetBy($scope.item_panel.data.items,"ITEM_ID",item.ITEM_ID);if(!t_item){var t_item=arrGetBy($scope.selectList,"ITEM_ID",item.ITEM_ID);t_item||($scope.selectList.push(item),item.just_add=!0,$scope.item_panel.data.more_items.push(item))}};var init=function(){$scope.item_panel={},$scope.header_panel={},$scope.header_options={api:"api/erm/v2/items/header_search",method:"post",columns:[{field:"POPULAR_HEADER_ID",is_hide:!0},{field:"POPULAR_CODE",label:"Code",width:"10%"},{field:"POPULAR_NAME",label:"Name"},{field:"ISENABLE",label:"Is enable"}],scope:$scope.header_panel},$scope.item_options={api:"api/erm/v2/items/header_item",method:"post",columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"20%"},{field:"ITEM_NAME",label:"Item Name"}],use_filters:!0,search:{POPULAR_HEADER_ID:0},not_load:!0,scope:$scope.item_panel,"static":!0},$scope.search_item_options={api:"api/erm/v2/items/search",method:"post",columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"ITEM_TYPE",label:"Type",width:"15%"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"},ITEM_TYPE:{type:"text"}}},$scope.header_selected=0,$scope.isShowSearchItem=!1,$scope.isShowHeaderItem=!1};init()}),angular.module("app.loggedIn.item.fee.controller",[]).controller("ItemFeeController",function($scope,$state,$timeout,toastr,FileUploader,ItemService){$scope.fee_types_panel={},$scope.private_funds_panel={},$scope.fee_groups_panel={},$scope.feeGroup={},$scope.feeType={},$scope.pf={};var uploader=$scope.uploader=new FileUploader({url:"api/erm/v2/fees/upload",autoUpload:!0,removeAfterUpload:!0});uploader.isUploadOnGroup=function(){return"api/erm/v2/fees/upload_group_price_source"==uploader.url},uploader.filters.push({name:"checkTail",fn:function(item){var name=item.name;return name.toLowerCase().indexOf(".txt")>0||name.indexOf(".xml")>0}}),uploader.filters.push({name:"checkGroup",fn:function(item){var name=item.name;return uploader.isUploadOnGroup()&&"item_fee_type"==$scope.fee_groups.select_item.FEE_GROUP_TYPE?name.toLowerCase().indexOf(".xml")>0:name.toLowerCase().indexOf(".txt")>0}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.log(filter),"checkTail"==filter.name?toastr.error("File invalid","Error"):"checkGroup"==filter.name&&toastr.error("Group file invalid","Error")},uploader.onCompleteItem=function(item,response,status,headers){if("success"!=response.status)return void toastr.error("Upload fail !","error");toastr.success("Upload successfully !","Success");var pricesource=response.filename;if(uploader.isUploadOnGroup())var group_id=$scope.fee_groups.select_item.FEE_GROUP_ID;else{if(!$scope.fee_types.select_item.FEE_GROUP_ID)return void($scope.fee_types.select_item.PRICE_SOURCE=pricesource);var group_id=$scope.fee_types.select_item.FEE_GROUP_ID}angular.forEach($scope.fee_groups_panel.data.items,function(value,key){value.FEE_GROUP_ID==group_id&&(value.PRICE_SOURCE=pricesource)}),angular.forEach($scope.fee_types_panel.data.items,function(value,key){value.FEE_GROUP_ID==group_id&&(value.PRICE_SOURCE=pricesource)})},$scope.fee_groups={select_item:{},options:{api:"api/erm/v2/fees/search_group_fees",scope:$scope.fee_groups_panel,not_paging:!0,method:"post",columns:[{field:"FEE_GROUP_ID",is_hide:!0},{field:"FEE_GROUP_NAME",label:"Group name"},{field:"FEE_GROUP_TYPE",label:"Type"},{field:"PRICE_SOURCE",label:"Price Source"}],use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){console.log(item),$scope.feeGroup.id=item.FEE_GROUP_ID,$scope.editGroupForm.open()}},{"class":"fa fa-upload",title:"Upload Price Source",callback:function(item){console.log(item),$scope.fee_groups.select_item=item,uploader.url="api/erm/v2/fees/upload_group_price_source",uploader.formData[0]={},uploader.formData[0].FEE_GROUP_ID=item.FEE_GROUP_ID,$timeout(function(){$("#fee_type_upload").click()},100)}},{"class":"fa fa-check-circle",title:"Update Price Source",callback:function(item){return item.PRICE_SOURCE?"item_fee_type"==item.FEE_GROUP_TYPE?void ItemService.importItemFromXML().then(function(response){console.log(response),"success"==response.status&&toastr.success("Upload successfully !","Success")}):($scope.fee_groups.select_item=item,void ItemService.updateGroupPriceSource(item.FEE_GROUP_ID).then(function(response){console.log(response),"success"==response.status&&toastr.success("Upload successfully !","Success")})):void toastr.warning("Needed a price source","Warning")}}]}},$scope.fee_types={select_item:{},options:{api:"api/erm/v2/fees/search_type_fees",method:"post",scope:$scope.fee_types_panel,not_paging:!0,columns:[{field:"FEE_TYPE_ID",is_hide:!0},{field:"FEE_TYPE_NAME",label:"Fund name"},{field:"PRICE_SOURCE",label:"Price Source"},{field:"FEE_GROUP_ID",label:"Group",type:"custom",fn:function(item){return null==item.feeGroup?"No Group":item.feeGroup.FEE_GROUP_NAME}},{field:"FEE_GROUP_ORDER",label:"Order"},{field:"ISENABLE",is_hide:!0}],use_actions:!0,action_show:function(item){return null==item.feeGroup?!0:"item_fee_type"!=item.feeGroup.FEE_GROUP_TYPE?!0:!1},actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){console.log(item),$scope.feeType.id=item.FEE_TYPE_ID,$scope.editTypeForm.open()}},{"class":"fa fa-upload",title:"Upload Price Source",callback:function(item){$scope.fee_types.select_item=item,uploader.url="api/erm/v2/fees/upload_type_price_source",uploader.formData[0]={},uploader.formData[0].FEE_TYPE_ID=item.FEE_TYPE_ID,$timeout(function(){$("#fee_type_upload").click()},100)}},{"class":"fa fa-check-circle",title:"Update Price Source",callback:function(item){return item.PRICE_SOURCE?($scope.fee_types.select_item=item,void ItemService.updateTypePriceSource(item.FEE_TYPE_ID).then(function(response){"success"==response.status&&toastr.success("Upload successfully !","Success")})):void toastr.warning("Needed a price source","Warning")}}]}},$scope.private_funds={options:{api:"api/erm/v2/fees/search_fund_fees",scope:$scope.private_funds_panel,not_paging:!0,method:"post",columns:[{field:"PF_id",is_hide:!0},{field:"Isenable",is_hide:!0},{field:"Fund_name",label:"Fund name"},{field:"isAHSA",label:"AHSA",type:"checkbox",disabled:!0},{field:"isBUPA",label:"BUPA",type:"checkbox",disabled:!0}],use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){console.log(item),$scope.pf.id=item.PF_id,$scope.editPrivateFundsForm.open()}}]}},$scope.addGroupForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.fee_groups_panel.reload()}},$scope.editGroupForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.fee_groups_panel.reload(),$scope.fee_types_panel.reload()}},$scope.addTypeForm={options:{groupSelect:$scope.fee_groups_panel},is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.fee_types_panel.reload()}},$scope.editTypeForm={options:{groupSelect:$scope.fee_groups_panel},is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.fee_types_panel.reload()}},$scope.addPrivateFundsForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.private_funds_panel.reload()}},$scope.editPrivateFundsForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.private_funds_panel.reload()}}}),angular.module("app.loggedIn.item.fee.search.controller",[]).controller("ItemFeeSearchController",function($scope,$state,toastr,ItemService){$scope.item_panel={},$scope.items={options:{api:"api/erm/v2/items/search_item_fees",method:"post",scope:$scope.item_panel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"INV_GROUP",label:"Group"},{field:"ITEM_CODE",label:"Code"},{field:"ITEM_NAME",label:"Description"},{field:"ISENABLE",is_hide:!0}],use_filters:!0,filters:{INV_GROUP:{type:"text"},ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}}};var combine_item_fee=function(){var options=$scope.items.options;angular.forEach($scope.fee_list,function(fee,key){options.columns.push({field:"t"+fee.FEE_TYPE_ID,not_submit:!0,label:fee.FEE_TYPE_NAME,type:"custom",fn:function(item){if(!item.feeTypes||0==item.feeTypes.length)return"";for(var i=item.feeTypes.length-1;i>=0;i--){var fee_type=item.feeTypes[i];if(fee_type.FEE_TYPE_ID==fee.FEE_TYPE_ID)return fee_type.clnItemFee.SCHEDULE_FEE}return""}})})},init=function(){ItemService.all_fee_types().then(function(res){$scope.fee_list=res.list,combine_item_fee()})};init()});var kiss={concat:function(){for(var str="",i=0;i<arguments.length;i++)str+=arguments[i];return str},msToTimer:function(num){var timerItem={x:null,hour:null,minute:null,second:null,display:null};timerItem.x=num,timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp;var pad=function(num,size){var s="000000000"+num;return s.substr(s.length-size)};return timerItem.display=pad(timerItem.hour,2)+":"+pad(timerItem.minute,2)+":"+pad(timerItem.second,2),timerItem}};angular.module("app.kiss.timer.directive",[]).directive("kissTimer",function($interval){return{restrict:"E",scope:{startSessionTime:"=",returnValue:"="},templateUrl:"modules/kissModule/directives/templates/kissTimer.html",link:function($scope,element,attrs){var run=function(){var startSessionTime=moment(new Date($scope.startSessionTime)),currentTime=moment(),x=currentTime.diff(startSessionTime,"seconds"),timerItem={x:null,hour:null,minute:null,second:null};timerItem.x=x,timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp;var pad=function(num,size){var s="000000000"+num;return s.substr(s.length-size)},updateTime=function(){timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp,timerItem.x=timerItem.x+1,$scope.returnValue=pad(timerItem.hour,2)+":"+pad(timerItem.minute,2)+":"+pad(timerItem.second,2)};$scope.timer=$interval(updateTime,1e3)};$scope.$watch("startSessionTime",function(newValue,oldValue){$scope.startSessionTime&&("close"!=$scope.startSessionTime?run():$interval.cancel($scope.timer))}),element.on("$destroy",function(){$interval.cancel($scope.timer)})}}}),angular.module("app.calling",[]).config(function($stateProvider){$stateProvider.state("test_call",{url:"/testCall/:apiKey/:clientId/:callUser/:isCaller/:patientId",views:{root:{templateUrl:"modules/makeCall/views/call_apiRTC.html",controller:"callControllerApiRTC"}}}).state("make_call",{url:"/makeCall/:apiKey/:sessionId/:token/:callUser/:isCaller/:patientId",views:{root:{templateUrl:"modules/makeCall/views/call.html",controller:"callController"}}}).state("whiteboard",{url:"/whiteboard/:apiKey/:sessionId/:token/:patientId",views:{root:{templateUrl:"modules/makeCall/views/whiteboard.html",controller:"whiteboardController"}}})}),angular.module("app.calling").controller("callController",function($timeout,$scope,$document,$modalStack,$interval,$location,$rootScope,OTSession,$state,$modal,$cookieStore,toastr,$window,socket,UserService,$stateParams){function cancelListenerHandler(){console.log("Remove Success")}function disconnect(){0==$scope.streams.length?(socket.emit("sendMessage",$scope.userInfo.id,$stateParams.callUser,{type:"cancel"}),window.close(),null==window.whiteboard_screen&&window.whiteboard_screen.closed||window.whiteboard_screen.close()):UserService.getUserInfo($scope.userInfo.id).then(function(data){var signal={type:"cancelCall",data:data.user_name};OTSession.session.signal(signal,function(err){err?TB.error(err):(window.close(),null==window.whiteboard_screen&&window.whiteboard_screen.closed||window.whiteboard_screen.close())})})}function popup(url){return params="width="+screen.width,params+=", height="+screen.height,params+=", left=0",params+=", top=0",params+=", fullscreen=yes",(null==window.whiteboard_screen||window.whiteboard_screen.closed)&&(window.whiteboard_screen=window.open(url,"RedimedWhiteboard",params),window.whiteboard_screen.focus()),null==window.whiteboard_screen||window.whiteboard_screen.closed||window.open("","RedimedWhiteboard",""),!1}var audio=new Audio("theme/assets/phone_calling.mp3"),params=($cookieStore.get("toState"),{}),apiKey=$stateParams.apiKey,sessionId=$stateParams.sessionId,token=$stateParams.token;$scope.newwin=null,$scope.session=null,$scope.streams=OTSession.streams,$scope.connections=OTSession.connections,$scope.userInfo=null,$scope.callUserInfo=null,$scope.patientId=null!=$stateParams.patientId||void 0!=$stateParams.patientId?$stateParams.patientId:null,$scope.isCaller=1==$stateParams.isCaller||"1"==$stateParams.isCaller?!0:!1,$scope.isAccept=!1,UserService.getUserInfo($stateParams.callUser).then(function(data){data.img="theme/assets/icon.png",$scope.callUserInfo=data}),$scope.$on("onUnload",function(e){audio.pause(),disconnect()}),$scope.isAudioMuted=!1,$scope.isVideoMuted=!1,$scope.sharingMyScreen=!1,$scope.publishing=!1,$scope.screenBig=!0,$scope.screenShareSupported=!1,$scope.connected=!1,$scope.screenShareFailed=null,$scope.mouseMove=!1,$scope.selectingScreenSource=!1,$scope.promptToInstall=!1,$scope.showWhiteboard=!1,$scope.showBluetooth=!1,$scope.whiteboardUnread=!1,OT.registerScreenSharingExtension("chrome","pkakgggplhfilfbailbaibljfpalofjn"),OT.checkScreenSharingCapability(function(response){$scope.screenShareSupported=response.supported&&response.extensionRegistered!==!1,$scope.$apply()}),$scope.screenPublisherProps={name:"screen",style:{nameDisplayMode:"off"},publishAudio:!1,maxResolution:{width:1920,height:1080},videoSource:"screen"},$scope.facePublisherProps={name:"face",width:"100%",height:"100%",style:{nameDisplayMode:"off"},resolution:"1280x720",frameRate:30},$scope.notMine=function(stream){return stream.connection.connectionId!==$scope.session.connection.connectionId},null==$cookieStore.get("userInfo")||"undefined"==typeof $cookieStore.get("userInfo")?disconnect():$scope.userInfo=$cookieStore.get("userInfo"),$scope.session&&$scope.session.disconnect(),OTSession.init(apiKey,sessionId,token,function(err,session){$scope.session=session;var connectDisconnect=function(connected){$scope.$apply(function(){$scope.connected=connected,connected||($scope.publishing=!1)})};(session.is&&session.is("connected")||session.connected)&&(connectDisconnect(!0),$scope.publishing=!0),$scope.session.on("sessionConnected",connectDisconnect.bind($scope.session,!0)),$scope.session.on("sessionDisconnected",connectDisconnect.bind($scope.session,!1));var whiteboardUpdated=function(){$scope.showWhiteboard||$scope.whiteboardUnread||$scope.$apply(function(){$scope.whiteboardUnread=!0,$scope.mouseMove=!0})},deviceUpdated=function(){$scope.showBluetooth||$scope.$apply(function(){$scope.mouseMove=!0})};$scope.$on("otWhiteboardUpdate",whiteboardUpdated),$scope.$on("medicalDeviceUpdate",deviceUpdated),$scope.isCaller?(audio.loop=!0,audio.play(),socket.emit("sendMessage",$scope.userInfo.id,$stateParams.callUser,{type:"call",sessionId:sessionId})):socket.emit("sendMessage",$scope.userInfo.id,$stateParams.callUser,{type:"answer"})}),socket.removeListener("messageReceived",cancelListenerHandler),socket.on("messageReceived",function(fromId,fromUser,message){"answer"===message.type&&(audio.pause(),$scope.isAccept=!0,$modalStack.dismissAll()),"ignore"===message.type&&(toastr.info(fromUser+" Has Ignored The Call!"),0==$scope.streams.length?(audio.pause(),disconnect()):$modalStack.dismissAll()),"cancel"===message.type&&(audio.pause(),toastr.info(fromUser+" Has Left The Call!"),disconnect())}),$scope.muteAudio=function(){$scope.isAudioMuted=!$scope.isAudioMuted},$scope.muteVideo=function(){$scope.isVideoMuted=!$scope.isVideoMuted},$scope.cancelCall=function(){swal({title:"Are you sure want to cancel the call?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){audio.pause(),disconnect()})},OTSession.session&&OTSession.session.on({"signal:cancelCall":function(event){toastr.info(event.data+" Has Left The Call!"),$timeout(function(){0==$scope.streams.length&&(window.close(),null==window.whiteboard_screen&&window.whiteboard_screen.closed||window.whiteboard_screen.close())},1500)}}),$scope.installScreenshareExtension=function(){chrome.webstore.install("https://chrome.google.com/webstore/detail/pkakgggplhfilfbailbaibljfpalofjn",function(){console.log("successfully installed")},function(){console.error("failed to install",arguments)})},$scope.toggleWhiteboard=function(){popup($state.href("whiteboard",{apiKey:apiKey,sessionId:sessionId,token:token,patientId:$scope.patientId}))},$scope.toggleBluetooth=function(){$scope.showBluetooth=!$scope.showBluetooth,setTimeout(function(){$scope.$emit("otLayout")},10)},$scope.toggleShareScreen=function(){$scope.connected&&($scope.sharingMyScreen||$scope.selectingScreenSource?$scope.sharingMyScreen&&($scope.sharingMyScreen=!1):($scope.selectingScreenSource=!0,$scope.screenShareFailed=null,OT.checkScreenSharingCapability(function(response){response.supported&&response.extensionRegistered!==!1?response.extensionInstalled===!1?($scope.promptToInstall=!0,$scope.selectingScreenSource=!1):($scope.sharingMyScreen=!0,$scope.selectingScreenSource=!1):($scope.screenShareSupported=!1,$scope.selectingScreenSource=!1),$scope.$apply()})))},$scope.addPeople=function(){if(console.log($scope.streams),0==$scope.streams.length)toastr.warning("Please Wait For Calling Person First!");else if($scope.streams.length<2&&$scope.streams.length>0){for(var arrUser=[],i=0;i<$scope.streams.length;i++)arrUser.push($scope.streams[i].name);$modal.open({templateUrl:"modules/makeCall/views/dialogs/invitePeople.html",size:"sm",backdrop:"static",keyboard:!1,resolve:{userInfo:function(){return $scope.userInfo},arrUser:function(){return arrUser},sessionId:function(){return sessionId},OTSession:function(){return OTSession},patientId:function(){return $scope.patientId}},controller:function($scope,UserService,$modalInstance,toastr,socket,userInfo,sessionId,OTSession,patientId,arrUser){$scope.isMakeCall=!1,$scope.callUser=null,$scope.userInfo=userInfo,UserService.getOnlineUsers().then(function(rs){$scope.onlineUsers=rs.data}),$scope.cancelCall=function(){socket.emit("sendMessage",userInfo.id,$scope.callUser.id,{type:"cancel"}),$modalInstance.close({type:"cancel"})},$scope.callUser=function(u){$scope.isMakeCall=!0,$scope.callUser=u,socket.emit("sendMessage",userInfo.id,u.id,{type:"call",sessionId:sessionId,patientId:patientId})},$scope.cancelClick=function(){$modalInstance.close({type:"cancel"})}}})}else toastr.warning("Can Only Make A Group Call With 3 People!")},$scope.$on("changeSize",function(event){event.targetScope.stream.oth_large=void 0===event.targetScope.stream.oth_large?"screen"!==event.targetScope.stream.name:!event.targetScope.stream.oth_large,setTimeout(function(){event.targetScope.$emit("otLayout")},10)}),$scope.$on("changeScreenSize",function(event){$scope.screenBig=!$scope.screenBig,setTimeout(function(){event.targetScope.$emit("otLayout")},10)}),$scope.$on("otPublisherError",function(event,error,publisher){"screenPublisher"===publisher.id&&$scope.$apply(function(){$scope.screenShareFailed=error.message,$scope.toggleShareScreen()})}),$scope.$on("otStreamDestroyed",function(event){"screenPublisher"===event.targetScope.publisher.id&&$scope.$apply(function(){$scope.sharingMyScreen=!1})});var mouseMoveTimeout,mouseMoved=function(event){$scope.mouseMove||$scope.$apply(function(){$scope.mouseMove=!0}),mouseMoveTimeout&&clearTimeout(mouseMoveTimeout),mouseMoveTimeout=setTimeout(function(){$scope.$apply(function(){$scope.mouseMove=!1})},5e3)};$window.addEventListener("mousemove",mouseMoved),$window.addEventListener("touchstart",mouseMoved),$document.context.body.addEventListener("orientationchange",function(){$scope.$emit("otLayout")}),$scope.$on("$destroy",function(){$scope.session&&$scope.connected&&($scope.session.disconnect(),$scope.connected=!1),$scope.session=null,disconnect()})}).controller("whiteboardController",function($scope,OTSession,$stateParams,$window){var apiKey=$stateParams.apiKey,sessionId=$stateParams.sessionId,token=$stateParams.token;$scope.patientId=$stateParams.patientId,$scope.mouseMove=!1,$scope.connected=!1,$scope.session=null,$scope.session&&$scope.session.disconnect(),OTSession.init(apiKey,sessionId,token,function(err,session){$scope.session=session;var connectDisconnect=function(connected){$scope.$apply(function(){$scope.connected=connected})};(session.is&&session.is("connected")||session.connected)&&connectDisconnect(!0),$scope.session.on("sessionConnected",connectDisconnect.bind($scope.session,!0)),$scope.session.on("sessionDisconnected",connectDisconnect.bind($scope.session,!1));var whiteboardUpdated=function(){$scope.$apply(function(){$scope.mouseMove=!0})};$scope.$on("otWhiteboardUpdate",whiteboardUpdated)});var mouseMoveTimeout,mouseMoved=function(event){$scope.mouseMove||$scope.$apply(function(){$scope.mouseMove=!0}),mouseMoveTimeout&&clearTimeout(mouseMoveTimeout),mouseMoveTimeout=setTimeout(function(){$scope.$apply(function(){$scope.mouseMove=!1})},5e3)};$window.addEventListener("mousemove",mouseMoved),$window.addEventListener("touchstart",mouseMoved)}).directive("medicalDevice",function(OTSession,$window,Restangular,socket){return{restrict:"E",scope:{callSession:"="},templateUrl:"modules/makeCall/views/medicalDevice.html",link:function(scope,element,attrs){scope.onlineDevice=null,scope.onlineData=null,scope.session=null,scope.session=scope.callSession?scope.callSession:OTSession.session;var signalError=function(err){err?TB.error(err):console.log("success")};socket.on("getMeasureData",function(rs){if(rs.info){var data=angular.copy(rs.info);
delete data.deviceType,delete data.rawData,scope.$apply(function(){scope.onlineDevice=rs.info.deviceType,scope.onlineData=data});var signal={type:"bluetooth_data",data:rs.info};scope.session.signal(signal,signalError)}}),scope.session&&scope.session.on({"signal:bluetooth_data":function(event){if(event.from.connectionId!==scope.session.connection.connectionId){var info=event.data;if(info){var rs=angular.copy(info);delete rs.deviceType,delete rs.rawData,scope.$apply(function(){scope.onlineDevice=info.deviceType,scope.onlineData=rs})}scope.$emit("medicalDeviceUpdate")}}})}}}),angular.module("app.calling").controller("callControllerApiRTC",function($timeout,$scope,$document,$modalStack,$interval,$location,$rootScope,$state,$modal,$cookieStore,toastr,$window,socket,UserService,$stateParams){function userMediaErrorHandler(e){console.log("userMediaErrorHandler"),console.log(e)}function hangupHandler(e){console.log("hangupHandler"),console.log(e.detail.reason)}function incomingCallHandler(e){console.log("========Incoming Call========="),audio.pause(),$scope.isAccept=!0}function callAttemptHandler(e){alert("Id :"+e.detail.callerId+"is trying to reach you")}function errorHandler(e){console.log("errorHandler"),console.log(e)}function sessionReadyHandler(e){apiRTC.addEventListener("incomingCall",incomingCallHandler),apiRTC.addEventListener("userMediaError",userMediaErrorHandler),apiRTC.addEventListener("callAttempt",callAttemptHandler),apiRTC.addEventListener("hangup",hangupHandler),apiRTC.addEventListener("error",errorHandler);var webRTCClient=apiCC.session.createWebRTCClient({localVideo:"myLocalVideo",minilocalVideo:"myMiniVideo",remoteVideo:"myRemoteVideo",status:"status"});$scope.isCaller?(audio.loop=!0,audio.play(),socket.emit("sendMessage",$scope.userInfo.id,$stateParams.callUser,{type:"call",apiKey:$stateParams.apiKey,clientId:webRTCClient.webRTCClient.clientId})):$stateParams.clientId&&webRTCClient.call($stateParams.clientId)}function disconnect(){socket.emit("sendMessage",$scope.userInfo.id,$stateParams.callUser,{type:"cancel"}),window.close(),null==$scope.newwin&&$scope.newwin.closed||$scope.newwin.close()}var audio=new Audio("theme/assets/phone_calling.mp3");$stateParams.apiKey,$scope.newwin=null,$scope.userInfo=null,$scope.callUserInfo=null,$scope.patientId=null!=$stateParams.patientId||void 0!=$stateParams.patientId?$stateParams.patientId:null,$scope.isCaller=1==$stateParams.isCaller||"1"==$stateParams.isCaller?!0:!1,$scope.isAccept=!1,UserService.getUserInfo($stateParams.callUser).then(function(data){data.img="theme/assets/icon.png",$scope.callUserInfo=data}),$scope.userInfo=$cookieStore.get("userInfo"),apiRTC.init({apiKey:$stateParams.apiKey,appId:"RedimedApp",onReady:sessionReadyHandler}),socket.removeListener("messageReceived"),socket.on("messageReceived",function(fromId,fromUser,message){"ignore"===message.type&&(audio.pause(),toastr.info(fromUser+" Has Ignored The Call!"),disconnect()),"cancel"===message.type&&(audio.pause(),toastr.info(fromUser+" Has Left The Call!"),disconnect())})}),angular.module("app.loggedIn.mdtappointment",["app.loggedIn.mdtappointment.directives","app.loggedIn.mdtappointment.services"]),angular.module("app.loggedIn.mdtappointment.services",[]).factory("mdtAppointmentService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/erm/v2/appt/");return mdtService.byId=function(id){var funcApi=mdtApi.one("detail");return funcApi.get({id:id})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("update");return funcApi.post({data:postData,cal_id:id})},mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtappointment.directives",["app.loggedIn.mdtappointment.detail.directive","app.loggedIn.mdtappointment.search.directive"]),angular.module("app.loggedIn.mdtappointment.detail.directive",[]).directive("mdtAppointmentDetail",function(mdtAppointmentModel,ConfigService,mdtAppointmentService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtappointment/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&-1!=scope.params.id&&mdtAppointmentService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtAppointmentMap,response.data),ConfigService.autoConvertData(scope.mdtAppointmentMap);for(var cols=["ARR_TIME","ATTEND_TIME","FROM_TIME","TO_TIME"],i=0;i<cols.length;++i){var col=cols[i];scope.mdtAppointmentMap[col]=new Date(scope.mdtAppointmentMap[col])}ConfigService.system_service_by_clinical(scope.mdtAppointmentMap.CLINICAL_DEPT_ID).then(function(response){scope.serviceList=response})}),scope.mdtAppointmentMap=angular.copy(mdtAppointmentModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtappointmentForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtAppointmentMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));if(scope.params.permission.edit===!0){for(var cols=["doctor","Patient_id","CAL_ID","CLINICAL_DEPT_ID","SITE_ID","DOCTOR_ID","FROM_TIME","TO_TIME","PATIENTS"],i=0;i<cols.length;++i){var col=cols[i];delete postData[col]}mdtAppointmentService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")})}else mdtAppointmentService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init()}}}}}),angular.module("app.loggedIn.mdtappointment.search.directive",[]).directive("mdtappointmentSearch",function(mdtAppointmentService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtappointment/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"DOCTOR_ID",value:""},{type:"text",name:"SITE_ID",value:""},{type:"text",name:"FROM_TIME",value:""}],select:["DOCTOR_ID","SITE_ID","FROM_TIME"]}},loadList=function(){mdtAppointmentService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtdept",["app.loggedIn.mdtdept.directives","app.loggedIn.mdtdept.services"]),angular.module("app.loggedIn.mdtdept.services",[]).factory("mdtDeptService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtdept/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService.listAll=function(){var funcApi=mdtApi.one("list");return funcApi.get()},mdtService}),angular.module("app.loggedIn.mdtdept.directives",["app.loggedIn.mdtdept.detail.directive","app.loggedIn.mdtdept.search.directive"]),angular.module("app.loggedIn.mdtdept.detail.directive",[]).directive("mdtdeptDetail",function(mdtDeptModel,ConfigService,mdtDeptService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtdept/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtDeptService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtDeptMap,response.data);for(var key in scope.mdtDeptMap)scope.mdtDeptMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtDeptMap[key]=scope.mdtDeptMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtDeptMap[key]=new Date(scope.mdtDeptMap[key])))}),scope.mdtDeptMap=angular.copy(mdtDeptModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtdeptForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtDeptMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtDeptService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtDeptService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtdept.search.directive",[]).directive("mdtdeptSearch",function(mdtDeptService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtdept/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"CLINICAL_DEPT_NAME",value:""},{type:"text",name:"ISENABLE",value:""},{type:"text",name:"Created_by",value:""}],select:["CLINICAL_DEPT_NAME","ISENABLE","Created_by"]}},loadList=function(){mdtDeptService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtdoctor",["app.loggedIn.mdtdoctor.directives","app.loggedIn.mdtdoctor.services"]),angular.module("app.loggedIn.mdtdoctor.services",[]).factory("mdtDoctorService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtdoctor/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService.specialities=function(option){var funcApi=mdtApi.all("specialities");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtdoctor.directives",["app.loggedIn.mdtdoctor.detail.directive","app.loggedIn.mdtdoctor.search.directive"]),angular.module("app.loggedIn.mdtdoctor.detail.directive",[]).controller("SpecialtyRemoveDialog",function($scope,$modalInstance,list){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(list)}}).directive("mdtdoctorDetail",function(mdtDoctorModel,ConfigService,mdtDoctorService,mdtSpecialtyService,UserService,ReceptionistService,toastr,$cookieStore,$modal,$stateParams){return{restrict:"EA",scope:{options:"=",params:"=",itemUpdate:"=",onsuccess:"=onsuccess"},templateUrl:"modules/mdtdoctor/directives/templates/detail.html",link:function(scope,element,attrs){scope.closePopup=function(){angular.element("#"+scope.params.popupId).fadeOut()},scope.users=null,scope.siteList=null,UserService.all().then(function(response){scope.users=response.data}),ReceptionistService.getSite().then(function(rs){"success"==rs.status&&(scope.siteList=rs.data)});var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtDoctorService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtDoctorMap,response.data);for(var key in scope.mdtDoctorMap)scope.mdtDoctorMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtDoctorMap[key]=scope.mdtDoctorMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtDoctorMap[key]=new Date(scope.mdtDoctorMap[key])));scope.mdtDoctorMap.Title=parseInt(scope.mdtDoctorMap.Title),scope.mdtDoctorMap.Created_by=$cookieStore.get("userInfo").id,scope.mdtDoctorMap.Last_updated_by=$cookieStore.get("userInfo").id,scope.mdtDoctorMap.Medical_Registration_no=parseInt(scope.mdtDoctorMap.Medical_Registration_no)}),scope.mdtDoctorMap=angular.copy(mdtDoctorModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,!scope.mdtdoctorForm.$invalid){var postData=angular.copy(scope.mdtDoctorMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));postData.Last_update_date=ConfigService.getCommonDatetime(new Date),(null==postData.numsOfRoom||""==postData.numsOfRoom)&&(postData.numsOfRoom=0),scope.params.permission.edit===!0?mdtDoctorService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success"),scope.itemUpdate=!0,scope.onsuccess&&(console.log(scope.onsuccess),scope.onsuccess(response))}):(postData.Creation_date=ConfigService.getCommonDatetime(new Date),mdtDoctorService.add(postData).then(function(response){"error"==response.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init(),scope.itemUpdate=!0,scope.onsuccess&&(console.log(scope.onsuccess),scope.onsuccess(response))}),init())}},scope.clearSignature=function(){scope.mdtDoctorMap.Signature=""};var addDialog=function(){$modal.open({templateUrl:"dialogSelectSpeciality",controller:function($scope,$modalInstance,doctorId){var clickRow=function(row){$modalInstance.close(row)};$scope.speciality={limit:10,reload:!1,doctorId:doctorId,clickRow:function(row){clickRow(row)}}},size:"lg",resolve:{doctorId:function(){return $stateParams.doctorId}}}).result.then(function(row){var postData={doctor_id:$stateParams.doctorId,Specialties_id:row.Specialties_id,Isenable:1};mdtSpecialtyService.selectServiceDoctor(postData).then(function(response){toastr.success("Select Successfully"),scope.speciality.load()},function(error){})})},load=function(){var postData={doctor_id:$stateParams.doctorId};mdtSpecialtyService.listByServiceDoctor(postData).then(function(response){scope.speciality.list=response.data},function(error){})},onActiveList=function(list){mdtSpecialtyService.active({doctor_id:$stateParams.doctorId,Specialty_id:list.Specialties_id}).then(function(response){toastr.success("Active Successfully"),scope.doctor.load(),scope.speciality.load()},function(error){})},removeDialog=function(list){$modal.open({templateUrl:"dialogSpecialtyRemove",controller:"SpecialtyRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){var postData={doctor_id:$stateParams.doctorId,Specialties_id:list.Specialties_id};mdtSpecialtyService.removeServiceDoctor(postData).then(function(response){toastr.success("Delete Successfully"),scope.speciality.load()},function(error){})})};scope.disable=function(list){var postData={doctor_id:$stateParams.doctorId,Specialties_id:list.Specialties_id,Isenable:list.Isenable};mdtSpecialtyService.removeServiceDoctor(postData).then(function(response){scope.speciality.load()},function(error){})},scope.speciality={list:[],onActiveList:function(list){onActiveList(list)},load:function(){load()},dialog:{add:function(){addDialog()},remove:function(list){removeDialog(list)}},active:0},scope.option={titles:null,providers:null,qualifications:null,departments:null},ConfigService.title_option().then(function(response){"success"===response.status&&(scope.option.titles=response.data)}),ConfigService.provider_option().then(function(response){"success"===response.status&&(scope.option.providers=response.data)}),ConfigService.department_option().then(function(response){"success"===response.status&&(scope.option.departments=response.data)}),ConfigService.qualification_option().then(function(response){"success"===response.status&&(scope.option.qualifications=response.data)}),scope.speciality.load();var doctorLoad=function(){mdtDoctorService.byId($stateParams.doctorId).then(function(response){scope.speciality.active=response.data.Specialty_id},function(error){})};scope.doctor={item:{},load:function(){doctorLoad()}},scope.doctor.load()}}}),angular.module("app.loggedIn.mdtdoctor.search.directive",[]).directive("mdtdoctorSearch",function(mdtDoctorService,toastr,$modal){return{restrict:"EA",scope:{clickRow:"&",isClose:"@"},templateUrl:"modules/mdtdoctor/directives/templates/search.html",link:function(scope,element,attrs){scope.closePopup=function(){angular.element("#"+scope.isClose).fadeOut()};var init=function(){scope.list={},scope.params={pagination:{limit:7,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"NAME",value:""},{type:"text",name:"Email",value:""},{type:"text",name:"Phone",value:""},{type:"text",name:"Isenable",value:"1"}],select:["doctor_id","NAME","Email","Phone","CLINICAL_DEPT_ID"]},scope.isClose&&scope.closePopup()},loadList=function(){mdtDoctorService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()},scope.addDoctor=function(){$modal.open({templateUrl:"AddDoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.params_doctor={permission:{create:!0,edit:!1}},$scope.itemUpdate=!1,$scope.$watch("itemUpdate",function(item){item===!0&&$modalInstance.close("success")})}}).result.then(function(response){})},scope.refresh=function(){loadList()}}}}),angular.module("app.loggedIn.mdtinsurer",["app.loggedIn.mdtinsurer.directives","app.loggedIn.mdtinsurer.services"]),angular.module("app.loggedIn.mdtinsurer.services",[]).factory("mdtInsurerService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtinsurer/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService.list=function(){var funcApi=mdtApi.one("list");return funcApi.get()},mdtService}),angular.module("app.loggedIn.mdtinsurer.directives",["app.loggedIn.mdtinsurer.detail.directive","app.loggedIn.mdtinsurer.search.directive"]),angular.module("app.loggedIn.mdtinsurer.detail.directive",[]).directive("mdtinsurerDetail",function(mdtInsurerModel,ConfigService,mdtInsurerService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtinsurer/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtInsurerService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtInsurerMap,response.data);for(var key in scope.mdtInsurerMap)scope.mdtInsurerMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtInsurerMap[key]=scope.mdtInsurerMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtInsurerMap[key]=new Date(scope.mdtInsurerMap[key])))}),scope.mdtInsurerMap=angular.copy(mdtInsurerModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtinsurerForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtInsurerMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtInsurerService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtInsurerService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtinsurer.search.directive",[]).directive("mdtinsurerSearch",function(mdtInsurerService,toastr){return{restrict:"EA",scope:{clickRow:"&",isClose:"@"},templateUrl:"modules/mdtinsurer/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"insurer_name",value:""},{type:"text",name:"address",value:""},{type:"text",name:"suburb",value:""}],select:["insurer_name","address","suburb"]}};scope.closePopup=function(){angular.element(idClose).fadeOut()};var loadList=function(){mdtInsurerService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtoutdoctor",["app.loggedIn.mdtoutdoctor.directives","app.loggedIn.mdtoutdoctor.services","app.loggedIn.mdtoutdoctor.add.dialog"]),angular.module("app.loggedIn.mdtoutdoctor.services",[]).factory("mdtOutdoctorService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtoutdoctor/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtoutdoctor.directives",["app.loggedIn.mdtoutdoctor.detail.directive","app.loggedIn.mdtoutdoctor.search.directive","app.loggedIn.mdtoutdoctor.add.directive"]),angular.module("app.loggedIn.mdtoutdoctor.detail.directive",[]).directive("mdtoutdoctorDetail",function(mdtOutdoctorModel,ConfigService,mdtOutdoctorService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtoutdoctor/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtOutdoctorService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtOutdoctorMap,response.data);for(var key in scope.mdtOutdoctorMap)scope.mdtOutdoctorMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtOutdoctorMap[key]=scope.mdtOutdoctorMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtOutdoctorMap[key]=new Date(scope.mdtOutdoctorMap[key])))}),scope.mdtOutdoctorMap=angular.copy(mdtOutdoctorModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtoutdoctorForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtOutdoctorMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtOutdoctorService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtOutdoctorService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtoutdoctor.search.directive",[]).directive("mdtoutdoctorSearch",function(mdtOutdoctorService,toastr,$modal){return{restrict:"EA",scope:{clickRow:"&",isClose:"@",data:"="},templateUrl:"modules/mdtoutdoctor/directives/templates/search.html",link:function(scope,element,attrs){scope.closePopup=function(){angular.element("#"+scope.isClose).fadeOut()},scope.OutSideDoctor=function(size){$modal.open({templateUrl:"modules/mdtoutdoctor/dialogs/templates/add.html",controller:"MdtoutdoctorAdddialog",size:"lg"}).result.then(function(response){"success"===response.status&&(toastr.success("Add Successfully"),scope.data=response.data,loadList())})};var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"provider_no",value:""},{type:"text",name:"name",value:""},{type:"text",name:"address",value:""}],select:["doctor_id","provider_no","name","address"]},scope.isClose&&scope.closePopup()},loadList=function(){mdtOutdoctorService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()},scope.refresh=function(){loadList()}}}}),angular.module("app.loggedIn.mdtoutdoctor.add.directive",[]).directive("mdtoutdoctorAdd",function(mdtOutdoctorModel,ConfigService,mdtOutdoctorService,toastr){return{restrict:"EA",scope:{options:"=",params:"=",success:"=",data:"="},templateUrl:"modules/mdtoutdoctor/directives/templates/add.html",link:function(scope,element,attrs){scope.mdtOutdoctorMap={provider_no:null,name:null,address:null,suburb:null,state:null,phone:null},scope.errors=[],scope.save=function(){ConfigService.beforeSave(scope.errors);var postData=angular.copy(scope.mdtOutdoctorMap);mdtOutdoctorService.add(postData).then(function(data){scope.success=!0,scope.data=data},function(error){scope.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.errors)})}}}}),angular.module("app.loggedIn.mdtoutdoctor.add.dialog",[]).controller("MdtoutdoctorAdddialog",function($scope,$modalInstance){$scope.OutsideDoctor={success:!1,data:null},$scope.$watch("OutsideDoctor.success",function(success){success&&$scope.$watch("OutsideDoctor.data",function(success){$modalInstance.close($scope.OutsideDoctor.data)})})}),angular.module("app.loggedIn.mdtoutreferral",["app.loggedIn.mdtoutreferral.directives","app.loggedIn.mdtoutreferral.services"]),angular.module("app.loggedIn.mdtoutreferral.services",[]).factory("mdtoutreferralService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtoutreferral/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtoutreferral.directives",["app.loggedIn.mdtoutreferral.detail.directive","app.loggedIn.mdtoutreferral.search.directive"]),angular.module("app.loggedIn.mdtoutreferral.detail.directive",[]).directive("mdtoutreferralDetail",function(mdtoutreferralModel,mdtDoctorService,mdtOutdoctorService,ConfigService,mdtoutreferralService,toastr,$cookieStore,$state,$stateParams){return{restrict:"EA",scope:{options:"=",params:"=",isClose:"@",itemUpdate:"="},templateUrl:"modules/mdtoutreferral/directives/templates/detail.html",link:function(scope,element,attrs){scope.closePopup=function(){angular.element("#"+scope.isClose).fadeOut()},scope.module_id={doctor:"DoctorModule",referred_doctor:"DoctorReferredModule"},scope.module_id_edit={doctor:"DoctorEditModule",referred_doctor:"DoctorReferredEditModule"},scope.$watch("params.id",function(newId,oldId){scope.params.permission.edit===!0&&"undefined"!=typeof newId&&0!==newId&&mdtoutreferralService.byId(newId).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtoutreferralMap,response.data);for(var key in scope.mdtoutreferralMap)scope.mdtoutreferralMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtoutreferralMap[key]=scope.mdtoutreferralMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtoutreferralMap[key]=new Date(scope.mdtoutreferralMap[key])),scope.mdtoutreferralMap.last_updated_by=$cookieStore.get("userInfo").id);mdtDoctorService.byId(scope.mdtoutreferralMap.referred_to_doctor).then(function(response){scope.selectedReferredDoctor=response.data}),mdtOutdoctorService.byId(scope.mdtoutreferralMap.doctor_id).then(function(response){scope.selectedDoctor=response.data})})});var init=function(){scope.isSubmit=!1,scope.mdtoutreferralMap=angular.copy(mdtoutreferralModel),scope.mdtoutreferralMap.patient_id=$stateParams.patient_id,scope.mdtoutreferralMap.created_by=$cookieStore.get("userInfo").id,scope.mdtoutreferralMap.last_updated_by=$cookieStore.get("userInfo").id,scope.isClose&&scope.closePopup(),scope.selectedReferredDoctor={NAME:"Select Referred Doctor"},scope.selectedDoctor={name:"Select Doctor"}};init(),scope.clickReferredDoctor=function(){scope.params.permission.edit===!0?angular.element("#"+scope.module_id_edit.referred_doctor).fadeIn():angular.element("#"+scope.module_id.referred_doctor).fadeIn()},scope.selectReferredDoctor=function(row){scope.selectedReferredDoctor=row,scope.params.permission.edit===!0?angular.element("#"+scope.module_id_edit.referred_doctor).fadeOut():angular.element("#"+scope.module_id.referred_doctor).fadeOut()},scope.clickDoctor=function(){scope.params.permission.edit===!0?angular.element("#"+scope.module_id_edit.doctor).fadeIn():angular.element("#"+scope.module_id.doctor).fadeIn()},scope.selectDoctor=function(row){scope.selectedDoctor=row,scope.params.permission.edit===!0?angular.element("#"+scope.module_id_edit.doctor).fadeOut():angular.element("#"+scope.module_id.doctor).fadeOut()},scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtoutreferralForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtoutreferralMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));postData.referred_to_doctor=scope.selectedReferredDoctor.doctor_id,postData.doctor_id=scope.selectedDoctor.doctor_id,postData.last_update_date=ConfigService.getCommonDatetime(new Date),scope.params.permission.edit===!0?mdtoutreferralService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),scope.itemUpdate=!0,toastr.success("Edit Successfully !!!","Success")}):(postData.creation_date=ConfigService.getCommonDatetime(new Date),mdtoutreferralService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init(),scope.itemUpdate=!0}))}}}}}),angular.module("app.loggedIn.mdtoutreferral.search.directive",[]).directive("mdtoutreferralSearch",function(mdtoutreferralService,toastr,ConfigService){
return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtoutreferral/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"date_issued",value:""},{type:"text",name:"date_started",value:""},{type:"text",name:"duration",value:""}],select:["id","date_issued","date_started","expire_date","duration"]}},loadList=function(){mdtoutreferralService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response;for(var i=0;i<scope.list.data.length;i++)scope.list.data[i].date_issued_map=ConfigService.getCommonDateDefault(scope.list.data[i].date_issued),scope.list.data[i].expire_date_map=ConfigService.getCommonDateDefault(scope.list.data[i].expire_date)})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtprovider",["app.loggedIn.mdtprovider.directives","app.loggedIn.mdtprovider.services"]),angular.module("app.loggedIn.mdtprovider.services",[]).factory("mdtProviderService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtprovider/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtprovider.directives",["app.loggedIn.mdtprovider.detail.directive","app.loggedIn.mdtprovider.search.directive"]),angular.module("app.loggedIn.mdtprovider.detail.directive",[]).directive("mdtproviderDetail",function(mdtProviderModel,ConfigService,mdtProviderService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtprovider/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtProviderService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtProviderMap,response.data);for(var key in scope.mdtProviderMap)scope.mdtProviderMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtProviderMap[key]=scope.mdtProviderMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtProviderMap[key]=new Date(scope.mdtProviderMap[key])))}),scope.mdtProviderMap=angular.copy(mdtProviderModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtproviderForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtProviderMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtProviderService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtProviderService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtprovider.search.directive",[]).directive("mdtproviderSearch",function(mdtProviderService,toastr){return{restrict:"EA",scope:{clickRow:"="},templateUrl:"modules/mdtprovider/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Provider_types_name",value:""},{type:"text",name:"Isenable",value:""},{type:"text",name:"Created_by",value:""}],select:["Provider_types_name","Isenable","Created_by"]}},loadList=function(){mdtProviderService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtrecall",["app.loggedIn.mdtrecall.directives","app.loggedIn.mdtrecall.services"]),angular.module("app.loggedIn.mdtrecall.services",[]).factory("mdtRecallService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtrecall/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtrecall.directives",["app.loggedIn.mdtrecall.detail.directive","app.loggedIn.mdtrecall.search.directive"]),angular.module("app.loggedIn.mdtrecall.detail.directive",[]).directive("mdtrecallDetail",function(mdtRecallModel,ConfigService,mdtRecallService,toastr){return{restrict:"EA",scope:{options:"=",params:"=",onsuccess:"=",actionCenter:"="},templateUrl:"modules/mdtrecall/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.mdtRecallMap=angular.copy(mdtRecallModel),scope.isSubmit=!1,scope.params.permission.edit===!0?mdtRecallService.byId(scope.params.id).then(function(response){if("error"==response.status)return void toastr.error("Error Get Detail","Error");angular.extend(scope.mdtRecallMap,response.data);for(var key in scope.mdtRecallMap)scope.mdtRecallMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtRecallMap[key]=scope.mdtRecallMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtRecallMap[key]=new Date(scope.mdtRecallMap[key])))}):(scope.mdtRecallMap.transaction_date=new Date,scope.mdtRecallMap.patient_id=scope.params.patient_id,scope.mdtRecallMap.created_by=scope.params.created_by)};init(),scope.setRecallDate=function(){scope.mdtRecallMap.recall_period&&(scope.recall_date_temp=moment(scope.mdtRecallMap.transaction_date).add(scope.mdtRecallMap.recall_period,"months"),scope.mdtRecallMap.recall_date=new Date(scope.recall_date_temp))},scope.actionCenter.updateRecall=function(){mdtRecallService.byId(scope.params.id).then(function(response){if("error"==response.status)return void toastr.error("Error Get Detail","Error");angular.extend(scope.mdtRecallMap,response.data);for(var key in scope.mdtRecallMap)scope.mdtRecallMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtRecallMap[key]=scope.mdtRecallMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtRecallMap[key]=new Date(scope.mdtRecallMap[key])))})},console.log(scope.onsuccess),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtrecallForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtRecallMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtRecallService.edit(scope.params.id,postData).then(function(response){return"error"==response.status?void toastr.error("Error Get Detail","Error"):(scope.onsuccess&&scope.onsuccess(),void toastr.success("Update Successfully !!!","Success"))}):(mdtRecallService.add(postData).then(function(response){return"error"==response.status?void toastr.error("Error Get Detail","Error"):(scope.onsuccess&&scope.onsuccess(),void toastr.success("Insert Successfully !!!","Success"))}),init())}}}}}),angular.module("app.loggedIn.mdtrecall.search.directive",[]).directive("mdtrecallSearch",function(mdtRecallService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtrecall/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"patient_id",value:""},{type:"text",name:"notes",value:""},{type:"text",name:"transaction_date",value:""}],select:["patient_id","notes","transaction_date"]}},loadList=function(){mdtRecallService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtredimedsites",["app.loggedIn.mdtredimedsites.directives","app.loggedIn.mdtredimedsites.services"]),angular.module("app.loggedIn.mdtredimedsites.services",[]).factory("mdtRedimedsitesService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtredimedsites/");return mdtService.list=function(){var funcApi=mdtApi.one("list");return funcApi.get()},mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.mdtredimedsites.directives",["app.loggedIn.mdtredimedsites.detail.directive","app.loggedIn.mdtredimedsites.search.directive"]),angular.module("app.loggedIn.mdtredimedsites.detail.directive",[]).directive("mdtredimedsitesDetail",function(mdtRedimedsitesModel,ConfigService,mdtRedimedsitesService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtredimedsites/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtRedimedsitesService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtRedimedsitesMap,response.data);for(var key in scope.mdtRedimedsitesMap)scope.mdtRedimedsitesMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtRedimedsitesMap[key]=scope.mdtRedimedsitesMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtRedimedsitesMap[key]=new Date(scope.mdtRedimedsitesMap[key])))}),scope.mdtRedimedsitesMap=angular.copy(mdtRedimedsitesModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtredimedsitesForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtRedimedsitesMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtRedimedsitesService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtRedimedsitesService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtredimedsites.search.directive",[]).directive("mdtredimedsitesSearch",function(mdtRedimedsitesService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtredimedsites/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Site_name",value:""},{type:"text",name:"Site_addr",value:""},{type:"text",name:"postcode",value:""}],select:["Site_name","Site_addr","postcode"]}},loadList=function(){mdtRedimedsitesService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtspecialty",["app.loggedIn.mdtspecialty.directives","app.loggedIn.mdtspecialty.services"]),angular.module("app.loggedIn.mdtspecialty.services",[]).factory("mdtSpecialtyService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdtspecialty/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService.loadWithoutDoctor=function(data){var funcApi=mdtApi.all("loadWithoutDoctor");return funcApi.post({data:data})},mdtService.selectServiceDoctor=function(data){var funcApi=mdtApi.all("selectServiceDoctor");return funcApi.post({data:data})},mdtService.listByServiceDoctor=function(data){var funcApi=mdtApi.all("listByServiceDoctor");return funcApi.post({data:data})},mdtService.active=function(data){var funcApi=mdtApi.all("active");return funcApi.post({data:data})},mdtService.removeServiceDoctor=function(data){var funcApi=mdtApi.all("removeServiceDoctor");return funcApi.post({data:data})},mdtService}),angular.module("app.loggedIn.mdtspecialty.directives",["app.loggedIn.mdtspecialty.detail.directive","app.loggedIn.mdtspecialty.search.directive","app.loggedIn.mdtspecialty.search_by_doctor.directive","app.loggedIn.mdtspecialty.listByDoctor.dialog"]),angular.module("app.loggedIn.mdtspecialty.detail.directive",[]).directive("mdtspecialtyDetail",function(mdtSpecialtyModel,ConfigService,mdtSpecialtyService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/mdtspecialty/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&mdtSpecialtyService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.mdtSpecialtyMap,response.data);for(var key in scope.mdtSpecialtyMap)scope.mdtSpecialtyMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.mdtSpecialtyMap[key]=scope.mdtSpecialtyMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.mdtSpecialtyMap[key]=new Date(scope.mdtSpecialtyMap[key])))}),scope.mdtSpecialtyMap=angular.copy(mdtSpecialtyModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.mdtspecialtyForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.mdtSpecialtyMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?mdtSpecialtyService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(mdtSpecialtyService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.mdtspecialty.search.directive",[]).directive("mdtspecialtySearch",function(mdtSpecialtyService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/mdtspecialty/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Specialties_name",value:""},{type:"text",name:"Isenable",value:""},{type:"text",name:"Created_by",value:""}],select:["Specialties_name","Isenable","Created_by"]}},loadList=function(){mdtSpecialtyService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.mdtspecialty.search_by_doctor.directive",[]).directive("mdtspecialtySearchbydoctor",function(mdtDoctorService,toastr){return{restrict:"EA",scope:{clickRow:"&",options:"=",doctor:"=",count:"="},templateUrl:"modules/mdtspecialty/directives/templates/searchByDoctor.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Specialties_name",value:""},{type:"select",name:"RL_TYPE_ID",value:""},{type:"text",name:"cln_specialties.Isenable",value:1}],doctor_id:0}};scope.$watch("doctor",function(newDoctor){"undefined"!=typeof newDoctor.doctor_id&&(init(),scope.params.doctor_id=newDoctor.doctor_id,loadList())});var loadList=function(){mdtDoctorService.specialities(scope.params).then(function(response){scope.list=response,scope.count=response.count},function(error){console.log(error)})};scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()},scope.refresh=function(){loadList()}}}}),angular.module("app.loggedIn.mdtspecialty.listByDoctor.dialog",[]).directive("mdtspecialtyListbydoctor",function($modal,mdtSpecialtyService,toastr){return{restrict:"EA",scope:{limit:"=",reload:"=",doctorId:"=",onRowClick:"&"},templateUrl:"modules/mdtspecialty/dialogs/templates/listDoctor.html",link:function(scope,elem,attrs){var search={page:1,limit:scope.limit,offset:0,max_size:5,Specialties_name:"",Creation_date:"desc",doctor_id:scope.doctorId},load=function(){var postData=angular.copy(scope.speciality.search);mdtSpecialtyService.loadWithoutDoctor(postData).then(function(response){scope.speciality.list=response.data,scope.speciality.count=response.count})},onSearch=function(){scope.speciality.search.offset=0,scope.speciality.load(),scope.speciality.search.page=1},onOrderBy=function(option){switch(option.field){case"Creation_date":scope.speciality.search.Creation_date=option.order}scope.speciality.load()},remove=function(list){$modal.open({templateUrl:"dialogAlertRemove",controller:"AlertRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){AlertModel.remove(list).then(function(response){toastr.success("Delete Successfully"),scope.speciality.load()},function(error){})})},edit=function(list){$modal.open({templateUrl:"dialogAlertEdit",controller:"AlertEditDialog",size:"lg",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.speciality.load())})},onPage=function(page){scope.speciality.search.offset=(page-1)*scope.speciality.search.limit,scope.speciality.load()};scope.speciality={dialog:{remove:function(list){remove(list)},edit:function(list){edit(list)}},search:angular.copy(search),load:function(){load()},list:[],onSearch:function(){onSearch()},onOrderBy:function(option){onOrderBy(option)},onPage:function(page){onPage(page)}},scope.speciality.load(),scope.$watch("reload",function(reload){reload&&(scope.speciality.search=angular.copy(search),scope.speciality.load())})}}}),angular.module("app.loggedIn.timetable_old",["app.loggedIn.timetable.directives","app.loggedIn.timetable.services"]),angular.module("app.loggedIn.timetable.services",[]).factory("mdtTimetableService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/mdttimetable/");return mdtService.byDoctor=function(doctor_id){var funcApi=mdtApi.all("byDoctor");return funcApi.post({doctor_id:doctor_id})},mdtService.showWeek=function(doctor_id,cal_header_df_id){var funcApi=mdtApi.all("showWeek");return funcApi.post({doctor_id:doctor_id,cal_header_df_id:cal_header_df_id})},mdtService.addSite=function(doctor_id,cal_header_df_id,content){var funcApi=mdtApi.all("addSite");return funcApi.post({doctor_id:doctor_id,cal_header_df_id:cal_header_df_id,content:content})},mdtService.add=function(timetable,doctor_id){var funcApi=mdtApi.all("add");return funcApi.post({timetable:timetable,doctor_id:doctor_id})},mdtService.addRow=function(data){var funcApi=mdtApi.all("addRow");return funcApi.post(data)},mdtService.generate=function(doctor_id,interval,clinical_id){var funcApi=mdtApi.all("generate");return funcApi.post({doctor_id:doctor_id,interval:interval,clinical_id:clinical_id})},mdtService.remove=function(cal_id){var funcApi=mdtApi.all("remove");return funcApi.post({cal_id:cal_id})},mdtService.timetableRemove=function(cal_header_df_id){var funcApi=mdtApi.all("timetableRemove");return funcApi.post({cal_header_df_id:cal_header_df_id})},mdtService}),angular.module("app.loggedIn.timetable.directives",["app.loggedIn.timetable.main.directive"]),angular.module("app.loggedIn.timetable.main.directive",[]).directive("timetableGenerate",function(mdtTimetableService,mdtDoctorService,sysServiceService,mdtRedimedsitesService,ConfigService,toastr,$timeout){return{restrict:"EA",scope:{options:"=",doctorId:"="},templateUrl:"modules/mdttimetable/directives/templates/timetable.html",link:function(scope,element,attrs){scope.selectedDoctor={},scope.removeTimetable=function(data){mdtTimetableService.timetableRemove(data.cal_header_df_id).then(function(data){toastr.success("Remove Successfully"),init()})},mdtDoctorService.byId(scope.doctorId).then(function(response){scope.selectedDoctor=response.data,sysServiceService.byClinicalDepartment(response.data.CLINICAL_DEPT_ID).then(function(response){scope.options.clinical_depts=response.data})});var init=function(){scope.timetable_list=[],scope.selectedCalHeader=[],scope.selectedCalHeaderId=0,mdtTimetableService.byDoctor(scope.doctorId).then(function(response){for(var i=0;i<scope.options.timetable_dow.length;i++){scope.timetable_list.push({dow:scope.options.timetable_dow[i].code,data:[]}),"undefined"!=typeof response.data[i]&&(scope.timetable_list[i].doctor_id=response.data[i].doctor_id);for(var j=0;j<response.data.length;j++)response.data[j].day_of_Week===scope.options.timetable_dow[i].code&&(scope.timetable_list[i].data.push(response.data[j]),scope.timetable_list[i].cal_header_df_id=response.data[j].cal_header_df_id)}for(var i=0;i<scope.timetable_list.length;i++)if(0==scope.timetable_list[i].data.length)scope.timetable_list[i].data.push({from_time_display:"00:00",to_time_display:"00:00",isexists:!1});else for(var j=0;j<scope.timetable_list[i].data.length;j++)scope.timetable_list[i].data[j].from_time_display=ConfigService.convertToTimeString(scope.timetable_list[i].data[j].from_time),scope.timetable_list[i].data[j].to_time_display=ConfigService.convertToTimeString(scope.timetable_list[i].data[j].to_time),scope.timetable_list[i].data[j].isexists=!0})};init(),scope.clickInput=function(option){"add"===option.type?scope.timetable_list[option.pindex].data.push({from_time_display:"00:00",to_time_display:"00:00",isexists:!1}):"remove"===option.type&&scope.timetable_list[option.pindex].data.splice(option.index,1)},scope.clickInputCalHeader=function(option){"add"===option.type?scope.selectedCalHeader.push({week_ord_of_month:"2",site_id:"0",isexists:!1}):"remove"===option.type&&scope.selectedCalHeader.splice(option.index,1)},scope.saveCalHeader=function(){mdtTimetableService.addSite(scope.doctorId,scope.selectedCalHeaderId,scope.selectedCalHeader).then(function(response){toastr.success("Saving State Successful"),init()})},scope.saveTimetable=function(option){mdtTimetableService.add(scope.timetable_list[option.pindex],scope.doctorId).then(function(response){toastr.success("Saving Timetable Successful"),init()})},scope.saveNewTimetable=function(data,pindex){data.dow=scope.timetable_list[pindex].dow,mdtTimetableService.add(data,scope.doctorId).then(function(response){toastr.success("Saving Timetable Successful"),init()})},scope.showState=function(data){data.cal_header_df_id?(scope.selectedCalHeaderId=data.cal_header_df_id,scope.selectedCalHeader=[],mdtTimetableService.showWeek(scope.doctorId,data.cal_header_df_id).then(function(response){if(response.data.length>0){scope.selectedCalHeader=response.data;for(var i=0;i<scope.selectedCalHeader.length;i++)scope.selectedCalHeader[i].isexists=!0}else scope.selectedCalHeader.push({week_ord_of_month:0,site_id:0,isexists:!1})})):(scope.selectedCalHeader=[],scope.selectedCalHeader.push({week_ord_of_month:0,site_id:0,isexists:!1}))},scope.generate=function(){mdtTimetableService.generate(scope.selectedDoctor.doctor_id,scope.selectedDoctor.Appt_interval,scope.selectedDoctor.CLINICAL_DEPT_ID).then(function(response){toastr.success("Generate Timetable Successfully")})}}}}),angular.module("app.loggedIn.medicine",["app.loggedIn.medicine.controller","app.loggedIn.medicine.service","app.loggedIn.medicine.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.medicine",{url:"/medicine","abstract":!0,templateUrl:"modules/medicine/views/structure.html",controller:"MedicineController"}).state("loggedIn.medicine.list",{url:"/list",views:{"main-content":{templateUrl:"modules/medicine/views/list.html",controller:"MedicineListController"}}})}),angular.module("app.loggedIn.medicine.controller",["app.loggedIn.medicine.list.controller"]).controller("MedicineController",function(){}),angular.module("app.loggedIn.medicine.list.controller",[]).controller("MedicineListController",function($scope){$scope.medicine_panel={},$scope.medicine={select:0,scope:$scope.patient_panel,options:{api:"api/erm/v2/medicine/search",method:"post",scope:$scope.medicine_panel,columns:[{field:"medicine_id",is_hide:!0},{field:"medicine_name",label:"Medicine Name"},{field:"medicine_price",label:"Price per unit"}],use_filters:!0,filters:{medicine_name:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.medicine.id=item.medicine_id,$scope.medicineEditForm.open()}}]}},$scope.medicineAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.medicine_panel.reload(),$scope.medicineAddForm.close()}},$scope.medicineEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.medicine_panel.reload(),$scope.medicineEditForm.close()}}}),angular.module("app.loggedIn.medicine.service",[]).factory("MedicineService",function(Restangular,ConfigService,$state){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insert=function(postData){var detailApi=v2_api.all("medicine/insert");return detailApi.post(postData)},instanceService.detail=function(postData){var detailApi=v2_api.all("medicine/detail");return detailApi.post({ID:postData})},instanceService.update=function(postData){var detailApi=v2_api.all("medicine/update");return detailApi.post(postData)},instanceService}),angular.module("app.loggedIn.medicine.directive",["app.loggedIn.medicine.detail.directive"]),angular.module("app.loggedIn.medicine.detail.directive",[]).directive("medicineDetail",function(MedicineModel,MedicineService,ConfigService,toastr){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/medicine/directives/templates/detail.html",link:function(scope,element,attrs){scope.medicine_unit_options=ConfigService.medicine_unit_option();var loadData=function(id){MedicineService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(MedicineModel),scope.mode={type:"add",text:"Add medicine"},scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit referral"})}var addProcess=function(postData){MedicineService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Medicine added","Success"),scope.modelObjectMap=angular.copy(MedicineModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){MedicineService.update(postData).then(function(response){"success"===response.status&&(toastr.success("Edit referral Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.menu",["app.loggedIn.menu.controller","app.loggedIn.menu.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.menu",{url:"/menus",templateUrl:"modules/menu/views/menu.html",controller:"MenuController"})}),angular.module("app.loggedIn.menu.services",[]).factory("MenuService",function(Restangular){var menuService={},api=Restangular.all("api");return menuService.menuRootList=function(){var menuList=api.one("menu/list/root");return menuList.get()},menuService.menuList=function(id){var list=api.all("menu/list/id");return list.post({id:id})},menuService.functionList=function(){var functionList=api.one("function/list");return functionList.get()},menuService.insertMenu=function(info){var insert=api.all("menu/new");return insert.post({info:info})},menuService.editMenu=function(info){var edit=api.all("menu/edit");return edit.post({info:info})},menuService.menuInfo=function(id){var info=api.all("menu/id");return info.post({id:id})},menuService.deleteRootMenu=function(id){var a=api.all("menu/delete");return a.post({id:id,isRoot:!0})},menuService.deleteMenu=function(id){var a=api.all("menu/delete");return a.post({id:id,isRoot:!1})},menuService}),angular.module("app.loggedIn.menu.controller",[]).controller("MenuController",function($scope,$modal,$state,$filter,ngTableParams,MenuService,$http,toastr){$scope.functionList=[],$scope.data=[],$scope.data1=[],$scope.isSelected=!1,$scope.selectedId=null,$scope.tableParams2=new ngTableParams({page:1,count:25},{total:$scope.data1.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.data1,params.orderBy()):$scope.data1;orderedData=params.filter()?$filter("filter")(orderedData,params.filter()):orderedData,params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),MenuService.menuRootList().then(function(data){MenuService.functionList().then(function(data){$scope.functionList=data}),$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.data,params.orderBy()):$scope.data;orderedData=params.filter()?$filter("filter")(orderedData,params.filter()):orderedData,params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()));

}})}),$scope.showChild=function(m){$scope.childTitle=m.description,$scope.selectedId=m.menu_id,$scope.isSelected=!0,$scope.data1=[],MenuService.menuList(m.menu_id).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})},$scope.addNewMenu=function(){var modalInstance=$modal.open({templateUrl:"modules/menu/views/menuDetails.html",controller:"NewMenuController",size:"md",resolve:{isSub:function(){return!1},parentId:function(){return null}}});$scope.data=[],modalInstance.result.then(function(){MenuService.menuRootList().then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})},$scope.editMenu=function(m){$scope.showChild(m);var modalInstance=$modal.open({templateUrl:"modules/menu/views/menuDetails.html",controller:"EditMenuController",size:"md",resolve:{menuId:function(){return m.menu_id},isSub:function(){return!1}}});$scope.data=[],modalInstance.result.then(function(){MenuService.menuRootList().then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})},$scope.deleteRootMenu=function(m){MenuService.deleteRootMenu(m.menu_id).then(function(data){"success"===data.status?(toastr.success("Delete Menu Successfully!","Success"),$scope.data=[],MenuService.menuRootList().then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.tableParams.reload()})}),$scope.selectedId=null):toastr.error("Delete Menu Failed!","Error")})},$scope.deleteSubMenu=function(m){MenuService.deleteMenu(m.menu_id).then(function(data){"success"===data.status?(toastr.success("Delete Menu Successfully!","Success"),$scope.data1=[],MenuService.menuList($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})):toastr.error("Delete Menu Failed!","Error")})},$scope.addNewSubMenu=function(){var modalInstance=$modal.open({templateUrl:"modules/menu/views/menuDetails.html",controller:"NewMenuController",size:"md",resolve:{isSub:function(){return!0},parentId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){$scope.data1=[],MenuService.menuList($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})})},$scope.editSubMenu=function(m){var modalInstance=$modal.open({templateUrl:"modules/menu/views/menuDetails.html",controller:"EditMenuController",size:"md",resolve:{menuId:function(){return m.menu_id},isSub:function(){return!0}}});modalInstance.result.then(function(){$scope.data1=[],MenuService.menuList($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})})}}).controller("NewMenuController",function($scope,$filter,$state,$modalInstance,MenuService,isSub,parentId,toastr){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.info={MenuDescription:null,MenuDefinition:null,MenuType:null,MenuEnable:"1",MenuWeb:"1",MenuMobile:null,FunctionID:null,ParentID:parentId},$scope.isSub=isSub,1==$scope.isSub&&MenuService.functionList().then(function(data){$scope.functionList=data}),$scope.submitMenu=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):MenuService.insertMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Insert New Menu Successfully!","Success"),$modalInstance.close()):toastr.error("Insert New Menu Failed!","Error")})}}).controller("EditMenuController",function($scope,$filter,$state,$modalInstance,MenuService,isSub,menuId,toastr){$scope.cancel=function(){$modalInstance.dismiss("cancel")},console.log(menuId),$scope.isSub=isSub,1==$scope.isSub&&MenuService.functionList().then(function(data){$scope.functionList=data}),$scope.info={MenuID:null,MenuDescription:null,MenuDefinition:null,MenuEnable:null,MenuWeb:null,MenuMobile:null,MenuType:null,FunctionID:null},MenuService.menuInfo(menuId).then(function(data){$scope.info.MenuID=data.menu_id,$scope.info.MenuDescription=data.description,$scope.info.MenuDefinition=data.definition,$scope.info.MenuEnable=1==data.isEnable?"1":"0",$scope.info.MenuWeb=1==data.isWeb?"1":"0",$scope.info.MenuMobile=1==data.isMobile?"1":"0",$scope.info.MenuType=data.type,$scope.info.FunctionID=null!=data.function_id||""!=data.function_id?data.function_id:null}),$scope.submitMenu=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):MenuService.editMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Edit Menu Successfully!","Success"),$modalInstance.close()):toastr.error("Edit Menu Failed!","Error")})}}),angular.module("app.loggedIn.booking",["app.loggedIn.booking.make.controller","app.loggedIn.booking.list.controller","app.loggedIn.booking.package.controller","app.loggedIn.booking.position.controller","app.loggedIn.booking.setting.controller","app.loggedIn.booking.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.makeBooking",{url:"/onlineBooking/make",templateUrl:"modules/onlineBooking/views/makeBooking.html",controller:"MakeBookingController"}).state("loggedIn.bookingList",{url:"/onlineBooking/booking",templateUrl:"modules/onlineBooking/views/booking.html",controller:"BookingListController"}).state("loggedIn.package",{url:"/onlineBooking/package",templateUrl:"modules/onlineBooking/views/package.html",controller:"PackageController"}).state("loggedIn.position",{url:"/onlineBooking/position",templateUrl:"modules/onlineBooking/views/position.html",controller:"PositionController"}).state("loggedIn.setting",{url:"/onlineBooking/setting",templateUrl:"modules/onlineBooking/views/settings.html",controller:"SettingController"}).state("loggedIn.newUser",{url:"/onlineBooking/setting/newUser",templateUrl:"modules/onlineBooking/views/newUser.html",controller:"NewUserController"}).state("loggedIn.editUser",{url:"/onlineBooking/setting/editUser/:id",templateUrl:"modules/onlineBooking/views/newUser.html",controller:"EditUserController"})}),angular.module("app.loggedIn.booking.make.controller",[]).controller("MakeBookingController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingService,$http,toastr,$cookieStore,$timeout){var companyInfo,userInfo;"undefined"!=typeof $cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),"undefined"!=typeof $cookieStore.get("userInfo")&&(userInfo=$cookieStore.get("userInfo")),$scope.companyName=null===companyInfo.Company_name?"":companyInfo.Company_name,$scope.companyList=[],$scope.packageList=[],$scope.data=[];var mPO,mResult,mInvoice,mIsProject;$scope.c={SubCompanyId:"",PO_number:"",result_email:"",invoice_email:"",Project:"",Comment:"",PackId:"",isProject:null==companyInfo.isProject?0:companyInfo.isProject},OnlineBookingService.deleteAllPending(),$scope.c=companyInfo,mPO=companyInfo.PO_number,mResult=companyInfo.result_email,mInvoice=companyInfo.invoice_email,mIsProject=companyInfo.isProject,null!=$scope.data&&($scope.tableParams=new ngTableParams({page:1,count:20},{counts:[],total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})),OnlineBookingService.getSubCompany(companyInfo.id).then(function(response){"success"===response.status&&($scope.companyList=response.rs)}),OnlineBookingService.getPackage(companyInfo.id).then(function(data){"success"===data.status&&($scope.packageList=data.rs,$scope.packageList.push({PackId:-1,package_name:"Custom Package"}))});var arrCustomAss=[],period=null;$scope.packageChange=function(PackId){var arrAss=[];if(null!==PackId)if(-1==PackId){$scope.packAss=[];var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/customPackage.html",controller:"CustomPackageController",size:"md"});modalInstance.result.then(function(data){for(var i=0;i<data.length;i++)arrAss.push({head_name:null==data[i].HeaderName||""==data[i].HeaderName?"":data[i].HeaderName,ass_name:data[i].ass_name}),arrCustomAss.push({ass_id:data[i].ass_id,ass_name:data[i].ass_name});$scope.packAss=_.groupBy(arrAss,"head_name"),$scope.newCandidate()},function(err){console.log(err)})}else{arrCustomAss=[],OnlineBookingService.getPackageAssById(PackId).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:null==data.rs[i].HeaderName||""==data.rs[i].HeaderName?"":data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.packAss=_.groupBy(arrAss,"head_name")}});for(var i=0;i<$scope.packageList.length;i++)PackId===$scope.packageList[i].PackId&&(period=$scope.packageList[i].period);$scope.newCandidate()}else $scope.packAss=[]},$scope.subChange=function(subId){null!==subId&&OnlineBookingService.getSubCompanyInfo(subId).then(function(data){$scope.c.SubCompanyId=data.id,$scope.c.PO_number=data.PO_number,$scope.c.result_email=data.result_email,$scope.c.invoice_email=data.invoice_email,$scope.c.isProject=null==data.isProject?0:data.isProject}),null===subId&&($scope.c.PO_number=mPO,$scope.c.result_email=mResult,$scope.c.invoice_email=mInvoice,$scope.c.isProject=mIsProject)},$scope.newCandidate=function(){if(null==$scope.c.PackId)toastr.error("Please Choose A Package First!","Error");else{var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/newCandidate.html",controller:"NewCandidateController",size:"md",resolve:{companyId:function(){return companyInfo.id},editInfo:function(){return null},period:function(){return period},status:function(){return null==companyInfo.default_status||""==companyInfo.default_status?"Pending":companyInfo.default_status}}});modalInstance.result.then(function(candidateInfo){$scope.data.push(candidateInfo),$scope.tableParams.reload()},function(err){console.log(err)})}},$scope.editCandidate=function(b){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/newCandidate.html",controller:"NewCandidateController",size:"md",resolve:{companyId:function(){return companyInfo.id},editInfo:function(){return b},period:function(){return period},status:function(){return null==companyInfo.default_status||""==companyInfo.default_status?"Pending":companyInfo.default_status}}});modalInstance.result.then(function(candidateInfo){var index=$scope.data.indexOf(b);$scope.data[index]=candidateInfo,$scope.tableParams.reload()},function(err){console.log(err)})},$scope.deleteCandidate=function(b){OnlineBookingService.deletePending(b).then(function(data){if("success"==data.status){var index=$scope.data.indexOf(b);index>-1&&$scope.data.splice(index,1),$scope.tableParams.reload()}else toastr.error("Delete Failed!","Error")})},$scope.submitBooking=function(bookingForm){$scope.headInfo={PO_number:$scope.c.PO_number,result_email:$scope.c.result_email,invoice_email:$scope.c.invoice_email,ProjectIdentification:$scope.c.Project,Comment:$scope.c.Comment,PackageId:$scope.c.PackId,CompanyId:null==companyInfo.father_id?companyInfo.id:companyInfo.father_id,Booking_Person:userInfo.Booking_Person,contact_number:userInfo.Contact_number,subCompany_Id:null==$scope.c.SubCompanyId?null:$scope.c.SubCompanyId,contact_email:userInfo.Contact_email,arrCustomAss:arrCustomAss.length<=0?null:arrCustomAss},$scope.showClickedValidation=!0,bookingForm.$invalid?toastr.error("Please Input All Required Information!","Error"):$scope.data.length<=0?toastr.error("Please Add Some Candidate For Booking!","Error"):OnlineBookingService.submitBook($scope.data,$scope.headInfo).then(function(data){"success"===data.status?(toastr.success("Submit Booking Successfully!","Success"),$state.go("loggedIn.makeBooking",null,{reload:!0})):"error"===data.status&&toastr.error("Submit Booking Failed!","Error")})}}).controller("CustomPackageController",function($scope,$state,$modalInstance,OnlineBookingService,OnlineBookingAdminService,toastr){$scope.info={checkedAss:[]},OnlineBookingAdminService.getAssessment().then(function(data){$scope.assList=data}),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(){OnlineBookingService.customPackage($scope.info.checkedAss).then(function(data){$modalInstance.close(data)})}}).controller("NewCandidateController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,companyId,editInfo,period,status,toastr){if($scope.info={siteId:null,fromDate:null,toDate:null,calId:null,candidateName:null,dob:null,position:null,phone:null,email:null,stateId:null,suburbId:null,stateName:null,suburbName:null},$scope.siteList=[],$scope.calList=[],$scope.positionList=[],$scope.cancel=function(){$modalInstance.dismiss("cancel")},null!==editInfo&&($scope.info=editInfo,console.log($scope.info),null!=$scope.info.stateId&&OnlineBookingService.getSiteState($scope.info.siteId).then(function(data){$scope.stateList=data}),null!=$scope.info.suburbId&&OnlineBookingService.getStateSuburb($scope.info.stateId).then(function(data){$scope.suburbList=data})),"undefined"!=typeof $scope.info.siteId&&null!==$scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}OnlineBookingService.getSite().then(function(data){$scope.siteList=data}),OnlineBookingService.getPositionList(companyId).then(function(data){$scope.positionList=data}),$scope.minDate=new Date,$scope.maxDate=new Date,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.haveState=!1,$scope.haveSuburb=!1,$scope.siteChange=function(){if("undefined"!=typeof $scope.info.siteId&&null!==$scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){$scope.info.stateId=null,$scope.info.suburbId=null;var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getSiteState(id).then(function(data){null!=data&&data.length>0?($scope.calList=[],$scope.info.appointmentTime="",$scope.haveState=!0,$scope.stateList=data):($scope.haveState=!1,$scope.haveSuburb=!1,OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data}))})}else $scope.info.stateId=null,$scope.info.suburbId=null,$scope.haveState=!1,$scope.haveSuburb=!1,$scope.calList=[],$scope.info.appointmentTime=""},$scope.siteStateChange=function(id){null!=id?($scope.info.suburbId=null,$scope.suburbList=[],OnlineBookingService.getStateSuburb(id).then(function(data){null!=data&&data.length>0&&($scope.haveSuburb=!0,$scope.suburbList=data)})):($scope.info.suburbId=null,$scope.haveSuburb=!1)},$scope.fromDateChange=function(){if("undefined"!=typeof $scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}else $scope.calList=[],$scope.info.appointmentTime=""},$scope.toDateChange=function(){if("undefined"!=typeof $scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}else $scope.calList=[],$scope.info.appointmentTime=""},$scope.submitCandidate=function(candidateForm){if($scope.showClickedValidation=!0,candidateForm.$invalid)toastr.error("Please Input All Required Information!","Error");else{if($scope.candidateInfo={siteId:"",fromDate:"",toDate:"",calId:"",candidateName:"",dob:"",position:"",phone:"",email:"",siteName:"",submitDate:"",displayDate:"",stateId:"",suburbId:"",stateName:"",suburbName:"",calId2:null,calId3:null,calId4:null,calId5:null,status:status,candidateId:null},$scope.candidateInfo.candidateName=$scope.info.candidateName,$scope.candidateInfo.dob=$filter("date")($scope.info.dob,"yyyy-MM-dd"),$scope.candidateInfo.position=$scope.info.position,$scope.candidateInfo.phone=$scope.info.phone,$scope.candidateInfo.email=$scope.info.email,$scope.candidateInfo.siteId=$scope.info.siteId,$scope.candidateInfo.fromDate=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),$scope.candidateInfo.toDate=$filter("date")($scope.info.toDate,"yyyy-MM-dd"),$scope.candidateInfo.calId=$scope.info.calId,$scope.candidateInfo.stateId=$scope.info.stateId,$scope.candidateInfo.suburbId=$scope.info.suburbId,"undefined"!=typeof $scope.stateList||null!=$scope.stateList)for(var i=0;i<$scope.stateList.length;i++)$scope.info.stateId==$scope.stateList[i].state_id&&($scope.candidateInfo.stateName=$scope.stateList[i].state_name);if("undefined"!=typeof $scope.suburbList||null!=$scope.suburbList)for(var i=0;i<$scope.suburbList.length;i++)$scope.info.suburbId==$scope.suburbList[i].suburb_id&&($scope.candidateInfo.suburbName=$scope.suburbList[i].suburb_name);if($scope.candidateInfo.stateId=$scope.info.stateId,$scope.candidateInfo.suburbId=$scope.info.suburbId,"undefined"!=typeof $scope.stateList||null!=$scope.stateList)for(var i=0;i<$scope.stateList.length;i++)$scope.info.stateId==$scope.stateList[i].state_id&&($scope.candidateInfo.stateName=$scope.stateList[i].state_name);if("undefined"!=typeof $scope.suburbList||null!=$scope.suburbList)for(var i=0;i<$scope.suburbList.length;i++)$scope.info.suburbId==$scope.suburbList[i].suburb_id&&($scope.candidateInfo.suburbName=$scope.suburbList[i].suburb_name);null!==$scope.info.calId&&OnlineBookingService.getAppointmentTime($scope.info.calId).then(function(data){var submitDate=$filter("date")(data[0].From_time,"yyyy-MM-dd HH:mm:ss"),displayDate=$filter("date")(data[0].From_time,"dd/MM/yyyy HH:mm:ss");$scope.candidateInfo.submitDate=submitDate,$scope.candidateInfo.displayDate=displayDate});for(var i=0;i<$scope.siteList.length;i++)$scope.info.siteId===$scope.siteList[i].id&&($scope.candidateInfo.siteName=$scope.siteList[i].Site_name);for(var i=0;i<$scope.calList.length;i++)$scope.candidateInfo.calId==$scope.calList[i].cal_id&&(2==period?$scope.candidateInfo.calId2=$scope.calList[i+1].cal_id:3==period&&($scope.candidateInfo.calId2=$scope.calList[i+1].cal_id,$scope.candidateInfo.calId3=$scope.calList[i+2].cal_id));OnlineBookingService.pendingCalendar($scope.candidateInfo).then(function(data){"success"==data.status?($scope.candidateInfo.candidateId=data.newCanId,$modalInstance.close($scope.candidateInfo)):toastr.error("Submit Error!","Error")})}}}),angular.module("app.loggedIn.booking.list.controller",[]).controller("BookingListController",function($scope,$modal,$filter,ngTableParams,OnlineBookingService,$http,toastr,$cookieStore){var companyInfo;$scope.selectedCanId=null,$scope.selectedBookId=null,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.cId=null,$scope.isExtra=0,"undefined"!==$cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo"),$scope.cId=companyInfo.id,$scope.isExtra=1==companyInfo.isExtra?1:0),OnlineBookingService.getBookingList(companyInfo.id).then(function(data){"success"===data.status&&($scope.data=data.rs,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}))}),$scope.bookingSelected=function(b){$scope.selectedCanId=b.Candidate_id,$scope.selectedBookId=b.Booking_id},$scope.openDetail=function(b){$modal.open({templateUrl:"modules/onlineBooking/views/bookingDetailModal.html",controller:"BookingDetailController",size:"lg",resolve:{bookingId:function(){return b.Booking_id},candidateId:function(){return b.Candidate_id}}})},$scope.cancelBooking=function(b){$modal.open({templateUrl:"modules/onlineBooking/views/confirmCancel.html",controller:"CancelController",size:"md",resolve:{bookingId:function(){return b.Booking_id}}})},$scope.changeBookingTime=function(b){$modal.open({templateUrl:"modules/onlineBooking/views/changeBookingTime.html",controller:"ChangeBookingController",size:"md",resolve:{bookingId:function(){return b.Booking_id}}})},$scope.searchModal=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/searchBookingModal.html",controller:"SearchBookingController",size:"md",resolve:{companyId:function(){return companyInfo.id}}});modalInstance.result.then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.data=data,$scope.tableParams.reload()})})},$scope.updateNote=function(b){var a={bookingId:b.Booking_id,candidateId:b.Candidate_id,note:b.Appointment_notes};OnlineBookingService.updateNote(a).then(function(data){"success"===data.status?toastr.success("Edit Successfully!","Success"):toastr.error("Edit Failed!","Error")})}}).controller("SearchBookingController",function($scope,$modalInstance,OnlineBookingService,companyId){$scope.minDate=new Date,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={companyId:companyId,companyName:null,candidateName:null,fromDate:null,toDate:null,bookingPerson:null,status:null,siteName:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.search=function(){OnlineBookingService.searchBooking($scope.info).then(function(data){$modalInstance.close(data)})},$scope.reset=function(){OnlineBookingService.getBookingList(companyId).then(function(data){$modalInstance.close(data.rs)})}}).controller("BookingDetailController",function($scope,$modalInstance,OnlineBookingService,bookingId,candidateId){$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingService.getBookingDetail(bookingId,candidateId).then(function(data){var arrAss=[];$scope.detail=data.rs[0],"undefined"!=typeof data.rs[0].package_id&&OnlineBookingService.getPackageAssById(data.rs[0].package_id).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.detail.ass=_.groupBy(arrAss,"head_name")}})})}).controller("CancelController",function($scope,$state,$modalInstance,OnlineBookingService,bookingId){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(){OnlineBookingService.cancelBooking(bookingId).then(function(data){"success"===data.status?($modalInstance.dismiss("cancel"),$state.go("loggedIn.bookingList",null,{reload:!0})):alert("Failed")})}}).controller("ChangeBookingController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,toastr,bookingId){$scope.info={siteId:"",fromDate:"",toDate:"",calId:"",appointmentTime:"",submitTime:""},$scope.siteList=[],$scope.calList=[],$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingService.getSite().then(function(data){$scope.siteList=data}),$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.siteChange=function(){if("undefined"!=typeof $scope.info.siteId&&null!==$scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}else $scope.calList=[],$scope.info.appointmentTime=""},$scope.fromDateChange=function(){if("undefined"!=typeof $scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}else $scope.calList=[],$scope.info.appointmentTime=""},$scope.toDateChange=function(){if("undefined"!=typeof $scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate){var id=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd");OnlineBookingService.getCalendar(id,from,to).then(function(data){$scope.calList=data})}else $scope.calList=[],$scope.info.appointmentTime=""},$scope.calChange=function(){if(null!==$scope.info.calId&&"undefined"!=typeof $scope.info.calId){var calId=$scope.info.calId;OnlineBookingService.getAppointmentTime(calId).then(function(data){var date=$filter("date")(data[0].From_time,"dd/MM/yyyy HH:mm:ss"),submitDate=$filter("date")(data[0].From_time,"yyyy-MM-dd HH:mm:ss");$scope.info.appointmentTime=date,$scope.info.submitTime=submitDate})}else $scope.info.appointmentTime=""},$scope.submit=function(){if(null!==$scope.info.siteId&&"undefined"!=typeof $scope.info.fromDate&&"undefined"!=typeof $scope.info.toDate&&null!==$scope.info.calId){var siteId=$scope.info.siteId,from=$filter("date")($scope.info.fromDate,"yyyy-MM-dd"),to=$filter("date")($scope.info.toDate,"yyyy-MM-dd"),calId=$scope.info.calId,time=$scope.info.submitTime;OnlineBookingService.changeBookingTime(siteId,from,to,calId,time,bookingId).then(function(data){"success"===data.status?($modalInstance.dismiss("cancel"),toastr.success("Submit Successfully!","Success"),$state.go("loggedIn.bookingList",null,{reload:!0})):toastr.error("Submit Failed!","Error")})}}}),angular.module("app.loggedIn.booking.package.controller",[]).controller("PackageController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingService,$http,toastr,$cookieStore){var companyInfo;$scope.isSelected=!1,$scope.selectedPack=null;var ass=[];$scope.assList=[],$scope.data=[],$scope.data1=[],"undefined"!==$cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),OnlineBookingService.getPackage(companyInfo.id).then(function(data){"success"===data.status&&(OnlineBookingService.getAssList().then(function(data){$scope.assList=data}),$scope.data=data.rs,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),OnlineBookingService.getPackageAss().then(function(data){ass=data.rs,$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}))}),$scope.removePackage=function(p){OnlineBookingService.deletePackage(p.PackId,companyInfo.id).then(function(data){"success"===data.status?(OnlineBookingService.getPackage(companyInfo.id).then(function(d){"success"===d.status&&($scope.data=d.rs),$scope.$watch("data",function(data){$scope.data=data,$scope.tableParams.reload()})}),toastr.success("Delete Successfully","Success")):toastr.error("Delete Failed","Error")})},$scope.addPackage=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/addPackage.html",controller:"AddPackageController",size:"md",resolve:{comId:function(){return companyInfo.id}}});modalInstance.result.then(function(){OnlineBookingService.getPackage(companyInfo.id).then(function(d){"success"===d.status&&($scope.data=d.rs),$scope.$watch("data",function(data){$scope.data=data,$scope.tableParams.reload()})})})},$scope.addPackageAss=function(){$modal.open({templateUrl:"modules/onlineBooking/views/addPackageAss.html",controller:"AddPackageAssController",size:"md",resolve:{packId:function(){return $scope.selectedPack}}})},$scope.showChild=function(p){$scope.data1=[],$scope.isSelected=!0,$scope.selectedPack=p.PackId;for(var i=0;i<ass.length;i++)p.PackId===ass[i].pack_id&&$scope.data1.push(ass[i]);$scope.tableParams2.reload()},$scope.removeAss=function(a){$scope.data1=[],OnlineBookingService.removePackAss(a.ass_id,a.pack_id).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),OnlineBookingService.getPackageAss().then(function(data){ass=data.rs;for(var i=0;i<ass.length;i++)p.PackId===ass[i].pack_id&&$scope.data1.push(ass[i])}),$scope.tableParams2.reload()):toastr.error("Delete Failed!","Error")})}}).controller("AddPackageController",function($scope,$state,toastr,$modalInstance,OnlineBookingService,comId){$scope.info={packName:""},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){""!==$scope.info.packName&&OnlineBookingService.insertPackage($scope.info.packName,comId).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.close()):toastr.error("Insert Failed!","Error")})}}).controller("AddPackageAssController",function($scope,$state,toastr,$modalInstance,OnlineBookingService,packId){OnlineBookingService.getAssList().then(function(data){$scope.assList=data}),$scope.a={id:""},$scope.b={price:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.getPrice=function(id){null!=id?OnlineBookingService.getAssPrice(id).then(function(data){console.log(data[0].price),$scope.b.price=data[0].price}):$scope.b.price=""},$scope.submit=function(){null!==$scope.a.id&&OnlineBookingService.insertPackAss($scope.a.id,packId).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.dismiss("cancel"),$state.go("loggedIn.package",null,{reload:!0})):toastr.error("Insert Failed!","Error")})}}),angular.module("app.loggedIn.booking.position.controller",[]).controller("PositionController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingService,$http,toastr,$cookieStore){var companyInfo;"undefined"!==$cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),$scope.data=[],OnlineBookingService.getPositionList(companyInfo.id).then(function(data){$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.removePosition=function(p){OnlineBookingService.deletePosition(p.Position_name,companyInfo.id).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),$state.go("loggedIn.position",null,{reload:!0})):toastr.error("Delete Failed!","Error")})},$scope.addPosition=function(){$modal.open({templateUrl:"modules/onlineBooking/views/addPosition.html",controller:"AddPositionController",size:"md",resolve:{comId:function(){return companyInfo.id}}})}}).controller("AddPositionController",function($scope,$state,toastr,$modalInstance,OnlineBookingService,comId){$scope.info={positionName:""},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){""!==$scope.info.positionName&&OnlineBookingService.insertPos($scope.info.positionName,comId).then(function(data){
"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.dismiss("cancel"),$state.go("loggedIn.position",null,{reload:!0})):toastr.error("Insert Failed!","Error")})}}),angular.module("app.loggedIn.booking.setting.controller",[]).controller("SettingController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingService,$http,toastr,$cookieStore){var companyInfo,userInfo;$scope.data=[],"undefined"!=typeof $cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),"undefined"!=typeof $cookieStore.get("userInfo")&&(userInfo=$cookieStore.get("userInfo")),OnlineBookingService.getUserByCompany(companyInfo.id).then(function(data){$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.newUser=function(){$state.go("loggedIn.newUser")},$scope.editUser=function(b){$state.go("loggedIn.editUser",{id:b.id})}}).controller("NewUserController",function($scope,$state,OnlineBookingService,toastr,$cookieStore){var companyInfo;$scope.isEdit=!1,$scope.data=[],"undefined"!=typeof $cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),$scope.info={bookPerson:null,email:null,isDownload:"1",isEnable:"1",isMakeBooking:"1",isPackage:"1",isPosition:"1",isSetting:"1",isShowAll:"1",isShowBooking:"1",isViewAllData:"1",password:null,phone:null,username:null,userType:"Company",companyId:companyInfo.id,poNum:null,invoiceEmail:null,resultEmail:null,reportEmail:null,function_id:null,empId:null,isCalendar:null,isProject:null,isAdmin:null,isReceiveEmail:null},$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingService.insertNewUser($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New User Successfully!","Success"),$state.go("loggedIn.newUser",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})}}).controller("EditUserController",function($scope,$state,$stateParams,$modal,OnlineBookingService,toastr,$cookieStore){var companyInfo;$scope.isEdit=!0,$scope.data=[],"undefined"!=typeof $cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),$scope.info={userId:$stateParams.id,bookPerson:null,email:null,isDownload:"1",isEnable:"1",isMakeBooking:"1",isPackage:"1",isPosition:"1",isSetting:"1",isShowAll:"1",isShowBooking:"1",isViewAllData:"1",phone:null,username:null,companyId:companyInfo.id,userType:"Company"},OnlineBookingService.getUserInfo($stateParams.id).then(function(data){$scope.info.bookPerson=data.Booking_Person,$scope.info.email=data.Contact_email,$scope.info.isDownload=1==data.isDownloadResult?"1":"0",$scope.info.isEnable=1==data.isEnable?"1":"0",$scope.info.isMakeBooking=1==data.isMakeBooking?"1":"0",$scope.info.isPackage=1==data.isPackage?"1":"0",$scope.info.isPosition=1==data.isPosition?"1":"0",$scope.info.isSetting=1==data.isSetting?"1":"0",$scope.info.isShowAll=1==data.isAll?"1":"0",$scope.info.isShowBooking=1==data.isBooking?"1":"0",$scope.info.isViewAllData=1==data.isAllCompanyData?"1":"0",$scope.info.phone=data.Contact_number,$scope.info.username=data.user_name}),$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingService.editUserInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Submit New User Successfully!","Success"):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})},$scope.changePass=function(){$modal.open({templateUrl:"modules/onlineBooking/views/changePassModal.html",controller:"ChangePassController",size:"md",resolve:{userId:function(){return $stateParams.id}}})}}).controller("ChangePassController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,userId,toastr){$scope.info={oldPass:null,newPass:null,id:userId},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(){OnlineBookingService.changeUserPassword($scope.info).then(function(data){"success"===data.status?toastr.success("Change Password Successfully","Success"):"error"===data.status&&toastr.error("Change Password Failed","Error")})}}),angular.module("app.loggedIn.booking.services",[]).factory("OnlineBookingService",function(Restangular){var bookingService={},api=Restangular.all("api");return bookingService.getSubCompany=function(id){var sub=api.all("company/sub");return sub.post({id:id})},bookingService.getSubCompanyInfo=function(id){var sub=api.all("company/info");return sub.post({comId:id})},bookingService.getPackage=function(id){var package=api.all("booking/packageList");return package.post({id:id})},bookingService.insertPackage=function(name,comId){var insert=api.all("package/insert");return insert.post({name:name,comId:comId})},bookingService.insertPackAss=function(id,packId){var insert=api.all("package/assessment/insert");return insert.post({id:id,packId:packId})},bookingService.insertPos=function(name,comId){var insert=api.all("booking/position/insert");return insert.post({name:name,comId:comId})},bookingService.getPackageAssById=function(id){var ass=api.all("package/assessment/id");return ass.post({id:id})},bookingService.getPackageAss=function(){var ass=api.one("package/assessment");return ass.get()},bookingService.getAssPrice=function(id){var ass=api.all("assessment/price");return ass.post({id:id})},bookingService.updatePackAss=function(oldId,newId,packId){var ass=api.all("package/assessment/update");return ass.post({oldId:oldId,newId:newId,packId:packId})},bookingService.removePackAss=function(id,packid){var del=api.all("package/assessment/delete");return del.post({id:id,packId:packid})},bookingService.getBookingList=function(id){var list=api.all("booking/list/companyId");return list.post({id:id})},bookingService.getBookingDetail=function(id,canId){var detail=api.all("booking/detail");return detail.post({id:id,canId:canId})},bookingService.cancelBooking=function(id){var cancel=api.all("booking/cancel");return cancel.post({id:id})},bookingService.getSite=function(){var site=api.one("redimedsite/list");return site.get()},bookingService.getCalendar=function(id,from,to){var cal=api.all("booking/calendar");return cal.post({siteId:id,fromDate:from,toDate:to})},bookingService.getAppointmentTime=function(id){var time=api.all("booking/appointmentTime");return time.post({id:id})},bookingService.changeBookingTime=function(siteId,from,to,calId,appTime,bookId){var submit=api.all("booking/changeBookingTime");return submit.post({siteId:siteId,from:from,to:to,calId:calId,appTime:appTime,bookId:bookId})},bookingService.deletePackage=function(id,comId){var delPackage=api.all("booking/delete/package");return delPackage.post({id:id,comId:comId})},bookingService.getAssList=function(){var assList=api.one("booking/assList");return assList.get()},bookingService.getPositionList=function(comId){var position=api.all("booking/position/list");return position.post({comId:comId})},bookingService.deletePosition=function(name,comId){var del=api.all("booking/position/delete");return del.post({name:name,comId:comId})},bookingService.submitBook=function(info,head){var submit=api.all("booking/submit");return submit.post({info:info,header:head})},bookingService.pendingCalendar=function(info){var submit=api.all("booking/pending");return submit.post({info:info})},bookingService.deleteAllPending=function(){var del=api.all("booking/delete/allPending");return del.post()},bookingService.deletePending=function(info){var del=api.all("booking/delete/pending");return del.post({info:info})},bookingService.getUserByCompany=function(comId){var user=api.all("users/company");return user.post({comId:comId})},bookingService.insertNewUser=function(info){var user=api.all("users/insert");return user.post({info:info})},bookingService.getUserInfo=function(id){var user=api.all("users/id");return user.post({id:id})},bookingService.editUserInfo=function(info){var user=api.all("users/edit");return user.post({info:info})},bookingService.changeUserPassword=function(info){var pass=api.all("users/changePass");return pass.post({info:info})},bookingService.getSiteState=function(id){var state=api.all("redimedsite/state");return state.post({id:id})},bookingService.getStateSuburb=function(id){var suburb=api.all("redimedsite/state/suburb");return suburb.post({id:id})},bookingService.customPackage=function(id){var pack=api.all("package/custom");return pack.post({id:id})},bookingService.searchBooking=function(info){var search=api.all("booking/search");return search.post({info:info})},bookingService.updateNote=function(info){var note=api.all("booking/edit/note");return note.post({info:info})},bookingService.exportExcel=function(){var ex=api.one("booking/export");return ex.get()},bookingService}),angular.module("app.loggedIn.booking.admin",["app.loggedIn.booking.admin.services","app.loggedIn.booking.admin.booking.controller","app.loggedIn.booking.admin.assessment.controller","app.loggedIn.booking.admin.company.controller","app.loggedIn.booking.admin.user.controller","app.loggedIn.booking.admin.site.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.admin_booking",{url:"/admin/booking/booking",templateUrl:"modules/onlineBooking_Admin/views/booking.html",controller:"AdminBookingController"}).state("loggedIn.admin_assessment",{url:"/admin/booking/assessment",templateUrl:"modules/onlineBooking_Admin/views/assessment.html",controller:"AdminAssessmentController"}).state("loggedIn.admin_company",{url:"/admin/booking/companies",templateUrl:"modules/onlineBooking_Admin/views/companies.html",controller:"AdminCompanyController"}).state("loggedIn.admin_company_new",{url:"/admin/booking/company/new/:id",templateUrl:"modules/onlineBooking_Admin/views/addNewCompany.html",controller:"AdminNewCompanyController"}).state("loggedIn.admin_company_edit",{url:"/admin/booking/company/edit/:fatherId/:subId",templateUrl:"modules/onlineBooking_Admin/views/addNewCompany.html",controller:"AdminEditCompanyController"}).state("loggedIn.admin_user",{url:"/admin/booking/user",templateUrl:"modules/onlineBooking_Admin/views/user.html",controller:"AdminUserController"}).state("loggedIn.admin_user_new",{url:"/admin/booking/user/new",templateUrl:"modules/onlineBooking_Admin/views/newUser.html",controller:"AdminNewUserController"}).state("loggedIn.admin_user_edit",{url:"/admin/booking/user/:id",templateUrl:"modules/onlineBooking_Admin/views/newUser.html",controller:"AdminEditUserController"}).state("loggedIn.admin_sites",{url:"/admin/booking/sites",templateUrl:"modules/onlineBooking_Admin/views/sites.html",controller:"AdminSiteController"}).state("loggedIn.admin_sites_new",{url:"/admin/booking/sites/new",templateUrl:"modules/onlineBooking_Admin/views/newSite.html",controller:"AdminNewSiteController"}).state("loggedIn.admin_sites_edit",{url:"/admin/booking/sites/:id",templateUrl:"modules/onlineBooking_Admin/views/newSite.html",controller:"AdminEditSiteController"})}),angular.module("app.loggedIn.booking.admin.booking.controller",[]).controller("AdminBookingController",function($scope,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.data=[],$scope.isSelected=!1,$scope.selectedCanId=null,$scope.selectedBookId=null,$scope.isChangeFile=!1,$scope.info={},$scope.dateOptions={formatYear:"yy",startingDay:1};var uploader=$scope.uploader=new FileUploader({url:"/api/booking/upload"});uploader.onAfterAddingFile=function(fileItem){fileItem.formData[0]={Booking_id:$scope.info.Booking_id,Candidate_id:$scope.info.Candidate_id,fileName:uploader.queue[0].file.name},console.info("onAfterAddingFile",fileItem)},OnlineBookingAdminService.getList().then(function(data){"success"===data.status&&($scope.data=data.rs,$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}))}),$scope.openDetail=function(b){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/bookingDetailModal.html",controller:"AdminBookingDetailController",size:"lg",resolve:{bookingId:function(){return b.Booking_id},candidateId:function(){return b.Candidate_id}}})},$scope.showDetail=function(b){$scope.selectedCanId=b.Candidate_id,$scope.selectedBookId=b.Booking_id,$scope.isSelected=!0,uploader.clearQueue(),OnlineBookingService.getBookingDetail(b.Booking_id,b.Candidate_id).then(function(data){var arrAss=[];$scope.info=data.rs[0],OnlineBookingService.getSite().then(function(rs){$scope.siteList=rs});var from=$filter("date")(data.rs[0].from_date,"yyyy-MM-dd"),to=$filter("date")(data.rs[0].to_date,"yyyy-MM-dd");OnlineBookingService.getCalendar(data.rs[0].site_id,from,to).then(function(data){$scope.calList=data}),OnlineBookingService.getPackageAssById(data.rs[0].package_id).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.packAss=_.groupBy(arrAss,"head_name")}})})},$scope.saveInfo=function(){uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.uploadAll(),console.log(uploader),uploader.onCompleteAll=function(){console.info("onCompleteAll")},OnlineBookingAdminService.editBookingInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Successfully!","Success"):toastr.error("Edit Failed!","Error")})},$scope.sendEmail=function(){OnlineBookingAdminService.confirmBooking($scope.info).then(function(data){"success"===data.status?toastr.success("Send Mail Successfully! Please check your email!","Success"):toastr.error("Send Mail Failed!","Error")})},$scope.searchModal=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/searchBookingModal.html",controller:"SearchAdminBookingController",size:"md",resolve:{companyId:function(){return null}}});modalInstance.result.then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.data=data,$scope.tableParams.reload()})})}}).controller("SearchAdminBookingController",function($scope,$modalInstance,OnlineBookingService,OnlineBookingAdminService,companyId){$scope.minDate=new Date,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={companyId:companyId,companyName:null,candidateName:null,fromDate:null,toDate:null,bookingPerson:null,status:null,siteName:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.search=function(){OnlineBookingService.searchBooking($scope.info).then(function(data){$modalInstance.close(data)})},$scope.reset=function(){OnlineBookingAdminService.getList().then(function(data){$modalInstance.close(data.rs)})}}).controller("AdminBookingDetailController",function($scope,$modalInstance,OnlineBookingService,bookingId,candidateId){$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingService.getBookingDetail(bookingId,candidateId).then(function(data){var arrAss=[];$scope.detail=data.rs[0],"undefined"!=typeof data.rs[0].package_id&&OnlineBookingService.getPackageAssById(data.rs[0].package_id).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.detail.ass=_.groupBy(arrAss,"head_name")}})})}),angular.module("app.loggedIn.booking.admin.assessment.controller",[]).controller("AdminAssessmentController",function($scope,$state,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.data=[],$scope.data1=[],$scope.selectedHeader="",$scope.ass=[],$scope.isSelected=!1,$scope.selectedId=null,OnlineBookingAdminService.getAssHeader().then(function(data){$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data,$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.showChild=function(p){$scope.selectedId=p.id,$scope.data1=[],$scope.isSelected=!0,$scope.selectedHeader=p.id;for(var i=0;i<$scope.ass.length;i++)p.id===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()},$scope.removeHeaderAssessment=function(p){var headerId=p.id;OnlineBookingAdminService.deleteHeaderAssessment(headerId).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Delete Failed!","Error")})},$scope.removeAssessment=function(a){var id=a.id;OnlineBookingAdminService.deleteAssessment(id).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Delete Failed!","Error")})},$scope.addHeader=function(){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentHeaderModal.html",controller:"AddAssHeaderController",size:"md"})},$scope.addAssessment=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentModal.html",controller:"AddAssessmentController",size:"md",resolve:{headId:function(){return $scope.selectedHeader}}});modalInstance.result.then(function(headId){$scope.ass=[],$scope.data1=[],OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data}),$scope.$watch("ass",function(ass){for(var i=0;i<$scope.ass.length;i++)headId===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()})})},$scope.editAssessment=function(b){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentModal.html",controller:"EditAssessmentController",size:"md",resolve:{headId:function(){return $scope.selectedHeader},assId:function(){return b.id}}});modalInstance.result.then(function(headId){$scope.ass=[],$scope.data1=[],OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data}),$scope.$watch("ass",function(ass){for(var i=0;i<$scope.ass.length;i++)headId===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()})})}}).controller("AddAssHeaderController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr){$scope.info={name:""},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){OnlineBookingAdminService.addNewHeaderAssessment($scope.info).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.dismiss("cancel"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Insert Failed!","Error")})}}).controller("AddAssessmentController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr,headId){$scope.info={headId:headId,name:null,itemCode:null,itemName:null,price:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){OnlineBookingAdminService.addNewAssessment($scope.info).then(function(data){"success"===data.status?(OnlineBookingAdminService.updatePrice(),toastr.success("Insert Successfully!","Success"),$modalInstance.close(headId)):"error"===data.status&&toastr.error("Insert Failed!","Error")})}}).controller("EditAssessmentController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr,headId,assId){$scope.info={headId:headId,assId:assId,name:null,itemCode:null,itemName:null,price:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingAdminService.getAssessmentInfo(assId).then(function(data){$scope.info.headId=data[0].HEADER_ID,$scope.info.assId=data[0].id,$scope.info.name=data[0].ass_name,$scope.info.itemCode=data[0].item_code,$scope.info.itemName=data[0].item_name,$scope.info.price=data[0].price}),$scope.submit=function(){OnlineBookingAdminService.updateAssessment($scope.info).then(function(data){"success"===data.status?(OnlineBookingAdminService.updatePrice(),toastr.success("Edit Successfully!","Success"),$modalInstance.close(headId)):"error"===data.status&&toastr.error("Edit Failed!","Error")})}}),angular.module("app.loggedIn.booking.admin.company.controller",[]).controller("AdminCompanyController",function($scope,$state,$modal,$filter,ngTableParams,$cookieStore,FileUploader,OnlineBookingAdminService,toastr){$scope.data=[];var comArr=[];$scope.data1=[],$scope.patientData=[],$scope.isSelected=!1,$scope.selectedId=null,void 0!=$cookieStore.get("companyInfo")&&($scope.companyInfo=$cookieStore.get("companyInfo")),OnlineBookingAdminService.getCompanyList().then(function(data){comArr=data;for(var i=0;i<comArr.length;i++)null===comArr[i].father_id&&$scope.data.push(comArr[i]);$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.patientData.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.patientData,params.filter()):$scope.patientData,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.patientData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.showSubCompany=function(b){$scope.selectedId=b.id,$scope.selectedComp=b.Company_name,$scope.data1=[],$scope.patientData=[],$scope.isSelected=!0;for(var i=0;i<comArr.length;i++)comArr[i].father_id===b.id&&$scope.data1.push(comArr[i]);OnlineBookingAdminService.getCompanyPatients(b.id).then(function(rs){if("success"==rs.status){$scope.patientData=rs.data;for(var i=0;i<$scope.patientData.length;i++){var nameArr=[];nameArr.push($scope.patientData[i].Title),nameArr.push($scope.patientData[i].First_name),nameArr.push($scope.patientData[i].Sur_name),nameArr.push($scope.patientData[i].Middle_name),$scope.patientData[i].fullName=nameArr.join(" ")}$scope.tableParams3.reload()}}),$scope.tableParams2.reload()},$scope.addNewCompany=function(){$state.go("loggedIn.admin_company_new")},$scope.editCompany=function(b){$state.go("loggedIn.admin_company_edit",{fatherId:b.id},{reload:!0})},$scope.addSubCompany=function(){$state.go("loggedIn.admin_company_new",{id:$scope.selectedId},{reload:!0})},$scope.editSubCompany=function(a){$state.go("loggedIn.admin_company_edit",{fatherId:$scope.selectedId,subId:a.id},{reload:!0})},$scope.viewPatient=function(a){$state.go("loggedIn.patient.appointment",{patient_id:a.Patient_id,cal_id:1},{reload:!0})}}).controller("AdminNewCompanyController",function($scope,$state,ngTableParams,$stateParams,toastr,$cookieStore,OnlineBookingAdminService){$scope.isEdit=!1;var comId=null;(null!==$stateParams.id||""!==$stateParams.id||"undefined"!=typeof $stateParams.id)&&(comId=$stateParams.id),$scope.info={companyName:null,industry:null,addr:null,postCode:null,state:null,country:null,description:null,poNum:null,isInvoice:null,invoiceEmail:null,isResult:null,resultEmail:null,reportEmail:null,status:null,isProject:null,isPO:null,isExtra:null,phone:null,fatherId:comId},$scope.submitCompany=function(companyForm){$scope.showClickedValidation=!0,companyForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.checkCompanyName($scope.info.companyName).then(function(data){"error"==data.status?(toastr.error("Company Name is already exists!"),$scope.isExist=!0):($scope.isExist=!1,OnlineBookingAdminService.insertNewCompany($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New Company Successfully!","Success"),$state.go("loggedIn.admin_company",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New Company Failed!","Error")}))})}}).controller("AdminEditCompanyController",function($scope,$filter,ngTableParams,$state,$stateParams,OnlineBookingService,toastr,$cookieStore,OnlineBookingAdminService){$scope.isEdit=!0,$scope.fatherId=null!=$stateParams.fatherId||void 0!=$stateParams.fatherId?$stateParams.fatherId:null,$scope.subId=null!=$stateParams.subId||void 0!=$stateParams.subId?$stateParams.subId:null,$scope.patientData=[],$scope.data1=[],$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.patientData.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.patientData,params.filter()):$scope.patientData,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.patientData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),OnlineBookingAdminService.getCompanyList().then(function(data){for(var i=0;i<data.length;i++)data[i].father_id==$scope.fatherId&&$scope.data1.push(data[i]);$scope.tableParams2.reload()}),OnlineBookingAdminService.getCompanyPatients(null==$scope.fatherId?$scope.subId:$scope.fatherId).then(function(rs){if("success"==rs.status){$scope.patientData=rs.data;for(var i=0;i<$scope.patientData.length;i++){var nameArr=[];nameArr.push($scope.patientData[i].Title),nameArr.push($scope.patientData[i].First_name),nameArr.push($scope.patientData[i].Sur_name),nameArr.push($scope.patientData[i].Middle_name),$scope.patientData[i].fullName=nameArr.join(" ")}$scope.tableParams3.reload()}}),$scope.addSubCompany=function(){$state.go("loggedIn.admin_company_new",{id:$scope.fatherId},{reload:!0})},$scope.editSubCompany=function(a){$state.go("loggedIn.admin_company_edit",{fatherId:$scope.fatherId,subId:a.id},{reload:!0})},$scope.viewPatient=function(a){$state.go("loggedIn.patient.appointment",{patient_id:a.Patient_id,cal_id:1},{reload:!0})},$scope.info={id:null==$scope.fatherId?$scope.subId:$scope.fatherId,companyName:null,industry:null,addr:null,postCode:null,state:null,country:null,description:null,poNum:null,isInvoice:null,invoiceEmail:null,isResult:null,resultEmail:null,reportEmail:null,status:null,isProject:null,isPO:null,isExtra:null,phone:null},OnlineBookingAdminService.getCompanyInfo(null==$scope.fatherId?$scope.subId:$scope.fatherId).then(function(data){$scope.info={id:null==$scope.fatherId?$scope.subId:$scope.fatherId,companyName:data.Company_name,industry:data.Industry,addr:data.Addr,postCode:data.postcode,state:data.State,country:data.country,description:data.Description,poNum:data.PO_number,isInvoice:1!=data.isInvoiceEmailToUser?"0":"1",invoiceEmail:data.invoice_email,isResult:1!=data.isAddContactEmailToResult?"0":"1",resultEmail:data.result_email,reportEmail:data.report_to_email,status:data.default_status,phone:data.Phone,isProject:1!=data.isProject?"0":"1",isPO:1!=data.isPO?"0":"1",isExtra:1!=data.isExtra?"0":"1"}}),$scope.submitCompany=function(companyForm){$scope.showClickedValidation=!0,companyForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.checkCompanyName($scope.info.companyName).then(function(data){"error"==data.status?($scope.isExist=!0,toastr.error("Company Name is already exists!")):($scope.isExist=!1,OnlineBookingAdminService.editCompanyInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Company Successfully!","Success"):"error"===data.status&&toastr.error("Edit Company Failed!","Error")}))})}}),angular.module("app.loggedIn.booking.admin.user.controller",[]).controller("AdminUserController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingAdminService,toastr){$scope.selectedId=null,$scope.selectedRow=null,$scope.arr=[],$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null},OnlineBookingAdminService.getListUser().then(function(data){$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")(data,params.filter()):data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.arr.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arr,params.filter()):$scope.arr,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arr;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.addNewUser=function(){$state.go("loggedIn.admin_user_new")},$scope.editUser=function(b){$state.go("loggedIn.admin_user_edit",{id:b.id})},$scope.showMenu=function(b){$scope.selectedId=b.id,$scope.selectedRow=null,$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null},$scope.showClickedValidation=!1,$scope.arr=[],$scope.rs=[],OnlineBookingAdminService.getUserMenu(b.id).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})},$scope.showMenuDetails=function(b){$scope.selectedRow=b.id,OnlineBookingAdminService.getMenuList().then(function(data){$scope.menuList=[];for(var i=0;i<data.length;i++)1==data[i].isEnable&&$scope.menuList.push(data[i])}),OnlineBookingAdminService.getUserMenuDetails(b.id).then(function(data){$scope.info.id=data[0].id,$scope.info.user_id=data[0].user_id,$scope.info.user_name=data[0].user_name,
$scope.info.menu_id=data[0].menu_id,$scope.info.isEnable=1==data[0].isEnable?"1":"0"})},$scope.submitUserMenu=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editUserMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Edit Successfully!","Success"),OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})):toastr.success("Edit Failed!","Error")})},$scope.addNewUserMenu=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newSubMenu.html",controller:"AddNewUserMenuController",size:"md",resolve:{userId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})})},$scope.deleteUserMenu=function(b){OnlineBookingAdminService.delUserMenu(b.id).then(function(data){"success"==data.status?(toastr.success("Delete Successfully!","Success"),OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()}),$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null}):toastr.error("Delete Failed","Error")})}}).controller("AddNewUserMenuController",function($scope,$state,$modal,$modalInstance,$filter,ngTableParams,OnlineBookingAdminService,UserService,userId,toastr){$scope.info={user_id:userId,menu_id:null,isEnable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingAdminService.getMenuList().then(function(data){$scope.menuList=[];for(var i=0;i<data.length;i++)1==data[i].isEnable&&$scope.menuList.push(data[i])}),$scope.addNew=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertUserMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.close()):toastr.success("Insert Failed!","Error")})}}).controller("AdminNewUserController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingAdminService,UserService,toastr,SecurityService){$scope.isEdit=!1,$scope.isCompany=!1,$scope.usernameExist=!1,$scope.emailExist=!1,$scope.typeList=[],$scope.userTypeChange=function(b){console.log("type change");for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&($scope.isCompany=$scope.typeList[i].ID==b?!0:!1)},$scope.checkUsername=function(username){SecurityService.checkUserName(username).then(function(data){$scope.usernameExist=null==data||data.length<=0?!1:!0})},$scope.checkEmail=function(email){SecurityService.checkEmail(email).then(function(data){$scope.emailExist=null==data||data.length<=0?!1:!0})},UserService.getUserType().then(function(data){$scope.typeList=data}),$scope.info={bookPerson:null,email:null,isDownload:null,isEnable:"1",isMakeBooking:null,isPackage:null,isPosition:null,isSetting:null,isShowAll:null,isShowBooking:null,isViewAllData:null,password:null,phone:null,username:null,userType:null,companyId:null,poNum:null,invoiceEmail:null,resultEmail:null,reportEmail:null,function_id:null,function_mobile:null,empId:null,isCalendar:null,isProject:null,isAdmin:null,isReceiveEmail:null},OnlineBookingAdminService.getListCompany().then(function(data){$scope.companyList=data}),OnlineBookingAdminService.getListFunction().then(function(data){for(var listWeb=[],listMobile=[],i=0;i<data.length;i++)1==data[i].isWeb&&listWeb.push(data[i]),1==data[i].isMobile&&listMobile.push(data[i]);$scope.functionList=listWeb,$scope.functionMobList=listMobile}),OnlineBookingAdminService.getListEmployee().then(function(data){$scope.empList=data}),$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertNewUser($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New User Successfully!","Success"),$state.go("loggedIn.admin_user_new",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})}}).controller("AdminEditUserController",function($scope,$state,$stateParams,$modal,OnlineBookingService,OnlineBookingAdminService,toastr,UserService,$cookieStore){$scope.typeList=[],$scope.isEdit=!0,$scope.isCompany=!1,UserService.getUserType().then(function(data){$scope.typeList=data}),$scope.userTypeChange=function(b){for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&($scope.isCompany=$scope.typeList[i].ID==b?!0:!1)},$scope.info={userId:$stateParams.id,bookPerson:null,email:null,isDownload:null,isEnable:null,isMakeBooking:null,isPackage:null,isPosition:null,isSetting:null,isShowAll:null,isShowBooking:null,isViewAllData:null,password:null,phone:null,username:null,userType:null,companyId:null,poNum:null,invoiceEmail:null,resultEmail:null,reportEmail:null,function_id:null,function_mobile:null,empId:null,isCalendar:null,isProject:null,isAdmin:null,isReceiveEmail:null},OnlineBookingAdminService.getListCompany().then(function(data){$scope.companyList=data}),OnlineBookingAdminService.getListFunction().then(function(data){for(var listWeb=[],listMobile=[],i=0;i<data.length;i++)1==data[i].isWeb&&listWeb.push(data[i]),1==data[i].isMobile&&listMobile.push(data[i]);$scope.functionList=listWeb,$scope.functionMobList=listMobile}),OnlineBookingAdminService.getListEmployee().then(function(data){$scope.empList=data}),OnlineBookingService.getUserInfo($stateParams.id).then(function(data){$scope.info.bookPerson=data.Booking_Person,$scope.info.email=data.Contact_email,$scope.info.isDownload=1==data.isDownloadResult?"1":"0",$scope.info.isEnable=1==data.isEnable?"1":"0",$scope.info.isMakeBooking=1==data.isMakeBooking?"1":"0",$scope.info.isPackage=1==data.isPackage?"1":"0",$scope.info.isPosition=1==data.isPosition?"1":"0",$scope.info.isSetting=1==data.isSetting?"1":"0",$scope.info.isShowAll=1==data.isAll?"1":"0",$scope.info.isShowBooking=1==data.isBooking?"1":"0",$scope.info.isViewAllData=1==data.isAllCompanyData?"1":"0",$scope.info.phone=data.Contact_number,$scope.info.username=data.user_name,$scope.info.userType=data.UserType.id,$scope.info.companyId=data.company_id,$scope.info.poNum=data.PO_number,$scope.info.invoiceEmail=data.invoiceemail,$scope.info.resultEmail=data.result_email,$scope.info.reportEmail=data.Report_To_email,$scope.info.function_id=data.function_id,$scope.info.function_mobile=data.function_mobile,$scope.info.empId=data.employee_id,$scope.info.isCalendar=1==data.isCalendar?"1":"0",$scope.info.isProject=1==data.isProject?"1":"0",$scope.info.isAdmin=1==data.isAdmin?"1":"0",$scope.isReceiveEmail=1==data.isReceiveEmailAfterHour?"1":"0";for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&$scope.typeList[i].ID==$scope.info.userType&&($scope.isCompany=!0)}),$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingService.editUserInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Submit New User Successfully!","Success"):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})},$scope.changePass=function(){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/changePassModal.html",controller:"AdminChangePassController",size:"md",resolve:{userId:function(){return $stateParams.id}}})}}).controller("AdminChangePassController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,userId,toastr){$scope.info={oldPass:null,newPass:null,id:userId},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(){OnlineBookingService.changeUserPassword($scope.info).then(function(data){"success"===data.status?(toastr.success("Change Password Successfully","Success"),$modalInstance.dismiss("cancel")):"error"===data.status&&toastr.error("Change Password Failed","Error")})}}),angular.module("app.loggedIn.booking.admin.site.controller",[]).controller("AdminSiteController",function($scope,$state,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.selectedId=null,$scope.selectedCal=null,$scope.selectedState=null,$scope.selectedSuburb=null,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.arr=[],$scope.arrState=[],$scope.arrSuburb=[],$scope.info={site_id:null,cal_id:null,From_time:null,to_time:null,available:null,booking:null},$scope.stateInfo={state_id:null,site_id:null,state_name:null,isenable:null},$scope.suburbInfo={suburb_id:null,state_id:null,site_id:null,suburb_name:null,isenable:null},OnlineBookingAdminService.getSiteList().then(function(data){$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")(data,params.filter()):data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.arr.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arr,params.filter()):$scope.arr,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arr;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.arrState.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arrState,params.filter()):$scope.arrState,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arrState;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams4=new ngTableParams({page:1,count:10},{total:$scope.arrSuburb.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arrSuburb,params.filter()):$scope.arrSuburb,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arrSuburb;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.addNewSite=function(){$state.go("loggedIn.admin_sites_new")},$scope.editSite=function(b){$state.go("loggedIn.admin_sites_edit",{id:b.id})},$scope.showSiteCalendar=function(b){$scope.selectedId=b.id,$scope.selectedCal=null,$scope.arr=[],$scope.arrState=[],$scope.arrSuburb=[],$scope.rs=[],$scope.rsState=[],$scope.rsSuburb=[],OnlineBookingAdminService.getCalendarBySiteId(b.id).then(function(data){$scope.rs=data}),OnlineBookingService.getSiteState(b.id).then(function(data){$scope.rsState=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()})},$scope.showStateDetail=function(b){$scope.selectedState=b.state_id,$scope.arrSuburb=[],$scope.rsSuburb=[],OnlineBookingService.getStateSuburb(b.state_id).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()}),OnlineBookingAdminService.getStateById(b.state_id).then(function(data){$scope.stateInfo=data[0],$scope.stateInfo.isenable=1==data[0].isenable?"1":"0"})},$scope.showSuburbDetail=function(b){$scope.selectedSuburb=b.suburb_id,OnlineBookingAdminService.getSuburbById(b.suburb_id).then(function(data){$scope.suburbInfo=data[0],$scope.suburbInfo.isenable=1==data[0].isenable?"1":"0"})},$scope.showCalendarDetail=function(b){$scope.selectedCal=b.cal_id,OnlineBookingAdminService.getCalendarById(b.cal_id).then(function(data){$scope.info=data})},$scope.submitState=function(stateForm){$scope.showStateValidation=!0,stateForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editStateInfo($scope.stateInfo).then(function(data){"success"===data.status?(toastr.success("Edit State Successfully!","Success"),OnlineBookingService.getSiteState($scope.selectedId).then(function(data){$scope.rsState=data}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()})):"error"===data.status&&toastr.error("Edit State Failed!","Error")})},$scope.submitSuburb=function(suburbForm){$scope.showSuburbValidation=!0,suburbForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editSuburbInfo($scope.suburbInfo).then(function(data){"success"===data.status?(toastr.success("Edit Suburb Successfully!","Success"),OnlineBookingService.getStateSuburb($scope.selectedState).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()})):"error"===data.status&&toastr.error("Edit Suburb Failed!","Error")})},$scope.submitCalendar=function(calendarForm){$scope.showClickedValidation=!0,calendarForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.submitNewCalendar($scope.info).then(function(data){"success"===data.status?(toastr.success("Edit Calendar Successfully!","Success"),OnlineBookingAdminService.getCalendarBySiteId($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})):"error"===data.status&&toastr.error("Edit Calendar Failed!","Error")})},$scope.addNewState=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newStateModal.html",controller:"NewStateController",size:"md",resolve:{siteId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){OnlineBookingService.getSiteState($scope.selectedId).then(function(data){$scope.rsState=data}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()})})},$scope.addNewSuburb=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newSuburbModal.html",controller:"NewSuburbController",size:"md",resolve:{siteId:function(){return $scope.selectedId},stateId:function(){return $scope.selectedState}}});modalInstance.result.then(function(){OnlineBookingService.getStateSuburb($scope.selectedState).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()})})}}).controller("NewStateController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,OnlineBookingAdminService,siteId,toastr){$scope.stateInfo={state_id:null,site_id:siteId,state_name:null,isenable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.addState=function(stateForm){$scope.showStateValidation=!0,stateForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertState($scope.stateInfo).then(function(data){"success"===data.status?(toastr.success("Insert State Successfully!","Success"),$modalInstance.close()):"error"===data.status&&toastr.error("Insert State Failed!","Error")})}}).controller("NewSuburbController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,OnlineBookingAdminService,siteId,stateId,toastr){$scope.suburbInfo={suburb_id:null,state_id:stateId,site_id:siteId,suburb_name:null,isenable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.addSuburb=function(suburbForm){$scope.showSuburbValidation=!0,suburbForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertSuburb($scope.suburbInfo).then(function(data){"success"===data.status?(toastr.success("Insert Suburb Successfully!","Success"),$modalInstance.close()):"error"===data.status&&toastr.error("Insert Suburb Failed!","Error")})}}).controller("AdminNewSiteController",function($scope,$state,OnlineBookingAdminService,toastr){$scope.isEdit=!1,$scope.info={Site_name:null,Site_addr:null,postcode:null,State:null,latitude:null,longitude:null,country:null,Available_def:null,booking_status:null,isPreEmpBK:null},$scope.submitSite=function(siteForm){$scope.showClickedValidation=!0,siteForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertNewSite($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New Site Successfully!","Success"),$state.go("loggedIn.admin_sites_new",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New Site Failed!","Error")})}}).controller("AdminEditSiteController",function($scope,$state,$stateParams,OnlineBookingAdminService,toastr,$cookieStore){$scope.isEdit=!0;var id=$stateParams.id;$scope.info={id:id,Site_name:null,Site_addr:null,postcode:null,State:null,latitude:null,longitude:null,country:null,Available_def:null,booking_status:null,isPreEmpBK:null},OnlineBookingAdminService.getSiteInfo(id).then(function(data){$scope.info=data,$scope.info.isPreEmpBK=1==data.isPreEmpBK?"1":"0"}),$scope.submitSite=function(siteForm){$scope.showClickedValidation=!0,siteForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editSiteInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Site Successfully!","Success"):"error"===data.status&&toastr.error("Edit Site Failed!","Error")})}}),angular.module("app.loggedIn.booking.admin.services",[]).factory("OnlineBookingAdminService",function(Restangular){var adminBooking={},api=Restangular.all("api");return adminBooking.getList=function(){var list=api.one("booking/list");return list.get()},adminBooking.editBookingInfo=function(info){var edit=api.all("booking/edit");return edit.post({info:info})},adminBooking.confirmBooking=function(info){var confirm=api.all("booking/confirm");return confirm.post({info:info})},adminBooking.getAssHeader=function(){var head=api.one("assessment/header/list");return head.get()},adminBooking.getAssessment=function(){var a=api.one("assessment/list");return a.get()},adminBooking.deleteHeaderAssessment=function(id){var del=api.all("assessment/header/delete");return del.post({id:id})},adminBooking.addNewHeaderAssessment=function(info){var add=api.all("assessment/header/new");return add.post({info:info})},adminBooking.deleteAssessment=function(id){var del=api.all("assessment/delete");return del.post({id:id})},adminBooking.addNewAssessment=function(info){var add=api.all("assessment/new");return add.post({info:info})},adminBooking.updateAssessment=function(info){var add=api.all("assessment/edit");return add.post({info:info})},adminBooking.getAssessmentInfo=function(id){var a=api.all("assessment/info");return a.post({id:id})},adminBooking.updatePrice=function(){var a=api.all("package/updateFee");return a.post()},adminBooking.getCompanyList=function(){var list=api.one("company/list");return list.get()},adminBooking.getSubCompany=function(id){var sub=api.all("company/sub");return sub.post({id:id})},adminBooking.getCompanyPatients=function(id){return api.all("company/patients").post({companyId:id})},adminBooking.getCompanyInfo=function(id){var sub=api.all("company/info");return sub.post({comId:id})},adminBooking.checkCompanyName=function(name){return api.all("company/checkName").post({name:name})},adminBooking.insertNewCompany=function(info){var add=api.all("company/new");return add.post({info:info})},adminBooking.editCompanyInfo=function(info){var edit=api.all("company/edit");return edit.post({info:info})},adminBooking.getListUser=function(){var list=api.one("users/list");return list.get()},adminBooking.getListCompany=function(){var list=api.one("company/list");return list.get()},adminBooking.getListFunction=function(){var list=api.one("function/list");return list.get()},adminBooking.getListEmployee=function(){var list=api.one("users/employee/list");return list.get()},adminBooking.insertNewUser=function(info){var user=api.all("users/insert");return user.post({info:info,isReg:!1})},adminBooking.getSiteList=function(){var list=api.one("redimedsite/list");return list.get()},adminBooking.getSiteInfo=function(id){var info=api.all("redimedsite/info");return info.post({id:id})},adminBooking.insertNewSite=function(info){var insert=api.all("redimedsite/insert");return insert.post({info:info})},adminBooking.editSiteInfo=function(info){var edit=api.all("redimedsite/edit");return edit.post({info:info})},adminBooking.getCalendarBySiteId=function(id){var info=api.all("calendar/siteId");return info.post({id:id})},adminBooking.getCalendarById=function(id){var info=api.all("calendar/info");return info.post({id:id})},adminBooking.submitNewCalendar=function(info){var submit=api.all("calendar/submit");return submit.post({info:info})},adminBooking.getUserMenu=function(id){var list=api.all("users/menu");return list.post({id:id})},adminBooking.getMenuList=function(){var list=api.one("menu/list/root");return list.get()},adminBooking.getUserMenuDetails=function(id){var detail=api.all("users/menu/details");return detail.post({id:id})},adminBooking.editUserMenu=function(info){var edit=api.all("users/menu/edit");return edit.post({info:info})},adminBooking.insertUserMenu=function(info){var insert=api.all("users/menu/insert");return insert.post({info:info})},adminBooking.getStateById=function(id){var state=api.all("redimedsite/state/id");return state.post({id:id})},adminBooking.getSuburbById=function(id){var suburb=api.all("redimedsite/state/suburb/id");return suburb.post({id:id})},adminBooking.editStateInfo=function(info){var edit=api.all("redimedsite/state/edit");return edit.post({info:info})},adminBooking.editSuburbInfo=function(info){var edit=api.all("redimedsite/state/suburb/edit");return edit.post({info:info})},adminBooking.insertState=function(info){var insert=api.all("redimedsite/state/insert");return insert.post({info:info})},adminBooking.insertSuburb=function(info){var insert=api.all("redimedsite/state/suburb/insert");return insert.post({info:info})},adminBooking.delUserMenu=function(id){var del=api.all("users/menu/delete");return del.post({id:id})},adminBooking}),angular.module("app.loggedIn.outreferral",["app.loggedIn.outreferral.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.outreferral",{"abstract":!0,url:"/outreferral"}).state("loggedIn.patient.outreferral.list",{url:"/list",views:{"main-content@loggedIn.patient":{templateUrl:"modules/outreferral/views/patient/list.html",controller:"OutreferralPatientListController"}}})}),angular.module("app.loggedIn.outreferral.include",["app.loggedIn.outreferral.directives.patientList","app.loggedIn.outreferral.directives.patientAdd","app.loggedIn.outreferral.directives.patientEdit","app.loggedIn.outreferral.directives.patientShow","app.loggedIn.outreferral.controllers.patientList","app.loggedIn.outreferral.model"]),angular.module("app.loggedIn.outreferral.model",[]).factory("OutreferralModel",function(Restangular){var instanceService={},appApi=Restangular.all("api/meditek/v1/outreferral");return instanceService.checkPatientCalendar=function(data){var detailApi=appApi.all("checkPatientCalendar");return detailApi.post({data:data})},instanceService.listFollowPatient=function(data){var detailApi=appApi.all("listFollowPatient");return detailApi.post({data:data})},instanceService.listNoFollowPatient=function(data){var detailApi=appApi.all("listNoFollowPatient");return detailApi.post({data:data})},instanceService.checkReferral=function(data){var detailApi=appApi.all("checkReferral");return detailApi.post({data:data})},instanceService.add=function(data){var detailApi=appApi.all("add");return detailApi.post({data:data})},instanceService.select=function(data){var detailApi=appApi.all("selectPatient");return detailApi.post({data:data})},instanceService.addPatient=function(data){var detailApi=appApi.all("addPatient");return detailApi.post({data:data})},instanceService.edit=function(data){var detailApi=appApi.all("edit");return detailApi.post({data:data})},instanceService.remove=function(data){var detailApi=appApi.all("remove");return detailApi.post({data:data})},instanceService.one=function(data){var detailApi=appApi.all("one");return detailApi.post({data:data})},instanceService.updateEnable=function(data){var detailApi=appApi.all("updateEnable");return detailApi.post({data:data})},instanceService.DotorFromUserId=function(data){var detailApi=appApi.all("DotorFromUserId");return detailApi.post({data:data})},instanceService.DotorFromDoctorId=function(data){var detailApi=appApi.all("DotorFromDoctorId");return detailApi.post({data:data})},instanceService}),angular.module("app.loggedIn.outreferral.controllers.patientList",[]).controller("OutreferralPatientListController",function($scope,$modal,$stateParams,toastr){var add=function(){$modal.open({templateUrl:"dialogOutreferralAdd",controller:"OutreferralPatientAddDialog",size:"lg",resolve:{patientId:function(){return $stateParams.patient_id}}}).result.then(function(response){"success"===response&&(toastr.success("Added Successfully"),$scope.outreferral.reload=!0)})};$scope.outreferral={dialog:{add:function(){add(),$scope.outreferral.reload=!1}},reload:!1,limit:20,Patient_id:$stateParams.patient_id}}).controller("OutreferralPatientAddDialog",function($scope,$modalInstance,$stateParams,patientId,AppointmentModel){$scope.patientId=patientId,$scope.calId=$stateParams.cal_id,$scope.success=!1,AppointmentModel.one({CAL_ID:$scope.calId}).then(function(response){$scope.doctorId=response.data.DOCTOR_ID}),$scope.$watch("success",function(success){success&&$modalInstance.close("success")})}),angular.module("app.loggedIn.outreferral.directives.patientList",[]).controller("OutreferralPatientRemoveDialog",function($scope,$modalInstance,list){$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){$modalInstance.close(list)}}).controller("OutreferralPatientEditDialog",function($scope,$modalInstance,$stateParams,list){$scope.outreferral={id:list.id,patient_id:list.patient_id,success:!1},$scope.$watch("outreferral.success",function(success){success&&$modalInstance.close("success")})}).controller("OutreferralPatientShowDialog",function($scope,$modalInstance,$stateParams,list){$scope.outreferral={id:list.id,patient_id:list.patient_id,success:!1},$scope.$watch("outreferral.success",function(success){success&&$modalInstance.close("success")})}).directive("outreferralPatientList",function(OutreferralModel,$modal,toastr,$stateParams,$timeout){return{restrict:"EA",scope:{reload:"=",limit:"=",patientId:"=",calId:"=",doctorId:"=",withoutPatient:"@",permission:"@",onRowClick:"&",addSuccess:"="},templateUrl:"modules/outreferral/directives/templates/patientList.html",link:function(scope,elem,attrs){scope.action="undefined"==typeof scope.permission?{edit:!0,remove:!0,add:trues}:scope.$eval(scope.permission);var search={page:1,limit:scope.limit,offset:0,max_size:5,patient_id:scope.patientId},load=function(){var postData=angular.copy(scope.outreferral.search);"undefined"!=typeof scope.withoutPatient&&scope.withoutPatient?OutreferralModel.listNoFollowPatient(postData).then(function(response){scope.outreferral.list=response.data,scope.outreferral.count=response.count},function(error){}):OutreferralModel.listFollowPatient(postData).then(function(response){scope.outreferral.list=response.data,scope.outreferral.count=response.count},function(error){})},clickEnable=function(row){var postData={CAL_ID:$stateParams.cal_id,patient_id:row.patient_id,outreferral_id:row.id,isEnable:row.isEnable};OutreferralModel.updateEnable(postData).then(function(response){console.log(response),scope.outreferral.load()},function(error){})},clickDisale=function(row){console.log($stateParams.cal_id);var postData={CAL_ID:$stateParams.cal_id,patient_id:row.patient_id,outreferral_id:row.id,isEnable:row.isEnable};console.log(postData),OutreferralModel.updateEnable(postData).then(function(response){console.log(response),scope.outreferral.load()},function(error){})},onPage=function(page){scope.outreferral.search.offset=(page-1)*scope.outreferral.search.limit,scope.outreferral.load()},onSearch=function(){scope.outreferral.load(),scope.outreferral.search.page=1},onOrderBy=function(option){switch(option.field){case"Claim_date":scope.outreferral.search.Claim_date=option.order;break;case"Injury_date":scope.outreferral.search.Injury_date=option.order}scope.outreferral.load()},remove=function(list){$modal.open({templateUrl:"dialogOutreferralRemove",controller:"OutreferralPatientRemoveDialog",size:"sm",resolve:{list:function(){return list}}}).result.then(function(list){OutreferralModel.remove(list).then(function(response){toastr.success("Deleted Successfully"),scope.outreferral.load()},function(error){})})},edit=function(list){$modal.open({templateUrl:"dialogOutreferralEdit",controller:"OutreferralPatientEditDialog",size:"lg",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.outreferral.load())})},add=function(){$modal.open({templateUrl:"referralAdd",controller:function($scope,$modalInstance,patientId,calId,doctorId){$scope.outreferral={Patient_id:patientId,success:!1,calId:calId},$timeout(function(){$scope.outreferral.doctorId=doctorId,$scope.outreferral.calId=calId},600),$scope.$watch("outreferral.success",function(success){success&&$modalInstance.close("success")})},size:"lg",resolve:{patientId:function(){return scope.patientId},calId:function(){return scope.calId},doctorId:function(){return scope.doctorId}}}).result.then(function(success){"success"===success&&(toastr.success("Add Successfully"),scope.addSuccess=!0)})},show=function(list){$modal.open({templateUrl:"dialogOutreferralShow",controller:"OutreferralPatientShowDialog",size:"lg",resolve:{list:function(){return list}}}).result.then(function(response){"success"===response&&(toastr.success("Edit Successfully"),scope.outreferral.load())})};scope.outreferral={dialog:{add:function(){add()},remove:function(list){remove(list)},edit:function(list){edit(list)},show:function(list){show(list)}},load:function(){load()},list:[],count:0,search:angular.copy(search),onPage:function(page){onPage(page)},onSearch:function(){onSearch()},onOrderBy:function(option){onOrderBy(option)},clickEnable:function(row){clickEnable(row)},clickDisale:function(row){clickDisale(row)}},scope.outreferral.load(),scope.$watch("reload",function(reload){scope.outreferral.search=angular.copy(search),reload&&scope.outreferral.load()})}}}),angular.module("app.loggedIn.outreferral.directives.patientAdd",[]).directive("outreferralPatientAdd",function($cookieStore,$modal,OutreferralModel,ConfigService,$stateParams){return{restrict:"EA",scope:{patientId:"=",calId:"=",success:"=",doctorId:"=",data:"="},templateUrl:"modules/outreferral/directives/templates/patientAdd.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form=($cookieStore.get("userInfo").user_type,{CAL_ID:scope.calId,patient_id:scope.patientId,date_issued:null,date_started:null,duration:null,expire_date:null,referred_to_doctor:null,doctor_id:null,created_by:user_id,last_updated_by:user_id});scope.$watch("calId",function(calId){"undefined"!=typeof calId&&(form.CAL_ID=calId)});var save=function(){ConfigService.beforeSave(scope.outreferral.errors);var postData=angular.copy(scope.outreferral.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),
postData.date_issued&&(postData.date_issued=ConfigService.convertToDB(postData.date_issued)),postData.date_started&&(postData.date_started=ConfigService.convertToDB(postData.date_started)),postData.expire_date&&(postData.expire_date=ConfigService.convertToDB(postData.expire_date)),OutreferralModel.addPatient(postData).then(function(response){scope.success=!0},function(error){scope.outreferral.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.outreferral.errors)})};scope.$watch("doctorId",function(doctorId){if("undefined"!=typeof doctorId){var postData=doctorId;OutreferralModel.DotorFromUserId(postData).then(function(response){scope.outreferral.form.referred_to_doctor=response.data[0].doctor_id,scope.referdoctor.name=response.data[0].NAME},function(error){})}});var load=function(){},outdoctorSelect=function(){$modal.open({templateUrl:"selectOutdoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.$watch("data",function(data){"undefined"!=typeof data&&$modalInstance.close(data)}),$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.doctor_id=row.doctor_id,scope.outdoctor.name=row.name})},doctorSelect=function(){$modal.open({templateUrl:"selectDoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.referred_to_doctor=row.doctor_id,scope.referdoctor.name=row.NAME})};scope.outreferral={form:angular.copy(form),errors:[],save:function(){save()}},scope.outdoctor={name:"Select Outside Doctor",dialog:{select:function(){outdoctorSelect()}}},scope.referdoctor={name:"Referred To Doctor",dialog:{select:function(){doctorSelect()}}},scope.onChange=function(){if(null!=scope.outreferral.form.date_started)if(null==scope.outreferral.form.duration)scope.outreferral.form.expire_date=scope.outreferral.form.date_started;else{var a=parseInt(scope.outreferral.form.duration),date_started=ConfigService.convertToDB(scope.outreferral.form.date_started);date_started=moment(date_started).format();var b=moment(date_started).add(a,"months").toString(),date=moment(b).format("YYYY-MM-DD");date=ConfigService.convertToDate(date),scope.outreferral.form.expire_date=date}},scope.outreferral={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.outreferral.load()}}}),angular.module("app.loggedIn.outreferral.directives.patientShow",[]).directive("outreferralPatientShow",function($cookieStore,$modal,OutreferralModel,ConfigService){return{restrict:"EA",scope:{patientId:"=",id:"=",success:"="},templateUrl:"modules/outreferral/directives/templates/patientShow.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={patient_id:scope.patientId,date_issued:null,date_started:null,duration:null,expire_date:null,referred_to_doctor:null,doctor_id:null,created_by:user_id,last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.outreferral.errors);var postData=angular.copy(scope.outreferral.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.date_issued&&(postData.date_issued=ConfigService.convertToDB(postData.date_issued)),postData.date_started&&(postData.date_started=ConfigService.convertToDB(postData.date_started)),postData.expire_date&&(postData.expire_date=ConfigService.convertToDB(postData.expire_date)),OutreferralModel.edit(postData).then(function(response){scope.success=!0},function(error){scope.outreferral.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.outreferral.errors)})},outdoctorSelect=function(){$modal.open({templateUrl:"selectOutdoctorDialog",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.doctor_id=row.doctor_id,scope.outdoctor.name=row.name})},doctorSelect=function(){$modal.open({templateUrl:"selectDoctorDialog",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.referred_to_doctor=row.doctor_id,scope.referdoctor.name=row.NAME})},load=function(){var postData={id:scope.id};OutreferralModel.one(postData).then(function(response){angular.extend(scope.outreferral.form,response.data),scope.outreferral.form.date_issued=ConfigService.convertToDate(scope.outreferral.form.date_issued),scope.outreferral.form.expire_date=ConfigService.convertToDate(scope.outreferral.form.expire_date),scope.outreferral.form.date_started=ConfigService.convertToDate(scope.outreferral.form.date_started),scope.referdoctor.name=scope.outreferral.form.doctor_name,scope.outdoctor.name=scope.outreferral.form.outdoctor_name,delete scope.outreferral.form.creation_date,delete scope.outreferral.form.doctor_name,delete scope.outreferral.form.outdoctor_name},function(error){})};scope.outreferral={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.outdoctor={name:"Select Outside Doctor",dialog:{select:function(){outdoctorSelect()}}},scope.referdoctor={name:"Referred To Doctor",dialog:{select:function(){doctorSelect()}}},scope.outreferral.load()}}}),angular.module("app.loggedIn.outreferral.directives.patientEdit",[]).directive("outreferralPatientEdit",function($cookieStore,$modal,OutreferralModel,ConfigService){return{restrict:"EA",scope:{patientId:"=",id:"=",success:"=",data:"="},templateUrl:"modules/outreferral/directives/templates/patientEdit.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,form={patient_id:scope.patientId,date_issued:null,date_started:null,duration:null,expire_date:null,referred_to_doctor:null,doctor_id:null,created_by:user_id,last_updated_by:user_id},save=function(){ConfigService.beforeSave(scope.outreferral.errors);var postData=angular.copy(scope.outreferral.form);postData.Creation_date=postData.last_update_date=moment().format("YYYY-MM-DD"),postData.date_issued&&(postData.date_issued=ConfigService.convertToDB(postData.date_issued)),postData.date_started&&(postData.date_started=ConfigService.convertToDB(postData.date_started)),postData.expire_date&&(postData.expire_date=ConfigService.convertToDB(postData.expire_date)),OutreferralModel.edit(postData).then(function(response){scope.success=!0},function(error){scope.outreferral.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.outreferral.errors)})},outdoctorSelect=function(){$modal.open({templateUrl:"selectOutdoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.$watch("data",function(data){"undefined"!=typeof data&&$modalInstance.close(data)}),$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.doctor_id=row.doctor_id,scope.outdoctor.name=row.name})},doctorSelect=function(){$modal.open({templateUrl:"selectDoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.outreferral.form.referred_to_doctor=row.doctor_id,scope.referdoctor.name=row.NAME})},load=function(){var postData={id:scope.id};OutreferralModel.one(postData).then(function(response){angular.extend(scope.outreferral.form,response.data),scope.outreferral.form.date_issued=ConfigService.convertToDate(scope.outreferral.form.date_issued),scope.outreferral.form.expire_date=ConfigService.convertToDate(scope.outreferral.form.expire_date),scope.outreferral.form.date_started=ConfigService.convertToDate(scope.outreferral.form.date_started),scope.referdoctor.name=scope.outreferral.form.doctor_name,scope.outdoctor.name=scope.outreferral.form.outdoctor_name,delete scope.outreferral.form.creation_date,delete scope.outreferral.form.doctor_name,delete scope.outreferral.form.outdoctor_name},function(error){})};scope.onChange=function(){if(null!=scope.outreferral.form.date_started)if(null==scope.outreferral.form.duration)scope.outreferral.form.expire_date=scope.outreferral.form.date_started;else{var a=parseInt(scope.outreferral.form.duration),date_started=ConfigService.convertToDB(scope.outreferral.form.date_started);date_started=moment(date_started).format();var b=moment(date_started).add(a,"months").toString(),date=moment(b).format("YYYY-MM-DD");date=ConfigService.convertToDate(date),scope.outreferral.form.expire_date=date}},scope.outreferral={form:angular.copy(form),load:function(){load()},errors:[],save:function(){save()}},scope.outdoctor={name:"Select Outside Doctor",dialog:{select:function(){outdoctorSelect()}}},scope.referdoctor={name:"Referred To Doctor",dialog:{select:function(){doctorSelect()}}},scope.outreferral.load()}}});var ptnConst={apptStatus:{booking:{value:"Booking",display:"Booking"},checkedIn:{value:"Checked In",display:"Checked In"},waiting:{value:"Waiting",display:"Waiting"},urgent:{value:"Urgent",display:"Urgent"},inConsult:{value:"In Consult",display:"In Consult"},completed:{value:"Completed",display:"Completed"},billing:{value:"Billing",display:"Billing"},close:{value:"Close",display:"Close"},cancelled:{value:"Cancelled",display:"Cancelled"}},apptStatusDisplay:{Booking:"Booking","Checked In":"Checked In",Waiting:"Waiting",Urgent:"Urgent","In Consult":"In Consult",Completed:"Completed",Billing:"Billing",Close:"Close",Cancelled:"Cancelled"},unit:{mg:{value:"mg",display:"mg"},g:{value:"g",display:"g"},litre:{value:"litre",display:"litre"},tablet:{value:"tablet",display:"tablet"},capsule:{value:"capsule",display:"capsule"}},route:{PO:{value:"PO",display:"PO"},PR:{value:"PR",display:"PR"},IV:{value:"IV",display:"IV"},IM:{value:"IM",display:"IM"},SC:{value:"S/C",display:"S/C"},Topical:{value:"Topical",display:"Topical"}},frequency:{OD:{value:"1",display:"OD"},BD:{value:"2",display:"BD"},TDS:{value:"3",display:"TDS"},QID:{value:"4",display:"QID"}}};angular.module("app.loggedIn.patient",["app.loggedIn.patient.controller","app.loggedIn.patient.services","app.loggedIn.patient.directives","app.loggedIn.patient.listall.controller","app.loggedIn.patient.claim","app.loggedIn.patient.consult","app.loggedIn.patient.injuryManagement","app.loggedIn.patient.problem","app.loggedIn.patient.makecall.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient",{url:"/patient/:patient_id/:cal_id",templateUrl:"modules/patient/views/structure.html",controller:"PatientController"}).state("loggedIn.patient.list",{url:"/list",views:{"main-content":{templateUrl:"modules/patient/views/list.html",controller:"PatientListController"}}}).state("loggedIn.patient.appointment",{url:"/appointment",views:{"main-content":{templateUrl:"modules/patient/views/appointment.html",controller:"PatientAppointmentController"}}}).state("loggedIn.patient.detail",{url:"/detail",views:{"main-content":{templateUrl:"modules/patient/views/detail.html",controller:"PatientDetailController"}}}).state("loggedIn.patient.invoice_detail",{url:"/:header_id/invoices/detail",views:{"main-content":{templateUrl:"modules/patient/views/invoice_detail.html",controller:"PatientInvoiceDetailController"}}}).state("loggedIn.patient.invoices",{url:"/invoices",views:{"main-content":{templateUrl:"modules/patient/views/invoices.html",controller:"PatientInvoicesController"}}}).state("loggedIn.patient.recall",{url:"/recall",views:{"main-content":{templateUrl:"modules/patient/views/recall.html",controller:"PatientRecallController"}}}).state("loggedIn.patient.appt",{url:"/appt",views:{"main-content":{templateUrl:"modules/patient/views/appt.html",controller:"PatientApptListController"}}}).state("loggedIn.patient.workcover",{url:"/workcover",views:{"main-content":{templateUrl:"modules/patient/views/workcover.html",controller:"PatientWorkcoverController"}}}).state("loggedIn.patient.booking",{url:"/booking",views:{"main-content":{templateUrl:"modules/patient/views/booking.html",controller:"PatientBookingController"}}}).state("loggedIn.patient.referrals",{url:"/referrals",views:{"main-content":{templateUrl:"modules/patient/views/referrals.html",controller:"PatientReferralsController"}}}).state("loggedIn.patient.itemsheet",{url:"/appointment/itemsheet",views:{"main-content":{templateUrl:"modules/patient/views/itemsheet.html",controller:"PatientItemSheetController"}}}).state("loggedIn.patient.apptdoc",{url:"/appointment/document",views:{"main-content":{templateUrl:"modules/patient/views/apptdoc.html",controller:"PatientApptDocController"}}}).state("loggedIn.listall",{url:"/allPatients",templateUrl:"modules/patient/views/allpatients.html",controller:"PatientListAllController"}).state("loggedIn.checkin",{url:"/checkin",templateUrl:"modules/patient/views/checkin.html",controller:"PatientCheckinController"})}),angular.module("app.loggedIn.patient.services",[]).factory("PatientService",function(Restangular,ConfigService,$state){var instanceService={},appApi=Restangular.all("api"),mdtApi=Restangular.all("api/meditek/v1/patient/"),khankAPI=Restangular.all("api/erm/v2"),restfulAPI=Restangular.all("api/restful");return instanceService.get=function(patient_id){return restfulAPI.one("Patient/"+patient_id).get()},instanceService.getApptClaim=function(patient_id,cal_id){return restfulAPI.one("mdtPatientClaim").get({CAL_ID:cal_id,Patient_id:patient_id})},instanceService.insertApptClaim=function(data){return restfulAPI.all("mdtPatientClaim").post(data)},instanceService.getListAllergyinPatient=function(search){var funcApi=khankAPI.all("allergy/list_patient_allergy_enable");return funcApi.post({search:search})},instanceService.numCompanies=function(patient_id){var funcApi=khankAPI.one("patients/num_companies");return funcApi.get({id:patient_id})},instanceService.numClaims=function(patient_id){var funcApi=khankAPI.one("patients/num_claims");return funcApi.get({id:patient_id})},instanceService.mumReferrals=function(patient_id){var funcApi=khankAPI.one("patients/num_referrals");return funcApi.get({id:patient_id})},instanceService.numOutReferrals=function(patient_id){var funcApi=khankAPI.one("patients/num_outside_referrals");return funcApi.get({id:patient_id})},instanceService.numScripts=function(patient_id){var funcApi=khankAPI.one("patients/num_scripts");return funcApi.get({id:patient_id})},instanceService.numDocuments=function(patient_id){var funcApi=khankAPI.one("patients/num_documents");return funcApi.get({id:patient_id})},instanceService.numRecalls=function(patient_id){var funcApi=khankAPI.one("patients/num_recalls");return funcApi.get({id:patient_id})},instanceService.checkPatietnInfo=function(First_name,Sur_name,Middle_name,DOB){var funcApi=khankAPI.all("patients/check_patient_info");return funcApi.post({First_name:First_name,Sur_name:Sur_name,Middle_name:Middle_name,DOB:DOB})},instanceService.getDoctorInfoByUserId=function(user_id){var funcApi=khankAPI.all("doctor/doctor_info_by_user_id");return funcApi.post({user_id:user_id})},instanceService.initInvoice=function(patient_id,cal_id){var funcApi=khankAPI.all("invoice/init");return funcApi.post({patient_id:patient_id,cal_id:cal_id})},instanceService.endInvoice=function(patient_id,cal_id){var funcApi=khankAPI.all("invoice/end");return funcApi.post({patient_id:patient_id,cal_id:cal_id})},instanceService.invoiceDetail=function(header_id){var funcApi=khankAPI.all("invoice/detail");return funcApi.post({header_id:header_id})},instanceService.invoiceSave=function(header_id){var funcApi=khankAPI.all("invoice/save");return funcApi.post({header_id:header_id})},instanceService.getAppointments=function(patient_id){var funcApi=khankAPI.all("patients/appointments");return funcApi.post({patient_id:patient_id})},instanceService.getRecallAppointments=function(patient_id){var funcApi=khankAPI.all("patients/recall_appointments");return funcApi.post({patient_id:patient_id})},instanceService.getRecallAppointmentsNew=function(postData){var funcApi=khankAPI.all("patients/recall_appointments_new");return funcApi.post({data:postData})},instanceService.getDeptItems=function(dept_id){var funcApi=khankAPI.all("itemsheet/dept_items");return funcApi.post({id:dept_id})},instanceService.saveItemSheet=function(listitem){var funcApi=khankAPI.all("itemsheet/insert_dept_items");return funcApi.post({list:listitem})},instanceService.getApptItems=function(appt_id,patient_id){var funcApi=khankAPI.all("itemsheet/appt_items");return funcApi.post({appt_id:appt_id,patient_id:patient_id})},instanceService.deleteFile=function(id){var funcApi=khankAPI.all("apptdoc/delete");return funcApi.post({ID:id})},instanceService.checkIn=function(cal_id,patient_id){var funcApi=khankAPI.all("appt/check_in");return funcApi.post({CAL_ID:cal_id,Patient_id:patient_id,data:{appt_status:ptnConst.apptStatus.checkedIn.value}})},instanceService.mdtVerifiedMedicare=function(options){return khankAPI.all("patient/verified_medicare").post(options)},instanceService.mdtSearch=function(options){var funcApi=mdtApi.all("search");return funcApi.post(options)},instanceService.mdtEdit=function(postData){var funcApi=mdtApi.all("edit");return funcApi.post(postData)},instanceService.mdtAdd=function(postData){var funcApi=mdtApi.all("add");return funcApi.post(postData)},instanceService.mdtById=function(Patient_id){var funcApi=mdtApi.all("byId");return funcApi.post({Patient_id:Patient_id})},instanceService.mdtInsertWaitingList=function(params){var funcApi=mdtApi.all("waiting_list/add");return funcApi.post(params)},instanceService.mdtClaimSearch=function(options){var funcApi=mdtApi.all("claim/search");return funcApi.post(options)},instanceService.getClaim=function(claim_id){var claimApi=appApi.all("patient/getClaim");return claimApi.post({Claim_id:claim_id})},instanceService.insertClaim=function(data,Patient_id,CAL_ID){var claimApi=appApi.all("patient/insertClaim");return claimApi.post({add_data:data,Patient_id:Patient_id,CAL_ID:CAL_ID})},instanceService.editClaim=function(data){var claimApi=appApi.all("patient/editClaim");return claimApi.post(data)},instanceService.getSkinApp=function(image){var skinappApi=appApi.all("v1/skinapp/patient/image");return skinappApi.post({image:image})},instanceService.update=function(patient_info){var Patient_id=patient_info.Patient_id;delete patient_info.Patient_id;var detailApi=appApi.all("erm/v2/patients/update");return detailApi.post({Patient_id:Patient_id,data:patient_info})},instanceService.getAppointment=function(patient_id,doctor_id){var detailApi=appApi.one("erm/v1/appointment/get_by_patient");return detailApi.get({patient_id:patient_id,doctor_id:doctor_id})},instanceService.getById=function(patient_id){var detailApi=appApi.one("erm/v1/patients/get_by_id");return detailApi.get({patient_id:patient_id})},instanceService.search=function(option){var listApi=appApi.all("erm/v1/patients/search");return listApi.post(option)},instanceService.getByOption=function(option){var detailApi=appApi.all("patient/get_by_option");return detailApi.post(option)},instanceService.getTotals=function(){var detailApi=appApi.one("patient/totals");return detailApi.get()},instanceService.listAccType=function(){var detailApi=appApi.one("patient/list_account_type");return detailApi.get()},instanceService.listPrvFund=function(){var detailApi=appApi.one("patient/list_private_fund");return detailApi.get()},instanceService.insertPatient=function(data){var detailApi=appApi.all("patient/insert");return detailApi.post(data)},instanceService.updatePatient=function(data){var detailApi=appApi.all("patient/update");return detailApi.post(data)},instanceService.getPatient=function(patient_id){var detailApi=appApi.all("patient/get_by_id");return detailApi.post({patient_id:patient_id})},instanceService.post=function(data){var detailApi=appApi.all("patient/post");return detailApi.post(data)},instanceService.getReferral=function(option){var detailApi=appApi.all("patient/getReferral");return detailApi.post(option)},instanceService.insertReferral=function(data){var detailApi=appApi.all("patient/insertReferral");return detailApi.post({data:data})},instanceService.updateReferral=function(data){var detailApi=appApi.all("patient/updateReferral");return detailApi.post({data:data})},instanceService.getScript=function(option){var detailApi=appApi.all("patient/getScript");return detailApi.post(option)},instanceService.updateScript=function(data){var detailApi=appApi.all("patient/updateScript");return detailApi.post({data:data})},instanceService.insertScript=function(data){var detailApi=appApi.all("patient/insertScript");return detailApi.post({data:data})},instanceService.workcoverSearch=function(patient_id){var detailApi=khankAPI.all("assessments/group_search");return detailApi.post({patient_id:patient_id})},instanceService.workcoverSearchOpt=function(type,patient_id){var cols=[],time_field={field:"Creation_date",label:"Creation date",type:"custom",fn:function(item){return ConfigService.convertToDatetime(item.Creation_date)}},doctor_field={field:"doctor",not_submit:!0,label:"Doctor",type:"custom",fn:function(item){return item.user?item.user.Booking_Person:void 0}},edit_action=null,print_href="http://testapp.redimed.com.au:3003/RedimedJavaREST/api/document/",print_action=null;switch(type){case"first":cols=[{field:"Ass_id",is_hide:!0},{field:"cal_id"},doctor_field,time_field],edit_action=function(item){$state.go("loggedIn.waworkcover.first",{action:"edit",patient_id:patient_id,cal_id:item.cal_id,wc_id:item.Ass_id})},print_action=function(item){print_href+="firstWA/"+item.Ass_id,window.open(print_href)};break;case"progress":cols=[{field:"progress_id",is_hide:!0},{field:"cal_id"},doctor_field,time_field],edit_action=function(item){$state.go("loggedIn.waworkcover.progress",{action:"edit",patient_id:patient_id,cal_id:item.cal_id,wc_id:item.progress_id})},print_action=function(item){print_href+="progressWA/"+item.progress_id,window.open(print_href)};break;case"final":cols=[{field:"id",is_hide:!0},{field:"cal_id"},doctor_field,time_field],edit_action=function(item){$state.go("loggedIn.waworkcover.final",{action:"edit",patient_id:patient_id,cal_id:item.cal_id,wc_id:item.id})},print_action=function(item){print_href+="finalWA/"+item.id,window.open(print_href)};break;case"general":cols=[{field:"id",is_hide:!0},{field:"cal_id"},doctor_field,time_field],edit_action=function(item){$state.go("loggedIn.waworkcover.general",{action:"edit",patient_id:patient_id,cal_id:item.cal_id,wc_id:item.id})},print_action=function(item){print_href+="general/"+item.id,window.open(print_href)}}return{api:"api/erm/v2/assessments/search",method:"post",columns:cols,"static":!0,search:{patient_id:patient_id,type:type},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:edit_action},{"class":"fa fa-print",title:"Print",callback:print_action}]}},instanceService.Add_CAL=function(data){var funcApi=mdtApi.all("appt_add");return funcApi.post({data:data})},instanceService}),angular.module("app.loggedIn.patient.directives",["app.loggedIn.patient.detail.directive","app.loggedIn.patient.claim.directive","app.loggedIn.patient.outside_referral.directive","app.loggedIn.patient.waiting_list.directive","app.loggedIn.patient.search.directive","app.loggedIn.patient.companies.directive","app.loggedIn.patient.ngthumb.directive"]),angular.module("app.loggedIn.patient.detail.directive",["app.loggedIn.patient.detail.master.controller"]).directive("patientDetail",function(){return{restrict:"EA",scope:{options:"=",isClose:"@",patient:"=",params:"=",onsuccess:"=",actionCenter:"="},templateUrl:"modules/patient/directives/templates/detail.html",controller:"PatientDetailMasterController"}}).directive("patientRegister",function(){return{restrict:"EA",scope:{options:"=",params:"=",actionCenter:"="},templateUrl:"modules/patient/directives/templates/detail-register.html",controller:"PatientDetailMasterController"}}),angular.module("app.loggedIn.patient.waiting_list.directive",[]).directive("mdtWaitingList",function(WaitingListModel,PatientService,toastr,$cookieStore){return{restrict:"EA",scope:{options:"=",isClose:"@"},templateUrl:"modules/patient/directives/templates/waiting_list.html",link:function(scope,element,attrs){var initObject=function(){scope.modelObjectMap=angular.copy(WaitingListModel),scope.modelObjectMap.Last_updated_by=$cookieStore.get("userInfo").id,scope.modelObjectMap.Created_by=$cookieStore.get("userInfo").id,scope.isSubmit=!1,scope.selectedDoctor={},scope.selectedDoctor.NAME="Select Doctor",scope.selectedDoctor.error=!0,scope.selectedPatient={},scope.selectedPatient.First_name="Select",scope.selectedPatient.Sur_name="Patient",scope.selectedPatient.error=!0};if(initObject(),scope.isClose)var idClose="#"+scope.isClose;var idSearchDoctor="#searchDoctor",idSearchPatient="#searchPatient";scope.mode={type:"add",text:"Add Waiting List"},scope.closePopup=function(){angular.element(idClose).fadeOut()},scope.selectDoctor=function(row){angular.extend(scope.selectedDoctor,row),scope.selectedDoctor.error=!1,angular.element(idSearchDoctor).fadeOut()},scope.clickDoctor=function(){angular.element(idSearchDoctor).fadeIn()},scope.selectPatient=function(row){angular.extend(scope.selectedPatient,row),scope.selectedPatient.error=!1,angular.element(idSearchPatient).fadeOut()},scope.clickPatient=function(){angular.element(idSearchPatient).fadeIn()},scope.clickAction=function(){if(scope.isSubmit=!0,!scope.waitingForm.$invalid&&!scope.selectedPatient.error&&!scope.selectedDoctor.error){var postData=angular.copy(scope.modelObjectMap);postData.doctor_id=scope.selectedDoctor.doctor_id,postData.Patient_id=scope.selectedPatient.Patient_id,"add"===scope.mode.type&&PatientService.mdtInsertWaitingList(postData).then(function(response){"success"===response.status&&(toastr.success("Insert Successfully","Success"),initObject(),scope.isClose&&scope.closePopup())},function(error){console.log("Server Error")})}}}}}),angular.module("app.loggedIn.patient.claim.directive",[]).directive("patientClaim",function(PatientService,ClaimService,ClaimModel,ConfigService,toastr,Restangular,InsurerService,$cookieStore,CompanyService){return{restrict:"EA",scope:{options:"=",isClose:"@",params:"=",claim:"="},templateUrl:"modules/patient/directives/templates/claim.html",link:function(scope,element,attrs){var patient_id=scope.params.Patient_id;scope.$watch("patientId",function(newPatientId){}),scope.$watch("params.permission.edit",function(){scope.params.permission.edit===!0&&(scope.mode={type:"edit",text:"Edit Claim"},loadInit())});var loadInit=function(){scope.params.permission.edit===!0&&PatientService.getClaim(scope.params.permission.Claim_id).then(function(response){if("success"===response.status){angular.extend(scope.modelObjectMap,response.data);for(var key in scope.modelObjectMap)scope.modelObjectMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is"))&&(scope.modelObjectMap[key]=scope.modelObjectMap[key].toString()),-1!=key.indexOf("_date")&&(scope.modelObjectMap[key]=new Date(scope.modelObjectMap[key])))}})},getInsurerInfo=function(){PatientService.mdtById(patient_id).then(function(response){"success"===response.status&&(null!==response.data.company_id&&void 0!==response.data.company_id&&""!==response.data.company_id?CompanyService.mdtById(response.data.company_id).then(function(response2){null!==response2.data.Insurer&&void 0!==response2.data.Insurer&&""!==response2.data.Insurer?InsurerService.detail(response2.data.Insurer).then(function(insurerData){null!==insurerData.row&&void 0!==insurerData.row&&""!==insurerData.row?(scope.modelObjectMap.insurer_site=insurerData.row.id,scope.modelObjectMap.Insurer=insurerData.row.insurer_name):(scope.modelObjectMap.insurer_site="",scope.modelObjectMap.Insurer="")}):(scope.modelObjectMap.insurer_site="",scope.modelObjectMap.Insurer="")}):(scope.modelObjectMap.insurer_site="",scope.modelObjectMap.Insurer=""))})};if(getInsurerInfo(),scope.isClose)var idClose="#"+scope.isClose;angular.element(idClose).fadeIn(),scope.isSubmit=!1,scope.modelObjectMap=angular.copy(ClaimModel),scope.modelObjectMap.Patient_id=patient_id,scope.modelObjectMap.insurer_site=scope.insurerId,scope.mode={type:"add",text:"Add Claim"},scope.closePopup=function(){angular.element(idClose).fadeOut(),scope.params.permission.edit=!1,scope.mode={type:"add",text:"Add Claim"};var patientid=scope.modelObjectMap.Patient_id;scope.modelObjectMap={},scope.isSubmit=!1,scope.modelObjectMap.Patient_id=patientid,scope.modelObjectMap.insurer_site=scope.insurerId,scope.modelObjectMap.Claim_date=new Date,void 0===scope.params.addClaimShow?getInsurerInfo():scope.params.addClaimShow=!1},scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.claimForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));if("add"==option.type){postData.Created_by=$cookieStore.get("userInfo").id;var CAL_ID=11;console.log("ssaasas"),PatientService.insertClaim(postData,scope.modelObjectMap.Patient_id,CAL_ID).then(function(response){"success"===response.status&&(toastr.success("Added a new Claim","Success"),scope.modelObjectMap=angular.copy(ClaimModel),scope.isSubmit=!1,scope.claim=response.data,scope.modelObjectMap=angular.copy(ClaimModel),getInsurerInfo(),scope.modelObjectMap.Patient_id=patient_id,scope.modelObjectMap.Claim_date=new Date,scope.modelObjectMap.insurer_site=scope.insurerId)})}else postData.Last_updated_by=$cookieStore.get("userInfo").id,PatientService.editClaim(postData).then(function(response){"success"===response.status&&(toastr.success("Edited a new Claim","Success"),scope.isSubmit=!1,angular.element(idClose).fadeOut(),scope.params.permission.edit=!1,scope.mode={type:"add",text:"Add Claim"},scope.modelObjectMap=angular.copy(ClaimModel),getInsurerInfo(),scope.modelObjectMap.Patient_id=patient_id,scope.modelObjectMap.Claim_date=new Date,scope.modelObjectMap.insurer_site=scope.insurerId)})}}}}}),angular.module("app.loggedIn.patient.outside_referral.directive",[]).directive("patientOutsideReferral",function(PatientService,OutsideReferralModel){return{restrict:"EA",scope:{data:"@",options:"="},templateUrl:"modules/patient/directives/templates/outside_referral.html",link:function(scope,element,attrs){if(scope.data)var data=scope.$eval(scope.data);scope.isSubmit=!1,scope.modelObjectMap=angular.copy(OutsideReferralModel),scope.mode={type:"add",text:"Add Outside Referral"},scope.modelObjectMap.Patient_id=data.Patient_id,scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.outsideReferralForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?PatientService.insertClaim(postData).then(function(response){"success"===response.status&&(toastr.success("Added a new Claim","Success"),scope.modelObjectMap=angular.copy(ClaimModel),scope.modelObjectMap.Patient_id=data.Patient_id,scope.isSubmit=!1)}):PatientService.editClaim(postData).then(function(response){"success"===response.status&&(toastr.success("Edited a new Claim","Success"),loadInit(),scope.isSubmit=!1)})}}}}}),angular.module("app.loggedIn.patient.search.directive",[]).directive("patientSearch",function(PatientService){return{restrict:"EA",scope:{clickRow:"&",isClose:"@"},templateUrl:"modules/patient/directives/templates/search.html",link:function(scope,element,attrs){if(scope.list={},scope.isClose)var idClose="#"+scope.isClose;scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"First_name",value:""},{type:"text",name:"Sur_name",value:""}],select:["Patient_id","First_name","Sur_name","company_id"]},scope.closePopup=function(){angular.element(idClose).fadeOut()};var loadList=function(){PatientService.mdtSearch(scope.params).then(function(response){"success"===response.status&&(scope.list=response)},function(error){alert("Error Server")})};loadList(),scope.refreshList=function(){loadList()},scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,
loadList()}}}}).directive("patientSearchByCompany",function(PatientService){return{restrict:"EA",scope:{clickRow:"&",isClose:"@",companyId:"="},templateUrl:"modules/patient/directives/templates/search.html",link:function(scope,element,attrs){if(scope.list={},scope.isClose)var idClose="#"+scope.isClose;scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"First_name",value:""},{type:"text",name:"Sur_name",value:""},{type:"text",name:"company_id",value:0}],select:["Patient_id","First_name","Sur_name","company_id"]},scope.$watch("companyId",function(companyId){console.log(companyId),scope.params.filters[2].value=companyId,scope.refreshList()}),scope.closePopup=function(){angular.element(idClose).fadeOut()};var loadList=function(){PatientService.mdtSearch(scope.params).then(function(response){"success"===response.status&&(scope.list=response)},function(error){alert("Error Server")})};scope.refreshList=function(){loadList()},scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.patient.companies.directive",[]).directive("patientCompanies",function(PatientService,OutsideReferralModel,toastr){return{restrict:"EA",scope:{data:"@"},template:'<my-data-table options="data_options" rowclass="set_row_class" rowclick="row_click">',controller:function($scope){var data=$scope.$eval($scope.data);if(data&&data.Patient_id){var active_item=null;$scope.set_row_class=function(item){return"active"==item.active&&(active_item=item),"active"==item.active?"success":""},$scope.row_click=function(item){if(item.id!=active_item.id){var yes=confirm("Set this company active for patient ??? ");yes&&PatientService.update({Patient_id:data.Patient_id,company_id:item.id}).then(function(response){"success"==response.status&&(item.active="active",active_item.active="inactive",toastr.success("Save Successfully!!!","Success")),console.log(response)})}},$scope.data_options={api:"api/erm/v2/patients/companies",method:"post",columns:[{field:"companies.id",is_hide:!0},{field:"Company_name",label:"Company Name"},{field:"Industry"},{field:"Addr",label:"Address"},{field:"Country",db_field:"companies.Country"},{field:"active",label:"Active",is_hide:!0,not_submit:!0}],search:{Patient_id:data.Patient_id}}}}}}),angular.module("app.loggedIn.patient.ngthumb.directive",[]).directive("ngThumb",["$window",function($window){var helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}};return{restrict:"A",template:"<canvas/>",link:function(scope,element,attributes){function onLoadFile(event){var img=new Image;img.onload=onLoadImage,img.src=event.target.result}function onLoadImage(){var width=params.width||this.width/this.height*params.height,height=params.height||this.height/this.width*params.width;canvas.attr({width:width,height:height}),canvas[0].getContext("2d").drawImage(this,0,0,width,height)}if(helper.support){var params=scope.$eval(attributes.ngThumb);if(helper.isFile(params.file)&&helper.isImage(params.file)){var canvas=element.find("canvas"),reader=new FileReader;reader.onload=onLoadFile,reader.readAsDataURL(params.file)}}}}}]),angular.module("app.loggedIn.patient.controller",["app.loggedIn.patient.list.controller","app.loggedIn.patient.home.controller","app.loggedIn.patient.search.controller","app.loggedIn.patient.action.controller","app.loggedIn.patient.booking.controller","app.loggedIn.patient.detail.controller","app.loggedIn.patient.recall.controller","app.loggedIn.patient.outside_referrals.controller","app.loggedIn.patient.referrals.controller","app.loggedIn.patient.appointment.controller","app.loggedIn.patient.companies.controller","app.loggedIn.patient.workcover.controller","app.loggedIn.patient.itemsheet.controller","app.loggedIn.patient.invoices.controller","app.loggedIn.patient.invoice_detail.controller","app.loggedIn.patient.appt.controller","app.loggedIn.patient.apptdoc.controller","app.loggedIn.patient.checkin.controller","app.loggedIn.patient.detail.master.controller"]).controller("PatientController",function($scope,$cookieStore,ConfigService,PatientService,MODE_ROW,$stateParams,mdtAppointmentService){$scope.patient_id=$stateParams.patient_id,$scope.cal_id=$stateParams.cal_id,$scope.search={},$scope.search.Patient_id=$scope.patient_id,$scope.patientBarVer={},$scope.patientBarVer.version="zip",$scope.$on("$stateChangeStart",function(e,toState,toParams,fromState,fromParams){toState.name.indexOf("loggedIn.patient")>-1&&($scope.patientBarVer.version="zip")}),$scope.patient_detail_modules=[{wrap:0,name:"Patient",color:"blue-soft",desc:"Info",icon:"fa fa-user",state:"loggedIn.patient.detail"},{wrap:0,name:"Companies",color:"red-soft",desc:"Total: 0",icon:"fa fa-building",state:"loggedIn.patient.company"},{wrap:0,name:"Claim",color:"green-soft",desc:"Available",icon:"fa fa-newspaper-o",state:"loggedIn.patient.claim.list"},{wrap:0,name:"Alert",color:"green-soft",desc:"Available",icon:"fa fa-newspaper-o",state:"loggedIn.patient.alert.list({patientId:"+$stateParams.patient_id+", calId:"+$stateParams.cal_id+"})"},{wrap:0,name:"Referral",color:"purple-soft",desc:"Total: 0",icon:"fa fa-envelope-o",state:"loggedIn.patient.outreferral.list({patientId:"+$stateParams.patient_id+", calId:"+$stateParams.cal_id+"})"},{wrap:1,name:"Consultation",icon:"fa fa-user-md",color:"purple-soft",desc:"",state:"loggedIn.patient.consult({patient_id:"+$stateParams.patient_id+", cal_id:"+$stateParams.cal_id+"})"},{wrap:0,name:"Problem List",color:"red-soft",icon:"fa fa-exclamation-triangle",state:"loggedIn.patient.problem_list"},{wrap:0,name:"Allergy list",color:"green-soft",icon:"fa fa-exclamation-triangle",state:"loggedIn.patient.allergy.list"}],$scope.patient_apt_modules=[{wrap:1,name:"ItemSheet",icon:"fa fa-bookmark-o",color:"blue-soft",desc:"Info",state:"loggedIn.patient.itemsheet"},{wrap:0,name:"Invoices",icon:"fa fa-money",color:"red-soft",desc:"Total: 0",state:"loggedIn.patient.invoices"},{wrap:1,name:"Appointment List",icon:"fa fa-repeat",color:"green-soft",desc:"Total: 0",state:"loggedIn.patient.appt"},{wrap:1,name:"Recall",color:"blue-soft",desc:"Recall",icon:"fa fa-repeat",state:"loggedIn.patient.recall"}],$scope.current_patient={},$scope.getPatientInfo=function(){PatientService.mdtById($scope.patient_id).then(function(response){$scope.current_patient=response.data,$scope.current_patient.company=response.company;for(var key in $scope.current_patient)$scope.current_patient[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is"))&&($scope.current_patient[key]=$scope.current_patient[key].toString()),(-1!=key.indexOf("_date")||-1!=key.indexOf("DOB")||-1!=key.indexOf("Exp"))&&($scope.current_patient[key]=new Date($scope.current_patient[key])));$scope.current_patient.Title=parseInt($scope.current_patient.Title),-1!=$stateParams.cal_id&&mdtAppointmentService.byId($scope.cal_id).then(function(response){"error"==response.status?toastr.error("Error Get Detail","Error"):($scope.current_patient.Site_name=response.data.site.Site_name,$scope.current_patient.FROM_TIME=response.data.FROM_TIME)})})},$scope.getPatientInfo(),$scope.setListAllergy=function(){PatientService.getListAllergyinPatient($scope.search).then(function(data){"success"==data.status&&($scope.listAllergyinPAtient=data.list)})},$scope.setListAllergy(),$scope.searchObject={doctor_id:0,limit:5,offset:0,maxSize:5,currentPage:1,data:{First_name:"",Sur_name:"",Middle_name:"",Post_code:null}},$scope.rows=MODE_ROW,$scope.modelObject={Title:"Mr",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:null,Country:"AU",DOB:"",Sex:"Male",Home_phone:null,Work_phone:null,Mobile:null,No_SMS:"0",Account_type:"",Account_holder:"",Account_Seft:null,Medicare_no:null,Ref:null,Exp_medicare:"",Private_fund_id:"",MemberShip_no:null,UPI:null,HCC_Pension_No:null,Exp_pension:"",DVA_No:null,Balance:null,Pays_Gap_Only:"1",Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:null},$scope.mode="search"}),angular.module("app.loggedIn.patient.list.controller",[]).controller("PatientListController",function($scope,$state,$cookieStore,PatientService,DoctorService){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.list=[],$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.loadList()},$scope.loadList=function(){DoctorService.getByUserId($cookieStore.get("userInfo").id).then(function(data){data&&($scope.searchObjectMap.doctor_id=data.doctor_id,PatientService.search($scope.searchObjectMap).then(function(response){$scope.list=response}))})},$scope.loadList(),$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.goToTimetableDetail=function(list){$cookieStore.put("patientTempInfo",list),$state.go("loggedIn.patient.booking")}}),angular.module("app.loggedIn.patient.appointment.controller",[]).controller("PatientAppointmentController",function($scope,DoctorService,sysServiceService,TimetableModel,$state,toastr,$stateParams,PatientService,ConfigService,ReceptionistService,OutreferralModel,AlertModel,$cookieStore,rlobService){var patient_id=$scope.patient_id=$stateParams.patient_id;$scope.cal_id=$stateParams.cal_id,$scope.dataAlert=[];var alertPostData={Patient_id:$stateParams.patient_id,CAL_ID:$stateParams.cal_id,page:1,limit:10,offset:0,max_size:5,name:"",description:"",Creation_date:"desc",isenable:""};AlertModel.listFollowPatient(alertPostData).then(function(response){_.forEach(response.data,function(id){$scope.dataAlert.push(id.name)})},function(error){});var user_id=$cookieStore.get("userInfo").id;PatientService.getDoctorInfoByUserId(user_id).then(function(data){"success"==data.status&&($scope.doctorId=data.data.doctor_id,$scope.clinicalDeptId=data.data.CLINICAL_DEPT_ID,sysServiceService.byClinicalDepartment($scope.clinicalDeptId).then(function(response){$scope.options.clinical_depts=response.data}))}),$scope.submitCalendar=function(){if($scope.isSubmit=!0,!$scope.appointForm.$invalid){var from_time_part=moment($scope.from_time,"HHmm").format("HH:mm"),to_time_part=moment($scope.to_time,"HHmm").format("HH:mm");if("Invalid date"===moment($scope.from_time,"HHmm").format("HH:mm"))return void toastr.error("From time format error");if("Invalid date"===moment($scope.to_time,"HHmm").format("HH:mm"))return void toastr.error("To time format error");var from_time=moment(new Date).format("YYYY-MM-DD")+" "+from_time_part+":00",to_time=moment(new Date).format("YYYY-MM-DD")+" "+to_time_part+":00",postData={FROM_TIME:from_time,TO_TIME:to_time,SITE_ID:$scope.site_id,DOCTOR_ID:$scope.doctorId,CLINICAL_DEPT_ID:$scope.clinicalDeptId,SERVICE_ID:$scope.service_Id};DoctorService.addCalendar(postData).then(function(response){toastr.success("Add successfully !!!"),$scope.cal_id=response.data,rlobService.addApptPatient($scope.patient_id,response.data).then(function(data){"success"==data.status&&(angular.element("#popupNewAppoint").modal("hide"),angular.element("#popupNewAppoint").on("hidden.bs.modal",function(e){initObject(),$scope.changeAppt({CAL_ID:$scope.cal_id})}))})},function(err){})}},$scope.newAppoint=function(){angular.element("#popupNewAppoint").modal("show")};var outPostData={patient_id:$scope.patient_id,CAL_ID:$scope.cal_id};OutreferralModel.checkPatientCalendar(outPostData).then(function(response){0===response.data&&1===response.service.IS_REFERRAL&&($scope.warning_refferal=!0)},function(error){}),$scope.changeAppt=function(item){$state.go("loggedIn.patient.appointment",{patient_id:patient_id,cal_id:item.CAL_ID})},$scope.classAppt=function(item){switch(item.APP_TYPE){case"ChangePersonInCharge":return"badge-danger";case"NotYet":case"Billing":return"badge-warning";case"Done":return"badge-success";default:return"badge-default"}};var initObject=function(){$scope.appt_params={id:$scope.cal_id,permission:{edit:!0}},PatientService.getAppointments(patient_id).then(function(response){$scope.list_appt=response.data.appointments;var current_appt=null;angular.forEach($scope.list_appt,function(item){item.CAL_ID==$scope.cal_id&&(current_appt=item)})},function(error){})};initObject()}),angular.module("app.loggedIn.patient.companies.controller",[]).controller("PatientCompaniesController",function($scope,$state,$stateParams,toastr,PatientService){$scope.current_patient={};var patient_id=$stateParams.patient_id;$scope.patient={Patient_id:patient_id},$scope.updateCompany=function(company){PatientService.update({Patient_id:$scope.patient.Patient_id,company_id:company.id}).then(function(data){"success"==data.status&&(toastr.success("Save Successfully!!!","Success"),$scope.reloadpage()),console.log(data)})},$scope.company_search_options={api:"api/erm/v2/companies/search",method:"post",columns:[{field:"id",is_hide:!0},{field:"Company_name",label:"Company Name"},{field:"Industry"}],use_filters:!0,filters:{Company_name:{type:"text"},Industry:{type:"text"}}},$scope.chooseCompany=function(item){console.log(item),$scope.updateCompany(item)},$scope.show_company_form=!1,$scope.show_company_search=!1,$scope.openCompanySearch=function(){$scope.show_company_search=!0},$scope.closeCompanySearch=function(){$scope.show_company_search=!1},$scope.openCompanyForm=function(){$scope.show_company_form=!0},$scope.closeCompanyForm=function(){$scope.show_company_form=!1}}),angular.module("app.loggedIn.patient.recall.controller",[]).controller("PatientRecallController",function($scope,$state,$stateParams,$cookieStore,PatientService,DoctorService,ConfigService){var patient_id=$stateParams.patient_id,recall_panel={};$scope.recall_opt={api:"api/erm/v2/patients/recall_search",scope:recall_panel,method:"post",columns:[{field:"recall_id",is_hide:!0},{field:"notes",label:"Document Name"},{field:"transaction_date",label:"Transaction Date",type:"custom",fn:function(item){return item.transaction_date?ConfigService.getCommonDateDefault(item.transaction_date):""}},{field:"recall_date",label:"Recall Date",type:"custom",fn:function(item){return item.recall_date?ConfigService.getCommonDateDefault(item.recall_date):""}},{field:"recall_period",label:"Recall Period",type:"custom",fn:function(item){return item.recall_period<=1?item.recall_period+" month":item.recall_period+" months"}},{field:"remind_before",label:"Remind Before",type:"custom",fn:function(item){return item.remind_before<=1?item.remind_before+" month":item.remind_before+" months"}}],search:{patient_id:patient_id}};var userInfo=$cookieStore.get("userInfo");$scope.params_add={permission:{create:!0,edit:!1},patient_id:patient_id,created_by:userInfo.id},$scope.params_edit={permission:{create:!1,edit:!0},id:0,last_updated_by:userInfo.id},$scope.addForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1}},$scope.actionCenter={updateRecall:function(){}},$scope.rowClick=function(item){$scope.params_edit.id=item.recall_id,$scope.actionCenter.updateRecall(),$scope.editForm.open()},$scope.actionSuccess=function(){$scope.addForm.close(),$scope.editForm.close(),recall_panel.reload()},$scope.editForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1}}}),angular.module("app.loggedIn.patient.invoices.controller",[]).controller("PatientInvoicesController",function($scope,$state,$stateParams,PatientService,ConfigService){var patient_id=$stateParams.patient_id;$scope.patient_id=patient_id;var cal_id=$stateParams.cal_id;$scope.cal_id=cal_id,$scope.invoicePanel={},$scope.invoiceClick=function(item){$state.go("loggedIn.patient.invoice_detail",{header_id:item.header_id})},$scope.invoiceClass=function(item){return{warning:"approach"==item.STATUS,success:"done"==item.STATUS,danger:"enter"==item.STATUS||null==item.STATUS,selected:item.cal_id==cal_id}},$scope.invoiceOption={api:"api/erm/v2/invoice/search",method:"post",scope:$scope.invoicePanel,columns:[{field:"header_id",order:"DESC",is_hide:!0},{field:"cal_id",is_hide:!0},{field:"STATUS",is_hide:!0},{field:"Company_id",label:"Company",type:"custom",fn:function(item){return item.company?item.company.Company_name:void 0}},{field:"cal_id",label:"From Time",type:"custom",fn:function(item){return item.appointment.FROM_TIME?ConfigService.getCommonDatetime(item.appointment.FROM_TIME):void 0}},{field:"cal_id",label:"To Time",type:"custom",fn:function(item){return item.appointment.TO_TIME?ConfigService.getCommonDatetime(item.appointment.TO_TIME):void 0}},{field:"Insurer_id",label:"Insurer",type:"custom",fn:function(item){return item.insurer?item.insurer.insurer_name:void 0}},{field:"DOCTOR_ID",label:"Doctor",type:"custom",fn:function(item){return item.doctor?item.doctor.NAME:void 0}},{field:"SITE_ID",label:"Site",type:"custom",fn:function(item){return item.site?item.site.Site_name:void 0}},{field:"SERVICE_ID",label:"Service",type:"custom",fn:function(item){return item.service?item.service.SERVICE_NAME:void 0}},{field:"CREATION_DATE",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.CREATION_DATE)}}],search:{patient_id:patient_id,cal_id:cal_id}},$scope.addFormInvoice={open:function(){$modal.open({templateUrl:"popupDoctorSearch",controller:function($scope,$modalInstance){},size:"lg"})},success:function(){$scope.addFormInvoice.close(),$scope.invoicePanel.reload()}}}),angular.module("app.loggedIn.patient.invoice_detail.controller",[]).controller("PatientInvoiceDetailController",function($scope,$state,$stateParams,toastr,PatientService,ConfigService){var header_id=$stateParams.header_id;$scope.invoiceOpt={permission:{edit:!0},id:header_id},$scope.invoiceSave=function(){PatientService.invoiceSave(header_id).then(function(response){toastr.success("Save successfully !!!","Success")})},PatientService.invoiceDetail(header_id).then(function(response){$scope.invoice=response.data,$scope.invoice.lines=$scope.invoice.lines.filter(function(item){return 1==item.IS_ENABLE});for(var i=0,len=$scope.invoice.lines.length;len>i;++i){var line=$scope.invoice.lines[i];$scope.invoice.AMOUNT+=line.AMOUNT}})}),angular.module("app.loggedIn.patient.home.controller",[]).controller("PatientHomeController",function($scope,$state){}),angular.module("app.loggedIn.patient.search.controller",[]).controller("PatientSearchController",function($scope,ConfigService,PatientService){$scope.search_map={limit:10,offset:0,maxSize:5,currentPage:1,data:{Title:"",First_name:"",Middle_name:"",Sur_name:"",DOB:""},ORDER_BY:"Sur_name ASC"},$scope.list={},$scope.loadList=function(){PatientService.getByOption({search:$scope.search}).then(function(data){for(var i=0,len=data.list.length;len>i;++i)data.list[i].DOB&&(data.list[i].DOB=ConfigService.getCommonDate(data.list[i].DOB));$scope.list.results=data.list})};var init=function(){$scope.search=angular.copy($scope.search_map),$scope.sexIndex=[{code:"Female"},{code:"Male"}],$scope.pagingIndex=[{code:10},{code:20},{code:50}],$scope.loadList(),PatientService.getTotals().then(function(data){$scope.list.count=data.count})};init(),$scope.setPage=function(){$scope.search.offset=($scope.search.currentPage-1)*$scope.search.limit,$scope.loadList()}}),angular.module("app.loggedIn.patient.add.controller",[]).controller("PatientAddController",function($scope,$state,toastr,ConfigService,PatientService,items){items.scope,$scope.patientObj={Title:"",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:"",Country:"Australia",DOB:"",Sex:"",Home_phone:"",Work_phone:"",Mobile:"",No_SMS:1,Account_type:"",Account_holder:"",Account_Seft:"",Medicare_no:"",Ref:"",Exp_medicare:"",Private_fund_id:"",MemberShip_no:"",UPI:"",HCC_Pension_No:"",Exp_pension:"",DVA_No:"",Balance:"",Pays_Gap_Only:1,Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:""},$scope.initForm=function(resetCall){resetCall&&resetCall(),$scope.titleIndex=ConfigService.get_title_name(),$scope.countryIndex=ConfigService.get_country_list(),$scope.sexIndex=ConfigService.get_sex_list(),$scope.smsIndex=$scope.payGapIndex=ConfigService.get_yes_no_opt(),PatientService.listAccType().then(function(data){return"success"!=data.status?void alert("error"):void($scope.accTypeIndex=data.list)}),PatientService.listPrvFund().then(function(data){return"success"!=data.status?void alert("error"):void($scope.fundIndex=data.list)})};var reset=function(){$scope.patient=angular.copy($scope.patientObj),$scope.isSubmit=!1};$scope.reset=reset;var init=function(){$scope.formMode="Add",reset(),$scope.initForm(reset)};$scope.submit=function(patientForm){return $scope.isSubmit=!0,patientForm.$invalid?void toastr.error("Please Check Your Information!","Error"):void PatientService.insertPatient({patient:$scope.patient}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),void toastr.success("Insert Successfully !!!","Success"))})},init()}),angular.module("app.loggedIn.patient.action.controller",[]).controller("PatientActionController",function($scope,$modalInstance,toastr,ConfigService,PatientService,ReceptionistService,DoctorService,items){$scope.mode="search",$scope.modelObject={Title:"Mr",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:null,Country:"AU",DOB:"",Sex:"Male",Home_phone:null,Work_phone:null,Mobile:null,No_SMS:"0",Account_type:"",Account_holder:"",Account_Seft:null,Medicare_no:null,Ref:null,Exp_medicare:"",Private_fund_id:"",MemberShip_no:null,UPI:null,HCC_Pension_No:null,Exp_pension:"",DVA_No:null,Balance:null,Pays_Gap_Only:"1",Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:null},$scope.options={titles:ConfigService.title_option(),sexes:ConfigService.sex_option(),sms:ConfigService.yes_no_option(),countries:ConfigService.country_option(),gaps:ConfigService.yes_no_option()},$scope.step=1,$scope.isSubmit=!1;var reset=function(){$scope.step=1,$scope.modelObjectMap=angular.copy($scope.modelObject)};$scope.nextStep=function(form){switch($scope.isSubmit=!0,$scope.step){case 1:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.step++,$scope.isSubmit=!1);break;case 2:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.step++,$scope.isSubmit=!1);break;case 3:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.modelObjectMap.DOB=ConfigService.getCommonDateDatabase($scope.modelObjectMap.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_pension),null!==items.bookingObject.Patient_id?PatientService.updatePatient({patient:$scope.modelObjectMap}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),toastr.success("Edit Successfully !!!","Success"),void $modalInstance.close({patientId:items.patient.Patient_id}))}):PatientService.insertPatient({patient:$scope.modelObjectMap}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),$scope.modelObjectBookingMap.Patient_id=data.data.Patient_id,ReceptionistService.booking($scope.modelObjectBookingMap).then(function(data){$modalInstance.close("OK")}),void toastr.success("Insert Successfully !!!","Success"))}),$scope.isSubmit=!1)}},$scope.backStep=function(){$scope.step>1&&$scope.step--},$scope.modelObjectMap={};var init=function(){angular.extend($scope.modelObject,items.patient),$scope.modelObjectMap=angular.copy($scope.modelObject),items.patient&&($scope.modelObjectMap.DOB=ConfigService.convertToDate(items.patient.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.convertToDate(items.patient.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.convertToDate(items.patient.Exp_pension),$scope.modelObjectMap.Home_phone=parseInt($scope.modelObjectMap.Home_phone),$scope.modelObjectMap.Work_phone=parseInt($scope.modelObjectMap.Work_phone),$scope.modelObjectMap.Mobile=parseInt($scope.modelObjectMap.Mobile),$scope.modelObjectMap.Account_Seft=parseInt($scope.modelObjectMap.Account_Seft),$scope.modelObjectMap.MemberShip_no=parseInt($scope.modelObjectMap.MemberShip_no),$scope.modelObjectMap.HCC_Pension_No=parseInt($scope.modelObjectMap.HCC_Pension_No),$scope.modelObjectMap.UPI=parseInt($scope.modelObjectMap.UPI),$scope.modelObjectMap.DVA_No=parseInt($scope.modelObjectMap.DVA_No),$scope.modelObjectMap.Balance=parseInt($scope.modelObjectMap.Balance),$scope.modelObjectMap.Ref=parseInt($scope.modelObjectMap.Ref),$scope.modelObjectMap.Post_code=parseInt($scope.modelObjectMap.Post_code)),PatientService.listAccType().then(function(data){return"success"!=data.status?void alert("error"):void($scope.accTypeIndex=data.list)}),PatientService.listPrvFund().then(function(data){return"success"!=data.status?void alert("error"):void($scope.fundIndex=data.list)})};init(),$scope.search_map={limit:10,offset:0,maxSize:5,currentPage:1,data:{Title:"",First_name:"",Middle_name:"",Sur_name:"",DOB:""},ORDER_BY:"Sur_name ASC"},$scope.list={},$scope.loadList=function(){PatientService.getByOption({search:$scope.search}).then(function(data){for(var i=0,len=data.list.length;len>i;++i)data.list[i].DOB&&(data.list[i].DOB=ConfigService.getCommonDate(data.list[i].DOB));$scope.list.results=data.list})};var initSearch=function(){$scope.search=angular.copy($scope.search_map),$scope.sexIndex=[{code:"Female"},{code:"Male"}],$scope.pagingIndex=[{code:10},{code:20},{code:50}],$scope.loadList(),PatientService.getTotals().then(function(data){$scope.list.count=data.count})};initSearch(),$scope.setPage=function(){$scope.search.offset=($scope.search.currentPage-1)*$scope.search.limit,$scope.loadList()},$scope.goToBooking=function(list){$scope.modelObjectBookingMap.Patient_id=list.Patient_id,ReceptionistService.booking($scope.modelObjectBookingMap).then(function(data){$modalInstance.close("OK")})},$scope.modelObjectBooking=items.bookingObject,$scope.modelObjectBookingMap={},angular.extend($scope.options,items.options),ReceptionistService.getById(items.cal_id).then(function(response){angular.extend($scope.modelObjectBooking,response),$scope.modelObjectBookingMap=angular.copy($scope.modelObjectBooking),DoctorService.getById($scope.modelObjectBookingMap.DOCTOR_ID).then(function(doctor){$scope.modelObjectBookingMap.DOCTOR_NAME=doctor.NAME});for(var i=0;i<items.options.redimedsites.length;i++)items.options.redimedsites[i].id===$scope.modelObjectBookingMap.SITE_ID&&($scope.modelObjectBookingMap.SITE_NAME=items.options.redimedsites[i].Site_name);for(var i=0;i<items.options.dept.length;i++)items.options.dept[i].CLINICAL_DEPT_ID===$scope.modelObjectBookingMap.CLINICAL_DEPT_ID&&($scope.modelObjectBookingMap.CLINICAL_DEPT_NAME=items.options.dept[i].CLINICAL_DEPT_NAME);ConfigService.system_service_by_clinical($scope.modelObjectBookingMap.CLINICAL_DEPT_ID).then(function(list){items.options.services=list}),null!==response.Patient_id&&PatientService.getPatient(response.Patient_id).then(function(data){$scope.modelObjectBookingMap.PATIENT=data.data[0]}),items.data.from_time_map?($scope.modelObjectBookingMap.from_time_map=items.data.from_time_map,$scope.modelObjectBookingMap.to_time_map=items.data.to_time_map):($scope.modelObjectBookingMap.from_time=items.data.from_time,$scope.modelObjectBookingMap.from_time_map=ConfigService.convertToTimeString(items.data.from_time),$scope.modelObjectBookingMap.to_time=items.data.to_time,$scope.modelObjectBookingMap.to_time_map=ConfigService.convertToTimeString(items.data.to_time))})}),angular.module("app.loggedIn.patient.booking.controller",[]).controller("PatientBookingController",function($scope,$state,$cookieStore,ReceptionistService,ConfigService,PatientService,toastr){$scope.modelObjectBookingMap={},$scope.bookingPatientInfo={};var init=function(){$scope.bookingPatientInfo=$cookieStore.get("patientBookingInfo").data,$scope.bookingPatientInfo.datepicker=ConfigService.getCommonDateDefault($scope.bookingPatientInfo.datepicker),ReceptionistService.getById($cookieStore.get("patientBookingInfo").cal_id).then(function(data){angular.extend($scope.modelObjectBookingMap,data),ConfigService.system_service_by_clinical($scope.modelObjectBookingMap.CLINICAL_DEPT_ID).then(function(list){$scope.options.services=list,$scope.modelObjectBookingMap.SERVICE_ID=list[0].SERVICE_ID,$scope.modelObjectBookingMap.ACC_TYPE=$scope.options.acc_types[0].code,$scope.modelObjectBookingMap.APP_TYPE=$scope.options.app_types[0].code,$scope.modelObjectBookingMap.bill_to="1",$scope.modelObjectBookingMap.ARR_TIME="00:00",$scope.modelObjectBookingMap.ATTEND_TIME="00:00"})})};init(),$scope.getActive=function(state){return state===$state.current.name?"active":""},$scope.step=1,$scope.label_step="Next",$scope.prevStep=function(){$scope.step>1&&($scope.label_step="Next",$scope.step--)},$scope.nextStep=function(){switch($scope.step){case 1:$scope.step=2,$scope.label_step="";break;case 2:$state.go("loggedIn.patient.booking.search")}},$scope.list=[],$scope.loadList=function(){PatientService.getByOption({search:$scope.search}).then(function(data){for(var i=0,len=data.list.length;len>i;++i)data.list[i].DOB&&(data.list[i].DOB=ConfigService.getCommonDate(data.list[i].DOB));$scope.list.results=data.list})};var initSearch=function(){$scope.search=angular.copy($scope.searchObject),$scope.sexIndex=[{code:"Female"},{code:"Male"}],$scope.pagingIndex=[{code:5},{code:10},{code:20},{code:50}],$scope.loadList(),PatientService.getTotals().then(function(data){$scope.list.count=data.count})};initSearch(),$scope.setPage=function(){$scope.search.offset=($scope.search.currentPage-1)*$scope.search.limit,$scope.loadList()},$scope.goToBooking=function(list){$scope.modelObjectBookingMap.Patient_id=list.Patient_id,ReceptionistService.booking($scope.modelObjectBookingMap).then(function(data){$state.go("loggedIn.receptionist.appointment")})};var init=function(){$scope.modelObjectMap=angular.copy($scope.modelObject)};init(),$scope.insert_step=1,$scope.isSubmit=!1;var reset=function(){$scope.insert_step=1,$scope.modelObjectMap=angular.copy($scope.modelObject)};$scope.insertNextStep=function(form){switch($scope.isSubmit=!0,$scope.insert_step){case 1:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 2:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 3:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.modelObjectMap.DOB=ConfigService.getCommonDateDatabase($scope.modelObjectMap.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_pension),PatientService.insertPatient({patient:$scope.modelObjectMap}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),$scope.modelObjectBookingMap.Patient_id=data.data.Patient_id,ReceptionistService.booking($scope.modelObjectBookingMap).then(function(data){$state.go("loggedIn.receptionist.appointment")}),void toastr.success("Insert Successfully !!!","Success"))}),$scope.isSubmit=!1)}},$scope.insertBackStep=function(){$scope.insert_step>1&&$scope.insert_step--}}),angular.module("app.loggedIn.patient.detail.controller",[]).controller("PatientDetailController",function($scope,$state,$stateParams,PatientService,FileUploader){$scope.current_patient={},$scope.patientBarVer&&($scope.patientBarVer.version="null"),$scope.actionCenter={runWhenFinish:function(){$scope.getPatientInfo()}},$scope.params={permission:{create:!1,edit:!0},id:$stateParams.patient_id}}),angular.module("app.loggedIn.patient.detail.master.controller",[]).controller("PatientDetailMasterController",function($scope,$stateParams,$state,$modal,sysStateService,PatientService,ConfigService,toastr,PatientModel,FileUploader,$timeout,CompanyModel,InsurerService){
$scope.avt_path="";var uploader=$scope.uploader=new FileUploader({url:"/api/erm/v2/patient/upload_avt",autoUpload:!1,removeAfterUpload:!0,onAfterAddingFile:function(item){var arr=item.file.name.split("."),ext=arr[arr.length-1];"jpg"===ext||"jpeg"===ext||"png"===ext?this.queue.length>1&&this.queue.splice(0,1):(toastr.error("Only jpg, jpeg and png accepted","Invalid format!"),this.queue=[])},onCompleteItem:function(item,response,status,headers){"success"===response.status&&response.isEditMode===!0&&($scope.avt_path=response.img_path,console.log("replace success",$scope.avt_path),clickAction())}});if($stateParams.patient_id&&(uploader.formData[0]={patient_id:$stateParams.patient_id,file_name:(new Date).getTime(),editMode:!0}),$scope.openUploader=function(){$timeout(function(){$("#patient_photo_upload").click()},100)},$scope.isClose)var idClose="#"+$scope.isClose;$scope.loadState=function(){null!==$scope.modelObjectMap.Country&&sysStateService.list($scope.modelObjectMap.Country).then(function(response){$scope.options.states=response.data})},$scope.verifiedMedicare=function(){if(!isNaN(parseFloat($scope.modelObjectMap.Medicare_no))&&isFinite($scope.modelObjectMap.Medicare_no)&&10===$scope.modelObjectMap.Medicare_no.toString().length){var dob="";if(null!==$scope.modelObjectMap.DOB){var time=new Date($scope.modelObjectMap.DOB),date=time.getDate().toString();10>date&&(date="0"+date);var month=(time.getMonth()+1).toString();10>month&&(month="0"+month);var year=time.getFullYear().toString();dob=date+month+year}var options={firstName:$scope.modelObjectMap.First_name,lastName:$scope.modelObjectMap.Sur_name,dob:dob,medicareNo:$scope.modelObjectMap.Medicare_no.toString(),refNo:$scope.modelObjectMap.Ref.toString()};PatientService.mdtVerifiedMedicare(options).then(function(response){$scope.isMedicare="success"==response.status?!0:!1})}};var initObject=function(){$scope.isMedicare=!1,$scope.isSubmit=!1,$scope.accordion={oneAtATime:!1,main_address:!0,main_medicare:!0,main_medicare_disabled:!0,main_one:!0,main_two:!0},$scope.selectedCompany={Company_name:"Select Company"},$scope.modelObjectMap=angular.copy(PatientModel),$scope.params.permission.edit===!0&&PatientService.mdtById($scope.params.id).then(function(response){if("success"===response.status){angular.extend($scope.modelObjectMap,response.data),console.log("this is modelObjectMap",$scope.modelObjectMap);for(var key in $scope.modelObjectMap)$scope.modelObjectMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("No_")||-1!=key.indexOf("Diabetic")||-1!=key.indexOf("Inactive")||-1!=key.indexOf("Deceased")||-1!=key.indexOf("Gradudate_"))&&($scope.modelObjectMap[key]=$scope.modelObjectMap[key].toString()),(-1!=key.indexOf("_date")||-1!=key.indexOf("DOB")||-1!=key.indexOf("Exp"))&&($scope.modelObjectMap[key]=new Date($scope.modelObjectMap[key]))),$scope.modelObjectMap.avatar&&""!==$scope.modelObjectMap.avatar?$scope.avt_path=$scope.modelObjectMap.avatar:$scope.modelObjectMap.Sex&&""!==$scope.modelObjectMap.Sex?("0"===$scope.modelObjectMap.Sex&&($scope.avt_path="img/patient/avt/male_default.png"),"1"===$scope.modelObjectMap.Sex&&($scope.avt_path="img/patient/avt/female_default.png")):$scope.avt_path="img/patient/avt/male_default.png";console.log("this is init avt_path",$scope.avt_path),$scope.verifiedMedicare(),$scope.loadState(),$scope.modelObjectMap.State=parseInt($scope.modelObjectMap.State),$scope.modelObjectMap.Title=parseInt($scope.modelObjectMap.Title),angular.extend($scope.selectedCompany,response.company),$scope.selectedCompany.insurer=response.insurer}}),$scope.params.permission.create===!0&&($scope.modelObjectMap.Country="Australia",$scope.modelObjectMap.Sex=0,$scope.loadState(),$scope.modelObjectMap.State=20)};initObject();var companyModel=$scope.selectedCompany,idPatientDetailCompany="#PatientDetailCompany";$scope.clickCompany=function(){$modal.open({templateUrl:"dialogCompanyList",controller:function($scope,$modalInstance){$scope.actionCenter={createAdd:!0,goToStateAddCompany:function(){$modalInstance.dismiss("cancel"),$modal.open({templateUrl:"dialogAddCompany",controller:function($scope,$modalInstance){$scope.actionCenter={saveModal:function(Company_name,Company_id){companyModel.id=Company_id,companyModel.Company_name=Company_name,InsurerService.oneFollowCompany({company_id:Company_id}).then(function(response){companyModel.insurer={insurer_name:"No Insurer"},null!==response.data.insurer_name&&(companyModel.insurer.insurer_name=response.data.insurer_name),$modalInstance.dismiss("cancel")},function(error){})},closeModal:function(){$modalInstance.dismiss("cancel")}}},size:"lg"})}},$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){row&&($scope.selectedCompany.id=row.id,$scope.selectedCompany.Company_name=row.Company_name,InsurerService.oneFollowCompany({company_id:row.id}).then(function(response){$scope.selectedCompany.insurer={insurer_name:"No Insurer"},null!==response.data.insurer_name&&($scope.selectedCompany.insurer.insurer_name=response.data.insurer_name)},function(error){}))})},$scope.selectCompany=function(row){angular.element(idPatientDetailCompany).fadeOut(),angular.extend($scope.selectedCompany,row)},$scope.closePopup=function(){angular.element(idClose).fadeOut()};var clickAction=function(){if($scope.isSubmit=!0,$scope.accordion.main_one=!0,$scope.accordion.main_two=!0,!$scope.patientForm.$invalid){var postData=angular.copy($scope.modelObjectMap);postData.company_id=$scope.selectedCompany.id;for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));console.log("this is avt_path before edit",$scope.avt_path),"img/patient/avt/male_default.png"!==$scope.avt_path&&"img/patient/avt/female_default.png"!==$scope.avt_path?(console.log("run here",$scope.avt_path),postData.avatar=$scope.avt_path):postData.avatar="",$scope.params.permission.edit===!0?PatientService.mdtEdit(postData).then(function(response){return"success"!=response.status?void toastr.error("Cannot Update!","Error"):(toastr.success("Updated Patient Successfully !!!","Success"),$scope.actionCenter&&$scope.actionCenter.runWhenFinish&&$scope.actionCenter.runWhenFinish(),initObject(),void($scope.isClose&&$scope.closePopup()))}):(console.log("postData",postData),PatientService.checkPatietnInfo(postData.First_name,postData.Sur_name,postData.Middle_name,postData.DOB).then(function(data){if("success"==data.status)console.log("aaaaaaaaaaaaaaaa",data.data),toastr.error("Patient already exists","Error");else if("fail"==data.status){if(console.log("aaaaaaaaa",data),uploader.queue.length>0){var upload_file_name=(new Date).getTime()+"-"+uploader.queue[0].file.name;postData.avatar="img/patient/avt/"+upload_file_name}"undefined"!=typeof $scope.params.permission.calendar&&$scope.params.permission.calendar===!0&&(postData.CAL_ID=$scope.params.CAL_ID),PatientService.mdtAdd(postData).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(toastr.success("Insert Patient Successfully !!!","Success"),$scope.actionCenter&&$scope.actionCenter.runWhenFinish&&$scope.actionCenter.runWhenFinish(data.data),uploader.queue.length>0&&(uploader.queue[0].formData[0]={patient_id:data.data.Patient_id,file_name:upload_file_name,editMode:!1},uploader.uploadItem(uploader.queue[0])),$scope.params.isAtAllPatient!==!0&&($scope.patient={},$scope.patient.Patient_name=$scope.modelObjectMap.First_name+" "+$scope.modelObjectMap.Sur_name,$scope.patient.Patient_id=data.data.Patient_id),initObject(),CompanyModel.insertPatientCompanies(postData.company_id,data.data.Patient_id),$scope.isClose&&$scope.closePopup(),$scope.onsuccess=data.data,void($scope.patient=data.data))})}else toastr.error("Patient already exists","Error")}))}};$scope.buttonclick=function(){$scope.params.permission.edit===!0&&uploader.queue.length>0?uploader.uploadItem(uploader.queue[0]):clickAction()},$scope.removeUpload=function(){uploader.queue=[]}}),angular.module("app.loggedIn.patient.workcover.controller",[]).controller("PatientWorkcoverController",function($scope,$state,$stateParams,localStorageService,PatientService){localStorageService.set("patientTempInfo",{Patient_id:$stateParams.patient_id}),localStorageService.set("apptTempInfo",{CAL_ID:$stateParams.cal_id});var patient_id=$stateParams.patient_id,cal_id=$stateParams.cal_id;$scope.navigator={add_first:function(){$state.go("loggedIn.waworkcover.first",{patient_id:patient_id,action:"add",cal_id:cal_id,wc_id:0})},add_progress:function(){$state.go("loggedIn.waworkcover.progress",{patient_id:patient_id,action:"add",cal_id:cal_id,wc_id:0})},add_final:function(){$state.go("loggedIn.waworkcover.final",{patient_id:patient_id,action:"add",cal_id:cal_id,ass_id:0})},add_general:function(){$state.go("loggedIn.waworkcover.general",{patient_id:patient_id,action:"add",cal_id:cal_id,ass_id:0})}},$scope.first_opt=PatientService.workcoverSearchOpt("first",patient_id),$scope.progress_opt=PatientService.workcoverSearchOpt("progress",patient_id),$scope.final_opt=PatientService.workcoverSearchOpt("final",patient_id),$scope.general_opt=PatientService.workcoverSearchOpt("general",patient_id)}),angular.module("app.loggedIn.patient.referrals.controller",[]).controller("PatientReferralsController",function($scope,$state,DoctorService){var item_type_options=[{code:"Service",label:"Service"},{code:"Goods",label:"Goods"}];$scope.data_options={columns:[{field:"id",is_hide:!0},{field:"Company_name",label:"Company Name"},{field:"Industry"}],use_filters:!1,filters:{ITEM_CODE:{type:"number"},ITEM_NAME:{type:"text"},ITEM_TYPE:{type:"dropdown",values:item_type_options}},api:"api/erm/v2/companies/search"}}),angular.module("app.loggedIn.patient.outside_referrals.controller",[]).controller("PatientOutsideReferralsController",function($scope,$state,$stateParams){$scope.params_add={permission:{create:!0,edit:!1}},$scope.params_edit={permission:{create:!1,edit:!0},id:0},$scope.module_id={outside_referral:"OutsideReferralModule",outside_referral_edit:"OutsideReferralEditModule"},$scope.add=function(){angular.element("#"+$scope.module_id.outside_referral).fadeIn()},$scope.getRow=function(row){$scope.params_edit.id=row.id,angular.element("#"+$scope.module_id.outside_referral_edit).fadeIn()},$scope.$watch("itemUpdate",function(newUpdate,oldUpdate){"undefined"!=typeof newUpdate&&newUpdate&&($state.go("loggedIn.patient.outside_referral",{patient_id:$stateParams.patient_id},{reload:!0}),$scope.itemUpdate=!1)})}),angular.module("app.loggedIn.patient.itemsheet.controller",[]).controller("PatientItemSheetController",function($filter,$scope,$stateParams,ReceptionistService,PatientService,toastr,InvoiceService){var arrGetBy=$filter("arrGetBy");$scope.appointment={CAL_ID:$stateParams.cal_id,Patient_id:$stateParams.patient_id},$scope.items_search_panel={},$scope.deptItems=null,$scope.apptItems=[],$scope.extraItems=[];var isInDeptItems=function(item_id){for(var i=0,len=$scope.deptItems.length;len>i;++i)for(var cat=$scope.deptItems[i],j=0,len2=cat.items.length;len2>j;++j){var t_item=cat.items[j];if(item_id==t_item.ITEM_ID)return t_item}return!1};$scope.invoiceHeaderInfo=null,PatientService.initInvoice($scope.appointment.Patient_id,$scope.appointment.CAL_ID).then(function(data){InvoiceService.selectInvoiceHeaderBySession($scope.appointment.Patient_id,$scope.appointment.CAL_ID).then(function(data){"success"==data.status?$scope.invoiceHeaderInfo=data.data:(alert("Get Invoice Header Error."),exlog.logErr(data))},function(err){alert("Get Invoice Header Error."),exlog.logErr(err)})},function(err){alert("Init Invoice Error."),exlog.logErr(err)}),ReceptionistService.apptDetail($scope.appointment.CAL_ID).then(function(response){return"success"===response.status?(delete response.data.Patient_id,angular.extend($scope.appointment,response.data),PatientService.getDeptItems($scope.appointment.CLINICAL_DEPT_ID)):void 0}).then(function(response){return"success"===response.status?($scope.deptItems=response.data.filter(function(item){return item.clnDeptItemList.ISENABLE}),InvoiceService.selectInvoiceLinesBySession($scope.appointment.Patient_id,$scope.appointment.CAL_ID)):void 0}).then(function(response){if("success"===response.status){$scope.apptItems=response.data;var item_id_list=[];return angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){item.PRICE=0,item.TIME_SPENT=0,item.QUANTITY=1,item_id_list.push(item.ITEM_ID)})}),angular.forEach($scope.apptItems,function(item){var t_item=isInDeptItems(item.ITEM_ID);t_item?(t_item.QUANTITY=item.QUANTITY,t_item.TIME_SPENT=item.TIME_SPENT,t_item.PRICE=item.PRICE,t_item.checked=1===item.IS_ENABLE?"1":"0",t_item.inserted="1"===t_item.checked):($scope.extraItems.push(item),item_id_list.push(item.ITEM_ID),item.checked=1===item.IS_ENABLE?"1":"0",item.inserted="1"===item.checked)}),ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,item_id_list)}}).then(function(response){if(response&&response.list){var list_fee=response.list;angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}),angular.forEach($scope.extraItems,function(item,key){var t_item=arrGetBy(list_fee,"CLN_ITEM_ID",item.ITEM_ID);t_item&&t_item.SCHEDULE_FEE>0&&(item.PRICE=t_item.SCHEDULE_FEE,item.disable_fee=!0)})}}),$scope.itemOptions={click:function(item){"dept_item"!=item.type&&"extra_item"!=item.type&&($scope.extraItems.push(item),item.QUANTITY=1,item.TIME_SPENT=0,item.checked="1",ReceptionistService.itemFeeAppt($scope.appointment.SERVICE_ID,[item.ITEM_ID]).then(function(response){response.list.length>0?(item.PRICE=response.list[0].SCHEDULE_FEE,item.disable_fee=!0):(item.PRICE=0,item.disable_fee=!1)}))},"class":function(item){if(isInDeptItems(item.ITEM_ID))return item.type="dept_item","danger";var t_item=arrGetBy($scope.extraItems,"ITEM_ID",item.ITEM_ID);return t_item?(item.type="extra_item","info"):void 0},options:{api:"api/erm/v2/items/search",method:"post",scope:$scope.items_search_panel,columns:[{field:"ITEM_ID",is_hide:!0},{field:"ITEM_CODE",label:"Item Code",width:"10%"},{field:"ITEM_NAME",label:"Item Name"},{field:"TAX_ID",label:"Tax Id",is_hide:!0},{field:"TAX_CODE",label:"Tax code"},{field:"TAX_RATE",label:"Tax rate"}],use_filters:!0,filters:{ITEM_CODE:{type:"text"},ITEM_NAME:{type:"text"}}}},$scope.itemSearch={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1}},$scope.updateItems=function(){var insertArr=[],fnInsertArr=function(item){var t={HEADER_ID:$scope.invoiceHeaderInfo.header_id,ITEM_ID:item.ITEM_ID,PRICE:item.PRICE,QUANTITY:item.QUANTITY,AMOUNT:item.PRICE*item.QUANTITY,TAX_ID:item.TAX_ID,TAX_CODE:item.TAX_CODE,TAX_RATE:item.TAX_RATE,TAX_AMOUNT:item.PRICE*item.QUANTITY*(item.TAX_RATE?item.TAX_RATE:0),TIME_SPENT:item.TIME_SPENT?item.TIME_SPENT:0,IS_ENABLE:"1"==item.checked?1:0};insertArr.push(t)};angular.forEach($scope.deptItems,function(cat,key){angular.forEach(cat.items,fnInsertArr)}),angular.forEach($scope.extraItems,fnInsertArr);var postData={invoiceHeaderId:$scope.invoiceHeaderInfo.header_id,listLine:insertArr};InvoiceService.saveInvoiceLineSheet(postData).then(function(data){"success"==data.status?toastr.success("Save invoice item success."):(data.status="non-data")?toastr.warning("No invoice item."):toastr.error("Save invoice item error.")},function(err){toastr.error("Save invoice item error.")})}}),angular.module("app.loggedIn.patient.appt.controller",[]).controller("PatientApptListController",function($scope,$state,$modal,$filter,toastr,$stateParams,DoctorService,PatientService,ReceptionistService,ConfigService){var patient_id=$stateParams.patient_id,cal_id=$stateParams.cal_id,arrGetBy=$filter("arrGetBy"),get_list_services=function(){ConfigService.system_service_by_clinical($scope.modelObjectMap.dept).then(function(response){$scope.opt_services=response,$scope.opt_services.length>0&&($scope.modelObjectMap.service=$scope.opt_services[0].SERVICE_ID)})},getRecallAppt=function(){PatientService.getRecallAppointments(patient_id).then(function(response){$scope.appt_list=response.data,angular.forEach($scope.appt_list,function(item){item.appointment.FROM_TIME=ConfigService.getCommonDatetime(item.appointment.FROM_TIME)})})},getRecallApptNew=function(){var postData={Patient_id:$stateParams.patient_id,CAL_ID:$stateParams.cal_id};PatientService.getRecallAppointmentsNew(postData).then(function(response){$scope.appt_listNew=response.data,angular.forEach($scope.appt_listNew,function(item){item.FROM_TIME=ConfigService.getCommonDatetime(item.FROM_TIME),item.TO_TIME=ConfigService.getCommonDatetime(item.TO_TIME)})})};getRecallApptNew(),PatientService.get(patient_id).then(function(response){"success"==response.status&&($scope.patient=response.data,$scope.patient.Patient_name=$scope.patient.First_name+" "+$scope.patient.Sur_name)}),ReceptionistService.apptDetail(cal_id).then(function(response){return"success"===response.status&&(delete response.data.Patient_id,angular.extend($scope.appointment,response.data),$scope.modelObjectMap.site=$scope.appointment.SITE_ID,$scope.modelObjectMap.dept=$scope.appointment.CLINICAL_DEPT_ID,$scope.refreshAppointment(),get_list_services()),PatientService.getApptClaim(patient_id,cal_id)}).then(function(response){console.log(response.data),"success"===response.status&&response.data.length>0&&($scope.appointment.Claim_id=response.data[0].Claim_id),console.log($scope.appointment)});var open=function(){$modal.open({templateUrl:"NewCall",size:"lg",controller:function($scope,$modalInstance){$scope.refresh=!1,$scope.$watch("refresh",function(refresh){refresh&&$modalInstance.close("success")})}}).result.then(function(success){success&&getRecallApptNew()})};$scope.formRecall={open:function(){open()}},$scope.bookingPatient=function(data,calIndex,doctorIndex){console.log(data);var cal_id=data.cals[doctorIndex];if(data.doctors[doctorIndex],!cal_id)return void toastr.error("Cannot recall this !!! ","Error");var yes=confirm("Do you want to recall at "+data.from_time_map+" "+ConfigService.getCommonDatetime($scope.modelObjectMap.datepicker)+" with "+$scope.options.doctors[doctorIndex].NAME);if(yes){var patients=data.patients[doctorIndex],p={Patient_id:$scope.patient.Patient_id,Patient_name:$scope.patient.Patient_name};if(""==patients&&(patients=[]),0==patients.length||0==patients[0].Patient_id)patients[0]=p;else{var t_item=arrGetBy(patients,"Patient_id",p.Patient_id);if(t_item)return void toastr.error("Cannot Recall again !!!","Error");patients.push(p)}var str_patients=JSON.stringify(patients),optionMap={CAL_ID:cal_id,SERVICE_ID:$scope.modelObjectMap.service,Patient_id:patient_id,PATIENTS:str_patients};console.log(optionMap),ReceptionistService.booking(optionMap).then(function(response){if("success"===response.status){if(toastr.success("Recall Successful !!!","Success"),$scope.formRecall.close(),$scope.appointment.Claim_id){var item={Claim_id:$scope.appointment.Claim_id,CAL_ID:cal_id,Patient_id:patient_id};PatientService.insertApptClaim(item).then(function(response){console.log(response),"success"===response.status})}getRecallAppt()}})}}}),angular.module("app.loggedIn.patient.apptdoc.controller",[]).controller("PatientApptDocController",function($scope,$stateParams,$timeout,FileUploader,ConfigService,PatientService,toastr){var patient_id=$stateParams.patient_id,cal_id=$stateParams.cal_id,download_api="https://"+location.host+"/api/erm/v2/apptdoc/download?id=";$scope.info_upload={total_size:0,progress_percent:0,pre_progress_percent:0};var uploader=$scope.uploader=new FileUploader({url:"/api/erm/v2/apptdoc/upload",autoUpload:!1,removeAfterUpload:!0,onSuccessItem:function(item,response,status,headers){var uploaded_percent=100*item.file.size/$scope.info_upload.total_size;$scope.info_upload.pre_progress_percent+=uploaded_percent,console.log($scope.info_upload.pre_progress_percent)},onProgressItem:function(item,progress){var uploaded_size=progress*item.file.size/100,uploaded_percent=100*uploaded_size/$scope.info_upload.total_size;$scope.info_upload.progress_percent=$scope.info_upload.pre_progress_percent+uploaded_percent},onCompleteAll:function(res){$scope.document_panel.reload(),$scope.info_upload={total_size:0,progress_percent:0,pre_progress_percent:0},toastr.success("Upload complete!","Complete!")},onAfterAddingAll:function(items){angular.forEach(items,function(f){$scope.info_upload.total_size+=f.file.size}),$scope.info_upload.step_size=$scope.info_upload.total_size/100,console.log("This is upload files",uploader)}});uploader.formData[0]={patient_id:patient_id,cal_id:cal_id},$scope.openUploader=function(){$timeout(function(){$("#appt_doc_upload").click()},100)},$scope.document_panel={},$scope.docSelected=function(item){window.open(download_api+item.id)},$scope.docs={select:0,"class":function(doc){return{selected:doc.cal_id==cal_id}},scope:$scope.document_panel,options:{api:"api/erm/v2/apptdoc/search",method:"post",scope:$scope.document_panel,columns:[{field:"id",is_hide:!0},{field:"cal_id",label:"Date",width:"20%",type:"custom",fn:function(item){return item.appointment?moment(item.appointment.FROM_TIME).format("DD-MM-YYYY - h:mm"):""}},{field:"document_name",label:"Document Name",width:"70%"}],use_filters:!0,filters:{document_name:{type:"text"},cal_id:{type:"dropdown",values:[{label:"Appointment",code:cal_id},{label:"All"}]}},search:{patient_id:$stateParams.patient_id},use_actions:!0,actions:[{"class":"fa fa-times",title:"Delete",callback:function(item){PatientService.deleteFile(item.id).then(function(res){"success"===res.status&&(toastr.success("Delete file success!","Success!"),$scope.document_panel.reload())})}},{"class":"fa fa-download",title:"Donwload",callback:function(item){console.log(item),window.open(download_api+item.id)}}]}}}),angular.module("app.loggedIn.patient.listall.controller",[]).controller("PatientListAllController",function(CompanyModel,$scope,$state){$scope.patient_panel={},$scope.patients={select:0,"class":function(patient){return{selected:patient.ID==$scope.patients.select}},scope:$scope.patient_panel,options:{api:"api/erm/v2/patient/search",method:"post",scope:$scope.patient_panel,columns:[{field:"Patient_id",is_hide:!0},{field:"First_name",label:"First name"},{field:"Sur_name",label:"Last name"},{field:"Address1",label:"Address"},{field:"Post_code",label:"Post Code"}],use_filters:!0,filters:{First_name:{type:"text"},Sur_name:{type:"text"},Address1:{type:"text"},Post_code:{type:"text"}}}},$scope.actionCenter={runWhenFinish:function(){$scope.patientAddForm.close(),$scope.patient_panel.reload()}},$scope.patientAddForm={params:{permission:{edit:!1,create:!0}},is_show:!1,open:function(){$scope.patientAddForm.params.isAtAllPatient=!0,this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&alert("okokok"),$scope.patient_panel.reload()}},$scope.rowClick=function(item){var postData={datetime:moment().format("YYYY-MM-DD hh:mm:ss"),patient_id:item.Patient_id};CompanyModel.getFromTime(postData).then(function(response){-1==response.data?$state.go("loggedIn.patient.appointment",{patient_id:item.Patient_id,cal_id:-1}):$state.go("loggedIn.patient.appointment",{patient_id:item.Patient_id,cal_id:response.data.CAL_ID})},function(error){})},$scope.patientEditForm={params:{permission:{edit:!0,create:!1}},is_show:!1,open:function(patient_id){$scope.patientEditForm.params.id=patient_id,console.log($scope.patientEditForm.params),this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.patient_panel.reload()}}}),angular.module("app.loggedIn.patient.checkin.controller",[]).controller("PatientCheckinController",function(socket,$scope,ConfigService,PatientService,toastr,$state){$scope.showPatientResult=!1,$scope.showAppointmentOfId=null,$scope.patient_panel={},$scope.appointment_panel={},$scope.patientSearch={},$scope.patients={show:function(searchInfo){$scope.patients.options.search=searchInfo,$scope.patient_panel.reload()},reset:function(){$scope.patients.options.search={First_name:null,Sur_name:null,DOB:null},$scope.patient_panel.reload()},"class":function(patient){},scope:$scope.patient_panel,options:{api:"api/erm/v2/patient/checkin_search",method:"post",scope:$scope.patient_panel,columns:[{field:"Patient_id",label:"ID"},{field:"First_name",label:"First name"},{field:"Sur_name",label:"Last name"},{field:"DOB",label:"Date Of Birth",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.DOB)}},{type:"button",btnlabel:"Appointment",btnfn:function(item){$scope.appointments.show(item.Patient_id),$scope.patientInfoCalendar&&($scope.patientInfoCalendar.Patient_id=item.Patient_id,console.log($scope.patientInfoCalendar),$scope.bottomNewBooking=!0)}}],not_load:!0}},$scope.appointments={show:function(patient_id){$scope.appointments.options.search={Patient_id:patient_id},$scope.appointment_panel.reload()},reset:function(){$scope.appointments.options.search={Patient_id:null},$scope.appointment_panel.reload()},"class":function(appointment){return{}},scope:$scope.appointment_panel,options:{api:"api/erm/v2/appt/appt_by_id",method:"post",scope:$scope.appointment_panel,columns:[{field:"CAL_ID",is_hide:!0},{field:"Patient_id",is_hide:!0},{field:"appointment",label:"Appointment time",type:"custom",fn:function(item){return ConfigService.getCommonDatetime(item.appointment.FROM_TIME)}},{field:"appt_status",label:"Appointment Status",type:"custom",fn:function(item){return ptnConst.apptStatusDisplay[item.appt_status]}},{type:"button",btnlabel:"Check In",btnfn:function(item){console.log("id neeeeee",item.appointment.DOCTOR_ID),PatientService.checkIn(item.CAL_ID,item.Patient_id).then(function(result){"success"!==result.status?toastr.error("Check-in error!","Error"):(socket.emit("notifyReceptionist"),socket.emit("notifyDoctor",item.appointment.DOCTOR_ID),toastr.success("Checked In!","Success!"),$scope.appointment_panel.reload())})},disfn:function(item){return item.appt_status!=ptnConst.apptStatus.booking.value?!0:!1}}],not_load:!0}},$scope.searchClick=function(){if($scope.isSubmit=!0,!$scope.sysservicesForm.$invalid)if($scope.patientSearch.First_name||$scope.patientSearch.Sur_name||$scope.patientSearch.DOB){var searchData={First_name:$scope.patientSearch.First_name,Sur_name:$scope.patientSearch.Sur_name,DOB:$scope.patientSearch.DOB};""===searchData.First_name&&(searchData.First_name=void 0),""===searchData.Sur_name&&(searchData.Sur_name=void 0),""===searchData.DOB&&(searchData.DOB=void 0),searchData.DOB&&(searchData.DOB=ConfigService.getCommonDate(searchData.DOB)),$scope.patients.show(searchData)}else toastr.error("Please provide at least 1 information!","Error!")},$scope.resetClick=function(){$scope.isSubmit=!0,$scope.sysservicesForm.$invalid||($scope.appointments.reset(),$scope.patients.reset(),$scope.patientSearch={})},$scope.goToNewBooking=function(){$scope.patientInfoCalendar?(console.log($scope.patientInfoCalendar.Patient_id),$state.go("webpatient.booking")):toastr.error("No information available on the patient","Error")}}),angular.module("app.loggedIn.patient.makecall.directive",[]).directive("makecallService",function(PatientService,$modal,$timeout,$state,$stateParams,$cookieStore,$modal,toastr,AppointmentModel,mdtRedimedsitesService,mdtDeptService,ConfigService){return{restrict:"EA",templateUrl:"modules/patient/directives/templates/makecall.html",scope:{options:"=",refresh:"="},link:function(scope,elem,attrs){scope.extendMinutes=function(hour,minute){hour=scope.convertToSeconds(hour);var seconds=hour+60*minute,sec_num=parseInt(seconds,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60);10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes);var time=hours+":"+minutes;return time},scope.convertToSeconds=function(time){var hour=parseInt(time.substring(0,2)),minute=parseInt(time.substring(3));return 3600*hour+60*minute},scope.differentTimeHours=function(hourOne,hourSecond){return 0!==hourSecond?(hourOne=scope.convertToSeconds(hourOne),hourSecond=scope.convertToSeconds(hourSecond),(hourSecond-hourOne)/60):0};var search={datepicker:moment().format("DD/MM/YYYY"),site_id:1,clinical_dept_id:""},loadSite=function(){mdtRedimedsitesService.list().then(function(response){scope.site.list=response.data},function(error){})},loadClinical=function(){mdtDeptService.listAll().then(function(response){scope.clinicalDept.list=response.data},function(error){})},load=function(){var postData=angular.copy(scope.appointment.search);postData.datepicker=ConfigService.convertToDB(postData.datepicker),scope.appointment.list=[],AppointmentModel.load(postData).then(function(response){scope.doctor.headers=response.doctors;var doctor_array_temp=[];_.forEach(response.doctors,function(doctor){doctor_array_temp.push({DOCTOR_ID:doctor.DOCTOR_ID,left:0})});var min_calendar=9999;_.forEach(response.data,function(data){var flagTheme=-1,flagPatient=-1,i=0;if(_.forEach(scope.appointment.list,function(list){list.FROM_TIME===data.FROM_TIME&&_.forEach(list.cals,function(cal){return cal===data.CAL_ID?void(flagPatient=i):void(flagTheme=i)}),i++}),data.Patient_id&&-1===flagPatient&&(flagPatient=1e3),-1!==flagPatient)if(1e3!==flagPatient){var doctor_row=0;scope.appointment.list[flagPatient].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[flagPatient].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,outreferral:data.outreferral,DOCTOR_ID:data.DOCTOR_ID}),void(scope.appointment.list[flagPatient].doctors[doctor_row].PATIENTS="ok")):void doctor_row++})}else{var temp_index=0,flagIndex=!1;if(_.forEach(scope.appointment.list,function(list){data.FROM_TIME===list.FROM_TIME&&_.forEach(list.doctors,function(doc){if(doc.DOCTOR_ID===data.DOCTOR_ID){if("###"===doc.PATIENTS){var doctor_row=0;return scope.appointment.list[temp_index].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[temp_index].doctors[doctor_row].CAL_ID=data.CAL_ID,scope.appointment.list[temp_index].doctors[doctor_row].SERVICE_COLOR=data.SERVICE_COLOR,scope.appointment.list[temp_index].doctors[doctor_row].patients=[],scope.appointment.list[temp_index].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),scope.appointment.list[temp_index].doctors[doctor_row].PATIENTS="ok",void(scope.appointment.list[temp_index].doctors[doctor_row].IS_REFERRAL=data.IS_REFERRAL)):void doctor_row++}),void(flagIndex=!0)}var doctor_row=0;return scope.appointment.list[temp_index].cals.push(data.CAL_ID),_.forEach(response.doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[temp_index].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),void(scope.appointment.list[temp_index].doctors[doctor_row].PATIENTS="ok")):void doctor_row++}),void(flagIndex=!0)}}),temp_index++}),!flagIndex){var doctors=[];_.forEach(response.doctors,function(doctor){doctors.push(doctor.DOCTOR_ID===data.DOCTOR_ID?{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}:{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,PATIENTS:"###"})});var doctor_row=0;_.forEach(doctors,function(doctor){doctor.DOCTOR_ID===data.DOCTOR_ID&&(doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),doctors[doctor_row].PATIENTS="ok"),doctor_row++});var cal=[];cal.push(data.CAL_ID);
var object={FROM_TIME:data.FROM_TIME,TO_TIME:data.TO_TIME,cals:cal,doctors:doctors};scope.appointment.list.push(object)}}else if(-1!==flagTheme){var doctor_row=0;_.forEach(scope.appointment.list[flagTheme].doctors,function(doctor){return doctor.DOCTOR_ID===data.DOCTOR_ID?(scope.appointment.list[flagTheme].doctors[doctor_row].patients=[],scope.appointment.list[flagTheme].cals.push(data.CAL_ID),null!==data.Patient_id&&scope.appointment.list[flagTheme].doctors[doctor_row].patients.push({Patient_id:data.Patient_id,First_name:data.First_name,Sur_name:data.Sur_name,Outreferral:data.outreferral}),scope.appointment.list[flagTheme].doctors[doctor_row].PATIENTS="MESS_SYS_010",scope.appointment.list[flagTheme].doctors[doctor_row].SERVICE_ID=data.SERVICE_ID,scope.appointment.list[flagTheme].doctors[doctor_row].CAL_ID=data.CAL_ID,scope.appointment.list[flagTheme].doctors[doctor_row].SERVICE_COLOR=data.SERVICE_COLOR,scope.appointment.list[flagTheme].doctors[doctor_row].IS_REFERRAL=data.IS_REFERRAL,scope.appointment.list[flagTheme].doctors[doctor_row].CLINICAL_DEPT_ID=data.CLINICAL_DEPT_ID,void(scope.appointment.list[flagTheme].doctors[doctor_row].patients.length>0&&(scope.appointment.list[flagTheme].doctors[doctor_row].PATIENTS="ok"))):void doctor_row++})}else{var doctors=[];_.forEach(response.doctors,function(doctor){doctors.push(doctor.DOCTOR_ID===data.DOCTOR_ID?{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,SERVICE_ID:data.SERVICE_ID,CAL_ID:data.CAL_ID,IS_REFERRAL:data.IS_REFERRAL,SERVICE_COLOR:data.SERVICE_COLOR,PATIENTS:"MESS_SYS_010",patients:[],CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}:{DOCTOR_ID:doctor.DOCTOR_ID,DOCTOR_NAME:doctor.NAME,PATIENTS:"###"})});var differentTimeHours=scope.differentTimeHours(data.FROM_TIME,data.TO_TIME);min_calendar>=differentTimeHours&&(min_calendar=differentTimeHours);var i=0;_.forEach(doctor_array_temp,function(doctor){doctor.DOCTOR_ID===data.DOCTOR_ID&&(doctor_array_temp[i].left=scope.differentTimeHours(data.FROM_TIME,data.TO_TIME)),i++});var cal=[];cal.push(data.CAL_ID);var object={FROM_TIME:data.FROM_TIME,TO_TIME:data.TO_TIME,cals:cal,SERVICE_ID:data.SERVICE_ID,CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID,doctors:doctors};scope.appointment.list.push(object)}}),scope.appointment.new_list=[];var i=0;if(scope.appointment.list.length>0)var begin_from_time=scope.appointment.list[0].FROM_TIME;_.forEach(scope.appointment.list,function(list){if("undefined"!=typeof scope.appointment.list[i+1])var begin_to_time=scope.appointment.list[i+1].FROM_TIME;else var begin_to_time=scope.extendMinutes(begin_from_time,45);var diff=scope.differentTimeHours(begin_from_time,begin_to_time);scope.appointment.new_list.push(scope.appointment.list[i]);var new_list_length=scope.appointment.new_list.length,j=0;_.forEach(scope.appointment.new_list[new_list_length-1].doctors,function(doctor){scope.appointment.new_list[new_list_length-1].doctors[j].border="yes",j++});for(var diff_i=15;diff-15>=diff_i;diff_i+=15){var from_time=scope.extendMinutes(scope.appointment.list[i].FROM_TIME,diff_i);begin_from_time=from_time;var temp_doctors=angular.copy(scope.appointment.list[i].doctors),doc_i=0;_.forEach(temp_doctors,function(doctor){temp_doctors[doc_i].PATIENTS="###",doc_i++}),scope.appointment.new_list.push({FROM_TIME:from_time,doctors:temp_doctors})}begin_from_time=scope.extendMinutes(begin_from_time,15),i++}),scope.appointment.list=angular.copy(scope.appointment.new_list);var i=0;_.forEach(scope.appointment.list,function(list){var j=0;_.forEach(list.doctors,function(doctor){var k=0;_.forEach(doctor_array_temp,function(temp){doctor.DOCTOR_ID===temp.DOCTOR_ID&&("###"!==doctor.PATIENTS?(doctor_array_temp[k].left_temp=doctor_array_temp[k].left-15,doctor_array_temp[k].color=scope.appointment.list[i].doctors[j].SERVICE_COLOR,0===doctor_array_temp[k].left_temp&&(scope.appointment.list[i].doctors[j].height="35px")):doctor_array_temp[k].left_temp>0&&(scope.appointment.list[i].doctors[j].SERVICE_COLOR=doctor_array_temp[k].color,doctor_array_temp[k].left_temp-=15,0===doctor_array_temp[k].left_temp&&(scope.appointment.list[i].doctors[j].height="35px"))),k++}),j++}),i++});var i=0;_.forEach(scope.appointment.list,function(list){var j=0;_.forEach(list.doctors,function(doctor){"undefined"!=typeof scope.appointment.list[i].doctors[j].patients&&scope.appointment.list[i].doctors[j].patients.length>1&&"ok"===scope.appointment.list[i].doctors[j].PATIENTS&&(scope.appointment.list[i].doctors[j].height="auto"),j++}),i++})},function(error){})},onOrder=function(data){var postData={Patient_id:$stateParams.patient_id,CAL_ID:data};PatientService.Add_CAL(postData).then(function(response){scope.refresh=!0},function(error){})};scope.site={list:[],load:function(){loadSite()}},scope.doctor={headers:[]},scope.appointment={list:[],onOrder:function(data){onOrder(data)},search:angular.copy(search),load:function(){load()}},scope.clinicalDept={list:[],load:function(){loadClinical()}},scope.site.load(),scope.clinicalDept.load(),scope.appointment.load()}}}),angular.module("app.loggedIn.patient.claim",["app.loggedIn.patient.claim.controllers","app.loggedIn.patient.claim.services"]).config(function($stateProvider){}),angular.module("app.loggedIn.patient.claim.services",[]).factory("ClaimService",function(Restangular){var claimService={},mdtApi=Restangular.all("api/meditek/v1/patient/claim");return claimService.search=function(options){var funcApi=mdtApi.all("search");return funcApi.post(options)},claimService.add=function(params){var funcApi=mdtApi.all("add");return funcApi.post(params)},claimService}),angular.module("app.loggedIn.patient.claim.controllers",["app.loggedIn.patient.claim.list.controller"]).controller("ClaimController",function($scope){}),angular.module("app.loggedIn.patient.claim.list.controller",[]).controller("ClaimListController",function($scope,$stateParams,ClaimService,toastr){var idClaimDetailAdd="#PopupClaimDetailAdd";$scope.claim_params={permission:{edit:!1},isOpenFirst:!1,Patient_id:$stateParams.patient_id},$scope.list={},$scope.$watch("claim",function(newClaim){"undefined"!=typeof newClaim&&(loadList(),angular.element(idClaimDetailAdd).fadeOut())}),$scope.params={pagination:{limit:10,offset:0,current_page:1,max_size:5},filters:[{type:"select",name:"Patient_id",value:$stateParams.patient_id},{type:"select",name:"Claim_no",value:""},{type:"text",name:"Injury_name",value:""},{type:"text",name:"Location",value:""}],select:["Claim_id","Patient_id","Claim_no","Injury_name","Location"]};var loadList=function(){ClaimService.search($scope.params).then(function(response){"success"===response.status&&($scope.list=response)},function(error){console.log("Error Server")})};loadList(),$scope.refreshList=function(){loadList()},$scope.setPage=function(){$scope.params.pagination.offset=($scope.params.pagination.current_page-1)*$scope.params.pagination.limit,loadList()},$scope.openPopup=function(option){$scope.claim_params.isOpenFirst=!0,"add"===option.type&&$scope.claim_params.isOpenFirst===!0&&angular.element(idClaimDetailAdd).fadeIn()},$scope.clickRow=function(claimData){$scope.claim_params.isOpenFirst=!0,$scope.claim_params.permission.edit!==!0&&($scope.claim_params={permission:{edit:!0,Claim_id:claimData.row.Claim_id}}),($scope.claim_params.isOpenFirst=!0)&&angular.element(idClaimDetailAdd).fadeIn()},$scope.$watch("claim_params.permission.edit",function(editMode){editMode!==!0&&loadList()})}),angular.module("app.loggedIn.patient.problem",["app.loggedIn.patient.problem.list.controller","app.loggedIn.patient.problem.directive","app.loggedIn.patient.problem.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.problem_list",{url:"/problem",views:{"main-content":{templateUrl:"modules/problem/views/list.html",controller:"ProblemListController"}}})}),angular.module("app.loggedIn.problem.controller",["app.loggedIn.problem.list.controller"]).controller("ProblemController",function(){}),angular.module("app.loggedIn.patient.problem.list.controller",[]).controller("ProblemListController",function($scope,$stateParams,ConfigService){$scope.problem_panel={},console.log("this is patient id",$stateParams),$scope.problem={select:0,scope:$scope.problem_panel,options:{api:"api/erm/v2/problem/search",method:"post",scope:$scope.problem_panel,columns:[{field:"Problem_id",is_hide:!0},{field:"Notes",label:"Problem description"},{field:"From_date",label:"From",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.From_date)}},{field:"To_date",label:"To",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.To_date)}}],search:{Patient_id:$stateParams.patient_id},use_filters:!0,filters:{Notes:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.problem.id=item.Problem_id,$scope.problemEditForm.open()}}]}},$scope.problemAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.problem_panel.reload(),$scope.problemAddForm.close()}},$scope.problemEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.problem_panel.reload(),$scope.problemEditForm.close()}}}),angular.module("app.loggedIn.patient.problem.directive",["app.loggedIn.patient.problem.detail.directive"]),angular.module("app.loggedIn.patient.problem.detail.directive",[]).directive("problemDetail",function(ProblemModel,ProblemService,ConfigService,toastr,$stateParams){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/problem/directives/templates/detail.html",link:function(scope,element,attrs){var patient_id=$stateParams.patient_id,loadData=function(id){ProblemService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ProblemModel),scope.mode={type:"add",text:"Add problem"},scope.modelObjectMap.From_date=new Date,scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit problem"})}var addProcess=function(postData){postData.Patient_id=patient_id,ProblemService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Problem added","Success"),scope.modelObjectMap=angular.copy(ProblemModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){ProblemService.update(postData).then(function(response){"success"===response.status&&(toastr.success("Edit problem Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.patient.problem.service",[]).factory("ProblemService",function(Restangular,ConfigService,$state){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insert=function(postData){var detailApi=v2_api.all("problem/insert");return detailApi.post(postData)},instanceService.detail=function(postData){var detailApi=v2_api.all("problem/detail");return detailApi.post({ID:postData})},instanceService.update=function(postData){var detailApi=v2_api.all("problem/update");return detailApi.post(postData)},instanceService}),angular.module("app.loggedIn.receptionist",["app.loggedIn.receptionist.controller","app.loggedIn.receptionist.services","app.loggedIn.receptionist.directives"]).config(function($stateProvider){$stateProvider.state("loggedIn.receptionist",{"abstract":!0,templateUrl:"modules/receptionist/views/structure.html",controller:"ReceptionistController"}).state("loggedIn.receptionist.home",{url:"/receptionist/home",views:{"main-content":{templateUrl:"modules/receptionist/views/home.html",controller:"ReceptionistHomeController"}}})}),angular.module("app.loggedIn.receptionist.services",[]).service("receptionStileService",function(){var receptionStile=null;this.getreceptionStile=function(){return receptionStile},this.setreceptionStile=function(site){receptionStile=JSON.parse(JSON.stringify(site))}}).factory("ReceptionistService",function(Restangular){var receptionistService={},ermApi=Restangular.all("api/erm"),restfulAPI=Restangular.all("api/restful");receptionistService.getAppointmentList=function(options){return ermApi.all("appointment/get").post(options)},receptionistService.getAppointmentOverview=function(options){return ermApi.all("appointment/overview").post(options)},receptionistService.booking=function(options){return ermApi.all("appointment/booking").post(options)},receptionistService.getById=function(id){return ermApi.all("appointment/getById").post({booking_id:id})},receptionistService.deleteBooking=function(options){return ermApi.all("appointment/delete").post(options)},receptionistService.updateBooking=function(options){return ermApi.all("appointment/update").post(options)},receptionistService.updateStatus=function(options){return ermApi.all("appointment/updateStatus").post(options)},receptionistService.apptDetail=function(cal_id){return ermApi.one("v2/appt/detail").get({id:cal_id})},receptionistService.getItemAppt=function(appt_id,patient_id){return ermApi.all("v1/appointment/get_items").post({appt_id:appt_id,patient_id:patient_id})},receptionistService.itemFeeAppt=function(service_id,list_id){return ermApi.all("v2/appt/item_fee_appt").post({service_id:service_id,list_id:list_id})},receptionistService.getReferral=function(appt_id,patient_id){return restfulAPI.one("Referral").get({CAL_ID:appt_id,patient_id:patient_id})};var receptionistApi=Restangular.all("api/receptionist");return receptionistService.getAppointmentByDate=function(date,site){return receptionistApi.all("appointment/getByDate").post({date:date,siteId:site})},receptionistService.getProgressAppt=function(date,site){return receptionistApi.all("appointment/progress").post({date:date,siteId:site})},receptionistService.updateAppointment=function(from,to,state){return receptionistApi.all("appointment/update").post({fromAppt:from,toAppt:to,state:state})},receptionistService.getSite=function(){return receptionistApi.one("getSites").get()},receptionistService}),angular.module("app.loggedIn.receptionist.directives",[]),angular.module("app.loggedIn.receptionist.controller",["app.loggedIn.receptionist.home.controller"]).controller("ReceptionistController",function($scope,ConfigService,ReceptionistService){}),angular.module("app.loggedIn.receptionist.home.controller",[]).controller("ReceptionistHomeController",function(AppointmentModel,$scope,$filter,$state,$timeout,$modal,socket,$cookieStore,toastr,ConfigService,DoctorService,ReceptionistService,PatientService,localStorageService,sysServiceService,receptionStileService,AppointmentModel){function getAppt(date,site){var d=moment(date).format("YYYY-MM-DD");$scope.upcomingAppt=[],$scope.progressAppt=[],$scope.completeAppt=[],$scope.injuryAppt=[],$scope.doctors=[],loadAlertCenter(site),ReceptionistService.getAppointmentByDate(d,site).then(function(rs){"success"==rs.status.toLowerCase()&&($scope.upcomingAppt=rs.upcoming,$scope.completeAppt=rs.completed,$scope.injuryAppt=rs.injury,ReceptionistService.getProgressAppt(d,site).then(function(rs){"success"==rs.status.toLowerCase()&&($scope.progressAppt=rs.data,$scope.doctors=rs.doctorData)}))})}$scope.apptDate=new Date,$scope.apptSite=receptionStileService.getreceptionStile(),$scope.upcomingAppt=[],$scope.progressAppt=[],$scope.completeAppt=[],$scope.injuryAppt=[],$scope.doctors=[],$scope.undoArr=[],$scope.fromAppt={},$scope.startCheckedTime=null,$scope.servicedata={},$scope.getServiceColor=function(){AppointmentModel.getServiceColor("data").then(function(response){$scope.servicedata=response.data},function(error){})},$scope.getServiceColor(),ReceptionistService.getSite().then(function(rs){"success"==rs.status?$scope.siteList=rs.data:toastr.error("Site Error!")}),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){receptionStileService.setreceptionStile($scope.apptSite)}),$scope.clickArrow=function(){$scope.alertCenter.arrow=!$scope.alertCenter.arrow,$scope.alertCenter.arrow?(angular.element("#alert-center").css({display:"none"}),angular.element(".un_arrow").css({right:0})):(angular.element("#alert-center").css({display:"block"}),angular.element(".un_arrow").css({right:"225px"}))};var loadAlertCenter=function(site){date=moment(new Date).format("YYYY-MM-DD");var postData={datepicker:date,site_id:site};$scope.alertCenter.list=[],AppointmentModel.alertSiteCenter(postData).then(function(response){_.forEach(response.data,function(row){var flag=-1,i=0;if(_.forEach($scope.alertCenter.list,function(list){return list.Patient_id===row.Patient_id?void(flag=i):void i++}),-1!==flag){if(row.ALERT_ID){var alert_flag=!0;if(_.forEach($scope.alertCenter.list[flag].alert,function(alert){alert.id===row.ALERT_ID&&(alert_flag=!1)}),alert_flag){var object={id:row.ALERT_ID,name:row.ALERT_NAME};$scope.alertCenter.list[flag].alert.push(object)}var cal_flag=!0,i=0;if(_.forEach($scope.alertCenter.list[flag].cal,function(cal){cal.CAL_ID===row.CAL_ID&&(cal_flag=!1)}),cal_flag&&($scope.alertCenter.list[flag].test=row.IS_REFERRAL,$scope.alertCenter.list[flag].cal.push({IS_REFERRAL:row.IS_REFERRAL,CAL_ID:row.CAL_ID,FROM_TIME:row.FROM_TIME,TO_TIME:row.TO_TIME,OUTREFERRAL:"no",DOCTOR_ID:row.DOCTOR_ID}),row.outreferral_id)){var cal_length=$scope.alertCenter.list[flag].cal.length;$scope.alertCenter.list[flag].cal[cal_length-1].OUTREFERRAL="yes"}}}else{var object={Patient_id:row.Patient_id,First_name:row.First_name,Sur_name:row.Sur_name,alert:[],cal:[]};row.ALERT_ID&&object.alert.push({id:row.ALERT_ID,name:row.ALERT_NAME}),row.CAL_ID&&(object.test=row.IS_REFERRAL,object.cal.push({IS_REFERRAL:row.IS_REFERRAL,DOCTOR_ID:row.DOCTOR_ID,CAL_ID:row.CAL_ID,FROM_TIME:row.FROM_TIME,TO_TIME:row.TO_TIME,OUTREFERRAL:"no"}),row.outreferral_id&&(object.cal[0].OUTREFERRAL="yes")),$scope.alertCenter.list.push(object)}})},function(error){})};$scope.alertCenter={load:function(){loadAlertCenter()},list:[],arrow:!1},loadAlertCenter(-1),$scope.getAppointment=function(){null==$scope.apptSite?(toastr.warning("Please Choose Site!"),$scope.upcomingAppt=[],$scope.progressAppt=[],$scope.completeAppt=[],$scope.injuryAppt=[],$scope.doctors=[]):getAppt($scope.apptDate,$scope.apptSite)},getAppt($scope.apptDate,$scope.apptSite),$scope.changeAppt=function(appt,status){swal({title:"Are You Sure To Update This Appointment?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0,closeOnCancel:!0},function(){ReceptionistService.updateAppointment(appt,appt,status).then(function(rs){"success"==rs.status&&toastr.success("Update Appointment Success!")}),getAppt($scope.apptDate,$scope.apptSite)})},$scope.dragAppt=function(event,ui,data){$scope.fromAppt=angular.copy(data)},$scope.dropAppt=function(event,ui,doctor){$scope.fromAppt&&swal({title:"Are You Sure To Set This Appointment?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){if(isConfirm){var doctorId="undefined"!=typeof doctor.appointment&&doctor.appointment.length>0?doctor.appointment[0].doctor_id:doctor.doctor_id;ReceptionistService.updateAppointment($scope.fromAppt,doctorId,"progress").then(function(rs){"success"==rs.status&&(toastr.success("Update Appointment Success!"),socket.emit("notifyDoctor",doctorId),socket.emit("notifyPatient",$scope.fromAppt.appt_id),$scope.undoArr=[],$scope.undoArr.push($scope.fromAppt)),getAppt($scope.apptDate,$scope.apptSite)})}else getAppt($scope.apptDate,$scope.apptSite)})},socket.on("receiveNotifyReceptionist",function(){console.log("=======aaaaaaaaaaaaa========"),getAppt($scope.apptDate,$scope.apptSite)}),$scope.undoAction=function(){$scope.undoArr.length>0&&(console.log($scope.undoArr[0]),swal({title:"Are You Sure To Undo Action?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0,closeOnCancel:!0},function(){ReceptionistService.updateAppointment($scope.undoArr[0],$scope.undoArr[0],"undo").then(function(rs){"success"==rs.status&&(toastr.success("Undo Action Success!"),$scope.undoArr=[])}),getAppt($scope.apptDate,$scope.apptSite)}))}}),angular.module("app.loggedIn.rlob.controller",[]).controller("rlobController",function($scope,$http,$state,$window,$q,$stateParams,FileUploader,$cookieStore,$interval){$scope.bookingType=rlobConstant.bookingType.REDiLEGAL.name,$scope.bookingTypeObj=rlobConstant.bookingType.REDiLEGAL,$scope.contactDetails.splice(0),$scope.contactDetails.push({label:"",content:$scope.bookingTypeObj.display}),$scope.contactDetails.push({label:"Phone :",content:"(08) 9230 0900"}),$scope.contactDetails.push({label:"Email :",content:"medicolegal@redimed.com.au"}),$scope.have_redilegal_components.value=1,$scope.updateDailyNotificationRlobBooking()}),angular.module("app.loggedIn.vaccinob.controller",[]).controller("vaccinobController",function($scope,$http,$state,$window,$q,$stateParams,FileUploader,$cookieStore,$interval){$scope.bookingType=rlobConstant.bookingType.Vaccination.name,$scope.contactDetails.push({label:"",content:$scope.bookingType})});var rlobHelper={setSlimCroll:function(selector){$(selector).slimscroll({})}},rlobConstant={bookingStatus:{confirmed:"Confirmed",arrived:"Arrived",notArrived:"Not Arrived",completed:"Completed",cancel:"Cancel",lateCancellation:"Late Cancellation"},bellType:{changeStatus:"Change Booking Status",result:"Result",message:"Message",changeCalendar:"Change Appointment Calendar",notification:"Notification"},letterType:{result:"Result"},notificationType:{bell:"bell",letter:"letter"},bookingType:{REDiLEGAL:{alias:"rlob",name:"REDiLEGAL",display:"Medico-Legal"},Vaccination:{alias:"vaccinob",name:"Vaccination",display:"Vaccination"}},notifyJsColor:{warning:"warning",danger:"danger",success:"success"},documentStatus:{noDocuments:{value:"No documents",display:"Not Received"},notConfirmed:{value:"Not confirmed",display:"Not confirmed"},checked:{value:"Checked",display:"Received"}},documentStatusFilter:{noDocuments:{value:"No documents",display:"Not Received"},checked:{value:"Checked",display:"Received"}},documentStatusDisplay:{"No documents":"Not received","Not confirmed":"Not confirmed",Checked:"Received"},documentStatusSummaryStyleClass:{notConfirmed:"booking-item document-status-not-confirmed",checked:"booking-item document-status-checked",noDocuments:"booking-item document-status-no-documents"},notificationAppearance:{once:"ONCE",whenAccess:"WHEN ACCESS"},userType:{admin:1,redimed:2,company:3,doctor:4,nurse:5,driver:6,assistant:7},registerStatus:{PENDING:{value:"PENDING",display:"Pending",style:"success"},APPROVE:{value:"APPROVE",display:"Approve",style:""},REJECT:{value:"REJECT",display:"Reject",style:"warning"}},msgPopupType:{success:"success",error:"error"}},exlog={alert:function(data){alert(JSON.stringify(data))},log:function(data){console.log("%c----------------------TANNV BEGIN LOG------------------------","background: #ABC7E9; color: #141B76"),console.log("%c"+JSON.stringify(data),"background: #ABC7E9; color: #141B76"),console.log("%c----------------------TANNV END LOG--------------------------","background: #ABC7E9; color: #141B76")},logErr:function(data){console.log("%c----------------------TANNV ERROR BEGIN LOG------------------------","background: #D4B1B1; color: red"),console.log("%c"+JSON.stringify(data),"background: #D4B1B1; color: red"),console.log("%c-----------------------TANNV ERROR END LOG-------------------------","background: #D4B1B1; color: red")}},rlobDate={daysOfWeek:[{value:0,alias:"sun",display:"Sunday"},{value:1,alias:"mon",display:"Monday"},{value:2,alias:"tue",display:"Tueday"},{value:3,alias:"wed",display:"Wednesday"},{value:4,alias:"thu",display:"Thursday"},{value:5,alias:"fri",display:"Friday"},{value:6,alias:"sat",display:"Saturday"}],getDateStartWeek:function(date){var dayValue=date.getDay();return moment(date).add(1-dayValue,"days")},getDateEndWeek:function(date){var dayValue=date.getDay();return moment(date).add(6-dayValue,"days")}},rlobLang={rlobHeader:"Medico-Legal Online Booking"},rlobMsg={popup:function(header,type,content){$("#rlob-global-msg-popup .rlob-global-msg-popup-header").text(header),type==rlobConstant.msgPopupType.success&&($("#rlob-global-msg-popup .rlob-global-msg-popup-success").show(),$("#rlob-global-msg-popup .rlob-global-msg-popup-error").hide(),$("#rlob-global-msg-popup .rlob-global-msg-popup-success .rlob-global-msg-popup-content").text(content)),type==rlobConstant.msgPopupType.error&&($("#rlob-global-msg-popup .rlob-global-msg-popup-error").show(),$("#rlob-global-msg-popup .rlob-global-msg-popup-success").hide(),$("#rlob-global-msg-popup .rlob-global-msg-popup-error .rlob-global-msg-popup-content").text(content)),$("#rlob-global-msg-popup").modal({show:!0,backdrop:"static"})}},rlobScrollTo=function(selector,offeset){var el=$(selector),pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},"slow")};angular.module("app.loggedIn.rlob.directive",["app.calendar.mobile.controller"]).directive("noticeRepeatFinish",function(){return function(scope,element,attrs){scope.$last&&scope.collapseAll()}}).directive("mytable",["$timeout",function($timeout){return{restrict:"E",template:'<table width="100%" class="table table-hover table-striped" id="sample_editable_1"><thead><tr style="border-color: white"><th></th><th></th><th></th><th></th><th></th></tr><tr style="background-color: #585858; color: white"><th>ClaimNo</th><th>Surname</th><th>Type</th><th>Booking Date</th><th>Appointment Date</th></tr></thead><tr ng-repeat="booking in data"><td>{{booking.CLAIM_NO}}</td><td>{{booking.WRK_SURNAME}}</td><td>{{booking.Rl_TYPE_NAME}}</td><td>{{parseDate(booking.BOOKING_DATE)}}</td><td>{{parseDate(booking.APPOINTMENT_DATE)}}</td></tr></table>',controller:"rlob_bookingListController",link:function(scope,element,attrs,ctr){$timeout(function(){TableEditable.init();var initPickers=function(){$(".date-picker").rlobdatepicker({rtl:Metronic.isRTL(),autoclose:!0,format:"dd/mm/yyyy"})};initPickers()},0)}}}]).directive("rlobDialog",function(){return{restrict:"E",transclude:!0,scope:{dialogClass:"@",header:"=",status:"=",msg:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_msg_dialog_template.html"}}).directive("rlobOrderBy",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{fieldName:"@",rlobModel:"=",startupDirect:"@",currentFieldSort:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_orderby_template.html",controller:function($scope){$scope.direct=angular.copy($scope.startupDirect),$scope.changeDirect=function(direct,fieldName){$scope.currentFieldSort=angular.copy(fieldName),$scope.direct=direct,$scope.rlobModel=$scope.fieldName+" "+$scope.direct}}}}).directive("rlobBookingDetail",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedBooking:"=",bookingType:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_booking_detail_template.html",controller:function($scope){function codeAddress(){var address=$scope.selectedBooking.Site_addr;geocoder.geocode({address:address},function(results,status){status==google.maps.GeocoderStatus.OK?(map.setCenter(results[0].geometry.location),new google.maps.Marker({map:map,position:results[0].geometry.location})):alert("Geocode was not successful for the following reason: "+status)})}var geocoder,map;geocoder=new google.maps.Geocoder;var latlng=new google.maps.LatLng(-34.397,150.644),mapOptions={zoom:16,center:latlng};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),$scope.$watch("selectedBooking",function(newValue,oldValue){$scope.selectedBooking&&codeAddress()})}}}).directive("rlobBookingDetailCompact",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedBooking:"=",bookingType:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_booking_detail_template-compact.html",controller:function($scope){$scope.panelAccordion={status1:!0,status2:!0,status3:!0,status4:!0}}}}).directive("rlobBookingDetailPrint",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedBooking:"=",bookingType:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_booking_detail_template_print.html",controller:function($scope){function codeAddress(){var address1=$scope.selectedBooking.Site_addr;GMaps.geocode({address:address1,callback:function(results,status){if("OK"==status){latlng1=results[0].geometry.location;var url=GMaps.staticMapURL({lat:latlng1.lat(),lng:latlng1.lng(),markers:[{lat:latlng1.lat(),lng:latlng1.lng()}]});url=url.replace("http://","https://"),$("#imgMapPrint").attr("src",url)}}})}$scope.dateValue=new Date,$scope.$watch("selectedBooking",function(newValue,oldValue){$scope.selectedBooking&&codeAddress()})}}}).directive("rlobUpload",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedBooking:"=",isAdminUpload:"=",filesUpdateFlag:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_upload_template.html",controller:function($scope,$http,$cookieStore,FileUploader,rlobService){$scope.loginInfo=$cookieStore.get("userInfo");var uploader=$scope.uploader=new FileUploader({url:"/api/rlob/rl_booking_files/upload"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){console.info("onWhenAddingFileFailed",item,filter,options)},uploader.onAfterAddingFile=function(fileItem){console.info("onAfterAddingFile",fileItem)},uploader.onAfterAddingAll=function(addedFileItems){console.info("onAfterAddingAll",addedFileItems)},uploader.onBeforeUploadItem=function(item){console.info("onBeforeUploadItem",item)},uploader.onProgressItem=function(fileItem,progress){console.info("onProgressItem",fileItem,progress)},uploader.onProgressAll=function(progress){console.info("onProgressAll",progress)},uploader.onSuccessItem=function(fileItem,response,status,headers){console.info("onSuccessItem",fileItem,response,status,headers)},uploader.onErrorItem=function(fileItem,response,status,headers){console.info("onErrorItem",fileItem,response,status,headers)},uploader.onCancelItem=function(fileItem,response,status,headers){console.info("onCancelItem",fileItem,response,status,headers)},uploader.onCompleteItem=function(fileItem,response,status,headers){console.info("onCompleteItem",fileItem,response,status,headers)},uploader.onCompleteAll=function(){$scope.filesUpdateFlag=void 0!=$scope.filesUpdateFlag?$scope.filesUpdateFlag+1:1,console.info("onCompleteAll")},console.info("uploader",uploader),$scope.$watch("selectedBooking",function(newValue,oldValue){$scope.selectedBooking&&(uploader.clearQueue(),uploader.formData[0]={},uploader.formData[0].booking_id=$scope.selectedBooking.BOOKING_ID,uploader.formData[0].company_id=$scope.loginInfo.company_id,uploader.formData[0].worker_name=$scope.selectedBooking.WRK_SURNAME,$scope.isAdminUpload||(uploader.formData[0].isClientDownLoad=0))}),$scope.$watch("selectedBooking.WRK_SURNAME",function(newValue,oldValue){$scope.selectedBooking&&(uploader.clearQueue(),uploader.formData[0]={},uploader.formData[0].booking_id=$scope.selectedBooking.BOOKING_ID,uploader.formData[0].company_id=$scope.loginInfo.company_id,uploader.formData[0].worker_name=$scope.selectedBooking.WRK_SURNAME,$scope.isAdminUpload||(uploader.formData[0].isClientDownLoad=0));

})}}}).directive("rlobFileDownload",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{bookingType:"=",selectedBooking:"=",isAdminGetFiles:"=",filesUpdateFlag:"=",numberOfDocs:"=",dialogStyleClass:"@"},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_download_file_template.html",controller:function($scope,$http,rlobService){function getFilesUpload(){$http({method:"GET",url:"/api/rlob/rl_bookings/admin/get-files-by-booking-id",params:{bookingId:$scope.selectedBooking.BOOKING_ID,isAdminGetFiles:$scope.isAdminGetFiles}}).success(function(data){"success"==data.status&&($scope.files=data.data,$scope.numberOfDocs=data.data.length)})}void 0===$scope.numberOfDocs&&($scope.numberOfDocs=0),$scope.letterType=rlobConstant.letterType,$scope.notificationType=rlobConstant.notificationType,$scope.rlob_add_notification=rlobService.add_notification,$scope.$watch("selectedBooking",function(newValue,oldValue){$scope.selectedBooking&&getFilesUpload()}),$scope.$watch("filesUpdateFlag",function(newValue,oldValue){$scope.selectedBooking&&getFilesUpload()}),$scope.rlob_change_booking_file_role=function(assId,refId,fileId,role){function handle(mapUrl){$scope.showMsgDialog=function(styleClass,header,status,content){$scope.msgHeader=header,$scope.msgStatus=status,$scope.msgContent=content,$(styleClass).modal({show:!0,backdrop:"static"})},$scope.showNotificationPopup=rlobService.showNotificationPopup,$http({method:"POST",url:"/api/rlob/rl_booking_files/change-role-download",data:{fileId:fileId,role:role,siteAddress:siteAddress,mapUrl:mapUrl}}).success(function(data){"success"==data.status&&(1==role&&$scope.rlob_add_notification(assId,refId,$scope.bookingType,$scope.letterType.result,$scope.notificationType.letter,""),getFilesUpload())}).error(function(data){})["finally"](function(){})}var mapUrl=null,siteAddress=null;$scope.selectedBooking&&$scope.selectedBooking.Site_addr?(siteAddress=$scope.selectedBooking.Site_addr,GMaps.geocode({address:siteAddress,callback:function(results,status){"OK"==status?(latlng1=results[0].geometry.location,mapUrl=GMaps.staticMapURL({lat:latlng1.lat(),lng:latlng1.lng(),markers:[{lat:latlng1.lat(),lng:latlng1.lng()}]}),handle(mapUrl)):handle(mapUrl)}})):handle(mapUrl)},$scope.showDialogSetResult=function(){$scope.filesClone=angular.copy($scope.files),$("."+$scope.dialogStyleClass).modal({show:!0,backdrop:"static"})},$scope.setListResultFiles=function(){for(var listResult=[],i=0;i<$scope.filesClone.length;i++){var item=$scope.filesClone[i];1==item.isClientDownLoad&&listResult.push(item)}listResult.length>0?rlobService.rlobBookingFile.setListResultFiles(listResult).then(function(data){"success"==data.status?(rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"send file result success"),$scope.rlob_add_notification(listResult[0].ASS_ID,listResult[0].BOOKING_ID,$scope.bookingType,$scope.letterType.result,$scope.notificationType.letter,""),getFilesUpload()):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Set list result files fail.")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Set list result files fail.")}).then(function(){$("."+$scope.dialogStyleClass).modal("hide")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"No files chosen.")},$scope.unselectAllFileResult=function(){rlobService.rlobBookingFile.unselectAllFileResult($scope.selectedBooking.BOOKING_ID).then(function(data){"success"==data.status?(rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Unselect all result files success."),getFilesUpload()):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Unselect all result files fail.")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Unselect all result files fail.")}).then(function(){$("."+$scope.dialogStyleClass).modal("hide")})}}}}).directive("rlobChooseAppointmentCalendarDialog",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{bookingType:"=",usingForDialogFlag:"=",selectedAppointmentCalendar:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_choose_appointment_calendar_template.html",controller:function($scope,$http,$stateParams,Mailto,$cookieStore,$window,rlobService,$timeout,bookingService){$scope.loginInfo=$cookieStore.get("userInfo"),$scope.updateMailtoLink=function(){console.log($cookieStore.get("companyInfo"));var Company_name="[Name of Company]";$cookieStore.get("companyInfo")&&($scope.companyInfo=$cookieStore.get("companyInfo"),Company_name=$scope.companyInfo.Company_name),$scope.mailTemplate={REDiLEGAL:{label:"Please contact us to make an appointment",recepient:"medicolegal@redimed.com.au",options:{subject:Company_name+" - Request Booking",body:" I would like to make a booking for       \n Claim Number:                            \n Injured Workers's Name:                  \n Contact Number:                          \n Address:                                 \n Date of Birth:                           \n Date of Injury:                          \n Description of Injury:                   \n Location of Appointment:                 \n Timeframe for Appointment:               \n\n Please note that this booking is not confirmed in our system until approved by REDIMED."}},Vaccination:{label:"Please contact us to make an appointment",recepient:"",options:{subject:Company_name+" - Request Booking",body:"Please booking for me..."}}},"REDiLEGAL"==$scope.bookingType?$scope.mailtoLink=Mailto.url($scope.mailTemplate.REDiLEGAL.recepient,$scope.mailTemplate.REDiLEGAL.options):"Vaccination"==$scope.bookingType&&($scope.mailtoLink=Mailto.url($scope.mailTemplate.Vaccination.recepient,$scope.mailTemplate.Vaccination.options)),$scope.sendEmail=function(){$window.location.href=$scope.mailtoLink}},$scope.updateMailtoLink(),$scope.selectedFilter={locationSelected:{},rltypeSelected:{},clnSpecialitySelected:{},doctorSelected:{},var1:{}},$scope.selectedFilter.var1="REDiLEGAL"==$scope.bookingType?moment().add(14,"day"):moment();var initPickers=function(){$(".date-picker").rlobdatepicker({rtl:Metronic.isRTL(),autoclose:!0})};initPickers();var datePaginatorChanged=function(date){$scope.selectedFilter.var1=date,$scope.updateAppoinmentsList()};new MyDatePaginator("#rlob-datepaginator-choice",$scope.selectedFilter.var1,datePaginatorChanged),$("#rlob-datepaginator-choice").on("changeMonth",function(){$timeout(function(){$scope.updateAppoinmentsList()},200)}),$scope.getLocationsFilter=function(){$http({method:"GET",url:"/api/rlob/redimedsites/list",params:{bookingType:$scope.bookingType}}).success(function(data){$scope.locationsFilter=data}).error(function(data){console.log("error")})["finally"](function(){})},$scope.getLocationsFilter(),$scope.getRlTypesFilter=function(){$http({method:"GET",url:"/api/rlob/rl_types/list",params:{sourceType:$scope.bookingType}}).success(function(data){$scope.rltypesFilter=data,"Vaccination"==$scope.bookingType&&($scope.selectedFilter.rltypeSelected=data[0],$scope.getSpecialitiesFilter())}).error(function(data){console.log("error")})["finally"](function(){})},$scope.getRlTypesFilter(),$scope.rlTypesFilterChange=function(rlTypeId){$scope.updateAppoinmentsList()},$scope.getSpecialitiesFilter=function(){$http({method:"GET",url:"/api/rlob/cln_specialties/list",params:{sourceType:$scope.bookingType}}).success(function(data){"success"==data.status&&($scope.specialitiesFilter=data.data),"Vaccination"==$scope.bookingType&&($scope.selectedFilter.clnSpecialitySelected=$scope.specialitiesFilter[0],$scope.getDoctorsFilter())}).error(function(data){console.log("error")})["finally"](function(){})},$scope.getSpecialitiesFilter(),$scope.specialitiesChange=function(){$scope.updateAppoinmentsList()},$scope.getDoctorsFilter=function(){$http({method:"GET",url:"/api/rlob/doctors/get-doctors-for-source-type",params:{sourceType:$scope.bookingType}}).success(function(data){"success"==data.status&&($scope.doctorsFilter=data.data),"Vaccination"==$scope.bookingType&&($scope.selectedFilter.doctorSelected=$scope.doctorsFilter[0],$scope.updateAppoinmentsList())}).error(function(data){console.log("error")})["finally"](function(){})},$scope.getDoctorsFilter(),$scope.getListDateAppoinment=function(rlTypeId,specialtyName,doctorId,locationId,var1){for(var listItemDate=angular.element(".rlobdatepicker-days").find("table tbody tr td").not(".new").not(".old"),getMonth=angular.element(".rlobdatepicker-days").find("table thead tr .rlobdatepicker-switch"),i=0;i<listItemDate.length;i++)$scope.startItemDate=moment(angular.element(listItemDate[0]).text()+" "+angular.element(getMonth).text()).format("YYYY/MM/DD"),$scope.endItemDate=moment(angular.element(listItemDate[listItemDate.length-1]).text()+" "+angular.element(getMonth).text()).format("YYYY/MM/DD");rlobService.getListDateAppoinmentCalendar(rlTypeId,specialtyName,doctorId,locationId,$scope.startItemDate,$scope.endItemDate,$scope.bookingType).then(function(data){if("success"==data.status){for(var itemDate={},i=0;i<data.data.length;i++)itemDate[moment(data.data[i].APPOINTMENT_DATE).format("D")]=moment(data.data[i].APPOINTMENT_DATE).format("D");for(var i=0;i<listItemDate.length;i++)angular.element(listItemDate[i]).hasClass("setColorDatePicker")&&angular.element(listItemDate[i]).removeClass("setColorDatePicker"),itemDate[angular.element(listItemDate[i]).text()]&&(angular.element(listItemDate[i]).hasClass("today")||angular.element(listItemDate[i]).hasClass("active")||angular.element(listItemDate[i]).addClass("setColorDatePicker"))}else alert("error get list date")});var startDate=angular.copy(var1).subtract("days",30).format("YYYY/MM/DD"),endDate=angular.copy(var1).add("days",30).format("YYYY/MM/DD");rlobService.getListDateAppoinmentCalendar(rlTypeId,specialtyName,doctorId,locationId,startDate,endDate,$scope.bookingType).then(function(data){if("success"==data.status){for(var listItem=angular.element("#rlob-datepaginator-choice").find("ul li a"),listDate={},i=0;i<data.data.length;i++)listDate[moment(data.data[i].APPOINTMENT_DATE).format("DD-MM-YYYY")]=moment(data.data[i].APPOINTMENT_DATE).format("DD-MM-YYYY");for(var i=0;i<listItem.length;i++)angular.element(listItem[i]).hasClass("setColorDatePicker")&&angular.element(listItem[i]).removeClass("setColorDatePicker"),null!=listItem[i].getAttribute("data-moment")&&listDate[listItem[i].getAttribute("data-moment")]&&(angular.element(listItem[i]).hasClass("dp-item dp-selected")||angular.element(listItem[i]).addClass("setColorDatePicker"),$(".dp-selected").unbind(),$(".dp-selected").click($scope.updateAppoinmentsList))}})},$scope.updateAppoinmentsList=function(){var rlTypeId=$scope.selectedFilter.rltypeSelected&&$scope.selectedFilter.rltypeSelected.RL_TYPE_ID?$scope.selectedFilter.rltypeSelected.RL_TYPE_ID:"%",specialtyName=$scope.selectedFilter.clnSpecialitySelected&&$scope.selectedFilter.clnSpecialitySelected.Specialties_name?$scope.selectedFilter.clnSpecialitySelected.Specialties_name:"%",doctorId=$scope.selectedFilter.doctorSelected&&$scope.selectedFilter.doctorSelected.doctor_id?$scope.selectedFilter.doctorSelected.doctor_id:"%",locationId=$scope.selectedFilter.locationSelected&&$scope.selectedFilter.locationSelected.id?$scope.selectedFilter.locationSelected.id:"%",fromTime=$scope.selectedFilter.var1.format("YYYY/MM/DD");$scope.getListDateAppoinment(rlTypeId,specialtyName,doctorId,locationId,$scope.selectedFilter.var1),$http({method:"GET",url:"/api/rlob/appointment-calendar/get-appointment-calendar",params:{RL_TYPE_ID:rlTypeId,Specialties_name:specialtyName,DOCTOR_ID:doctorId,SITE_ID:locationId,FROM_TIME:fromTime,sourceType:$scope.bookingType}}).success(function(data){for(var temp={TYPE_ITEMS:[]},i=0;i<data.length;i++)temp[data[i].RL_TYPE_ID]||(temp[data[i].RL_TYPE_ID]={DOCTOR_ITEMS:[]},temp.TYPE_ITEMS.push({RL_TYPE_ID:data[i].RL_TYPE_ID,Rl_TYPE_NAME:data[i].Rl_TYPE_NAME})),temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID]||(temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID]={LOCATION_ITEMS:[]},temp[data[i].RL_TYPE_ID].DOCTOR_ITEMS.push({DOCTOR_ID:data[i].DOCTOR_ID,DOCTOR_NAME:data[i].NAME})),temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID]||(temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID]={APPOINTMENT_ITEMS:[]},temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID].LOCATION_ITEMS.push({SITE_ID:data[i].SITE_ID,SITE_NAME:data[i].Site_name})),temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID]||(temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID]={SPEC_ITEMS:[]},temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID].APPOINTMENT_ITEMS.push({CAL_ID:data[i].CAL_ID,APPOINTMENT_TIME:data[i].appointment_time,FROM_TIME:data[i].FROM_TIME,TO_TIME:data[i].TO_TIME,DOCTOR_ID:data[i].DOCTOR_ID,SITE_ID:data[i].SITE_ID})),temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID][data[i].Specialties_id]||(temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID][data[i].Specialties_id]={},temp[data[i].RL_TYPE_ID][data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID].SPEC_ITEMS.push({Specialties_id:data[i].Specialties_id,Specialties_name:data[i].Specialties_name}));for(var arr=[],i=0;i<temp.TYPE_ITEMS.length;i++){var type_item=temp.TYPE_ITEMS[i];type_item.DOCTOR_ITEMS=[];for(var j=0;j<temp[type_item.RL_TYPE_ID].DOCTOR_ITEMS.length;j++){var doctor_item=temp[type_item.RL_TYPE_ID].DOCTOR_ITEMS[j];doctor_item.SPECS={},doctor_item.SPECS_STR="",doctor_item.LOCATION_ITEMS=[],type_item.DOCTOR_ITEMS.push(doctor_item);for(var q=0;q<temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID].LOCATION_ITEMS.length;q++){var location_item=temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID].LOCATION_ITEMS[q];location_item.APPOINTMENT_ITEMS=[],doctor_item.LOCATION_ITEMS.push(location_item);for(var k=0;k<temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID][location_item.SITE_ID].APPOINTMENT_ITEMS.length;k++){var appointment_item=temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID][location_item.SITE_ID].APPOINTMENT_ITEMS[k];appointment_item.SPEC_ITEMS=[],location_item.APPOINTMENT_ITEMS.push(appointment_item);for(var l=0;l<temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID][location_item.SITE_ID][appointment_item.CAL_ID].SPEC_ITEMS.length;l++){var spec_item=temp[type_item.RL_TYPE_ID][doctor_item.DOCTOR_ID][location_item.SITE_ID][appointment_item.CAL_ID].SPEC_ITEMS[l];doctor_item.SPECS[spec_item.Specialties_name]||(doctor_item.SPECS[spec_item.Specialties_name]=spec_item.Specialties_name,doctor_item.SPECS_STR=doctor_item.SPECS_STR+spec_item.Specialties_name+"; "),appointment_item.SPEC_ITEMS.push(spec_item)}}}}arr.push(type_item)}$scope.appointmentsFilter=arr}).error(function(data){console.log("error")})["finally"](function(){})},$scope.$watch("usingForDialogFlag",function(newValue,oldValue){$scope.usingForDialogFlag&&($scope.updateCalendarPaginator(),$scope.updateAppoinmentsList())}),$scope.updateCalendarPaginator=function(){$scope.selectedFilter.var1=moment();var initPickers=function(){$(".date-picker").rlobdatepicker({rtl:Metronic.isRTL(),autoclose:!0})};initPickers();var datePaginatorChanged=function(date){$scope.selectedFilter.var1=date,$scope.updateAppoinmentsList()};new MyDatePaginator("#rlob-datepaginator-choice",$scope.selectedFilter.var1,datePaginatorChanged)},$scope.updateAppoinmentsList(),$scope.selectAppointmentCalendar=function(appointmentCalendar,RL_TYPE_ID,Specialties_id){appointmentCalendar.RL_TYPE_ID=RL_TYPE_ID,appointmentCalendar.Specialties_id=Specialties_id,$scope.selectedAppointmentCalendar=appointmentCalendar}}}}).directive("rlobChooseAppointmentMobileCalendar",function(){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{bookingType:"=",selectedAppointmentCalendar:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_choose_appointment_calendar_mobile_template.html",controller:"rlobCalendarMobileMasterController"}}).directive("rlobChooseAppointmentMobileCalendarPatient",function(){return{restrict:"E",required:["^ngModel"],scope:{bookingType:"=",selectedAppointmentCalendar:"=",patientInfoCalendar:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_choose_appointment_calendar_mobile_patient_template.html",controller:"rlobCalendarMobileMasterController"}}).directive("rlobBookingReport",function(){return{restrict:"E",transclude:!0,scope:{list:"=",listStatus:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_booking_report_template.html"}}).directive("rlobAdminLocalNotification",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{actionCenter:"=",groupName:"@"},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_admin_local_notification_template.html",controller:function($scope,rlobService,$cookieStore,$window,Mailto,$q){$scope.listBookingNotification=[],$scope.bookingType=rlobConstant.bookingType.REDiLEGAL.name,$scope.localNotificationType={type1:{header:"Need To Change Status",alias:"passBookingNotChangeStatus"},type2:{header:"Waiting On Paperwork",alias:"upcommingBookingHaveNotDucment"},type3:{header:"Outstanding",alias:"passBookingHaveNotResult"}},$scope.documentStatusDisplay=rlobConstant.documentStatusDisplay,$scope.listPassBookingNotChangeStatus=[],$scope.getPassBookingNotChangeStatus=function(doctorId){rlobService.getPassBookingNotChangeStatus($scope.bookingType,doctorId).then(function(data){"success"==data.status&&($scope.listPassBookingNotChangeStatus=data.data)},function(error){})},$scope.updatePassBookingNotChangeStatus=function(doctorId){rlobService.getPassBookingNotChangeStatus($scope.bookingType,doctorId).then(function(data){"success"==data.status&&($scope.listPassBookingNotChangeStatus=data.data,$scope.listBookingNotification=$scope.listPassBookingNotChangeStatus)},function(error){})},$scope.listUpcommingBookingWaitingPaperwork=[],$scope.getListUpcommingBookingWaitingPaperwork=function(doctorId){rlobService.getListUpcommingBookingWaitingPaperwork($scope.bookingType,doctorId).then(function(data){console.log(data),"success"==data.status&&($scope.listUpcommingBookingWaitingPaperwork=data.data)},function(error){})},$scope.updateListUpcommingBookingWaitingPaperwork=function(doctorId){rlobService.getListUpcommingBookingWaitingPaperwork($scope.bookingType,doctorId).then(function(data){console.log(data),"success"==data.status&&($scope.listUpcommingBookingWaitingPaperwork=data.data,$scope.listBookingNotification=$scope.listUpcommingBookingWaitingPaperwork)},function(error){})},$scope.listBookingOutstandingNotification=[],$scope.getListBookingOutstandingNotification=function(doctorId){rlobService.getListBookingOutstandingNotification($scope.bookingType,doctorId).then(function(data){"success"==data.status&&($scope.listBookingOutstandingNotification=data.data)},function(error){})},$scope.updateListBookingOutstandingNotification=function(doctorId){rlobService.getListBookingOutstandingNotification($scope.bookingType,doctorId).then(function(data){"success"==data.status&&($scope.listBookingOutstandingNotification=data.data,$scope.listBookingNotification=$scope.listBookingOutstandingNotification)},function(error){})},$scope.currentNotificationType=null,$scope.showListBookingNotification=function(notificationType){switch($scope.currentNotificationType=notificationType,notificationType){case $scope.localNotificationType.type1.alias:$scope.listBookingNotification=$scope.listPassBookingNotChangeStatus,$scope.listBookingNotificationHeader=$scope.localNotificationType.type1.header;break;case $scope.localNotificationType.type2.alias:$scope.listBookingNotification=$scope.listUpcommingBookingWaitingPaperwork,$scope.listBookingNotificationHeader=$scope.localNotificationType.type2.header;break;case $scope.localNotificationType.type3.alias:$scope.listBookingNotification=$scope.listBookingOutstandingNotification,$scope.listBookingNotificationHeader=$scope.localNotificationType.type3.header}$("#list_booking_admin_local_notification").modal({show:!0,backdrop:"static"})},$scope.documentStatusChangedFlag=0,$scope.$watch("documentStatusChangedFlag",function(newValue,oldValue){$scope.documentStatusChangedFlag&&$scope.updateListUpcommingBookingWaitingPaperwork()}),$("#list_booking_admin_local_notification").on("hidden.bs.modal",function(e){$scope.actionCenter[$scope.groupName].runWhenChanged()}),$scope.updateAdminLocalNotification=function(){var doctorId=$scope.doctorInfo?$scope.doctorInfo.doctor_id:null;$scope.getPassBookingNotChangeStatus(doctorId),$scope.getListUpcommingBookingWaitingPaperwork(doctorId),$scope.getListBookingOutstandingNotification(doctorId)},$scope.userInfo=$cookieStore.get("userInfo"),$scope.doctorInfo=null,$scope.getDoctorInfoByUserId=function(){var deferred=$q.defer();return rlobService.getDoctorInfoByUserId($scope.userInfo.id).then(function(data){"success"==data.status&&($scope.doctorInfo=data.data)},function(err){console.log("Khong the lay thong tin doctor")}).then(function(){deferred.resolve()}),deferred.promise},$scope.userInfo.user_type==rlobConstant.userType.doctor?$scope.getDoctorInfoByUserId().then($scope.updateAdminLocalNotification):$scope.updateAdminLocalNotification(),$scope.actionCenter.scheduleList.rlobUpdateAdminLocalNotification=$scope.updateAdminLocalNotification,$scope.setSlimCroll=function(selector){$(selector).slimscroll({})},$scope.$watch("listBookingNotification",function(oldValue,newValue){$scope.selectedBooking&&($scope.selectedBooking=void 0)}),$scope.setSelectedBooking=function(bookingId){rlobService.getBookingById(bookingId).then(function(data){"success"==data.status&&($scope.selectedBooking=data.data)},function(error){})},$scope.isAdminGetFiles=!0,$scope.isAdminUpload=!0,$scope.accordionStatus={status1:!0},$scope.newsletter=function(){$scope.emailContent="{Title} Redimed Medico-Legal Newsletter\n\n{Title} News\nSection for us to easily update\n{Title} Appointment Availability\nSection for us to easily update\nContact Medico-Legal Department at Redimed on (08) 9230 0900 or log to the online booking system link\n",rlobService.listMailUserOnlineBooking().then(function(data){if("success"==data.status){var recepient=data.data,options={subject:"Medico-Legal Newsletter",body:$scope.emailContent,bcc:recepient};console.log(recepient),$scope.mailtoLink=Mailto.url("",options),$window.location.href=$scope.mailtoLink}})}}}}).directive("rlobChangeBookingStatus",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedBooking:"=",bookingStatusChangedFlag:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_booking_change_status_template.html",controller:function($scope){$scope.bookingStatus=rlobConstant.bookingStatus,$scope.bookingStatusDisplay=rlobConstant.bookingStatusDisplay,$scope.rlob_change_status=function(assId,bookingId,bookingType,status){$scope.selectedBooking.STATUS==$scope.bookingStatus.cancel?rlobService.selectAppointment($scope.selectedBooking.CAL_ID).then(function(data){null===data.data.NOTES?rlobService.undoCancelBooking($scope.selectedBooking.CAL_ID,$scope.selectedBooking.PATIENT_ID).then(function(data){"success"==data.status?rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){$scope.selectedBooking.STATUS=status,$scope.bookingStatusChangedFlag||($scope.bookingStatusChangedFlag=0),$scope.bookingStatusChangedFlag=$scope.bookingStatusChangedFlag+1;var refId=bookingId;rlobService.add_notification(assId,refId,bookingType,rlobConstant.bellType.changeStatus,rlobConstant.notificationType.bell,status),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Change booking status success.")}else rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")}):status==$scope.bookingStatus.cancel?rlobService.cancelBooking($scope.selectedBooking.CAL_ID,$scope.selectedBooking.PATIENT_ID).then(function(data){"success"==data.status?rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){$scope.selectedBooking.STATUS=status,$scope.bookingStatusChangedFlag||($scope.bookingStatusChangedFlag=0),$scope.bookingStatusChangedFlag=$scope.bookingStatusChangedFlag+1;var refId=bookingId;rlobService.add_notification(assId,refId,bookingType,rlobConstant.bellType.changeStatus,rlobConstant.notificationType.bell,status),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Change booking status success.")}else rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")}):rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){$scope.selectedBooking.STATUS=status,$scope.bookingStatusChangedFlag||($scope.bookingStatusChangedFlag=0),$scope.bookingStatusChangedFlag=$scope.bookingStatusChangedFlag+1;var refId=bookingId;rlobService.add_notification(assId,refId,bookingType,rlobConstant.bellType.changeStatus,rlobConstant.notificationType.bell,status),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Change booking status success.")}else rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change booking status fail.")})}}}}).directive("rlobChoosePeriod",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{fromDate:"=",toDate:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_choose_period.html",controller:function($scope){$scope.showDialogChoose=function(){$scope.fromDate&&$scope.toDate&&($scope.FROM_DATE_TEMP=moment($scope.fromDate,"YYYY/MM/DD").toDate(),$scope.TO_DATE_TEMP=moment($scope.toDate,"YYYY/MM/DD").toDate()),$("#choose-period-dialog").modal({show:!0,backdrop:"static"})},$scope.$watch("[FROM_DATE_TEMP,TO_DATE_TEMP]",function(newValue,oldValue){$scope.FROM_DATE_TEMP&&$scope.TO_DATE_TEMP&&($scope.FROM_DATE_TEMP>$scope.TO_DATE_TEMP?($scope.localError=!0,$scope.hadForcused=!0):$scope.localError=!1)},!0),$scope.FROM_DATE_TEMP=null,$scope.TO_DATE_TEMP=null,$scope.localError=!1,$scope.periodDisplay="ALL",$scope.getPeriod=function(){if($scope.hadForcused=!0,!$scope.choosePeriodForm.$invalid&&null!=$scope.FROM_DATE_TEMP&&null!=$scope.TO_DATE_TEMP){if($scope.FROM_DATE_TEMP>$scope.TO_DATE_TEMP)return void($scope.localError=!0);$scope.localError=!1,$scope.fromDate=moment($scope.FROM_DATE_TEMP).format("YYYY/MM/DD"),$scope.toDate=moment($scope.TO_DATE_TEMP).format("YYYY/MM/DD"),$scope.periodDisplay=moment($scope.FROM_DATE_TEMP).format("DD/MM/YY")+"-"+moment($scope.TO_DATE_TEMP).format("DD/MM/YY"),$("#choose-period-dialog").modal("hide")}},$scope.resetDate=function(){$scope.FROM_DATE_TEMP=null,$scope.TO_DATE_TEMP=null,$scope.fromDate="",$scope.toDate="",$scope.localError=!1,$scope.hadForcused=!1,$scope.periodDisplay="ALL"},$scope.reset=function(){$scope.resetDate(),$("#choose-period-dialog").modal("hide")}}}}).directive("rlobChangeDocumentStatus",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{selectedDocument:"=",documentStatusChangedFlag:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_document_change_status_template.html",controller:function($scope){$scope.documentStatus=rlobConstant.documentStatus,$scope.documentStatusDisplay=rlobConstant.documentStatusDisplay,$scope.rlob_document_change_status=function(bookingId,status){rlobService.changeDocumentStatus(bookingId,status).then(function(data){"success"==data.status&&($scope.selectedDocument.DOCUMENT_STATUS=status,$scope.documentStatusChangedFlag||($scope.documentStatusChangedFlag=0),$scope.documentStatusChangedFlag=$scope.documentStatusChangedFlag+1)})}}}}).directive("rlobSendClientMessage",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{actionCenter:"=",selectedBooking:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_send_client_message.html",controller:function($scope,rlobService){$scope.showDialogSendBookingMessage=function(){$scope.bookingMessage={},$scope.bookingMessage.assId=$scope.selectedBooking.ASS_ID,$scope.bookingMessage.bookingId=$scope.selectedBooking.BOOKING_ID,$("#rlob-send-client-message").modal({show:!0,backdrop:"static"})},$scope.sendBookingMessage=function(){rlobService.add_notification($scope.bookingMessage.assId,$scope.bookingMessage.bookingId,rlobConstant.bookingType.REDiLEGAL.name,rlobConstant.bellType.message,rlobConstant.notificationType.bell,$scope.bookingMessage.message),$("#rlob-send-client-message").modal("hide")},rlobService.getListBookingMessages().then(function(data){"success"==data.status&&($scope.ListBookingMessages=data.data)}),$scope.check=function(data){$scope.bookingMessage.message=data},$scope.actionCenter.sendClientMessage=function(){$scope.showDialogSendBookingMessage()}}}}).directive("rlobChangeBookingCalendar",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{actionCenter:"=",groupName:"@",selectedBooking:"=",currentUpdatingItem:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_change_booking_calendar.html",controller:function($scope,rlobService){$scope.bookingType=rlobConstant.bookingType.REDiLEGAL.name,$scope.currentUpdatingItem.bookingId=null,$scope.currentUpdatingItem.calId=null,$scope.currentUpdatingItem.appointmentDateTime=null,$scope.currentUpdatingItem.newAppoimentDateTime=null,$scope.currentUpdatingItem.bookingIdChangeSuccess=null,$scope.currentUpdatingItem.assId=null,$scope.currentUpdatingItem.newCalId=null,$("#rlob_change_booking_calendar_dialog").on("shown.bs.modal",function(e){$scope.usingForDialogFlag||($scope.usingForDialogFlag=0),$scope.usingForDialogFlag=$scope.usingForDialogFlag+1}),$scope.actionCenter[$scope.groupName].showDialog=function(){$("#rlob_change_booking_calendar_dialog").modal({show:!0,backdrop:"static"}),$scope.currentUpdatingItem.bookingId=$scope.selectedBooking.BOOKING_ID,$scope.currentUpdatingItem.calId=$scope.selectedBooking.CAL_ID,$scope.currentUpdatingItem.appointmentDateTime=$scope.selectedBooking.APPOINTMENT_DATE,$scope.currentUpdatingItem.assId=$scope.selectedBooking.ASS_ID},$scope.$watch("selectedAppointmentCalendar",function(oldValue,newValue){if($scope.selectedAppointmentCalendar){var handlePeriodInfo={doctorId:$scope.selectedAppointmentCalendar.DOCTOR_ID,siteId:$scope.selectedAppointmentCalendar.SITE_ID,selectedAppFromTime:$scope.selectedAppointmentCalendar.FROM_TIME,rlTypeId:$scope.selectedAppointmentCalendar.RL_TYPE_ID,oldCalId:$scope.currentUpdatingItem.calId};rlobService.core.checkPeriodTimeToBooking(handlePeriodInfo).then(function(data){"success"==data.status?$scope.changeAppointmentCalendar($scope.selectedAppointmentCalendar.CAL_ID,$scope.selectedAppointmentCalendar.FROM_TIME,$scope.selectedAppointmentCalendar.DOCTOR_ID,$scope.selectedAppointmentCalendar.SITE_ID,$scope.selectedAppointmentCalendar.RL_TYPE_ID,$scope.selectedAppointmentCalendar.Specialties_id):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Not enough time.")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Check fail.")})}}),$scope.changeAppointmentCalendar=function(newCalId,newAppointmentDateTime,doctorId,siteId,rlTypeId,specialityId){var actionInfo={oldCalId:$scope.selectedBooking.CAL_ID,newCalId:newCalId,patientId:$scope.selectedBooking.PATIENT_ID,doctorId:doctorId,siteId:siteId,appointmentDate:newAppointmentDateTime,rlTypeId:rlTypeId,specialtyId:specialityId,bookingId:$scope.currentUpdatingItem.bookingId};rlobService.core.changeBookingCalendar(actionInfo).then(function(data){if("success"==data.status){$("#rlob_change_booking_calendar_dialog").modal("hide"),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Change appointment calendar success."),$scope.currentUpdatingItem.newAppoimentDateTime=newAppointmentDateTime,
$scope.currentUpdatingItem.bookingIdChangeSuccess=$scope.currentUpdatingItem.bookingId,$scope.currentUpdatingItem.newCalId=newCalId;var mapUrl=null,siteAddress=$scope.selectedBooking.Site_addr,bookingId=$scope.selectedBooking.BOOKING_ID;GMaps.geocode({address:siteAddress,callback:function(results,status){"OK"==status?(latlng1=results[0].geometry.location,mapUrl=GMaps.staticMapURL({lat:latlng1.lat(),lng:latlng1.lng(),markers:[{lat:latlng1.lat(),lng:latlng1.lng()}]}),handle()):handle()}});var handle=function(){rlobService.core.rescheduleConfirmEmail(bookingId,siteAddress,mapUrl)};$scope.actionCenter[$scope.groupName].runWhenSuccess()}else rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change fail.")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Change fail.")})}}}}).directive("rlobInlineMessage",function(rlobService){return{restrict:"E",transclude:!0,required:["^ngModel"],scope:{message:"@",type:"="},templateUrl:"modules/rediLegalOnlineBooking/directives/rlob_fade_in_out_template.html",controller:function($scope){angular.element(".rlob_fade_in_out").fadeIn(2e3)}}}).directive("showErrors",function($timeout,showErrorsConfig){var getShowSuccess,linkFn;return getShowSuccess=function(options){var showSuccess;return showSuccess=showErrorsConfig.showSuccess,options&&null!=options.showSuccess&&(showSuccess=options.showSuccess),showSuccess},linkFn=function(scope,el,attrs,formCtrl){var blurred,inputEl,inputName,inputNgEl,options,showSuccess,toggleClasses;if(blurred=!1,options=scope.$eval(attrs.showErrors),showSuccess=getShowSuccess(options),inputEl=el[0].querySelector("[name]"),inputNgEl=angular.element(inputEl),inputName=inputNgEl.attr("name"),!inputName)throw"show-errors element has no child input elements with a 'name' attribute";return inputNgEl.bind("blur",function(){return blurred=!0,toggleClasses(formCtrl[inputName].$invalid)}),scope.$watch(function(){return formCtrl[inputName]&&formCtrl[inputName].$invalid},function(invalid){return blurred?toggleClasses(invalid):void 0}),scope.$on("show-errors-check-validity",function(){return toggleClasses(formCtrl[inputName].$invalid)}),scope.$on("show-errors-reset",function(){return $timeout(function(){return el.removeClass("has-error"),el.removeClass("has-success"),blurred=!1},0,!1)}),toggleClasses=function(invalid){return el.toggleClass("has-error",invalid),showSuccess?el.toggleClass("has-success",!invalid):void 0}},{restrict:"A",require:"^form",compile:function(elem,attrs){if(!elem.hasClass("form-group"))throw"show-errors element does not have the 'form-group' class";return linkFn}}}).provider("showErrorsConfig",function(){var _showSuccess;_showSuccess=!1,this.showSuccess=function(showSuccess){return _showSuccess=showSuccess},this.$get=function(){return{showSuccess:_showSuccess}}}),angular.module("app.loggedIn.rlob.services",[]).service("appointmentCalendarService",function(){var selectedAppointmentCalendar={};this.setSelectedAppointmentCalendar=function(appointment){selectedAppointmentCalendar=appointment},this.getSelectedAppointmentCalendar=function(){return selectedAppointmentCalendar}}).service("bookingService",function(){var selectedInfo={},bookingInfo={},bookingList=[],registerInfo={},bookingInfoReuse=null,bookingBehalfInfo=null,currentBookingUpdating=null;this.getRegisterInfo=function(){return registerInfo},this.setRegisterInfo=function(b){registerInfo=JSON.parse(JSON.stringify(b))},this.getSelectedInfo=function(){return selectedInfo},this.getBookingInfo=function(){return bookingInfo},this.setBookingInfo=function(b){bookingInfo=JSON.parse(JSON.stringify(b))},this.getBookingList=function(){return bookingList},this.setBookingInfoReuse=function(booking){bookingInfoReuse=angular.copy(booking)},this.getBookingInfoResuse=function(){return bookingInfoReuse},this.setBookingBehalfInfo=function(b){bookingBehalfInfo=b},this.getBookingBehalfInfo=function(){return bookingBehalfInfo},this.setCurrentBookingUpdating=function(booking){currentBookingUpdating=booking},this.getCurrentBookingUpdating=function(){return currentBookingUpdating}}).factory("timeoutService",function(){var timeoutService={};return timeoutService}).factory("rlobService",function(Restangular,$http,$q){var rlobService={},api=Restangular.all("api");return rlobService.bookingInfoPaperless={id:null},rlobService.getRlTypeList=function(sourceType){var result=api.one("rlob/rl_types/list");return result.get({sourceType:sourceType})},rlobService.getBookingById=function(bookingId){var booking=api.all("rlob/rl_bookings/get-booking-by-id");return booking.post({bookingId:bookingId})},rlobService.changeBookingStatus=function(bookingId,status){var result=api.all("rlob/rl_bookings/lob-change-status");return result.post({bookingId:bookingId,status:status})},rlobService.changeDocumentStatus=function(bookingId,status){var result=api.all("rlob/rl_bookings/lob-change-documents-status");return result.post({bookingId:bookingId,status:status})},rlobService.getCountReportUpcommingBookings=function(bookingType,doctorId,filterInfo){var TotalBookings=api.all("rlob/rl_bookings/admin/report-1/count-report-upcomming-bookings");return TotalBookings.post({bookingType:bookingType,doctorId:doctorId,filterInfo:filterInfo})},rlobService.getItemsOfPageReportUpcommingBookings=function(info){var getItemsBookings=api.all("rlob/rl_bookings/admin/report-1/get-items-of-paging-report-upcomming-bookings");return getItemsBookings.post({currentPage:info.currentPage,itemsPerPage:info.itemsPerPage,bookingType:info.bookingType,doctorId:info.doctorId,filterInfo:info.filterInfo})},rlobService.getCountReportOutstandingBookings=function(bookingType,doctorId,filterInfo){var TotalBookings=api.all("rlob/rl_bookings/admin/report-2/count-report-outstanding-bookings");return TotalBookings.post({bookingType:bookingType,doctorId:doctorId,filterInfo:filterInfo})},rlobService.getItemsOfPageReportOutstandingBookings=function(info){var getItemsBookings=api.all("rlob/rl_bookings/admin/report-2/get-items-of-paging-report-outstanding-bookings");return getItemsBookings.post({currentPage:info.currentPage,itemsPerPage:info.itemsPerPage,bookingType:info.bookingType,doctorId:info.doctorId,filterInfo:info.filterInfo})},rlobService.getListBookingMessages=function(){var getListMessages=api.one("rlob/rl_messages/getListMessages");return getListMessages.get()},rlobService.addNewBookingMessages=function(messageContent){var addNewMessages=api.one("rlob/rl_messages/addNewMessages");return addNewMessages.get({messageContent:messageContent})},rlobService.changeIsenableMessage=function(ID){var changeMessages=api.one("rlob/rl_messages/changeIsenableMessages");return changeMessages.get({ID:ID})},rlobService.updateBookingMessage=function(ID,CONTENTS){var changeMessages=api.one("rlob/rl_messages/updateMessages");return changeMessages.get({ID:ID,CONTENTS:CONTENTS})},rlobService.getListDateAppoinmentCalendar=function(rlTypeId,specialtyName,doctorId,locationId,startDate,endDate,bookingType){var result=api.one("rlob/appointment-calendar/get-list-date-appointment-calendar");return result.get({RL_TYPE_ID:rlTypeId,Specialties_name:specialtyName,DOCTOR_ID:doctorId,SITE_ID:locationId,STARTDATE:startDate,ENDDATE:endDate,sourceType:bookingType})},rlobService.addNewFromAms6=function(info){var addAMS6=api.all("rlob/rl_form_ams6/addNewFormAms6");return addAMS6.post({info:info})},rlobService.updateFromAms6=function(info){var addAMS6=api.all("rlob/rl_form_ams6/rl_form_ams6_update");return addAMS6.post({info:info})},rlobService.getBookingDoctorCompany=function(BOOKING_ID){var getBooking=api.one("rlob/rl_form_ams6/get_booking_doctor_company");return getBooking.get({BOOKING_ID:BOOKING_ID})},rlobService.checkBookingInFormAms6=function(BOOKING_ID){var getMAS6=api.one("rlob/rl_form_ams6/select_Item_rl_form_ams6_bookingid");return getMAS6.get({BOOKING_ID:BOOKING_ID})},rlobService.addNewFromAms5=function(info){var addAMS5=api.all("rlob/rl_form_ams5/addNewFormAms5");return addAMS5.post({info:info})},rlobService.updateFromAms5=function(info){var addAMS5=api.all("rlob/rl_form_ams5/rl_form_ams5_update");return addAMS5.post({info:info})},rlobService.checkBookingInFormAms5=function(BOOKING_ID){var getMAS6=api.one("rlob/rl_form_ams5/select_Item_rl_form_ams5_bookingid");return getMAS6.get({BOOKING_ID:BOOKING_ID})},rlobService.addApptPatient=function(Patient_id,CAL_ID){var Patient=api.all("rlob/cln_appt_patients/add");return Patient.post({Patient_id:Patient_id,CAL_ID:CAL_ID})},rlobService.updatePatientIdBooking=function(BOOKING_ID,PATIENT_ID){var result=api.all("rlob/rl_bookings/update-patient-booking");return result.post({BOOKING_ID:BOOKING_ID,PATIENT_ID:PATIENT_ID})},rlobService.selectAppointment=function(CAL_ID){var Patient=api.one("restful/Appointment/"+CAL_ID);return Patient.get()},rlobService.cancelBooking=function(CAL_ID,PATIENT_ID){var result=api.all("rlob/rl_bookings/cancel-booking");return result.post({CAL_ID:CAL_ID,PATIENT_ID:PATIENT_ID})},rlobService.undoCancelBooking=function(CAL_ID,PATIENT_ID){var result=api.all("rlob/rl_bookings/undo-cancel-booking");return result.post({CAL_ID:CAL_ID,PATIENT_ID:PATIENT_ID})},rlobService.getlistRlType=function(){var result=api.one("rlob/rl_types/get-list-rltype");return result.get()},rlobService.updateRlTypes=function(TYPEID,TYPENAME,SOURCETYPE,ISENABLE){var result=api.all("rlob/rl_types/update-rltype");return result.post({TYPEID:TYPEID,TYPENAME:TYPENAME,SOURCETYPE:SOURCETYPE,ISENABLE:ISENABLE})},rlobService.insertRlTypes=function(TYPENAME,SOURCETYPE){var result=api.all("rlob/rl_types/insert-rltype");return result.post({TYPENAME:TYPENAME,SOURCETYPE:SOURCETYPE})},rlobService.getListSpecialties=function(){var result=api.one("rlob/cln_specialties/get-list-specialties");return result.get()},rlobService.updateSpecialties=function(SPECIALTIESID,SPECIALTIESNAME,SPECIALTIESTYPE,ISENABLE){var result=api.all("rlob/cln_specialties/update-specialties");return result.post({SPECIALTIESID:SPECIALTIESID,SPECIALTIESNAME:SPECIALTIESNAME,SPECIALTIESTYPE:SPECIALTIESTYPE,ISENABLE:ISENABLE})},rlobService.insertSpecialties=function(SPECIALTIESNAME,SPECIALTIESTYPE){var result=api.all("rlob/cln_specialties/edit-specialties");return result.post({SPECIALTIESNAME:SPECIALTIESNAME,SPECIALTIESTYPE:SPECIALTIESTYPE})},rlobService.insertEmergency=function(info){var result=api.all("rlob/sponsor/insert-emergency");return result.post({info:info})},rlobService.insertNonEmergency=function(info){var result=api.all("rlob/sponsor/insert-nonemergency");return result.post({info:info})},rlobService.listMailUserOnlineBooking=function(){var result=api.one("rlob/rl_bookings/admin/list-mail-user-online-booking");return result.get()},rlobService.listDoctorReport=function(){var result=api.one("rlob/rl_bookings/admin/report/list-doctor-report");return result.get()},rlobService.listLocationReport=function(){var result=api.one("rlob/rl_bookings/admin/report/list-location-report");return result.get()},rlobService.ListDoctorMobile=function(date){var result=api.all("rlob/doctors/get-doctors-for-source-type-mobile");return result.post({date:date})},rlobService.ListLocationMobile=function(date){var result=api.all("rlob/redimedsites/list-mobile");return result.post({date:date})},rlobService.getPassBookingNotChangeStatus=function(bookingType,doctorId){var result=api.one("rlob/rl_bookings/admin/get-pass-booking-not-change-status");return result.get({bookingType:bookingType,doctorId:doctorId})},rlobService.getListUpcommingBookingWaitingPaperwork=function(bookingType,doctorId){var result=api.one("rlob/rl_bookings/admin/get-list-upcomming-booking-waiting-paperwork");return result.get({bookingType:bookingType,doctorId:doctorId})},rlobService.getListBookingOutstandingNotification=function(bookingType,doctorId){var result=api.one("rlob/rl_bookings/admin/list-booking-outstanding-notification");return result.get({bookingType:bookingType,doctorId:doctorId})},rlobService.getCountReportArchiveBooking=function(bookingType,doctorId,searchKeys){var result=api.all("rlob/rl_bookings/admin/report-3/get-count-archive-booking");return result.post({bookingType:bookingType,doctorId:doctorId,searchKeys:searchKeys})},rlobService.getItemsOfPageReportArchiveBooking=function(info){var result=api.all("rlob/rl_bookings/admin/report-3/get-items-of-page-archive-booking");return result.post({bookingType:info.bookingType,doctorId:info.doctorId,pageIndex:info.pageIndex,itemsPerPage:info.itemsPerPage,searchKeys:info.searchKeys})},rlobService.getDocumentStatusSummary=function(fromDate,toDate){var result=api.one("rlob/rl_bookings/admin/get-document-status-summary");return result.get({fromDate:fromDate,toDate:toDate})},rlobService.add_notification=function(assId,refId,sourceName,bellType,notificationType,content){var deferred=$q.defer(),promise=deferred.promise;promise.then(function(data){var msg="";notificationType==rlobConstant.notificationType.letter?msg="["+rlobConstant.bookingType[sourceName].display+"] - "+data.Rl_TYPE_NAME+" - "+data.WRK_SURNAME+" - "+(sourceName==rlobConstant.bookingType.REDiLEGAL.name?data.CLAIM_NO:"")+(sourceName==rlobConstant.bookingType.Vaccination.name?data.EMPLOYEE_NUMBER:"")+" - "+moment(data.APPOINTMENT_DATE).format("HH:mm DD/MM/YYYY"):notificationType==rlobConstant.notificationType.bell&&(msg=moment(data.APPOINTMENT_DATE).format("HH:mm DD/MM/YYYY")+" - "+data.Rl_TYPE_NAME+" - "+data.WRK_SURNAME+" - "+data.WRK_OTHERNAMES+" - "+data.CLAIM_NO+" - "+bellType+(void 0!=content&&null!=content&&""!=content?":"+content:"")),$http({method:"POST",url:"/api/rlob/sys_user_notifications/add-notification",data:{assId:assId,refId:refId,sourceName:sourceName,type:notificationType,msg:msg}}).success(function(data){"success"==data.status}).error(function(data){})["finally"](function(){})},function(reason){}),$http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:refId}}).success(function(data){"success"==data.status?deferred.resolve(data.data):alert("data not exist!")}).error(function(data){console.log("error")})["finally"](function(){})},rlobService.showNotificationPopup=function(styleClass,msg,notifyColor){$(styleClass).notify({message:{text:msg},type:notifyColor}).show()},rlobService.checkNotificationExist=function(bookingId,bookingType,appearance){var result=api.one("rlob/sys_user_notifications/check-notification-exist");return result.get({bookingType:bookingType,bookingId:bookingId,appearance:appearance})},rlobService.recreateNotification=function(bookingId,appearance){var result=api.one("rlob/sys_user_notifications/recreate-notification");return result.get({bookingId:bookingId,appearance:appearance})},rlobService.insertNewUser=function(newUser){var result=api.all("rlob/register/insert-new-user");return result.post({newUser:newUser})},rlobService.getUsersList=function(searchInfo){var result=api.all("rlob/register/list-redilegal-users");return result.post({searchInfo:searchInfo})},rlobService.updateRedilegalUserStatus=function(redilegalUserName,status){var result=api.all("rlob/register/update-redilegal-user-status");return result.post({redilegalUserName:redilegalUserName,status:status})},rlobService.updateUserInfo=function(updateInfo){var result=api.all("rlob/register/update-user-info");return result.post({updateInfo:updateInfo})},rlobService.getUpcommingBookingHaveNotDocumentToNotificationCustomer=function(bookingType){var result=api.one("rlob/rl_bookings/get-upcomming-booking-have-not-document-to-notification-customer");return result.get({bookingType:bookingType})},rlobService.getStates=function(nation){var result=api.one("rlob/register/get-states");return result.get({nation:nation})},rlobService.getDoctorInfoByUserId=function(userId){var result=api.one("rlob/doctors/get-doctors-info-by-userid");return result.get({userId:userId})},rlobService.core={getListAppointmentAfterTime:function(doctorId,siteId,selectedAppFromTime){var result=api.all("rlob/core/get-list-appointment-after-time");return result.post({doctorId:doctorId,siteId:siteId,selectedAppFromTime:selectedAppFromTime})},handlePeriodTimeAppointmentCalendar:function(doctorId,siteId,selectedAppFromTime,rlTypeId){var result=api.all("rlob/core/handle-periodtime-appointment-calendar");return result.post({doctorId:doctorId,siteId:siteId,selectedAppFromTime:selectedAppFromTime,rlTypeId:rlTypeId})},saveBookingInfo:function(bookingInfo){var result=api.all("rlob/core/save-booking-info");return result.post({bookingInfo:bookingInfo})},checkPeriodTimeToBooking:function(handlePeriodInfo){var result=api.all("rlob/core/check-period-time-to-booking");return result.post({handlePeriodInfo:handlePeriodInfo})},changeBookingCalendar:function(actionInfo){var result=api.all("rlob/core/handle-change-booking-calendar");return result.post({actionInfo:actionInfo})},rescheduleConfirmEmail:function(bookingId,siteAddress,mapUrl){var result=api.all("rlob/core/reschedule-confirm-email");return result.post({bookingId:bookingId,siteAddress:siteAddress,mapUrl:mapUrl})}},rlobService.rlobBookingFile={setListResultFiles:function(listResult){var result=api.all("rlob/core/set-list-result-files");return result.post({listResult:listResult})},unselectAllFileResult:function(bookingId){var result=api.all("rlob/core/unselect-all-file-result");return result.post({bookingId:bookingId})}},rlobService}),angular.module("app.loggedIn.rlob",["app.loggedIn.rlob.controller","app.loggedIn.rlob.booking.controller","app.loggedIn.rlob.list.controller","app.loggedIn.rlob.patientDetail.controller","app.loggedIn.rlob.adminBookingList.controller","app.loggedIn.rlob.bookingDetail.controller","app.loggedIn.rlob.services","app.loggedIn.rlob.directive","app.loggedIn.rlob.adminBookingReport.controller","app.loggedIn.rlob.adminBookingReport.type3.controller","app.loggedIn.rlob.adminBookingReport.type1.controller","app.loggedIn.rlob.adminBookingReport.type2.controller","app.loggedIn.rlob.adminDocumentStatusSummary.controller","app.loggedIn.rlob.adminBookingMessages.controller","app.loggedIn.rlob.paperless.controller","app.loggedIn.rlob.paperless.ams6.controller","app.loggedIn.rlob.paperless.ams5.controller","app.loggedIn.rlob.rltype.controller","app.loggedIn.rlob.specialties.controller","app.loggedIn.rlob.redilegalUsersListController.controller","app.loggedIn.rlob.bookingBehalf.controller","app.loggedIn.rlob.SpecialistsProfiles.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.rlob",{url:"/rlob",templateUrl:"modules/rediLegalOnlineBooking/views/rlob.html",controller:"rlobController"}).state("loggedIn.rlob.contactus",{url:"/contactus",templateUrl:"modules/rediLegalOnlineBooking/views/contactus.html"}).state("loggedIn.rlob.rlob_booking",{url:"/booking",templateUrl:"modules/rediLegalOnlineBooking/views/booking.html",controller:"rlob_bookingController"}).state("loggedIn.rlob.rlob_patient_detail",{url:"/booking/patient-detail",templateUrl:"/modules/rediLegalOnlineBooking/views/patient-detail.html",controller:"rlob_patientDetailController"}).state("loggedIn.rlob.rlob_admin_booking_list",{url:"/booking/admin-booking-list",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-list.html",controller:"rlob_admin_bookingListController"}).state("loggedIn.rlob.rlob_booking_list",{url:"/booking/list",templateUrl:"/modules/rediLegalOnlineBooking/views/booking-list.html",controller:"rlob_bookingListController"}).state("loggedIn.rlob.rlob_booking_detail",{url:"/booking/booking-detail/:bookingId",templateUrl:"/modules/rediLegalOnlineBooking/views/booking-detail.html",controller:"rlob_bookingDetailController"}).state("loggedIn.rlob.rlob_booking_report",{url:"/booking/report",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-report.html",controller:"rlob_admin_bookingReportController"}).state("loggedIn.rlob.rlob_booking_report.type3",{url:"/type3",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-report-type3.html",controller:"rlob_admin_bookingReport_type3Controller"}).state("loggedIn.rlob.rlob_booking_report.type1",{url:"/type1",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-report-type1.html",controller:"rlob_admin_bookingReport_type1Controller"}).state("loggedIn.rlob.rlob_booking_report.type2",{url:"/type2",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-report-type2.html",controller:"rlob_admin_bookingReport_type2Controller"}).state("loggedIn.rlob.rlob_document_status_summary",{url:"/booking/document-status-summary",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-document-status-summary.html",controller:"rlob_admin_documentStatusSummaryController"}).state("loggedIn.rlob.rlob_booking_messages",{url:"/booking/messages",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-messages.html",controller:"rlob_admin_bookingMessagesController"}).state("loggedIn.rlob.paperless",{url:"/booking/paperless",templateUrl:"/modules/rediLegalOnlineBooking/views/paperless.html",controller:"rlob_paperlessController"}).state("loggedIn.rlob.paperless.ams6",{url:"/ams6",templateUrl:"/modules/rediLegalOnlineBooking/views/paperless/ams6.html",controller:"rlob_paperless_ams6Controller"}).state("loggedIn.rlob.paperless.ams5",{url:"/ams5",templateUrl:"/modules/rediLegalOnlineBooking/views/paperless/ams5.html",controller:"rlob_paperless_ams5Controller"}).state("loggedIn.rlob.rltype",{url:"/type",templateUrl:"/modules/rediLegalOnlineBooking/views/rltype.html",controller:"rlob_rltypeController"}).state("loggedIn.rlob.specialties",{url:"/specialties",templateUrl:"/modules/rediLegalOnlineBooking/views/specialties.html",controller:"rlob_specialtiesController"}).state("loggedIn.rlob.rlob_admin_redilegalUsersList",{url:"/users-list",templateUrl:"/modules/rediLegalOnlineBooking/views/redilegalUsersList.html",controller:"rlob_admin_redilegalUsersListController"}).state("loggedIn.rlob.rlob_admin_bookingBehalf",{url:"/booking-behalf",templateUrl:"/modules/rediLegalOnlineBooking/views/bookingBehalf.html",controller:"rlob_admin_bookingBehalfController"}).state("loggedIn.rlob.rlob_specialists_profiles",{url:"/specialists-profiles",templateUrl:"/modules/rediLegalOnlineBooking/views/specialists-profiles.html",controller:"rlob_specialists_profilesController"})}),angular.module("app.loggedIn.rlob.adminBookingReport.controller",[]).controller("rlob_admin_bookingReportController",function($scope,$http,$cookieStore,$q,$state,rlobService,bookingService){$scope.currentReport={},$scope.status="Confirmed",$scope.loginInfo=$cookieStore.get("userInfo"),$scope.documentStatusDisplay=rlobConstant.documentStatusDisplay,$scope.actionCenter={},$scope.actionCenter.changeBookingCalendar={},$scope.actionCenter.adminReport={},$scope.actionCenter.scheduleList=$scope.scheduleList,$scope.actionCenter.adminLocalNotification={},$scope.reportType={report1:"report1",report2:"report2",report3:"report3"},$scope.gotoReport=function(reportType){switch(reportType){case $scope.reportType.report1:$state.go("loggedIn.rlob.rlob_booking_report.type1");break;case $scope.reportType.report2:$state.go("loggedIn.rlob.rlob_booking_report.type2");break;case $scope.reportType.report3:$state.go("loggedIn.rlob.rlob_booking_report.type3")}},$scope.selectedBooking=null,$scope.isAdminGetFiles=!0,$scope.accordionStatus={status1:!0},$scope.isAdminUpload=!0,$scope.removeSelectedBooking=function(){$scope.selectedBooking=void 0},$scope.setSelectedBooking=function(bookingId){rlobService.getBookingById(bookingId).then(function(data){"success"==data.status?$scope.selectedBooking=data.data:rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Cannot get booking info!")},function(error){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Cannot get booking info!")})},$scope.documentStatusChangedFlag=0,$scope.bookingStatusChangedFlag=0,$scope.copyBooking=function(){var bookingBehalfInfo={ASS_SURNAME:$scope.selectedBooking.ASS_SURNAME,ASS_OTHERNAMES:$scope.selectedBooking.ASS_OTHERNAMES,ASS_CONTACT_NO:$scope.selectedBooking.ASS_CONTACT_NO,ASS_EMAIL:$scope.selectedBooking.ASS_EMAIL,ASS_ID:$scope.selectedBooking.ASS_ID,COMPANY_ID:$scope.selectedBooking.COMPANY_ID};bookingService.setBookingBehalfInfo(bookingBehalfInfo),bookingService.setBookingInfoReuse($scope.selectedBooking),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Please choose appointment calendar!"),$state.go("loggedIn.rlob.rlob_booking")},$scope.currentUpdatingItem={bookingId:null,calId:null,appointmentDateTime:null,newAppoimentDateTime:null,bookingIdChangeSuccess:null,assId:null,newCalId:null},$scope.actionCenter.changeBookingCalendar.runWhenSuccess=function(){switch($scope.currentReport.name){case $scope.reportType.report1:$scope.actionCenter.adminReport.reloadReport1();break;case $scope.reportType.report2:$scope.actionCenter.adminReport.reloadReport2();break;case $scope.reportType.report3:$scope.actionCenter.adminReport.reloadReport3()}},$scope.actionCenter.adminLocalNotification.runWhenChanged=function(){switch($scope.currentReport.name){case $scope.reportType.report1:$scope.actionCenter.adminReport.reloadReport1();break;case $scope.reportType.report2:$scope.actionCenter.adminReport.reloadReport2();break;case $scope.reportType.report3:$scope.actionCenter.adminReport.reloadReport3()}}}),angular.module("app.loggedIn.rlob.adminBookingMessages.controller",[]).controller("rlob_admin_bookingMessagesController",function($scope,rlobService,toastr){$scope.editMessageContent="",$scope.setListMessagess=function(){rlobService.getListBookingMessages().then(function(data){"success"==data.status&&($scope.ListBookingMessages=data.data)})},$scope.setListMessagess(),$scope.showModalAddNew=function(){$("#addNewModal").modal("show")},$scope.submitAddNewMessage=function(){rlobService.addNewBookingMessages($scope.messageContent).then(function(data){"success"==data.status?($scope.setListMessagess(),$scope.messageContent="",$("#addNewModal").modal("hide"),toastr.success("Add Message Successfully!","Success")):($("#addNewModal").modal("hide"),toastr.error("Add Message Failed!","Error"))})},$scope.changeIsenableBookingMessage=function(ID){rlobService.changeIsenableMessage(ID).then(function(data){"success"==data.status?($scope.setListMessagess(),toastr.success("Delete Successfully!","Success")):toastr.error("Delete Failed!","Error")})},$scope.editBookingMessage=function(ID,CONTENTS){$scope.editMessageID=ID,$scope.editMessageContent=CONTENTS,$("#editModal").modal("show")},$scope.submitEditMessage=function(){rlobService.updateBookingMessage($scope.editMessageID,$scope.editMessageContent).then(function(data){"success"==data.status?($scope.setListMessagess(),$("#editModal").modal("hide"),toastr.success("Edit Successfully!","Success")):($("#editModal").modal("hide"),toastr.error("Edit Failed!","Error"))})}}),angular.module("app.loggedIn.rlob.adminBookingReport.type3.controller",[]).controller("rlob_admin_bookingReport_type3Controller",function($scope,$http,$cookieStore,$q,rlobService){$scope.removeSelectedBooking(),$scope.currentReport.name="report3",$scope.status="Confirmed",$scope.bookingStatus=rlobConstant.bookingStatus,$scope.documentStatus=rlobConstant.documentStatusFilter,$scope.rlTypeList=[],rlobService.getRlTypeList($scope.bookingType).then(function(data){$scope.rlTypeList=data}),$scope.doctorList=[],rlobService.listDoctorReport().then(function(data){"success"==data.status&&($scope.doctorList=data.data)}),$scope.locationList=[],rlobService.listLocationReport().then(function(data){"success"==data.status&&($scope.locationList=data.data)}),$scope.listArchiveBookings=[],$scope.getReportArchiveBooking=function(doctorId){rlobService.getReportArchiveBooking($scope.bookingType,doctorId).then(function(data){"success"==data.status&&($scope.listArchiveBookings=data.data)},function(error){})},$scope.currentPage=1,$scope.searchKeys={doctor:"",location:"",surname:"",rltype:"",fromAppointmentDate:"",toAppointmentDate:"",bookingStatus:"",documentStatus:""},$scope.initPagingReportArchiveBooking=function(doctorId){$scope.removeSelectedBooking(),$scope.searchKeys.rltype=$scope.rlTypeSelected&&$scope.rlTypeSelected.Rl_TYPE_NAME?$scope.rlTypeSelected.Rl_TYPE_NAME:"",$scope.searchKeys.location=$scope.locationSelected&&$scope.locationSelected.Site_name?$scope.locationSelected.Site_name:"",$scope.searchKeys.doctor=$scope.doctorSelected&&$scope.doctorSelected.NAME?$scope.doctorSelected.NAME:"",rlobService.getCountReportArchiveBooking($scope.bookingType,doctorId,$scope.searchKeys).then(function(data){return $scope.totalItems=data.data.count_archive_bookings,$scope.itemsPerPage=10,$scope.maxSize=10,$scope.currentPage=1,{bookingType:$scope.bookingType,doctorId:doctorId,pageIndex:$scope.currentPage,itemsPerPage:$scope.itemsPerPage,searchKeys:$scope.searchKeys}}).then(rlobService.getItemsOfPageReportArchiveBooking).then(function(data){$scope.listArchiveBookings="success"==data.status?data.data:""})},$scope.pagingHandlerArchiveBooking=function(){$scope.removeSelectedBooking();var info={bookingType:$scope.bookingType,doctorId:$scope.doctorId,pageIndex:$scope.currentPage,itemsPerPage:$scope.itemsPerPage,searchKeys:$scope.searchKeys};rlobService.getCountReportArchiveBooking(info.bookingType,info.doctorId,info.searchKeys).then(function(data){return $scope.totalItems=data.data.count_archive_bookings,console.log($scope.totalItems),info}).then(rlobService.getItemsOfPageReportArchiveBooking).then(function(data){"success"==data.status&&($scope.listArchiveBookings=data.data)})},$scope.$watch("[searchKeys.fromAppointmentDate,searchKeys.toAppointmentDate]",function(newValue,oldValue){$scope.initPagingReportArchiveBooking($scope.doctorId)},!0),$scope.userInfo=$cookieStore.get("userInfo"),$scope.doctorInfo=null,$scope.doctorId=null,$scope.getDoctorInfoByUserId=function(){var deferred=$q.defer();return rlobService.getDoctorInfoByUserId($scope.userInfo.id).then(function(data){"success"==data.status&&($scope.doctorInfo=data.data,$scope.doctorId=$scope.doctorInfo?$scope.doctorInfo.doctor_id:null)},function(err){console.log("Loi lay thong tin doctor")}).then(function(){deferred.resolve()}),deferred.promise},$scope.getDoctorInfoByUserId().then(function(){$scope.initPagingReportArchiveBooking($scope.doctorId)}),$scope.actionCenter.adminReport.reloadReport3=function(){$scope.initPagingReportArchiveBooking()}}),angular.module("app.loggedIn.rlob.adminBookingReport.type1.controller",[]).controller("rlob_admin_bookingReport_type1Controller",function($scope,$http,$cookieStore,$q,rlobService){$scope.removeSelectedBooking(),$scope.currentReport.name="report1",$scope.status="Confirmed",$scope.bookingStatus=rlobConstant.bookingStatus,$scope.documentStatus=rlobConstant.documentStatusFilter,$scope.rlTypeList=[],rlobService.getRlTypeList($scope.bookingType).then(function(data){$scope.rlTypeList=data}),$scope.doctorList=[],rlobService.listDoctorReport().then(function(data){"success"==data.status&&($scope.doctorList=data.data)}),$scope.locationList=[],rlobService.listLocationReport().then(function(data){"success"==data.status&&($scope.locationList=data.data)}),$scope.filterInfo={Doctor:"",Surname:"",Type:"",Location:"",FromAppointmentDate:"",ToAppointmentDate:"",bookingStatus:"",documentStatus:""},$scope.initPagingReportUpcommingBooking=function(){$scope.removeSelectedBooking(),$scope.filterInfo.Type=$scope.rlTypeSelected&&$scope.rlTypeSelected.Rl_TYPE_NAME?$scope.rlTypeSelected.Rl_TYPE_NAME:"",$scope.filterInfo.Location=$scope.locationSelected&&$scope.locationSelected.Site_name?$scope.locationSelected.Site_name:"",$scope.filterInfo.Doctor=$scope.doctorSelected&&$scope.doctorSelected.NAME?$scope.doctorSelected.NAME:"",rlobService.getCountReportUpcommingBookings($scope.bookingType,$scope.doctorId,$scope.filterInfo).then(function(data){return $scope.totalItemsReport1=data.data.count_upcomming_bookings,$scope.itemsPerPageReport1=10,$scope.currentPageReport1=1,$scope.maxSizeReport1=10,{bookingType:$scope.bookingType,doctorId:$scope.doctorId,currentPage:$scope.currentPageReport1,itemsPerPage:$scope.itemsPerPageReport1,filterInfo:$scope.filterInfo}}).then(rlobService.getItemsOfPageReportUpcommingBookings).then(function(data){
if("success"==data.status){for(var i=0;i<data.data.length;i++)data.data[i].DOCUMENT_STATUS==$scope.documentStatus.checked.value?data.data[i].style_class="info":data.data[i].DOCUMENT_STATUS==$scope.documentStatus.noDocuments.value&&(data.data[i].style_class="danger");$scope.listUpcommingBookings=data.data}else $scope.listUpcommingBookings=""})},$scope.pagingHandlerUpcommingBooking=function(){var info={bookingType:$scope.bookingType,doctorId:$scope.doctorId,currentPage:$scope.currentPageReport1,itemsPerPage:$scope.itemsPerPageReport1,filterInfo:$scope.filterInfo};rlobService.getCountReportUpcommingBookings(info.bookingType,info.doctorId,$scope.filterInfo).then(function(data){return $scope.totalItemsReport1=data.data.count_upcomming_bookings,info}).then(rlobService.getItemsOfPageReportUpcommingBookings).then(function(data){if("success"==data.status){for(var i=0;i<data.data.length;i++)data.data[i].DOCUMENT_STATUS==$scope.documentStatus.checked.value?data.data[i].style_class="info":data.data[i].DOCUMENT_STATUS==$scope.documentStatus.noDocuments.value&&(data.data[i].style_class="danger");$scope.listUpcommingBookings=data.data}})},$scope.$watch("[filterInfo.FromAppointmentDate,filterInfo.ToAppointmentDate]",function(newValue,oldValue){$scope.initPagingReportUpcommingBooking()},!0),$scope.userInfo=$cookieStore.get("userInfo"),$scope.doctorInfo=null,$scope.doctorId=null,$scope.getDoctorInfoByUserId=function(){var deferred=$q.defer();return rlobService.getDoctorInfoByUserId($scope.userInfo.id).then(function(data){"success"==data.status&&($scope.doctorInfo=data.data,$scope.doctorId=$scope.doctorInfo?$scope.doctorInfo.doctor_id:null)},function(err){console.log("Loi lay thong tin doctor")}).then(function(){deferred.resolve()}),deferred.promise},$scope.getDoctorInfoByUserId().then(function(){$scope.initPagingReportUpcommingBooking()}),$scope.actionCenter.adminReport.reloadReport1=function(){$scope.initPagingReportUpcommingBooking()}}),angular.module("app.loggedIn.rlob.adminBookingReport.type2.controller",[]).controller("rlob_admin_bookingReport_type2Controller",function($scope,$http,$cookieStore,$q,rlobService){$scope.removeSelectedBooking(),$scope.currentReport.name="report2",$scope.status="Confirmed",$scope.bookingStatus=rlobConstant.bookingStatus,$scope.documentStatus=rlobConstant.documentStatusFilter,$scope.rlTypeList=[],rlobService.getRlTypeList($scope.bookingType).then(function(data){$scope.rlTypeList=data}),$scope.doctorList=[],rlobService.listDoctorReport().then(function(data){"success"==data.status&&($scope.doctorList=data.data)}),$scope.locationList=[],rlobService.listLocationReport().then(function(data){"success"==data.status&&($scope.locationList=data.data)}),$scope.filterInfo1={Surname:"",Location:"",Type:"",Doctor:"",employeeNumber:"",FromAppointmentDate:"",ToAppointmentDate:"",bookingStatus:"",documentStatus:""},$scope.initPagingReportOutstandingBooking=function(){$scope.removeSelectedBooking(),$scope.filterInfo1.Type=$scope.rlTypeSelected&&$scope.rlTypeSelected.Rl_TYPE_NAME?$scope.rlTypeSelected.Rl_TYPE_NAME:"",$scope.filterInfo1.Location=$scope.locationSelected&&$scope.locationSelected.Site_name?$scope.locationSelected.Site_name:"",$scope.filterInfo1.Doctor=$scope.doctorSelected&&$scope.doctorSelected.NAME?$scope.doctorSelected.NAME:"",rlobService.getCountReportOutstandingBookings($scope.bookingType,$scope.doctorId,$scope.filterInfo1).then(function(data){return $scope.totalItemsReport2=data.data.count_outstanding_bookings,$scope.itemsPerPageReport2=10,$scope.maxSizeReport2=10,$scope.currentPageReport2=1,{bookingType:$scope.bookingType,doctorId:$scope.doctorId,currentPage:$scope.currentPageReport2,itemsPerPage:$scope.itemsPerPageReport2,filterInfo:$scope.filterInfo1}}).then(rlobService.getItemsOfPageReportOutstandingBookings).then(function(data){$scope.listOutstandingBookings="success"==data.status?data.data:""})},$scope.pagingHandlerOutstandingBooking=function(){var info={bookingType:$scope.bookingType,doctorId:$scope.doctorId,currentPage:$scope.currentPageReport2,itemsPerPage:$scope.itemsPerPageReport2,filterInfo:$scope.filterInfo1};rlobService.getCountReportOutstandingBookings(info.bookingType,info.doctorId,$scope.filterInfo1).then(function(data){return $scope.totalItemsReport2=data.data.count_outstanding_bookings,info}).then(rlobService.getItemsOfPageReportOutstandingBookings).then(function(data){"success"==data.status&&($scope.listOutstandingBookings=data.data)})},$scope.$watch("[filterInfo1.FromAppointmentDate,filterInfo1.ToAppointmentDate]",function(newValue,oldValue){$scope.initPagingReportOutstandingBooking()},!0),$scope.userInfo=$cookieStore.get("userInfo"),$scope.doctorInfo=null,$scope.doctorId=null,$scope.getDoctorInfoByUserId=function(){var deferred=$q.defer();return rlobService.getDoctorInfoByUserId($scope.userInfo.id).then(function(data){"success"==data.status&&($scope.doctorInfo=data.data,$scope.doctorId=$scope.doctorInfo?$scope.doctorInfo.doctor_id:null)},function(err){console.log("Loi lay thong tin doctor")}).then(function(){deferred.resolve()}),deferred.promise},$scope.getDoctorInfoByUserId().then(function(){$scope.initPagingReportOutstandingBooking()}),$scope.actionCenter.adminReport.reloadReport2=function(){$scope.initPagingReportOutstandingBooking()}}),angular.module("app.loggedIn.rlob.patientDetail.controller",[]).controller("rlob_patientDetailController",function($scope,$state,$http,$cookieStore,bookingService,appointmentCalendarService,FileUploader,Mailto,$location,$window,rlobService,PatientModel,ClaimModel){function codeAddress(){var address=selectedInfo.locationSelected.Site_addr;geocoder.geocode({address:address},function(results,status){status==google.maps.GeocoderStatus.OK?(map.setCenter(results[0].geometry.location),new google.maps.Marker({map:map,position:results[0].geometry.location})):alert("Geocode was not successful for the following reason: "+status)})}if($scope.selectedAppointmentCalendar=appointmentCalendarService.getSelectedAppointmentCalendar(),void 0===$scope.selectedAppointmentCalendar.CAL_ID||null===$scope.selectedAppointmentCalendar.CAL_ID||""===$scope.selectedAppointmentCalendar.CAL_ID)return void $state.go("loggedIn.home");var bookingInfoReuse=bookingService.getBookingInfoResuse();$scope.isCopyBooking=0,bookingInfoReuse?($scope.isCopyBooking=1,$scope.newBooking={CLAIM_NO:bookingInfoReuse.CLAIM_NO,WRK_SURNAME:bookingInfoReuse.WRK_SURNAME,WRK_OTHERNAMES:bookingInfoReuse.WRK_OTHERNAMES,WRK_EMAIL:bookingInfoReuse.WRK_EMAIL,WRK_CONTACT_NO:bookingInfoReuse.WRK_CONTACT_NO,DESC_INJURY:bookingInfoReuse.DESC_INJURY,COMPANY_ID:bookingInfoReuse.COMPANY_ID},$scope.WRK_DOB_TEMP=new Date(bookingInfoReuse.WRK_DOB),$scope.WRK_DATE_OF_INJURY_TEMP=new Date(bookingInfoReuse.WRK_DATE_OF_INJURY),bookingService.setBookingInfoReuse(null)):$scope.newBooking={},$scope.selectedAppointmentCalendar=appointmentCalendarService.getSelectedAppointmentCalendar(),angular.copy(PatientModel),angular.copy(ClaimModel),$scope.loginInfo=$cookieStore.get("userInfo");var bookingBehalfInfo=angular.copy(bookingService.getBookingBehalfInfo());null!=bookingBehalfInfo?($scope.newBooking.ASS_ID=bookingBehalfInfo.ASS_ID,$scope.newBooking.ASS_SURNAME=bookingBehalfInfo.ASS_SURNAME,$scope.newBooking.ASS_OTHERNAMES=bookingBehalfInfo.ASS_OTHERNAMES,$scope.newBooking.ASS_CONTACT_NO=bookingBehalfInfo.ASS_CONTACT_NO,$scope.newBooking.ASS_EMAIL=bookingBehalfInfo.ASS_EMAIL,$scope.newBooking.COMPANY_ID=bookingBehalfInfo.COMPANY_ID,bookingService.setBookingBehalfInfo(null)):($scope.newBooking.ASS_ID=$scope.loginInfo.id,$scope.newBooking.ASS_SURNAME=$scope.loginInfo.Booking_Person,$scope.newBooking.ASS_OTHERNAMES=$scope.loginInfo.Booking_Person,$scope.newBooking.ASS_CONTACT_NO=$scope.loginInfo.Contact_number,$scope.newBooking.ASS_EMAIL=$scope.loginInfo.Contact_email),$scope.companyId=null,$scope.companyId=null!==$scope.newBooking.COMPANY_ID&&void 0!==$scope.newBooking.COMPANY_ID?$scope.newBooking.COMPANY_ID:$scope.loginInfo.company_id,$http({method:"POST",url:"/api/company/info",data:{comId:$scope.companyId}}).success(function(data){$scope.companyInfo=data}).error(function(data){$scope.companyInfo={id:null,Company_name:"[Name of Company]"}})["finally"](function(){}),$scope.disabled=function(date,mode){return"day"===mode&&(0===date.getDay()||6===date.getDay())},$scope.toggleMin=function(){$scope.minDate=$scope.minDate?null:new Date},$scope.toggleMin(),$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.openedDateOfInjury=!1,$scope.opened=!0},$scope.openDateOfInjury=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!1,$scope.openedDateOfInjury=!0},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.formats=["d/M/yyyy","dd/MM/yyyy","dd/MMMM/yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.bookingSuccess=!1,$scope.isSaving=!1;var selectedInfo=bookingService.getSelectedInfo();$scope.booking_detail={};var locationId=$scope.selectedAppointmentCalendar.SITE_ID;$http({method:"POST",url:"/api/redimedsite/info",data:{id:locationId}}).success(function(data){selectedInfo.locationSelected=data,$scope.booking_detail.address=selectedInfo.locationSelected.Site_addr,codeAddress()}).error(function(data){alert("insert fail")})["finally"](function(){});var doctorid=$scope.selectedAppointmentCalendar.DOCTOR_ID;$http({method:"GET",url:"/api/rlob/doctors/get-doctors-by-id",params:{doctorId:doctorid}}).success(function(data){"success"==data.status&&(selectedInfo.doctorSelected=data.data,$scope.booking_detail.doctor_name=selectedInfo.doctorSelected.NAME)}).error(function(data){alert("insert fail")})["finally"](function(){});var cal_id=$scope.selectedAppointmentCalendar.CAL_ID;$http({method:"GET",url:"/api/rlob/appointment-calendar/get-by-id",params:{calId:cal_id}}).success(function(data){"success"==data.status&&(selectedInfo.selectedAppointment=data.data,$scope.from_time=moment(new Date(selectedInfo.selectedAppointment.FROM_TIME)),$scope.booking_detail.date=$scope.from_time.format("DD/MM/YYYY"),$scope.booking_detail.time=$scope.from_time.format("HH:mm"))}).error(function(data){alert("insert fail")})["finally"](function(){});var rlTypeId=$scope.selectedAppointmentCalendar.RL_TYPE_ID;$http({method:"GET",url:"/api/rlob/rl_types/get-rltype-by-id",params:{rlTypeId:rlTypeId}}).success(function(data){"success"==data.status&&(selectedInfo.rltypeSelected=data.data,$scope.booking_detail.type=selectedInfo.rltypeSelected.Rl_TYPE_NAME)}).error(function(data){alert("insert fail")})["finally"](function(){});var specialityId=$scope.selectedAppointmentCalendar.Specialties_id;$http({method:"GET",url:"/api/rlob/cln_specialties/get-speciality-by-id",params:{specialityId:specialityId}}).success(function(data){"success"==data.status&&(selectedInfo.clnSpecialitySelected=data.data)}).error(function(data){alert("insert fail")})["finally"](function(){});var geocoder,map;geocoder=new google.maps.Geocoder;var latlng=new google.maps.LatLng(-34.397,150.644),mapOptions={zoom:16,center:latlng};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),$scope.newBooking.BOOKING_ID=2e4,$http({method:"GET",url:"/api/rlob/rl_bookings/get-new-key"}).success(function(data){$scope.newBooking.BOOKING_ID=data.key}).error(function(data){alert("insert fail")})["finally"](function(){}),$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},"slow")},$scope.showMsgDialog=function(styleClass,header,status,content){$scope.msgHeader=header,$scope.msgStatus=status,$scope.msgContent=content,$(styleClass).modal({show:!0,backdrop:"static"})},$scope.sendConfirmEmail=function(){var mapUrl=null,siteAddress=selectedInfo.locationSelected.Site_addr;GMaps.geocode({address:siteAddress,callback:function(results,status){"OK"==status?(latlng1=results[0].geometry.location,mapUrl=GMaps.staticMapURL({lat:latlng1.lat(),lng:latlng1.lng(),markers:[{lat:latlng1.lat(),lng:latlng1.lng()}]}),handle()):handle()}});var handle=function(){$http({method:"POST",url:"/api/rlob/rl_bookings/admin/send-comfirm-email",data:{bookingId:$scope.newBooking.BOOKING_ID,siteAddress:siteAddress,mapUrl:mapUrl,isCopyBooking:$scope.isCopyBooking}}).success(function(data){console.log("success"==data.status?"Send email confirm success!":"Send email confirm fail!")}).error(function(data){})["finally"](function(){})}},$scope.isSaving=!1,$scope.save=function(){if(void 0==$scope.loginInfo.company_id||null==$scope.loginInfo.company_id||""==$scope.loginInfo.company_id)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the company is unknown!");if(void 0==selectedInfo.rltypeSelected.RL_TYPE_ID||null==selectedInfo.rltypeSelected.RL_TYPE_ID||""==selectedInfo.rltypeSelected.RL_TYPE_ID)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the type of injury is unknown!");if(void 0==selectedInfo.clnSpecialitySelected.Specialties_id||null==selectedInfo.clnSpecialitySelected.Specialties_id||""==selectedInfo.clnSpecialitySelected.Specialties_id)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the doctor's specialties is unknown!");if(void 0==selectedInfo.doctorSelected.doctor_id||null==selectedInfo.doctorSelected.doctor_id||""==selectedInfo.doctorSelected.doctor_id)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the doctor's name is unknown!");if(void 0==selectedInfo.locationSelected.id||null==selectedInfo.locationSelected.id||""==selectedInfo.locationSelected.id)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the site is unknown!");if(void 0==cal_id||null==cal_id||""==cal_id)return void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Create booking fail because the appointment calendar is not selected!");if($scope.$broadcast("show-errors-check-validity"),$scope.bookingForm.$invalid)return $scope.hadForcused=!0,$(".errorSummary").show(),void $scope.scrollTo($(".errorSummary"),-200);$scope.mailBodyData={requestBy:$scope.loginInfo.FIRST_NAME?$scope.loginInfo.FIRST_NAME:"",company:$scope.companyInfo.Company_name?$scope.companyInfo.Company_name:"",time:$scope.from_time.format("HH:mm"),date:$scope.from_time.format("DD/MM/YYYY"),typeOfAppointment:$scope.bookingTypeObj.display,doctor:selectedInfo.doctorSelected.NAME?selectedInfo.doctorSelected.NAME:"",address:selectedInfo.locationSelected.Site_addr?selectedInfo.locationSelected.Site_addr:"",isContactPatient:$scope.newBooking.ISCONTACTPATIENT?$scope.newBooking.ISCONTACTPATIENT:"",notes:$scope.newBooking.NOTES?$scope.newBooking.NOTES:"",claimNumber:$scope.newBooking.CLAIM_NO?$scope.newBooking.CLAIM_NO:"",wrkName:$scope.newBooking.WRK_SURNAME?$scope.newBooking.WRK_SURNAME:"",wrkDOB:moment($scope.WRK_DOB_TEMP).format("DD/MM/YYYY"),wrkContactNo:$scope.newBooking.WRK_CONTACT_NO?$scope.newBooking.WRK_CONTACT_NO:"",injuryDesc:$scope.newBooking.DESC_INJURY?$scope.newBooking.DESC_INJURY:""},$scope.emailContent="The below appointment has been requested by "+$scope.mailBodyData.requestBy+" from "+$scope.mailBodyData.company+".\n\nAppointment Details:\n\nDate: "+$scope.mailBodyData.date+"\nTime: "+$scope.mailBodyData.time+"\nType of appointment: "+selectedInfo.rltypeSelected.Rl_TYPE_NAME+"\nDoctor: "+$scope.mailBodyData.doctor+"\nAddress: "+$scope.mailBodyData.address+"\nNotes: "+$scope.mailBodyData.notes+" \n\nPatient information:\n\nClaim number: "+$scope.mailBodyData.claimNumber+"\nName: "+$scope.mailBodyData.wrkName+"\nDate of Birth: "+$scope.mailBodyData.wrkDOB+"\nContact number: "+$scope.mailBodyData.wrkContactNo+" \nInjury description: "+$scope.mailBodyData.injuryDesc+"\n";var recepient="medicolegal@redimed.com.au",options={subject:"Medico-Legal Paperwork "+$scope.mailBodyData.wrkName,body:$scope.emailContent};$scope.mailtoLink=Mailto.url(recepient,options),$scope.newBooking.BOOKING_DATE=moment().format("YYYY-MM-DD HH:mm"),$scope.newBooking.APPOINTMENT_DATE=$scope.from_time.format("YYYY-MM-DD HH:mm"),$scope.newBooking.COMPANY_ID=$scope.companyInfo.id,$scope.newBooking.RL_TYPE_ID=selectedInfo.rltypeSelected.RL_TYPE_ID,$scope.newBooking.SPECIALITY_ID=selectedInfo.clnSpecialitySelected.Specialties_id,$scope.newBooking.DOCTOR_ID=selectedInfo.doctorSelected.doctor_id,$scope.newBooking.SITE_ID=selectedInfo.locationSelected.id,$scope.newBooking.CAL_ID=cal_id,$scope.newBooking.refered_date_string=$scope.from_time.format("ddd DD/MM/YYYY HH-mm")+" "+selectedInfo.locationSelected.Site_name,$scope.newBooking.STATUS="Confirmed",$scope.newBooking.BOOKING_TYPE=$scope.bookingType,void 0!=$scope.WRK_DOB_TEMP&&null!=$scope.WRK_DOB_TEMP&&($scope.newBooking.WRK_DOB=moment($scope.WRK_DOB_TEMP).format("YYYY-MM-DD")),void 0!=$scope.WRK_DATE_OF_INJURY_TEMP&&null!=$scope.WRK_DATE_OF_INJURY_TEMP&&($scope.newBooking.WRK_DATE_OF_INJURY=moment($scope.WRK_DATE_OF_INJURY_TEMP).format("YYYY-MM-DD")),$scope.showDialogAddSuccess=function(){$("#lob-client-add-booking-success").modal({show:!0,backdrop:"static"})},$scope.uploadDocument=function(){$("#lob-client-add-booking-success").modal("hide"),$("#lob-client-send-document-dialog").modal("hide"),$("#lob-client-upload-dialog").modal({show:!0,backdrop:"static"})},$scope.sendEmail=function(){$window.location.href=$scope.mailtoLink,$("#lob-client-add-booking-success").modal("hide"),$("#lob-client-send-document-dialog").modal("hide")},$scope.showDialogSendDocument=function(){$("#lob-client-send-document-dialog").modal({show:!0,backdrop:"static"})},rlobService.core.saveBookingInfo($scope.newBooking).then(function(data){if("success"==data.status){$scope.scrollTo($(".bookingSuccess"),-200),bookingService.setBookingInfo($scope.newBooking),$scope.isSaving=!0,$scope.bookingSuccess=!0,$scope.showDialogAddSuccess(),$scope.getAppointmentCalendarUpcoming(),$scope.sendConfirmEmail();for(var i=0;i<data.data.length;i++)JSON.stringify(data.data[i])}else $scope.showMsgDialog(".patient-detail-msg-dialog","Fail","fail","Create booking fail!")},function(err){$scope.showMsgDialog(".patient-detail-msg-dialog","Fail","fail","Create booking fail!")})},$scope.filesUpdateFlag=0,$scope.$watch("filesUpdateFlag",function(newValue,oldValue){$scope.filesUpdateFlag&&$scope.filesUpdateFlag>0&&rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Upload documents success!")})}),angular.module("app.loggedIn.rlob.adminBookingList.controller",[]).controller("rlob_admin_bookingListController",function($scope,$http,$state,$window,$q,$stateParams,FileUploader,$cookieStore,$interval,rlobService,Mailto,bookingService){$scope.haveNodeFile=!1,$scope.isAdminUpload=!0,$scope.isAdminGetFiles=!0,$scope.accordionStatus={status1:!0},$scope.documentStatus=rlobConstant.documentStatusFilter,$scope.documentStatusDisplay=rlobConstant.documentStatusDisplay,$scope.actionCenter={},$scope.actionCenter.changeBookingCalendar={},$scope.actionCenter.scheduleList=$scope.scheduleList,$scope.actionCenter.adminLocalNotification={},$scope.newAppointmentPositionFlag=!1,$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},"slow")},$scope.status=!1,$scope.sourceName=$scope.bookingType,$scope.notificationType=rlobConstant.notificationType,$scope.bellType=rlobConstant.bellType,$scope.mydata=[],$scope.parseBookingList=function(data){$scope.mydata=[];var dateMaker={};dateMaker.DATE_ITEMS=[];for(var i=0;i<data.length;i++){var item=data[i];if(dateMaker[item.APPOINTMENT_DATE]||(dateMaker[item.APPOINTMENT_DATE]={DOCTOR_ITEMS:[]},dateMaker.DATE_ITEMS.push({APPOINTMENT_DATETIME:item.APPOINTMENT_DATETIME,APPOINTMENT_DATE:item.APPOINTMENT_DATE,DISPLAY:"["+item.APPOINTMENT_DATE+"]",style_class:"lob_admin_date_node"})),dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID]||(dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID]={BOOKING_ITEMS:[]},dateMaker[item.APPOINTMENT_DATE].DOCTOR_ITEMS.push({DOCTOR_ID:item.DOCTOR_ID,NAME:item.NAME,DISPLAY:"["+item.NAME+"]",style_class:"lob_admin_doctor_node"})),!dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID][item.BOOKING_ID]){dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID][item.BOOKING_ID]={BOOKING_FILE_ITEMS:[]};var styleClass="";item.DOCUMENT_STATUS==$scope.documentStatus.checked.value?styleClass="rlob_document_status_checked":item.DOCUMENT_STATUS==$scope.documentStatus.noDocuments.value&&(styleClass="rlob_document_status_no_document"),dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID].BOOKING_ITEMS.push({APPOINTMENT_TIME:item.APPOINTMENT_TIME,APPOINTMENT_DATETIME:item.APPOINTMENT_DATETIME,CAL_ID:item.CAL_ID,ASS_ID:item.ASS_ID,BOOKING_ID:item.BOOKING_ID,Company_name:item.Company_name,WRK_SURNAME:item.WRK_SURNAME,STATUS:item.STATUS,DISPLAY:"["+item.APPOINTMENT_TIME+" - "+item.Site_name+"] - ["+item.WRK_OTHERNAMES+" "+item.WRK_SURNAME+"] - ["+item.ASS_OTHERNAMES+" - "+item.Company_name+"]",DISPLAY1:"- Site: "+item.Site_name,DISPLAY2:"- Patient: "+item.WRK_SURNAME,DISPLAY3:"- Company: "+item.Company_name,DOCUMENT_STATUS:item.DOCUMENT_STATUS,style_class:styleClass})}$scope.haveNodeFile&&(null==item.FILE_ID||dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID][item.BOOKING_ID][item.FILE_ID]||(dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID][item.BOOKING_ID][item.FILE_ID]={},dateMaker[item.APPOINTMENT_DATE][item.DOCTOR_ID][item.BOOKING_ID].BOOKING_FILE_ITEMS.push({PARENT_ID:item.BOOKING_ID,ASS_ID:item.ASS_ID,FILE_ID:item.FILE_ID,FILE_NAME:item.FILE_NAME,FILE_PATH:item.FILE_PATH,isClientDownLoad:item.isClientDownLoad,DISPLAY:item.FILE_NAME,style_class:"lob_admin_booking_file_node"})))}for(var i=0;i<dateMaker.DATE_ITEMS.length;i++){var date_item=dateMaker.DATE_ITEMS[i],node={APPOINTMENT_DATETIME:date_item.APPOINTMENT_DATETIME,APPOINTMENT_DATE:date_item.APPOINTMENT_DATE,DISPLAY:date_item.DISPLAY,nodes:[],style_class:"lob_admin_date_node",IS_DATE_ITEM:"1"};node.nodes=dateMaker[date_item.APPOINTMENT_DATE].DOCTOR_ITEMS;for(var j=0;j<dateMaker[date_item.APPOINTMENT_DATE].DOCTOR_ITEMS.length;j++){var doctor_item=dateMaker[date_item.APPOINTMENT_DATE].DOCTOR_ITEMS[j];if(node.nodes[j].nodes=[],node.nodes[j].nodes=dateMaker[date_item.APPOINTMENT_DATE][doctor_item.DOCTOR_ID].BOOKING_ITEMS,$scope.haveNodeFile)for(var k=0;k<dateMaker[date_item.APPOINTMENT_DATE][doctor_item.DOCTOR_ID].BOOKING_ITEMS.length;k++){var booking_item=dateMaker[date_item.APPOINTMENT_DATE][doctor_item.DOCTOR_ID].BOOKING_ITEMS[k];node.nodes[j].nodes[k].nodes=[],node.nodes[j].nodes[k].nodes=dateMaker[date_item.APPOINTMENT_DATE][doctor_item.DOCTOR_ID][booking_item.BOOKING_ID].BOOKING_FILE_ITEMS}}$scope.mydata.push(node)}$scope.newAppointmentPositionFlag&&$scope.goToNewAppoinmentPosition()},$scope.lobAdminSearch={fromDateKey:moment().toDate(),toDateKey:moment().add(30,"d").toDate(),doctorKey:"",workerKey:"",documentStatusKey:{}},$scope.filterBooking=function(){var fromDate=moment($scope.lobAdminSearch.fromDateKey),toDate=moment($scope.lobAdminSearch.toDateKey),doctorKey=$scope.lobAdminSearch.doctorKey,workerKey=$scope.lobAdminSearch.workerKey,documentStatusKey=$scope.lobAdminSearch.documentStatusKey.value;$http({method:"GET",url:"/api/rlob/rl_bookings/admin/filter-booking",params:{fromDateKey:fromDate.format("YYYY-MM-DD"),toDateKey:toDate.format("YYYY-MM-DD"),doctorKey:doctorKey,workerKey:workerKey,documentStatusKey:documentStatusKey,doctorId:$scope.doctorInfo?$scope.doctorInfo.doctor_id:null,bookingType:$scope.bookingType}}).success(function(data){data.length<=0&&($scope.showDetailPanel=!1),$scope.parseBookingList(data)}).error(function(data){console.log("error")})["finally"](function(){})},$scope.remove=function(scope){scope.remove()},$scope.toggle=function(scope){scope.toggle()},$scope.moveLastToTheBegginig=function(){var a=$scope.data.pop();$scope.data.splice(0,0,a)},$scope.newSubItem=function(scope){var nodeData=scope.$modelValue;nodeData.nodes.push({FILE_ID:item.FILE_ID,FILE_NAME:item.FILE_NAME,FILE_PATH:item.FILE_PATH,isClientDownLoad:item.isClientDownLoad,DISPLAY:item.FILE_NAME,style_class:"lob_admin_booking_file_node"})},$scope.collapseAll=function(){$scope.$broadcast("collapseAll")},$scope.expandAll=function(){$scope.$broadcast("expandAll")},$scope.message="Right click triggered",$scope.panels=[{name:"Panel 1"},{name:"Panel 2"},{name:"Panel 3"}],$scope.addPanel=function(){$scope.panels.push({name:"Panel "+($scope.panels.length+1)})},$scope.onRightClick=function(msg){console.log(msg)},$scope.recreatePanels=function(){$scope.panels=angular.copy($scope.panels),console.log($scope.panels)},$scope.getTimeString=function(datetime){var d=moment(new Date(datetime));return d.format("HH-mm")},$scope.getShortDateString=function(datetime){var d=moment(new Date(datetime));return d.format("DD/MM/YYYY")},$scope.showBookingDetailDialog=function(bookingId){$http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:bookingId}}).success(function(data){"success"==data.status?($scope.selectedBooking=data.data,$("#view-detail-booking-dialog").modal({show:!0,backdrop:"static"})):alert("data not exist!")}).error(function(data){console.log("error")})["finally"](function(){})},$scope.lob_download_file=function(fileId){$window.location.href="/api/download/lob/document/"+fileId},$scope.show_lob_upload_file_dialog=function(bookingId,scope){$http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:bookingId}}).success(function(data){"success"==data.status?($scope.selectedBooking=data.data,$("#lob-upload-file-dialog").modal({show:!0,backdrop:"static"}),$scope.currentNode=scope.$modelValue):alert("data not exist!")}).error(function(data){console.log("error")})["finally"](function(){})},$scope.showMsgDialog=function(styleClass,header,status,content){$scope.msgHeader=header,$scope.msgStatus=status,$scope.msgContent=content,$(styleClass).modal({show:!0,backdrop:"static"})},$scope.rlob_add_notification=$scope.add_notification,$scope.bookingStatus=rlobConstant.bookingStatus,$scope.lob_change_status=function(assId,bookingId,status,scope,calID,patientID){rlobService.getBookingById(bookingId).then(function(data){return"success"==data.status?(data.data.DOCUMENT_STATUS==$scope.documentStatus.checked.value?data.data.style_class="rlob_document_status_checked":data.data.DOCUMENT_STATUS==$scope.documentStatus.noDocuments.value&&(data.data.style_class="rlob_document_status_no_document"),$scope.selectedBooking=data.data,{status:"success"}):{status:"fail"}}).then(function(data){"success"==data.status&&(console.log($scope.selectedBooking),$scope.selectedBooking.STATUS==$scope.bookingStatus.cancel?rlobService.selectAppointment($scope.selectedBooking.CAL_ID).then(function(data){null===data.data.NOTES?($scope.selectedBooking.WRK_OTHERNAMES+" "+$scope.selectedBooking.WRK_SURNAME,rlobService.undoCancelBooking(calID,patientID).then(function(data){"success"==data.status?rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){scope.$modelValue.STATUS=status,$scope.selectedBooking.STATUS=status;var refId=bookingId;$scope.rlob_add_notification(assId,refId,$scope.sourceName,$scope.bellType.changeStatus,$scope.notificationType.bell,status),angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","success","Changing status to ["+status+"] success!")}else angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!")}):(angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!"))})):(angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!"))}):status==$scope.bookingStatus.cancel?rlobService.cancelBooking(calID,patientID).then(function(data){"success"==data.status?rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){scope.$modelValue.STATUS=status,$scope.selectedBooking.STATUS=status;var refId=bookingId;$scope.rlob_add_notification(assId,refId,$scope.sourceName,$scope.bellType.changeStatus,$scope.notificationType.bell,status),angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","success","Changing status to ["+status+"] success!")}else angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!")}):(angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!"))}):rlobService.changeBookingStatus(bookingId,status).then(function(data){if("success"==data.status){scope.$modelValue.STATUS=status,$scope.selectedBooking.STATUS=status;var refId=bookingId;$scope.rlob_add_notification(assId,refId,$scope.sourceName,$scope.bellType.changeStatus,$scope.notificationType.bell,status),angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","success","Changing status to ["+status+"] success!")}else angular.element("#bookingstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Booking Status","fail","Changing status to ["+status+"] fail!")}))})},$scope.lob_change_booking_file_role=function(assId,fileId,role,scope){$http({method:"POST",url:"/api/rlob/rl_booking_files/change-role-download",data:{fileId:fileId,role:role}}).success(function(data){if("success"==data.status){scope.$modelValue.isClientDownLoad=role,$scope.showMsgDialog(".lob-msg-dialog","Authority downloads","success","Changing success! Customer"+(1==role?" can ":" cannot ")+"download this file");var refId=scope.$modelValue.PARENT_ID;1==role&&$scope.rlob_add_notification(assId,refId,$scope.sourceName,$scope.bellType.result,$scope.notificationType.letter,"")}else $scope.showMsgDialog(".lob-msg-dialog","Authority downloads","fail","Changing fail!")}).error(function(data){$scope.showMsgDialog(".lob-msg-dialog","Authority downloads","fail","Changing fail!")})["finally"](function(){})},$scope.currentUpdatingItem={bookingId:null,calId:null,appointmentDateTime:null,newAppoimentDateTime:null,bookingIdChangeSuccess:null,assId:null,newCalId:null},$scope.actionCenter.changeBookingCalendar.runWhenSuccess=function(){$scope.currentUpdatingItem.newAppoimentDateTime>=$scope.currentUpdatingItem.appointmentDateTime?($scope.lobAdminSearch.fromDateKey=moment(new Date($scope.currentUpdatingItem.appointmentDateTime)),$scope.lobAdminSearch.toDateKey=moment(new Date($scope.currentUpdatingItem.newAppoimentDateTime))):($scope.lobAdminSearch.fromDateKey=moment(new Date($scope.currentUpdatingItem.newAppoimentDateTime)),$scope.lobAdminSearch.toDateKey=moment(new Date($scope.currentUpdatingItem.appointmentDateTime))),$http({method:"GET",url:"/api/rlob/appointment-calendar/check-same-doctor",params:{calId1:$scope.currentUpdatingItem.calId,calId2:$scope.currentUpdatingItem.newCalId}}).success(function(data){"success"==data.status&&(data.data>1&&($scope.lobAdminSearch.doctorKey=null),$scope.rlob_add_notification($scope.currentUpdatingItem.assId,$scope.currentUpdatingItem.bookingId,$scope.sourceName,$scope.bellType.changeCalendar,$scope.notificationType.bell,""))}).error(function(data){console.log("error")})["finally"](function(){$scope.newAppointmentPositionFlag=!0,$scope.filterBooking()})},$scope.goToNewAppoinmentPosition=function(){$scope.currentUpdatingItem.newAppoimentDateTime>=$scope.currentUpdatingItem.appointmentDateTime?$scope.scrollTo($("#rlob_admin_begin_page"),-200):$scope.scrollTo($("#rlob_admin_end_page"),100),
$scope.newAppointmentPositionFlag=!1},$scope.newPosition="new-position",$scope.selectedFilter={locationSelected:{},rltypeSelected:{},clnSpecialitySelected:{},doctorSelected:{},var1:{}},$scope.showDetailPanel=!1,$scope.currentNodeBooking={},$scope.getBookingDetailWhenClick=function(bookingId,scope){$scope.currentNodeBooking=scope,$scope.showDetailPanel=!0,$http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:bookingId}}).success(function(data){"success"==data.status?($scope.selectedBooking=data.data,$scope.scrollTo($(".detailPanel"),-200)):alert("data not exist!")}).error(function(data){console.log("error")})["finally"](function(){})},$scope.getBookingDetailWhenCursor=function(bookingId,scope){$scope.currentNodeBooking=scope,bookingId&&rlobService.getBookingById(bookingId).then(function(data){"success"==data.status&&(data.data.DOCUMENT_STATUS==$scope.documentStatus.checked.value?data.data.style_class="rlob_document_status_checked":data.data.DOCUMENT_STATUS==$scope.documentStatus.noDocuments.value&&(data.data.style_class="rlob_document_status_no_document"),$scope.showDetailPanel=!0,$scope.selectedBooking=data.data)})},$scope.bookingstatusfadeIn=function(){angular.element("#bookingstatus").fadeIn()},$scope.bookingstatusfadeOut=function(){angular.element("#bookingstatus").fadeOut()},$scope.documentstatusfadeOut=function(){angular.element("#documentstatus").fadeOut()},$scope.documentstatusfadeIn=function(){angular.element("#documentstatus").fadeIn()},$scope.rlob_document_change_status=function(bookingId,status){rlobService.changeDocumentStatus(bookingId,status).then(function(data){if("success"==data.status){var styleClass="";status==$scope.documentStatus.checked.value?styleClass="rlob_document_status_checked":status==$scope.documentStatus.noDocuments.value&&(styleClass="rlob_document_status_no_document"),$scope.selectedBooking.DOCUMENT_STATUS=status,$scope.selectedBooking.style_class=styleClass,angular.element("#documentstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Documents Status","success","Changing status to ["+status+"] success!"),$scope.currentNodeBooking.$modelValue.style_class=styleClass}else angular.element("#documentstatus").fadeOut(),$scope.showMsgDialog(".lob-msg-dialog","Change Documents Status","fail","Changing status to ["+status+"] fail!")})},$scope.$watch("selectedBooking.BOOKING_ID",function(newValue,oldValue){newValue!==oldValue&&(angular.element("#documentstatus").fadeOut(),angular.element("#bookingstatus").fadeOut())}),$scope.setBookingIdInPaperless=function(BookingID){return null!=BookingID&&""!=BookingID?(rlobService.bookingInfoPaperless.id=BookingID,void $state.go("loggedIn.rlob.paperless")):void alert("Khong ton tai Booking ID")},$scope.copyBooking=function(){var bookingBehalfInfo={ASS_SURNAME:$scope.selectedBooking.ASS_SURNAME,ASS_OTHERNAMES:$scope.selectedBooking.ASS_OTHERNAMES,ASS_CONTACT_NO:$scope.selectedBooking.ASS_CONTACT_NO,ASS_EMAIL:$scope.selectedBooking.ASS_EMAIL,ASS_ID:$scope.selectedBooking.ASS_ID,COMPANY_ID:$scope.selectedBooking.COMPANY_ID};bookingService.setBookingBehalfInfo(bookingBehalfInfo),bookingService.setBookingInfoReuse($scope.selectedBooking),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Please choose appointment calendar!"),$state.go("loggedIn.rlob.rlob_booking")},$scope.actionCenter.adminLocalNotification.runWhenChanged=function(){$scope.filterBooking()},$scope.userInfo=$cookieStore.get("userInfo"),$scope.doctorInfo=null,$scope.getDoctorInfoByUserId=function(){var deferred=$q.defer();return rlobService.getDoctorInfoByUserId($scope.userInfo.id).then(function(data){"success"==data.status&&($scope.doctorInfo=data.data)},function(err){console.log("Khong the lay thong tin doctor")}).then(function(){deferred.resolve()}),deferred.promise},$scope.userInfo.user_type==rlobConstant.userType.doctor?$scope.getDoctorInfoByUserId().then($scope.filterBooking):$scope.filterBooking()}),angular.module("app.loggedIn.rlob.bookingDetail.controller",[]).controller("rlob_bookingDetailController",function($scope,$http,$state,$stateParams,$cookieStore){$scope.isCanUpload=!1,$scope.isAdminGetFiles=!0,$scope.isAdminUpload=!0,$scope.loginInfo=$cookieStore.get("userInfo"),$scope.bookingStatus=rlobConstant.bookingStatus,$http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:$stateParams.bookingId,userId:$scope.loginInfo.id}}).success(function(data){"success"==data.status?($scope.selectedBooking=data.data,$("#view-detail-booking-dialog").modal({show:!0,backdrop:"static"})):alert("data not exist!")}).error(function(data){console.log("error")})}),angular.module("app.loggedIn.vaccinob",["app.loggedIn.vaccinob.controller","app.loggedIn.rlob.booking.controller","app.loggedIn.rlob.list.controller","app.loggedIn.rlob.patientDetail.controller","app.loggedIn.rlob.adminBookingList.controller","app.loggedIn.rlob.bookingDetail.controller","app.loggedIn.rlob.services","app.loggedIn.rlob.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.vaccinob",{url:"/vaccinob",templateUrl:"modules/rediLegalOnlineBooking/views/vaccinob.html",controller:"vaccinobController"}).state("loggedIn.vaccinob.vaccinob_booking",{url:"/booking",templateUrl:"modules/rediLegalOnlineBooking/views/booking.html",controller:"rlob_bookingController"}).state("loggedIn.vaccinob.vaccinob_patient_detail",{url:"/booking/patient-detail",templateUrl:"/modules/rediLegalOnlineBooking/views/patient-detail.html",controller:"rlob_patientDetailController"}).state("loggedIn.vaccinob.vaccinob_booking_list",{url:"/booking/list",templateUrl:"/modules/rediLegalOnlineBooking/views/booking-list.html",controller:"rlob_bookingListController"}).state("loggedIn.vaccinob.vaccinob_admin_booking_list",{url:"/booking/admin-booking-list",templateUrl:"/modules/rediLegalOnlineBooking/views/admin-booking-list.html",controller:"rlob_admin_bookingListController"}).state("loggedIn.vaccinob.vaccinob_booking_detail",{url:"/booking/booking-detail/:bookingId",templateUrl:"/modules/rediLegalOnlineBooking/views/booking-detail.html",controller:"rlob_bookingDetailController"})});var TableEditable=function(){var handleTable=function(){var table=$("#sample_editable_1");table.dataTable({bFilter:!0,lengthMenu:[[5,15,20,-1],[5,15,20,"All"]],pageLength:10,language:{lengthMenu:" _MENU_ records"},columnDefs:[{orderable:!1,targets:[1,2]},{searchable:!1}],order:[[0,"desc"]]}).columnFilter({sPlaceHolder:"head:before",aoColumns:[{type:"text"},{type:"text"},{type:"select"},{type:"date-range"},{type:"date-range"}]})};return{init:function(){handleTable()}}}();angular.module("app.loggedIn.rlob.list.controller",[]).controller("rlob_bookingListController",function($scope,$http,$state,$stateParams,$cookieStore,FileUploader,rlobService,$window,Mailto,bookingService){$scope.isCanUpload=!0,$scope.loginInfo=$cookieStore.get("userInfo"),$scope.bookingStatus=rlobConstant.bookingStatus,$scope.documentStatus=rlobConstant.documentStatusFilter,$scope.documentStatusDisplay=rlobConstant.documentStatusDisplay,$scope.actionCenter={},$scope.actionCenter.changeBookingCalendar={},$scope.sizePageList=[{value:10,display:"10 Rows"},{value:20,display:"20 Rows"},{value:30,display:"30 Rows"},{value:40,display:"40 Rows"},{value:50,display:"50 Rows"},{value:60,display:"60 Rows"},{value:70,display:"70 Rows"},{value:80,display:"80 Rows"},{value:90,display:"90 Rows"},{value:100,display:"100 Rows"}],$scope.rl_types=[],$http({method:"GET",url:"/api/rlob/rl_types/list",params:{sourceType:$scope.bookingType}}).success(function(data){$scope.rl_types=data}).error(function(data){console.log("error")})["finally"](function(){}),$scope.goToBookingDetail=function(l){return $scope.isClickActionMenu?void($scope.isClickActionMenu=!1):void $http({method:"POST",url:"/api/rlob/rl_bookings/get-booking-by-id",data:{bookingId:l.BOOKING_ID,userId:$scope.loginInfo.id}}).success(function(data){"success"==data.status?($scope.selectedBooking=data.data,$("#view-detail-booking-dialog").modal({show:!0,backdrop:"static"})):alert("data not exist!")}).error(function(data){console.log("error")})},$scope.searchInfoMap={currentPage:1,itemsPerPage:$scope.sizePageList[0].value,totalItems:"",maxSize:15,claimNo:"",surname:"",firstName:"",fullName:"",type:"",appointmentDateFromTemp:"",appointmentDateFrom:"",appointmentDateToTemp:"",appointmentDateTo:"",bookingStatus:"",documentStatus:"",orderBy:"APPOINTMENT_DATE DESC"},$scope.list=[],$scope.pagingHandle=function(){$scope.searchInfo.appointmentDateFrom=$scope.searchInfo.appointmentDateFromTemp?moment($scope.searchInfo.appointmentDateFromTemp).format("YYYY/MM/DD"):null,$scope.searchInfo.appointmentDateTo=$scope.searchInfo.appointmentDateToTemp?moment($scope.searchInfo.appointmentDateToTemp).format("YYYY/MM/DD"):null,$http.post("/api/rlob/rl_bookings/list-bookings-for-customer",{searchInfo:$scope.searchInfo}).then(function(response){"success"==response.data.status?($scope.list=response.data.data.list,$scope.searchInfo.totalItems=response.data.data.totalItems):$scope.list=[]})},$scope.searchHandle=function(){$scope.searchInfo.currentPage=1,$scope.pagingHandle()},$scope.reset=function(){$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.pagingHandle()},$scope.sortDirect="NO_SORT",$scope.sortable={APPOINTMENT_DATE:"DESC",BOOKING_DATE:"NO_SORT"},$scope.currentFieldSort="APPOINTMENT_DATE",$scope.sortBy=function(){$scope.searchHandle()},$scope.$watch("[searchInfo.appointmentDateFromTemp,searchInfo.appointmentDateToTemp]",function(newValue,oldValue){$scope.searchInfo&&$scope.searchHandle()},!0),$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.searchHandle(),$scope.isClickActionMenu=!1,$scope.clickActionMenu=function(bookingId){$scope.isClickActionMenu=!0,rlobService.getBookingById(bookingId).then(function(data){"success"==data.status&&($scope.selectedBooking=data.data)})},$scope.printContent=function(){var printable=document.getElementsByClassName("printable");$(printable[0]).printArea()},$scope.downloadResult=function(bookingId){$window.location.href="/api/download/structure/attach-file/"+$scope.bookingType+"/"+bookingId},$scope.$watch("selectedBooking",function(newValue,oldValue){newValue!=oldValue&&$scope.updateMailTo(newValue)}),$scope.showDialogSendDocument=function(){$("#view-detail-booking-dialog").modal("hide"),$("#lob-client-send-document-dialog").modal({show:!0,backdrop:"static"})},$scope.uploadDocument=function(){$("#lob-client-send-document-dialog").modal("hide"),$("#lob-client-upload-dialog").modal({show:!0,backdrop:"static"})},$scope.updateMailTo=function(data){$scope.mailBodyData={requestBy:$scope.loginInfo.user_name?$scope.loginInfo.user_name:"",company:data.Company_name?data.Company_name:"",time:moment(new Date(data.APPOINTMENT_DATE)).format("HH:mm"),date:moment(new Date(data.APPOINTMENT_DATE)).format("DD/MM/YYYY"),typeOfAppointment:data.BOOKING_TYPE,doctor:data.NAME?data.NAME:"",address:data.Site_addr?data.Site_addr:"",isContactPatient:data.ISCONTACTPATIENT?data.ISCONTACTPATIENT:"",notes:data.NOTES?data.NOTES:"",claimNumber:data.CLAIM_NO?data.CLAIM_NO:"",wrkName:data.WRK_SURNAME?data.WRK_SURNAME:"",wrkDOB:moment(data.WRK_DOB).format("DD/MM/YYYY"),wrkContactNo:data.WRK_CONTACT_NO?data.WRK_CONTACT_NO:"",injuryDesc:data.DESC_INJURY?data.DESC_INJURY:""},$scope.emailContent="The below appointment has been requested by "+$scope.mailBodyData.requestBy+" from "+$scope.mailBodyData.company+".\n\nAppointment Details:\n\nDate: "+$scope.mailBodyData.date+"\nTime: "+$scope.mailBodyData.time+"\nType of appointment: "+$scope.mailBodyData.Rl_TYPE_NAME+"\nDoctor: "+$scope.mailBodyData.doctor+"\nAddress: "+$scope.mailBodyData.address+"\nNotes: "+$scope.mailBodyData.notes+" \n\nPatient information:\n\nClaim number: "+$scope.mailBodyData.claimNumber+"\nName: "+$scope.mailBodyData.wrkName+"\nDate of Birth: "+$scope.mailBodyData.wrkDOB+"\nContact number: "+$scope.mailBodyData.wrkContactNo+" \nInjury description: "+$scope.mailBodyData.injuryDesc+"\n";var recepient="medicolegal@redimed.com.au",options={subject:"Medico-Legal Paperwork "+$scope.mailBodyData.wrkName,body:$scope.emailContent};$scope.mailtoLink=Mailto.url(recepient,options)},$scope.sendEmail=function(){console.log($scope.mailtoLink),$window.location.href=$scope.mailtoLink,$("#lob-client-send-document-dialog").modal("hide")},$scope.reuseBookingInfo=function(){bookingService.setBookingInfoReuse($scope.selectedBooking),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Please choose appointment calendar!"),$state.go("loggedIn.rlob.rlob_booking")},$scope.cancelBooking=function(){var appTime=new Date($scope.selectedBooking.APPOINTMENT_DATE),currentTime=new Date;appTime>currentTime&&$scope.selectedBooking.STATUS==rlobConstant.bookingStatus.confirmed?rlobService.cancelBooking($scope.selectedBooking.CAL_ID,$scope.selectedBooking.PATIENT_ID).then(function(data){"success"==data.status?rlobService.changeBookingStatus($scope.selectedBooking.BOOKING_ID,rlobConstant.bookingStatus.cancel).then(function(data){"success"==data.status?($scope.selectedBooking.STATUS=rlobConstant.bookingStatus.cancel,rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Cancel booking success!"),$scope.pagingHandle()):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Cancel booking fail!")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Cancel booking fail!")}):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"You cannot cancel this booking!")},$scope.currentUpdatingItem={bookingId:null,calId:null,appointmentDateTime:null,newAppoimentDateTime:null,bookingIdChangeSuccess:null,assId:null,newCalId:null},$scope.actionCenter.changeBookingCalendar.runWhenSuccess=function(){$scope.searchHandle()}}),angular.module("app.loggedIn.rlob.adminDocumentStatusSummary.controller",[]).controller("rlob_admin_documentStatusSummaryController",function($scope,$http,$cookieStore,$q,$state,rlobService){$scope.listDaysOfWeek={},$scope.listHoursInDay={},$scope.listDays={};var dateStartWeek=rlobDate.getDateStartWeek(new Date),dateEndWeek=rlobDate.getDateEndWeek(new Date);$scope.nextWeek=function(){dateStartWeek=dateStartWeek.add(7,"days"),dateEndWeek=dateEndWeek.add(7,"days"),$scope.getDocumentStatusSummaryInWeek(dateStartWeek,dateEndWeek)},$scope.previousWeek=function(){dateStartWeek=dateStartWeek.subtract(7,"days"),dateEndWeek=dateEndWeek.subtract(7,"days"),$scope.getDocumentStatusSummaryInWeek(dateStartWeek,dateEndWeek)},$scope.datesDisplay="",$scope.numberOfBooking=0,$scope.getDocumentStatusSummaryInWeek=function(dateStart,dateEnd){$scope.listDaysOfWeek={},$scope.listHoursInDay={},$scope.listDays={},$scope.datesDisplay=dateStart.format("DD/MM/YYYY")+"-"+dateEnd.format("DD/MM/YYYY"),rlobService.getDocumentStatusSummary(dateStart.format("YYYY/MM/DD"),dateEnd.format("YYYY/MM/DD")).then(function(data){if($scope.numberOfBooking=0,"success"==data.status){$scope.numberOfBooking=data.data.length;for(var i=0;i<data.data.length;i++){var item=data.data[i],appointmentDate=new Date(data.data[i].APPOINTMENT_DATE),dayValue=appointmentDate.getDay();$scope.listDaysOfWeek[rlobDate.daysOfWeek[dayValue].value]||($scope.listDaysOfWeek[rlobDate.daysOfWeek[dayValue].value]=rlobDate.daysOfWeek[dayValue]),$scope.listHoursInDay[moment(appointmentDate).format("HH:mm")]||($scope.listHoursInDay[moment(appointmentDate).format("HH:mm")]={})}for(var i=0;i<data.data.length;i++){var item=data.data[i],appointmentDate=new Date(data.data[i].APPOINTMENT_DATE),dayValue=appointmentDate.getDay();$scope.listDays[rlobDate.daysOfWeek[dayValue].value]||($scope.listDays[rlobDate.daysOfWeek[dayValue].value]={DISPLAY:rlobDate.daysOfWeek[dayValue].display,LIST:angular.copy($scope.listHoursInDay)}),$scope.listDays[rlobDate.daysOfWeek[dayValue].value].LIST[moment(appointmentDate).format("HH:mm")]||($scope.listDays[rlobDate.daysOfWeek[dayValue].value].LIST[moment(appointmentDate).format("HH:mm")]={});var styleClass="";switch(item.DOCUMENT_STATUS){case rlobConstant.documentStatus.notConfirmed.value:styleClass=rlobConstant.documentStatusSummaryStyleClass.notConfirmed;break;case rlobConstant.documentStatus.checked.value:styleClass=rlobConstant.documentStatusSummaryStyleClass.checked;break;case rlobConstant.documentStatus.noDocuments.value:styleClass=rlobConstant.documentStatusSummaryStyleClass.noDocuments}$scope.listDays[rlobDate.daysOfWeek[dayValue].value].LIST[moment(appointmentDate).format("HH:mm")][item.BOOKING_ID]||($scope.listDays[rlobDate.daysOfWeek[dayValue].value].LIST[moment(appointmentDate).format("HH:mm")][item.BOOKING_ID]={BOOKING_ID:item.BOOKING_ID,WRK_SURNAME:item.WRK_SURNAME,DOCUMENT_STATUS:item.DOCUMENT_STATUS,STYLE_CLASS:styleClass})}}})},$scope.getDocumentStatusSummaryInWeek(dateStartWeek,dateEndWeek),$scope.isAdminGetFiles=!0,$scope.accordionStatus={status1:!0},$scope.isAdminUpload=!0,$scope.getBookingDetail=function(bookingId){rlobService.getBookingById(bookingId).then(function(data){"success"==data.status&&($scope.selectedBooking=data.data,$("#rlob-booking-detail-popup").modal({show:!0,backdrop:"static"}))},function(err){})},$("#rlob-booking-detail-popup").on("hide.bs.modal",function(e){$scope.getDocumentStatusSummaryInWeek(dateStartWeek,dateEndWeek)})});var kiss={concat:function(){for(var str="",i=0;i<arguments.length;i++)str+=arguments[i];return str},msToTimer:function(num){var timerItem={x:null,hour:null,minute:null,second:null,display:null};timerItem.x=num,timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp;var pad=function(num,size){var s="000000000"+num;return s.substr(s.length-size)};return timerItem.display=pad(timerItem.hour,2)+":"+pad(timerItem.minute,2)+":"+pad(timerItem.second,2),timerItem}};angular.module("app.kiss.timer.directive",[]).directive("kissTimer",function($interval){return{restrict:"E",scope:{startSessionTime:"=",returnValue:"="},templateUrl:"modules/kissModule/directives/templates/kissTimer.html",link:function($scope,element,attrs){var run=function(){var startSessionTime=moment(new Date($scope.startSessionTime)),currentTime=moment(),x=currentTime.diff(startSessionTime,"seconds"),timerItem={x:null,hour:null,minute:null,second:null};timerItem.x=x,timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp;var pad=function(num,size){var s="000000000"+num;return s.substr(s.length-size)},updateTime=function(){timerItem.hour=Math.floor(timerItem.x/3600);var temp=timerItem.x%3600;timerItem.minute=Math.floor(temp/60);var temp=timerItem.x%60;timerItem.second=temp,timerItem.x=timerItem.x+1,$scope.returnValue=pad(timerItem.hour,2)+":"+pad(timerItem.minute,2)+":"+pad(timerItem.second,2)};$scope.timer=$interval(updateTime,1e3)};$scope.$watch("startSessionTime",function(newValue,oldValue){$scope.startSessionTime&&("close"!=$scope.startSessionTime?run():$interval.cancel($scope.timer))}),element.on("$destroy",function(){$interval.cancel($scope.timer)})}}}),angular.module("app.loggedIn.rlob.paperless.controller",[]).controller("rlob_paperlessController",function($scope,rlobService,$cookieStore,$state){$scope.userType=rlobConstant.userType,$scope.loginInfo=$cookieStore.get("userInfo").user_type,console.log($scope.loginInfo),$scope.isDoctor=!0,$scope.loginInfo==$scope.userType.doctor&&($scope.isDoctor=!1),$scope.isAdmin=!0,$scope.loginInfo==$scope.userType.admin&&($scope.isAdmin=!1),$scope.isAssistant=!0,$scope.loginInfo==$scope.userType.assistant&&($scope.isAssistant=!1),console.log($scope.userType.doctor)}),angular.module("app.loggedIn.rlob.paperless.ams6.controller",[]).controller("rlob_paperless_ams6Controller",function($scope,rlobService,toastr,ConfigService){rlobService.checkBookingInFormAms6(rlobService.bookingInfoPaperless.id).then(function(data){"update"==data.status&&($scope.update=!0,$scope.info=data.data,$scope.info.WRK_DATE_OF_BIRTH_TEMP=null!=data.data.WRK_DATE_OF_BIRTH?new Date(data.data.WRK_DATE_OF_BIRTH):null,$scope.info.WRK_DATE_OF_INJURI_TEMP=null!=data.data.WRK_DATE_OF_INJURI?new Date(data.data.WRK_DATE_OF_INJURI):null,$scope.info.DATE_ASSESS_TEMP=null!=data.data.DATE_ASSESS?new Date(data.data.DATE_ASSESS):null,$scope.info.DT_DATE_TEMP=null!=data.data.DT_DATE?new Date(data.data.DT_DATE):new Date,console.log("update a6:"+$scope.update),console.log($scope.info),$scope.isSaving=!0),"insert"==data.status&&($scope.insert=!0,rlobService.getBookingDoctorCompany(rlobService.bookingInfoPaperless.id).then(function(data){"success"==data.status&&($scope.info.WRK_NAME=data.data.WRK_SURNAME+" "+data.data.WRK_OTHERNAMES,$scope.info.WRK_PHONE=data.data.WRK_PHONE,$scope.info.WRK_EMAIL=data.data.WRK_EMAIL,$scope.info.WRK_DATE_OF_BIRTH_TEMP=null!=data.data.WRK_DATE_OF_BIRTH?new Date(data.data.WRK_DATE_OF_BIRTH):null,$scope.info.WRK_DATE_OF_INJURI_TEMP=null!=data.data.WRK_DATE_OF_INJURI?new Date(data.data.WRK_DATE_OF_INJURI):null,$scope.info.EMP_ORGANISATION_NAME=data.data.EMP_ORGANISATION_NAME,$scope.info.EMP_POSTCODE=data.data.EMP_POSTCODE,$scope.info.EMP_ADDRESS_1=data.data.EMP_ADDRESS_1,$scope.info.EMP_EMAIL=data.data.EMP_EMAIL,$scope.info.EMP_PHONE=data.data.EMP_PHONE,$scope.info.DT_NAME=data.data.DT_NAME,$scope.info.DT_ADDRESS_1=data.data.DT_ADDRESS_1,$scope.info.DT_EMAIL=data.data.DT_EMAIL,$scope.info.DT_PHONE=data.data.DT_PHONE,$scope.info.DT_SIGNATURE=data.data.DT_SIGNATURE,$scope.info.DT_DATE_TEMP=new Date,console.log($scope.info))}),$scope.isSaving=!1,console.log("insert a6:"+$scope.insert))}),$scope.info={AMS6_ID:null,BOOKING_ID:rlobService.bookingInfoPaperless.id,WRK_NAME:null,WRK_ADDRESS_1:null,WRK_ADDRESS_2:null,WRK_POSTCODE:null,WRK_DATE_OF_BIRTH_TEMP:null,WRK_DATE_OF_BIRTH:null,WRK_DATE_OF_INJURI:null,WRK_DATE_OF_INJURI_TEMP:null,WRK_INSURER_CLAIM_NUMBER:null,WRK_DESCRIPTION_OF_INJURI:null,WRK_PHONE:null,WRK_EMAIL:null,WRK_WORKCOVER_WA_CLAIM_NUMBER:null,COMPANIES_ID:null,EMP_ORGANISATION_NAME:null,EMP_CONTACT_PERSON:null,EMP_ADDRESS_1:null,EMP_ADDRESS_2:null,EMP_POSTCODE:null,EMP_PHONE:null,EMP_EMAIL:null,EMP_NAME_OF_INSURER:null,EMP_WORKCOVER_MUNBER:null,PURPOSE_OF_THE_ASSESSMENT:null,DATE_ASSESS:null,DATE_ASSESS_TEMP:null,INJURY_ASSESSMENT:null,DOCTOR_ID:null,DT_DATE_TEMP:null,DT_DATE:null,DT_SIGNATURE:null,DT_NAME:null,DT_ADDRESS_1:null,DT_ADDRESS_2:null,DT_POSTCODE:null,DT_PHONE:null,DT_EMAIL:null,ISENABLE:null},$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},"slow")};var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.DT_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.DT_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.DT_SIGNATURE},$scope.addNewFormAMS6=function(info){$scope.$broadcast("show-errors-check-validity"),$scope.FormAms6.$valid?(1==$scope.update&&($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.DATE_ASSESS=null!=info.DATE_ASSESS_TEMP?ConfigService.getCommonDate(info.DATE_ASSESS_TEMP):null,$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.updateFromAms6(info).then(function(data){"success"==data.status?(toastr.success("Update Success!","Success"),$scope.isSaving=!0,$scope.scrollTo($("#bodydata']"),-200)):toastr.error("Update Failed!","Error")}):toastr.error("Not Booking Id!","Error")),1==$scope.insert&&($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.DATE_ASSESS=null!=info.DATE_ASSESS_TEMP?ConfigService.getCommonDate(info.DATE_ASSESS_TEMP):null,$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.addNewFromAms6(info).then(function(data){"success"==data.status?(toastr.success("Insert Success!","Success"),$scope.isSaving=!0,$scope.info.AMS6_ID=data.data,console.log($scope.info),$scope.scrollTo($("#bodydata]"),-200)):toastr.error("Insert Failed!","Error")}):toastr.error("Not Booking Id!","Error"))):($scope.hadForcused=!0,$(".errorSummaryAms6").show())},$scope.edit=!1,$scope.editFormAms6=function(){$scope.isSaving=!1,$scope.edit=!0},$scope.updateFormAMS6=function(info){$scope.$broadcast("show-errors-check-validity"),$scope.FormAms6.$valid?($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.DATE_ASSESS=null!=info.DATE_ASSESS_TEMP?ConfigService.getCommonDate(info.DATE_ASSESS_TEMP):null,$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),console.log(info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.updateFromAms6(info).then(function(data){"success"==data.status?(toastr.success("Edit Success!","Success"),$scope.isSaving=!0,$scope.scrollTo($("#bodydata"),-200)):toastr.error("Edit Failed!","Error")}):toastr.error("Not Booking Id!","Error")):($scope.hadForcused=!0,$(".errorSummaryAms6").show())},$scope.goToName=function(name){$scope.scrollTo($("[name='"+name+"']"),-200)},$scope.cancelFormAms6=function(){$scope.isSaving=!0}}),angular.module("app.loggedIn.rlob.paperless.ams5.controller",[]).controller("rlob_paperless_ams5Controller",function($scope,rlobService,toastr,ConfigService){rlobService.checkBookingInFormAms5(rlobService.bookingInfoPaperless.id).then(function(data){"update"==data.status&&($scope.updateAMS5=!0,$scope.info=data.data,$scope.info.WRK_DATE_OF_BIRTH_TEMP=null!=data.data.WRK_DATE_OF_BIRTH?new Date(data.data.WRK_DATE_OF_BIRTH):null,$scope.info.WRK_DATE_OF_INJURI_TEMP=null!=data.data.WRK_DATE_OF_INJURI?new Date(data.data.WRK_DATE_OF_INJURI):null,$scope.info.EX_DATE_TEMP=null!=data.data.EX_DATE?new Date(data.data.EX_DATE):null,$scope.info.DT_DATE_TEMP=null!=data.data.DT_DATE?new Date(data.data.DT_DATE):new Date,console.log(data.data),console.log("update a5:"+$scope.updateAMS5),console.log($scope.info),$scope.isSaving=!0),"insert"==data.status&&($scope.insertAMS5=!0,rlobService.getBookingDoctorCompany(rlobService.bookingInfoPaperless.id).then(function(data){"success"==data.status&&(console.log(data.data),$scope.info.WRK_NAME=data.data.WRK_SURNAME+" "+data.data.WRK_OTHERNAMES,$scope.info.WRK_DATE_OF_BIRTH_TEMP=null!=data.data.WRK_DATE_OF_BIRTH?new Date(data.data.WRK_DATE_OF_BIRTH):null,$scope.info.WRK_DATE_OF_INJURI_TEMP=null!=data.data.WRK_DATE_OF_INJURI?new Date(data.data.WRK_DATE_OF_INJURI):null,$scope.info.WRK_PHONE=data.data.WRK_PHONE,$scope.info.WRK_EMAIL=data.data.WRK_EMAIL,$scope.info.EMP_ORGANISATION_NAME=data.data.EMP_ORGANISATION_NAME,$scope.info.EMP_POSTCODE=data.data.EMP_POSTCODE,$scope.info.EMP_ADDRESS_1=data.data.EMP_ADDRESS_1,$scope.info.EMP_EMAIL=data.data.EMP_EMAIL,$scope.info.EMP_PHONE=data.data.EMP_PHONE,$scope.info.DT_NAME=data.data.DT_NAME,$scope.info.DT_ADDRESS_1=data.data.DT_ADDRESS_1,$scope.info.DT_EMAIL=data.data.DT_EMAIL,$scope.info.DT_PHONE=data.data.DT_PHONE,$scope.info.DT_SIGNATURE=data.data.DT_SIGNATURE,$scope.info.DT_DATE_TEMP=new Date,console.log($scope.info))}),$scope.isSaving=!1,console.log("insert a5:"+$scope.insertAMS5))}),$scope.info={AMS5_ID:null,BOOKING_ID:rlobService.bookingInfoPaperless.id,WRK_NAME:null,WRK_ADDRESS_2:null,WRK_ADDRESS_1:null,WRK_POSTCODE:null,WRK_DATE_OF_BIRTH_TEMP:null,WRK_DATE_OF_BIRTH:null,WRK_DATE_OF_INJURI_TEMP:null,WRK_DATE_OF_INJURI:null,WRK_INSURER_CLAIM_NUMBER:null,WRK_DESCRIPTION_OF_INJURI:null,WRK_PHONE:null,WRK_EMAIL:null,WRK_WORKCOVER_WA_CLAIM_NUMBER:null,COMPANIES_ID:null,EMP_ORGANISATION_NAME:null,EMP_CONTACT_PERSON:null,EMP_ADDRESS_1:null,EMP_ADDRESS_2:null,EMP_POSTCODE:null,EMP_PHONE:null,EMP_EMAIL:null,EMP_NAME_OF_INSURER:null,EMP_WORKCOVER_MUNBER:null,PURPOSE_OF_THE_ASSESSMENT:null,EX_DATE_TEMP:null,EX_DATE:null,EXL_NAME:null,EXL_ADDRESS_1:null,EXL_ADDRESS_2:null,EXL_POSTCODE:null,REPORTS_AND_DOCUMENTS:null,NARRATIVE_HISTORY:null,DIAGNOSIS_AND_STUDIES:null,DIAGNOSIS_AND_IMPAIRMENTS:null,PROPORTION_OF_PERMANENT_IMPAIRMENT:null,INJURY_ASSESSMENT:null,DOCTOR_ID:null,DT_DATE_TEMP:null,DT_DATE:null,DT_SIGNATURE:null,DT_NAME:null,DT_ADDRESS_1:null,DT_ADDRESS_2:null,DT_POSTCODE:null,DT_PHONE:null,DT_EMAIL:null},$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},"slow")};var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.DT_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.DT_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.DT_SIGNATURE},$scope.addNewFormAMS5=function(info){$scope.$broadcast("show-errors-check-validity"),$scope.FormAms5.$valid?(1==$scope.updateAMS5&&($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.EX_DATE=null!=info.EX_DATE_TEMP?ConfigService.getCommonDate(info.EX_DATE_TEMP):null,$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.updateFromAms5(info).then(function(data){"success"==data.status?(toastr.success("Update Success!","Success"),$scope.isSaving=!0,$scope.scrollTo($("#bodydata"),-200)):toastr.error("Update Failed!","Error")}):toastr.error("Not Booking Id!","Error")),1==$scope.insertAMS5&&($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.EX_DATE=null!=info.EX_DATE_TEMP?ConfigService.getCommonDate(info.EX_DATE_TEMP):null,$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.addNewFromAms5(info).then(function(data){"success"==data.status?(toastr.success("Insert Success!","Success"),$scope.isSaving=!0,$scope.info.AMS5_ID=data.data,console.log($scope.info),$scope.scrollTo($("#bodydata"),-200)):toastr.error("Insert Failed!","Error")}):toastr.error("Not Booking Id!","Error"))):($scope.hadForcused=!0,$(".errorSummaryAms5").show())},$scope.edit=!1,$scope.editFormAms5=function(){$scope.isSaving=!1,$scope.edit=!0},$scope.updateFormAMS5=function(info){$scope.$broadcast("show-errors-check-validity"),$scope.FormAms5.$valid?($scope.info.WRK_DATE_OF_BIRTH=null!=info.WRK_DATE_OF_BIRTH_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_BIRTH_TEMP):null,$scope.info.WRK_DATE_OF_INJURI=null!=info.WRK_DATE_OF_INJURI_TEMP?ConfigService.getCommonDate(info.WRK_DATE_OF_INJURI_TEMP):null,$scope.info.EX_DATE=null!=info.EX_DATE_TEMP?ConfigService.getCommonDate(info.EX_DATE_TEMP):null,
$scope.info.DT_DATE=null!=info.DT_DATE_TEMP?ConfigService.getCommonDate(info.DT_DATE_TEMP):null,console.log($scope.info),console.log(info),null!=info.BOOKING_ID&&""!=info.BOOKING_ID?rlobService.updateFromAms5(info).then(function(data){"success"==data.status?(toastr.success("Edit Success!","Success"),$scope.isSaving=!0,$scope.scrollTo($("#bodydata"),-200)):toastr.error("Edit Failed!","Error")}):toastr.error("Not Booking Id!","Error")):($scope.hadForcused=!0,$(".errorSummaryAms5").show())},$scope.goToName=function(name){$scope.scrollTo($("[name='"+name+"']"),-200)},$scope.cancelFormAms5=function(){$scope.isSaving=!0}}),angular.module("app.loggedIn.rlob.rltype.controller",[]).controller("rlob_rltypeController",function($scope,rlobService,toastr){$scope.bookingType=rlobConstant.bookingType,$scope.setListRltype=function(){rlobService.getlistRlType().then(function(data){"success"==data.status&&($scope.listRlType=data.data)})},$scope.setListRltype(),$scope.showPopupAddNewType=function(){$scope.name=null,$scope.sourceName=null,$("#rlob-type-insert-popup").modal({show:!0,backdrop:"static"})},$scope.insertRlType=function(name,sourceName){rlobService.insertRlTypes(name,sourceName).then(function(data){"success"==data.status&&($scope.setListRltype(),$("#rlob-type-insert-popup").modal("hide"),toastr.success("Insert Success!","Success")),"fail"==data.status&&($("#rlob-type-insert-popup").modal("hide"),toastr.error("Insert Failed!","Error"))})},$scope.showPopupEditType=function(type){$scope.name=type.Rl_TYPE_NAME,$scope.sourceName=type.SOURCE_TYPE,$scope.enable=type.ISENABLE,$scope.idType=type.RL_TYPE_ID,$("#rlob-type-edit-popup").modal({show:!0,backdrop:"static"})},$scope.updateRltype=function(idType,name,sourceName,enable){rlobService.updateRlTypes(idType,name,sourceName,enable).then(function(data){"success"==data.status&&($scope.setListRltype(),$("#rlob-type-edit-popup").modal("hide"),toastr.success("Update Success!","Success")),"fail"==data.status&&($("#rlob-type-edit-popup").modal("hide"),toastr.error("Update Failed!","Error"))})}}),angular.module("app.loggedIn.rlob.specialties.controller",[]).controller("rlob_specialtiesController",function($scope,rlobService,toastr){$scope.setListSpecialties=function(){rlobService.getListSpecialties().then(function(data){"success"==data.status&&($scope.listSpecialties=data.data)})},$scope.setListSpecialtiesType=function(){rlobService.getlistRlType().then(function(data){"success"==data.status&&($scope.listSpecialtiesType=data.data)})},$scope.setListSpecialties(),$scope.showPopupAddNewSpecialties=function(){$scope.specialtiesName=null,$scope.specialtiesType=null,$scope.setListSpecialtiesType(),$("#rlob-specialties-insert-popup").modal({show:!0,backdrop:"static"})},$scope.insertSpecialties=function(specialtiesName,specialtiesType){rlobService.insertSpecialties(specialtiesName,specialtiesType).then(function(data){"success"==data.status&&($scope.setListSpecialties(),$("#rlob-specialties-insert-popup").modal("hide"),toastr.success("Insert Success!","Success")),"fail"==data.status&&($("#rlob-specialties-insert-popup").modal("hide"),toastr.error("Insert Failed!","Error"))})},$scope.showPopupEditSpecialties=function(specialties){$scope.specialtiesId=specialties.Specialties_id,$scope.specialtiesName=specialties.Specialties_name,$scope.specialtiesType=specialties.RL_TYPE_ID,$scope.enable=specialties.Isenable,$scope.setListSpecialtiesType(),$("#rlob-specialties-edit-popup").modal({show:!0,backdrop:"static"})},$scope.updateSpecialties=function(specialtiesId,specialtiesName,specialtiesType,enable){rlobService.updateSpecialties(specialtiesId,specialtiesName,specialtiesType,enable).then(function(data){"success"==data.status&&($scope.setListSpecialties(),$("#rlob-specialties-edit-popup").modal("hide"),toastr.success("Update Success!","Success")),"fail"==data.status&&($("#rlob-specialties-edit-popup").modal("hide"),toastr.error("Update Failed!","Error"))})}}),angular.module("app.sponsor1.controller",[]).controller("rlobSponsor1Controller",function($scope){}),angular.module("app.calendar.mobile.controller",[]).controller("rlobCalendarMobileMasterController",function(socket,$modal,$scope,toastr,$http,$stateParams,Mailto,$cookieStore,$window,rlobService,$timeout,ConfigService,$state){$scope.loginInfo=$cookieStore.get("userInfo"),$scope.selectedFilter={locationSelected:{},rltypeSelected:{},clnSpecialitySelected:{},doctorSelected:{},var1:moment(new Date).format("DD/MM/YYYY")},console.log($scope.selectedFilter.var1),$("#daydatepicker").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",onSelect:function(date){$scope.selectedFilter.var1=date,console.log($scope.selectedFilter.var1),$scope.updateAppoinmentsList(),$scope.getLocationsFilter(),$scope.getDoctorsFilter()}}),$scope.getLocationsFilter=function(){var date=new Date(moment($scope.selectedFilter.var1,"DD-MM-YYYY HH:mm Z"));rlobService.ListLocationMobile(date).then(function(data){"success"==data.status&&($scope.locationsFilter=data.data)})},$scope.getLocationsFilter(),$scope.getDoctorsFilter=function(){var date=new Date(moment($scope.selectedFilter.var1,"DD-MM-YYYY HH:mm Z"));rlobService.ListDoctorMobile(date).then(function(data){"success"==data.status&&($scope.doctorsFilter=data.data)})},$scope.getDoctorsFilter(),$scope.updateAppoinmentsList=function(){var doctorId=$scope.selectedFilter.doctorSelected&&$scope.selectedFilter.doctorSelected.doctor_id?$scope.selectedFilter.doctorSelected.doctor_id:"%",locationId=$scope.selectedFilter.locationSelected&&$scope.selectedFilter.locationSelected.id?$scope.selectedFilter.locationSelected.id:"%",fromTime=$scope.selectedFilter.var1.split("/").reverse().join("-");$http({method:"GET",url:"/api/rlob/appointment-calendar/get-appointment-calendar-not-service",params:{DOCTOR_ID:doctorId,SITE_ID:locationId,FROM_TIME:fromTime}}).success(function(data){for(var temp={DOCTOR_ITEMS:[]},i=0;i<data.length;i++)temp[data[i].DOCTOR_ID]||(temp[data[i].DOCTOR_ID]={LOCATION_ITEMS:[]},temp.DOCTOR_ITEMS.push({DOCTOR_ID:data[i].DOCTOR_ID,DOCTOR_NAME:data[i].NAME})),temp[data[i].DOCTOR_ID][data[i].SITE_ID]||(temp[data[i].DOCTOR_ID][data[i].SITE_ID]={APPOINTMENT_ITEMS:[]},temp[data[i].DOCTOR_ID].LOCATION_ITEMS.push({SITE_ID:data[i].SITE_ID,SITE_NAME:data[i].Site_name})),temp[data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID]||(temp[data[i].DOCTOR_ID][data[i].SITE_ID][data[i].CAL_ID]={},temp[data[i].DOCTOR_ID][data[i].SITE_ID].APPOINTMENT_ITEMS.push({CAL_ID:data[i].CAL_ID,APPOINTMENT_TIME:data[i].appointment_time,FROM_TIME:data[i].FROM_TIME,DOCTOR_ID:data[i].DOCTOR_ID,SITE_ID:data[i].SITE_ID,DOCTOR_NAME:data[i].NAME,SITE_NAME:data[i].Site_name}));for(var arr=[],i=0;i<temp.DOCTOR_ITEMS.length;i++){var doctor_item=temp.DOCTOR_ITEMS[i];doctor_item.LOCATION_ITEMS=[];for(var j=0;j<temp[doctor_item.DOCTOR_ID].LOCATION_ITEMS.length;j++){var location_item=temp[doctor_item.DOCTOR_ID].LOCATION_ITEMS[j];location_item.APPOINTMENT_ITEMS=[],doctor_item.LOCATION_ITEMS.push(location_item);for(var k=0;k<temp[doctor_item.DOCTOR_ID][location_item.SITE_ID].APPOINTMENT_ITEMS.length;k++){var appointment_item=temp[doctor_item.DOCTOR_ID][location_item.SITE_ID].APPOINTMENT_ITEMS[k];location_item.APPOINTMENT_ITEMS.push(appointment_item)}}arr.push(doctor_item)}$scope.appointmentsFilter=arr}).error(function(data){console.log("error")})["finally"](function(){})},$scope.updateAppoinmentsList(),$scope.CAL_ID=null;var selectCalendar=null;$scope.selectAppointmentCalendar=function(appointmentCalendar){$scope.selectedAppointmentCalendar=appointmentCalendar,$scope.CAL_ID=appointmentCalendar.CAL_ID,$scope.updateAppoinmentsList(),selectCalendar=$scope.selectedAppointmentCalendar},$scope.submitCalendar=function(){$scope.patientInfoCalendar.Patient_id?$scope.selectedAppointmentCalendar?(console.log("hehe",selectCalendar),rlobService.addApptPatient($scope.patientInfoCalendar.Patient_id,$scope.selectedAppointmentCalendar.CAL_ID).then(function(data){"success"==data.status?(socket.emit("notifyReceptionist"),socket.emit("notifyDoctor",selectCalendar.DOCTOR_ID),$modal.open({templateUrl:"notifyid",controller:function($scope,$modalInstance,$state){console.log("zooooooo",selectCalendar),$scope.selectCalendar=selectCalendar},size:"sm",backdrop:"static"})):toastr.error("Booking fail!","Error")})):toastr.error("Booking not yet selected","Error"):toastr.error("No information available on the patient","Error")}}),angular.module("app.sponsor1.emergency.controller",[]).controller("rlobEmergencyController",function($scope,FileUploader,rlobService,toastr,$http){$scope.geoLocation=function(){var map=new GMaps({div:"#map",lat:0,lng:0});GMaps.geolocate({success:function(position){$scope.Lng=position.coords.longitude,$scope.Lat=position.coords.latitude,console.log($scope.Lat),console.log($scope.Lng),map.setCenter($scope.Lat,$scope.Lng),map.addMarker({lat:$scope.Lat,lng:$scope.Lng,icon:"http://www.icon100.com/up/4144/32/102-map-marker.png"}),$http.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+$scope.Lat+","+$scope.Lng+"&sensor=true").then(function(data){$scope.address=data.data.results[0].formatted_address,console.log(data.data)}),angular.element("#map").css("opacity","1"),angular.element("#dob-confix").css("margin-top","0px")},error:function(error){alert("Geolocation failed: "+error.message)},not_supported:function(){alert("Your browser does not support geolocation")}})};var uploader=$scope.uploader=new FileUploader;console.log($scope.uploader);var uploader=$scope.uploader=new FileUploader({url:"/api/rlob/sponsor/upload"});uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.onWhenAddingFileFailed=function(item,filter,options){},uploader.onAfterAddingFile=function(fileItem){},uploader.onAfterAddingAll=function(addedFileItems){},uploader.onBeforeUploadItem=function(item){},uploader.onProgressItem=function(fileItem,progress){},uploader.onProgressAll=function(progress){},uploader.onSuccessItem=function(fileItem,response,status,headers){},uploader.onErrorItem=function(fileItem,response,status,headers){},uploader.onCancelItem=function(fileItem,response,status,headers){},uploader.onCompleteItem=function(fileItem,response,status,headers){},uploader.onCompleteAll=function(){},$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},0)},console.info("uploader",uploader),$scope.insertEmergency=function(){$scope.$broadcast("show-errors-check-validity"),$scope.gender?(angular.element("#label-gender").css("display","none"),$scope.FormEmergency.$valid&&($scope.info={FIRSTNAME:$scope.fristname,LASTNAME:$scope.lastname,GENDER:$scope.gender,DOB:moment($scope.dob).format("YYYY/MM/DD"),ADD:$scope.address,CONTACT_NO:$scope.contactus,MEDICARE_NO:$scope.medicareno,MEDICARE_REF:$scope.medicareref,LONGITUDE:$scope.Lng,LATITUDE:$scope.Lat,INJURY:$scope.injury},rlobService.insertEmergency($scope.info).then(function(data){if("success"==data.status){toastr.success("Booking Success!","Success");for(var i=0;i<uploader.queue.length;i++){var item=uploader.queue[i];item.formData[i]={},item.formData[i].sponsor_id=data.data}uploader.uploadAll(),angular.element("#form-config").css("display","none"),angular.element("#data-success").css("display","block"),$scope.scrollTo($(".logo"))}else toastr.error("Booking Failed!","Error")}))):(angular.element("#label-gender").css("display","block"),$scope.scrollTo($(".logo")))},$scope.updateMap=function(){var map=new GMaps({div:"#map",lat:0,lng:0});map.removeMarker(),GMaps.geocode({address:$scope.address,callback:function(results,status){if("OK"==status){var latlng=results[0].geometry.location;map.setCenter(latlng.lat(),latlng.lng()),$scope.Lat=latlng.lat(),$scope.Lng=latlng.lng(),map.addMarker({lat:$scope.Lat,lng:$scope.Lng,icon:"http://www.icon100.com/up/4144/32/102-map-marker.png",infoWindow:{content:"<p>"+$scope.address+"</p>"}}),angular.element("#map").css("opacity","1"),angular.element("#dob-confix").css("margin-top","0px")}}})},$scope.setColorMedicareRef=function(){null!=$scope.medicareref&&""!=$scope.medicareref?$("#medicareref-confix").addClass("color-label"):$("#medicareref-confix").removeClass("color-label")},$scope.setColorMedicareNo=function(){null!=$scope.medicareno&&""!=$scope.medicareno?$("#medicareno-confix").addClass("color-label"):$("#medicareno-confix").removeClass("color-label")}}),angular.module("app.sponsor1.nonemergency.controller",[]).controller("rlobNonEmergencyController",function($scope,rlobService,$window,toastr){$scope.bookingType=rlobConstant.bookingType.REDiLEGAL.name,$scope.scrollTo=function(el,offeset){var pos=el&&el.size()>0?el.offset().top:0;el&&($("body").hasClass("page-header-fixed")&&(pos-=$(".page-header").height()),pos+=offeset?offeset:-1*el.height()),$("html,body").animate({scrollTop:pos},0)},$scope.showCalendar=function(){angular.element("#form-data").css("display","none"),angular.element("#caledar-data").css("display","block"),$scope.scrollTo($(".logo"))},$scope.showFormData=function(){angular.element("#form-data").css("display","block"),angular.element("#caledar-data").css("display","none"),$scope.scrollTo($(".logo"))},$scope.insertNonEmergency=function(){$scope.$broadcast("show-errors-check-validity"),$scope.gender?angular.element("#label-gender").css("display","none"):(angular.element("#label-gender").css("display","block"),$scope.showFormData()),$scope.FormNonemergency.$valid?($scope.info={FIRSTNAME:$scope.fristname,LASTNAME:$scope.lastname,GENDER:$scope.gender,DOB:moment($scope.dob).format("YYYY/MM/DD"),CONTACT_NO:$scope.contactus,MEDICARE_NO:$scope.medicareno,MEDICARE_REF:$scope.medicareref,INJURY:$scope.injury,LONGITUDE:$scope.Lng,LATITUDE:$scope.Lat,CAL_ID:$scope.selectedAppointmentCalendar.CAL_ID},console.log($scope.info),rlobService.insertNonEmergency($scope.info).then(function(data){"success"==data.status?(angular.element("#caledar-data").css("display","none"),angular.element("#data-success").css("display","block"),toastr.success("Booking Success!","Success")):toastr.error("Booking Failed!","Error")})):$scope.showFormData()},$scope.setColorMedicareRef=function(){null!=$scope.medicareref&&""!=$scope.medicareref?$("#medicareref-confix").addClass("color-label"):$("#medicareref-confix").removeClass("color-label")},$scope.setColorMedicareNo=function(){null!=$scope.medicareno&&""!=$scope.medicareno?$("#medicareno-confix").addClass("color-label"):$("#medicareno-confix").removeClass("color-label")}}),angular.module("app.rlobRegister.controller",[]).controller("rlobRegisterController",function($scope,$state,$cookieStore,SecurityService,rlobService,toastr,bookingService){$scope.user=bookingService.getRegisterInfo(),$scope.user.isAccessReportOnline=1,$scope.regexEmail=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,$scope.register=function(){$scope.$broadcast("show-errors-check-validity"),$scope.user.username=$scope.user.email;var checkuser="";$scope.showClickedValidation=!0,$scope.registerForm.$invalid?toastr.error("Please check form.","Error"):SecurityService.checkUserName($scope.user.username).then(function(data){checkuser=data}).then(function(){if(checkuser.length>0)$scope.showClickedValidation=!0,toastr.error("Username already exists","Error");else{$scope.user.fname=$scope.user.fname.charAt(0).toUpperCase()+$scope.user.fname.substr(1),$scope.user.lname=$scope.user.lname.charAt(0).toUpperCase()+$scope.user.lname.substr(1);var user={fullName:$scope.user.fname+" "+$scope.user.lname,email:$scope.user.email,userName:$scope.user.username,password:$scope.user.password,phone:$scope.user.phone,companyTemp:$scope.user.companyTemp,companyState:$scope.user.companyState,isAccessReportOnline:$scope.user.isAccessReportOnline?$scope.user.isAccessReportOnline:0,fname:$scope.user.fname,lname:$scope.user.lname};rlobService.insertNewUser(user).then(function(data){if("success"==data.status){toastr.success("Register Success!","Success"),angular.element("#form-data").css("display","none"),angular.element("#data-success").css("display","block");for(var i=0;i<$scope.stateList.length;i++)$scope.user.companyState==$scope.stateList[i].id&&($scope.companyStateName=$scope.stateList[i].State);bookingService.setRegisterInfo({})}else toastr.error("Register Failed!","Error")})}})},$scope.stateList=[],rlobService.getStates("Australia").then(function(data){$scope.stateList="success"==data.status?data.data:[]})}),angular.module("app.loggedIn.rlob.redilegalUsersListController.controller",[]).controller("rlob_admin_redilegalUsersListController",function($scope,rlobService,SecurityService,toastr){$scope.registerStatus=rlobConstant.registerStatus,$scope.sizePageList=[{value:10,display:"10 Rows"},{value:20,display:"20 Rows"},{value:30,display:"30 Rows"},{value:40,display:"40 Rows"},{value:50,display:"50 Rows"},{value:60,display:"60 Rows"},{value:70,display:"70 Rows"},{value:80,display:"80 Rows"},{value:90,display:"90 Rows"},{value:100,display:"100 Rows"}],$scope.searchInfoMap={currentPage:1,itemsPerPage:$scope.sizePageList[0].value,totalItems:"",maxSize:15,emailKey:"",nameKey:"",companyKey:"",statusKey:""},$scope.usersList=[],$scope.pagingHandle=function(){rlobService.getUsersList($scope.searchInfo).then(function(data){"success"==data.status?($scope.usersList=data.data.list,$scope.searchInfo.totalItems=data.data.totalItems,console.log($scope.usersList)):$scope.usersList=[]},function(err){$scope.usersList=[]})},$scope.searchHandle=function(){$scope.searchInfo.currentPage=1,$scope.pagingHandle()},$scope.reset=function(){$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.pagingHandle()},$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.searchHandle(),$scope.selectedItem={},$scope.editItem={},$scope.setSelectedItem=function(item){$scope.selectedItem=item,$scope.editItem=angular.copy($scope.selectedItem)},$scope.updateRedilegalUserStatus=function(user_name,status){return null==$scope.selectedItem.Company_name&&status!=rlobConstant.registerStatus.REJECT.value?void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Please reselect the infomation of company!"):void rlobService.updateRedilegalUserStatus(user_name,status).then(function(data){"success"==data.status?(rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Update status success!"),$scope.selectedItem.MEDICO_LEGAL_REGISTER_STATUS=status):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Update status fail!")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Update status fail!")})},$scope.companyList=[],SecurityService.company().then(function(response){$scope.companyList=response}),$scope.stateList=[],rlobService.getStates("Australia").then(function(data){$scope.stateList="success"==data.status?data.data:[]}),$scope.$watch("editItem.company_id",function(newValue,oldValue){if($scope.editItem.company_id)for(var i=0;i<$scope.companyList.length;i++){var item=$scope.companyList[i];if(item.id==$scope.editItem.company_id)return void($scope.editItem.Company_name=item.Company_name)}}),$scope.showViewAndUpdateDialog=function(){$("#rlob-view-edit-user").modal({show:!0,backdrop:"static"})},$scope.updateUser=function(){return null==$scope.editItem.Company_name&&$scope.editItem.MEDICO_LEGAL_REGISTER_STATUS!=rlobConstant.registerStatus.REJECT.value?void rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Please reselect the infomation of company!"):($scope.showClickedValidation=!0,void($scope.editForm.$invalid?toastr.error("Please check form.","Error"):(rlobService.updateUserInfo($scope.editItem).then(function(data){"success"==data.status?(angular.extend($scope.selectedItem,$scope.editItem),rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.success,"Update success!")):rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Update fail!")},function(err){rlobMsg.popup(rlobLang.rlobHeader,rlobConstant.msgPopupType.error,"Update fail!")}),$("#rlob-view-edit-user").modal("hide"))))}}),angular.module("app.loggedIn.rlob.bookingBehalf.controller",[]).controller("rlob_admin_bookingBehalfController",function($scope,$state,rlobService,bookingService){$scope.registerStatus=rlobConstant.registerStatus,$scope.sizePageList=[{value:10,display:"10 Rows"},{value:20,display:"20 Rows"},{value:30,display:"30 Rows"},{value:40,display:"40 Rows"},{value:50,display:"50 Rows"},{value:60,display:"60 Rows"},{value:70,display:"70 Rows"},{value:80,display:"80 Rows"},{value:90,display:"90 Rows"},{value:100,display:"100 Rows"}],$scope.searchInfoMap={currentPage:1,itemsPerPage:$scope.sizePageList[0].value,totalItems:"",maxSize:15,emailKey:"",nameKey:"",companyKey:"",statusKey:rlobConstant.registerStatus.APPROVE.value},$scope.usersList=[],$scope.pagingHandle=function(){rlobService.getUsersList($scope.searchInfo).then(function(data){"success"==data.status?($scope.usersList=data.data.list,$scope.searchInfo.totalItems=data.data.totalItems):$scope.usersList=[]},function(err){$scope.usersList=[]})},$scope.searchHandle=function(){$scope.searchInfo.currentPage=1,$scope.pagingHandle()},$scope.reset=function(){$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.pagingHandle()},$scope.searchInfo=angular.copy($scope.searchInfoMap),$scope.searchHandle(),$scope.makeBooking=function(user){var bookingBehalfInfo={ASS_SURNAME:user.Booking_Person,ASS_OTHERNAMES:user.Booking_Person,ASS_CONTACT_NO:user.Contact_number,ASS_EMAIL:user.Contact_email,ASS_ID:user.id,COMPANY_ID:user.company_id};bookingService.setBookingBehalfInfo(bookingBehalfInfo),$state.go("loggedIn.rlob.rlob_booking")}}),angular.module("app.loggedIn.rlob.SpecialistsProfiles.controller",[]).controller("rlob_specialists_profilesController",function(){}),angular.module("app.loggedIn.referral",["app.loggedIn.referral.controller","app.loggedIn.referral.directives","app.loggedIn.referral.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.referral",{"abstract":!0,views:{"main-content@loggedIn.patient":{templateUrl:"modules/referral/views/structure.html",controller:"ReferralController"}}}).state("loggedIn.patient.referral.list",{url:"/referral",views:{"main-content":{templateUrl:"modules/referral/views/referral-list.html",controller:"ReferralListController"}}})}),angular.module("app.loggedIn.referral.directives",["app.loggedIn.referral.detail.directive"]),angular.module("app.loggedIn.referral.detail.directive",[]).directive("referralDetail",function(ReferralModel,ReferralService,DoctorService,ConfigService,toastr,$stateParams){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/referral/directives/templates/detail.html",link:function(scope,element,attrs){var loadData=function(id){ReferralService.referralDetail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ReferralModel),scope.mode={type:"add",text:"Add referral"},scope.modelObjectMap.APPOINTMENT_DATE=new Date,scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit referral"})}var addProcess=function(postData){postData.Patient_id=$stateParams.patient_id,postData.CAL_ID=$stateParams.cal_id,ReferralService.referralInsert(postData).then(function(response){"success"===response.status&&(toastr.success("Added a referral","Success"),scope.modelObjectMap=angular.copy(ReferralModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){postData.id,delete postData.id,ReferralService.referralUpdate(postData).then(function(response){"success"===response.status&&(toastr.success("Edit referral Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.referral.controller",["app.loggedIn.referral.list.controller"]).controller("ReferralController",function(){}),angular.module("app.loggedIn.referral.list.controller",[]).controller("ReferralListController",function($scope,$stateParams){$scope.referral_panel={},$scope.referral={},$scope.referrals={select:0,"class":function(referral){return{selected:referral.ID==$scope.referral.select}},scope:$scope.referral_panel,options:{api:"api/erm/v2/referral/search",method:"post",scope:$scope.referral_panel,columns:[{field:"ID",is_hide:!0},{field:"CAL_ID",label:"Calendar ID",width:"10%"},{field:"CLINICAL_DETAILS",label:"Clinical details",width:"40%"},{field:"REQUESTING_PRACTITIONER",label:"Requesting practitioner",width:"40%"}],use_filters:!0,filters:{CAL_ID:{type:"text"},CLINICAL_DETAILS:{type:"text"},REQUESTING_PRACTITIONER:{type:"text"}},search:{Patient_id:$stateParams.patient_id},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.referral.id=item.ID,$scope.referralEditForm.open()}},{"class":"fa fa-print",title:"Print",callback:function(item){console.log("this is selected item",item),alert(item),window.open("http://testapp.redimed.com.au:3003/RedimedJavaREST/api/document/referral/"+item.ID)}}]}},$scope.referralAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.referral_panel.reload(),$scope.referralAddForm.close()}},$scope.loadDataAddMakeReferral.load=function(){$scope.referral_panel.reload()},$scope.referralEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.referral_panel.reload(),$scope.referralEditForm.close()}}}),angular.module("app.loggedIn.referral.services",[]).factory("ReferralService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/erm/");return mdtService.referralInsert=function(postData){var detailApi=mdtApi.all("v2/referral/insert");return detailApi.post(postData)},mdtService.referralDetail=function(postData){var detailApi=mdtApi.all("v2/referral/detail");return detailApi.post({ID:postData})},mdtService.referralUpdate=function(postData){var detailApi=mdtApi.all("v2/referral/update");return detailApi.post(postData)},mdtService}),angular.module("app.loggedIn.script.include",["app.loggedIn.script.list.controller","app.loggedIn.script.model","app.loggedIn.script.add.controller","app.loggedIn.script.edit.controller","app.loggedIn.script.directive.list","app.loggedIn.script.directive.add","app.loggedIn.script.directive.edit"]),angular.module("app.loggedIn.script",["app.loggedIn.script.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.script",{url:"/script",views:{"main-content":{templateUrl:"modules/script/views/list.html",controller:"ScriptListController"}}}).state("loggedIn.patient.script.add",{url:"/add",views:{"@loggedIn":{templateUrl:"modules/script/views/add.html",controller:"ScriptAddController"}}}).state("loggedIn.patient.script.edit",{url:"/edit/:scriptId",views:{"@loggedIn":{templateUrl:"modules/script/views/edit.html",controller:"ScriptEditController"}}})}),angular.module("app.loggedIn.script.list.controller",[]).controller("ScriptListController",function($scope,$state){}),angular.module("app.loggedIn.script.add.controller",[]).controller("ScriptAddController",function($scope,$state,$modalInstance,medicare){$scope.scriptadd={success:!1,medicare:medicare},console.log("_________",medicare),$scope.$watch("scriptadd.success",function(success){success&&$modalInstance.close($scope.scriptadd)})}),angular.module("app.loggedIn.script.edit.controller",[]).controller("ScriptEditController",function($scope,$state,$modalInstance,ID,medicare){$scope.scriptedit={success:!1,ID:ID,medicare:medicare},$scope.$watch("scriptedit.success",function(success){success&&$modalInstance.close($scope.scriptedit)})}),angular.module("app.loggedIn.script.model",[]).factory("ScriptModel",function(Restangular){var mainModel={},mainApi=Restangular.all("api/meditek/v1/script/");return mainModel.list=function(data){var instanceApi=mainApi.all("list");return instanceApi.post({data:data})},mainModel.add=function(data){var instanceApi=mainApi.all("add");return instanceApi.post({data:data})},mainModel.edit=function(data){var instanceApi=mainApi.all("edit");return instanceApi.post({data:data})},mainModel.remove=function(data){var instanceApi=mainApi.all("remove");return instanceApi.post({data:data})},mainModel.byid=function(data){var instanceApi=mainApi.all("byid");return instanceApi.post({data:data})},mainModel.postDisable=function(data){var instanceApi=mainApi.all("disable");return instanceApi.post({data:data})},mainModel.postSing=function(data){var instanceApi=mainApi.all("signature");return instanceApi.post({data:data})},mainModel.postScriptHead=function(data){var instanceApi=mainApi.all("addScriptHead");return instanceApi.post({data:data})},mainModel.listpostHead=function(data,datar){var instanceApi=mainApi.all("listscriptHead");return instanceApi.post({data:data,datar:datar})},mainModel.editHead=function(data,datar){var instanceApi=mainApi.all("editcriptHead");return instanceApi.post({data:data,datar:datar})},mainModel}),angular.module("app.loggedIn.script.directive.list",[]).directive("scriptList",function(ScriptModel,PatientService,$modal,$filter,$stateParams,$state,toastr){return{restrict:"EA",templateUrl:"modules/script/directives/templates/list.html",scope:{options:"=",limit:"@",medicare:"="},link:function(scope,ele,attrs){var search={page:1,limit:20,offset:0,max_size:5,scriptNum:"",medication_name:"",isEnable:"",Patient_id:$stateParams.patient_id,CAL_ID:$stateParams.cal_id,Creation_date:"desc"},load=function(){console.log("fdsfds: ",scope.medicare),ScriptModel.list(search).then(function(response){scope.script.list=response.data,scope.script.count=response.count},function(error){})},onSearch=function(option){switch(option.field){case"scriptNum":scope.script.search.scriptNum=option.value;break;case"medication_name":scope.script.search.medication_name=option.value}scope.script.load()},remove=function(id){var modalInstance=$modal.open({templateUrl:"notifyToRemove",controller:function($scope,id,$modalInstance){$scope.ok=function(){$modalInstance.close(id)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},size:"sm",resolve:{id:function(){return id}}});modalInstance.result.then(function(id){id&&ScriptModel.remove(id).then(function(deleted){toastr.success("Deleted Successfully"),scope.script.load()},function(error){})})};scope.Scripts=function(type,index){"new"==type&&$modal.open({templateUrl:"notifyToAdd",controller:"ScriptAddController",size:"lg",resolve:{medicare:function(){return scope.medicare}}}).result.then(function(response){scope.script.load()}),"edit"==type&&$modal.open({templateUrl:"notifyToEdit",controller:"ScriptEditController",size:"lg",resolve:{ID:function(){return index},medicare:function(){return scope.medicare}}}).result.then(function(response){response&&scope.script.load()})};var disable=function(row){ScriptModel.postDisable(row).then(function(response){scope.script.load()},function(error){})};scope.setPage=function(page){scope.script.search.offset=(page-1)*scope.script.search.limit,scope.script.load()},scope.script={search:search,dialog:{remove:function(id){remove(id)}},loading:!1,list:[],count:0,error:"",disable:function(row){disable(row)},load:function(){load()},onSearch:function(option){onSearch(option)}},scope.script.load()}}}),
angular.module("app.loggedIn.script.directive.add",[]).directive("scriptAdd",function(ScriptModel,PatientService,OutreferralModel,AppointmentModel,ConfigService,toastr,$cookieStore,$filter,$state,$stateParams,$modal){return{restrict:"EA",templateUrl:"modules/script/directives/templates/add.html",scope:{options:"=",success:"=",medicare:"="},link:function(scope,ele,attrs){var user_id=$cookieStore.get("userInfo").id,save=function(){ConfigService.beforeSave(scope.script.errors),scope.script.errors=[];var postData=angular.copy(scope.script.form),postDatar=[];angular.forEach(scope.script_s,function(value_script,index_script){"1"===scope.script_s[index_script].Checked&&postDatar.push(value_script)}),postData.Patient_id=$stateParams.patient_id,postData.CAL_ID=$stateParams.cal_id,postData.Creation_date=moment().format("YYYY-MM-DD"),postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Created_by=postData.Last_updated_by=user_id,postData.doctordate=ConfigService.convertToDB(postData.doctordate.toString()),postData.patientDate=ConfigService.convertToDB(postData.patientDate.toString()),ScriptModel.add(postData).then(function(response){toastr.success("Added Successfully"),scope.success=!0,angular.forEach(postDatar,function(value_post,index_post){postDatar[index_post].start_date=ConfigService.convertToDB(postDatar[index_post].start_date.toString()),postDatar[index_post].end_date=ConfigService.convertToDB(postDatar[index_post].end_date.toString()),postDatar[index_post].ID_SCRIPT=response.data,postDatar[index_post].CAL_ID=$stateParams.cal_id}),ScriptModel.postScriptHead(postDatar).then(function(responser){},function(error){})},function(error){scope.script.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.script.errors)})},patientLoad=function(){PatientService.get($stateParams.patient_id).then(function(response){scope.patient.item=response.data},function(error){})};scope.patient={item:{},load:function(){patientLoad()}};var scriptLoad=function(){scope.script_s=angular.copy(scope.medicare),angular.forEach(scope.script_s,function(value_script,index_script){scope.script_s[index_script].Checked=null,scope.script_s[index_script].Created_by=user_id,scope.script_s[index_script].Creation_date=moment().format("YYYY-MM-DD"),scope.script_s[index_script].Last_updated_by=user_id,scope.script_s[index_script].Last_update_date=moment().format("YYYY-MM-DD")}),ScriptModel.postSing(user_id).then(function(response){console.log("+++++++++++++++++: ",response.data),scope.script.form.doctorSign=response.data.Signature,scope.script.form.patientDate=moment().format("DD/MM/YYYY"),scope.script.form.doctordate=moment().format("DD/MM/YYYY")},function(error){})},getUsername=function(){OutreferralModel.DotorFromUserId(user_id).then(function(response){scope.script.form.prescriber=response.data[0].NAME},function(error){})};scope.script={getUsername:function(){getUsername()},add:function(params){save(params)},load:function(){scriptLoad()},errors:[],form:{prescriber:"",scriptNum:0,isRefNo:0,EntitlementNo:"",isSafety:0,isConcessional:0,isPBS:0,isRPBS:0,isBrand:0,MedicareNo:0,doctorSign:"",doctordate:"",patientSign:"",patientDate:"",agentAddress:""}},scope.script.load(),scope.patient.load(),scope.script.getUsername()}}}),angular.module("app.loggedIn.script.directive.edit",[]).directive("scriptEdit",function(ScriptModel,PatientService,ConfigService,$cookieStore,$filter,$state,$stateParams,toastr){return{restrict:"EA",templateUrl:"modules/script/directives/templates/edit.html",scope:{options:"=",success:"=",id:"=",medicare:"="},link:function(scope,ele,attr){var user_id=$cookieStore.get("userInfo").id;patientLoad=function(){PatientService.get($stateParams.patient_id).then(function(response){scope.patient.item=response.data},function(error){})},scope.patient={item:{},load:function(){patientLoad()}};var load=function(){scope.script_s=angular.copy(scope.medicare),angular.forEach(scope.script_s,function(value_script,index_script){scope.script_s[index_script].Checked=null,scope.script_s[index_script].Created_by=user_id,scope.script_s[index_script].Creation_date=moment().format("YYYY-MM-DD"),scope.script_s[index_script].Last_updated_by=user_id,scope.script_s[index_script].Last_update_date=moment().format("YYYY-MM-DD")}),ScriptModel.listpostHead(scope.id,$stateParams.cal_id).then(function(responser){scope.list=angular.copy(responser.data),angular.forEach(scope.list,function(value_script,index_script){scope.list[index_script].start_date=ConfigService.convertToDate_F(scope.list[index_script].start_date),scope.list[index_script].end_date=ConfigService.convertToDate_F(scope.list[index_script].end_date)}),angular.forEach(scope.script_s,function(value_script,index_script){var flag=!0;angular.forEach(scope.list,function(value_s,index_s){return scope.script_s[index_script].medication_name==scope.list[index_s].medication_name?void(flag=!1):void 0}),flag&&scope.script.s_array.push(value_script)})},function(error){}),scope.$watch("id",function(success){scope.id=success}),ScriptModel.byid(scope.id).then(function(response){scope.script.form=angular.copy(response.data),scope.script.form.doctordate=ConfigService.convertToDate_F(scope.script.form.doctordate),scope.script.form.patientDate=ConfigService.convertToDate_F(scope.script.form.patientDate)},function(error){})},save=function(){ConfigService.beforeSave(scope.script.errors),scope.script.errors=[];var postData=angular.copy(scope.script.form);postData.Patient_id=$stateParams.patient_id,postData.CAL_ID=$stateParams.cal_id,postData.Last_updated_by=user_id,postData.ID=scope.id,postData.Creation_date=moment().format("YYYY-MM-DD"),postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.doctordate=ConfigService.convertToDB(postData.doctordate),postData.patientDate=ConfigService.convertToDB(postData.patientDate);var postDatar=[];angular.forEach(scope.script.s_array,function(values,indexs){"1"===scope.script.s_array[indexs].Checked&&postDatar.push(values)});var postDatary=[];angular.forEach(scope.list,function(valuesy,indexsy){"0"===scope.list[indexsy].Checked&&postDatary.push(valuesy)}),console.log("^^::::::::::::: ",postDatary),ScriptModel.edit(postData).then(function(response){toastr.success("Edited Successfully"),scope.success=!0,angular.forEach(postDatar,function(value_p,index_p){postDatar[index_p].start_date=ConfigService.convertToDB(postDatar[index_p].start_date),postDatar[index_p].end_date=ConfigService.convertToDB(postDatar[index_p].end_date),postDatar[index_p].ID_SCRIPT=scope.id,postDatar[index_p].CAL_ID=$stateParams.cal_id}),ScriptModel.editHead(postDatar,postDatary).then(function(response){},function(error){})},function(error){scope.script.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.script.errors)})};scope.script={s_array:[],save:function(id){save()},errors:[],load:function(){load()},form:{ID:"",Patient_id:"",CAL_ID:"",prescriber:"",scriptNum:0,isRefNo:0,EntitlementNo:"",isSafety:0,isConcessional:0,isPBS:0,isRPBS:0,isBrand:0,pharmacist:"",doctorSign:"",doctordate:"",patientSign:"",patientDate:"",agentAddress:""}},scope.patient.load(),scope.script.load()}}}),angular.module("app.security",["app.security.controller","app.security.services","app.webpatient.controller"]).config(function($stateProvider){$stateProvider.state("security",{"abstract":!1,views:{root:{templateUrl:"modules/security/views/structure.html",controller:"SecurityController"}}}).state("security.login",{url:"/login",views:{"main-content":{templateUrl:"modules/security/views/login.html",controller:"SecurityLoginController"}}}).state("security.forgot",{url:"/forgot",views:{"main-content":{templateUrl:"modules/security/views/forgot.html",controller:"SecurityForgotController"}}}).state("security.term",{url:"/terms",views:{"main-content":{templateUrl:"modules/security/views/terms.html",controller:"SecurityTermsController"}}}).state("security.rlobRegister",{url:"/rlob-register",views:{"main-content":{templateUrl:"/modules/rediLegalOnlineBooking/views/register.html",controller:"rlobRegisterController"}}}).state("security.rlobSponsor",{url:"/rlob-sponsor",views:{"main-content":{templateUrl:"/modules/rediLegalOnlineBooking/views/mobile/sponsor1.html",controller:"rlobSponsor1Controller"}}}).state("security.rlobSponsor.emergency",{url:"/emergency",templateUrl:"/modules/rediLegalOnlineBooking/views/mobile/emergency.html",controller:"rlobEmergencyController"}).state("security.rlobSponsor.nonemergency",{url:"/nonemergency",templateUrl:"/modules/rediLegalOnlineBooking/views/mobile/nonemergency.html",controller:"rlobNonEmergencyController"}).state("security.redirect",{url:"/redirect/:userId/:patient_id",views:{"main-content":{template:"<div> Waitting </div>",controller:"SecurityRedirectController"}}}).state("security.portalPatient",{url:"/portal-patient",views:{"main-content":{templateUrl:"/modules/security/views/portal-patient.html"}}}).state("webpatient",{"abstract":!1,views:{root:{templateUrl:"modules/security/views/web-patient.html",controller:"WebPatientController"}}}).state("webpatient.checkin",{url:"/portal-patient/web-checkin",templateUrl:"/modules/patient/views/web-checkin.html",controller:"PatientCheckinController"}).state("webpatient.register",{url:"/portal-patient/register",templateUrl:"/modules/patient/views/patient-register.html"}).state("webpatient.booking",{url:"/portal-patient/booking",templateUrl:"/modules/rediLegalOnlineBooking/views/mobile/patient-booking.html"})}),angular.module("app.security.services",[]).factory("SecurityService",function(Restangular){var securityService={},securityApi=Restangular.all("api"),restfulApi=Restangular.all("api/restful");return securityService.getSocket=function(socket){return restfulApi.one("User").get({SOCKET:socket})},securityService.login=function(options){var loginApi=securityApi.all("users/login");return loginApi.post(options)},securityService.company=function(){var companyList=securityApi.one("company/list");return companyList.get()},securityService.regNewUser=function(user){var userList=securityApi.all("users/insert");return userList.post({user:user,isReg:!0})},securityService.checkEmail=function(email){var emailCheck=securityApi.one("users/checkEmail");return emailCheck.get({email:email})},securityService.checkUserName=function(username){var usernameCheck=securityApi.one("users/checkUser");return usernameCheck.get({user_name:username})},securityService.forgotPass=function(email){var forgotMail=securityApi.one("users/forgotPassword");return forgotMail.get({email:email})},securityService}),angular.module("app.security.controller",["app.security.login.controller","app.security.forgot.controller","app.security.register.controller","app.security.redirect.controller","app.security.terms.controller"]).controller("SecurityController",function($scope){$scope.modelUser={username:"",password:"",remember:!1,isAgree:!1}}),angular.module("app.webpatient.controller",[]).controller("WebPatientController",function($scope,ConfigService,$state){$scope.modelObject={Title:"Mr",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:null,Country:"AU",DOB:"",Sex:"Male",Home_phone:null,Work_phone:null,Mobile:null,No_SMS:"0",Account_type:"",Account_holder:"",Account_Seft:null,Medicare_no:null,Ref:null,Exp_medicare:"",Private_fund_id:"",MemberShip_no:null,UPI:null,HCC_Pension_No:null,Exp_pension:"",DVA_No:null,Balance:null,Pays_Gap_Only:"1",Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:null},$scope.options={};var loadOptionsApi=function(){ConfigService.countries_option().then(function(response){"success"===response.status&&($scope.options.countries=response.data)}),ConfigService.title_option().then(function(response){"success"===response.status&&($scope.options.titles=response.data)}),ConfigService.account_type_option().then(function(response){"success"===response.status&&($scope.options.account_types=response.list)}),ConfigService.private_type_option().then(function(response){"success"===response.status&&($scope.options.private_types=response.list)})};loadOptionsApi(),$scope.params={permission:{create:!0,edit:!1}},$scope.patientInfoCalendar={},$scope.actionCenter={runWhenFinish:function(patienInfo){patienInfo&&($scope.patientInfoCalendar=patienInfo,console.log($scope.patientInfoCalendar),$state.go("webpatient.booking"),console.log(patienInfo))}}}),angular.module("app.security.login.controller",[]).controller("SecurityLoginController",function($http,$scope,$state,$modal,$cookieStore,localStorageService,SecurityService,toastr,UserService,ConfigService,DoctorService,socket){function login(username){socket.emit("updateSocketLogin",username),socket.on("login_success",function(){UserService.detail().then(function(response){if("undefined"!=typeof response.userInfo){$cookieStore.put("userInfo",response.userInfo),$cookieStore.put("isRemember",$scope.modelUser.isRemember),"undefined"!=typeof response.companyInfo&&$cookieStore.put("companyInfo",response.companyInfo);var gotoFunction=function(){null!=response.userInfo.function_id?UserService.getFunction(response.userInfo.function_id).then(function(data){if("undefined"!=typeof data.definition){var rs=data.definition.split("(");if(null!=rs[0])if(null!=rs[1]){var r=rs[1].split(")"),params=eval("("+r[0]+")");$state.go(rs[0],params,{location:"replace",reload:!0})}else $state.go(rs[0],{location:"replace",reload:!0})}else $state.go("loggedIn.home",null,{location:"replace",reload:!0})}):$state.go("loggedIn.home",null,{location:"replace",reload:!0})};"Doctor"==response.userInfo.UserType.user_type?DoctorService.getByUserId(response.userInfo.id).then(function(data){data&&$cookieStore.put("doctorInfo",{doctor_id:data.doctor_id,NAME:data.NAME,Provider_no:data.Provider_no,CLINICAL_DEPT_ID:data.CLINICAL_DEPT_ID}),gotoFunction()},function(err){gotoFunction()}):gotoFunction()}})})}$scope.showClickedValidation=!1,$scope.isLogging=!1,$scope.modelUser={username:null,password:null,isRemember:!1},$scope.login=function(){$scope.showClickedValidation=!0,$scope.loginForm.$invalid?toastr.error("Please Input Your Username And Password!","Error"):SecurityService.login($scope.modelUser).then(function(response){"success"==response.status&&($cookieStore.put("token","abcdefghklf"),socket.emit("checkLogin",$scope.modelUser.username),socket.on("isSuccess",function(){login($scope.modelUser.username)}),socket.on("isError",function(){$scope.isLogging=!1;var modalInstance=$modal.open({templateUrl:"modules/security/views/confirmLogin.html",controller:"ConfirmLoginController",size:"md",backdrop:"static",keyboard:!1});modalInstance.result.then(function(acceptLogin){acceptLogin&&socket.emit("forceLogin",$scope.modelUser.username)},function(err){console.log(err)})}))},function(error){toastr.error("Wrong Username Or Password!")})}}).controller("ConfirmLoginController",function($scope,$filter,$state,$modalInstance,SecurityService,UserService,toastr,socket){$scope.acceptLogin=!1,$scope.cancelLogin=function(){$scope.acceptLogin=!1,$modalInstance.close($scope.acceptLogin)},$scope.acceptLogin=function(){$scope.acceptLogin=!0,$modalInstance.close($scope.acceptLogin)}}),angular.module("app.security.terms.controller",[]).controller("SecurityTermsController",function($scope,$cookieStore,$state){var from=$cookieStore.get("fromState"),params={};console.log(from),$scope.changeState=function(){$state.go(from.fromState.name,params,{location:"replace",reload:!1})}}),angular.module("app.security.forgot.controller",[]).controller("SecurityForgotController",function($scope,toastr,$state,SecurityService){$scope.forgotPass=function(){$scope.showClickedValidation=!0,$scope.forgetForm.$invalid?toastr.error("Please input email.","Error"):SecurityService.forgotPass($scope.email).then(function(data){"success"==data.status?(toastr.success("Change Password Success","Success"),$state.go("loggedIn.home")):toastr.error("Change Password Fail","Fail")},function(err){toastr.error("Change Password Fail","Fail")})}}),angular.module("app.security.register.controller",[]).controller("SecurityRegisterController",function($scope,$state,$cookieStore,SecurityService,toastr){$scope.register=function(){var checkmail="",checkuser="";$scope.showClickedValidation=!0,$scope.registerForm.$invalid?toastr.error("Please check form.","Error"):SecurityService.checkEmail($scope.user.email).then(function(data){checkmail=data}).then(function(){checkmail.length>0?(console.log(checkmail.length),$scope.showClickedValidation=!0,toastr.error("Email da Ton Tai","Error"),$scope.check=!0):SecurityService.checkUserName($scope.user.username).then(function(data){checkuser=data}).then(function(){if(checkuser.length>0)console.log(checkuser),$scope.showClickedValidation=!0,toastr.error("Username da Ton Tai","Error");else{var user={Booking_Person:$scope.user.fname+$scope.user.lname,Contact_email:$scope.user.email,user_name:$scope.user.username,password:$scope.user.password,Contact_number:$scope.user.phone,company_id:$scope.user.companyId};console.log(user),SecurityService.regNewUser(user).then(function(data){console.log(data),toastr.success("Register Success!","Success"),$state.go("loggedIn.home")})}})})},$scope.companyList=[],SecurityService.company().then(function(response){$scope.companyList=response})}),angular.module("app.security.redirect.controller",[]).controller("SecurityRedirectController",function($scope,$state,$location,socket,$stateParams,$location,$cookieStore,SecurityService,UserService){var userId=$stateParams.userId,patient_id=$stateParams.patient_id;UserService.getUserInfo(userId).then(function(data){data&&(delete data.img,$cookieStore.put("userInfo",data),socket.emit("mobileConnect",data.id),$state.go("loggedIn.patient.appointment",{cal_id:0,patient_id:patient_id}))})}),angular.module("app.lockscreen.controller",[]).controller("lockscreenController",function($scope,$rootScope,$state,$cookieStore,SecurityService,UserService,toastr,$window,socket,$location,$rootScope){var userInfo,from=$cookieStore.get("fromState"),isLocking=!0,params={};$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){console.log("this is state change to",toState),isLocking===!0&&("security.login"!==toState.name&&"call"!==toState.name?(event.preventDefault(),toastr.error("Please provide your password to unlock the system!","Password required!")):isLocking=!1)}),(null!=from.fromParams||"undefined"!=typeof from.fromParams)&&angular.forEach(from.fromParams,function(value,key){params[key]=value}),null==$cookieStore.get("userInfo")||"undefined"==typeof $cookieStore.get("userInfo")?$state.go("security.login"):userInfo=$cookieStore.get("userInfo"),$scope.modelUser={username:userInfo.user_name,password:null},UserService.getUserInfo(userInfo.id).then(function(data){$scope.img=data.img}),$scope.name=userInfo.Booking_Person,$scope.email=userInfo.Contact_email,$scope.notUser=function(){socket.emit("logout",$cookieStore.get("userInfo").user_name,$cookieStore.get("userInfo").id,$cookieStore.get("userInfo").UserType.user_type),$cookieStore.remove("userInfo"),$cookieStore.remove("companyInfo"),$cookieStore.remove("doctorInfo"),$state.go("security.login",null,{location:"replace",reload:!0}),socket.removeAllListeners()},$scope.returnHome=function(lockForm){$scope.showClickedValidation=!0,lockForm.$invalid?toastr.error("Please Check Your Password!","Error"):(SecurityService.login($scope.modelUser).then(function(response){console.log(response),null!=response&&"success"==response.status?(isLocking=!1,$state.go(from.fromState.name,params,{location:"replace",reload:!0})):toastr.error("Wrong Username Or Password!","Error")}),function(error){toastr.error("Wrong Username Or Password!","Error")})}}),angular.module("app.loggedIn.syscountry",["app.loggedIn.syscountry.directives","app.loggedIn.syscountry.services"]),angular.module("app.loggedIn.syscountry.services",[]).factory("sysCountryService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/syscountry/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.syscountry.directives",["app.loggedIn.syscountry.detail.directive","app.loggedIn.syscountry.search.directive"]),angular.module("app.loggedIn.syscountry.detail.directive",[]).directive("syscountryDetail",function(sysCountryModel,ConfigService,sysCountryService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/syscountry/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysCountryService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysCountryMap,response.data);for(var key in scope.sysCountryMap)scope.sysCountryMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysCountryMap[key]=scope.sysCountryMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysCountryMap[key]=new Date(scope.sysCountryMap[key])))}),scope.sysCountryMap=angular.copy(sysCountryModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.syscountryForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysCountryMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysCountryService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysCountryService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.syscountry.search.directive",[]).directive("syscountrySearch",function(sysCountryService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/syscountry/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Country_name",value:""},{type:"text",name:"Isenable",value:""},{type:"text",name:"Created_by",value:""}],select:["Country_name","Isenable","Created_by"]}},loadList=function(){sysCountryService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.sysqualification",["app.loggedIn.sysqualification.directives","app.loggedIn.sysqualification.services"]),angular.module("app.loggedIn.sysqualification.services",[]).factory("sysQualificationService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/sysqualification/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.sysqualification.directives",["app.loggedIn.sysqualification.detail.directive","app.loggedIn.sysqualification.search.directive"]),angular.module("app.loggedIn.sysqualification.detail.directive",[]).directive("sysqualificationDetail",function(sysQualificationModel,ConfigService,sysQualificationService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/sysqualification/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysQualificationService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysQualificationMap,response.data);for(var key in scope.sysQualificationMap)scope.sysQualificationMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysQualificationMap[key]=scope.sysQualificationMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysQualificationMap[key]=new Date(scope.sysQualificationMap[key])))}),scope.sysQualificationMap=angular.copy(sysQualificationModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.sysqualificationForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysQualificationMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysQualificationService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysQualificationService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.sysqualification.search.directive",[]).directive("sysqualificationSearch",function(sysQualificationService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/sysqualification/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"name",value:""},{type:"text",name:"Isenable",value:""},{type:"text",name:"Created_by",value:""}],select:["name","Isenable","Created_by"]}},loadList=function(){sysQualificationService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.sysrltypes",["app.loggedIn.sysrltypes.directives","app.loggedIn.sysrltypes.services"]),angular.module("app.loggedIn.sysrltypes.services",[]).factory("sysrlTypesService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/sysrltypes/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.sysrltypes.directives",["app.loggedIn.sysrltypes.detail.directive","app.loggedIn.sysrltypes.search.directive"]),angular.module("app.loggedIn.sysrltypes.detail.directive",[]).directive("sysrltypesDetail",function(sysrlTypesModel,ConfigService,sysrlTypesService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/sysrltypes/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysrlTypesService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysrlTypesMap,response.data);for(var key in scope.sysrlTypesMap)scope.sysrlTypesMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysrlTypesMap[key]=scope.sysrlTypesMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysrlTypesMap[key]=new Date(scope.sysrlTypesMap[key])))}),scope.sysrlTypesMap=angular.copy(sysrlTypesModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.sysrltypesForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysrlTypesMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysrlTypesService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysrlTypesService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.sysrltypes.search.directive",[]).directive("sysrltypesSearch",function(sysrlTypesService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/sysrltypes/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"Rl_TYPE_NAME",value:""},{type:"text",name:"ISENABLE",value:""},{type:"text",name:"Created_by",value:""}],select:["Rl_TYPE_NAME","ISENABLE","Created_by"]}},loadList=function(){sysrlTypesService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.sysservice",["app.loggedIn.sysservice.directives","app.loggedIn.sysservice.services"]),angular.module("app.loggedIn.sysservice.services",[]).factory("sysServiceService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/sysservice/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService.byClinicalDepartment=function(dept_id){var funcApi=mdtApi.all("byClinicalDepartment");return funcApi.post({dept_id:dept_id})},mdtService}),angular.module("app.loggedIn.sysservice.directives",["app.loggedIn.sysservice.detail.directive","app.loggedIn.sysservice.search.directive"]),angular.module("app.loggedIn.sysservice.detail.directive",[]).directive("sysserviceDetail",function(sysServiceModel,ConfigService,sysServiceService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/sysservice/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysServiceService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysServiceMap,response.data);for(var key in scope.sysServiceMap)scope.sysServiceMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysServiceMap[key]=scope.sysServiceMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysServiceMap[key]=new Date(scope.sysServiceMap[key])));

}),scope.sysServiceMap=angular.copy(sysServiceModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.sysserviceForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysServiceMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysServiceService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysServiceService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.sysservice.search.directive",[]).directive("sysserviceSearch",function(sysServiceService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/sysservice/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"SERVICE_NAME",value:""},{type:"text",name:"DESCRIPTION",value:""},{type:"text",name:"Isenable",value:""}],select:["SERVICE_NAME","DESCRIPTION","Isenable"]}},loadList=function(){sysServiceService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.sysservices",["app.loggedIn.sysservices.directives","app.loggedIn.sysservices.services","app.loggedIn.sysservices.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.sysservices",{"abstract":!0,templateUrl:"modules/sysservices/views/structure.html",controller:"SysServicesController"}).state("loggedIn.sysservices.list",{url:"/services",views:{"main-content":{templateUrl:"modules/sysservices/views/serviceslist.html",controller:"SysServicesListController"}}}).state("loggedIn.sysservices.add",{url:"/services/add",views:{"main-content":{templateUrl:"modules/sysservices/views/serviceadd.html",controller:"SysServicesAddController"}}})}),angular.module("app.loggedIn.sysservices.services",[]).factory("SysServicesService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/sysservices/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.sysservices.directives",["app.loggedIn.sysservices.detail.directive","app.loggedIn.sysservices.search.directive"]),angular.module("app.loggedIn.sysservices.detail.directive",[]).directive("sysservicesDetail",function($cookieStore,SysServicesModel,ConfigService,SysServicesService,toastr){return{restrict:"EA",scope:{options:"=",params:"=",isAction:"="},templateUrl:"modules/sysservices/directives/templates/detail.html",link:function(scope,element,attrs){scope.$watch("params.permission",function(){scope.params.permission.edit===!0&&(console.log("changed"),init())});var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&SysServicesService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.SysServicesMap,response.data);for(var key in scope.SysServicesMap)scope.SysServicesMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.SysServicesMap[key]=scope.SysServicesMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.SysServicesMap[key]=new Date(scope.SysServicesMap[key])))}),scope.SysServicesMap=angular.copy(SysServicesModel)};init(),scope.cancelUpdate=function(){scope.SysServicesMap={},scope.params.permission.edit=!1,scope.params.permission.create=!0},scope.clickAction=function(){if(scope.isSubmit=!0,scope.sysservicesForm.$invalid)toastr.error("You got some fields left","Error");else{var uID=$cookieStore.get("userInfo").id,postData=angular.copy(scope.SysServicesMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?(postData.Last_updated_by=uID,console.log(postData),SysServicesService.edit(scope.params.id,postData).then(function(response){"error"==response.status?toastr.error("Error Get Detail","Error"):(toastr.success("Edit Successfully !!!","Success"),scope.isAction="edit",scope.SysServicesMap={},scope.params.permission.edit=!1,scope.params.permission.create=!0,init())})):(postData.Created_by=uID,SysServicesService.add(postData).then(function(data){"error"==data.status?toastr.error("Cannot Insert","Error"):(toastr.success("Insert Successfully !!!","Success"),scope.isAction="add",init())}),init())}}}}}),angular.module("app.loggedIn.sysservices.search.directive",[]).directive("sysservicesSearch",function(SysServicesService,toastr){return{restrict:"EA",scope:{clickRow:"&",isLoad:"="},templateUrl:"modules/sysservices/directives/templates/search.html",link:function(scope,element,attrs){scope.$watch("isLoad",function(newIsLoad){console.log("changed"),newIsLoad===!0&&(init(),loadList(),scope.isLoad=!1)});var init=function(){scope.list={},scope.params={pagination:{limit:100,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"SERVICE_NAME",value:""},{type:"text",name:"DESCRIPTION",value:""},{type:"text",name:"SERVICE_COLOR",value:""}],select:["SERVICE_ID","FEE_TYPE_ID","SERVICE_NAME","DESCRIPTION","SERVICE_COLOR","IS_REFERRAL","Isenable","IS_BOOKABLE"]}},loadList=function(){SysServicesService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.sysservices.controller",["app.loggedIn.sysservices.list.controller"]).controller("SysServicesController",function($scope,toastr){}),angular.module("app.loggedIn.sysservices.list.controller",[]).controller("SysServicesListController",function($scope,localStorageService){$scope.params={permission:{create:!0,edit:!1}},$scope.isAction="",$scope.isLoad=!1,$scope.$watch("isAction",function(newAction){console.log("isActionChnaged"),"add"===newAction&&($scope.isLoad=!0,$scope.isAction=""),"edit"===newAction&&($scope.isLoad=!0,$scope.isAction="")}),$scope.getRow=function(row){$scope.params={permission:{create:!1,edit:!0},id:row.SERVICE_ID}}}),angular.module("app.loggedIn.sysstate",["app.loggedIn.sysstate.directives","app.loggedIn.sysstate.services"]),angular.module("app.loggedIn.sysstate.services",[]).factory("sysStateService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/sysstate/");return mdtService.list=function(country_name){var funcApi=mdtApi.all("list");return funcApi.post({country_name:country_name})},mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.sysstate.directives",["app.loggedIn.sysstate.detail.directive","app.loggedIn.sysstate.search.directive"]),angular.module("app.loggedIn.sysstate.detail.directive",[]).directive("sysstateDetail",function(sysStateModel,ConfigService,sysStateService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/sysstate/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysStateService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysStateMap,response.data);for(var key in scope.sysStateMap)scope.sysStateMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysStateMap[key]=scope.sysStateMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysStateMap[key]=new Date(scope.sysStateMap[key])))}),scope.sysStateMap=angular.copy(sysStateModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.sysstateForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysStateMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysStateService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysStateService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.sysstate.search.directive",[]).directive("sysstateSearch",function(sysStateService,toastr){return{restrict:"EA",scope:{clickRow:"&"},templateUrl:"modules/sysstate/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"State",value:""},{type:"text",name:"Country_name",value:""},{type:"text",name:"Isenable",value:""}],select:["State","Country_name","Isenable"]}},loadList=function(){sysStateService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.systitle",["app.loggedIn.systitle.directives","app.loggedIn.systitle.services"]),angular.module("app.loggedIn.systitle.services",[]).factory("sysTitleService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/systitle/");return mdtService.add=function(postData){var funcApi=mdtApi.all("add");return funcApi.post({add_data:postData})},mdtService.edit=function(id,postData){var funcApi=mdtApi.all("edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.byId=function(id){var funcApi=mdtApi.all("byId");return funcApi.post({detail_id:id})},mdtService.search=function(option){var funcApi=mdtApi.all("search");return funcApi.post(option)},mdtService}),angular.module("app.loggedIn.systitle.directives",["app.loggedIn.systitle.detail.directive","app.loggedIn.systitle.search.directive"]),angular.module("app.loggedIn.systitle.detail.directive",[]).directive("systitleDetail",function(sysTitleModel,ConfigService,sysTitleService,toastr){return{restrict:"EA",scope:{options:"=",params:"="},templateUrl:"modules/systitle/directives/templates/detail.html",link:function(scope,element,attrs){var init=function(){scope.isSubmit=!1,scope.params.permission.edit===!0&&sysTitleService.byId(scope.params.id).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),angular.extend(scope.sysTitleMap,response.data);for(var key in scope.sysTitleMap)scope.sysTitleMap[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.sysTitleMap[key]=scope.sysTitleMap[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE"))&&(scope.sysTitleMap[key]=new Date(scope.sysTitleMap[key])))}),scope.sysTitleMap=angular.copy(sysTitleModel)};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.systitleForm.$invalid)toastr.error("You got some fields left","Error");else{var postData=angular.copy(scope.sysTitleMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.permission.edit===!0?sysTitleService.edit(scope.params.id,postData).then(function(response){"error"==response.status&&toastr.error("Error Get Detail","Error"),init(),toastr.success("Edit Successfully !!!","Success")}):(sysTitleService.add(postData).then(function(data){"error"==data.status&&toastr.error("Cannot Insert","Error"),toastr.success("Insert Successfully !!!","Success"),init()}),init())}}}}}),angular.module("app.loggedIn.systitle.search.directive",[]).directive("systitleSearch",function(sysTitleService,toastr){return{restrict:"EA",scope:{clickRow:"="},templateUrl:"modules/systitle/directives/templates/search.html",link:function(scope,element,attrs){var init=function(){scope.list={},scope.params={pagination:{limit:5,offset:0,current_page:1,max_size:3},filters:[{type:"text",name:"name",value:""},{type:"text",name:"Isenable",value:""},{type:"text",name:"Created_by",value:""}],select:["name","Isenable","Created_by"]}},loadList=function(){sysTitleService.search(scope.params).then(function(response){"error"===response.status&&toastr.error("Cannot get Seacrh","Error"),scope.list=response})};init(),loadList(),scope.setPage=function(){scope.params.pagination.offset=(scope.params.pagination.current_page-1)*scope.params.pagination.limit,loadList()}}}}),angular.module("app.loggedIn.telehealth",["app.loggedIn.telehealth.formController","app.loggedIn.telehealth.services"]).config(function($stateProvider){$stateProvider.state("loggedIn.telehealthForm",{url:"/telehealth/form",templateUrl:"modules/telehealth/views/patientForm.html",controller:"TelehealthFormController"})}),angular.module("app.loggedIn.telehealth.formController",[]).controller("TelehealthFormController",function($scope,$rootScope,$http,TelehealthService){var initPickers=function(){$(".date-picker").datepicker({rtl:Metronic.isRTL(),autoclose:!0}).on("changeDate",function(evn){})};initPickers()}),angular.module("app.loggedIn.telehealth.services",[]).factory("TelehealthService",function(Restangular){var telehealthService={};return telehealthService}),angular.module("app.loggedIn.template",["app.loggedIn.template.include"]).config(function($stateProvider){$stateProvider.state("loggedIn.template",{url:"/template",templateUrl:"modules/template/views/list.html",controller:"TemplateListController"}).state("loggedIn.template_add",{url:"/template/add",templateUrl:"modules/template/views/add.html",controller:"TemplateAddController"}).state("loggedIn.template_write",{url:"/template/write/:id",templateUrl:"modules/template/views/write.html",controller:"TemplateWriteController"}).state("loggedIn.template_edit",{url:"/template/edit/:id",templateUrl:"modules/template/views/edit.html",controller:"TemplateEditController"}).state("loggedIn.patient.template",{url:"/template",views:{"main-content":{templateUrl:"modules/template/views/patient_list.html",controller:"TemplatePatientListController"}}}).state("loggedIn.patient.template_add",{url:"/template/add",views:{"main-content":{templateUrl:"modules/template/views/patient_add.html",controller:"TemplatePatientAddController"}}})}),angular.module("app.loggedIn.template.include",["app.loggedIn.template.controllers.list","app.loggedIn.template.controllers.patient_list","app.loggedIn.template.controllers.patient_add","app.loggedIn.template.controllers.add","app.loggedIn.template.controllers.edit","app.loggedIn.template.controllers.write","app.loggedIn.template.model","app.loggedIn.template.directives.list","app.loggedIn.template.directives.patient_list","app.loggedIn.template.directives.patient_write","app.loggedIn.template.directives.patient_add","app.loggedIn.template.directives.patient_edit","app.loggedIn.template.directives.add","app.loggedIn.template.directives.edit","app.loggedIn.template.directives.write"]),angular.module("app.loggedIn.template.model",[]).factory("TemplateModel",function(Restangular,$http){var instanceService={},appApi=Restangular.all("api/meditek/v1/template"),uploadUrl="api/meditek/v1/template/";return instanceService.add=function(data){var detailApi=appApi.all("add");return detailApi.post({data:data})},instanceService.update=function(data){var detailApi=appApi.all("update");return detailApi.post({data:data})},instanceService.list=function(data){var detailApi=appApi.all("list");return detailApi.post({data:data})},instanceService.one=function(data){var detailApi=appApi.all("one");return detailApi.post({data:data})},instanceService["delete"]=function(data){var detailApi=appApi.all("delete");return detailApi.post({data:data})},instanceService.write=function(data){var detailApi=appApi.all("write");return detailApi.post({data:data})},instanceService.download=function(data){return"https://localhost:3000/"+uploadUrl+"download/"+data.id+"/"+data.patient_id+"/"+data.cal_id},instanceService}),angular.module("app.loggedIn.template.controllers.list",[]).controller("TemplateListController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.list",[]).directive("templateList",function($modal,$http,$state,$cookieStore,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{limit:"=",reload:"="},templateUrl:"modules/template/directives/templates/list.html",link:function(scope,elem,attrs){scope.removeList=function(list){var modalInstance=$modal.open({templateUrl:"removeTemplate",controller:function($scope,$modalInstance){$scope.clickNo=function(){$modalInstance.dismiss("cancel")},$scope.clickYes=function(){$modalInstance.close("success")}}});modalInstance.result.then(function(response){response&&TemplateModel["delete"]({id:list.id}).then(function(){load()})})},scope.goToAdd=function(){$state.go("loggedIn.template_add")},scope.goToWrite=function(list){$state.go("loggedIn.template_write",{id:list.id})},scope.goToEdit=function(list){$state.go("loggedIn.template_edit",{id:list.id})};var load=function(){TemplateModel.list({}).then(function(response){scope.template.list=response.data},function(error){})};scope.template={list:[]},load()}}}),angular.module("app.loggedIn.template.controllers.patient_list",[]).controller("TemplatePatientListController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.patient_list",[]).directive("templatePatientList",function($modal,$modal,$state,$cookieStore,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{patientId:"=",calId:"=",success:"="},templateUrl:"modules/template/directives/templates/patient_list.html",link:function(scope,elem,attrs){scope.goToWrite=function(list){var modalInstance=$modal.open({templateUrl:"writeTemplateDialog",size:"lg",controller:function($scope,$modalInstance,patientId,calId){$scope.patient_id=patientId,$scope.cal_id=calId,$scope.success=null,$scope.template_id=list.id,$scope.$watch("success",function(success){success&&$modalInstance.close(success)})},resolve:{patientId:function(){return scope.patientId},calId:function(){return scope.calId}}});modalInstance.result.then(function(result){console.log(result),scope.success=result})},scope.goToEdit=function(list){var modalInstance=$modal.open({templateUrl:"editTemplateDialog",size:"lg",controller:function($scope,$modalInstance,patientId,calId){$scope.patient_id=patientId,$scope.cal_id=calId,$scope.success=!1,$scope.template_id=list.id,$scope.$watch("success",function(success){success&&$modalInstance.close("success")})},resolve:{patientId:function(){return scope.patientId},calId:function(){return scope.calId}}});modalInstance.result.then(function(result){"success"===result&&load()})},scope.goToAdd=function(){var modalInstance=$modal.open({templateUrl:"addTemplateDialog",size:"lg",controller:function($scope,$modalInstance,patientId,calId){$scope.patient_id=patientId,$scope.cal_id=calId,$scope.success=!1,$scope.$watch("success",function(success){success&&$modalInstance.close("success")})},resolve:{patientId:function(){return scope.patientId},calId:function(){return scope.calId}}});modalInstance.result.then(function(result){"success"===result&&load()})};var load=function(){TemplateModel.list({}).then(function(response){scope.template.list=response.data},function(error){})};scope.template={list:[]},load()}}}),angular.module("app.loggedIn.template.controllers.patient_add",[]).controller("TemplatePatientAddController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.patient_add",[]).directive("templatePatientAdd",function($modal,$cookieStore,$state,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{patientId:"=",calId:"=",success:"="},templateUrl:"modules/template/directives/templates/patient_add.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,patientLoad=function(patient_id){PatientService.get(patient_id).then(function(response){scope.patient.one=response.data},function(error){})};scope.patient={one:null,load:function(patient_id){patientLoad(patient_id)}},scope.$watch("patientId",function(patientId){"undefined"!=typeof patientId&&scope.patient.load(patientId)});var element=$("#editor");element.wysiwyg({toolbar:"top",buttons:{bold:{title:"Bold (Ctrl+B)",image:"",hotkey:"b"},italic:{title:"Italic (Ctrl+I)",image:"",hotkey:"i"},underline:{title:"Underline (Ctrl+U)",image:"",hotkey:"u"},insertimage:{title:"Insert image",image:"",showselection:!0},fontname:{title:"Font",image:"",popup:function($popup,$button){var list_fontnames={"Arial, Helvetica":"Arial,Helvetica",Verdana:"Verdana,Geneva",Georgia:"Georgia","Courier New":"Courier New,Courier","Times New Roman":"Times New Roman,Times"},$list=$("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");$.each(list_fontnames,function(name,font){var $link=$("<a/>").attr("href","#").css("font-family",font).html(name).click(function(event){return $(element).wysiwyg("shell").fontName(font).closePopup(),event.stopPropagation(),event.preventDefault(),!1});$list.append($link)}),$popup.append($list)},showselection:!1},strikethrough:{title:"Strikethrough (Ctrl+S)",image:"",hotkey:"s"},forecolor:{title:"Text color",image:""},highlight:{title:"Background color",image:""},alignleft:{title:"Left",image:"",showselection:!1},aligncenter:{title:"Center",image:"",showselection:!1},alignright:{title:"Right",image:"",showselection:!1},alignjustify:{title:"Justify",image:"",showselection:!1},subscript:{title:"Subscript",image:"",showselection:!0},superscript:{title:"Superscript",image:"",showselection:!0},indent:{title:"Indent",image:"",showselection:!1},outdent:{title:"Outdent",image:"",showselection:!1},orderedList:{title:"Ordered list",image:"",showselection:!1},unorderedList:{title:"Unordered list",image:"",showselection:!1},removeformat:{title:"Remove format",image:""}},selectImage:"Click or drop image",placeholderUrl:"http://sasa",maxImageSize:[600,200],forceImageUpload:!1,submit:{title:"Submit",image:""},onAutocomplete:function(typed,key,character,shiftKey,altKey,ctrlKey,metaKey){if(0==typed.indexOf(".")){var fields=[];for(var key in scope.patient.one)fields.push(key);var $list=$("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");if($.each(fields,function(index,field){var $link=$("<a/>").attr("href","javascript:void(0)").text(field).click(function(event){var html="."+field,editor=$(element).wysiwyg("shell");return editor.expandSelection(typed.length,0).insertHTML(html),editor.closePopup().getElement().focus(),event.stopPropagation(),event.preventDefault(),!1});$list.append($link)}),$list.children().length){if(13==key)return $list.children(":first").click(),!1;if(character||8==key)return $list}}}}),scope.form={name:null},scope.save=function(){var html=element.wysiwyg("shell").getHTML(),postData={name:scope.form.name,content:html,user_id:user_id};TemplateModel.add(postData).then(function(response){scope.success=!0},function(error){})}}}}),angular.module("app.loggedIn.template.directives.patient_write",[]).directive("templatePatientWrite",function($modal,$window,$cookieStore,$state,$stateParams,$timeout,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{id:"=",patientId:"=",calId:"=",success:"="},templateUrl:"modules/template/directives/templates/patient_write.html",link:function(scope,elem,attrs){scope.exportPDF=function(){var content=$("#writeTemplate").html();content=content.replace(/&nbsp;&nbsp;/g,"</input>"),content=content.replace(/test/g,"</img>"),content=content.replace(/<br>/g,"<br/>"),console.log(content),TemplateModel.write({name:scope.template.one.name,content:content}).then(function(response){$window.open(TemplateModel.download({id:response.data.id,cal_id:$stateParams.cal_id,patient_id:$stateParams.patient_id}))},function(error){})};var patientLoad=function(patient_id){PatientService.get(patient_id).then(function(response){scope.patient.one=response.data,loadTemplate(scope.id)},function(error){})};scope.patient={one:null,load:function(patient_id){patientLoad(patient_id)}},scope.$watch("patientId",function(patientId){"undefined"!=typeof patientId&&scope.patient.load(patientId)});var loadTemplate=function(id){TemplateModel.one({id:id}).then(function(response){scope.template.one=response.data[0];for(var content=scope.template.one.content,new_content="";-1!==content.indexOf("{#input");){var index_first=content.indexOf("{#input"),index_last=content.indexOf("#}"),string_change=content.substring(index_first+2,index_last),split_string_change=string_change.split("."),new_string_change="";if(1===split_string_change.length)new_string_change='<input class="custom-input-template" value="" placeholder="Please fill in">&nbsp;&nbsp;';else{var field=split_string_change[1];for(var key in scope.patient.one)if(key===field){new_string_change=scope.patient.one[key];break}}new_content+=content.substring(0,index_last+2),new_content=new_content.replace("{#"+string_change+"#}",new_string_change),content=content.substring(index_last+2,content.length)}new_content+=content,$("#writeTemplate").html(new_content),$(".custom-input-template").on("input",function(e){$(this).attr("size",e.target.value.length),$(this).attr("value",e.target.value)})})};scope.template={one:null}}}}),angular.module("app.loggedIn.template.directives.patient_edit",[]).directive("templatePatientEdit",function($modal,$cookieStore,$state,$stateParams,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{id:"=",patientId:"=",calId:"=",success:"="},templateUrl:"modules/template/directives/templates/patient_edit.html",link:function(scope,elem,attrs){var patientLoad=($cookieStore.get("userInfo").id,function(patient_id){PatientService.get(patient_id).then(function(response){scope.patient.one=response.data},function(error){})});scope.patient={one:null,load:function(patient_id){patientLoad(patient_id)}},scope.$watch("patientId",function(patientId){"undefined"!=typeof patientId&&scope.patient.load(patientId)});var element=$("#editor");element.wysiwyg({toolbar:"top",buttons:{bold:{title:"Bold (Ctrl+B)",image:"",hotkey:"b"},italic:{title:"Italic (Ctrl+I)",image:"",hotkey:"i"},underline:{title:"Underline (Ctrl+U)",image:"",hotkey:"u"},insertimage:{title:"Insert image",image:"",showselection:!0},fontname:{title:"Font",image:"",popup:function($popup,$button){var list_fontnames={"Arial, Helvetica":"Arial,Helvetica",Verdana:"Verdana,Geneva",Georgia:"Georgia","Courier New":"Courier New,Courier","Times New Roman":"Times New Roman,Times"},$list=$("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");$.each(list_fontnames,function(name,font){var $link=$("<a/>").attr("href","#").css("font-family",font).html(name).click(function(event){return $(element).wysiwyg("shell").fontName(font).closePopup(),event.stopPropagation(),event.preventDefault(),!1});$list.append($link)}),$popup.append($list)},showselection:!1},strikethrough:{title:"Strikethrough (Ctrl+S)",image:"",hotkey:"s"},forecolor:{title:"Text color",image:""},highlight:{title:"Background color",image:""},alignleft:{title:"Left",image:"",showselection:!1},aligncenter:{title:"Center",image:"",showselection:!1},alignright:{title:"Right",image:"",showselection:!1},alignjustify:{title:"Justify",image:"",showselection:!1},subscript:{title:"Subscript",image:"",showselection:!0},superscript:{title:"Superscript",image:"",showselection:!0},indent:{title:"Indent",image:"",showselection:!1},outdent:{title:"Outdent",image:"",showselection:!1},orderedList:{title:"Ordered list",image:"",showselection:!1},unorderedList:{title:"Unordered list",image:"",showselection:!1},removeformat:{title:"Remove format",image:""}},selectImage:"Click or drop image",placeholderUrl:"http://sasa",maxImageSize:[600,200],forceImageUpload:!1,submit:{title:"Submit",image:""},onAutocomplete:function(typed,key,character,shiftKey,altKey,ctrlKey,metaKey){if(0==typed.indexOf(".")){var fields=[];for(var key in scope.patient.one)fields.push(key);var $list=$("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");if($.each(fields,function(index,field){var $link=$("<a/>").attr("href","javascript:void(0)").text(field).click(function(event){var html="."+field,editor=$(element).wysiwyg("shell");return editor.expandSelection(typed.length,0).insertHTML(html),editor.closePopup().getElement().focus(),event.stopPropagation(),event.preventDefault(),!1});$list.append($link)}),$list.children().length){if(13==key)return $list.children(":first").click(),!1;if(character||8==key)return $list}}}}),scope.form={name:null},scope.save=function(){var html=element.wysiwyg("shell").getHTML(),postData={name:scope.form.name,content:html,id:scope.id};TemplateModel.update(postData).then(function(response){scope.success=!0},function(error){})};var loadTemplate=function(){TemplateModel.one({id:scope.id}).then(function(response){scope.form=response.data[0],element.wysiwyg("shell").setHTML(scope.form.content)})};scope.$watch("id",function(id){"undefined"!=typeof id&&loadTemplate()})}}}),angular.module("app.loggedIn.template.controllers.add",[]).controller("TemplateAddController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.add",[]).directive("templateAdd",function($modal,$cookieStore,$state,TemplateModel,toastr){return{restrict:"EA",scope:{},templateUrl:"modules/template/directives/templates/add.html",link:function(scope,elem,attrs){var user_id=$cookieStore.get("userInfo").id,quill=new Quill("#editor",{modules:{authorship:{authorId:"advanced",enabled:!0},"link-tooltip":!0,"image-tooltip":!0,"multi-cursor":!0},theme:"snow"});quill.addModule("toolbar",{container:"#toolbar"}),scope.form={name:null},scope.save=function(){var html=quill.getHTML(),postData={name:scope.form.name,content:html,user_id:user_id};TemplateModel.add(postData).then(function(response){$state.go("loggedIn.template")},function(error){})}}}}),angular.module("app.loggedIn.template.controllers.write",[]).controller("TemplateWriteController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.write",[]).directive("templateWrite",function($modal,$cookieStore,$state,$stateParams,$timeout,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{},templateUrl:"modules/template/directives/templates/write.html",link:function(scope,elem,attrs){scope.savePDF=function(){var doc=new jsPDF;doc.fromHTML($("#writeTemplate").get(0),15,15,{width:170}),doc.save("test.pdf")};var patientLoad=function(patient_id){PatientService.get(patient_id).then(function(response){
scope.patient.one=response.data,loadTemplate()},function(error){})};if(scope.patient={one:null,load:function(patient_id){patientLoad(patient_id)}},$cookieStore.get("template_patient_id")){var patient_id=$cookieStore.get("template_patient_id");scope.patient.load(patient_id)}var loadTemplate=function(){TemplateModel.one({id:$stateParams.id}).then(function(response){scope.template.one=response.data[0];for(var content=scope.template.one.content,new_content="";-1!==content.indexOf("{#input");){var index_first=content.indexOf("{#input"),index_last=content.indexOf("#}"),string_change=content.substring(index_first+2,index_last),split_string_change=string_change.split("."),new_string_change="";if(1===split_string_change.length)new_string_change='<input class="custom-input-template" placeholder="Please fill in"/>';else{var field=split_string_change[1];for(var key in scope.patient.one)if(key===field){new_string_change=scope.patient.one[key];break}}new_content+=content.substring(0,index_last+2),new_content=new_content.replace("{#"+string_change+"#}",new_string_change),content=content.substring(index_last+2,content.length)}$("#writeTemplate").html(new_content),$(".custom-input-template").on("input",function(e){$(this).attr("size",e.target.value.length)})})};scope.template={one:null}}}}),angular.module("app.loggedIn.template.controllers.edit",[]).controller("TemplateEditController",function($scope,$modal,toastr){}),angular.module("app.loggedIn.template.directives.edit",[]).directive("templateEdit",function($modal,$cookieStore,$state,$stateParams,TemplateModel,toastr,PatientService){return{restrict:"EA",scope:{},templateUrl:"modules/template/directives/templates/edit.html",link:function(scope,elem,attrs){var quill=($cookieStore.get("userInfo").id,new Quill("#editor",{modules:{"link-tooltip":!0,"image-tooltip":!0,"multi-cursor":!0},theme:"snow"}));quill.addModule("toolbar",{container:"#toolbar"}),scope.form={name:null},scope.save=function(){var html=quill.getHTML(),postData={name:scope.form.name,content:html,id:$stateParams.id};TemplateModel.update(postData).then(function(response){$state.go("loggedIn.template")},function(error){})};var loadTemplate=function(){TemplateModel.one({id:$stateParams.id}).then(function(response){scope.form=response.data[0],quill.setHTML(scope.form.content)})};loadTemplate()}}}),angular.module("app.loggedIn.timetable",["app.loggedIn.timetable.include"]),angular.module("app.loggedIn.timetable.include",["app.loggedIn.timetable.directives.calendar","app.loggedIn.timetable.dialogs.addDay","app.loggedIn.timetable.dialogs.editDay","app.loggedIn.timetable.dialogs.addSite","app.loggedIn.timetable.model"]),angular.module("app.loggedIn.timetable.directives.calendar",[]).directive("timetableCalendar",function(TimetableModel,$modal,$stateParams,mdtDoctorService,sysServiceService,toastr){return{restrict:"EA",templateUrl:"modules/timetable/directives/templates/calendar.html",link:function(scope,elem,attrs){scope.weekDisplay={0:"Weekly",1:"Week 1",2:"Week 2",3:"Week 3",4:"Week 4"};var load=function(){TimetableModel.list({doctor_id:$stateParams.doctorId}).then(function(response){scope.timetable.list=response.data,scope.displayInRow={};for(var i=0;i<scope.timetable.list.length;i++){var item=scope.timetable.list[i];scope.displayInRow[item.day_of_week_value]||(scope.displayInRow[item.day_of_week_value]={value:item.cal_header_df_id,services:{}}),scope.displayInRow[item.day_of_week_value].services[item.service_id]||(scope.displayInRow[item.day_of_week_value].services[item.service_id]=item.cal_header_df_id)}scope.site.load()},function(error){})},siteLoad=function(){TimetableModel.siteList({doctor_id:$stateParams.doctorId}).then(function(response){var i=0;_.forEach(scope.timetable.list,function(timetable_row){scope.timetable.list[i].site=[],_.forEach(response.data,function(site_row){site_row.cal_header_df_id===timetable_row.cal_header_df_id&&scope.timetable.list[i].site.push(site_row)}),i++})},function(error){})},addDay=function(){var modalInstance=$modal.open({templateUrl:"modules/timetable/dialogs/templates/addDay.html",controller:"TimetableCalendarAddDayDialog",size:"lg",resolve:{services:function(){return scope.service.list},doctor:function(){return scope.doctor.item}}});modalInstance.result.then(function(status){"add"===status&&scope.timetable.load()})},doctorLoad=function(){mdtDoctorService.byId($stateParams.doctorId).then(function(response){scope.doctor.item=response.data,serviceLoad(response.data.CLINICAL_DEPT_ID)},function(error){})},serviceLoad=function(clinical_dept_id){sysServiceService.byClinicalDepartment(clinical_dept_id).then(function(response){scope.service.list=response.data})},addSite=function(row){var modalInstance=$modal.open({templateUrl:"modules/timetable/dialogs/templates/addSite.html",controller:"TimetableCalendarAddSiteDialog",size:"lg",resolve:{row:function(){return row},doctor:function(){return scope.doctor.item}}});modalInstance.result.then(function(status){"add"===status&&scope.timetable.load()})},saveTimetable=function(row){var postData=angular.copy(row);switch(postData.day_of_Week_code=null,postData.day_of_Week){case"Monday":postData.day_of_Week_code=1;break;case"Tuesday":postData.day_of_Week_code=2;break;case"Wednesday":postData.day_of_Week_code=3;break;case"Thursday":postData.day_of_Week_code=4;break;case"Friday":postData.day_of_Week_code=5;break;case"Saturday":postData.day_of_Week_code=6}postData.clinical_dept_id=scope.doctor.item.CLINICAL_DEPT_ID,postData.appt_interval=row.appt_interval,TimetableModel.createTimetable(postData).then(function(response){toastr.success("success"==response.status?"Timetable is created":"Create timetable fail.")},function(error){toastr.error("Create timetable fail.")})},editTimetable=function(row){$modal.open({templateUrl:"modules/timetable/dialogs/templates/editDay.html",controller:"TimetableCalendarEditDayDialog",size:"lg",resolve:{row:function(){return row},services:function(){return scope.service.list},doctor:function(){return scope.doctor.item}}}).result.then(function(response){"success"===response&&scope.timetable.load()})},openTimetable=function(row){row.clinical_dept_id=scope.doctor.item.CLINICAL_DEPT_ID;var modalInstance=$modal.open({templateUrl:"notifyToSaveTimetable",controller:function($scope,row,$modalInstance){$scope.bookedList=[],TimetableModel.beforeGenerateCalendar(row).then(function(data){"success"==data.status?$scope.bookedList=data.data:toastr.error("Error when check data.")},function(err){toastr.error("Error when check data.")}),$scope.ok=function(){$modalInstance.close(row)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},resolve:{row:function(){return row}}});modalInstance.result.then(function(row){row&&scope.timetable.saveTimetable(row)})},removeDay=function(row){var modalInstance=$modal.open({templateUrl:"notifyToRemoveDay",controller:function($scope,row,$modalInstance){$scope.ok=function(){$modalInstance.close(row)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},size:"sm",resolve:{row:function(){return row}}});modalInstance.result.then(function(row){row&&TimetableModel.remove(row).then(function(response){toastr.success("Remove Day Successfully"),scope.timetable.load()},function(error){})})},removeSite=function(id){var modalInstance=$modal.open({templateUrl:"notifyToRemoveSite",controller:function($scope,id,$modalInstance){$scope.ok=function(){$modalInstance.close(id)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}},size:"sm",resolve:{id:function(){return id}}});modalInstance.result.then(function(id){id&&TimetableModel.siteRemove({id:id}).then(function(response){"success"==response.status?(toastr.success("Remove Successfully."),scope.timetable.load()):toastr.error("Remove fail.")},function(error){toastr.error("Remove fail.")})})};scope.timetable={load:function(){load()},dialog:{removeDay:function(row){removeDay(row)},openTimetable:function(row){openTimetable(row)},editTimetable:function(row){editTimetable(row)},addDay:function(){addDay()}},list:[],form:{day_of_Week:"",SERVICE_ID:null,from_time:"",to_time:"",from_date:null,to_date:null,description:""},saveTimetable:function(row){saveTimetable(row)}},scope.site={load:function(){siteLoad()},dialog:{addSite:function(row){addSite(row)},removeSite:function(id){removeSite(id)}}},scope.doctor={load:function(){doctorLoad()},item:{}},scope.service={list:[],load:function(){serviceLoad()}},scope.timetable.load(),scope.doctor.load(),scope.service.load()}}}),angular.module("app.loggedIn.timetable.dialogs.addDay",[]).controller("TimetableCalendarAddDayDialog",function($scope,$cookieStore,$stateParams,$modalInstance,services,doctor,TimetableModel,ConfigService,toastr){var user_id=$cookieStore.get("userInfo").id,day_of_week=[{value:"Monday"},{value:"Tuesday"},{value:"Wednesday"},{value:"Thursday"},{value:"Friday"},{value:"Saturday"}],save=function(){ConfigService.beforeSave($scope.timetable.errors),$scope.timetable.errors=[];var postData=angular.copy($scope.timetable.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Created_by=postData.Last_updated_by=user_id,postData.isenable=1,postData.from_date=ConfigService.convertToDB(postData.from_date),postData.to_date=ConfigService.convertToDB(postData.to_date),postData.from_time=ConfigService.convertToHHMM(postData.from_time),postData.to_time=ConfigService.convertToHHMM(postData.to_time),postData.doctor_id=$stateParams.doctorId,TimetableModel.add(postData).then(function(response){toastr.success("Added Successfully"),$modalInstance.close("add")},function(error){$scope.timetable.errors=angular.copy(error.data.errors),ConfigService.beforeError($scope.timetable.errors)})};$scope.timetable={options:{DAY_OF_WEEK:day_of_week,services:services},form:{day_of_Week:"",SERVICE_ID:null,from_time:"",to_time:"",from_date:null,to_date:null,description:"",appt_interval:doctor.Appt_interval},errors:[],save:function(){save()}}}),angular.module("app.loggedIn.timetable.dialogs.editDay",[]).controller("TimetableCalendarEditDayDialog",function($scope,$cookieStore,$stateParams,$modalInstance,services,doctor,row,TimetableModel,ConfigService,toastr){var user_id=$cookieStore.get("userInfo").id,day_of_week=[{value:"Monday"},{value:"Tuesday"},{value:"Wednesday"},{value:"Thursday"},{value:"Friday"},{value:"Saturday"}],save=function(){ConfigService.beforeSave($scope.timetable.errors),$scope.timetable.errors=[];var postData=angular.copy($scope.timetable.form);postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Created_by=postData.Last_updated_by=user_id,postData.isenable=1,postData.from_time=ConfigService.convertToHHMM(postData.from_time),postData.to_time=ConfigService.convertToHHMM(postData.to_time),postData.from_date=ConfigService.convertToDB(postData.from_date),postData.to_date=ConfigService.convertToDB(postData.to_date),postData.doctor_id=$stateParams.doctorId,TimetableModel.edit(postData).then(function(response){toastr.success("Edit Successfully"),$modalInstance.close("success")},function(error){$scope.timetable.errors=angular.copy(error.data.errors),ConfigService.beforeError($scope.timetable.errors)})},load=function(){TimetableModel.one({cal_header_df_id:row.cal_header_df_id}).then(function(response){angular.extend($scope.timetable.form,response.data),$scope.timetable.form.from_date=ConfigService.convertToDate($scope.timetable.form.from_date),$scope.timetable.form.to_date=ConfigService.convertToDate($scope.timetable.form.to_date),$scope.timetable.form.from_time=ConfigService.convertHHMMToInt($scope.timetable.form.from_time),$scope.timetable.form.to_time=ConfigService.convertHHMMToInt($scope.timetable.form.to_time),delete $scope.timetable.form.Creation_date},function(error){})};$scope.timetable={load:function(){load()},options:{DAY_OF_WEEK:day_of_week,services:services},form:{day_of_Week:"",service_id:null,from_time:"",to_time:"",from_date:null,to_date:null,description:"",appt_interval:doctor.Appt_interval},errors:[],save:function(){save()}},$scope.timetable.load()}),angular.module("app.loggedIn.timetable.dialogs.addSite",[]).controller("TimetableCalendarAddSiteDialog",function($scope,$cookieStore,$stateParams,$modalInstance,row,doctor,toastr,TimetableModel,ConfigService){var user_id=$cookieStore.get("userInfo").id,weeks=[{code:0,value:"Weekly"},{code:1,value:"Week 1"},{code:2,value:"Week 2"},{code:3,value:"Week 3"},{code:4,value:"Week 4"}],save=function(){ConfigService.beforeSave($scope.site.errors);var postData=angular.copy($scope.site.form);postData.Creation_date=postData.Last_update_date=moment().format("YYYY-MM-DD"),postData.Created_by=postData.Last_updated_by=user_id,postData.isenable=1,postData.doctor_id=$stateParams.doctorId,postData.cal_header_df_id=row.cal_header_df_id,TimetableModel.siteAdd(postData).then(function(response){toastr.success("Added Successfully"),$modalInstance.close("add")},function(error){$scope.site.errors=angular.copy(error.data.errors),ConfigService.beforeError($scope.site.errors)})};$scope.site={options:{weeks:weeks,sites:[]},form:{cal_header_df_id:null,week_ord_of_month:null,site_id:null,description:""},errors:[],save:function(){save()}};var loadOptions=function(){TimetableModel.redimedsiteList({CLINICAL_DEPT_ID:doctor.CLINICAL_DEPT_ID}).then(function(response){$scope.site.options.sites=response.data},function(error){})};loadOptions()}),angular.module("app.loggedIn.timetable.model",[]).factory("TimetableModel",function(Restangular){var instanceService={},appApi=Restangular.all("api/meditek/v1/timetable"),redimedApi=Restangular.all("api/meditek/v1/redimedsite");return instanceService.list=function(data){var detailApi=appApi.all("list");return detailApi.post({data:data})},instanceService.one=function(data){var detailApi=appApi.all("one");return detailApi.post({data:data})},instanceService.siteList=function(data){var detailApi=appApi.all("siteList");return detailApi.post({data:data})},instanceService.siteAdd=function(data){var detailApi=appApi.all("siteAdd");return detailApi.post({data:data})},instanceService.siteRemove=function(data){var detailApi=appApi.all("siteRemove");return detailApi.post({data:data})},instanceService.remove=function(data){var detailApi=appApi.all("remove");return detailApi.post({data:data})},instanceService.add=function(data){var detailApi=appApi.all("add");return detailApi.post({data:data})},instanceService.edit=function(data){var detailApi=appApi.all("edit");return detailApi.post({data:data})},instanceService.redimedsiteList=function(data){var detailApi=redimedApi.all("list");return detailApi.post({data:data})},instanceService.createTimetable=function(data){var detailApi=appApi.all("createTimetable");return detailApi.post({data:data})},instanceService.beforeGenerateCalendar=function(data){var detailApi=appApi.all("beforeGenerateCalendar");return detailApi.post({data:data})},instanceService.deleteAllCalendarInDate=function(data){var detailApi=appApi.all("deleteAllCalendarInDate");return detailApi.post({data:data})},instanceService.beforeDeleteAllCalendarInDate=function(data){var detailApi=appApi.all("beforeDeleteAllCalendarInDate");return detailApi.post({data:data})},instanceService.deleteSelectedCalendar=function(calId){var detailApi=appApi.all("deleteSelectedCalendar");return detailApi.post({calId:calId})},instanceService.beforeDeleteSelectedCalendar=function(calId){var detailApi=appApi.all("beforeDeleteSelectedCalendar");return detailApi.post({calId:calId})},instanceService.getAllCalendarInDate=function(data){var detailApi=appApi.all("getAllCalendarInDate");return detailApi.post({data:data})},instanceService.updateServiceInDate=function(data){var detailApi=appApi.all("updateServiceInDate");return detailApi.post({data:data})},instanceService}),angular.module("app.loggedIn.treeApprove.controllers",["app.loggedIn.treeApprove.listSystem.controller","app.loggedIn.treeApprove.detail.controller","app.loggedIn.treeApprove.listDepartment.controller"]),angular.module("app.loggedIn.treeApprove.detail.controller",[]).controller("DetailTree",function($scope,$modal,$cookieStore,TreeApproveService,localStorageService,toastr,$state){$scope.treeData=[],$scope.loadTree=function(){var IdTree=localStorageService.get("IdTree");IdTree.userId=$cookieStore.get("userInfo").id,TreeApproveService.LoadTreeApprove(IdTree).then(function(response){"fail"===response.status?toastr.error("Loading fail!","Error"):"findFound"===response.status||"findNull"===response.status?angular.forEach(response.result,function(nodeOfTree,index){$scope.treeData.push({id:nodeOfTree.NODE_ID,name:nodeOfTree.NODE_CODE||null,FROM_VALUE:nodeOfTree.FROM_VALUE,TO_VALUE:nodeOfTree.TO_VALUE,ISVALUE:nodeOfTree.ISVALUE,GROUP_ID:nodeOfTree.GROUP_ID,GROUP_TYPE:nodeOfTree.GROUP_TYPE,parent:void 0===nodeOfTree.TO_NODE_ID||null===nodeOfTree.TO_NODE_ID||""===nodeOfTree.TO_NODE_ID?0:nodeOfTree.TO_NODE_ID,decription:nodeOfTree.DECRIPTION||null,seq:nodeOfTree.seq})}):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error")),$scope.org_chart($scope.treeData)})};var dialogTree=function(nodeInfo){var modalInstance=$modal.open({templateUrl:"AddNode",controller:function($scope,$modalInstance,TreeApproveService){$scope.getReturnedValue=function(value){value&&$modalInstance.close({status:"addCancel",result:[]})},"addNew"===nodeInfo.status?($scope.isNew=!0,$scope.NodeIdEdit=null):"edit"===nodeInfo.status&&($scope.isNew=!1,$scope.NodeIdEdit=nodeInfo.node),$scope.getInfo=function(value){$scope.isNew===!0?(value.userId=$cookieStore.get("userInfo").id,value.seq=nodeInfo.node.seq+1,value.parent=nodeInfo.node.id,value.GROUP_ID=localStorageService.get("IdTree").GROUP_ID,value.GROUP_TYPE=localStorageService.get("IdFunction"),TreeApproveService.InsertNode(value).then(function(response){$modalInstance.close("success"===response.status?{status:"addSuccess",result:response.result}:"fail"===response.status?{status:"addFail",result:response.result}:"error"===response.status?{status:"addError",result:response.result}:{status:"addCatch",result:response.result})})):$scope.isNew===!1&&(value.userId=$cookieStore.get("userInfo").id,TreeApproveService.UpdateNode(value).then(function(response){$modalInstance.close("fail"===response.status?{status:"editFail",result:[]}:"success"===response.status?{status:"editSuccess",result:response.result}:{status:"editError",result:[]})}))}},size:"md"});modalInstance.result.then(function(data){if("addSuccess"===data.status){var treeData=[];angular.forEach(data.result,function(nodeOfTree,index){treeData.push({id:nodeOfTree.NODE_ID,name:nodeOfTree.NODE_CODE||null,FROM_VALUE:nodeOfTree.FROM_VALUE,TO_VALUE:nodeOfTree.TO_VALUE,ISVALUE:nodeOfTree.ISVALUE,GROUP_ID:nodeOfTree.GROUP_ID,GROUP_TYPE:nodeOfTree.GROUP_TYPE,parent:void 0===nodeOfTree.TO_NODE_ID||null===nodeOfTree.TO_NODE_ID||""===nodeOfTree.TO_NODE_ID?0:nodeOfTree.TO_NODE_ID,decription:nodeOfTree.DECRIPTION||null,seq:nodeOfTree.seq||-1})}),$scope.org_chart(treeData),toastr.success("Add new node success!","Success")}else if("addFail"===data.status)toastr.error("Add node fail!","Error");else if("addError"===data.status)toastr.error("Add node error!","Error");else if("addCatch"===data.status)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","500");else if("editFail"===data.status)toastr.error("Update node fail!","Error");else if("editError"===data.status)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","500");else if("editSuccess"===data.status){var treeData=[];angular.forEach(data.result,function(nodeOfTree,index){treeData.push({id:nodeOfTree.NODE_ID,name:nodeOfTree.NODE_CODE||null,FROM_VALUE:nodeOfTree.FROM_VALUE,TO_VALUE:nodeOfTree.TO_VALUE,ISVALUE:nodeOfTree.ISVALUE,GROUP_ID:nodeOfTree.GROUP_ID,GROUP_TYPE:nodeOfTree.GROUP_TYPE,parent:void 0===nodeOfTree.TO_NODE_ID||null===nodeOfTree.TO_NODE_ID||""===nodeOfTree.TO_NODE_ID?0:nodeOfTree.TO_NODE_ID,decription:nodeOfTree.DECRIPTION||null,seq:nodeOfTree.seq||-1})}),$scope.org_chart(treeData),toastr.success("Update node success!","Success")}})};$scope.org_chart=function(data){org_chart=$("#orgChart").orgChart({data:data,showControls:!0,allowEdit:!1,onAddNode:function(node){dialogTree({status:"addNew",node:node.data})},onDeleteNode:function(node){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){0!==node.data.parent?$scope.deleteNode(node):toastr.error("Can not delete root!","Fail")})},onClickNode:function(node){dialogTree({status:"edit",node:node.data.id})}})},$scope.deleteNode=function(node){var info={GROUP_ID:node.data.GROUP_ID,NODE_ID:node.data.id};TreeApproveService.DeleteNode(info).then(function(response){if("success"===response.status){var treeData=[];angular.forEach(response.result,function(nodeOfTree,index){treeData.push({id:nodeOfTree.NODE_ID,name:nodeOfTree.NODE_CODE||null,FROM_VALUE:nodeOfTree.FROM_VALUE,TO_VALUE:nodeOfTree.TO_VALUE,ISVALUE:nodeOfTree.ISVALUE,GROUP_ID:nodeOfTree.GROUP_ID,GROUP_TYPE:nodeOfTree.GROUP_TYPE,parent:void 0===nodeOfTree.TO_NODE_ID||null===nodeOfTree.TO_NODE_ID||""===nodeOfTree.TO_NODE_ID?0:nodeOfTree.TO_NODE_ID,decription:nodeOfTree.DECRIPTION||null,seq:nodeOfTree.seq||-1})}),$scope.org_chart(treeData),toastr.success("Delete node success!","Success")}else"fail"===response.status&&toastr.error("Delete node fail!","Error")})},$scope.loadTree()}),angular.module("app.loggedIn.treeApprove",["app.loggedIn.treeApprove.controllers","app.loggedIn.treeApprove.directives","app.loggedIn.treeApprove.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.treeApprove",{url:"/tree-approve","abstract":!0,templateUrl:"/modules/treeApprove/views/structure.html"}).state("loggedIn.treeApprove.ListFunction",{url:"/list-function",views:{"main-content":{templateUrl:"modules/treeApprove/views/ListFunction.html",controller:"ListFunctionController"}}}).state("loggedIn.treeApprove.ListTree",{url:"/list-tree",views:{"main-content":{templateUrl:"modules/treeApprove/views/ListTree.html",controller:"ListTreeController"}}}).state("loggedIn.treeApprove.DetailTree",{url:"/detail-tree",views:{"main-content":{templateUrl:"modules/treeApprove/views/DetailTree.html",controller:"DetailTree"}}})}),angular.module("app.loggedIn.treeApprove.listDepartment.controller",[]).controller("ListTreeController",function($scope,MODE_ROW,localStorageService,$state,TreeApproveService,$modal,$cookieStore,toastr){$scope.info={},$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchDepartmentsObject),$scope.loadList()},$scope.loadList=function(idInput){"DESC"===idInput?$scope.searchObjectMap.order="DESC":"ASC"===idInput&&($scope.searchObjectMap.order="ASC"),TreeApproveService.LoadTree($scope.searchObjectMap).then(function(response){"fail"!==response[status]?$scope.list=response:($scope.list=response,toastr.error("Loading fail!","Error"))}),$(idInput).focus()};var init=function(){$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,data:{NAME:"",Email:"",phone:null}},$scope.rows=MODE_ROW,$scope.searchDepartmentsObject={limit:10,offset:0,maxSize:5,currentPage:1,order:"DESC",GROUP_TYPE:localStorageService.get("IdFunction"),data:{GROUP_NAME:""}},$scope.searchObjectMap=angular.copy($scope.searchDepartmentsObject),$scope.list={},$scope.loadList(),$scope.dateOptions={formatYear:"yy",startingDay:1}};init(),$scope.goTotreeApproveDetail=function(IdTree){localStorageService.set("IdTree",IdTree),$state.go("loggedIn.treeApprove.DetailTree")},$scope.DeleteTree=function(groupId){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){TreeApproveService.DeleteTree(groupId).then(function(response){"success"===response.status?($scope.loadList(),toastr.success("Delete success!","Success")):"fail"===response.status?toastr.error("Delete fail!","Error"):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})})},$scope.EditTree=function(IdTree){DialogTree(IdTree)},$scope.AddTree=function(){DialogTree(null)};var DialogTree=function(groupId){var modalInstance=$modal.open({templateUrl:"AddTree",controller:function($scope,$modalInstance,TreeApproveService,localStorageService,$cookieStore){$scope.getReturnedValue=function(value){if(value){var data=[{status:"cancel",result:[]}];$modalInstance.close(data)}},$scope.getInfo=function(value){value.userId=$cookieStore.get("userInfo").id,value.GROUP_TYPE=localStorageService.get("IdFunction"),$scope.isNew===!0?TreeApproveService.InsertTree(value).then(function(responsive){if("fail"===responsive.status)toastr.error("Add new tree fail!","Error");else if("success"===responsive.status){var data=[{status:"success",result:responsive.result}];$modalInstance.close(data),toastr.success("Add new tree success!","Success")}else $state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not responsive!","Error")}):$scope.isNew===!1&&TreeApproveService.UpdateTree(value).then(function(responsive){if("fail"===responsive.status)toastr.error("Update tree fail!","Error");else if("success"===responsive.status){var data=[{status:"success",result:responsive.result}];$modalInstance.close(data),toastr.success("Update tree success!","Success")}else $state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not responsive!","Error")})},null===groupId?($scope.isNew=!0,$scope.TreeIdEdit=null):($scope.isNew=!1,$scope.TreeIdEdit=groupId)},size:"md"});modalInstance.result.then(function(data){"success"===data[0].status&&($scope.list.result=data[0].result)})}}),angular.module("app.loggedIn.treeApprove.listSystem.controller",[]).controller("ListFunctionController",function($scope,MODE_ROW,TreeApproveService,localStorageService,$state,$modal,$cookieStore,toastr){$scope.info={},$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchSystemsObject),$scope.loadList()},$scope.loadList=function(idInput){$scope.list.loading=!0,"ASC"===idInput&&($scope.searchObjectMap.order="ASC"),"DESC"===idInput&&($scope.searchObjectMap.order="DESC"),TreeApproveService.LoadFunction($scope.searchObjectMap).then(function(response){"fail"!==response[status]?$scope.list=response:($scope.list=response,toastr.error("Loading fail"))}),$scope.list.loading=!1,$(idInput).focus()},$scope.goToTree=function(IdFunction){localStorageService.set("IdFunction",IdFunction),$state.go("loggedIn.treeApprove.ListTree")},$scope.DeleteFunction=function(typeId){swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){TreeApproveService.DeleteFunction(typeId).then(function(response){"success"===response.status?($scope.loadList(),toastr.success("Delete success!","Success")):"fail"===response.status?toastr.error("Delete fail!","Error"):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not reponse!","Error"))})})},$scope.EditFunction=function(typeId){DialogFunction(typeId)},$scope.AddFunction=function(){DialogFunction(null)};var init=function(){$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,data:{NAME:"",Email:"",phone:null}},$scope.rows=MODE_ROW,$scope.searchSystemsObject={limit:10,offset:0,maxSize:5,order:"DESC",currentPage:1,data:{TYPE_NAME:""}},$scope.searchObjectMap=angular.copy($scope.searchSystemsObject),$scope.list={},$scope.list.loading=!1,$scope.loadList(),$scope.dateOptions={formatYear:"yy",startingDay:1}};init();var DialogFunction=function(typeId){var modalInstance=$modal.open({templateUrl:"AddFunction",controller:function($scope,$modalInstance,TreeApproveService,localStorageService){$scope.getReturnedValue=function(value){if(value){var data=[{status:"cancel",result:null}];$modalInstance.close(data)}},null===typeId?($scope.isNew=!0,$scope.FunctionIdEdit=null):($scope.isNew=!1,$scope.FunctionIdEdit=typeId),$scope.getInfo=function(value){value.userId=$cookieStore.get("userInfo").id,$scope.isNew===!0?TreeApproveService.InsertFunction(value).then(function(responsive){"error"===responsive.status?($modalInstance.close(),toastr.error("Add function fail!","Error")):"success"===responsive.status?($modalInstance.close(),$state.go("loggedIn.treeApprove.ListFunction",null,{reload:!0}),toastr.success("Add function success!","success")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not responsive!","Error"))}):$scope.isNew===!1&&TreeApproveService.UpdateFunction(value).then(function(responsive){"error"===responsive.status?($modalInstance.close(),toastr.error("Update function fail!","Error")):"success"===responsive.status?($modalInstance.close(),$state.go("loggedIn.treeApprove.ListFunction",null,{reload:!0}),toastr.success("Update function success!","success")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not responsive!","Error"))})}},size:"md"});modalInstance.result.then(function(data){$scope.loadList()})}}),angular.module("app.loggedIn.treeApprove.AddNode.directive",[]).directive("addNode",function(TreeApproveService,toastr,$state){return{restrict:"EA",require:"ngModel",scope:{onCancel:"&",onSave:"&",ngModel:"="},link:function(scope,element,attrs){scope.$watch("ngModel",function(newModel){null!==newModel?(scope.addOrUpdateTitle="Update Node",scope.addOrUpdateButton="Update",TreeApproveService.LoadOneNode(newModel).then(function(response){"error"===response.status?toastr.error("Loading error!","Error"):"fail"===response.status?toastr.error("Loading fail!","Fail"):"success"===response.status?scope.info=angular.copy(response.result):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not reponse!","Error"))})):(scope.addOrUpdateTitle="Add Node",scope.addOrUpdateButton="Add")})},templateUrl:"modules/treeApprove/directives/templates/AddNode.html"}}),angular.module("app.loggedIn.treeApprove.AddSystem.directive",[]).directive("addFunction",function(TreeApproveService,toastr,$state){return{restrict:"EA",require:"ngModel",scope:{onCancel:"&",onSave:"&",ngModel:"="},link:function(scope,element,attrs){scope.$watch("ngModel",function(newModel){scope.info={},null!==newModel?(scope.addOrUpdateTitle="Update Function",scope.addOrUpdateButton="Update",TreeApproveService.LoadOneFunction(newModel).then(function(response){"success"===response.status?(scope.info=response.result,scope.info.oldName=scope.info.TYPE_NAME):"fail"===response.status?($state.go("loggedIn.treeApprove.ListFunction",null,{reload:!0}),toastr.error("Loading fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})):(scope.addOrUpdateTitle="Add Function",scope.addOrUpdateButton="Add")})},templateUrl:"modules/treeApprove/directives/templates/AddFunction.html"}}),angular.module("app.loggedIn.treeApprove.AddDepartment.directive",[]).directive("addTree",function(TreeApproveService,$state,toastr){return{restrict:"EA",require:"ngModel",scope:{onCancel:"&",onSave:"&",ngModel:"="},link:function(scope,element,attrs){scope.$watch("ngModel",function(newModel){null!==newModel?(scope.addOrUpdateTitle="Update Tree",scope.addOrUpdateButton="Update",TreeApproveService.LoadOneTree(newModel).then(function(response){"success"===response.status?scope.info=response.result:"fail"===response.status?toastr.error("Loading fail!","Error"):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})):(scope.addOrUpdateTitle="Add Tree",scope.addOrUpdateButton="Add")}),TreeApproveService.LoadCompany().then(function(responsive){scope.companies=responsive.company,TreeApproveService.LoadSite().then(function(responsive){scope.sites=responsive.redimedSite})})},templateUrl:"modules/treeApprove/directives/templates/AddTree.html"}}),
angular.module("app.loggedIn.treeApprove.directives",["app.loggedIn.treeApprove.AddNode.directive","app.loggedIn.treeApprove.AddSystem.directive","app.loggedIn.treeApprove.AddDepartment.directive"]),angular.module("app.loggedIn.treeApprove.service",[]).factory("TreeApproveService",function(Restangular){var TreeApproveService={},api=Restangular.all("api");return TreeApproveService.LoadFunction=function(searchObjPost){var LoadFunction=api.all("treeApprove/post-function-list");return LoadFunction.post({searchObj:searchObjPost})},TreeApproveService.DeleteFunction=function(FunctionIdPost,index){var DeleteFunction=api.all("treeApprove/post-function-delete");return DeleteFunction.post({info:FunctionIdPost})},TreeApproveService.InsertFunction=function(systemPost){var InsertFunction=api.all("treeApprove/post-function-insert");return InsertFunction.post({info:systemPost})},TreeApproveService.LoadOneFunction=function(idPost){var LoadOneFunction=api.all("treeApprove/post-function-one");return LoadOneFunction.post({info:idPost})},TreeApproveService.UpdateFunction=function(idPost){var UpdateFunction=api.all("treeApprove/post-function-update");return UpdateFunction.post({info:idPost})},TreeApproveService.LoadTreeApprove=function(infoPost){var LoadTreeApprove=api.all("treeApprove/get-function-tree");return LoadTreeApprove.post({info:infoPost})},TreeApproveService.DeleteTree=function(idPost){var DeleteTree=api.all("treeApprove/post-tree-delete");return DeleteTree.post({info:idPost})},TreeApproveService.LoadTree=function(TreeCodePost){var LoadTree=api.all("treeApprove/post-tree-list");return LoadTree.post({searchObj:TreeCodePost})},TreeApproveService.LoadOneTree=function(idPost){var LoadOneTree=api.all("treeApprove/post-tree-one");return LoadOneTree.post({info:idPost})},TreeApproveService.UpdateTree=function(infoPost){var UpdateTree=api.all("treeApprove/post-tree-update");return UpdateTree.post({info:infoPost})},TreeApproveService.LoadCompany=function(){var LoadCompany=api.one("treeApprove/get-company-list");return LoadCompany.get({})},TreeApproveService.LoadSite=function(){var LoadSite=api.one("treeApprove/get-site-list");return LoadSite.get({})},TreeApproveService.InsertTree=function(departmentPost){var InsertTree=api.all("treeApprove/post-tree-insert");return InsertTree.post({info:departmentPost})},TreeApproveService.InsertNode=function(nodePost){var InsertNode=api.all("treeApprove/post-node-insert");return InsertNode.post({info:nodePost})},TreeApproveService.UpdateNode=function(nodePost){var UpdateNode=api.all("treeApprove/post-node-update");return UpdateNode.post({info:nodePost})},TreeApproveService.LoadOneNode=function(nodePost){var LoadOneNode=api.all("treeApprove/post-node-one");return LoadOneNode.post({info:nodePost})},TreeApproveService.DeleteNode=function(nodePost){var DeleteNode=api.all("treeApprove/post-node-delete");return DeleteNode.post({info:nodePost})},TreeApproveService}),angular.module("app.loggedIn.user",["app.loggedIn.user.services","app.loggedIn.user.profile.controller","app.loggedIn.user.type.controller"]).config(function($stateProvider){$stateProvider.state("loggedIn.userProfile",{url:"/users/profile",templateUrl:"modules/user/views/profile.html",controller:"UserProfileController"}).state("loggedIn.userType",{url:"/usersType",templateUrl:"modules/user/views/userType.html",controller:"UserTypeController"})}),angular.module("app.loggedIn.user.services",[]).factory("UserService",function(Restangular){var userService={},userApi=Restangular.all("api"),mdtUserApi=Restangular.all("api/meditek/v1/user/");return userService.all=function(){var funcApi=mdtUserApi.one("all");return funcApi.get()},userService.detail=function(username){var detailApi=userApi.one("users/loggedin");return detailApi.get()},userService.menu=function(id){var menuApi=userApi.all("menu/side");return menuApi.post({id:id,isWeb:!0})},userService.getFunction=function(id){var a=userApi.all("function/id");return a.post({id:id})},userService.getCompany=function(){var comp=userApi.one("company/list");return comp.get()},userService.updateProfile=function(info){var edit=userApi.all("users/editProfile");return edit.post({info:info})},userService.getUserInfo=function(id){var info=userApi.all("users/id");return info.post({id:id})},userService.getUserType=function(){return userApi.one("users/type").get()},userService.updateUserType=function(info){return userApi.all("users/type/edit").post({info:info})},userService.deleteUserType=function(id){return userApi.all("users/type/delete").post({id:id})},userService.insertUserType=function(info){return userApi.all("users/type/insert").post({info:info})},userService.getUserTypeMenu=function(id){return userApi.all("users/type/menu").post({id:id})},userService.insertUserTypeMenu=function(info){return userApi.all("users/type/menu/insert").post({info:info})},userService.updateUserTypeMenu=function(info,id,type_id){return userApi.all("users/type/menu/edit").post({info:info,id:id,typeId:type_id})},userService.deleteUserTypeMenu=function(id){return userApi.all("users/type/menu/delete").post({id:id})},userService.getOnlineUsers=function(){return userApi.one("im/getOnlineUsers").get()},userService}),angular.module("app.loggedIn.user.profile.controller",[]).controller("UserProfileController",function($scope,$modal,$filter,FileUploader,UserService,$http,toastr,$cookieStore){var userInfo=null,companyInfo=null;$scope.isCompany=!1,void 0!=$cookieStore.get("userInfo")&&(userInfo=$cookieStore.get("userInfo")),void 0!=$cookieStore.get("companyInfo")&&(companyInfo=$cookieStore.get("companyInfo")),$scope.detail="Company"==userInfo.UserType.user_type?{id:userInfo.id,img:null,company_id:companyInfo.id,Booking_Person:userInfo.Booking_Person,Contact_number:userInfo.Contact_number,Contact_email:userInfo.Contact_email,result_email:userInfo.result_email,invoiceemail:userInfo.invoiceemail,userLegal:userInfo.MEDICO_LEGAL_REGISTER_STATUS,isAccessReportOnline:userInfo.IS_ACCESS_REPORTS_ONLINE}:{id:userInfo.id,img:null,Booking_Person:userInfo.Booking_Person,Contact_number:userInfo.Contact_number,Contact_email:userInfo.Contact_email},UserService.getUserInfo(userInfo.id).then(function(data){$scope.detail.img=data.img}),UserService.getCompany().then(function(data){$scope.companyList=data}),"Company"==userInfo.UserType.user_type?($scope.isCompany=!0,$scope.info={name:userInfo.Booking_Person,username:userInfo.user_name,phone:userInfo.Contact_number,email:userInfo.Contact_email,userType:userInfo.UserType.user_type,companyName:companyInfo.Company_name,companyIndustry:companyInfo.Industry,companyAddr:companyInfo.Addr,companyState:companyInfo.State}):($scope.isCompany=!1,$scope.info={name:userInfo.Booking_Person,username:userInfo.user_name,phone:userInfo.Contact_number,email:userInfo.Contact_email,userType:userInfo.UserType.user_type}),$scope.updateUserProfile=function(userForm){UserService.updateProfile($scope.detail).then(function(data){"success"===data.status?toastr.success("Edit Successfully!","Success"):toastr.error("Edit Failed!","Error")})},$scope.changeUserPassword=function(){$modal.open({templateUrl:"modules/user/views/changePassModal.html",controller:"UserChangePassController",size:"md",resolve:{userId:function(){return userInfo.id}}})}}).controller("UserChangePassController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,userId,toastr){$scope.info={oldPass:null,newPass:null,id:userId},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(changePassForm){$scope.showClickedValidation=!0,changePassForm.$invalid?toastr.error("Please Input All Required Information!","Error"):swal({title:"Confirm",text:"Are You Sure Want To Change Your Password?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){OnlineBookingService.changeUserPassword($scope.info).then(function(data){"success"===data.status?(toastr.success("Change Password Successfully","Success"),$modalInstance.dismiss("cancel")):"error"===data.status&&toastr.error("Change Password Failed","Error")})})}}),angular.module("app.loggedIn.user.type.controller",[]).controller("UserTypeController",function($scope,$modal,$state,$filter,ngTableParams,UserService,MenuService,$http,toastr){$scope.data=[],$scope.data1=[],$scope.selectedId=null,$scope.tableParams2=new ngTableParams({page:1,count:25},{total:$scope.data1.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.data1,params.orderBy()):$scope.data1;orderedData=params.filter()?$filter("filter")(orderedData,params.filter()):orderedData,params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),UserService.getUserType().then(function(data){$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.data,params.orderBy()):$scope.data;orderedData=params.filter()?$filter("filter")(orderedData,params.filter()):orderedData,params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.loadMenu=function(m){MenuService.menuRootList().then(function(data){return $scope.menuList=data})},$scope.showMenu=function(m){$scope.selectedId=m.ID,$scope.selectedType=m.user_type,$scope.data1=[],UserService.getUserTypeMenu(m.ID).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})},$scope.updateType=function(m){var info={id:m.ID,user_type:m.user_type};UserService.updateUserType(info).then(function(data){"success"==data.status?toastr.success("Edit Successfully!","Success"):toastr.error("Edit Failed!","Error")})},$scope.deleteType=function(m){UserService.deleteUserType(m.ID).then(function(data){"success"==data.status?(toastr.success("Delete Successfully!","Success"),UserService.getUserType().then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.tableParams.reload()})})):toastr.error("Delete Failed!","Error")})},$scope.addNewType=function(){var modalInstance=$modal.open({templateUrl:"modules/user/views/insertTypeModal.html",controller:"InsertTypeController",size:"md"});modalInstance.result.then(function(){UserService.getUserType().then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.tableParams.reload()})})})},$scope.addNewMenu=function(){var modalInstance=$modal.open({templateUrl:"modules/user/views/newTypeMenuModal.html",controller:"NewTypeMenuController",size:"md",resolve:{typeId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){UserService.getUserTypeMenu($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})})},$scope.updateMenu=function(m){var info={menu_id:m.menu_id,isEnable:m.isEnable};UserService.updateUserTypeMenu(info,m.id,m.type_id).then(function(data){"success"==data.status?(toastr.success("Edit Successfully!","Success"),UserService.getUserTypeMenu($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})):toastr.error("Edit Failed!","Error")})},$scope.deleteMenu=function(id){UserService.deleteUserTypeMenu(id).then(function(data){"success"==data.status?(toastr.success("Delete Successfully!","Success"),UserService.getUserTypeMenu($scope.selectedId).then(function(data){$scope.data1=data,$scope.$watch("data1",function(data){$scope.tableParams2.reload()})})):toastr.error("Delete Failed!","Error")})}}).controller("InsertTypeController",function($scope,$modalInstance,$state,$filter,UserService,toastr){$scope.info={user_type:null},$scope.cancel=function(){$modalInstance.close()},$scope.submit=function(){$scope.showClickedValidation=!0,$scope.userTypeForm.$invalid?toastr.error("Please Enter Required Information!","Error"):UserService.insertUserType($scope.info).then(function(data){"success"==data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.close()):toastr.success("Insert Failed!","Error")})}}).controller("NewTypeMenuController",function($scope,$modalInstance,$state,$filter,UserService,MenuService,toastr,typeId){$scope.info={menu_id:null,isEnable:"1",type_id:typeId},$scope.cancel=function(){$modalInstance.close()},MenuService.menuRootList().then(function(data){$scope.menuList=data}),$scope.submit=function(){$scope.showClickedValidation=!0,$scope.userTypeForm.$invalid?toastr.error("Please Enter Required Information!","Error"):UserService.insertUserTypeMenu($scope.info).then(function(data){"success"==data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.close()):toastr.success("Insert Failed!","Error")})}}),angular.module("app.loggedIn.waitingList",["app.loggedIn.waitingList.include"]),angular.module("app.loggedIn.waitingList.include",["app.loggedIn.waitingList.models","app.loggedIn.waitingList.directives.add","app.loggedIn.waitingList.directives.list"]),angular.module("app.loggedIn.waitingList.models",[]).factory("WaitingListModel",function(Restangular){var mainModel={},mainApi=Restangular.all("api/meditek/v1/waitingList");return mainModel.add=function(data){var instanceApi=mainApi.all("add");return instanceApi.post({data:data})},mainModel.list=function(data){var instanceApi=mainApi.all("list");return instanceApi.post({data:data})},mainModel.remove=function(data){var instanceApi=mainApi.all("remove");return instanceApi.post({data:data})},mainModel.remove=function(data){var instanceApi=mainApi.all("remove");return instanceApi.post({data:data})},mainModel.getPatientFromId=function(data){var instanceApi=mainApi.all("getPatientFromId");return instanceApi.post({data:data})},mainModel}),angular.module("app.loggedIn.waitingList.directives.add",[]).directive("waitingListAdd",function($modal,WaitingListModel,ConfigService,$cookieStore,OutreferralModel,PatientService){return{restrict:"EA",scope:{success:"=",doctorId:"=",patientId:"="},templateUrl:"modules/waitingList/directives/templates/add.html",link:function(scope,elem,attrs){scope.priorities=[{key:"high",value:"High"},{key:"normal",value:"Normal"},{key:"low",value:"Low"}];var user_id=$cookieStore.get("userInfo").id,model={doctor_id:null,Patient_id:null,priority:null,reason:null,Created_by:user_id};scope.$watch("doctorId",function(doctorId){if("undefined"!=typeof doctorId){var postData=doctorId;OutreferralModel.DotorFromDoctorId(postData).then(function(response){scope.waitingList.model.doctor_id=response.data[0].doctor_id,scope.doctor.name=response.data[0].NAME},function(error){})}}),scope.$watch("patientId",function(patientId){"undefined"!=typeof patientId&&WaitingListModel.getPatientFromId(patientId).then(function(response){scope.waitingList.model.Patient_id=response.data[0].Patient_id,scope.patient.name=response.data[0].First_name+" "+response.data[0].Sur_name},function(error){})});var doctorSelect=function(){$modal.open({templateUrl:"selectDoctorDialog",size:"lg",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.waitingList.model.doctor_id=row.doctor_id,scope.doctor.name=row.NAME})},patientSelect=function(){$modal.open({templateUrl:"selectPatientDialog",size:"lg",controller:function($scope,$modalInstance){$scope.clickRow=function(row){$modalInstance.close(row)}}}).result.then(function(row){scope.waitingList.model.Patient_id=row.Patient_id,scope.patient.name=row.First_name+" "+row.Sur_name})};scope.doctor={name:"Select doctor",dialog:{select:function(){doctorSelect()}}},scope.patient={name:"Select patient",dialog:{select:function(){patientSelect()}}};var save=function(){ConfigService.beforeSave(scope.waitingList.errors);var postData=angular.copy(scope.waitingList.model);postData.Creation_date=moment().format("YYYY-MM-DD"),WaitingListModel.add(postData).then(function(response){scope.success=!0},function(error){scope.waitingList.errors=angular.copy(error.data.errors),ConfigService.beforeError(scope.waitingList.errors)})};scope.waitingList={model:angular.copy(model),save:function(){save()}}}}}),angular.module("app.loggedIn.waitingList.directives.list",[]).directive("waitingListList",function($modal,WaitingListModel,ConfigService,$cookieStore,OutreferralModel){return{restrict:"EA",scope:{success:"=",doctorId:"=",clickRow:"&"},templateUrl:"modules/waitingList/directives/templates/list.html",link:function(scope,elem,attrs){var load=function(){WaitingListModel.list().then(function(response){scope.waitingList.list=response.data},function(error){})};scope.waitingList={list:[],load:function(){load()}},scope.waitingList.load()}}}),angular.module("app.loggedIn.waworkcover",["app.loggedIn.waworkcover.controller","app.loggedIn.waworkcover.directive","app.loggedIn.waworkcover.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.waworkcover",{"abstract":!0,templateUrl:"modules/waworkcover/views/structure.html",controller:"WaWorkCoverController"}).state("loggedIn.waworkcover.first",{url:"/wa/workcover/:patient_id/:cal_id/first/:action/:wc_id",views:{"main-content":{templateUrl:"modules/waworkcover/views/first.html",controller:"WaWorkCoverFirstController"}}}).state("loggedIn.waworkcover.progress",{url:"/wa/workcover/:patient_id/:cal_id/progress/:action/:wc_id",views:{"main-content":{templateUrl:"modules/waworkcover/views/progress.html",controller:"WaWorkCoverProgressController"}}}).state("loggedIn.waworkcover.final",{url:"/wa/workcover/:patient_id/:cal_id/final/:action/:wc_id",views:{"main-content":{templateUrl:"modules/waworkcover/views/final.html",controller:"WaWorkCoverFinalController"}}}).state("loggedIn.waworkcover.general",{url:"/wa/workcover/:patient_id/:cal_id/general/:action/:wc_id",views:{"main-content":{templateUrl:"modules/waWorkCover/views/general.html",controller:"WaWorkCoverGeneralController"}}})}),angular.module("app.loggedIn.waworkcover.directive",["app.loggedIn.waworkcover.first.directive","app.loggedIn.waworkcover.progress.directive","app.loggedIn.waworkcover.final.directive","app.loggedIn.waworkcover.general.directive"]),angular.module("app.loggedIn.waworkcover.final.directive",[]).directive("workCoverFinal",function(DocumentService,DoctorService,ReceptionistService,ConfigService,PatientService,toastr,WaWorkCoverService,$state,$cookieStore,CompanyService){return{restrict:"EA",scope:{data:"@",params:"="},templateUrl:"modules/waWorkCover/directives/templates/final.html",link:function(scope,element,attrs){var init=function(){scope.oneAtATime=!1,scope.isSubmit=!1,scope.wafinal={examDate:new Date},PatientService.mdtById(scope.params.patientInfo).then(function(res){"success"===res.status&&""!==res.data&&null!==res.data&&void 0!==res.data&&(scope.patient=res.data,scope.patient.DOB=new Date(scope.patient.DOB),void 0!==scope.patient.company_id&&null!==scope.patient.company_id&&""!==scope.patient.company_id&&CompanyService.mdtById(scope.patient.company_id).then(function(res2){"success"===res2.status&&void 0!==res.data&&null!==res.data&&""!==res.data&&(scope.company=res2.data)}))});var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this workcover have no doctor link with it","Error!"):(console.log("this is doctor",result),scope.doctor=result.data[0])}),scope.params.edit===!0&&scope.params.workcover&&WaWorkCoverService.finaldetail(scope.params.workcover).then(function(res){if(res.data){scope.wafinal=res.data;for(var key in scope.wafinal)scope.wafinal[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.wafinal[key]=scope.wafinal[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE")||-1!=key.indexOf("reviewOn")||-1!=key.indexOf("From")||-1!=key.indexOf("To"))&&(scope.wafinal[key]=new Date(scope.wafinal[key])))}})};init(),scope.clearSignature=function(){scope.wafinal.signature=""},scope.clickAction=function(){if(scope.isSubmit=!0,scope.wafinalform.$invalid)toastr.error("Please fix the red field!","Invalid information");else{var postData=angular.copy(scope.wafinal);postData.cal_id=scope.params.apptInfo,postData.patient_id=scope.params.patientInfo;for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.edit===!1?(postData.Created_by=$cookieStore.get("userInfo").id,WaWorkCoverService.finaladd(postData).then(function(result){console.log("this is insert result",result),"success"===result.status?(toastr.success("Add successfully!","Success!"),$state.go("loggedIn.patient.workcover",{patient_id:scope.params.patientInfo,cal_id:scope.params.apptInfo})):toastr.error("Unexpected Error!","Error!")})):WaWorkCoverService.finaledit(postData.id,postData).then(function(result){"success"===result.status?toastr.success("Edit successfully!","Success!"):toastr.error("Unexpected Error!","Error!")})}},scope.printAssessment=function(){var printId=scope.wafinal.id;WaWorkCoverService.finalprint(printId).then(function(result){})},scope.$watch("wafinal.isFullCapacity",function(fullCapa){"1"!==fullCapa&&(scope.wafinal.fullCapaFrom=null,scope.wafinal.isRequireTreat=null)}),scope.$watch("wafinal.isCapacityForWork",function(isCapacityForWork){"1"!==isCapacityForWork&&(scope.wafinal.capaFrom=null,scope.wafinal.capaHours=null,scope.wafinal.capaDays=null,scope.wafinal.isLiftUp=null,scope.wafinal.isStandUp=null,scope.wafinal.isSitUp=null,scope.wafinal.isWalkUp=null,scope.wafinal.liftUpKg=null,scope.wafinal.standUpMins=null,scope.wafinal.sitUpMins=null,scope.wafinal.walkUpMeter=null,scope.wafinal.isWorkBelow=null,scope.wafinal.capaCmt=null)}),scope.$watch("wafinal.isLiftUp",function(isLiftUp){"1"!==isLiftUp&&(scope.wafinal.liftUpKg=null)}),scope.$watch("wafinal.liftUpKg",function(liftUpKg){scope.wafinal.isLiftUp=void 0!==liftUpKg&&null!==liftUpKg&&""!==liftUpKg?"1":"0"}),scope.$watch("wafinal.isSitUp",function(isSitUp){"1"!==isSitUp&&(scope.wafinal.sitUpMins=null)}),scope.$watch("wafinal.sitUpMins",function(sitUpMins){scope.wafinal.isSitUp=void 0!==sitUpMins&&null!==sitUpMins&&""!==sitUpMins?"1":"0"}),scope.$watch("wafinal.isStandUp",function(isStandUp){"1"!==isStandUp&&(scope.wafinal.standUpMins=null)}),scope.$watch("wafinal.standUpMins",function(standUpMins){scope.wafinal.isStandUp=void 0!==standUpMins&&null!==standUpMins&&""!==standUpMins?"1":"0"}),scope.$watch("wafinal.isWalkUp",function(isWalkUp){"1"!==isWalkUp&&(scope.wafinal.walkUpMeter=null)}),scope.$watch("wafinal.walkUpMeter",function(walkUpMeter){scope.wafinal.isWalkUp=void 0!==walkUpMeter&&null!==walkUpMeter&&""!==walkUpMeter?"1":"0"})}}}),angular.module("app.loggedIn.waworkcover.first.directive",[]).directive("workCoverFirst",function(DocumentService,DoctorService,ReceptionistService,ConfigService,PatientService,toastr,WaWorkCoverService,$state,$cookieStore,CompanyService){return{restrict:"EA",scope:{data:"@",params:"="},templateUrl:"modules/waWorkCover/directives/templates/first.html",link:function(scope,element,attrs){var init=function(){scope.oneAtATime=!1,scope.isSubmit=!1,scope.wafirst={examDate:new Date},PatientService.mdtById(scope.params.patientInfo).then(function(res){"success"===res.status&&""!==res.data&&null!==res.data&&void 0!==res.data&&(scope.patient=res.data,scope.patient.DOB=new Date(scope.patient.DOB),void 0!==scope.patient.company_id&&null!==scope.patient.company_id&&""!==scope.patient.company_id&&CompanyService.mdtById(scope.patient.company_id).then(function(res2){"success"===res2.status&&void 0!==res.data&&null!==res.data&&""!==res.data&&(scope.company=res2.data)}))});var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this workcover have no doctor link with it","Error!"):(console.log("this is doctor",result),scope.doctor=result.data[0])}),scope.params.edit===!0&&scope.params.workcover&&WaWorkCoverService.firstdetail(scope.params.workcover).then(function(res){if(res.data){scope.wafirst=res.data;for(var key in scope.wafirst)scope.wafirst[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.wafirst[key]=scope.wafirst[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE")||-1!=key.indexOf("reviewOn")||-1!=key.indexOf("From")||-1!=key.indexOf("To"))&&(scope.wafirst[key]=new Date(scope.wafirst[key])))}})};init(),scope.clearSignature=function(){scope.wafirst.signature=""},scope.clickAction=function(){if(scope.isSubmit=!0,scope.wafirstform.$invalid)toastr.error("Please fix the red field!","Invalid information");else{var postData=angular.copy(scope.wafirst);postData.cal_id=scope.params.apptInfo,postData.patient_id=scope.params.patientInfo;for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.edit===!1?(postData.Created_by=$cookieStore.get("userInfo").id,WaWorkCoverService.firstadd(postData).then(function(result){console.log("this is insert result",result),"success"===result.status?(toastr.success("Add successfully!","Success!"),$state.go("loggedIn.patient.workcover",{patient_id:scope.params.patientInfo,cal_id:scope.params.apptInfo})):toastr.error("Unexpected Error!","Error!")})):WaWorkCoverService.firstedit(postData.Ass_id,postData).then(function(result){"success"===result.status?toastr.success("Edit successfully!","Success!"):toastr.error("Unexpected Error!","Error!")})}},scope.printAssessment=function(){var printId=scope.wafirst.Ass_id;WaWorkCoverService.firstprint(printId).then(function(result){})},scope.$watch("wafirst.isFullCapacity",function(fullCapa){"1"!==fullCapa&&(scope.wafirst.fullCapaFrom=null,scope.wafirst.isRequireTreat=null)}),scope.$watch("wafirst.isSomeCapacity",function(someCapa){"1"!==someCapa&&(scope.wafirst.someCapaFrom=null,scope.wafirst.someCapaTo=null,scope.wafirst.isPreDuties=null,scope.wafirst.isModiDuties=null,scope.wafirst.isWorkModifi=null,scope.wafirst.isPreHours=null,scope.wafirst.isModiHours=null)}),scope.$watch("wafirst.isModiHours",function(isModi){"1"!==isModi&&(scope.wafirst.modiHrs=null,scope.wafirst.modiDays=null)}),scope.$watch("wafirst.modiHrs",function(modiHrs){void 0!==modiHrs&&null!==modiHrs&&""!==modiHrs&&void 0!==scope.wafirst.modiDays&&null!==scope.wafirst.modiDays&&""!==scope.wafirst.modiDays&&"1"!==scope.wafirst.isModiHours&&(scope.wafirst.isModiHours="1")}),scope.$watch("wafirst.modiDays",function(modiDays){void 0!==modiDays&&null!==modiDays&&""!==modiDays&&void 0!==scope.wafirst.modiHrs&&null!==scope.wafirst.modiHrs&&""!==scope.wafirst.modiHrs&&"1"!==scope.wafirst.isModiHours&&(scope.wafirst.isModiHours="1")}),scope.$watch("wafirst.isNoCapacity",function(noCapa){"1"!==noCapa&&(scope.wafirst.noCapaFrom=null,scope.wafirst.noCapaTo=null)}),scope.$watch("wafirst.isLiftUp",function(isLiftUp){"1"!==isLiftUp&&(scope.wafirst.liftUpKg=null)}),scope.$watch("wafirst.liftUpKg",function(liftUpKg){scope.wafirst.isLiftUp=void 0!==liftUpKg&&null!==liftUpKg&&""!==liftUpKg?"1":"0"}),scope.$watch("wafirst.isSitUp",function(isSitUp){"1"!==isSitUp&&(scope.wafirst.sitUpMins=null)}),scope.$watch("wafirst.sitUpMins",function(sitUpMins){scope.wafirst.isSitUp=void 0!==sitUpMins&&null!==sitUpMins&&""!==sitUpMins?"1":"0"}),scope.$watch("wafirst.isStandUp",function(isStandUp){"1"!==isStandUp&&(scope.wafirst.standUpMins=null)}),scope.$watch("wafirst.standUpMins",function(standUpMins){scope.wafirst.isStandUp=void 0!==standUpMins&&null!==standUpMins&&""!==standUpMins?"1":"0"}),scope.$watch("wafirst.isWalkUp",function(isWalkUp){"1"!==isWalkUp&&(scope.wafirst.walkUpMeter=null)}),scope.$watch("wafirst.walkUpMeter",function(walkUpMeter){scope.wafirst.isWalkUp=void 0!==walkUpMeter&&null!==walkUpMeter&&""!==walkUpMeter?"1":"0"}),scope.$watch("wafirst.isReview",function(isReview){"1"!==isReview&&(scope.wafirst.reviewOn=null)}),scope.$watch("wafirst.reviewOn",function(reviewOn){void 0!==reviewOn&&null!==reviewOn&&""!==reviewOn&&(scope.wafirst.isReview="1")})}}}),angular.module("app.loggedIn.waworkcover.progress.directive",[]).directive("workCoverProgress",function(DocumentService,DoctorService,ReceptionistService,ConfigService,PatientService,toastr,WaWorkCoverService,$cookieStore,$state,CompanyService){return{restrict:"EA",scope:{data:"@",params:"="},templateUrl:"modules/waWorkCover/directives/templates/progress.html",link:function(scope,element,attrs){var init=function(){scope.oneAtATime=!1,scope.isSubmit=!1,scope.waprogress={examDate:new Date},PatientService.mdtById(scope.params.patientInfo).then(function(res){"success"===res.status&&""!==res.data&&null!==res.data&&void 0!==res.data&&(scope.patient=res.data,scope.patient.DOB=new Date(scope.patient.DOB),void 0!==scope.patient.company_id&&null!==scope.patient.company_id&&""!==scope.patient.company_id&&CompanyService.mdtById(scope.patient.company_id).then(function(res2){"success"===res2.status&&void 0!==res.data&&null!==res.data&&""!==res.data&&(scope.company=res2.data)}))});var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this workcover have no doctor link with it","Error!"):(console.log("this is doctor",result),scope.doctor=result.data[0])}),scope.params.edit===!0&&scope.params.workcover&&WaWorkCoverService.progressdetail(scope.params.workcover).then(function(res){if("success"===res.status&&res.data){scope.waprogress=res.data;for(var key in scope.waprogress)scope.waprogress[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.waprogress[key]=scope.waprogress[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE")||-1!=key.indexOf("reviewOn")||-1!=key.indexOf("From")||-1!=key.indexOf("To"))&&(scope.waprogress[key]=new Date(scope.waprogress[key])))}})};init(),scope.clearSignature=function(){scope.waprogress.signature=""},scope.clickAction=function(){if(scope.isSubmit=!0,scope.waprogressform.$invalid)toastr.error("Please fix the red field!","Invalid information");else{var postData=angular.copy(scope.waprogress);postData.cal_id=scope.params.apptInfo,postData.patient_id=scope.params.patientInfo;for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.edit===!1?(postData.Created_by=$cookieStore.get("userInfo").id,WaWorkCoverService.progressadd(postData).then(function(result){console.log("this is insert result",result),"success"===result.status?(toastr.success("Add successfully!","Success!"),$state.go("loggedIn.patient.workcover",{patient_id:scope.params.patientInfo,cal_id:scope.params.apptInfo})):toastr.error("Unexpected Error!","Error!")})):WaWorkCoverService.progressedit(postData.progress_id,postData).then(function(result){"success"===result.status?toastr.success("Edit successfully!","Success!"):toastr.error("Unexpected Error!","Error!")})}},scope.printAssessment=function(){var printId=scope.waprogress.progress_id;WaWorkCoverService.progressprint(printId).then(function(result){})},scope.$watch("waprogress.isFullCapacity",function(fullCapa){"1"!==fullCapa&&(scope.waprogress.fullCapaFrom=null,scope.waprogress.isRequireTreat=null)}),scope.$watch("waprogress.isSomeCapacity",function(someCapa){"1"!==someCapa&&(scope.waprogress.someCapaFrom=null,scope.waprogress.someCapaTo=null,scope.waprogress.isPreDuties=null,scope.waprogress.isModiDuties=null,scope.waprogress.isWorkModifi=null,scope.waprogress.isPreHours=null,scope.waprogress.isModiHours=null);

}),scope.$watch("waprogress.isModiHours",function(isModi){"1"!==isModi&&(scope.waprogress.modiHrs=null,scope.waprogress.modiDays=null)}),scope.$watch("waprogress.modiHrs",function(modiHrs){void 0!==modiHrs&&null!==modiHrs&&""!==modiHrs&&void 0!==scope.waprogress.modiDays&&null!==scope.waprogress.modiDays&&""!==scope.waprogress.modiDays&&"1"!==scope.waprogress.isModiHours&&(scope.waprogress.isModiHours="1")}),scope.$watch("waprogress.modiDays",function(modiDays){void 0!==modiDays&&null!==modiDays&&""!==modiDays&&void 0!==scope.waprogress.modiHrs&&null!==scope.waprogress.modiHrs&&""!==scope.waprogress.modiHrs&&"1"!==scope.waprogress.isModiHours&&(scope.waprogress.isModiHours="1")}),scope.$watch("waprogress.isNoCapacity",function(noCapa){"1"!==noCapa&&(scope.waprogress.noCapaFrom=null,scope.waprogress.noCapaTo=null)}),scope.$watch("waprogress.isLiftUp",function(isLiftUp){"1"!==isLiftUp&&(scope.waprogress.liftUpKg=null)}),scope.$watch("waprogress.liftUpKg",function(liftUpKg){scope.waprogress.isLiftUp=void 0!==liftUpKg&&null!==liftUpKg&&""!==liftUpKg?"1":"0"}),scope.$watch("waprogress.isSitUp",function(isSitUp){"1"!==isSitUp&&(scope.waprogress.sitUpMins=null)}),scope.$watch("waprogress.sitUpMins",function(sitUpMins){scope.waprogress.isSitUp=void 0!==sitUpMins&&null!==sitUpMins&&""!==sitUpMins?"1":"0"}),scope.$watch("waprogress.isStandUp",function(isStandUp){"1"!==isStandUp&&(scope.waprogress.standUpMins=null)}),scope.$watch("waprogress.standUpMins",function(standUpMins){scope.waprogress.isStandUp=void 0!==standUpMins&&null!==standUpMins&&""!==standUpMins?"1":"0"}),scope.$watch("waprogress.isWalkUp",function(isWalkUp){"1"!==isWalkUp&&(scope.waprogress.walkUpMeter=null)}),scope.$watch("waprogress.walkUpMeter",function(walkUpMeter){scope.waprogress.isWalkUp=void 0!==walkUpMeter&&null!==walkUpMeter&&""!==walkUpMeter?"1":"0"}),scope.$watch("waprogress.activities_1",function(activities_1){(null===activities_1||void 0===activities_1||""===activities_1)&&(scope.waprogress.outcome_1=null,scope.waprogress.isRequired_1=null)}),scope.$watch("waprogress.activities_2",function(activities_2){(null===activities_2||void 0===activities_2||""===activities_2)&&(scope.waprogress.outcome_2=null,scope.waprogress.isRequired_2=null)}),scope.$watch("waprogress.activities_3",function(activities_3){(null===activities_3||void 0===activities_3||""===activities_3)&&(scope.waprogress.outcome_3=null,scope.waprogress.isRequired_3=null)}),scope.$watch("waprogress.activities_4",function(activities_4){(null===activities_4||void 0===activities_4||""===activities_4)&&(scope.waprogress.outcome_4=null,scope.waprogress.isRequired_4=null)}),scope.$watch("waprogress.activities_5",function(activities_5){(null===activities_5||void 0===activities_5||""===activities_5)&&(scope.waprogress.outcome_5=null,scope.waprogress.isRequired_5=null)}),scope.$watch("waprogress.activities_6",function(activities_6){(null===activities_6||void 0===activities_6||""===activities_6)&&(scope.waprogress.outcome_6=null,scope.waprogress.isRequired_6=null)}),scope.$watch("waprogress.isReview",function(isReview){"1"!==isReview&&(scope.waprogress.reviewOn=null)}),scope.$watch("waprogress.reviewOn",function(reviewOn){void 0!==reviewOn&&null!==reviewOn&&""!==reviewOn&&(scope.waprogress.isReview="1")})}}}),angular.module("app.loggedIn.waworkcover.general.directive",[]).directive("workCoverGeneral",function(DocumentService,PatientService,InsurerService,ReceptionistService,WaWorkCoverService,DoctorService,ConfigService,$state,$cookieStore,toastr,CompanyService){return{restrict:"EA",scope:{data:"@",params:"="},templateUrl:"modules/waWorkCover/directives/templates/general.html",link:function(scope,element,attrs){var init=function(){scope.oneAtATime=!1,scope.isOpen=!0,scope.isSubmit=!1,scope.generalwc={examDate:new Date},PatientService.mdtById(scope.params.patientInfo).then(function(res){"success"===res.status&&res.data&&(scope.patient=res.data,scope.patient.fullname=scope.patient.First_name,scope.patient.Middle_name&&(scope.patient.fullname=scope.patient.fullname+" "+scope.patient.Middle_name),scope.patient.fullname=scope.patient.fullname+" "+scope.patient.Sur_name,scope.patient.DOB=new Date(scope.patient.DOB),scope.patient.company_id&&CompanyService.mdtById(scope.patient.company_id).then(function(res2){"success"===res2.status&&res2.data&&(scope.companyInfo=res2.data,scope.companyInfo.Insurer&&InsurerService.detail(scope.companyInfo.Insurer).then(function(res3){"success"===res3.status&&res3.row&&(scope.insurer=res3.row)}))}))});var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this workcover have no doctor link with it","Error!"):(console.log("this is doctor",result),scope.doctor=result.data[0])}),scope.params.edit===!0&&scope.params.workcover&&WaWorkCoverService.generaldetail(scope.params.workcover).then(function(res){if(res.data){scope.generalwc=res.data;for(var key in scope.generalwc)scope.generalwc[key]&&((-1!=key.indexOf("is")||-1!=key.indexOf("Is")||-1!=key.indexOf("IS"))&&(scope.generalwc[key]=scope.generalwc[key].toString()),(-1!=key.indexOf("date")||-1!=key.indexOf("Date")||-1!=key.indexOf("DATE")||-1!=key.indexOf("reviewOn")||-1!=key.indexOf("From")||-1!=key.indexOf("To"))&&(scope.generalwc[key]=new Date(scope.generalwc[key])))}})};init(),scope.clickAction=function(){if(scope.isSubmit=!0,scope.generalform.$invalid)toastr.error("Please fix the red field!","Invalid information");else{var postData=angular.copy(scope.generalwc);postData.cal_id=scope.params.apptInfo,postData.patient_id=scope.params.patientInfo;for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));scope.params.edit===!1?(postData.Created_by=$cookieStore.get("userInfo").id,WaWorkCoverService.generaladd(postData).then(function(result){"success"===result.status?(toastr.success("Add successfully!","Success!"),$state.go("loggedIn.patient.workcover",{patient_id:scope.params.patientInfo,cal_id:scope.params.apptInfo})):toastr.error("Unexpected error!","Error!")})):WaWorkCoverService.generaledit(postData.id,postData).then(function(result){"success"===result.status?toastr.success("Edit successfully!","Success!"):toastr.error("Unexpected Error!","Error!")})}}}}}),angular.module("app.loggedIn.waworkcover.controller",["app.loggedIn.waworkcover.first.controller","app.loggedIn.waworkcover.progress.controller","app.loggedIn.waworkcover.final.controller","app.loggedIn.waworkcover.general.controller"]).controller("WaWorkCoverController",function(){}),angular.module("app.loggedIn.waworkcover.final.controller",[]).controller("WaWorkCoverFinalController",function($scope,$stateParams){var patientInfo=$stateParams.patient_id,apptInfo=$stateParams.cal_id,editMode=!1,wc_id=$stateParams.wc_id;editMode="edit"!==$stateParams.action?!1:!0,$scope.params={edit:editMode,patientInfo:patientInfo,apptInfo:apptInfo,workcover:wc_id}}),angular.module("app.loggedIn.waworkcover.first.controller",[]).controller("WaWorkCoverFirstController",function($scope,$stateParams){var patientInfo=$stateParams.patient_id,apptInfo=$stateParams.cal_id,editMode=!1,wc_id=$stateParams.wc_id;editMode="edit"!==$stateParams.action?!1:!0,$scope.params={edit:editMode,patientInfo:patientInfo,apptInfo:apptInfo,workcover:wc_id}}),angular.module("app.loggedIn.waworkcover.progress.controller",[]).controller("WaWorkCoverProgressController",function($scope,$stateParams){var patientInfo=$stateParams.patient_id,apptInfo=$stateParams.cal_id,editMode=!1,wc_id=$stateParams.wc_id;editMode="edit"!==$stateParams.action?!1:!0,$scope.params={edit:editMode,patientInfo:patientInfo,apptInfo:apptInfo,workcover:wc_id}}),angular.module("app.loggedIn.waworkcover.general.controller",[]).controller("WaWorkCoverGeneralController",function($scope,$stateParams){var patientInfo=$stateParams.patient_id,apptInfo=$stateParams.cal_id,editMode=!1,wc_id=$stateParams.wc_id;editMode="edit"!==$stateParams.action?!1:!0,$scope.params={edit:editMode,patientInfo:patientInfo,apptInfo:apptInfo,workcover:wc_id}}),angular.module("app.loggedIn.waworkcover.service",[]).factory("WaWorkCoverService",function(Restangular){var mdtService={},mdtApi=Restangular.all("api/meditek/v1/");return mdtService.firstadd=function(postData){var funcApi=mdtApi.all("wa/workcover/first/add");return funcApi.post({add_data:postData})},mdtService.firstsearch=function(option){var funcApi=mdtApi.all("wa/workcover/first/search");return funcApi.post(option)},mdtService.firstdetail=function(wc_id){var funcApi=mdtApi.all("wa/workcover/first/detail");return funcApi.post({ID:wc_id})},mdtService.firstedit=function(id,postData){var funcApi=mdtApi.all("wa/workcover/first/edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.firstprint=function(id){var funcApi=mdtApi.one("wa/workcover/first/print/"+id);return funcApi.get()},mdtService.progressadd=function(postData){var funcApi=mdtApi.all("wa/workcover/progress/add");return funcApi.post({add_data:postData})},mdtService.progresssearch=function(option){var funcApi=mdtApi.all("wa/workcover/progress/search");return funcApi.post(option)},mdtService.progressedit=function(id,postData){var funcApi=mdtApi.all("wa/workcover/progress/edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.progressdetail=function(wc_id){var funcApi=mdtApi.all("wa/workcover/progress/detail");return funcApi.post({ID:wc_id})},mdtService.progressprint=function(id){var funcApi=mdtApi.one("wa/workcover/progress/print/"+id);return funcApi.get()},mdtService.finaladd=function(postData){var funcApi=mdtApi.all("wa/workcover/final/add");return funcApi.post({add_data:postData})},mdtService.finalsearch=function(option){var funcApi=mdtApi.all("wa/workcover/final/search");return funcApi.post(option)},mdtService.finaledit=function(id,postData){var funcApi=mdtApi.all("wa/workcover/final/edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.finaldetail=function(wc_id){var funcApi=mdtApi.all("wa/workcover/final/detail");return funcApi.post({ID:wc_id})},mdtService.finalprint=function(id){var funcApi=mdtApi.one("wa/workcover/final/print/"+id);return funcApi.get()},mdtService.generaladd=function(postData){var funcApi=mdtApi.all("wa/workcover/general/add");return funcApi.post(postData)},mdtService.generaledit=function(id,postData){var funcApi=mdtApi.all("wa/workcover/general/edit");return funcApi.post({edit_data:postData,edit_id:id})},mdtService.generaldetail=function(wc_id){var funcApi=mdtApi.all("wa/workcover/general/detail");return funcApi.post({ID:wc_id})},mdtService}),angular.module("app.loggedIn.timesheet.create.controller",[]).controller("TimesheetCreateController",function($rootScope,ConfigService,$scope,$stateParams,$cookieStore,$filter,$modal,calendarHelper,moment,StaffService,$state,toastr,FileUploader,$timeout){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={},$scope.info.time_temp=0,$scope.info.time_charge=0,$scope.tasks||($scope.tasks=[]),$scope.info||($scope.info={}),$scope.itemList=[],$scope.calendarDay=new Date,$scope.info.userID=$cookieStore.get("userInfo").id;var startWeek,endWeek;$scope.task={order:null,task:null,date:null,department_code_id:null,location_id:null,activity_id:null,time_charge:null,time_temp:0,isInputItem:!1,isBillable:!1,item:[]},$scope.checkTimeInLieu=function(){var info={date:new Date,userId:$cookieStore.get("userInfo").id};StaffService.checkTimeInLieu(info).then(function(response){if("error"===response.status)toastr.error("Check Time in Lieu fail!","Fail");else if("success"===response.status){var timeInLieu=response.time_in_lieu,hours=parseInt(timeInLieu/60),minutes=timeInLieu%60;10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes);var notification="You have "+hours+" hours "+minutes+" minutes for Time in Lieu!";swal(notification)}else $state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error")})},$scope.changeTimeCharge=function(){var sum=0,sumInLieu=0;angular.forEach($scope.tasks,function(data,index){$scope.tasks[index].time_temp=StaffService.convertShowToFull(data.time_charge),null!==data.time_charge&&void 0!==data.time_charge&&"delete"!==data.isAction&&null!==data.activity_id&&""!==data.time_charge&&0!==data.time_charge.length&&(sum+=parseInt(StaffService.convertShowToFull(data.time_charge))),void 0!==data.item&&null!==data.item&&0!==data.length&&angular.forEach(data.item,function(value,index){void 0!==value&&null!==value&&22==value.ITEM_ID&&"delete"!==value.isAction&&""!==value.time_charge&&0!==value.time_charge.length&&(sumInLieu+=StaffService.convertShowToFull(value.time_charge))})}),$scope.info.time_in_lieuFull=sumInLieu,$scope.info.time_temp=sum,$scope.info.time_charge=StaffService.convertFromFullToShow(sum),0===sum&&($scope.info.time_charge=null)},$scope.ChangeActivity=function(activity_id,index){if($scope.tasks[index].time_charge=null,$scope.tasks[index].time_temp=null,$scope.tasks[index].item=[],$scope.tasks[index].task=null,5===activity_id)if(6===$scope.tasks[index].date.getDay()||0===$scope.tasks[index].date.getDay()){var item={};item.isAction="insert",item.time_temp=0,item.totalUnits=0,item.ratio=0,item.time_charge="0000",item.ITEM_ID=18,item.ITEM_NAME="Weekend Leave",$scope.tasks[index].item.push(item),$scope.tasks[index].time_charge="0000",$scope.tasks[index].time_temp=0,$scope.tasks[index].notPopup=!0}else $scope.tasks[index].notPopup=!1;else $scope.tasks[index].notPopup=!1;$scope.changeTimeCharge()},$scope.getWeekNumber=function(date){var d=new Date(+date);d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo};var info={date:new Date,userId:$cookieStore.get("userInfo").id};StaffService.checkTimeInLieu(info).then(function(response){"error"===response.status?toastr.error("Check Time in Lieu fail!","Fail"):"success"===response.status?$scope.info.time_in_lieuHas=response.time_in_lieu:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.checkTaskWeek=function(date){startWeek=$filter("date")(date,"yyyy-MM-dd"),$scope.info.startWeek=startWeek,StaffService.checkTaskWeek($scope.info).then(function(response){"fail"===response.status||"error"===response.status?toastr.error("Error","Error"):"no"!==response.data?($scope.tasks=[],angular.forEach(response.data,function(data){data.isEdit=!0,$scope.tasks.push(data)})):($scope.orgiTask=angular.copy($scope.tasks),$scope.tasks=[],$scope.viewWeek=calendarHelper.getWeekView(date,!0),angular.forEach($scope.viewWeek.columns,function(data,index){$scope.task={order:$scope.orgiTask[index].order,task:$scope.orgiTask[index].task,date:data.dateChosen,department_code_id:$scope.orgiTask[index].department_code_id,location_id:$scope.orgiTask[index].location_id,activity_id:$scope.orgiTask[index].activity_id,time_charge:$scope.orgiTask[index].time_charge,isInputItem:$scope.orgiTask[index].isInputItem,isBillable:$scope.orgiTask[index].isBillable,isParent:$scope.orgiTask[index].isParent,item:$scope.orgiTask[index].item},$scope.tasks.push($scope.task)}))})},$scope.checkFirstTaskWeek=function(){$scope.tasks=[],StaffService.checkFirstTaskWeek($scope.info).then(function(response){if("error"===response.status?toastr.error("Error","Error"):($scope.isEdit=!1,"success"===response.status?$scope.nextDay=moment(response.maxDate).add(7,"day").toDate():"no maxDate"===response.status&&($scope.nextDay=moment($scope.calendarDay).add(7,"day").toDate()),$scope.viewWeek=calendarHelper.getWeekView($scope.nextDay,!0),angular.forEach($scope.viewWeek.columns,function(data,index){$scope.task={order:index+1,task:null,date:data.dateChosen,department_code_id:null,location_id:null,activity_id:null,time_charge:null,isInputItem:!1,isBillable:!1,isParent:1,item:[]},$scope.tasks.push($scope.task)})),void 0!==$scope.tasks&&null!==$scope.tasks&&0!==$scope.tasks.length&&void 0!==$scope.tasks[0]&&($scope.dateWeekFrom=$filter("date")($scope.tasks[0].date,"dd/MM/yyyy")),void 0!==$scope.tasks&&null!==$scope.tasks&&0!==$scope.tasks.length&&void 0!==$scope.tasks[$scope.tasks.length-1]&&void 0!==$scope.tasks[$scope.tasks.length-2]){if($scope.tasks[$scope.tasks.length-1].activity_id=5,$scope.tasks[$scope.tasks.length-2].activity_id=5,void 0!==$scope.tasks[$scope.tasks.length-1].item&&null!==$scope.tasks[$scope.tasks.length-1].item){var item={};item.isAction="insert",item.time_temp=0,item.totalUnits=0,item.ratio=0,item.time_charge="0000",item.ITEM_ID=18,item.ITEM_NAME="Weekend Leave",$scope.tasks[$scope.tasks.length-1].item.push(item),$scope.tasks[$scope.tasks.length-1].time_charge="0000",$scope.tasks[$scope.tasks.length-1].time_temp=0,$scope.tasks[$scope.tasks.length-1].notPopup=!0}if(void 0!==$scope.tasks[$scope.tasks.length-2].item&&null!==$scope.tasks[$scope.tasks.length-2].item){var item={};item.isAction="insert",item.time_temp=0,item.totalUnits=0,item.ratio=0,item.time_charge="0000",item.ITEM_ID=18,item.ITEM_NAME="Weekend Leave",$scope.tasks[$scope.tasks.length-2].item.push(item),$scope.tasks[$scope.tasks.length-2].time_charge="0000",$scope.tasks[$scope.tasks.length-2].time_temp=0,$scope.tasks[$scope.tasks.length-2].notPopup=!0}}})},$scope.loadInfo=function(){$scope.tasks.loading=!0,StaffService.getDepartmentLocation().then(function(response){if("fail"==response.status||"error"==response.status)toastr.error("Error","Error");else if($scope.departments=response.department,$scope.locations=response.location,$scope.activities=response.activity,$stateParams.id){$scope.isEdit=!0;var info={idWeek:$stateParams.id,userId:$cookieStore.get("userInfo").id};StaffService.showEdit(info).then(function(response){void 0!==response.data&&void 0!==response.data[0]&&void 0!==response.data[0].date&&($scope.dateStart=response.data[0].date),"fail"==response.status?angular.forEach(response.data,function(data){data.item=[],data.isEdit=!0,data.time_temp=data.time_charge,data.isAction="update",null!==data.time_charge&&(data.time_charge=StaffService.convertFromFullToShow(data.time_charge)),$scope.tasks.push(data),$scope.changeTimeCharge()}):"success"===response.status?($scope.uploader=new FileUploader({url:"/api/TimeSheet/post-upload-file",method:"POST",autoUpload:!0,formData:[{userId:$cookieStore.get("userInfo").id}],isHTML5:!0,isUploading:!0}),angular.forEach(response.data,function(data,indexData){data.item=[],data.isEdit=!0,data.time_temp=data.time_charge,data.isAction="update",null!==data.time_charge&&(data.time_charge=StaffService.convertFromFullToShow(data.time_charge)),angular.forEach(response.item,function(item){void 0!==response.item&&response.item[0]&&void 0!==response.item[0].task_status_id&&($scope.checkStatus=response.item[0].task_status_id,$scope.afterStatusID=response.item[0].after_status_id),data.tasks_id===item.tasks_id&&null!==item.ITEM_ID&&0===item.deleted&&(item.isAction="update",item.time_temp=item.time_charge,item.deleted=item.deleted,item.totalUnits=item.units,item.ratio=item.ratio,item.task_id=item.task_id,item.time_charge=StaffService.convertFromFullToShow(item.time_charge),item.fileUpload=[],angular.forEach(response.file,function(valueFile,indexFile){valueFile.tasks_id===item.tasks_id&&valueFile.ITEM_ID===item.ITEM_ID&&item.fileUpload.push({file_name:valueFile.file_name,file_id:valueFile.file_id,isAction:"update"})}),data.item.push(item))}),$scope.tasks.push(data),$scope.changeTimeCharge()})):"error"===response.status&&($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error"))})}else $scope.isEdit=!1,$scope.checkFirstTaskWeek();StaffService.LoadContract($cookieStore.get("userInfo").id).then(function(conTract){"success"===conTract.status&&void 0!==conTract.result[0]&&void 0!==conTract.result[0].TypeOfContruct?$scope.TypeOfContruct=conTract.result[0].TypeOfContruct:toastr.error("User not type of contruct!, Please notification Admin","Error")})}),$scope.tasks.loading=!1},$scope.loadInfo(),$scope.addRow=function(index,date){for(var j=0,i=index;i<$scope.tasks.length;i++)$scope.tasks[i].date==date&&j++;task={order:1+j,task:null,date:date,department_code_id:null,location_id:null,activity_id:null,time_charge:null,isEdit:!1,isInputItem:!1,isBillable:!1,isAction:"insert",item:[]},$scope.tasks.splice(index+j,0,task),angular.forEach($scope.tasks,function(data,index){$scope.tasks[index].order=index+1})};var dateFrom;$scope.changeDate=function(){dateFrom=new Date($scope.dateWeekFrom.substr(6,4),$scope.dateWeekFrom.substr(3,2)-1,$scope.dateWeekFrom.substr(0,2)),$scope.checkTaskWeek(dateFrom)},$scope.delTask=function(index,order){1!=order&&swal({title:"Are you sure delete this row?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){if("insert"==$scope.tasks[index].isAction)$scope.tasks.splice(index,1),angular.forEach($scope.tasks,function(data,index){$scope.tasks[index].order=index+1});else if("update"==$scope.tasks[index].isAction){$scope.tasks[index].isAction="delete";for(var i=index+1;i<$scope.tasks.length;i++)$scope.tasks[i].order-=1}$scope.changeTimeCharge()})},$scope.addAllTask=function(status,formValid){$scope.info.time_temp<2280&&"Full-time"===$scope.TypeOfContruct&&1!==status?toastr.warning("Please check time charge(>=38)","Error"):$scope.info.time_in_lieuFull>$scope.info.time_in_lieuHas&&1!==status?toastr.warning("Please check time in lieu use larger time in lieu you have!","Fail"):formValid.$invalid?toastr.error("Please Input All Required Information!","Error"):$scope.isEdit?($scope.info.idWeek=$scope.idWeek,$scope.info.statusID=status,StaffService.editTask($scope.tasks,$scope.info).then(function(response){"success"==response.status?(toastr.success("Edit Success"),$state.go("loggedIn.timesheetHome.timesheetHistory",null,{reload:!0})):toastr.error("Error","Error")})):(startWeek=$filter("date")($scope.viewWeek.startWeek,"yyyy-MM-dd"),endWeek=$filter("date")($scope.viewWeek.endWeek,"yyyy-MM-dd"),$scope.info.startWeek=startWeek,$scope.info.endWeek=endWeek,$scope.info.statusID=status,$scope.info.weekNo=$scope.getWeekNumber($scope.viewWeek.startWeek),StaffService.addAllTask($scope.tasks,$scope.info).then(function(response){"success"==response.status?(toastr.success("success","Success"),$state.go("loggedIn.timesheetHome.timesheetHistory",null,{reload:!0})):toastr.error("Error","Error")}))},$scope.chooseItem=function(task,uploader,statusEdit,taskIndex){if(void 0!==task&&1===task.activity_id){void 0!==$scope.locations&&null!==$scope.locations&&0!==$scope.locations.length&&angular.forEach($scope.locations,function(location,index){location.location_id===task.location_id&&(task.locationName=location.NAME)}),void 0!==$scope.departments&&null!==$scope.departments&&0!==$scope.departments.length&&angular.forEach($scope.departments,function(department,index){$scope.departments[index].departmentid===task.department_code_id&&(task.departmentName=$scope.departments[index].departmentName)});var modalInstance=$modal.open({templateUrl:"ItemCode",controller:function($scope){$scope.items=angular.copy(task),$scope.clickCancel=function(){modalInstance.close({type:"cancel"})},$scope.clickSave=function(info,formValid){if(formValid.$invalid===!0)toastr.warning("Please Input All Required Information!","Error");else{if(void 0!==info&&null!==info)for(var i=0;i<info.length;i++)info[i].time_temp=StaffService.convertShowToFull(info[i].time_charge);modalInstance.close({type:"ok",value:info})}}},size:"lg"});modalInstance.result.then(function(obj){if("ok"==obj.type){var list=[];if(list=obj.value,task.item=list,list.length>0){for(var t=[],c=0,i=0;i<list.length;i++)"delete"!==list[i].isAction&&list[i].show===!0&&(t.push(list[i].ITEM_ID),c+=StaffService.convertShowToFull(list[i].time_charge));task.task=t.join(" , "),task.time_charge=StaffService.convertFromFullToShow(c),task.time_temp=c,$scope.changeTimeCharge()}else task.task=null,task.time_charge=null,$scope.changeTimeCharge()}})}else if(void 0!==task){void 0!==$scope.locations&&null!==$scope.locations&&0!==$scope.locations.length&&angular.forEach($scope.locations,function(location,index){location.location_id===task.location_id&&(task.locationName=location.NAME)}),void 0!==$scope.departments&&null!==$scope.departments&&0!==$scope.departments.length&&angular.forEach($scope.departments,function(department,index){$scope.departments[index].departmentid===task.department_code_id&&(task.departmentName=$scope.departments[index].departmentName)});var modalInstanceAC=$modal.open({templateUrl:"ActivityDetail",controller:function($scope){$scope.activities=angular.copy(task),$scope.activities.uploader=uploader,$scope.activities.taskIndex=taskIndex,statusEdit===!0&&($scope.activities.id_task_week=$stateParams.id),$scope.clickCancel=function(){modalInstanceAC.close({type:"cancel"})},$scope.clickSave=function(info,formValid,upload){if(formValid.$invalid===!0)toastr.warning("Please Input All Required Information!","Error");else{if(void 0!==info&&null!==info)for(var i=0;i<info.length;i++)info[i].time_temp=StaffService.convertShowToFull(info[i].time_charge);modalInstanceAC.close({type:"ok",value:info,valueUpload:upload})}}},size:"lg"});modalInstanceAC.result.then(function(obj){if("ok"==obj.type){var list=[];if(list=obj.value,task.item=list,list.length>0){for(var t=[],c=0,i=0;i<list.length;i++)"delete"!==list[i].isAction&&list[i].show===!0&&(t.push(list[i].ITEM_NAME),c+=StaffService.convertShowToFull(list[i].time_charge));task.task=t.join(" , "),task.time_charge=StaffService.convertFromFullToShow(c),task.time_temp=c,$scope.changeTimeCharge()}else task.task=null,task.time_charge=null,$scope.changeTimeCharge();$scope.uploader=obj.valueUpload,task.fileUpload=[],angular.forEach($scope.uploader.queue,function(value,index){task.fileUpload.push({file_id:value.file_id,item_id:value.itemId,isAction:"update"})})}})}},$scope.setCalendarToToday=function(){$scope.calendarDay=new Date},$scope.toggle=function($event,field,event){$event.preventDefault(),$event.stopPropagation(),event[field]=!event[field]},StaffService.showWeek($scope.info.userID)}),angular.module("app.loggedIn.timesheet.view.controller",[]).controller("TimesheetViewController",function($rootScope,$scope,MODE_ROW,$filter,$cookieStore,ConfigService,$modal,calendarHelper,moment,StaffService,$state,toastr){$scope.listStatus=[{code:1,name:"Awaiting for Submit"},{code:2,name:"Submitted"},{code:3,name:"Approved"},{code:4,name:"Rejected"},{code:5,name:"Re-submitted"}],$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.loadList(),$scope.dateWeekFrom=null},$scope.loadList=function(){StaffService.getAllTaskAMonth($scope.searchObjectMap).then(function(response){"error"==response.status?toastr.error("Error","Error"):$scope.list="no task"==response.status?response:response})},$scope.getFortMatTimeCharge=function(val){return StaffService.getFortMatTimeCharge(val)},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo};var init=function(){$scope.rows=MODE_ROW,$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,userID:$cookieStore.get("userInfo").id,week_no:null,order:{0:"DESC"},select:{"time_tasks_week.task_status_id":null}},$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.list={},$scope.loadList(),$scope.dateOptions={formatYear:"yy",startingDay:1}};init(),$scope.changeDate=function(dateValue){var dateFrom=new Date(dateValue.substr(6,4),dateValue.substr(3,2)-1,dateValue.substr(0,2));$scope.searchObjectMap.week_no=$scope.getWeekNumber(dateFrom),$scope.searchObjectMap.dateFrom=dateFrom,$scope.loadList()},$scope.tasks||($scope.tasks=[]),$scope.isEdit=!1,$scope.task={order:null,task:null,date:null,department_code_id:null,location_id:null,activity_id:null,time_charge:null},$scope.calendarDay=new Date,$scope.orderWeek=function(type){"desc"==type?($scope.list.result=$filter("orderBy")($scope.list.result,"week_no",!0),$scope.isAsc=!1):($scope.list.result=$filter("orderBy")($scope.list.result,"week_no",!1),$scope.isAsc=!0)},$scope.chooseItem=function(task){console.log(task),$modal.open({templateUrl:"modules/TimeSheet/views/itemModal.html",controller:"ItemController",size:"md"})},$scope.view=function(item){$modal.open({templateUrl:"modules/TimeSheet/views/viewTimesheetByHour.html",controller:"ViewTimesheetByHourController",size:"lg",resolve:{infoWeek:function(){return item}}})},$scope.clickAsc=function(){$scope.searchObjectMap.order[0]="ASC",$scope.loadList()},$scope.clickDesc=function(){$scope.searchObjectMap.order[0]="DESC",$scope.loadList()},StaffService.showWeek()}).controller("ViewDetailController",function($rootScope,$modalInstance,$modal,$scope,$cookieStore,$filter,ConfigService,calendarHelper,moment,StaffService,$state,toastr,infoWeek){$scope.tasks||($scope.tasks=[]),$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo};var info={date:new Date,userId:$cookieStore.get("userInfo").id};StaffService.checkTimeInLieu(info).then(function(response){if("error"===response.status)toastr.error("Check Time in Lieu fail!","Fail");else if("success"===response.status){var timeInLieu=0;angular.forEach(response.result,function(data,index){timeInLieu+=data.time_in_lieu}),$scope.time_in_lieuHas=timeInLieu}else $state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error")}),$scope.getDay=function(day){var date=new Date(day);return 0===date.getDay()?7:date.getDay()},$scope.week=infoWeek,$scope.getFortMatTimeCharge=function(val){return StaffService.getFortMatTimeCharge(val)},$scope.cancelClick=function(){$modalInstance.close()},$scope.okClick=function(){$modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetCreate",{id:infoWeek.task_week_id})},$scope.submitClick=function(value){$scope.week.time_charge<2280?toastr.warning("Please check time charge(>=38)","Error"):$scope.time_in_lieuChoose>$scope.time_in_lieuHas?toastr.warning("Please check time in lieu use larger time in lieu you have!","Fail"):(value.status=0,"Awaiting for Submit"==value.STATUS?value.status=2:"Rejected"==value.STATUS&&(value.status=5),StaffService.SubmitOnView(value).then(function(response){"error"===response.status?(toastr.error("Submit fail!","Error"),$modalInstance.close()):"success"===response.status&&($modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetHistory",null,{reload:!0}),toastr.success("Submit success","Success"))}))},$scope.loadInfo=function(){$scope.tasks.loading=!0,StaffService.getTask(infoWeek.task_week_id).then(function(response){if("fail"==response.status||"error"==response.status)toastr.error("Error","Error");else if("success"==response.status){var result=response.data;void 0!==result&&void 0!==result[0]&&($scope.ID_WEEK=result[0].tasks_week_id,$scope.STATUS=result[0].STATUS,$scope.USER_ID=$cookieStore.get("userInfo").id,$scope.after_status_id=result[0].after_status_id,$scope.time_in_lieuChoose=result[0].time_in_lieuChoose,$scope.submitOnView={},$scope.submitOnView.STATUS=$scope.STATUS,$scope.submitOnView.ID_WEEK=$scope.ID_WEEK,$scope.submitOnView.USER_ID=$scope.USER_ID,$scope.employee_name=null===result[0].FirstName||""===result[0].FirstName?null===result[0].LastName||""===result[0].LastName?" ":result[0].LastName:result[0].FirstName+" "+(null===result[0].LastName||""===result[0].LastName?" ":result[0].LastName)),"full"!=infoWeek.date?($scope.one=!0,$scope.Title="Timesheet Detail",$scope.tasks=_.filter(response.data,function(data){return data.date==infoWeek.date}),
angular.forEach($scope.tasks,function(valueTask,indexTask){$scope.tasks[indexTask].files=[],angular.forEach(response.file,function(valueFile,indexFile){valueTask.tasks_id===valueFile.tasks_id&&valueTask.ITEM_ID===valueFile.ITEM_ID&&$scope.tasks[indexTask].files.push({file_id:valueFile.file_id,file_name:valueFile.file_name})})})):($scope.Title="Full Timesheet",$scope.one=!1,$scope.tasks=response.data)}}),$scope.tasks.loading=!1},$scope.loadInfo(),$scope.chooseItem=function(item){$modal.open({templateUrl:"modules/TimeSheet/views/itemModal.html",controller:"ItemController",size:"lg",resolve:{itemArr:function(){var arr=[];return arr=item,arr.length>0?arr:null},isView:function(){return!0}}})}}).controller("ViewTimesheetByHourController",function($rootScope,$modalInstance,$modal,$scope,$cookieStore,$filter,ConfigService,calendarHelper,moment,StaffService,$state,toastr,infoWeek){$scope.tasks||($scope.tasks=[]),$scope.info||($scope.info={}),$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo};var info={date:new Date,userId:$cookieStore.get("userInfo").id};StaffService.checkTimeInLieu(info).then(function(response){if("error"===response.status)toastr.error("Check Time in Lieu fail!","Fail");else if("success"===response.status){var timeInLieu=0;angular.forEach(response.result,function(data,index){timeInLieu+=data.time_in_lieu}),$scope.time_in_lieuHas=timeInLieu}else $state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error")}),$scope.getFortMatTimeCharge=function(val){return StaffService.getFortMatTimeCharge(val)},$scope.cancelClick=function(){$modalInstance.close()},$scope.submitClick=function(value){$scope.week.time_charge<2280?toastr.warning("Please check time charge(>=38)","Error"):$scope.time_in_lieuChoose>$scope.time_in_lieuHas?toastr.warning("Please check time in lieu use larger time in lieu you have!","Fail"):(value.status=0,"Awaiting for Submit"==value.STATUS?value.status=2:"Rejected"==value.STATUS&&(value.status=5),StaffService.SubmitOnView(value).then(function(response){"error"===response.status?(toastr.error("Submit fail!","Error"),$modalInstance.close()):"success"===response.status&&($modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetHistory",null,{reload:!0}),toastr.success("Submit success","Success"))}))},$scope.okClick=function(){$modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetCreate",{id:infoWeek.task_week_id})},$scope.week=infoWeek,$scope.loadInfo=function(){$scope.tasks.loading=!0,StaffService.showDetailDate(infoWeek.task_week_id).then(function(response){if("fail"==response.status||"error"==response.status)toastr.error("Error","Error");else if("success"==response.status){var result=response.data;void 0!==result&&void 0!==result[0]&&($scope.STATUS=result[0].status,$scope.ID_WEEK=result[0].tasks_week_id,$scope.time_in_lieuChoose=result[0].time_in_lieuChoose,$scope.USER_ID=$cookieStore.get("userInfo").id,$scope.submitOnView={},$scope.submitOnView.STATUS=$scope.STATUS,$scope.submitOnView.ID_WEEK=$scope.ID_WEEK,$scope.submitOnView.USER_ID=$scope.USER_ID,$scope.afterStatusID=result[0].after_status_id,$scope.employee_name=null===result[0].FirstName||""===result[0].FirstName?null===result[0].LastName||""===result[0].LastName?" ":result[0].LastName:result[0].FirstName+" "+(null===result[0].LastName||""===result[0].LastName?" ":result[0].LastName));var arrayDate=[];angular.forEach(response.data,function(valueData,indexData){var isFoundDate=!1;angular.forEach(arrayDate,function(valueDate,indexDate){valueData.date===valueDate.date&&(isFoundDate=!0)}),isFoundDate===!1&&arrayDate.push({date:valueData.date})}),angular.forEach(arrayDate,function(valueDate,indexDate){var timeChargeDate=0;arrayDate[indexDate].timeActivity=[{time_charge:0},{time_charge:0},{time_charge:0},{time_charge:0},{time_charge:0}],angular.forEach(response.data,function(valueData,indexData){var time_charge=void 0!==valueData.time_charge&&null!==valueData.time_charge?valueData.time_charge:0;valueData.date===valueDate.date&&(timeChargeDate+=time_charge,arrayDate[indexDate].timeActivity[valueData.activity_id-1].time_charge+=time_charge)}),arrayDate[indexDate].time_charge_date=timeChargeDate}),$scope.tasks=angular.copy(arrayDate)}}),$scope.tasks.loading=!1},$scope.loadInfo(),$scope.viewDetailDate=function(infoWeek,date){$modal.open({templateUrl:"modules/TimeSheet/views/viewDetail.html",controller:"ViewDetailController",size:"lg",resolve:{infoWeek:function(){return infoWeek.date=date,infoWeek}}})}}),angular.module("app.loggedIn.staff.service",[]).factory("StaffService",function(Restangular,MIN_TO_DEC){var service={},api=Restangular.all("api");return service.addAllTask=function(allTaskPost,infoPost){var addAllTask=api.all("staff/addAllTask");return addAllTask.post({allTask:allTaskPost,info:infoPost})},service.getAllTaskAMonth=function(searchPost){var getAllTaskAMonth=api.all("staff/getAllTaskAMonth");return getAllTaskAMonth.post({search:searchPost})},service.SubmitOnView=function(infoPost){var SubmitOnView=api.all("staff/SubmitOnView");return SubmitOnView.post({info:infoPost})},service.editTask=function(task,infoPost){var editTask=api.all("staff/editTask");return editTask.post({allTask:task,info:infoPost})},service.checkTimeInLieu=function(infoPost){var checkTimeInLieu=api.all("staff/checktime");return checkTimeInLieu.post({info:infoPost})},service.getTask=function(idWeekPost){var getTask=api.all("staff/getTask");return getTask.post({idWeek:idWeekPost})},service.getDepartmentLocation=function(){var getDepartmentLocation=api.one("staff/getDepartmentLocation");return getDepartmentLocation.get()},service.checkFirstTaskWeek=function(infoPost){var checkFirstTaskWeek=api.all("staff/checkFirstTaskWeek");return checkFirstTaskWeek.post({info:infoPost})},service.checkTaskWeek=function(infoPost){var checkTaskWeek=api.all("staff/checkTaskWeek");return checkTaskWeek.post({info:infoPost})},service.showEdit=function(infoPost){var showEdit=api.all("staff/showEdit");return showEdit.post({info:infoPost})},service.showDetailDate=function(infoPost){var showDetailDate=api.all("staff/showDetailDate");return showDetailDate.post({info:infoPost})},service.getTaskList=function(){return api.one("staff/task/getList").get()},service.LoadContract=function(USER_ID){var LoadContract=api.all("staff/get-contract");return LoadContract.post({ID:USER_ID})},service.convertShowToFull=function(time_charge){if(void 0===time_charge||null===time_charge||isNaN(time_charge)||0===time_charge||0===time_charge.length)return 0;var hours=0,minutes=0;return hours=parseInt(time_charge.toString().substring(0,time_charge.toString().length-2)),minutes=parseInt(time_charge.toString().substring(time_charge.toString().length-2,time_charge.toString().length)),parseInt(60*hours)+parseInt(minutes)},service.convertFromFullToShow=function(time_charge){if(void 0!==time_charge&&null!==time_charge){var hours=parseInt(time_charge/60),minutes=parseInt(time_charge%60);return 10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),hours.toString()+minutes.toString()}},service.getFortMatTimeCharge=function(time_charge){if(void 0!==time_charge&&null!==time_charge&&0!==time_charge){var hours=parseInt(time_charge/60),minutes=parseInt(time_charge%60);return 10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),hours+":"+minutes}return"-"},service.showWeek=function(userID){var startDate,endDate,checkMonth=api.all("staff/checkMonth"),array=[],info={};new Date,info.userID=userID;var date=new Date;info.month=date.getMonth(),info.year=date.getFullYear(),checkMonth.post({info:info}).then(function(response){angular.forEach(response.tasks,function(data){var temp=new Date(data.date),monthTemp=1*temp.getMonth()+1,tempDate=temp.getDate();10>tempDate&&(tempDate="0"+tempDate),10>monthTemp&&(monthTemp="0"+monthTemp),array.push(temp.getFullYear()+"-"+monthTemp+"-"+tempDate)});var selectCurrentWeek=function(){window.setTimeout(function(){$(".ui-weekpicker").find(".ui-datepicker-current-day a").addClass("ui-state-active").removeClass("ui-state-default")},1)},setDates=function(input){var $input=$(input),date=$input.datepicker("getDate"),firstDay=$input.datepicker("option","firstDay");if($input.datepicker("option","dateFormat","dd/mm/yy"),$input.datepicker("option","firstDay",1),null!==date){var dayAdjustment=date.getDay()-firstDay;0>dayAdjustment&&(dayAdjustment+=7),startDate=new Date(date.getFullYear(),date.getMonth(),date.getDate()-dayAdjustment),endDate=new Date(date.getFullYear(),date.getMonth(),date.getDate()-dayAdjustment+6),$input.datepicker("setDate",startDate)}},dateRunTimeSheet=new Date("2015-03-30");$(".week-picker").datepicker({beforeShow:function(){$("#ui-datepicker-div").addClass("ui-weekpicker"),selectCurrentWeek()},onClose:function(){$("#ui-datepicker-div").removeClass("ui-weekpicker")},minDate:dateRunTimeSheet,showOtherMonths:!0,selectOtherMonths:!0,onSelect:function(dateText,inst){setDates(this),selectCurrentWeek(),$(this).change()},beforeShowDay:function(date){var string=jQuery.datepicker.formatDate("yy-mm-dd",date),cssClass="";return date>=startDate&&endDate>=date&&(cssClass="ui-datepicker-current-day"),[-1==array.indexOf(string),cssClass]},onChangeMonthYear:function(year,month,inst){selectCurrentWeek()}}),setDates(".week-picker");var $calendarTR=$(".ui-weekpicker .ui-datepicker-calendar tr");$calendarTR.live("mousemove",function(){$(this).find("td a").addClass("ui-state-hover")}),$calendarTR.live("mouseleave",function(){$(this).find("td a").removeClass("ui-state-hover")})})},service}),angular.module("app.loggedIn.staff.calendar.directive",[]).directive("mwlCalendar",function(moment,calendarHelper){return{templateUrl:"modules/staff/directives/templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",viewWeek:"=calendarViewWeek",currentDay:"=calendarCurrentDay",preDay:"=calendarPreDay",nextDay:"=calendarNextDay",control:"=calendarControl",eventClick:"&calendarEventClick",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek"},controller:function($scope){var self=this;$scope.useIsoWeek=!0,this.titleFunctions={},this.changeView=function(view,newDay){$scope.view=view,$scope.currentDay=newDay},$scope.control=$scope.control||{},$scope.control.prev=function(){$scope.currentDay=moment($scope.currentDay).subtract(3,"month").toDate(),$scope.preDay=moment($scope.preDay).subtract(3,"month").toDate(),$scope.nextDay=moment($scope.nextDay).subtract(3,"month").toDate()},$scope.control.next=function(){$scope.currentDay=moment($scope.currentDay).add(3,"month").toDate(),$scope.preDay=moment($scope.preDay).add(3,"month").toDate(),$scope.nextDay=moment($scope.nextDay).add(3,"month").toDate()},$scope.control.getTitle=function(day){return self.titleFunctions[$scope.view]?self.titleFunctions[$scope.view](day):""}}}}),angular.module("app.loggedIn.TimeSheet.Home.Controller",["app.loggedIn.TimeSheet.Home.Controller","app.loggedIn.TimeSheet.ApproveTask.Controller","app.loggedIn.TimeSheet.Report1.Controller","app.loggedIn.TimeSheet.Report2.Controller","app.loggedIn.TimeSheet.Report3.Controller","app.loggedIn.TimeSheet.Report4.Controller","app.loggedIn.TimeSheet.Report5.Controller","app.loggedIn.TimeSheet.Report6.Controller","app.loggedIn.TimeSheet.ReportOweLeave.Controller","app.loggedIn.TimeSheet.CreateLeave.Controller","app.loggedIn.TimeSheet.HistoryLeave.Controller","app.loggedIn.TimeSheet.ApproveLeave.Controller","angularFileUpload","app.loggedIn.timesheet.create.controller","app.loggedIn.timesheet.view.controller"]),angular.module("app.loggedIn.TimeSheet.Directives",["app.loggedIn.TimeSheet.ViewTask.Directive","app.loggedIn.TimeSheet.Time.Directive","app.loggedIn.TimeSheet.Detail.Directive","app.loggedIn.TimeSheet.Filter","app.loggedIn.TimeSheet.ItemCode.Directive","app.loggedIn.TimeSheet.Digits.Directive","app.loggedIn.TimeSheet.ActivityDetail.Directive","angularjs-dropdown-multiselect","app.loggedIn.TimeSheet.ViewLeave.Directive","app.loggedIn.TimeSheet.ApproveLeave.Directive","app.loggedIn.staff.calendar.directive","app.loggedIn.TimeSheet.formValidate.Directive"]),angular.module("app.loggedIn.TimeSheet.ItemCode.Directive",[]).directive("itemCode",function(TimeSheetService,$state,toastr,MODE_ROW,StaffService){return{restrict:"EA",required:"ngModel",scope:{onSave:"&",onCancel:"&",ngModel:"="},link:function(scope,elem,attrs){scope.$watch("ngModel",function(newModel,oldModel){scope.items=[],void 0!==newModel&&(scope.locationName=newModel.locationName,scope.departmentName=newModel.departmentName,void 0!==newModel.item&&0!==newModel.item.length&&angular.forEach(newModel.item,function(item,index){void 0!==item&&1!==item.deleted&&item.show!==!1&&scope.items.push(item)}),angular.forEach(scope.items,function(item,index){scope.items[index].show=!0}))}),scope.setPage=function(){scope.searchObjectMap.offset=(scope.searchObjectMap.currentPage-1)*scope.searchObjectMap.limit,scope.loadList()},scope.reset=function(){scope.searchObjectMap=angular.copy(scope.searchObject),scope.loadList()},scope.loadList=function(){TimeSheetService.LoadItemCode(scope.searchObjectMap).then(function(response){"success"===response.status?(scope.list=response,angular.forEach(scope.list.result,function(value,index){scope.list.result[index].status=!1})):"error"===response.status?($state.go("loggedIn.timesheetHome.timesheetCreate",null,{reload:!0}),toastr.error("Loading fail!","Error")):($state.go("loggedIn.timesheetHome.timesheetCreate",null,{reload:!0}),toastr.error("Server not response!","Error"))})};var init=function(){scope.searchObject={limit:10,offset:0,currentPage:1,maxSize:5,isBillable:!0,order:{"time_item_code.ITEM_ID":null},data:{"time_item_code.ITEM_ID":null,"time_item_code.ITEM_NAME":null}},scope.rows=MODE_ROW,scope.searchObjectMap=angular.copy(scope.searchObject),scope.list={},scope.loadList()};init(),scope.itemCodeASC=function(){scope.searchObjectMap.order["time_item_code.ITEM_ID"]="ASC",scope.loadList()},scope.itemCodeDESC=function(){scope.searchObjectMap.order["time_item_code.ITEM_ID"]="DESC",scope.loadList()},scope.changeTimeCharge=function(index,ratio){scope.items[index].totalUnits=void 0===ratio||null===ratio||""===ratio||isNaN(ratio)?null:ratio*scope.items[index].UNITS},scope.clickShow=function(index){void 0!==scope.list&&void 0!==scope.list.result&&void 0!==scope.list.result[index]&&void 0!==scope.list.result[index].status&&(scope.list.result[index].status=!scope.list.result[index].status)},scope.isShow=!0,scope.clickAdd=function(){scope.isShow=!0,angular.element("#itemCodeID").focus()},scope.addItem=function(ITEM_ID,ITEM_NAME,UNITS){if(scope.isShow===!0){var check=!1;angular.forEach(scope.items,function(item,index){item.ITEM_ID===ITEM_ID&&item.show===!0&&(toastr.warning("Item exist in list selected!","Fail"),check=!0)}),check===!1&&(scope.items.push({ITEM_ID:ITEM_ID,ITEM_NAME:ITEM_NAME,UNITS:UNITS,isAction:"insert",status:!1,show:!0}),scope.isDisabled=!1,scope.isShow=!1)}else toastr.warning("Not found row empty to insert!","Fail")},scope.clickShowSelected=function(index){void 0!==scope.items&&void 0!==scope.items[index]&&void 0!==scope.items[index].status&&(scope.items[index].status=!scope.items[index].status)},scope.deleteItem=function(index){swal({title:"Do you want to delete this Task / Item?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){"update"===scope.items[index].isAction?(scope.items[index].isAction="delete",scope.items[index].show=!1):"insert"===scope.items[index].isAction&&scope.items.splice(index,1);var count=0;angular.forEach(scope.items,function(item,index){item.show===!0&&++count}),0===count&&(scope.isShow=!0)})}},templateUrl:"modules/TimeSheet/directives/templates/ItemCode.html"}}),angular.module("app.loggedIn.TimeSheet.Digits.Directive",[]).directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){if(void 0==inputValue)return"";var transformedInput=inputValue.replace(/[^0-9]/g,"");return transformedInput!=inputValue&&(modelCtrl.$setViewValue(transformedInput),modelCtrl.$render()),transformedInput})}}}),angular.module("app.loggedIn.TimeSheet.ViewTask.Directive",[]).directive("viewTask",function(toastr,$state,TimeSheetService,$modal,MIN_TO_DEC,StaffService,$cookieStore){return{restrict:"EA",require:"ngModel",scope:{onCancel:"&",onReject:"&",onApprove:"&",ngModel:"="},link:function(scope,element,attrs){scope.info={},scope.$watch("ngModel",function(newModel,oldModel){isNaN(newModel)?"reject"===newModel?(scope.info.isReject=!0,scope.info.isApprove=!1,$("commentsID").focus()):"chooseApprove"===newModel?(scope.info.isApprove=!0,scope.info.isReject=!1):"cancelOn"===newModel&&(scope.info.isReject=null,scope.info.isApprove=!1):(scope.info.idTaskWeek=newModel,scope.info.USER_ID=$cookieStore.get("userInfo").id,TimeSheetService.ViewApproved(newModel).then(function(response){"error"===response.status?($state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.error("Loading fail!","Error")):"success"===response.status?(scope.list=response,scope.info.forPermission=scope.list.forPermission,angular.forEach(scope.list.result,function(timeDate,indexD){scope.list.result[indexD].AC=[],angular.forEach(scope.list.resultActivity,function(timeAC,indexAC){scope.list.resultActivity[indexAC].date===scope.list.result[indexD].date&&(scope.list.result[indexD].AC[scope.list.resultActivity[indexAC].activity_id]=scope.list.resultActivity[indexAC].sumAC)})}),scope.employee_name=null===scope.list.result[0].FirstName||""===scope.list.result[0].FirstName?null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName:scope.list.result[0].FirstName+" "+(null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName),scope.statusID=scope.list.result[0].task_status_id,4===scope.list.result[0].task_status_id&&(scope.info.hasReject=!0,scope.info.comments=scope.list.result[0].comments),scope.info.time_rest=scope.list.result[0].chargeWeek-2280,scope.info.time_restFull<0&&(scope.info.time_restFull=0),scope.info.time_in_lieu=null,scope.info.over_time=null,scope.info.TypeOfContruct=scope.list.result[0].TypeOfContruct):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}))}),scope.cancelClick=function(){scope.info.isReject=1,scope.info.isApprove=1},scope.$watch("info.time_in_lieu",function(newTimeInLieu,oldTimeInLieu){void 0!==newTimeInLieu&&null!==newTimeInLieu&&(0===newTimeInLieu.length?(scope.info.time_in_lieu=null,scope.info.over_time=null):StaffService.convertShowToFull(newTimeInLieu)>scope.info.time_rest?(scope.info.time_in_lieu=null,scope.info.over_time=null):(scope.info.time_in_lieuFull=StaffService.convertShowToFull(newTimeInLieu),scope.info.over_timeFull=scope.info.time_rest-scope.info.time_in_lieuFull,scope.info.over_time=StaffService.convertFromFullToShow(scope.info.over_timeFull)))}),scope.$watch("info.over_time",function(newOverTime,oldOverTime){void 0!==newOverTime&&null!==newOverTime&&(0===newOverTime.length?(scope.info.over_time=null,scope.info.time_in_lieu=null):StaffService.convertShowToFull(newOverTime)>scope.info.time_rest?(scope.info.time_in_lieu=null,scope.info.over_time=null):(scope.info.over_timeFull=StaffService.convertShowToFull(newOverTime),scope.info.time_in_lieuFull=scope.info.time_rest-scope.info.over_timeFull,scope.info.time_in_lieu=StaffService.convertFromFullToShow(scope.info.time_in_lieuFull)))});var dialogViewDetail=function(ID,DATE,detailType){var modalInstance=$modal.open({templateUrl:"ViewDetail",controller:function($scope){"all-date"===detailType?$scope.idView={ID:ID,STATUS:"all-date"}:"on-date"===detailType&&($scope.idView={ID:ID,DATE:DATE,STATUS:"on-date"}),$scope.clickCancel=function(value){modalInstance.close()}},size:"lg"})};scope.ViewDetail=function(ID,DATE,detailType){dialogViewDetail(ID,DATE,detailType)}},templateUrl:"modules/TimeSheet/directives/templates/ViewTask.html"}}),angular.module("app.loggedIn.TimeSheet.Detail.Directive",[]).directive("viewTimesheet",function(TimeSheetService,toastr,$state){return{restrict:"EA",required:"ngModel",scope:{onCancel:"&",ngModel:"="},link:function(scope,elem,attrs){scope.$watch("ngModel",function(newModel,oldModel){void 0!==newModel&&("on-date"===newModel.STATUS?(scope.Title="Timesheet Detail",TimeSheetService.ViewOnDate(newModel).then(function(response){"success"===response.status?(scope.list=response,angular.forEach(scope.list.result,function(valueResult,indexResult){scope.list.result[indexResult].files=[],angular.forEach(response.file,function(valueFile,indexFile){valueFile.tasks_id===valueResult.tasks_id&&valueFile.ITEM_ID===valueResult.ITEM_ID&&scope.list.result[indexResult].files.push({file_id:valueFile.file_id,file_name:valueFile.file_name})})}),void 0!==scope.list.result[0]&&(scope.employee_name=null===scope.list.result[0].FirstName||""===scope.list.result[0].FirstName?null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName:scope.list.result[0].FirstName+" "+(null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName))):"error"===response.status?toastr.error("Loadding fail!","Error"):($state("loggedIn.TimeSheetHome.ApproveTask",null,{reload:!0}),toastr.error("Server not response!","Error"))})):"all-date"===newModel.STATUS&&(scope.Title="Full Timesheet",TimeSheetService.ViewAllDate(newModel).then(function(response){"success"===response.status?(scope.list=response,scope.employee_name=null===scope.list.result[0].FirstName||""===scope.list.result[0].FirstName?null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName:scope.list.result[0].FirstName+" "+(null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName)):"error"===response.status?toastr.error("Loadding fail!","Error"):($state("loggedIn.ApproveTask",null,{reload:!0}),toastr.error("Server not response!","Error"))})))})},templateUrl:"modules/TimeSheet/directives/templates/Detail.html"}}),angular.module("app.loggedIn.TimeSheet.ActivityDetail.Directive",[]).directive("activityDetail",function(TimeSheetService,$state,toastr,MODE_ROW,StaffService,FileUploader,$cookieStore,$timeout,$window,$modal,$location){return{restrict:"EA",required:"ngModel",scope:{onSave:"&",onCancel:"&",ngModel:"="},link:function(scope,elem,attrs){scope.$watch("ngModel",function(newModel,oldModel){scope.items=[],void 0!==newModel&&(scope.locationName=newModel.locationName,scope.departmentName=newModel.departmentName,void 0!==newModel.item&&0!==newModel.item.length&&angular.forEach(newModel.item,function(item,index){void 0!==item&&1!==item.deleted&&item.show!==!1&&scope.items.push(item)}),angular.forEach(scope.items,function(item,index){scope.items[index].show=!0}),scope.ACTIVITY_ID=newModel.activity_id,void 0!==newModel.taskIndex&&(scope.taskIndex=newModel.taskIndex)),scope.setPage=function(){scope.searchObjectMap.offset=(scope.searchObjectMap.currentPage-1)*scope.searchObjectMap.limit,scope.loadList()},scope.reset=function(){scope.searchObjectMap=angular.copy(scope.searchObject),scope.loadList()},scope.loadList=function(){TimeSheetService.LoadItemCode(scope.searchObjectMap).then(function(response){"success"===response.status?(scope.list=response,angular.forEach(scope.list.result,function(value,index){scope.list.result[index].status=!1})):"error"===response.status?($state.go("loggedIn.timesheetHome.timesheetCreate",null,{reload:!0}),toastr.error("Loading fail!","Error")):($state.go("loggedIn.timesheetHome.timesheetCreate",null,{reload:!0}),toastr.error("Server not response!","Error"))})};var init=function(){scope.searchObject={limit:10,offset:0,currentPage:1,maxSize:5,isBillable:!1,activity_id:scope.ACTIVITY_ID,order:{"time_item_code.ITEM_ID":null},data:{"time_item_code.ITEM_ID":null,"time_item_code.ITEM_NAME":null}},scope.rows=MODE_ROW,scope.searchObjectMap=angular.copy(scope.searchObject),scope.list={},scope.loadList()};init(),scope.itemCodeASC=function(){scope.searchObjectMap.order["time_item_code.ITEM_ID"]="ASC",scope.loadList()},scope.itemCodeDESC=function(){scope.searchObjectMap.order["time_item_code.ITEM_ID"]="DESC",scope.loadList()},scope.changeTimeCharge=function(index,ratio){scope.items[index].totalUnits=void 0===ratio||null===ratio||""===ratio||isNaN(ratio)?null:ratio*scope.items[index].UNITS},scope.clickShow=function(index){void 0!==scope.list&&void 0!==scope.list.result&&void 0!==scope.list.result[index]&&void 0!==scope.list.result[index].status&&(scope.list.result[index].status=!scope.list.result[index].status)},scope.isShow=!0,scope.clickAdd=function(){scope.isShow=!0,angular.element("#itemCodeID").focus()},scope.addItem=function(ITEM_ID,ITEM_NAME,UNITS){if(scope.isShow===!0){var check=!1;angular.forEach(scope.items,function(item,index){item.ITEM_ID===ITEM_ID&&item.show===!0&&(toastr.warning("Item exist in list selected!","Fail"),check=!0)}),check===!1&&(scope.items.push({ITEM_ID:ITEM_ID,ITEM_NAME:ITEM_NAME,UNITS:UNITS,isAction:"insert",status:!1,totalUnits:1,ratio:1,show:!0}),scope.isDisabled=!1,scope.isShow=!1)}else toastr.warning("Not found row empty to insert!","Fail")},scope.clickShowSelected=function(index){void 0!==scope.items&&void 0!==scope.items[index]&&void 0!==scope.items[index].status&&(scope.items[index].status=!scope.items[index].status)},scope.deleteItem=function(index){swal({title:"Do you want to delete this Task / Item?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(){"update"===scope.items[index].isAction?(scope.items[index].isAction="delete",scope.items[index].show=!1):"insert"===scope.items[index].isAction&&scope.items.splice(index,1);var count=0;angular.forEach(scope.items,function(item,index){item.show===!0&&++count}),0===count&&(scope.isShow=!0)})}}),scope.uploader=new FileUploader({url:"/api/TimeSheet/post-upload-file",method:"POST",autoUpload:!0,formData:[{userId:$cookieStore.get("userInfo").id}],isHTML5:!0,isUploading:!0}),scope.uploader.filters.push({name:"limitFile",fn:function(item,options){return this.queue.length<5}}),scope.uploader.filters.push({name:"limitSize",fn:function(item){return!0}}),scope.removeItem=function(indexItem,indexFile,fileId){swal({title:"Are you sure detele this file!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(isConfirm){isConfirm&&(angular.forEach(scope.uploader.queue,function(value,index){value.file_id===fileId&&scope.uploader.removeFromQueue(index)}),scope.items[indexItem].fileUpload.splice(indexFile,1),TimeSheetService.DeleteFile(fileId).then(function(response){}))})},scope.uploader.onWhenAddingFileFailed=function(item,filter,options){"folder"===filter.name?swal({title:"Limit 5 file to upload.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0}):"queueLimit"===filter.name?swal({title:"The file you are trying to send exceeds the 10MB attachment limit.",type:"warning",confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0}):toastr.error("Upload file "+item.name+" fail!","Error")},scope.uploader.onAfterAddingAll=function(addedFileItems){if(angular.forEach(scope.items,function(value,index){void 0===value.taskIndex&&(scope.items[index].taskIndex=scope.taskIndex)}),scope.uploader.queue.length>0){angular.forEach(scope.uploader.queue,function(value,index){(void 0===value.taskIndex||void 0===value.itemId)&&(scope.uploader.queue[index].taskIndex=scope.taskIndex,scope.uploader.queue[index].itemId=scope.currentItemId)});var isFound=!1;angular.forEach(scope.uploader.queue,function(value,index){value.isUploading!==!0&&value.isUploaded!==!1||isFound!==!1||(isFound=!0,scope.progressTaskIndex=value.taskIndex,scope.progressItemId=value.itemId,scope.isUploading=!0)}),isFound===!1&&(scope.isUploading=!1)}},scope.uploader.onAfterAddingFile=function(fileItem){},scope.uploader.onBeforeUploadItem=function(item){},scope.uploader.onProgressItem=function(fileItem,progress){scope.fileNameProgress=fileItem.file.name,scope.progress=progress},scope.uploader.onProgressAll=function(progressAll){},scope.uploader.onSuccessItem=function(fileItem,response,status,headers){var isFound=!1;angular.forEach(scope.uploader.queue,function(value,index){value.isUploading!==!0&&value.isUploaded!==!1||isFound!==!1||(isFound=!0,scope.progressTaskIndex=value.taskIndex,scope.progressItemId=value.itemId,scope.isUploading=!0)}),scope.uploader.queue[scope.uploader.getIndexOfItem(fileItem)].file_id=response.file_id,isFound===!1&&(scope.isUploading=!1),angular.forEach(scope.items,function(valueItem,indexItem){void 0===scope.items[indexItem].fileUpload&&(scope.items[indexItem].fileUpload=[]),angular.forEach(scope.uploader.queue,function(valueFile,indexFile){if(valueItem.taskIndex===valueFile.taskIndex&&valueItem.ITEM_ID===valueFile.itemId&&void 0!==valueFile.file_id){var isFound2=!1;angular.forEach(scope.items[indexItem].fileUpload,function(valueCheck,indexCheck){valueCheck.file_id===valueFile.file_id&&(isFound2=!0)}),isFound2===!1&&scope.items[indexItem].fileUpload.push({file_name:valueFile.file.name,file_id:valueFile.file_id,isAction:"insert"})}})})},scope.getStyleUpload=function(){if(0!==scope.uploader.queue.length){var check=!1;return angular.forEach(scope.uploader.queue,function(value,index){value.isUploading===!0&&(check=!0)}),check===!0?{width:"5%"}:{width:"2%"}}return{width:"2%"}},scope.clickShowFile=function(itemIndex,itemId){$timeout(function(){document.getElementById("uploadTimesheet").click(),scope.clicked=!0,scope.currentItemId=itemId},0)}},templateUrl:"modules/TimeSheet/directives/templates/ActivityDetail.html"}}),angular.module("app.loggedIn.TimeSheet.Filter",[]).filter("customHours",function(){return function(time_charge){if(void 0!==time_charge&&null!==time_charge&&0!==time_charge){var hours=parseInt(time_charge/60),minutes=parseInt(time_charge%60);return 10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),hours+":"+minutes}return"-"}}).filter("getDate",function(){return function(input){var DateInput=new Date(input.toString());return DateInput.getDay()}}).filter("readMore",function(){return function(input){return void 0!==input&&null!==input&&""!==input?{check:input.length>150,value:input.substring(0,150)}:""}}).filter("readMoreSelected",function(){return function(input){return void 0!==input&&null!==input&&""!==input?{check:input.length>35,value:input.substring(0,35)}:""}}).filter("readMoreUpload",function(){return function(input){return void 0!==input&&null!==input&&""!==input?{check:input.length>20,value:input.substring(0,10)+"..."+input.substr(input.length-5,input.length-1)}:""}}).filter("customTotalHours",function(){return function(input){return void 0!==input&&null!==input&&""!==input&&0!==input&&0!==input.length?input.toString().substring(0,input.toString().length-2).concat(":",input.toString().substring(input.toString().length-2,input.toString())):"__:__"}}).filter("customTotalHoursAll",function(){return function(input){return void 0!==input&&null!==input&&""!==input&&0!==input&&0!==input.length?input.toString().substring(0,input.toString().length-2).concat(":",input.toString().substring(input.toString().length-2,input.toString())):"00:00"}}),angular.module("app.loggedIn.TimeSheet.Time.Directive",[]).directive("timeCharge",function(StaffService){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",formValidate:"=",requireValidate:"="},link:function(scope,elem,attrs,ctrls,ngModel){scope.$watch("ngModel",function(newModel,oldModel){if(void 0!==newModel&&null!==newModel&&""!==newModel&&parseInt(newModel.toString().substr(newModel.toString().length-2,2))>59&&(scope.ngModel=StaffService.convertFromFullToShow(StaffService.convertShowToFull(newModel)).toString()),
void 0!==scope.ngModel&&null!==scope.ngModel&&""!==scope.ngModel&&0!==scope.ngModel&&0!==scope.ngModel.length){for(var result="",i=0;i<scope.ngModel.toString().length-2;i++)result+="9";result+=":99",attrs.$set("uiMask",result)}else"99:99"!==attrs.uiMask&&attrs.$set("uiMask","99:99");var ObjectError={required:"Field is required!",mask:"Filed is invalid!"},isError=!1,keyErrorOut="";angular.forEach(scope.formValidate,function(valueError,keyErrorIn){valueError===!0&&(isError=!0,keyErrorOut=keyErrorIn)}),isError===!0?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError[keyErrorOut]})):void 0!==newModel&&null!==newModel&&0===newModel.length?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError.required})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))})}}}).directive("timeChargeleave",function(StaffService){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",formValidate:"=",requireValidate:"="},link:function(scope,elem,attrs,ctrls,ngModel){scope.$watch("ngModel",function(newModel,oldModel){if(void 0!==newModel&&null!==newModel&&""!==newModel&&parseInt(newModel.toString().substr(newModel.toString().length-2,2))>59&&(scope.ngModel=StaffService.convertFromFullToShow(StaffService.convertShowToFull(newModel)).toString()),void 0!==scope.ngModel&&null!==scope.ngModel&&""!==scope.ngModel&&0!==scope.ngModel&&0!==scope.ngModel.length){for(var result="",i=0;i<scope.ngModel.toString().length-2;i++)result+="9";result+=":99",attrs.$set("uiMask",result)}else"99:99"!==attrs.uiMask&&attrs.$set("uiMask","99:99");var ObjectError={required:"Field is required!",mask:"Filed is invalid!"},isError=!1,keyErrorOut="";angular.forEach(scope.formValidate,function(valueError,keyErrorIn){valueError===!0&&(isError=!0,keyErrorOut=keyErrorIn)}),isError===!0?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError[keyErrorOut]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))}),scope.$watch("requireValidate",function(newModelRequired,oldModelRequired){void 0!==newModelRequired&&null!==newModelRequired&&0!==newModelRequired.length?attrs.$set("required",!0):attrs.$set("required",!1);var ObjectError={required:"Field is required!",mask:"Filed is invalid!"},isError=!1,keyErrorOut="";angular.forEach(scope.formValidate,function(valueError,keyErrorIn){valueError===!0&&(isError=!0,keyErrorOut=keyErrorIn)}),isError===!0?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError[keyErrorOut]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))})}}}).directive("timeChargenon",function(StaffService){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",formValidate:"=",requireValidate:"="},link:function(scope,elem,attrs,ctrls,ngModel){scope.$watch("ngModel",function(newModel,oldModel){if(void 0!==newModel&&null!==newModel&&""!==newModel&&parseInt(newModel.toString().substr(newModel.toString().length-2,2))>59&&(scope.ngModel=StaffService.convertFromFullToShow(StaffService.convertShowToFull(newModel)).toString()),void 0!==scope.ngModel&&null!==scope.ngModel&&""!==scope.ngModel&&0!==scope.ngModel&&0!==scope.ngModel.length){for(var result="",i=0;i<scope.ngModel.toString().length-2;i++)result+="9";result+=":99",attrs.$set("uiMask",result)}else"999:99"!==attrs.uiMask&&attrs.$set("uiMask","999:99");var ObjectError={required:"Field is required!",mask:"Filed is invalid!"},isError=!1,keyErrorOut="";angular.forEach(scope.formValidate,function(valueError,keyErrorIn){valueError===!0&&(isError=!0,keyErrorOut=keyErrorIn)}),isError===!0?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError[keyErrorOut]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))}),scope.$watch("requireValidate",function(newModelRequired,oldModelRequired){void 0!==newModelRequired&&null!==newModelRequired&&0!==newModelRequired.length?attrs.$set("required",!0):attrs.$set("required",!1);var ObjectError={required:"Field is required!",mask:"Filed is invalid!"},isError=!1,keyErrorOut="";angular.forEach(scope.formValidate,function(valueError,keyErrorIn){valueError===!0&&(isError=!0,keyErrorOut=keyErrorIn)}),isError===!0?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHtml:!0,content:ObjectError[keyErrorOut]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))})}}}),angular.module("app.loggedIn.TimeSheet.Service",[]).factory("TimeSheetService",function(Restangular){var TimeSheetService={},api=Restangular.all("api");return TimeSheetService.LoadTaskApproved=function(searchObjPost){var LoadTaskApproved=api.all("TimeSheet/post-list-approved");return LoadTaskApproved.post({searchObj:searchObjPost})},TimeSheetService.ViewApproved=function(idPost){var ViewApproved=api.all("TimeSheet/post-one-approved");return ViewApproved.post({info:idPost})},TimeSheetService.LoadTimeSheetApprove=function(searchObjPost){var LoadTimeSheetApprove=api.all("TimeSheet/post-list-approve");return LoadTimeSheetApprove.post({searchObj:searchObjPost})},TimeSheetService.RejectTaskWeek=function(infoPost){var RejectTaskWeek=api.all("TimeSheet/post-reject-taskweek");return RejectTaskWeek.post({info:infoPost})},TimeSheetService.ApproveTaskWeek=function(infoPost){var ApproveTaskWeek=api.all("TimeSheet/post-approve-taskweek");return ApproveTaskWeek.post({info:infoPost})},TimeSheetService.LoadRole=function(idPost){var LoadRole=api.all("TimeSheet/post-role-one");return LoadRole.post({USER_ID:idPost})},TimeSheetService.ViewItem=function(taskIdPost){var ViewItem=api.all("TimeSheet/post-item-list");return ViewItem.post({taskID:taskIdPost})},TimeSheetService.ViewOnDate=function(infoPost){var ViewOnDate=api.all("TimeSheet/post-detail-one");return ViewOnDate.post({info:infoPost})},TimeSheetService.ViewAllDate=function(infoPost){var ViewAllDate=api.all("TimeSheet/post-detail-all");return ViewAllDate.post({info:infoPost})},TimeSheetService.LoadItemCode=function(searchObjPost){var LoadItemCode=api.all("TimeSheet/post-itemcode-list");return LoadItemCode.post({searchObj:searchObjPost})},TimeSheetService.LoadDeptReport=function(idPost){var LoadDeptReport=api.all("TimeSheet/post-list-deptRP");return LoadDeptReport.post({USER_ID:idPost})},TimeSheetService.LoadEmpReport=function(listDeptPost){var LoadEmpReport=api.all("TimeSheet/post-list-empRP");return LoadEmpReport.post({listDept:listDeptPost})},TimeSheetService.LoadReportOnActualWorking=function(infoPost){var LoadReportOnActualWorking=api.all("TimeSheet/post-actual-working");return LoadReportOnActualWorking.post({info:infoPost})},TimeSheetService.sendMailTimeSheet=function(infoPost){var sendMailTimeSheet=api.all("TimeSheet/post-send-mail");return sendMailTimeSheet.post({info:infoPost})},TimeSheetService.LoadInfoEmployee=function(idPost){var LoadInfoEmployee=api.all("TimeSheet/post-info-employee");return LoadInfoEmployee.post({USER_ID:idPost})},TimeSheetService.LoadTypeLeave=function(){var LoadTypeLeave=api.one("TimeSheet/get-type-leave");return LoadTypeLeave.get({})},TimeSheetService.UpLeaveServer=function(infoPost){var UpLeaveServer=api.all("TimeSheet/post-leave-form");return UpLeaveServer.post({info:infoPost})},TimeSheetService.LoadHistoryLeave=function(searchObjPost){var LoadHistoryLeave=api.all("TimeSheet/post-history-leave");return LoadHistoryLeave.post({searchObj:searchObjPost})},TimeSheetService.ViewLeave=function(infoPost){var ViewLeave=api.all("TimeSheet/post-view-leave");return ViewLeave.post({info:infoPost})},TimeSheetService.SubmitOnViewLeave=function(infoPost){var SubmitOnViewLeave=api.all("TimeSheet/post-submit-view");return SubmitOnViewLeave.post({info:infoPost})},TimeSheetService.LoadLeaveEdit=function(infoPost){var LoadLeaveEdit=api.all("TimeSheet/post-load-edit");return LoadLeaveEdit.post({info:infoPost})},TimeSheetService.UpdateLeave=function(infoPost){var UpdateLeave=api.all("TimeSheet/post-update-leave");return UpdateLeave.post({info:infoPost})},TimeSheetService.LoadLeaveApprove=function(infoPost){var LoadLeaveApprove=api.all("TimeSheet/post-list-leave");return LoadLeaveApprove.post({info:infoPost})},TimeSheetService.ApproveLeave=function(infoPost){var ApproveLeave=api.all("TimeSheet/post-approve-leave");return ApproveLeave.post({info:infoPost})},TimeSheetService.RejectLeave=function(infoPost){var RejectLeave=api.all("TimeSheet/post-reject-leave");return RejectLeave.post({info:infoPost})},TimeSheetService.CheckLeave=function(idPost){var CheckLeave=api.all("TimeSheet/post-check-leave");return CheckLeave.post({USER_ID:idPost})},TimeSheetService.LoadReportOweLeave=function(infoPost){var LoadReportOweLeave=api.all("TimeSheet/post-owe-leave");return LoadReportOweLeave.post({info:infoPost})},TimeSheetService.LoadReportTimeInLieu=function(infoPost){var LoadReportTimeInLieu=api.all("TimeSheet/post-time-inlieu");return LoadReportTimeInLieu.post({info:infoPost})},TimeSheetService.LoadReportItemNumber=function(infoPost){var LoadReportItemNumber=api.all("TimeSheet/post-item-number");return LoadReportItemNumber.post({info:infoPost})},TimeSheetService.LoadReportUtilizationRatioSumary=function(infoPost){var LoadReportUtilizationRatioSumary=api.all("TimeSheet/post-utilization-sumary");return LoadReportUtilizationRatioSumary.post({info:infoPost})},TimeSheetService.LoadReportUtilizationRatioDetail=function(infoPost){var LoadReportUtilizationRatioDetail=api.all("TimeSheet/post-utilization-detail");return LoadReportUtilizationRatioDetail.post({info:infoPost})},TimeSheetService.DeleteFile=function(fileIdPost){var DeleteFile=api.all("TimeSheet/post-del-file");return DeleteFile.post({fileId:fileIdPost})},TimeSheetService}),angular.module("app.loggedIn.TimeSheet.Report1.Controller",[]).controller("Report1Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.isHavedata=0,$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length&&TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeEmp=function(list){if(0!==$scope.listEmployeeChoose.length){$scope.isHavedata=1;var info={};info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.listDept=angular.copy($scope.listDepartmentChoose),TimeSheetService.LoadReportTimeInLieu(info).then(function(response){"success"===response.status?$scope.USER_ID=$cookieStore.get("userInfo").id:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"null"===response.status?($scope.isHavedata=0,toastr.error("No Data!!!!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?$scope.listDept=response.result:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.Report2.Controller",[]).controller("Report2Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.isHavedata=0,$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length&&(listNew[0].isStaff=$scope.isStaff,listNew[0].USER_ID=$cookieStore.get("userInfo").id,TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}))},$scope.changeDate=function(){$scope.changeEmp($scope.listEmployeeChoose)},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){$scope.isHavedata=1;var info={},weekNoFrom=$scope.dateWeekFrom,weekNoTo=$scope.dateWeekTo;info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),info.weekNoTo=$scope.getWeekNumber(weekNoTo),info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.weekFrom=$scope.dateWeekFrom,info.weekTo=$scope.dateWeekTo,info.listDept=$scope.listDepartmentChoose,info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),TimeSheetService.LoadReportUtilizationRatioDetail(info).then(function(response){"success"===response.status?$scope.USER_ID=$cookieStore.get("userInfo").id:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"null"===response.status?($scope.isHavedata=0,toastr.error("No Data!!!!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?($scope.listDept=response.result,$scope.isStaff=response.isStaff):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.Report3.Controller",[]).controller("Report3Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.isHavedata=0,$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length&&(listNew[0].isStaff=$scope.isStaff,listNew[0].USER_ID=$cookieStore.get("userInfo").id,TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}))},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeDate=function(){$scope.changeEmp($scope.listEmployeeChoose)},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){$scope.isHavedata=1;var info={},weekNoFrom=$scope.dateWeekFrom,weekNoTo=$scope.dateWeekTo;info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),info.weekNoTo=$scope.getWeekNumber(weekNoTo),info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.weekFrom=$scope.dateWeekFrom,info.weekTo=$scope.dateWeekTo,info.listDept=$scope.listDepartmentChoose,info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),TimeSheetService.LoadReportUtilizationRatioSumary(info).then(function(response){"success"===response.status?$scope.USER_ID=$cookieStore.get("userInfo").id:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"null"===response.status?($scope.isHavedata=0,toastr.error("No Data!!!!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?($scope.listDept=response.result,$scope.isStaff=response.isStaff):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.Report4.Controller",[]).controller("Report4Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length?TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}):$scope.listEmployeeChoose=[]},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeDate=function(){$scope.changeEmp($scope.listEmployeeChoose)},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){var info={};$scope.dateWeekFrom,$scope.dateWeekTo,info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.dateWeekFrom=$scope.dateWeekFrom,info.dateWeekTo=$scope.dateWeekTo,info.listDept=$scope.listDepartmentChoose,TimeSheetService.LoadReportOnActualWorking(info).then(function(response){"success"===response.status?($scope.USER_ID=$cookieStore.get("userInfo").id,$scope.disabledPrint=!1):"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"dataNull"===response.status?(toastr.error("Not data!","Error"),$scope.disabledPrint=!0):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?$scope.listDept=response.result:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.Report5.Controller",[]).controller("Report5Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length?TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}):$scope.listEmployeeChoose=[]},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeDate=function(){$scope.changeEmp($scope.listEmployeeChoose)},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){var info={};$scope.dateWeekFrom,$scope.dateWeekTo,info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.dateWeekFrom=$scope.dateWeekFrom,info.dateWeekTo=$scope.dateWeekTo,info.listDept=$scope.listDepartmentChoose,TimeSheetService.LoadReportOnActualWorking(info).then(function(response){"success"===response.status?$scope.USER_ID=$cookieStore.get("userInfo").id:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"dataNull"===response.status?(toastr.error("Not data!","Error"),$scope.disabledPrint=!0):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?$scope.listDept=response.result:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.Report6.Controller",[]).controller("Report6Controller",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.ListNew=function(listNew){void 0!==listNew&&null!==listNew&&0!==listNew.length&&(listNew[0].isStaff=$scope.isStaff,listNew[0].USER_ID=$cookieStore.get("userInfo").id,TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}))},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeDate=function(){$scope.changeEmp($scope.listEmployeeChoose)},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){var info={};info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.dateWeekFrom=$scope.dateWeekFrom,info.dateWeekTo=$scope.dateWeekTo,info.listDept=angular.copy($scope.listDepartmentChoose),TimeSheetService.LoadReportItemNumber(info).then(function(response){"success"===response.status?($scope.USER_ID=$cookieStore.get("userInfo").id,$scope.disabledPrint=!1):"dataNull"===response.status?(toastr.error("Not data!","Error"),$scope.disabledPrint=!0):"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?($scope.listDept=response.result,$scope.isStaff=response.isStaff):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet",["app.loggedIn.TimeSheet.Home.Controller","app.loggedIn.TimeSheet.Directives","app.loggedIn.TimeSheet.Service","app.loggedIn.staff.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.timesheetHome",{"abstract":!0,url:"/timesheet",templateUrl:"modules/TimeSheet/views/structure.html"
}).state("loggedIn.timesheetHome.timesheetApprove",{position:["Head of Dept.","Director"],url:"/approve-timesheet",views:{"main-content":{templateUrl:"modules/TimeSheet/views/ApproveTask.html",controller:"ApproveTask"}}}).state("loggedIn.timesheetHome.timesheetReport1",{url:"/report/time-in-lieu",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report1.html",controller:"Report1Controller"}}}).state("loggedIn.timesheetHome.timesheetReport2",{url:"/report/utilization-ratio-detail",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report2.html",controller:"Report2Controller"}}}).state("loggedIn.timesheetHome.timesheetReport3",{url:"/report/utilization-ratio-summary",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report3.html",controller:"Report3Controller"}}}).state("loggedIn.timesheetHome.timesheetReport4",{url:"/report/actual-working-hours",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report4.html",controller:"Report4Controller"}}}).state("loggedIn.timesheetHome.timesheetReport5",{url:"/report/actual-working-ratio",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report5.html",controller:"Report5Controller"}}}).state("loggedIn.timesheetHome.timesheetReport6",{url:"/report/item-number",views:{"main-content":{templateUrl:"modules/TimeSheet/views/Report6.html",controller:"Report6Controller"}}}).state("loggedIn.timesheetHome.leaveCreate",{position:["Staff","Head of Dept."],url:"/create-leave/:id",views:{"main-content":{templateUrl:"modules/TimeSheet/views/CreateLeave.html",controller:"CreateLeaveController"}}}).state("loggedIn.timesheetHome.leaveHistory",{position:["Staff","Head of Dept."],url:"/historry-leave",views:{"main-content":{templateUrl:"modules/TimeSheet/views/HistoryLeave.html",controller:"HistoryLeaveController"}}}).state("loggedIn.timesheetHome.leaveApprove",{position:["Head of Dept.","Director"],url:"/approve-leave",views:{"main-content":{templateUrl:"modules/TimeSheet/views/ApproveLeave.html",controller:"ApproveLeaveController"}}}).state("loggedIn.timesheetHome.leaveReportOwe",{position:["Head of Dept.","Director"],url:"/report/unsubmitted-leave-form",views:{"main-content":{templateUrl:"modules/TimeSheet/views/ReportOweLeave.html",controller:"ReportOweLeave"}}}).state("loggedIn.timesheetHome.timesheetHistory",{position:["Staff","Head of Dept."],url:"/view-timesheet",views:{"main-content":{templateUrl:"modules/TimeSheet/views/viewTimesheet.html",controller:"TimesheetViewController"}}}).state("loggedIn.timesheetHome.timesheetCreate",{position:["Staff","Head of Dept."],url:"/create-timesheet/:id",views:{"main-content":{templateUrl:"modules/TimeSheet/views/createTimesheet.html",controller:"TimesheetCreateController"}}})}),angular.module("app.loggedIn.TimeSheet.ApproveTask.Controller",[]).controller("ApproveTask",function($scope,$modal,TimeSheetService,toastr,$state,MODE_ROW,$cookieStore){$scope.listStatus=[{code:2,name:"Awaiting for Approve"},{code:3,name:"Approved"},{code:4,name:"Rejected"},{code:5,name:"Re-submitted"}],$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.loadList()},$scope.loadList=function(){TimeSheetService.LoadTimeSheetApprove($scope.searchObjectMap).then(function(response){"success"==response.status?$scope.list=response:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})};var init=function(){$scope.searchObject={offset:0,limit:10,currentPage:1,maxSize:5,USER_ID:$cookieStore.get("userInfo").id,order:{"time_tasks_week.date_submited":null,"time_tasks_week.week_no":"DESC"},select:{"time_tasks_week.week_no":null,"hr_employee.Employee_ID":null},data:{"hr_employee.Employee_Code":null},name:{nameEmployee:null}},$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.list={},$scope.rows=MODE_ROW,$scope.loadList()};init(),$scope.weekNoASC=function(){$scope.searchObjectMap.order["time_tasks_week.date_submited"]=null,$scope.searchObjectMap.order["time_tasks_week.week_no"]="ASC",$scope.loadList()},$scope.weekNoDESC=function(){$scope.searchObjectMap.order["time_tasks_week.date_submited"]=null,$scope.searchObjectMap.order["time_tasks_week.week_no"]="DESC",$scope.loadList()},$scope.dateSubmitedASC=function(){$scope.searchObjectMap.order["time_tasks_week.date_submited"]="ASC",$scope.searchObjectMap.order["time_tasks_week.week_no"]=null,$scope.loadList()},$scope.dateSubmitedDESC=function(){$scope.searchObjectMap.order["time_tasks_week.date_submited"]="DESC",$scope.searchObjectMap.order["time_tasks_week.week_no"]=null,$scope.loadList()};var dialogViewTask=function(idTaskWeek){var modalInstance=$modal.open({templateUrl:"ViewTask",controller:function($scope){$scope.infoTaskWeek=idTaskWeek,$scope.clickCancel=function(info){void 0!==info.clickCancel&&null!==info.clickCancel||void 0!==info.isReject&&null!==info.isReject||info.isApprove===!0?$scope.infoTaskWeek="cancelOn":modalInstance.close({status:"cancel"})},$scope.clickReject=function(info){void 0===info.isReject||null===info.isReject?$scope.infoTaskWeek="reject":info.isReject===!0&&TimeSheetService.RejectTaskWeek(info).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.success("Reject success!","Success")):"error"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.error("Reject fail!","Error")):(modalInstance.close(),$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.clickApprove=function(info){null!==info.time_rest&&0!=info.time_rest&&""!==info.time_rest&&info.isApprove!==!0?$scope.infoTaskWeek="chooseApprove":info.forPermission===!1?swal({title:"Warning!",text:"Please noted that the Leave Form has not yet been submitted/approved. Do you want to approve this Timesheet?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(isConfirm){isConfirm&&TimeSheetService.ApproveTaskWeek(info).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.success("Approve success!","Success")):"error"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.error("Approve fail!","Error")):(modalInstance.close(),$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}):TimeSheetService.ApproveTaskWeek(info).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.success("Approve success!","Success")):"error"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.timesheetApprove",null,{reload:!0}),toastr.error("Approve fail!","Error")):(modalInstance.close(),$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},size:"lg"})};$scope.viewTask=function(idTaskWeek){dialogViewTask(idTaskWeek)}}),angular.module("app.loggedIn.TimeSheet.CreateLeave.Controller",[]).controller("CreateLeaveController",function($scope,TimeSheetService,$cookieStore,$state,toastr,$modal,StaffService,$stateParams){if($scope.info={},$scope.dateOptions={formatYear:"yy",startingDate:1},$stateParams.id){$scope.isEdit=!0;var info={idLeave:$stateParams.id,userId:$cookieStore.get("userInfo").id};TimeSheetService.LoadLeaveEdit(info).then(function(response){"success"===response.status?(void 0!==response&&null!==response&&void 0!==response.resultLeave&&null!==response.resultLeave&&0!==response.resultLeave.length&&void 0!==response.resultLeave[0]&&null!==response.resultLeave[0]&&($scope.info=response.resultLeave[0],$scope.is_reject=response.resultLeave[0].is_reject,$scope.status_id=response.resultLeave[0].status_id,$scope.info.time_leave=StaffService.convertFromFullToShow($scope.info.time_leave)),$scope.info.infoTypeLeave=response.resultLeaveDetail,angular.forEach($scope.info.infoTypeLeave,function(leave,index){void 0===$scope.info.infoTypeLeave[index]||null===$scope.info.infoTypeLeave[index]||void 0===$scope.info.infoTypeLeave[index].time_leave||null===$scope.info.infoTypeLeave[index].time_leave||0===$scope.info.infoTypeLeave[index].time_leave||isNaN($scope.info.infoTypeLeave[index].time_leave)||($scope.info.infoTypeLeave[index].time_leave=StaffService.convertFromFullToShow($scope.info.infoTypeLeave[index].time_leave),0===index&&4===$scope.info.infoTypeLeave[index].time_leave.length&&0===$scope.info.standard&&($scope.info.infoTypeLeave[index].time_leave="0"+$scope.info.infoTypeLeave[index].time_leave))}),$scope.changeTime()):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error"))})}else $scope.isEdit=!1,void 0!==$cookieStore.get("userInfo")&&null!==$cookieStore.get("userInfo")&&void 0!==$cookieStore.get("userInfo").id&&null!==$cookieStore.get("userInfo").id?TimeSheetService.LoadInfoEmployee($cookieStore.get("userInfo").id).then(function(response){"success"===response.status?void 0!==response&&null!==response&&void 0!==response.resultEmployee&&null!==response.resultEmployee&&void 0!==response.resultEmployee[0]&&null!==response.resultEmployee[0]&&($scope.info=response.resultEmployee[0],$scope.info.standard=1,$scope.info.application_date=new Date,$scope.info.infoTypeLeave=angular.copy(response.resultTypeLeave)):"error"===response.status||0===response.result.length?($state.go("loggedIn.home",null,{reload:!0}),toastr("Load infomation employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr("Server not response!","Error"))}):($state.go("loggedIn.login",null,{reload:!0}),toastr.error("You not section!","Error"));$scope.clickSendServer=function(statusID,formLeave){$scope.isRequired=1,formLeave.$invalid?toastr.error("Please Input All Required Information!","Error"):0===$scope.info.time_leave_real||void 0===$scope.info.time_leave||null===$scope.info.time_leave||0===$scope.info.time_leave.length?toastr.error("You must sign time leave!","Error"):void 0!==$scope.info.time_leave_real&&void 0!==$scope.info.standard&&($scope.info.time_leave_real>4560&&1===$scope.info.standard||$scope.info.time_leave_real<=4560&&0===$scope.info.standard)?toastr.warning("Please make sure you have chosen the right type of Leave Form (Standard/Non-Standard).","Warning"):($scope.info.statusID=statusID,$scope.info.USER_ID=$cookieStore.get("userInfo").id,$scope.isEdit===!1?TimeSheetService.UpLeaveServer($scope.info).then(function(response){"success"===response.status?(toastr.success("Apply for leave success!","Success"),$state.go("loggedIn.timesheetHome.leaveHistory",null,{reload:!0})):"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Apply for leave fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}):$scope.isEdit===!0&&TimeSheetService.UpdateLeave($scope.info).then(function(response){"success"===response.status?($state.go("loggedIn.timesheetHome.leaveHistory",null,{reload:!0}),toastr.success("Update leave success!","Success")):"error"===response.status?toastr.error("Update leave fail!","Error"):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}))},$scope.changeTime=function(){var total_time=0;angular.forEach($scope.info.infoTypeLeave,function(time,index){total_time+=StaffService.convertShowToFull($scope.info.infoTypeLeave[index].time_leave),$scope.info.infoTypeLeave[index].time_leave_real=StaffService.convertShowToFull($scope.info.infoTypeLeave[index].time_leave)}),$scope.info.time_leave=StaffService.convertFromFullToShow(total_time),$scope.info.time_leave_real=StaffService.convertShowToFull($scope.info.time_leave),0===total_time&&($scope.info.time_leave=null)},$scope.clickStandardChange=function(standardID){1===standardID?void 0!==$scope.info.infoTypeLeave&&null!==$scope.info.infoTypeLeave&&void 0!==$scope.info.infoTypeLeave[0]&&null!==$scope.info.infoTypeLeave[0]&&void 0!==$scope.info.infoTypeLeave[0].time_leave&&null!==$scope.info.infoTypeLeave[0].time_leave&&5===$scope.info.infoTypeLeave[0].time_leave.length&&($scope.info.infoTypeLeave[0].time_leave=$scope.info.infoTypeLeave[0].time_leave.substr(1,$scope.info.infoTypeLeave[0].time_leave.length-1),$scope.changeTime()):0===standardID&&void 0!==$scope.info.infoTypeLeave&&null!==$scope.info.infoTypeLeave&&void 0!==$scope.info.infoTypeLeave[0]&&null!==$scope.info.infoTypeLeave[0]&&void 0!==$scope.info.infoTypeLeave[0].time_leave&&null!==$scope.info.infoTypeLeave[0].time_leave&&4===$scope.info.infoTypeLeave[0].time_leave.length&&($scope.info.infoTypeLeave[0].time_leave="0"+$scope.info.infoTypeLeave[0].time_leave,$scope.changeTime())},$scope.checkLeaveExist=function(){void 0!==$scope.info.start_date&&null!==$scope.info.start_date&&0!==$scope.info.start_date.length&&void 0!==$scope.info.finish_date&&null!==$scope.info.finish_date&&0!==$scope.info.finish_date.length&&TimeSheetService.CheckLeave($cookieStore.get("userInfo").id).then(function(response){if("success"===response.status){var currentStartDate=moment(moment($scope.info.start_date).format("YYYY-MM-DD")).format("X"),currentFinishDate=moment(moment($scope.info.finish_date).format("YYYY-MM-DD")).format("X"),arrayTime=angular.copy(response.result);angular.forEach(arrayTime,function(timeRange,index){var startDate=moment(moment(timeRange.start_date).format("YYYY-MM-DD")).format("X"),finishDate=moment(moment(timeRange.finish_date).format("YYYY-MM-DD")).format("X");currentStartDate>=startDate&&finishDate>=currentStartDate&&finishDate>=currentFinishDate&&currentFinishDate>=startDate&&swal({title:"Time leave is exist!",text:"Do you want view history!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",closeOnConfirm:!0},function(isConfirm){isConfirm?$state.go("loggedIn.timesheetHome.leaveHistory",null,{reload:!0}):($scope.info.start_date=null,$scope.info.finish_date=null)})})}})}}),angular.module("app.loggedIn.TimeSheet.HistoryLeave.Controller",[]).controller("HistoryLeaveController",function($scope,TimeSheetService,$cookieStore,toastr,$state,MODE_ROW,$modal,$stateParams){$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.loadList()},$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.loadList=function(){TimeSheetService.LoadHistoryLeave($scope.searchObjectMap).then(function(response){$scope.list=response,$scope.count=void 0!==response.count&&null!==response.count?response.count:0,$scope.listStatus=response.resultStatus})};var init=function(){$scope.searchObject={limit:5,offset:0,currentPage:1,maxSize:5,USER_ID:$cookieStore.get("userInfo").id,select:{"hr_leave.status_id":""},order:{0:"DESC"}},$scope.rows=MODE_ROW,$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.list={},$scope.loadList()};init(),$scope.view=function(id){var modalInstance=$modal.open({templateUrl:"ViewLeave",controller:function($scope){$scope.idView=id,$scope.clickCancel=function(value){modalInstance.close()},$scope.clickSubmitAgain=function(statusID,leaveID){var info={statusID:statusID,leaveID:leaveID,userID:$cookieStore.get("userInfo").id};TimeSheetService.SubmitOnViewLeave(info).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveHistory",null,{reload:!0}),toastr.success("Submit success!","Success")):"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Submit fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.clickEdit=function(leaveID){modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveCreate",{id:leaveID})}},size:"lg"})},$scope.clickAsc=function(){$scope.searchObjectMap.order[0]="ASC",$scope.loadList()},$scope.clickDesc=function(){$scope.searchObjectMap.order[0]="DESC",$scope.loadList()}}),angular.module("app.loggedIn.TimeSheet.ApproveLeave.Controller",[]).controller("ApproveLeaveController",function($scope,MODE_ROW,$modal,toastr,$state,TimeSheetService,$cookieStore){$scope.listStatus=[{code:2,name:"Awaiting for Approve"},{code:3,name:"Approved"},{code:4,name:"Rejected"},{code:5,name:"Re-submitted"}],$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.loadList()},$scope.loadList=function(){TimeSheetService.LoadLeaveApprove($scope.searchObjectMap).then(function(response){"success"===response.status?($scope.list=response,$scope.count=response.count):"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading leave fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.clickAsc=function(){$scope.searchObjectMap.order[0]="ASC",$scope.loadList()},$scope.clickDesc=function(){$scope.searchObjectMap.order[0]="DESC",$scope.loadList()},$scope.view=function(idView){var modalInstance=$modal.open({templateUrl:"ViewLeaveApprove",controller:function($scope){$scope.idView=idView,$scope.clickCancel=function(value){void 0!==value&&null!==value&&value.isReject===!0?$scope.idView=value.leaveID:modalInstance.close()},$scope.clickReject=function(value){void 0!==value&&null!==value&&value.isReject===!1?$scope.idView="clickReject":void 0!==value&&null!==value&&value.isReject===!0&&TimeSheetService.RejectLeave(value).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.success("Reject leave success!","Success")):"error"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.error("Reject leave fail!","Error")):(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.clickApprove=function(value){TimeSheetService.ApproveLeave(value).then(function(response){"success"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.success("Approve leave success!","Success")):"error"===response.status?(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.error("Approve leave fail!","Error")):(modalInstance.close(),$state.go("loggedIn.timesheetHome.leaveApprove",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},size:"lg"})};var init=function(){$scope.searchObject={limit:5,offset:0,currentPage:1,maxSize:5,USER_ID:$cookieStore.get("userInfo").id,search:{0:null},order:{0:"DESC"},select:{0:null}},$scope.searchObjectMap=angular.copy($scope.searchObject),$scope.list={},$scope.rows=MODE_ROW,$scope.loadList()};init()}),angular.module("app.loggedIn.TimeSheet.ViewLeave.Directive",[]).directive("viewLeave",function(TimeSheetService,$cookieStore){return{restrict:"EA",required:"ngModel",scope:{onCancel:"&",onEdit:"&",onSubmitagain:"&",ngModel:"="},link:function(scope,attrs,elem){scope.$watch("ngModel",function(newModel,oldModel){if(void 0!==newModel&&null!==newModel&&!isNaN(newModel)){var info={leave_id:newModel,user_id:$cookieStore.get("userInfo").id};TimeSheetService.ViewLeave(info).then(function(response){scope.list=response,void 0!==scope.list&&null!==scope.list&&void 0!==scope.list.result&&null!==scope.list.result&&void 0!==scope.list.result[0]&&null!==scope.list.result[0]&&(scope.employee_name=null===scope.list.result[0].FirstName||""===scope.list.result[0].FirstName?null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName:scope.list.result[0].FirstName+" "+(null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName),scope.statusID=scope.list.result[0].task_status_id,scope.is_reject=scope.list.result[0].is_reject)})}})},templateUrl:"modules/TimeSheet/directives/templates/ViewLeave.html"}}),angular.module("app.loggedIn.TimeSheet.ApproveLeave.Directive",[]).directive("viewLeaveapprove",function(TimeSheetService,$cookieStore){return{restrict:"EA",required:"ngModel",scope:{ngModel:"=",onCancel:"&",onReject:"&",onApprove:"&"},link:function(scope,elem,attrs){scope.info={},scope.$watch("ngModel",function(newModel,oldModel){if(void 0===newModel||null===newModel||isNaN(newModel))"clickReject"===newModel&&(scope.info.isReject=!0,scope.info.comments=null);else{scope.info.isReject=!1,scope.info.leaveID=newModel,scope.info.userID=$cookieStore.get("userInfo").id;var info={};info.leave_id=newModel,info.user_id=$cookieStore.get("userInfo").id,TimeSheetService.ViewLeave(info).then(function(response){scope.list=response,void 0!==scope.list&&null!==scope.list&&void 0!==scope.list.result&&null!==scope.list.result&&void 0!==scope.list.result[0]&&null!==scope.list.result[0]&&(scope.employee_name=null===scope.list.result[0].FirstName||""===scope.list.result[0].FirstName?null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName:scope.list.result[0].FirstName+" "+(null===scope.list.result[0].LastName||""===scope.list.result[0].LastName?" ":scope.list.result[0].LastName),scope.statusID=scope.list.result[0].task_status_id,scope.isPermiss=response.isPermiss)})}})},templateUrl:"modules/TimeSheet/directives/templates/ViewLeaveApprove.html"}}),angular.module("app.loggedIn.TimeSheet.ReportOweLeave.Controller",[]).controller("ReportOweLeave",function($scope,localStorageService,StaffService,TimeSheetService,$cookieStore,toastr,$state,$filter){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.position=localStorageService.get("position"),$scope.listDepartmentChoose=[],$scope.listEmployeeChoose=[],$scope.listDept=[],$scope.listEmp=[],$scope.isHavedata=0,$scope.ListNew=function(listNew){TimeSheetService.LoadEmpReport(listNew).then(function(response){if("success"===response.status){var arrayEmp=[];angular.forEach(response.result,function(emp,index){arrayEmp.push({id:emp.Employee_ID,label:emp.FirstName+" "+emp.LastName})}),$scope.listEmp=angular.copy(arrayEmp),$scope.listEmployeeChoose=[]}else"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading employee fail!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})},$scope.getWeekNumber=function(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return weekNo},$scope.changeEmp=function(list){if(void 0!==$scope.dateWeekFrom&&null!==$scope.dateWeekFrom&&""!==$scope.dateWeekFrom&&void 0!==$scope.dateWeekTo&&null!==$scope.dateWeekTo&&""!==$scope.dateWeekTo&&0!==$scope.listEmployeeChoose.length){$scope.isHavedata=1;var info={},weekNoFrom=$scope.dateWeekFrom,weekNoTo=$scope.dateWeekTo;info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),info.weekNoTo=$scope.getWeekNumber(weekNoTo),info.listEMP=angular.copy($scope.listEmployeeChoose),info.USER_ID=$cookieStore.get("userInfo").id,info.weekFrom=$scope.dateWeekFrom,info.weekTo=$scope.dateWeekTo,info.listDept=$scope.listDepartmentChoose,info.weekNoFrom=$scope.getWeekNumber(weekNoFrom),TimeSheetService.LoadReportOweLeave(info).then(function(response){"success"===response.status?$scope.USER_ID=$cookieStore.get("userInfo").id:"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Loading reports fail!","Error")):"null"===response.status?($scope.isHavedata=0,toastr.error("No Data!!!!","Error")):($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))})}},TimeSheetService.LoadDeptReport($cookieStore.get("userInfo").id).then(function(response){"error"===response.status?($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load Department fail!","Error")):"success"===response.status?$scope.listDept=response.result:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Server not response!","Error"))}),$scope.translationTextDept={},$scope.translationTextDept={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Department Selected",selectionOf:"/",nameAddon:"Director"===$scope.position?"Departments":"Department",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Department--",dynamicButtonTextSuffix:"Department Selected"},$scope.searchDept={enableSearch:!0},$scope.searchEmp={enableSearch:!0},$scope.translationTextEmp={},$scope.translationTextEmp={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"Employee Selected",selectionOf:"/",nameAddon:"Director"===$scope.position||"Head of Dept."===$scope.position?"Employees":"Employee",searchPlaceholder:"Search...",buttonDefaultText:"--Choose Employee--",dynamicButtonTextSuffix:"Employee Selected"}}),angular.module("app.loggedIn.TimeSheet.formValidate.Directive",[]).directive("modelValidate",function(){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",modelValidate:"=",formValidate:"="},link:function(scope,elem,attrs){var notiError={maxlength:"Too long!",required:"Field is required!"};scope.$watch("modelValidate",function(newModel,oldModel){void 0!==newModel&&null!==newModel&&0!==newModel.length?attrs.$set("required",!0):attrs.$set("required",!1);var isErr=!1,indexErr=-1;angular.forEach(scope.formValidate,function(valueError,indexError){valueError===!0&&(isErr=!0,indexErr=indexError)}),isErr?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHTML:!0,content:notiError[indexErr]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))}),scope.$watch("ngModel",function(newModel,oldModel){var isErr=!1,indexErr=-1;angular.forEach(scope.formValidate,function(valueError,indexError){valueError===!0&&(isErr=!0,indexErr=indexError)}),isErr?(elem.css("border-color","#F3565D"),elem.hasClass("tooltipstered")&&angular.element(elem).tooltipster("destroy"),angular.element(elem).tooltipster({theme:"tooltip-error-theme",contentAsHTML:!0,content:notiError[indexErr]})):(elem.hasClass("tooltipstered")&&(angular.element(elem).tooltipster("destroy"),angular.element(elem).removeAttr("title")),elem.css("border-color","#ECECEC"))})}}});