angular.module("app.loggedIn.document",["app.loggedIn.document.cat2.controllers","app.loggedIn.document.cat3.controllers","app.loggedIn.document.FA.controllers","app.loggedIn.document.MA.controllers","app.loggedIn.document.IDS.controllers","app.loggedIn.document.gorgonFA.controllers","app.loggedIn.document.gorgonMA.controllers","app.loggedIn.document.gorgonMH.controllers","app.loggedIn.document.gorgonUQ.controllers","app.loggedIn.document.services","app.loggedIn.document.MH.controllers","app.loggedIn.document.MRS.controllers","app.loggedIn.document.SA1.controllers","app.loggedIn.document.SA2.controllers","app.loggedIn.document.COE.controllers","app.loggedIn.document.demo.controllers","app.loggedIn.document.detail.controllers","app.loggedIn.document.addPatient.controllers","app.loggedIn.document.form18.controllers","app.loggedIn.document.newFA.controllers"]).config(function($stateProvider){$stateProvider.state("loggedIn.demo",{url:"/demo",templateUrl:"modules/document/views/DemoDocument.html",controller:"demoController"}).state("loggedIn.Detail",{url:"/detail",templateUrl:"modules/document/views/patientDetail.html",controller:"detailController"}).state("loggedIn.addPatient",{url:"/addPatient",templateUrl:"modules/document/views/addPatient.html",controller:"addPatientController"}).state("loggedIn.COE",{url:"/COE/:patient_id/:cal_id",templateUrl:"modules/document/views/COE.html",controller:"COEController"}).state("loggedIn.category2",{url:"/category2/:patient_id/:cal_id",templateUrl:"modules/document/views/category2.html",controller:"Cat2Controller"}).state("loggedIn.category3",{url:"/category3/:patient_id/:cal_id",templateUrl:"modules/document/views/category3.html",controller:"Cat3Controller"}).state("loggedIn.MA",{url:"/MA/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalAssessment.html",controller:"MAController"}).state("loggedIn.IDS",{url:"/IDS/:patient_id/:cal_id",templateUrl:"modules/document/views/instantScreen.html",controller:"IDSController"}).state("loggedIn.gorgonFA",{url:"/gorgonFA/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonFA.html",controller:"gorgonFAController"}).state("loggedIn.gorgonMA",{url:"/gorgonMA/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonMA.html",controller:"gorgonMAController"}).state("loggedIn.gorgonMH",{url:"/gorgonMH/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonMH.html",controller:"gorgonMHController"}).state("loggedIn.gorgonUQ",{url:"/gorgonUQ/:patient_id/:cal_id",templateUrl:"modules/document/views/gorgonUQ.html",controller:"gorgonUQController"}).state("loggedIn.Form18",{url:"/Form18/:patient_id/:cal_id",templateUrl:"modules/document/views/form18.html",controller:"form18Controller"}).state("loggedIn.MH",{url:"/MH/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalhistory.html",controller:"MHController"}).state("loggedIn.MRS",{url:"/MRS/:patient_id/:cal_id",templateUrl:"modules/document/views/medicalresultsummary.html",controller:"MRSController"}).state("loggedIn.SA1",{url:"/SA1/:patient_id/:cal_id",templateUrl:"modules/document/views/audiogramresults1.html",controller:"SA1Controller"}).state("loggedIn.SA2",{url:"/SA2/:patient_id/:cal_id",templateUrl:"modules/document/views/audiogramresults2.html",controller:"SA2Controller"}).state("loggedIn.FA",{url:"/FA/:patient_id/:cal_id/:fa_id",templateUrl:"modules/document/views/newFunctionalAssessment.html",controller:"newFAController"}).state("loggedIn.newFA",{url:"/newFA/:patient_id/:cal_id/:fa_id",templateUrl:"modules/document/views/functionAssessment.html",controller:"FAController"})}),angular.module("app.loggedIn.document.services",[]).factory("DocumentService",function(Restangular,ConfigService,$state){var documentService={},api=Restangular.all("api");documentService.loadPatient=function(searchObj){var loadPatient=api.all("document/loadPatient");return loadPatient.post({searchObj:searchObj})},documentService.insertCOE=function(info){var insertCOE=api.all("document/insertCOE");return insertCOE.post({info:info})},documentService.updateCOE=function(info){var updateCOE=api.all("document/updateCOE");return updateCOE.post({info:info})},documentService.checkCOE=function(PatientID,calID){var checkCOE=api.all("document/checkCOE");return checkCOE.post({PatientID:PatientID,calID:calID})},documentService.insertFA=function(infoH,infoL,infoD,infoC,fa_id){var insertFA=api.all("document/insertFA");return insertFA.post({infoL:infoL,infoH:infoH,infoD:infoD,infoC:infoC,fa_id:fa_id})},documentService.updateFA=function(infoH,infoL,infoD,infoC){var updateFA=api.all("document/updateFA");return updateFA.post({infoL:infoL,infoH:infoH,infoD:infoD,infoC:infoC})},documentService.checkFA=function(PatientID,calID,FA_ID){var checkFA=api.all("document/checkFA");return checkFA.post({PatientID:PatientID,calID:calID,fa_id:FA_ID})},documentService.checkRating=function(id,age,gender,val){var checkRating=api.all("document/checkRating");return checkRating.post({id:id,age:age,gender:gender,value:val})},documentService.insertMA=function(info){var insertMA=api.all("document/insertMA");return insertMA.post({info:info})},documentService.editMA=function(info){var editMA=api.all("document/editMA");return editMA.post({info:info})},documentService.checkMA=function(PatientID,calID,idC){var checkMA=api.all("document/checkMA");return checkMA.post({PatientID:PatientID,calID:calID,idC:idC})},documentService.loadIDS=function(infoLoad){var loadIDS=api.all("document/loadIDS");return loadIDS.post({info:infoLoad})},documentService.insertIDS=function(infoAdd){var insertIDS=api.all("document/insertIDS");return insertIDS.post({info:infoAdd})},documentService.updateIDS=function(infoUp){var checkIDS=api.all("document/updateIDS");return checkIDS.post({info:infoUp})},documentService.insertUQ=function(info){var insertUQ=api.all("document/insertUQ");return insertUQ.post({info:info})},documentService.updateUQ=function(info){var updateUQ=api.all("document/updateUQ");return updateUQ.post({info:info})},documentService.checkUser=function(PatientID,calID){var checkUser=api.all("document/checkUser");return checkUser.post({PatientID:PatientID,calID:calID})},documentService.insertGorgonFA=function(info){var insertGorgonFA=api.all("document/insertGorgonFA");return insertGorgonFA.post({info:info})},documentService.editGorgonFA=function(info){var edit=api.all("document/editGorgonFA");return edit.post({info:info})},documentService.checkGorgonFA=function(PatientID,calID){var checkGorgonFA=api.all("document/checkGorgonFA");return checkGorgonFA.post({PatientID:PatientID,calID:calID})},documentService.insertGorgonMA=function(info){var insertGorgonMA=api.all("document/insertGorgonMA");return insertGorgonMA.post({info:info})},documentService.editGorgonMA=function(info){var edit=api.all("document/editGorgonMA");return edit.post({info:info})},documentService.checkGorgonMA=function(PatientID,calID){var checkGorgonMA=api.all("document/checkGorgonMA");return checkGorgonMA.post({PatientID:PatientID,calID:calID})},documentService.loadMH=function(infoLoad){var info=api.all("document/loadMH");return info.post({info:infoLoad})},documentService.insertMH=function(infoAdd){var insertMH=api.all("document/insertMH");return insertMH.post({info:infoAdd})},documentService.editMH=function(infoEdit){var editMH=api.all("document/editMH");return editMH.post({info:infoEdit})},documentService.loadMRS=function(infoLoad){var loadMRS=api.all("document/loadMRS");return loadMRS.post({info:infoLoad})},documentService.insertMRS=function(infoAdd){var insertMRS=api.all("document/insertMRS");return insertMRS.post({info:infoAdd})},documentService.editMRS=function(infoEdit){var editMRS=api.all("document/editMRS");return editMRS.post({info:infoEdit})},documentService.loadForm18=function(infoLoad){var loadForm=api.all("document/loadForm18");return loadForm.post({info:infoLoad})},documentService.insertForm18=function(infoAdd){var insertForm18=api.all("document/insertForm18");return insertForm18.post({info:infoAdd})},documentService.editForm18=function(infoEdit){var editForm18=api.all("document/editForm18");return editForm18.post({info:infoEdit})},documentService.loadSA1=function(infoLoad){var loadSA1=api.all("document/loadSA1");return loadSA1.post({info:infoLoad})},documentService.insertSA1=function(infoAdd){var insertSA1=api.all("document/insertSA1");return insertSA1.post({info:infoAdd})},documentService.editSA1=function(infoEdit){var editSA1=api.all("document/editSA1");return editSA1.post({info:infoEdit})},documentService.loadSA2=function(infoLoad){var loadSA2=api.all("document/loadSA2");return loadSA2.post({info:infoLoad})},documentService.insertSA2=function(infoAdd){var insertSA2=api.all("document/insertSA2");return insertSA2.post({info:infoAdd})},documentService.editSA2=function(infoEdit){var editSA2=api.all("document/editSA2");return editSA2.post({info:infoEdit})},documentService.newAUD2=function(){var newAUD2=api.one("document/newAUD2");return newAUD2.get()},documentService.loadAUD2=function(){var loadAUD2=api.one("document/loadAUD2");return loadAUD2.get()},documentService.insertCat2=function(infoAdd){var insertCat2=api.all("document/insertCat2");return insertCat2.post({info:infoAdd})},documentService.loadCat2=function(infoFind){var loadCat2=api.all("document/loadCat2");return loadCat2.post({info:infoFind})},documentService.editCat2=function(infoUp){var editCat2=api.all("document/editCat2");return editCat2.post({info:infoUp})},documentService.loadCat3=function(infoFind){var info=api.all("document/loadCat3");return info.post({info:infoFind})},documentService.insertCat3=function(infoAdd){var info=api.all("document/insertCat3");return info.post({info:infoAdd})},documentService.findCat3=function(ids){var info=api.all("document/findCat3");return info.post({ids:ids})},documentService.editCat3=function(infoUp){var info=api.all("document/editCat3");return info.post({info:infoUp})},documentService.insertUQ=function(info){var insertUQ=api.all("document/insertUQ");return insertUQ.post({info:info})},documentService.loadGGMH=function(infoLoad){var info=api.all("document/loadGGMH");return info.post({info:infoLoad})},documentService.insertGGMH=function(infoAdd){var info=api.all("document/insertGGMH");return info.post({info:infoAdd})},documentService.editGGMH=function(infoUp){var info=api.all("document/editGGMH");return info.post({info:infoUp})},documentService.loadNewHeaderSections=function(fa_id){var info=api.all("document/newHeaderSections");return info.post({fa_id:fa_id})},documentService.loadNewLines=function(section_id,fa_id){var info=api.all("document/newLines");return info.post({section_id:section_id,fa_id:fa_id})},documentService.loadNewCommentsAndDetails=function(line_id){var info=api.all("document/newDetailsComments");return info.post({line_id:line_id})},documentService.autoRating=function(ratingData){var info=api.all("document/autoRating");return info.post({patient_age:ratingData.patient_age,patient_gender:ratingData.patient_gender,valueToRate:ratingData.valueToRate,rating_id:ratingData.rating_id})},documentService.checkExistFA=function(fa_id,patient_id,cal_id){var info=api.all("document/checkExistFA");return info.post({fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistHeaderSections=function(fa_id,patient_id,cal_id){var info=api.all("document/existHeaderSections");return info.post({fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistLines=function(section_id,fa_id,patient_id,cal_id){var info=api.all("document/existLines");return info.post({section_id:section_id,fa_id:fa_id,patient_id:patient_id,cal_id:cal_id})},documentService.loadExistCommentsAndDetails=function(line_id,patient_id,cal_id){var info=api.all("document/existDetailsComments");return info.post({line_id:line_id,patient_id:patient_id,cal_id:cal_id})},documentService.insertNewFA=function(insertData){var insertNewFA=api.all("document/insertNewFA");return insertNewFA.post({insertData:insertData})},documentService.updateNewFA=function(updateData,patient_id,cal_id){var updateNewFA=api.all("document/updateNewFA");return updateNewFA.post({updateData:updateData,patient_id:patient_id,cal_id:cal_id})},documentService.getDoctor=function(appt_info){var getDoctor=api.all("document/getDoctorFA");return getDoctor.post(appt_info)};var strPrefixAPI="api/erm/v2/paperless/";return documentService.optionGorgonMA=function(patient_id){return{api:strPrefixAPI+"gorgon_ma_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"GORGON_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonMA",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonFA=function(patient_id){return{api:strPrefixAPI+"gorgon_fa_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonFA",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonUQ=function(patient_id){return{api:strPrefixAPI+"gorgon_uq_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"Quest_Id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonUQ",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionGorgonMH=function(patient_id){return{api:strPrefixAPI+"gorgon_mh_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"Gorgon_Id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.gorgonMH",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.optionMRS=function(patient_id){return{api:strPrefixAPI+"mrs_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"mrs_id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MRS",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.optionCategory2=function(patient_id){return{api:strPrefixAPI+"category2_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"cat_id",is_hide:!0},{field:"DATE",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.DATE)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.category2",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.optionCategory3=function(patient_id){return{api:strPrefixAPI+"category3_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"cat_id",is_hide:!0},{field:"PATIENT_DATE",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.PATIENT_DATE)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.category3",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.Optionform18=function(patient_id){return{api:strPrefixAPI+"form18_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"GORGON_ID",is_hide:!0},{field:"TIME_TEST",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.TIME_TEST)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.Form18",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionSA1=function(patient_id){return{api:strPrefixAPI+"audiogram1_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"SA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.SA1",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionSA2=function(patient_id){return{api:strPrefixAPI+"audiogram2_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"SA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.SA2",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionMH=function(patient_id){return{api:strPrefixAPI+"medical_history_search",method:"post",columns:[{field:"cal_id",is_hide:!0},{field:"mh_id",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MH",{patient_id:patient_id,cal_id:item.cal_id})}}]}},documentService.OptionCOE=function(patient_id){return{api:strPrefixAPI+"coe_search",method:"post",columns:[{field:"CalId",is_hide:!0},{field:"coe_id",is_hide:!0},{field:"coeDate",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.COE",{patient_id:patient_id,cal_id:item.CalId})}}]}},documentService.OptionIDS=function(patient_id){return{api:strPrefixAPI+"instant_drug_screen_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"IDAS_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.IDS",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService.OptionFA=function(patient_id){return{api:strPrefixAPI+"functional_assessment_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"FA_ID",is_hide:!0},{field:"TYPE",label:"Type"},{field:"FA_NAME",label:"Name"},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.FA",{patient_id:patient_id,cal_id:item.CAL_ID,fa_id:item.FA_ID})}},{"class":"fa fa-print",title:"Print",callback:function(item){window.open("http://testapp.redimed.com.au:3003/RedimedJavaREST/api/document/FA/"+item.FA_ID+"/"+item.CAL_ID+"/"+patient_id)}}]}},documentService.OptionMA=function(patient_id){return{api:strPrefixAPI+"medical_assessment_search",method:"post",columns:[{field:"CAL_ID",is_hide:!0},{field:"MA_ID",is_hide:!0},{field:"Creation_date",label:"Created Date",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.Creation_date)}}],"static":!0,search:{patient_id:patient_id},use_actions:!0,actions:[{"class":"fa fa-pencil",title:"Edit",callback:function(item){$state.go("loggedIn.MA",{patient_id:patient_id,cal_id:item.CAL_ID})}}]}},documentService}),angular.module("app.loggedIn.document.cat2.controllers",[]).controller("Cat2Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$filter,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature},$scope.today=new Date;var patientInfo=localStorageService.get("tempPatient");(null===patientInfo||"undefined"===patientInfo)&&(toastr.error("Load information fail!","Error"),$state.go("loggedIn.home",null,{reload:!0}));var Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={cat_id:null,cal_id:CalID,DocId:null,patient_id:Patient_ID,Signature:null,has_declaration:null,has_safety:null,has_following:null,audiometric:null,q1_4:null,q1_4_c:null,q1_5_1:null,q1_5_2:null,q1_5_3:null,q1_5_3_c:null,q3_1_1:null,q3_1_1_c:null,q3_1_2:null,q3_1_2_c:null,q3_1_3_1:null,q3_1_3_2:null,q3_1_3_3:null,q3_1_3_4:null,q3_1_3_5:null,q3_1_3_6:null,q3_1_3_7:null,q3_1_3_8:null,q3_1_3_9:null,q3_1_3_10:null,q3_1_3_11:null,q3_1_3_12:null,q3_1_3_13:null,q3_1_3_14:null,q3_1_3_15:null,q3_1_3_16:null,q3_1_3_17:null,q3_1_3_18:null,q3_1_3_19:null,q3_1_3_20:null,q3_1_3_21:null,q3_1_3_22:null,q3_1_3_23:null,q3_1_4_1:null,q3_1_4_2:null,q3_1_4_3_1:null,q3_1_4_3_2:null,q3_1_4_3_3:null,q3_1_4_3_4:null,q3_1_4_3_5:null,q3_1_4_3_6:null,q3_1_4_3_7:null,q3_1_4_3_8:null,q3_1_5_1:null,q3_1_5_2:null,q3_1_5_3:null,q3_1_5_4:null,q3_1_5_5:null,q3_1_5_6:null,q3_1_5_7:null,q3_1_5_8:null,q3_1_5_9:null,q3_1_5_10:null,q3_1_6_1:null,q3_1_6_2:null,q3_1_6_3:null,q3_1_6_4:null,q3_1_6_5:null,q3_1_6_6:null,q3_1_6_7:null,q3_1_6_8:null,q3_1_6_9:null,q3_1_6_10:null,q3_1_6_c:null,q3_2:null,q4_2_1_1_1:null,q4_2_1_1_2:null,q4_2_1_2:null,q4_2_1_2_c:null,q4_2_1_3:null,q4_2_1_4:null,q4_2_2:null,q4_2_3:null,q4_2_4_c:null,q4_2_5_1:null,q4_2_5_2:null,q4_2_5_3_1:null,q4_2_5_3_2:null,q4_2_5_4_1:null,q4_2_5_4_2:null,q4_2_5_5:null,q4_2_5_6:null,q4_2_6_1:null,q4_2_6_2:null,q4_2_7_L_1:null,q4_2_7_L_2:null,q4_2_7_L_3:null,q4_2_7_L_4:null,q4_2_7_L_5:null,q4_2_7_L_6:null,q4_2_7_L_7:null,q4_2_7_L_8:null,q4_2_7_R_1:null,q4_2_7_R_2:null,q4_2_7_R_3:null,q4_2_7_R_4:null,q4_2_7_R_5:null,q4_2_7_R_6:null,q4_2_7_R_7:null,q4_2_7_R_8:null,q4_2_7:null,q4_2_8_c:null,q4_2_8_1_c:null,q4_2_8_2_1:null,q4_2_8_2_c:null,q4_2_8_3_1:null,q4_2_8_3_c:null,q4_2_8_4_1:null,q4_2_8_4_c:null,q4_2_8_5_1:null,q4_2_8_5_c:null,q4_2_8_6_1:null,q4_2_8_6_c:null,q4_2_8_7_1:null,q4_2_8_7_c:null,q4_2_8_8_1:null,q4_2_8_8_c:null,q4_2_8_9_1:null,q4_2_8_9_c:null,q4_2_9:0,q4_2_10_1:null,q4_2_10_2:null,q4_2_11:0,q4_2_12_1:0,q4_2_12_2:null,q4_2_13_1_1:null,q4_2_13_1_2:null,q4_2_13_1_3:null,q4_2_13_1_4:null,q4_2_13_1_5:null,q4_2_13_2:null,q4_2_13_3:null,q4_2_13_4:null,q4_2_13_5:null,q4_2_13_6:null,rel_cmt:null,rel_id:null,r1_1:null,r1_2:null,r1_3:null,r1_4_y:null,r1_5:null,r1_6:null,r1_7:null,r1_8:null,r1_8_c:null,r2_1:null,r2_2:null,r2_2_y:null,r2_3:null,r2_4:null,r2_5:null,r2_6:null,r2_7_c:null,r3_1:null,r3_2_c:null,r4_1:null,r4_2_c:null,r5_1:null,r5_2:null,DATE:new Date,DOCTOR_ID:null,Created_by:null,Last_updated_by:null};var oriInfo,info=$scope.info;DocumentService.loadCat2(info).then(function(response){if("fail"===response.status)$state.go("logged.home",null,{reload:!0}),toastr.error("Load fail!","Error");else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.apptInfo=response[0].appt,$scope.info.doctor=response[0].doctor,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].dataCat2,timeAppt=(new Date(response[0].appt.FROM_TIME).getHours()%12<=9?"0"+new Date(response[0].appt.FROM_TIME).getHours()%12:new Date(response[0].appt.FROM_TIME).getHours()%12)+" : "+(new Date(response[0].appt.FROM_TIME).getMinutes()<=9?"0"+new Date(response[0].appt.FROM_TIME).getMinutes():new Date(response[0].appt.FROM_TIME).getMinutes())+(new Date(response[0].appt.FROM_TIME).getHours()>12?" PM":" AM");$scope.info={apptInfo:response[0].appt,patient:response[0].patient,doctor:response[0].doctor,company:response[0].company,timeAppt:timeAppt,cat_id:data.cat_id,cal_id:data.cal_id,DocId:data.DocId,patient_id:data.patient_id,Signature:data.Signature,has_declaration:data.has_declaration,has_safety:data.has_safety,has_following:data.has_following,audiometric:data.audiometric,q1_4:data.q1_4,q1_4_c:data.q1_4_c,q1_5_1:data.q1_5_1,q1_5_2:data.q1_5_2,q1_5_3:data.q1_5_3,q1_5_3_c:data.q1_5_3_c,q3_1_1:data.q3_1_1,q3_1_1_c:data.q3_1_1_c,q3_1_2:data.q3_1_2,q3_1_2_c:data.q3_1_2_c,q3_1_3_1:data.q3_1_3_1,q3_1_3_2:data.q3_1_3_2,q3_1_3_3:data.q3_1_3_3,q3_1_3_4:data.q3_1_3_4,q3_1_3_5:data.q3_1_3_5,q3_1_3_6:data.q3_1_3_6,q3_1_3_7:data.q3_1_3_7,q3_1_3_8:data.q3_1_3_8,q3_1_3_9:data.q3_1_3_9,q3_1_3_10:data.q3_1_3_10,q3_1_3_11:data.q3_1_3_11,q3_1_3_12:data.q3_1_3_12,q3_1_3_13:data.q3_1_3_13,q3_1_3_14:data.q3_1_3_14,q3_1_3_15:data.q3_1_3_15,q3_1_3_16:data.q3_1_3_16,q3_1_3_17:data.q3_1_3_17,q3_1_3_18:data.q3_1_3_18,q3_1_3_19:data.q3_1_3_19,q3_1_3_20:data.q3_1_3_20,q3_1_3_21:data.q3_1_3_21,q3_1_3_22:data.q3_1_3_22,q3_1_3_23:data.q3_1_3_23,q3_1_4_1:data.q3_1_4_1,q3_1_4_2:data.q3_1_4_2,q3_1_4_3_1:data.q3_1_4_3_1,q3_1_4_3_2:data.q3_1_4_3_2,q3_1_4_3_3:data.q3_1_4_3_3,q3_1_4_3_4:data.q3_1_4_3_4,q3_1_4_3_5:data.q3_1_4_3_5,q3_1_4_3_6:data.q3_1_4_3_6,q3_1_4_3_7:data.q3_1_4_3_7,q3_1_4_3_8:data.q3_1_4_3_8,q3_1_5_1:data.q3_1_5_1,q3_1_5_2:data.q3_1_5_2,q3_1_5_3:data.q3_1_5_3,q3_1_5_4:data.q3_1_5_4,q3_1_5_5:data.q3_1_5_5,q3_1_5_6:data.q3_1_5_6,q3_1_5_7:data.q3_1_5_7,q3_1_5_8:data.q3_1_5_8,q3_1_5_9:data.q3_1_5_9,q3_1_5_10:data.q3_1_5_10,q3_1_6_1:data.q3_1_6_1,q3_1_6_2:data.q3_1_6_2,q3_1_6_3:data.q3_1_6_3,q3_1_6_4:data.q3_1_6_4,q3_1_6_5:data.q3_1_6_5,q3_1_6_6:data.q3_1_6_6,q3_1_6_7:data.q3_1_6_7,q3_1_6_8:data.q3_1_6_8,q3_1_6_9:data.q3_1_6_9,q3_1_6_10:data.q3_1_6_10,q3_1_6_c:data.q3_1_6_c,q3_2:data.q3_2,q4_2_1_1_1:data.q4_2_1_1_1,q4_2_1_1_2:data.q4_2_1_1_2,q4_2_1_2:data.q4_2_1_2,q4_2_1_2_c:data.q4_2_1_2_c,q4_2_1_3:data.q4_2_1_3,q4_2_1_4:data.q4_2_1_4,q4_2_2:data.q4_2_2,q4_2_3:data.q4_2_3,q4_2_4_c:data.q4_2_4_c,q4_2_5_1:data.q4_2_5_1,q4_2_5_2:data.q4_2_5_2,q4_2_5_3_1:data.q4_2_5_3_1,q4_2_5_3_2:data.q4_2_5_3_2,q4_2_5_4_1:data.q4_2_5_4_1,q4_2_5_4_2:data.q4_2_5_4_2,q4_2_5_5:data.q4_2_5_5,q4_2_5_6:data.q4_2_5_6,q4_2_6_1:data.q4_2_6_1,q4_2_6_2:data.q4_2_6_2,q4_2_7_L_1:data.q4_2_7_L_1,q4_2_7_L_2:data.q4_2_7_L_2,q4_2_7_L_3:data.q4_2_7_L_3,q4_2_7_L_4:data.q4_2_7_L_4,q4_2_7_L_5:data.q4_2_7_L_5,q4_2_7_L_6:data.q4_2_7_L_6,q4_2_7_L_7:data.q4_2_7_L_7,q4_2_7_L_8:data.q4_2_7_L_8,q4_2_7_R_1:data.q4_2_7_R_1,q4_2_7_R_2:data.q4_2_7_R_2,q4_2_7_R_3:data.q4_2_7_R_3,q4_2_7_R_4:data.q4_2_7_R_4,q4_2_7_R_5:data.q4_2_7_R_5,q4_2_7_R_6:data.q4_2_7_R_6,q4_2_7_R_7:data.q4_2_7_R_7,q4_2_7_R_8:data.q4_2_7_R_8,q4_2_7:data.q4_2_7,q4_2_8_c:data.q4_2_8_c,q4_2_8_1_c:data.q4_2_8_1_c,q4_2_8_2_1:data.q4_2_8_2_1,q4_2_8_2_c:data.q4_2_8_2_c,q4_2_8_3_1:data.q4_2_8_3_1,q4_2_8_3_c:data.q4_2_8_3_c,q4_2_8_4_1:data.q4_2_8_4_1,q4_2_8_4_c:data.q4_2_8_4_c,q4_2_8_5_1:data.q4_2_8_5_1,q4_2_8_5_c:data.q4_2_8_5_c,q4_2_8_6_1:data.q4_2_8_6_1,q4_2_8_6_c:data.q4_2_8_6_c,q4_2_8_7_1:data.q4_2_8_7_1,q4_2_8_7_c:data.q4_2_8_7_c,q4_2_8_8_1:data.q4_2_8_8_1,q4_2_8_8_c:data.q4_2_8_8_c,q4_2_8_9_1:data.q4_2_8_9_1,q4_2_8_9_c:data.q4_2_8_9_c,q4_2_9:data.q4_2_9,q4_2_10_1:data.q4_2_10_1,q4_2_10_2:data.q4_2_10_2,q4_2_11:data.q4_2_11,q4_2_12_1:data.q4_2_12_1,q4_2_12_2:data.q4_2_12_2,q4_2_13_1_1:data.q4_2_13_1_1,q4_2_13_1_2:data.q4_2_13_1_2,q4_2_13_1_3:data.q4_2_13_1_3,q4_2_13_1_4:data.q4_2_13_1_4,q4_2_13_1_5:data.q4_2_13_1_5,q4_2_13_2:data.q4_2_13_2,q4_2_13_3:data.q4_2_13_3,q4_2_13_4:data.q4_2_13_4,q4_2_13_5:data.q4_2_13_5,q4_2_13_6:data.q4_2_13_6,rel_cmt:data.rel_cmt,rel_id:data.rel_id,r1_1:data.r1_1,r1_2:data.r1_2,r1_3:data.r1_3,r1_4_y:data.r1_4_y,r1_5:data.r1_5,r1_6:data.r1_6,r1_7:data.r1_7,r1_8:data.r1_8,r1_8_c:data.r1_8_c,r2_1:data.r2_1,r2_2:data.r2_2,r2_2_y:data.r2_2_y,r2_3:data.r2_3,r2_4:data.r2_4,r2_5:data.r2_5,r2_6:data.r2_6,r2_7_c:data.r2_7_c,r3_1:data.r3_1,r3_2_c:data.r3_2_c,r4_1:data.r4_1,r4_2_c:data.r4_2_c,r5_1:data.r5_1,r5_2:data.r5_2,DATE:data.DATE,DOCTOR_ID:response[0].doctor.DOCTOR_ID,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.cat2Form.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(cat2Form){if(cat2Form.$error.pattern||cat2Form.$error.maxlength||cat2Form.$error.required)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;info.q4_2_9=$scope.info.q3_1_4_3_1+$scope.info.q3_1_4_3_2+$scope.info.q3_1_4_3_3+$scope.info.q3_1_4_3_4+$scope.info.q3_1_4_3_5+$scope.info.q3_1_4_3_6+$scope.info.q3_1_4_3_7+$scope.info.q3_1_4_3_8,info.q4_2_11=$scope.info.q3_1_5_1+$scope.info.q3_1_5_2+$scope.info.q3_1_5_3+$scope.info.q3_1_5_4+$scope.info.q3_1_5_5+$scope.info.q3_1_5_6+$scope.info.q3_1_5_7+$scope.info.q3_1_5_8+$scope.info.q3_1_5_9+$scope.info.q3_1_5_10,info.q4_2_12_1=$scope.info.q3_1_6_1+$scope.info.q3_1_6_2+$scope.info.q3_1_6_3+$scope.info.q3_1_6_4+$scope.info.q3_1_6_5+$scope.info.q3_1_6_6+$scope.info.q3_1_6_7+$scope.info.q3_1_6_8+$scope.info.q3_1_6_9+$scope.info.q3_1_6_10,$scope.isNew===!0?DocumentService.insertCat2(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.category2",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editCat2(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.category2",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}),angular.module("app.loggedIn.document.cat3.controllers",[]).controller("Cat3Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date;var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.PATIENT_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.PATIENT_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.PATIENT_SIGNATURE};var tempPatient=localStorageService.get("tempPatient");if("undefined"===tempPatient||null==tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={cat_id:null,cal_id:cal_id,patient_id:patient_id,has_declaration:null,has_following:null,audiometric:null,q1_4:null,q1_4_c:null,q1_5_1:null,q1_5_2:null,q1_5_3:null,s3_q1_1_1:null,s3_q1_1_2:null,s3_q1_2_1:null,s3_q1_2_2:null,s3_q1_3:null,
s3_q1_4:null,s3_q2_1_1:null,s3_q2_1_2:null,s3_q2_1_3:null,s3_q2_1_4:null,s3_q2_1_5:null,s3_q2_1_6:null,s3_q2_1_7:null,s3_q2_1_8:null,s3_q2_2_1:null,s3_q2_2_2:null,s3_q2_2_3:null,s3_q2_2_4:null,s3_q2_2_5:null,s3_q2_2_6:null,s3_q2_2_7:null,s3_q2_2_8:null,s3_q2_3:null,s3_q3_1:null,s3_q3_2:null,s3_q3_3_1:null,s3_q3_3_2:null,s3_q3_4_1:null,s3_q3_4_2:null,s3_q3_5:null,s3_q3_6:null,s3_q4:null,s3_q5_1_1_1:null,s3_q5_1_1_2:null,s3_q5_1_1_3:null,s3_q5_1_1_4:null,s3_q5_1_2:null,s3_q5_2:null,s3_q5_3:null,s3_q5_4:null,s3_q5_5:null,s3_q5_6:null,s3_q6_c:null,s3_q6_1:null,s3_q6_2_1:null,s3_q6_2_2:null,s3_q6_3_1:null,s3_q6_3_2:null,s3_q6_4_1:null,s3_q6_4_2:null,s3_q6_5_1:null,s3_q6_5_2:null,s3_q6_6_1:null,s3_q6_6_2:null,s3_q6_7_1:null,s3_q6_7_2:null,s3_q6_8_1:null,s3_q6_8_2:null,s3_q6_9_1:null,s3_q6_9_2:null,s3_q7_1:null,s3_q7_2:null,s4_c:null,s4_1:null,s4_2:null,r1_1:null,r1_2:null,r1_3:null,r1_4_y:null,r1_5:null,r1_6:null,r1_7:null,r1_8:null,r1_8_c:null,r2_1:null,r2_2:null,r2_2_y:null,r2_3:null,r2_4:null,r2_5:null,r2_6:null,r2_7_c:null,r3_1:null,r3_2_c:null,r4_1:null,r4_2_c:null,r5_1:null,r5_2:null,DocId:null,q1_5_3_c:null,PATIENT_SIGNATURE:null,PATIENT_DATE:new Date,DOCTOR_ID:null,Created_by:null,Last_updated_by:null};var oriInfo,info=$scope.info;DocumentService.loadCat3(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.apptInfo=response[0].appt,$scope.info.doctor=response[0].doctor,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){var data=response[0].data;$scope.isNew=!1;var timeAppt=(new Date(response[0].appt.FROM_TIME).getHours()%12<=9?"0"+new Date(response[0].appt.FROM_TIME).getHours()%12:new Date(response[0].appt.FROM_TIME).getHours()%12)+" : "+(new Date(response[0].appt.FROM_TIME).getMinutes()<=9?"0"+new Date(response[0].appt.FROM_TIME).getMinutes():new Date(response[0].appt.FROM_TIME).getMinutes())+(new Date(response[0].appt.FROM_TIME).getHours()>12?" PM":" AM");$scope.info={timeAppt:timeAppt,apptInfo:response[0].appt,patient:response[0].patient,doctor:response[0].doctor,company:response[0].company,cat_id:data.cat_id,cal_id:data.cal_id,patient_id:data.patient_id,has_declaration:data.has_declaration,has_following:data.has_following,audiometric:data.audiometric,q1_4:data.q1_4,q1_4_c:data.q1_4_c,q1_5_1:data.q1_5_1,q1_5_2:data.q1_5_2,q1_5_3:data.q1_5_3,s3_q1_1_1:data.s3_q1_1_1,s3_q1_1_2:data.s3_q1_1_2,s3_q1_2_1:data.s3_q1_2_1,s3_q1_2_2:data.s3_q1_2_2,s3_q1_3:data.s3_q1_3,s3_q1_4:data.s3_q1_4,s3_q2_1_1:data.s3_q2_1_1,s3_q2_1_2:data.s3_q2_1_2,s3_q2_1_3:data.s3_q2_1_3,s3_q2_1_4:data.s3_q2_1_4,s3_q2_1_5:data.s3_q2_1_5,s3_q2_1_6:data.s3_q2_1_6,s3_q2_1_7:data.s3_q2_1_7,s3_q2_1_8:data.s3_q2_1_8,s3_q2_2_1:data.s3_q2_2_1,s3_q2_2_2:data.s3_q2_2_2,s3_q2_2_3:data.s3_q2_2_3,s3_q2_2_4:data.s3_q2_2_4,s3_q2_2_5:data.s3_q2_2_5,s3_q2_2_6:data.s3_q2_2_6,s3_q2_2_7:data.s3_q2_2_7,s3_q2_2_8:data.s3_q2_2_8,s3_q2_3:data.s3_q2_3,s3_q3_1:data.s3_q3_1,s3_q3_2:data.s3_q3_2,s3_q3_3_1:data.s3_q3_3_1,s3_q3_3_2:data.s3_q3_3_2,s3_q3_4_1:data.s3_q3_4_1,s3_q3_4_2:data.s3_q3_4_2,s3_q3_5:data.s3_q3_5,s3_q3_6:data.s3_q3_6,s3_q4:data.s3_q4,s3_q5_1_1_1:data.s3_q5_1_1_1,s3_q5_1_1_2:data.s3_q5_1_1_2,s3_q5_1_1_3:data.s3_q5_1_1_3,s3_q5_1_1_4:data.s3_q5_1_1_4,s3_q5_1_2:data.s3_q5_1_2,s3_q5_2:data.s3_q5_2,s3_q5_3:data.s3_q5_3,s3_q5_4:data.s3_q5_4,s3_q5_5:data.s3_q5_5,s3_q5_6:data.s3_q5_6,s3_q6_c:data.s3_q6_c,s3_q6_1:data.s3_q6_1,s3_q6_2_1:data.s3_q6_2_1,s3_q6_2_2:data.s3_q6_2_2,s3_q6_3_1:data.s3_q6_3_1,s3_q6_3_2:data.s3_q6_3_2,s3_q6_4_1:data.s3_q6_4_1,s3_q6_4_2:data.s3_q6_4_2,s3_q6_5_1:data.s3_q6_5_1,s3_q6_5_2:data.s3_q6_5_2,s3_q6_6_1:data.s3_q6_6_1,s3_q6_6_2:data.s3_q6_6_2,s3_q6_7_1:data.s3_q6_7_1,s3_q6_7_2:data.s3_q6_7_2,s3_q6_8_1:data.s3_q6_8_1,s3_q6_8_2:data.s3_q6_8_2,s3_q6_9_1:data.s3_q6_9_1,s3_q6_9_2:data.s3_q6_9_2,s3_q7_1:data.s3_q7_1,s3_q7_2:data.s3_q7_2,s4_c:data.s4_c,s4_1:data.s4_1,s4_2:data.s4_2,r1_1:data.r1_1,r1_2:data.r1_2,r1_3:data.r1_3,r1_4_y:data.r1_4_y,r1_5:data.r1_5,r1_6:data.r1_6,r1_7:data.r1_7,r1_8:data.r1_8,r1_8_c:data.r1_8_c,r2_1:data.r2_1,r2_2:data.r2_2,r2_2_y:data.r2_2_y,r2_3:data.r2_3,r2_4:data.r2_4,r2_5:data.r2_5,r2_6:data.r2_6,r2_7_c:data.r2_7_c,r3_1:data.r3_1,r3_2_c:data.r3_2_c,r4_1:data.r4_1,r4_2_c:data.r4_2_c,r5_1:data.r5_1,r5_2:data.r5_2,DocId:data.DocId,q1_5_3_c:data.q1_5_3_c,PATIENT_SIGNATURE:data.PATIENT_SIGNATURE,PATIENT_DATE:data.PATIENT_DATE,DOCTOR_ID:response[0].doctor.DOCTOR_ID,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.category3Form.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(category3Form){if(category3Form.$error.pattern||category3Form.$error.maxlength)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertCat3(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.category3",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editCat3(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.category3",null,{reload:!0})):"fail"===response.status?toastr.error("Update fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})})}}}}}),angular.module("app.loggedIn.document.FA.controllers",[]).controller("FAController",function($scope,$filter,$timeout,$state,ConfigService,DocumentService,$stateParams,localStorageService,$http,$cookieStore,toastr){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}var oriInfoH,oriInfoL,oriInfoD,oriInfoC,tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.infoH.ASSESSED_SIGN=tempSignature},$scope.clearClick=function(){$scope.infoH.ASSESSED_SIGN=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.infoH.ASSESSED_SIGN},$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,FA_ID=$stateParams.fa_id;$scope.listFA=[],$scope.infoH={},$scope.infoL={},$scope.infoS={},$scope.infoD={},$scope.infoC={},$scope.manage={},$scope.a={},$scope.total={};var rateTotal,value={},totalArr=[],age=getAge($scope.patientInfo.DOB),gender=$scope.patientInfo.Sex,val=0,sum=0,avg=0,total=0,dem=0;$scope.age=age;{var date=new Date;$filter("date")(date,"ddMMyy")}$scope.rate=function(id){val=$scope.infoL.RATING_VALUE1[id],$scope.infoL.RATE1[id]=1==val?"Poor":2==val?"Fair":3==val?"Good":4==val?"Excellent":"",rateTotalFunction(id)};var rateTotalFunction=function(id){console.log("this is id",id),rateTotal=[],dem=0,console.log("this is total array",totalArr);for(var i in totalArr){total=0;for(var j in totalArr[i])"rating"!=j&&(j==id&&(totalArr[i][j]=$scope.infoL.RATING_VALUE1[id]),total+=1*totalArr[i][j]);$scope.infoL.RATING_VALUE1[i]=total,DocumentService.checkRating(totalArr[i].rating,age,gender,total).then(function(response){if("fail"!=response.status&&response.length>0){rateTotal.push(response[0].RATE),dem=0;for(var k in totalArr){for(var t=0;t<rateTotal.length;t++)t==dem&&($scope.infoL.RATE1[k]=rateTotal[t]);dem++}}else $scope.infoL.RATE1[i]=""})}};$scope.mathScore=function(idD,idL,score1,rating1,score2,rating2,type1,type2,rating_id,lineQuestion){if(1==score1)if(1==rating1){if(3==type1){sum=0,avg=0,value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])sum+=1*value[idL][i],avg++;val=sum/avg,$scope.infoL.SCORE1[idL]=val}else if(10==type1){console.log("this is idL",value[idL]);var max=0;value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])value[idL][i]>max&&(max=value[idL][i]);val=max,$scope.infoL.SCORE1[idL]=val}else 4==type1?"Recovery 1 min"===lineQuestion&&(val=$scope.infoD.VAL1_VALUE[idD]):6==type1&&(val=$scope.infoD.VAL1_VALUE[idD]);if(DocumentService.checkRating(rating_id,age,gender,val).then(function(response){console.log("this is response 1",response),"success"===response.status&&response.data.length>0?(console.log("this is response",response),$scope.infoL.RATING_VALUE1[idL]=response.data[0].VALUE,$scope.infoL.RATE1[idL]=response.data[0].RATE,console.log("this is response",response),rateTotalFunction(idL)):($scope.infoL.RATING_VALUE1[idL]=null,$scope.infoL.RATE1[idL]="",rateTotalFunction(idL))}),1==score2&&1==rating2&&3==type2){sum=0,avg=0,val=0,value[idL]||(value[idL]=[]),value[idL][idD]=$scope.infoD.VAL2_VALUE[idD];for(var i in value[idL])sum+=1*value[idL][i],avg++;val=sum/avg,$scope.infoL.SCORE2[idL]=val,DocumentService.checkRating(rating_id,age,gender,val).then(function(response){"success"===response.status&&response.data.length>0?($scope.infoL.RATING_VALUE2[idL]=response.data[0].VALUE,$scope.infoL.RATE2[idL]=response.data[0].RATE):($scope.infoL.RATING_VALUE2[idL]=null,$scope.infoL.RATE2[idL]="")})}}else if(0==rating1&&9==type1){var max=0;value[idL]||(value[idL]=[]),value[idL][idD]=1*$scope.infoD.VAL1_VALUE[idD];for(var i in value[idL])value[idL][i]>max&&(max=value[idL][i]);$scope.manage[idL]=max}},$scope.infoH={PATIENT_ID:Patient_ID,CAL_ID:CalID,FA_ID:FA_ID,ENTITY_ID:null,FA_TYPE:null,FA_NAME:null,ISENABLE:null,Created_by:null,Last_updated_by:null,Risk:null,Comments:null,Recommend:null,Att_Flexibility:0,Att_Core_Stability:0,Att_Wirst_Elbow_func:0,Att_Shoulder_func:0,Att_Lower_Limb_func:0,Att_Balance:0,ASSESSED_ID:null,ASSESSED_SIGN:null,ASSESSED_DATE:null,ASSESSED_NAME:null,ITEM_ID:null},oriInfoH=angular.copy($scope.infoH),$scope.infoL={SCORE1:{},RATING_VALUE1:{},COMMENTS:{},SCORE2:{},RATING_VALUE2:{},RATE1:{},RATE2:{}},$scope.infoD={VAL1_VALUE:{},VAL1_CHECKBOX:{},VAL2_VALUE:{},VAL2_CHECKBOX:{},COMMENTS:{}},$scope.infoC.VALUE={},$scope.resetForm=function(){$scope.infoH=angular.copy(oriInfoH),$scope.infoL=angular.copy(oriInfoL),$scope.infoD=angular.copy(oriInfoD),$scope.infoC.VALUE=angular.copy(oriInfoC),$scope.FAForm.$setPristine()},$scope.infoChanged=function(){return 0==!angular.equals(oriInfoH,$scope.infoH)&&0==!angular.equals(oriInfoL,$scope.infoL)&&0==!angular.equals(oriInfoD,$scope.infoD)&&0==!angular.equals(oriInfoC,$scope.infoC.VALUE)?!1:!0};var insert=!0;DocumentService.checkFA($scope.infoH.PATIENT_ID,$scope.infoH.CAL_ID,$scope.infoH.FA_ID).then(function(response){if(console.log(response),"new"===response.status)$scope.isNew=!0,insert=!0,oriInfoH=angular.copy($scope.infoH),oriInfoL=angular.copy($scope.infoL),oriInfoD=angular.copy($scope.infoD),oriInfoC=angular.copy($scope.infoC.VALUE);else{if("update"!==response.status)return void toastr.error("Fail","Error");$scope.isNew=!1,insert=!1}{var data=response.data[0],dataH=data.Header[0];data.Section}$scope.listFA.push({header_name:dataH.FA_NAME,section:[]});var i=0;angular.forEach(data.Section,function(dataS){$scope.listFA[0].section.push({section_id:dataS.SECTION_ID,section_name:dataS.SECTION_NAME,line:[]});var j=0;angular.forEach(data.Line,function(dataL){dataL.SECTION_ID==$scope.listFA[0].section[i].section_id&&($scope.listFA[0].section[i].line.push({line_id:dataL.LINE_ID,image:dataL.PICTURE,rating_id1:dataL.RATING_ID1,rating_id2:dataL.RATING_ID2,line_name:dataL.QUESTION,line_type:dataL.LineType,line_comment:dataL.IsCommentsText,line_isscore1:dataL.ISSCORE1,line_isscore2:dataL.ISSCORE2,line_israting1:dataL.ISRATING1,line_israting2:dataL.ISRATING2,score_type1:dataL.SCORE_TYPE1,score_type2:dataL.SCORE_TYPE2,detail:[],comment:[]}),0==insert&&($scope.infoL.COMMENTS[dataL.LINE_ID]=dataL.COMMENTS,$scope.infoL.SCORE1[dataL.LINE_ID]=dataL.SCORE1,$scope.infoL.SCORE2[dataL.LINE_ID]=dataL.SCORE2,$scope.infoL.RATING_VALUE1[dataL.LINE_ID]=dataL.RATING_VALUE1,$scope.infoL.RATING_VALUE2[dataL.LINE_ID]=dataL.RATING_VALUE2,$scope.infoL.RATE1[dataL.LINE_ID]=dataL.RATE1,$scope.infoL.RATE2[dataL.LINE_ID]=dataL.RATE2,value[dataL.LINE_ID]={}),angular.forEach(data.Detail,function(dataD){dataD.LINE_ID==$scope.listFA[0].section[i].line[j].line_id&&($scope.listFA[0].section[i].line[j].detail.push({detail_id:dataD.DETAIL_ID,image:dataD.PICTURE,detail_name:dataD.QUESTION,val1_yes:dataD.VAL1_ISCOMMENT_WHEN_YES,val1_no:dataD.VAL1_ISCOMMENT_WHEN_NO,val2_yes:dataD.VAL2_ISCOMMENT_WHEN_YES,val2_no:dataD.VAL2_ISCOMMENT_WHEN_NO,val1Validate:dataD.VAL1_VALUE_IS_NUMBER,val2Validate:dataD.VAL2_VALUE_IS_NUMBER,val1_name:dataD.VAL1_NAME,val2_name:dataD.VAL2_NAME,val1_isvalue:dataD.VAL1_ISVALUE,val2_isvalue:dataD.VAL2_ISVALUE,val1_ischeckbox:dataD.VAL1_ISCHECKBOX,val2_ischeckbox:dataD.VAL2_ISCHECKBOX,comment_text:dataD.IsCommentText,summary:dataD.LineTestRefer}),0==insert&&($scope.infoD.COMMENTS[dataD.DETAIL_ID]=dataD.COMMENTS,$scope.infoD.VAL1_CHECKBOX[dataD.DETAIL_ID]=dataD.VAL1_CHECKBOX,$scope.infoD.VAL2_CHECKBOX[dataD.DETAIL_ID]=dataD.VAL2_CHECKBOX,$scope.infoD.VAL2_VALUE[dataD.DETAIL_ID]=dataD.VAL2_VALUE,$scope.infoD.VAL1_VALUE[dataD.DETAIL_ID]=dataD.VAL1_VALUE,value[dataL.LINE_ID][dataD.DETAIL_ID]=[dataD.VAL1_VALUE,dataD.VAL2_VALUE],1==dataL.ISSCORE1&&0==dataL.ISRATING1&&9==dataL.SCORE_TYPE1&&$scope.mathScore(dataD.DETAIL_ID,dataL.LINE_ID,1,0,null,null,9,null,null),null!=dataD.LineTestRefer&&(totalArr[dataD.LINE_ID]||(totalArr[dataD.LINE_ID]=[]),totalArr[dataD.LINE_ID][dataD.LineTestRefer]=dataD.VAL1_VALUE,totalArr[dataD.LINE_ID].rating=dataL.RATING_ID1,rateTotalFunction(dataD.LINE_ID))))}),angular.forEach(data.Comment,function(dataC){dataC.LINE_ID==$scope.listFA[0].section[i].line[j].line_id&&($scope.listFA[0].section[i].line[j].comment.push({comment_id:dataC.FA_COMMENT_ID,comment_name:dataC.NAME,comment_type:dataC.Comment_Type}),0==insert&&($scope.infoC.VALUE[dataC.FA_COMMENT_ID]=dataC.VALUE))}),j++)}),i++}),0==insert&&($scope.infoH={PATIENT_ID:dataH.PATIENT_ID,CAL_ID:dataH.CAL_ID,FA_ID:dataH.FA_ID,ENTITY_ID:dataH.ENTITY_ID,Created_by:dataH.Created_by,Creation_date:dataH.Creation_date,Last_updated_by:dataH.Last_updated_by,Last_update_date:dataH.Last_update_date,Risk:dataH.Risk,Comments:dataH.Comments,Recommend:dataH.Recommend,Att_Flexibility:dataH.Att_Flexibility,Att_Core_Stability:dataH.Att_Core_Stability,Att_Wirst_Elbow_func:dataH.Att_Wirst_Elbow_func,Att_Shoulder_func:dataH.Att_Shoulder_func,Att_Lower_Limb_func:dataH.Att_Lower_Limb_func,Att_Balance:dataH.Att_Balance,ASSESSED_ID:dataH.ASSESSED_ID,ASSESSED_SIGN:dataH.ASSESSED_SIGN,ASSESSED_DATE:dataH.ASSESSED_DATE,ASSESSED_NAME:dataH.ASSESSED_NAME,ITEM_ID:dataH.ITEM_ID},oriInfoH=angular.copy($scope.infoH),oriInfoL=angular.copy($scope.infoL),oriInfoD=angular.copy($scope.infoD),oriInfoC=angular.copy($scope.infoC.VALUE))}),$scope.submitFA=function(FAForm){$scope.showClickedValidation=!0,FAForm.$invalid?toastr.error("Please Input All Required Information!","Error"):1==insert?(console.log($scope.infoH),console.log($scope.infoL),console.log($scope.infoD),console.log($scope.infoC),DocumentService.insertFA($scope.infoH,$scope.infoL,$scope.infoD,$scope.infoC,FA_ID).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.FA",null,{reload:!0})):toastr.error("Fail","Error")})):DocumentService.updateFA($scope.infoH,$scope.infoL,$scope.infoD,$scope.infoC).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.FA",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.MA.controllers",["fcsa-number"]).controller("MAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}$scope.dateOptions={formatYear:"yy",startingDay:1};var Patient_ID,CalID,oriInfo,clearInfo,sex,date,value;$scope.patientInfo=localStorageService.get("tempPatient"),CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id,sex=$scope.patientInfo.Sex,$scope.patientInfo.DOB=$filter("date")($scope.patientInfo.DOB,"dd/MM/yyyy"),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.MAForm.$setPristine()},$scope.clearForm=function(){$scope.info=angular.copy(clearInfo),$scope.MAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.infoClear=function(){return!angular.equals(clearInfo,$scope.info)},$scope.getColor=function(err){return $scope.showClickedValidation&&err?"red":void 0},$scope.Ratio=function(){value=$scope.info.WAIST/$scope.info.HIP,value>0&&100>value&&($scope.info.WHR=value.toFixed(2))};var weight,height;$scope.mathBMI=function(){height=$scope.info.HEIGHT,weight=$scope.info.WEIGHT,value=1e4*weight/(height*height),value=value.toFixed(1),value>0&&300>value?($scope.info.BMI=value,18.5>value?$scope.info.IS_BMI=0:value>=18.5&&24.9>=value?$scope.info.IS_BMI=1:value>=25&&29.9>=value?$scope.info.IS_BMI=2:value>=30&&($scope.info.IS_BMI=3)):($scope.info.BMI=null,$scope.info.IS_BMI=null)};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.COMMENT_SEC10=(null!=$scope.info.COMMENT_SEC4&&""!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4+"\n":"")+(null!=$scope.info.COMMENT_SEC5&&""!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5+"\n":"")+(null!=$scope.info.COMMENT_SEC6&&""!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6+"\n":"")+(null!=$scope.info.COMMENT_SEC7&&""!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7+"\n":"")+(null!=$scope.info.COMMENT_SEC8&&""!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8+"\n":"")+(null!=$scope.info.COMMENT_SEC9&&""!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9+"\n":"")+totalCom},$scope.totalComment=function(){$scope.info.COMMENT_SEC10||($scope.info.COMMENT_SEC10=(null!=$scope.info.COMMENT_SEC4&&""!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4+"\n":"")+(null!=$scope.info.COMMENT_SEC5&&""!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5+"\n":"")+(null!=$scope.info.COMMENT_SEC6&&""!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6+"\n":"")+(null!=$scope.info.COMMENT_SEC7&&""!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7+"\n":"")+(null!=$scope.info.COMMENT_SEC8&&""!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8+"\n":"")+(null!=$scope.info.COMMENT_SEC9&&""!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9+"\n":"")),len=(null!=$scope.info.COMMENT_SEC4?$scope.info.COMMENT_SEC4.length:0)+(null!=$scope.info.COMMENT_SEC5?$scope.info.COMMENT_SEC5.length:0)+(null!=$scope.info.COMMENT_SEC6?$scope.info.COMMENT_SEC6.length:0)+(null!=$scope.info.COMMENT_SEC7?$scope.info.COMMENT_SEC7.length:0)+(null!=$scope.info.COMMENT_SEC8?$scope.info.COMMENT_SEC8.length:0)+(null!=$scope.info.COMMENT_SEC9?$scope.info.COMMENT_SEC9.length:0),str=$scope.info.COMMENT_SEC10.replace("\n","");for(var i=0;5>i;i++)str=str.replace("\n","");totalCom=str.substr(len)};var insert=!0;DocumentService.checkMA(Patient_ID,CalID,$scope.patientInfo.company_id).then(function(response){"insert"===response.status?(insert=!0,$scope.isNew=!0,date=new Date,$scope.sites=response.site,$scope.info={PATIENT_ID:Patient_ID,CAL_ID:CalID,STICKER:null,HEIGHT:null,WEIGHT:null,BMI:null,WAIST:null,HIP:null,WHR:null,IS_BMI:null,BLOOD_SEC1:null,IS_BLOOD:null,RESTING_HEART_RATE:null,IS_RESTING_HEART_RATE:null,HEART_SOUNDS:null,PERIPHERAL:null,VEINS_OTHER:null,COMMENT_SEC1:null,RIGHT_DIST:null,RIGHT_DIST_CORRECT:null,LEFT_DIST:null,LEFT_DIST_CORRECT:null,RIGHT_NEAR:null,RIGHT_NEAR_CORRECT:null,LEFT_NEAR:null,LEFT_NEAR_CORRECT:null,COLOUR_SEC2:null,SCORE_SEC2:null,PERIPHERAL_SEC2:null,VISUAL_AIDS:null,COMMENT_SEC2:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,BLOOD_SUGAR_LEVEL:null,COMMENT_SEC3:null,SPIROMETRY:null,SYMMETRICAL:null,AUSCULTATION:null,EARS:null,HEARING:null,NOSE:null,THROAT:null,TEETH_GUMS:null,SKIN:null,DRUG:null,NAIL:null,SCAR:null,ABDOMEN:null,HERNIAL:null,LIVER:null,SPLEEN:null,KIDNEYS:null,BALANCE:null,COORDINATION:null,LYMPH:null,THYROID:null,COMMENT_SEC4:null,COMMENT_SEC5:null,COMMENT_SEC6:null,COMMENT_SEC7:null,COMMENT_SEC8:null,COMMENT_SEC9:"",AGE:getAge($scope.patientInfo.DOB),HYPER:0,SMOKER:0,KNOW:0,SEDENTARY:0,FAMILY:0,HISTORY:0,OBESITY:0,RISK:null,ECG:null,ECG_RESULT:null,GP:null,COMMENT_SEC10:null,DOCTOR_ID:response.docID,DOCTOR_NAME:response.docName,SIGN:response.docSign,LOCATION:null,Created_by:null,Creation_date:date,Last_updated_by:null,Last_update_date:null,DF_CODE:null,ISENABLE:null},$scope.companyName=response.nameCompany,oriInfo=angular.copy($scope.info)):"fail"===response.status?(toastr.error("Fail!","Fail"),$state.go("loggedIn.demo",null,{reload:!0})):"error"===response.status?(toastr.error("Error!","Error"),$state.go("loggedIn.demo",null,{reload:!0})):"update"===response.status&&(insert=!1,$scope.isNew=!1,$scope.companyName=response.nameCompany,$scope.sites=response.site,$scope.info=angular.copy(response.data),$scope.info.DOCTOR_NAME=response.docName,$scope.info.SIGN=response.docSign,$scope.totalComment(),oriInfo=angular.copy($scope.info)),clearInfo=1==$scope.isNew?angular.copy($scope.info):{PATIENT_ID:Patient_ID,CAL_ID:CalID,STICKER:null,HEIGHT:null,WEIGHT:null,BMI:null,WAIST:null,HIP:null,WHR:null,IS_BMI:null,BLOOD_SEC1:null,IS_BLOOD:null,RESTING_HEART_RATE:null,IS_RESTING_HEART_RATE:null,HEART_SOUNDS:null,PERIPHERAL:null,VEINS_OTHER:null,COMMENT_SEC1:null,RIGHT_DIST:null,RIGHT_DIST_CORRECT:null,LEFT_DIST:null,LEFT_DIST_CORRECT:null,RIGHT_NEAR:null,RIGHT_NEAR_CORRECT:null,LEFT_NEAR:null,LEFT_NEAR_CORRECT:null,COLOUR_SEC2:null,SCORE_SEC2:null,PERIPHERAL_SEC2:null,VISUAL_AIDS:null,COMMENT_SEC2:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,BLOOD_SUGAR_LEVEL:null,COMMENT_SEC3:null,SPIROMETRY:null,SYMMETRICAL:null,AUSCULTATION:null,EARS:null,HEARING:null,NOSE:null,THROAT:null,TEETH_GUMS:null,SKIN:null,DRUG:null,NAIL:null,SCAR:null,ABDOMEN:null,HERNIAL:null,LIVER:null,SPLEEN:null,KIDNEYS:null,BALANCE:null,COORDINATION:null,LYMPH:null,THYROID:null,COMMENT_SEC4:null,COMMENT_SEC5:null,COMMENT_SEC6:null,COMMENT_SEC7:null,COMMENT_SEC8:null,COMMENT_SEC9:"",AGE:getAge($scope.patientInfo.DOB),HYPER:0,SMOKER:0,KNOW:0,SEDENTARY:0,FAMILY:0,HISTORY:0,OBESITY:0,RISK:null,ECG:null,ECG_RESULT:null,GP:null,COMMENT_SEC10:null,DOCTOR_ID:response.docID,DOCTOR_NAME:response.docName,SIGN:response.docSign,Created_by:null,Creation_date:date,Last_updated_by:null,Last_update_date:null,DF_CODE:null,ISENABLE:null}}),$scope.submitMA=function(MAForm){$scope.showClickedValidation=!0,MAForm.$invalid?toastr.error("Please Input All Required Information!","Error"):1==insert?DocumentService.insertMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.MA",null,{reload:!0})):toastr.error("Add new fail!","Error")}):DocumentService.editMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.MA",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}),angular.module("app.loggedIn.document.IDS.controllers",[]).controller("IDSController",function($scope,$state,DocumentService,$http,$cookieStore,$stateParams,toastr,localStorageService,$state){var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.headers[0].SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.headers[0].SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.headers[0].SIGNATURE};var patientInfo=localStorageService.get("tempPatient"),Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={PATIENT_ID:Patient_ID,CAL_ID:CalID};var oriInfo,info=$scope.info;DocumentService.loadIDS(info).then(function(response){"fail"==response.status?($state.go("loggedIn.IDS",null,{reload:!0}),toastr.error("Load information fail!","Error")):"findNull"==response[0].status?$scope.isNew=!0:"findFound"==response[0].status?$scope.isNew=!1:($state.go("loggedIn.IDS",null,{reload:!0}),toastr.error("Error not status!","Error"));var data=response[0];$scope.info.headers=[],$scope.patientInfo=response[0].patient,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({IDAS_ID:dataH.IDAS_DF_ID||dataH.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,DOCTOR_ID:response[0].doctor.doctor_id,DF_CODE:dataH.DF_CODE,NAME:dataH.NAME,IDAS_DATE:dataH.IDAS_DATE||new Date,Temperature:dataH.Temperature,Creatinine:dataH.Creatinine,Drug_Test_Time:dataH.Drug_Test_Time,Expiry_Date:dataH.Expiry_Date||new Date,Notes:dataH.Notes,Alcohol_Test_Time:dataH.Alcohol_Test_Time,Reading:dataH.Reading,Positive_Negative:dataH.Positive_Negative,Reading2:dataH.Reading2,ITEM_ID:dataH.ITEM_ID,Created_by:dataH.Created_by,Last_updated_by:dataH.Last_updated_by,NAME_COMMENT:dataH.NAME_COMMENT,ISENABLE:dataH.ISENABLE,SIGNATURE:dataH.SIGNATURE,TesterName:response[0].doctor.NAME,TesterSign:response[0].doctor.Signature,TesterDate:dataH.TesterDate||new Date,groups:[]});var i=0;angular.forEach(data.groups,function(dataG,gIndex){($scope.info.headers[hIndex].IDAS_ID==dataG.IDAS_ID||$scope.info.headers[hIndex].IDAS_ID==dataG.IDAS_DF_ID)&&($scope.info.headers[hIndex].groups.push({IDAS_GROUP_ID:dataG.IDAS_GROUP_ID,IDAS_ID:dataG.IDAS_DF_ID||dataG.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,ORD:dataG.ORD,GROUP_NAME:dataG.GROUP_NAME,USER_TYPE:dataG.USER_TYPE,Created_by:dataG.Created_by,Last_updated_by:dataG.Last_updated_by,ISENABLE:dataG.ISENABLE,lines:[]}),angular.forEach(data.lines,function(dataL,lIndex){$scope.info.headers[hIndex].groups[i].IDAS_GROUP_ID==dataL.IDAS_GROUP_ID&&$scope.info.headers[hIndex].groups[i].lines.push({IDAS_LINE_ID:dataL.IDAS_LINE_ID,IDAS_GROUP_ID:dataL.IDAS_GROUP_ID,IDAS_ID:dataL.IDAS_DF_ID||dataL.IDAS_ID,PATIENT_ID:Patient_ID,CAL_ID:CalID,ORD:dataL.ORD,QUESTION:dataL.QUESTION,YES_NO:dataL.YES_NO,Created_by:dataL.Created_by,Last_updated_by:dataL.Last_updated_by,ISENABLE:dataL.ISENABLE})}),i++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mhForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submitIDS=function(IDSForm){var info=$scope.info;IDSForm.$error.required||IDSForm.$error.maxlength||IDSForm.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertIDS(info).then(function(response){"success"==response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.IDS",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.updateIDS(info).then(function(response){"success"==response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.IDS",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}),angular.module("app.loggedIn.document.MH.controllers",[]).controller("MHController",function($scope,DocumentService,$http,$cookieStore,toastr,$state,localStorageService,$stateParams){var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!");else{$scope.today=new Date,$scope.info=[];var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.dec_signed=tempSignature},$scope.clearClick=function(){$scope.info.dec_signed=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.dec_signed};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.rmi_signed_witness=tempSignature1},$scope.clearClick1=function(){$scope.info.rmi_signed_witness=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.rmi_signed_witness};var tempSignature2;$scope.isSignature2=!1,$scope.showSignature2=function(){$scope.isSignature2=!$scope.isSignature2},$scope.cancelClick2=function(){$scope.isSignature2=!$scope.isSignature2,$scope.info.dec_signed_witness=tempSignature2},$scope.clearClick2=function(){$scope.info.dec_signed_witness=""},$scope.okClick2=function(){$scope.isSignature2=!$scope.isSignature2,tempSignature2=$scope.info.dec_signed_witness},$scope.info.Date=new Date,$scope.info.Statement_Date=new Date;var tempPatient=localStorageService.get("tempPatient")||[];if(null==tempPatient||"undefined"===tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={patient_id:patient_id,cal_id:cal_id};var oriInfo,clearInfo,clearWorks,clearMedications,medications=[{col1:null,col2:null,col3:null,stt:!0}],works=[{col1:null,col2:null,col3:null,col4:null,stt:!0}];clearWorks=works,clearMedications=medications;var info=$scope.info;DocumentService.loadMH(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.count_sec2=0,$scope.count_sec3=0;else if("findFound"===response[0].status){$scope.isNew=!1;var dataTemp=response[0].data;works=[{col1:dataTemp.s2_occupation1||null,col2:dataTemp.s2_startdate1||null,col3:dataTemp.s2_enddate1||null,col4:dataTemp.s2_employ1||null,stt:null==dataTemp.s2_occupation1?!1:!0},{col1:dataTemp.s2_occupation2||null,col2:dataTemp.s2_startdate2||null,col3:dataTemp.s2_enddate2||null,col4:dataTemp.s2_employ2||null,stt:null==dataTemp.s2_occupation2?!1:!0},{col1:dataTemp.s2_occupation3||null,col2:dataTemp.s2_startdate3||null,col3:dataTemp.s2_enddate3||null,col4:dataTemp.s2_employ3||null,stt:null==dataTemp.s2_occupation3?!1:!0},{col1:dataTemp.s2_occupation4||null,col2:dataTemp.s2_startdate4||null,col3:dataTemp.s2_enddate4||null,col4:dataTemp.s2_employ4||null,stt:null==dataTemp.s2_occupation4?!1:!0},{col1:dataTemp.s2_occupation5||null,col2:dataTemp.s2_startdate5||null,col3:dataTemp.s2_enddate5||null,col4:dataTemp.s2_employ5||null,stt:null==dataTemp.s2_occupation5?!1:!0}],medications=[{col1:dataTemp.s3_name1||null,col2:dataTemp.s3_reason1||null,col3:dataTemp.s3_regularly1,stt:null==dataTemp.s3_name1?!1:!0},{col1:dataTemp.s3_name2||null,col2:dataTemp.s3_reason2||null,col3:dataTemp.s3_regularly2,stt:null==dataTemp.s3_name2?!1:!0},{col1:dataTemp.s3_name3||null,col2:dataTemp.s3_reason3||null,col3:dataTemp.s3_regularly3,stt:null==dataTemp.s3_name3?!1:!0},{col1:dataTemp.s3_name4||null,col2:dataTemp.s3_reason4||null,col3:dataTemp.s3_regularly4,stt:null==dataTemp.s3_name4?!1:!0},{col1:dataTemp.s3_name5||null,col2:dataTemp.s3_reason5||null,col3:dataTemp.s3_regularly5,stt:null==dataTemp.s3_name5?!1:!0},{col1:dataTemp.s3_name6||null,col2:dataTemp.s3_reason6||null,col3:dataTemp.s3_regularly6,stt:null==dataTemp.s3_name6?!1:!0}];for(var i=0;i<=works.length-1;i++)0==works[i].stt&&(works.splice(i,1),i--);for(var j=0;j<=medications.length-1;j++)0==medications[j].stt&&(medications.splice(j,1),j--);$scope.count_sec2=works.length-1,$scope.count_sec3=medications.length-1}else $state.go("loggedIn.home",null,{reload:!0});var data=response[0].data;$scope.info={mh_id:data.mh_id||null,patient_id:patient_id,
cal_id:cal_id,s1_relationship:data.s1_relationship||null,s1_job_location:data.s1_job_location||null,s2_occupation1:data.s2_occupation1||null,s2_startdate1:data.s2_startdate1||null,s2_enddate1:data.s2_enddate1||null,s2_employ1:data.s2_employ1||null,s2_occupation2:data.s2_occupation2||null,s2_startdate2:data.s2_startdate2||null,s2_enddate2:data.s2_enddate2||null,s2_employ2:data.s2_employ2||null,s2_occupation3:data.s2_occupation3||null,s2_startdate3:data.s2_startdate3||null,s2_enddate3:data.s2_enddate3||null,s2_employ3:data.s2_employ3||null,s2_occupation4:data.s2_occupation4||null,s2_startdate4:data.s2_startdate4||null,s2_enddate4:data.s2_enddate4||null,s2_employ4:data.s2_employ4||null,s2_occupation5:data.s2_occupation5||null,s2_startdate5:data.s2_startdate5||null,s2_enddate5:data.s2_enddate5||null,s2_employ5:data.s2_employ5||null,s2_samework:data.s2_samework||null,s2_sameworkenvironment:data.s2_sameworkenvironment||null,s2_comments:data.s2_comments||null,s3_name1:data.s3_name1||null,s3_reason1:data.s3_reason1||null,s3_regularly1:data.s3_regularly1||null,s3_name2:data.s3_name2||null,s3_reason2:data.s3_reason2||null,s3_regularly2:data.s3_regularly2||null,s3_name3:data.s3_name3||null,s3_reason3:data.s3_reason3||null,s3_regularly3:data.s3_regularly3||null,s3_name4:data.s3_name4||null,s3_reason4:data.s3_reason4||null,s3_regularly4:data.s3_regularly4||null,s3_name5:data.s3_name5||null,s3_reason5:data.s3_reason5||null,s3_regular5:data.s3_regularly5||null,s3_comments:data.s3_comments||null,s4_concerning:data.s4_concerning||null,s4_weight_altered:data.s4_weight_altered||null,s4_medicaltreatment:data.s4_medicaltreatment||null,s4_hospital:data.s4_hospital||null,s4_stranfustion:data.s4_stranfustion||null,s4_diabetes:data.s4_diabetes||null,s4_pressure:data.s4_pressure||null,s4_asthma:data.s4_asthma||null,s4_emphysema:data.s4_emphysema||null,s4_veins:data.s4_veins||null,s4_epilepsy:data.s4_epilepsy||null,s4_episodes:data.s4_episodes||null,s4_cancer_or_tumour:data.s4_cancer_or_tumour||null,s4_concussion_or_headinjury:data.s4_concussion_or_headinjury||null,s4_migraine:data.s4_migraine||null,s4_eczema:data.s4_eczema||null,s4_hepatitis:data.s4_hepatitis||null,s4_desease:data.s4_desease||null,s4_hormonal:data.s4_hormonal||null,s4_allergies:data.s4_allergies||null,s4_comments:data.s4_comments||null,s5_disease:data.s5_disease||null,s5_claim:data.s5_claim||null,s5_claim_comment:data.s5_claim_comment||null,s5_lodged:data.s5_lodged||null,s5_closed:data.s5_closed||null,s5_duties:data.s5_duties||null,s5_sickness:data.s5_sickness||null,s5_equipment:data.s5_equipment||null,s5_chermicals:data.s5_chermicals||null,s5_noise:data.s5_noise||null,s5_radiation:data.s5_radiation||null,s5_dust:data.s5_dust||null,s5_asbestos:data.s5_asbestos||null,s5_solvents:data.s5_solvents||null,s5_other:data.s5_other||null,s5_comments:data.s5_comments||null,s6_neck:data.s6_neck||null,s6_shoulder:data.s6_shoulder||null,s6_elbow:data.s6_elbow||null,s6_wrist_or_hand:data.s6_wrist_or_hand||null,s6_lower_black:data.s6_lower_black||null,s6_hip:data.s6_hip||null,s6_knee:data.s6_knee||null,s6_ankle_or_foot:data.s6_ankle_or_foot||null,s6_comments1:data.s6_comments1||null,s6_cervical:data.s6_cervical||null,s6_lower:data.s6_lower||null,s6_sciatica:data.s6_sciatica||null,s6_pins_needles:data.s6_pins_needles||null,s6_muscle_aches_pains:data.s6_muscle_aches_pains||null,s6_joint_aches_pains:data.s6_joint_aches_pains||null,s6_comments2:data.s6_comments2||null,s6_rsi:data.s6_rsi||null,s6_tennis:data.s6_tennis||null,s6_carpal:data.s6_carpal||null,s6_hernia:data.s6_hernia||null,s6_osteoarthritis:data.s6_osteoarthritis||null,s6_arthritis:data.s6_arthritis||null,s6_osteoporosis:data.s6_osteoporosis||null,s6_fibromyalgia:data.s6_fibromyalgia||null,s6_fractured_bones:data.s6_fractured_bones||null,s6_affects:data.s6_affects||null,s6_joint_or_bones:data.s6_joint_or_bones||null,s6_comments3:data.s6_comments3||null,s7_directfamily:data.s7_directfamily||null,s7_undergone:data.s7_undergone||null,s7_conditions:data.s7_conditions||null,s7_disease:data.s7_disease||null,s7_murmurs:data.s7_murmurs||null,s7_palpitations:data.s7_palpitations||null,s7_angina:data.s7_angina||null,s7_blood_presure:data.s7_blood_presure||null,s7_comments:data.s7_comments||null,s8_exercise:data.s8_exercise||null,s8_asthma:data.s8_asthma||null,s8_emphysema:data.s8_emphysema||null,s8_hay_fever:data.s8_hay_fever||null,s8_tuberculosis:data.s8_tuberculosis||null,s8_obstructive:data.s8_obstructive||null,s8_rheumatic_fever:data.s8_rheumatic_fever||null,s8_bronchitis:data.s8_bronchitis||null,s8_coughed_blood:data.s8_coughed_blood||null,s8_shortness:data.s8_shortness||null,s8_comments:data.s8_comments||null,s9_hearing:data.s9_hearing||null,s9_infections_or_discharge:data.s9_infections_or_discharge||null,s9_hearing_aid:data.s9_hearing_aid||null,s9_injury_or_condition:data.s9_injury_or_condition||null,s9_near_or_distance:data.s9_near_or_distance||null,s9_color_blind:data.s9_color_blind||null,s9_eyes_or_ears:data.s9_eyes_or_ears||null,s9_comments:data.s9_comments||null,s10_indigestion:data.s10_indigestion||null,s10_vomited_blood:data.s10_vomited_blood||null,s10_bowel_habit:data.s10_bowel_habit||null,s10_time_you_urinate:data.s10_time_you_urinate||null,s10_night_to_urinate:data.s10_night_to_urinate||null,s10_start_stop_urine:data.s10_start_stop_urine||null,s10_change_urine:data.s10_change_urine||null,s10_comments:data.s10_comments||null,s11_medicaltion_or_counselling:data.s11_medicaltion_or_counselling||null,s11_psychologist_or_psychiatrist:data.s11_psychologist_or_psychiatrist||null,s11_sleeping_tablets:data.s11_sleeping_tablets||null,s11_drug_or_alcohol:data.s11_drug_or_alcohol||null,s11_depression:data.s11_depression||null,s11_panic:data.s11_panic||null,s11_anxiety:data.s11_anxiety||null,s11_insomnia:data.s11_insomnia||null,s11_any_condition:data.s11_any_condition||null,s11_comments:data.s11_comments||null,s12_narcolepsy:data.s12_narcolepsy||null,s12_exhaustion:data.s12_exhaustion||null,s12_shift_work:data.s12_shift_work||null,s12_environment:data.s12_environment||null,s12_very_hot_environment:data.s12_very_hot_environment||null,s12_illness:data.s12_illness||null,s12_sweat:data.s12_sweat||null,s12_hormonal:data.s12_hormonal||null,s12_stones_or_renal:data.s12_stones_or_renal||null,s12_comments:data.s12_comments||null,s13_ever_smoked:data.s13_ever_smoked||null,s13_each_date:data.s13_each_date||null,s13_one_date:data.s13_one_date||null,s13_many_cigarettes:data.s13_many_cigarettes||null,s13_start_stop_smoked:data.s13_start_stop_smoked||null,s13_exercise:data.s13_exercise||null,s13_aspect:data.s13_aspect||null,s13_comments:data.s13_comments||null,s14_tetanus:data.s14_tetanus||null,s14_helpa_helpb:data.s14_helpa_helpb||null,s14_comments:data.s14_comments||null,rmi_physical:data.rmi_physical||null,rmi_physical_initials:data.rmi_physical_initials||null,rmi_mental:data.rmi_mental||null,rmi_mental_initials:data.rmi_mental_initials||null,rmi_date:data.rmi_date||new Date,rmi_witness:data.rmi_witness||null,rmi_signed_witness:data.rmi_signed_witness||null,dec_signed:data.dec_signed||null,dec_witness:data.dec_witness||null,dec_signed_witness:data.dec_signed_witness||null,dec_date:data.dec_date||new Date,doctor_id:response[0].doctor.doctor_id||null,created_by:data.created_by||null,last_updated_by:data.last_updated_by||null,patient:response[0].patient||[],doctor:response[0].doctor||[],company:response[0].company||[],works:works||[],medications:medications||[]},oriInfo=angular.copy($scope.info),$scope.isNew?($scope.info.created_by=userInfo.id,clearInfo=angular.copy($scope.info)):($scope.info.last_updated_by=userInfo.id,clearInfo={mh_id:$scope.info.mh_id||null,patient_id:patient_id,cal_id:cal_id,s1_relationship:null,s1_job_location:null,s2_occupation1:null,s2_startdate1:null,s2_enddate1:null,s2_employ1:null,s2_occupation2:null,s2_startdate2:null,s2_enddate2:null,s2_employ2:null,s2_occupation3:null,s2_startdate3:null,s2_enddate3:null,s2_employ3:null,s2_occupation4:null,s2_startdate4:null,s2_enddate4:null,s2_employ4:null,s2_occupation5:null,s2_startdate5:null,s2_enddate5:null,s2_employ5:null,s2_samework:null,s2_sameworkenvironment:null,s2_comments:null,s3_name1:null,s3_reason1:null,s3_regularly1:null,s3_name2:null,s3_reason2:null,s3_regularly2:null,s3_name3:null,s3_reason3:null,s3_regularly3:null,s3_name4:null,s3_reason4:null,s3_regularly4:null,s3_name5:null,s3_reason5:null,s3_regular5:null,s3_comments:null,s4_concerning:null,s4_weight_altered:null,s4_medicaltreatment:null,s4_hospital:null,s4_stranfustion:null,s4_diabetes:null,s4_pressure:null,s4_asthma:null,s4_emphysema:null,s4_veins:null,s4_epilepsy:null,s4_episodes:null,s4_cancer_or_tumour:null,s4_concussion_or_headinjury:null,s4_migraine:null,s4_eczema:null,s4_hepatitis:null,s4_desease:null,s4_hormonal:null,s4_allergies:null,s4_comments:null,s5_disease:null,s5_claim:null,s5_claim_comment:null,s5_lodged:null,s5_closed:null,s5_duties:null,s5_sickness:null,s5_equipment:null,s5_chermicals:null,s5_noise:null,s5_radiation:null,s5_dust:null,s5_asbestos:null,s5_solvents:null,s5_other:null,s5_comments:null,s6_neck:null,s6_shoulder:null,s6_elbow:null,s6_wrist_or_hand:null,s6_lower_black:null,s6_hip:null,s6_knee:null,s6_ankle_or_foot:null,s6_comments1:null,s6_cervical:null,s6_lower:null,s6_sciatica:null,s6_pins_needles:null,s6_muscle_aches_pains:null,s6_joint_aches_pains:null,s6_comments2:null,s6_rsi:null,s6_tennis:null,s6_carpal:null,s6_hernia:null,s6_osteoarthritis:null,s6_arthritis:null,s6_osteoporosis:null,s6_fibromyalgia:null,s6_fractured_bones:null,s6_affects:null,s6_joint_or_bones:null,s6_comments3:null,s7_directfamily:null,s7_undergone:null,s7_conditions:null,s7_disease:null,s7_murmurs:null,s7_palpitations:null,s7_angina:null,s7_blood_presure:null,s7_comments:null,s8_exercise:null,s8_asthma:null,s8_emphysema:null,s8_hay_fever:null,s8_tuberculosis:null,s8_obstructive:null,s8_disease:null,s8_rheumatic_fever:null,s8_bronchitis:null,s8_coughed_blood:null,s8_shortness:null,s8_comments:null,s9_hearing:null,s9_infections_or_discharge:null,s9_hearing_aid:null,s9_injury_or_condition:null,s9_near_or_distance:null,s9_color_blind:null,s9_eyes_or_ears:null,s9_comments:null,s10_indigestion:null,s10_vomited_blood:null,s10_bowel_habit:null,s10_time_you_urinate:null,s10_night_to_urinate:null,s10_start_stop_urine:null,s10_change_urine:null,s10_comments:null,s11_medicaltion_or_counselling:null,s11_psychologist_or_psychiatrist:null,s11_sleeping_tablets:null,s11_drug_or_alcohol:null,s11_depression:null,s11_panic:null,s11_anxiety:null,s11_insomnia:null,s11_any_condition:null,s11_comments:null,s12_narcolepsy:null,s12_exhaustion:null,s12_shift_work:null,s12_environment:null,s12_very_hot_environment:null,s12_illness:null,s12_sweat:null,s12_hormonal:null,s12_stones_or_renal:null,s12_comments:null,s13_ever_smoked:null,s13_many_cigarettes:null,s13_start_stop_smoked:null,s13_exercise:null,s13_aspect:null,s13_comments:null,s14_tetanus:null,s14_helpa_helpb:null,s14_comments:null,rmi_physical:null,rmi_physical_initials:null,rmi_mental:null,rmi_mental_initials:null,rmi_date:new Date,rmi_witness:null,rmi_signed_witness:null,dec_signed:null,dec_witness:null,dec_signed_witness:null,dec_date:new Date,doctor_id:null,created_by:null,last_updated_by:null,patient:$scope.info.patient||[],doctor:$scope.info.doctor||[],company:$scope.info.company||[],works:clearWorks,medications:clearMedications})}),$scope.add_sec2=function(){$scope.count_sec2<4&&($scope.info.works.push({col1:null,col2:null,col3:null,col4:null,stt:!0}),++$scope.count_sec2)},$scope.del_sec2=function(index){$scope.info.works.splice(index,1),--$scope.count_sec2},$scope.add_sec3=function(){$scope.count_sec3<5&&($scope.info.medications.push({col1:null,col2:null,col3:null,stt:!0}),++$scope.count_sec3)},$scope.del_sec3=function(index){$scope.info.medications.splice(index,1),--$scope.count_sec3},$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mhForm.$setPristine()},$scope.maxDate=new Date,$scope.clearForm=function(){$scope.info=angular.copy(clearInfo),$scope.mhForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.infoClear=function(){return!angular.equals(clearInfo,$scope.info)},$scope.submit=function(mhForm){if(mhForm.$error.required||mhForm.$error.maxlength||mhForm.$error.pattern)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew?DocumentService.insertMH(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.MH",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):DocumentService.editMH(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.MH",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}}),angular.module("app.loggedIn.document.MRS.controllers",[]).controller("MRSController",function($filter,$scope,DocumentService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.MRS",null,{reload:!0});else{var tempSignature;if($scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.practitionSign=tempSignature},$scope.clearClick=function(){$scope.info.practitionSign=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.practitionSign},$scope.patientInfo=localStorageService.get("tempPatient"),null===$scope.patientInfo||"undefined"===$scope.patientInfo)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load information fail, Please try again","Error");else{var patient_id=$scope.patientInfo.Patient_id,cal_id=$stateParams.cal_id;$scope.patientInfo.DOB=$filter("date")($scope.patientInfo.DOB,"dd/MM/yyyy"),$scope.info={patient_id:patient_id,cal_id:cal_id,idC:$scope.patientInfo.company_id};var oriInfo,info=$scope.info;DocumentService.loadMRS(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.MRS",null,{raw:!0});else{if("not"==response.status)return toastr.error("You have to make Medical Assessment first","Error"),void $state.go("loggedIn.MA",null,{reload:!0});"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1)}if("findFound"===response[0].status||"findNull"===response[0].status){var data=response[0].data;$scope.companyName=response[0].nameCompany,$scope.patient=response[0].patient,$scope.doctor=response[0].doctor,$scope.appt=response[0].appt,$scope.info={mrs_id:data.mrs_id,patient_id:patient_id,cal_id:cal_id,sticker_here:data.sticker_here,proposed:data.proposed,as_height:response[0].dataMA.HEIGHT,as_weight:response[0].dataMA.WEIGHT,as_whr:response[0].dataMA.WHR,as_bmi:response[0].dataMA.BMI,as_height_weight:data.as_height_weight,as_medical_history:data.as_medical_history,as_medical_assessment:data.as_medical_assessment,as_functional_assessment:data.as_functional_assessment,as_hearing_test:data.as_hearing_test,as_spirometry:data.as_spirometry,as_drug_test:data.as_drug_test,as_other:data.as_other,ac_any_existing_or_active:data.ac_any_existing_or_active,ac_any_history:data.ac_any_history,ac_cardiovascular:data.ac_cardiovascular,ac_any_current_or_work_related:data.ac_any_current_or_work_related,ac_any_medical_or_functional:data.ac_any_medical_or_functional,ac_any_diagnosed_or_previous:data.ac_any_diagnosed_or_previous,ac_examiner_comment:data.ac_examiner_comment,risk_rating:data.risk_rating,rr_amber_comment:data.rr_amber_comment,rr_red_comment:data.rr_red_comment,mrs_review:data.mrs_review,mrs_doc_date:data.mrs_doc_date||new Date,doctor_id:$scope.doctor.doctor_id,created_by:$scope.isNew?userInfo.id:data.created_by,last_updated_by:$scope.isNew?data.last_updated_by:userInfo.id}}oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.mrsForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(mrsForm){if(mrsForm.$error.pattern||mrsForm.$error.maxlength||mrsForm.$error.required)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertMRS(info).then(function(response){"fail"===response.status?toastr.error("Add new fail","Error"):"success"===response.status?(toastr.success("Add new success","Success"),$state.go("loggedIn.MRS",null,{reload:!0})):$state.go("loggedIn.MRS",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editMRS(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status&&(toastr.success("Update success!","Success"),$state.go("loggedIn.MRS",null,{reload:!0}))})}}}}}),angular.module("app.loggedIn.document.SA1.controllers",[]).controller("SA1Controller",function($scope,$state,DocumentService,$http,$cookieStore,toastr,$stateParams,localStorageService){$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date,$scope.info=[];var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.SA1",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var oriInfo;$scope.info={patient_id:Patient_ID,CAL_ID:CalID};var info=$scope.info;DocumentService.loadSA1(info).then(function(response){"fail"===response.status?$state.go("loggedIn.home",null,{reload:!0}):"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1);var data=response[0];$scope.info.headers=[],$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.appt=response[0].appt,$scope.info.site=response[0].site,$scope.info.company=response[0].company,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({patient_id:Patient_ID,CAL_ID:CalID,SA_ID:dataH.SA_ID,SA_NAME:dataH.SA_NAME,ISENABLE:dataH.ISENABLE,SA_CODE:dataH.SA_CODE,test_date:dataH.test_date||new Date,tester:dataH.tester||(null!==$scope.info.doctor.Title&&""!==$scope.info.doctor.Title?$scope.info.doctor.Title+" ":"")+(null!==$scope.info.doctor.First_name&&""!==$scope.info.doctor.First_name?$scope.info.doctor.First_name+" ":"")+(null!==$scope.info.doctor.Sur_name&&""!==$scope.info.doctor.Sur_name?$scope.info.doctor.Sur_name+" ":""),report_type:dataH.report_type,RECIPIENT_NAME:dataH.RECIPIENT_NAME,DOCTOR_ID:dataH.DOCTOR_ID||response[0].doctor.doctor_id,Signature:dataH.Signature,LOCATION_ID:dataH.LOCATION_ID,Created_by:$scope.isNew?userInfo.id:dataH.Created_by,Last_updated_by:$scope.isNew?dataH.Last_updated_by:userInfo.id,sections:[]}),$scope.info.Signature=$scope.info.headers[hIndex].Signature,$scope.info.test_date=$scope.info.headers[hIndex].test_date,$scope.info.RECIPIENT_NAME=$scope.info.headers[hIndex].RECIPIENT_NAME,$scope.info.tester=$scope.info.headers[hIndex].tester;var j=0;angular.forEach(data.sections,function(dataS){$scope.info.headers[hIndex].SA_ID===dataS.SA_ID&&($scope.info.headers[hIndex].sections.push({patient_id:Patient_ID,CAL_ID:CalID,SECTION_ID:dataS.SECTION_ID,SA_ID:dataS.SA_ID,SECTION_NAME:dataS.SECTION_NAME,ORD:dataS.ORD,USER_TYPE:dataS.USER_TYPE,ISENABLE:dataS.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataS.Created_by,Last_updated_by:$scope.isNew?dataS.Last_updated_by:userInfo.id,lines:[]}),angular.forEach(data.lines,function(dataL){$scope.info.headers[hIndex].sections[j].SECTION_ID===dataL.SECTION_ID&&$scope.info.headers[hIndex].sections[j].lines.push({patient_id:Patient_ID,CAL_ID:CalID,LINE_ID:dataL.LINE_ID,SECTION_ID:dataL.SECTION_ID,SA_ID:dataL.SA_ID,NAME:dataL.NAME||dataL.Name,VALUE_RIGHT:dataL.VALUE_RIGHT,VALUE_LEFT:dataL.VALUE_LEFT,ISENABLE:dataL.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataL.Created_by,Last_updated_by:$scope.isNew?dataL.Last_updated_by:userInfo.id})}),j++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.SA1.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(SA1){var info=$scope.info;SA1.$error.required||SA1.$error.maxlength||SA1.$error.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertSA1(info).then(function(response){"fail"===response.status?toastr.error("Add fail!","Error"):"success"===response.status?(toastr.success("Add success!","Success"),$state.go("loggedIn.SA1",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editSA1(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.SA1",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})})}}}),angular.module("app.loggedIn.document.SA2.controllers",[]).controller("SA2Controller",function($scope,$state,DocumentService,$http,$cookieStore,toastr,$stateParams,localStorageService){$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date,$scope.info=[];var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist!"),$state.go("loggedIn.SA1",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var oriInfo;$scope.info={patient_id:Patient_ID,CAL_ID:CalID};var info=$scope.info;DocumentService.loadSA2(info).then(function(response){"fail"===response.status?$state.go("loggedIn.home",null,{reload:!0}):"findNull"===response[0].status?$scope.isNew=!0:"findFound"===response[0].status&&($scope.isNew=!1);var data=response[0];$scope.info.headers=[],$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.appt=response[0].appt,$scope.info.site=response[0].site,$scope.info.company=response[0].company,angular.forEach(data.headers,function(dataH,hIndex){$scope.info.headers.push({patient_id:Patient_ID,CAL_ID:CalID,SA_ID:dataH.SA_ID,SA_NAME:dataH.SA_NAME,ISENABLE:dataH.ISENABLE,SA_CODE:dataH.SA_CODE,test_date:dataH.test_date||new Date,tester:dataH.tester,report_type:dataH.report_type,RECIPIENT_NAME:dataH.RECIPIENT_NAME,DOCTOR_ID:dataH.DOCTOR_ID||response[0].doctor.doctor_id,Signature:dataH.Signature,LOCATION_ID:dataH.LOCATION_ID,Created_by:$scope.isNew?userInfo.id:dataH.Created_by,Last_updated_by:$scope.isNew?dataH.Last_updated_by:userInfo.id,sections:[]}),$scope.info.Signature=$scope.info.headers[hIndex].Signature,$scope.info.test_date=$scope.info.headers[hIndex].test_date,$scope.info.RECIPIENT_NAME=$scope.info.headers[hIndex].RECIPIENT_NAME,$scope.info.tester=$scope.info.headers[hIndex].tester;var j=0;angular.forEach(data.sections,function(dataS){$scope.info.headers[hIndex].SA_ID===dataS.SA_ID&&($scope.info.headers[hIndex].sections.push({patient_id:Patient_ID,CAL_ID:CalID,SECTION_ID:dataS.SECTION_ID,SA_ID:dataS.SA_ID,SECTION_NAME:dataS.SECTION_NAME,ORD:dataS.ORD,USER_TYPE:dataS.USER_TYPE,ISENABLE:dataS.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataS.Created_by,Last_updated_by:$scope.isNew?dataS.Last_updated_by:userInfo.id,lines:[]}),angular.forEach(data.lines,function(dataL){$scope.info.headers[hIndex].sections[j].SECTION_ID===dataL.SECTION_ID&&$scope.info.headers[hIndex].sections[j].lines.push({patient_id:Patient_ID,CAL_ID:CalID,LINE_ID:dataL.LINE_ID,SECTION_ID:dataL.SECTION_ID,SA_ID:dataL.SA_ID,NAME:dataL.NAME||dataL.Name,VALUE_RIGHT:dataL.VALUE_RIGHT,VALUE_LEFT:dataL.VALUE_LEFT,ISENABLE:dataL.ISENABLE,Created_by:$scope.isNew?userInfo.id:dataL.Created_by,Last_updated_by:$scope.isNew?dataL.Last_updated_by:userInfo.id})}),j++)})}),oriInfo=angular.copy($scope.info)}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.SA2.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(SA2){var info=$scope.info;SA2.$error.required||SA2.$error.maxlength||SA2.$error.pattern?toastr.error("Please Input All Required Information!","Error"):$scope.isNew===!0?DocumentService.insertSA2(info).then(function(response){"fail"===response.status?toastr.error("Add fail!","Error"):"success"===response.status?(toastr.success("Add success!","Success"),$state.go("loggedIn.SA2",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editSA2(info).then(function(response){"fail"===response.status?toastr.error("Update fail!","Error"):"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.SA2",null,{reload:!0})):$state.go("loggedIn.home",null,{reload:!0})})}}}),angular.module("app.loggedIn.document.form18.controllers",[]).controller("form18Controller",function($scope,DocumentService,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1};var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist"),$state.go("loggedIn.home",null,{reload:!0});else{$scope.today=new Date;var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.PERSON_ARRANGING_SIGNATURE=tempSignature},$scope.clearClick=function(){$scope.info.PERSON_ARRANGING_SIGNATURE=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.PERSON_ARRANGING_SIGNATURE};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.WORKER_SIGNATURE=tempSignature1},$scope.clearClick1=function(){$scope.info.WORKER_SIGNATURE=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.WORKER_SIGNATURE};var patientInfo=localStorageService.get("tempPatient");if(null==patientInfo||"undefined"==patientInfo)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load some information fail, please try again!","Error");else{var Patient_ID=patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={GORGON_ID:null,PATIENT_ID:Patient_ID,CAL_ID:CalID,DocId:null,TIME_TEST:new Date,WORK_COVER_NO:null,PERSON_ARRANGING_SIGNATURE:null,PERSON_ARRANGING_NAME:null,PERSON_ARRANGING_POSITION:null,DOCTOR_ID:null,WORKER_SIGNATURE:null};var oriInfo,info=$scope.info;DocumentService.loadForm18(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.demo",null,{reload:!0}),toastr.error("Load information fail, Please try again!","Error");else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.doctor=response[0].doctor,$scope.info.APPT=response[0].APPT,$scope.info.rmSite=response[0].rmSite,$scope.info.company=response[0].company,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].dataF18;$scope.info={doctorInfo:response[0].doctor,apptInfo:response[0].APPT,patient:response[0].patient,doctor:response[0].doctor,APPT:response[0].APPT,rmSite:response[0].rmSite,company:response[0].company,GORGON_ID:data.GORGON_ID,PATIENT_ID:data.PATIENT_ID,CAL_ID:data.CAL_ID,DocId:data.DocId,TIME_TEST:data.TIME_TEST,WORK_COVER_NO:data.WORK_COVER_NO,PERSON_ARRANGING_SIGNATURE:data.PERSON_ARRANGING_SIGNATURE,PERSON_ARRANGING_NAME:data.PERSON_ARRANGING_NAME,PERSON_ARRANGING_POSITION:data.PERSON_ARRANGING_POSITION,DOCTOR_ID:response[0].doctor.DOCTOR_ID,WORKER_SIGNATURE:data.WORKER_SIGNATURE,Created_by:data.Created_by,Last_updated_by:userInfo.id},oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.form18.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(form18){if(form18.$error.maxlength||form18.$error.required||form18.$error.pattern)toastr.error("Please Input All Required Information!","Success");else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertForm18(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.Form18",null,{reload:!0})):"fail"===response.status?toastr.error("Add new fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})}):$scope.isNew===!1&&DocumentService.editForm18(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.Form18",null,{reload:!0})):"fail"===response.status?toastr.error("Update fail!","Error"):$state.go("loggedIn.home",null,{reload:!0})})}}}}}),angular.module("app.loggedIn.document.gorgonFA.controllers",[]).controller("gorgonFAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$window,$stateParams,localStorageService){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}var tempSignature,oriInfo;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.fsign=tempSignature},$scope.clearClick=function(){$scope.info.fsign=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.fsign},$scope.dateOptions={formatYear:"yy",startingDay:1};{var date=new Date;$filter("date")(date,"dd/MM/yyyy")}$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,sex=$scope.patientInfo.Sex;$scope.print=function(){$window.location.href="/api/document/gorgonFA/print/7"};var value;$scope.grip=function(){value=0,$scope.info.c_Right3>0||$scope.info.c_Left3>0?(1*$scope.info.c_Right3>=$scope.info.c_Left3?value=$scope.info.c_Right3:1*$scope.info.c_Right3<$scope.info.c_Left3&&(value=$scope.info.c_Left3),"Male"==sex?40>value?$scope.info.c_Result3=1:value>=40&&45>=value?$scope.info.c_Result3=2:value>=46&&51>=value?$scope.info.c_Result3=3:value>=52&&55>=value?$scope.info.c_Result3=4:value>55&&($scope.info.c_Result3=5):"Female"==sex&&(23>value?$scope.info.c_Result3=1:value>=23&&26>=value?$scope.info.c_Result3=2:value>=27&&29>=value?$scope.info.c_Result3=3:value>=30&&33>=value?$scope.info.c_Result3=4:value>33&&($scope.info.c_Result3=5))):""==$scope.info.c_Left3?$scope.info.c_Result3=0:null==$scope.info.c_Left3?$scope.info.c_Result3=0:""==$scope.info.c_Right3?$scope.info.c_Result3=0:null==$scope.info.c_Right3&&($scope.info.c_Result3=0)},$scope.d_Push_ups=function(){value=$scope.info.d_Push_ups_total3,value>0?"Male"==sex?value>=1&&5>=value?$scope.info.d_Result3=1:value>=6&&8>=value?$scope.info.d_Result3=2:value>=9&&12>=value?$scope.info.d_Result3=3:value>=13&&15>=value?$scope.info.d_Result3=4:value>15&&($scope.info.d_Result3=5):"Female"==sex&&(value>=1&&2>=value?$scope.info.d_Result3=1:value>=3&&4>=value?$scope.info.d_Result3=2:value>=5&&6>=value?$scope.info.d_Result3=3:value>=7&&10>=value?$scope.info.d_Result3=4:value>10&&($scope.info.d_Result3=5)):$scope.info.d_Result3=0;

},$scope.e_total3=function(){value=$scope.info.e_total3,value?value>=0&&30>=value?$scope.info.e_Result3=1:value>30&&60>=value?$scope.info.e_Result3=2:value>60&&90>=value?$scope.info.e_Result3=3:value>90&&120>=value?$scope.info.e_Result3=4:value>120&&($scope.info.e_Result3=5):$scope.info.e_Result3=null},$scope.aSec4=function(){value=$scope.info.aSec4,value?0==value?$scope.info.aResult4=1:value>=1&&20>=value?$scope.info.aResult4=2:value>=21&&40>=value?$scope.info.aResult4=3:value>=41&&60>=value?$scope.info.aResult4=4:value>60&&($scope.info.aResult4=5):$scope.info.aResult4=null},$scope.bTotal4=function(){value=$scope.info.bTotal4,value?0==value?$scope.info.bResult4=1:value>=1&&9>=value?$scope.info.bResult4=2:value>=10&&14>=value?$scope.info.bResult4=3:value>=15&&19>=value?$scope.info.bResult4=4:value>=20&&($scope.info.bResult4=5):$scope.info.bResult4=null},$scope.cKneeling4=function(){value=$scope.info.cKneeling4,value?0==value?$scope.info.cResult4=1:value>=1&&10>=value?$scope.info.cResult4=2:value>=11&&20>=value?$scope.info.cResult4=3:value>=21&&30>=value?$scope.info.cResult4=4:value>30&&($scope.info.cResult4=5):$scope.info.cResult4=null},$scope.aMax=function(){value=$scope.info.aMax6,value?value>45?$scope.info.aResult6=5:value>=23&&45>=value?$scope.info.aResult6=4:value>=10&&22>=value?$scope.info.aResult6=3:value>=6&&9>=value?$scope.info.aResult6=2:value>=0&&5>=value&&($scope.info.aResult6=1):$scope.info.aResult6=null},$scope.bMax=function(){value=$scope.info.bMax6,value?value>23?$scope.info.bResult6=5:value>=12&&23>=value?$scope.info.bResult6=4:value>=6&&11>=value?$scope.info.bResult6=3:value>=4&&5>=value?$scope.info.bResult6=2:value>=0&&3>=value&&($scope.info.bResult6=1):$scope.info.bResult6=null},$scope.cStrenght5=function(){value=$scope.info.cStrenght5,value?0==value?$scope.info.cResult5=1:value>=1&&20>=value?$scope.info.cResult5=2:value>=21&&40>=value?$scope.info.cResult5=3:value>=41&&60>=value?$scope.info.cResult5=4:value>60&&($scope.info.cResult5=5):$scope.info.cResult5=null},$scope.dTotal5=function(){value=$scope.info.dTotal5,value?0==value?$scope.info.dResult5=1:value>=1&&5>=value?$scope.info.dResult5=2:value>5&&10>=value?$scope.info.dResult5=3:value>=11&&15>=value?$scope.info.dResult5=4:value>15&&($scope.info.dResult5=5):$scope.info.dResult5=null};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.LComment=(null!=$scope.info.Rom_Comments1&&""!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1+"\n":"")+(null!=$scope.info.Comments2&&""!=$scope.info.Comments2?$scope.info.Comments2+"\n":"")+totalCom},$scope.totalComment=function(){"undefined"==typeof $scope.info.LComment&&($scope.info.LComment=(null!=$scope.info.Rom_Comments1&&""!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1+"\n":"")+(null!=$scope.info.Comments2&&""!=$scope.info.Comments2?$scope.info.Comments2+"\n":"")),len=(null!=$scope.info.Rom_Comments1?$scope.info.Rom_Comments1.length:0)+(null!=$scope.info.Comments2?$scope.info.Comments2.length:0),str=$scope.info.LComment.replace("\n",""),str=str.replace("\n",""),totalCom=str.substr(len)},$scope.maxDateDOB=new Date(date.getFullYear()-1,date.getMonth(),date.getDate()),$scope.maxDate=date,$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonFAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)};var insert=!0,FName="",SName="",MName="";DocumentService.checkGorgonFA(Patient_ID,CalID).then(function(response){"not"==response.status?(toastr.error("You have to make Pre-employment Health Assessment first","Error"),$state.go("loggedIn.gorgonMA",null,{reload:!0})):"insert"===response.status?(insert=!0,$scope.isNew=!0,FName=null!=$scope.patientInfo.First_name?$scope.patientInfo.First_name:"",SName=null!=$scope.patientInfo.Sur_name?$scope.patientInfo.Sur_name:"",MName=null!=$scope.patientInfo.Middle_name?$scope.patientInfo.Middle_name:"",$scope.info={id:null,patientId:Patient_ID,fName:FName+" "+MName+" "+SName,age:null,JAF:null,DOB:$scope.patientInfo.DOB,DOA:date,IsConsentReason:null,fsign:null,fsignDate:date,Estimated:null,EstimatedComments:null,MS_HeartConditions:null,MS_HeartConditions_Comment:null,MS_Lung_Asthma:null,MS_Lung__Asthma_Comment:null,MS_Diabetes:null,MS_Diabetes_Comment:null,MS_Fits:null,MS_Fits_Comment:null,MS_Medication:null,MS_Medication_Comment:null,MS_Other:null,MS_Other_Comment:null,MS_ie_Comment:null,MS_Mx_Heart_Rage_1:null!=$scope.patientInfo.DOB?getAge($scope.patientInfo.DOB):0,MS_Mx_Heart_Rage_2:null,MS_Mx_Weight_1:response.data.WEIGHT,MS_MX_Weight_2:null,MS_Blood_Pressure_1:response.data.SYSTOLIC_BP,MS_Blood_Pressure_2:response.data.DIASTOLIC_BP,MS_Resting_Heart_Rate:response.data.PULSE,Rom_Neck1:null,Rom_Thoracic1:null,Rom_Lumbar1:null,Rom_Shoulder1:null,Rom_Elbow1:null,Rom_Wrist1:null,Rom_Fingers1:null,Rom_Hips1:null,Rom_Knees1:null,Rom_Ankles1:null,Rom_Comments1:null,Rom_Total1:0,Heart_Rate_30S2:null,Heart_Rate_1M2:null,Heart_Rate_1M_30S2:null,Heart_Rate_2M2:null,Heart_Rate_2M_30S2:null,Heart_Rate_3M2:null,Heart_Rate_1M_Post2:null,Step_Result2:null,Step_Correct2:null,Comments2:null,Total2:null,a_Right3:null,a_Left3:null,b_Right3:null,b_Left3:null,c_Grip3:null,c_Right3:null,c_Left3:null,c_Result3:0,d_Push_ups_total3:null,d_Result3:0,e_total3:null,e_Result3:0,Comments3:null,Total3:0,aSec4:null,aResult4:null,bTotal4:null,bCrepitus4:null,bResult4:null,cKneeling4:null,cResult4:null,Comments4:null,Total4:0,aPosture5:null,bHoverResult5:null,cStrenght5:null,cResult5:null,dTotal5:null,dResult5:null,eWaitesBow5:null,eResult5:null,fRight5:null,fLeft5:null,gRight5:null,gFloat5:null,Total5:0,aMax6:null,aResult6:null,bMax6:null,bResult6:null,c_16:0,c_1Comment6:null,c_26:0,c_2Comment6:null,c_36:0,c_3Comment6:null,c_46:0,c_4Comment6:null,c_56:0,c_5Comment6:null,Comments6:null,Total6:0,Score1Comment:null,Score2Comment:null,Score3Comment:null,Score4Comment:null,Score5Comment:null,Score6Comment:null,Score7Comment:null,Score8Comment:null,FCAToTal:0,FCAResult:null,LEPDC:null,LAPC:null,LComment:null,DocId:response.docID,LName:response.docName,LPosition:"",Chest:0,Lsign:response.docSign,LDate:date,Created_by:null,Last_updated_by:null,CalId:CalID},oriInfo=angular.copy($scope.info)):"update"==response.status?(insert=!1,$scope.isNew=!1,$scope.info={id:response.data.id,patientId:response.data.patientId,fName:response.data.fName,JAF:response.data.JAF,DOB:response.data.DOB,DOA:response.data.DOA,IsConsentReason:response.data.IsConsentReason,fsign:response.data.fsign,fsignDate:response.data.fsignDate,Estimated:response.data.Estimated,EstimatedComments:response.data.EstimatedComments,MS_HeartConditions:response.data.MS_HeartConditions,MS_HeartConditions_Comment:response.data.MS_HeartConditions_Comment,MS_Lung_Asthma:response.data.MS_Lung_Asthma,MS_Lung__Asthma_Comment:response.data.MS_Lung__Asthma_Comment,MS_Diabetes:response.data.MS_Diabetes,MS_Diabetes_Comment:response.data.MS_Diabetes_Comment,MS_Fits:response.data.MS_Fits,MS_Fits_Comment:response.data.MS_Fits_Comment,MS_Medication:response.data.MS_Medication,MS_Medication_Comment:response.data.MS_Medication_Comment,MS_Other:response.data.MS_Other,MS_Other_Comment:response.data.MS_Other_Comment,MS_ie_Comment:response.data.MS_ie_Comment,MS_Mx_Heart_Rage_1:response.data.MS_Mx_Heart_Rage_1,MS_Mx_Heart_Rage_2:response.data.MS_Mx_Heart_Rage_2,MS_Mx_Weight_1:response.data.MS_Mx_Weight_1,MS_MX_Weight_2:response.data.MS_MX_Weight_2,MS_Blood_Pressure_1:response.data.MS_Blood_Pressure_1,MS_Blood_Pressure_2:response.data.MS_Blood_Pressure_2,MS_Resting_Heart_Rate:response.data.MS_Resting_Heart_Rate,Rom_Neck1:response.data["1Rom_Neck"],Rom_Thoracic1:response.data["1Rom_Thoracic"],Rom_Lumbar1:response.data["1Rom_Lumbar"],Rom_Shoulder1:response.data["1Rom_Shoulder"],Rom_Elbow1:response.data["1Rom_Elbow"],Rom_Wrist1:response.data["1Rom_Wrist"],Rom_Fingers1:response.data["1Rom_Fingers"],Rom_Hips1:response.data["1Rom_Hips"],Rom_Knees1:response.data["1Rom_Knees"],Rom_Ankles1:response.data["1Rom_Ankles"],Rom_Comments1:response.data["1Rom_Comments"],Rom_Total1:response.data["1Rom_Total"],Heart_Rate_30S2:response.data["2Heart_Rate_30S"],Heart_Rate_1M2:response.data["2Heart_Rate_1M"],Heart_Rate_1M_30S2:response.data["2Heart_Rate_1M_30S"],Heart_Rate_2M2:response.data["2Heart_Rate_2M"],Heart_Rate_2M_30S2:response.data["2Heart_Rate_2M_30S"],Heart_Rate_3M2:response.data["2Heart_Rate_3M"],Heart_Rate_1M_Post2:response.data["2Heart_Rate_1M_Post"],Step_Result2:response.data["2Step_Result"],Step_Correct2:response.data["2Step_Correct"],Comments2:response.data["2Comments"],Total2:response.data["2Total"],a_Right3:response.data["3a_Right"],a_Left3:response.data["3a_Left"],b_Right3:response.data["3b_Right"],b_Left3:response.data["3b_Left"],c_Grip3:response.data["3c_Grip"],c_Right3:response.data["3c_Right"],c_Left3:response.data["3c_Left"],c_Result3:response.data["3c_Result"],d_Push_ups_total3:response.data["3d_Push_ups_total"],d_Result3:response.data["3d_Result"],e_total3:response.data["3e_total"],e_Result3:response.data["3e_Result"],Comments3:response.data["3Comments"],Total3:response.data["3Total"],aSec4:response.data["4aSec"],aResult4:response.data["4aResult"],bTotal4:response.data["4bTotal"],bCrepitus4:response.data["4bCrepitus"],bResult4:response.data["4bResult"],cKneeling4:response.data["4cKneeling"],cResult4:response.data["4cResult"],Comments4:response.data["4Comments"],Total4:response.data["4Total"],aPosture5:response.data["5aPosture"],bHoverResult5:response.data["5bHoverResult"],cStrenght5:response.data["5cStrenght"],cResult5:response.data["5cResult"],dTotal5:response.data["5dTotal"],dResult5:response.data["5dResult"],eWaitesBow5:response.data["5eWaitesBow"],eResult5:response.data["5eResult"],fRight5:response.data["5fRight"],fLeft5:response.data["5fLeft"],gRight5:response.data["5gRight"],gFloat5:response.data["5gFloat"],Total5:response.data["5Total"],aMax6:response.data["6aMax"],aResult6:response.data["6aResult"],bMax6:response.data["6bMax"],bResult6:response.data["6bResult"],c_16:response.data["6c_1"],c_1Comment6:response.data["6c_1Comment"],c_26:response.data["6c_2"],c_2Comment6:response.data["6c_2Comment"],c_36:response.data["6c_3"],c_3Comment6:response.data["6c_3Comment"],c_46:response.data["6c_4"],c_4Comment6:response.data["6c_4Comment"],c_56:response.data["6c_5"],c_5Comment6:response.data["6c_5Comment"],Comments6:response.data["6Comments"],Total6:response.data["6Total"],Score1Comment:response.data.Score1Comment,Score2Comment:response.data.Score2Comment,Score3Comment:response.data.Score3Comment,Score4Comment:response.data.Score4Comment,Score5Comment:response.data.Score5Comment,Score6Comment:response.data.Score6Comment,Score7Comment:response.data.Score7Comment,Score8Comment:response.data.Score8Comment,FCAToTal:response.data.FCAToTal,FCAResult:response.data.FCAResult,LEPDC:response.data.LEPDC,LAPC:response.data.LAPC,LComment:response.data.LComment,Created_by:response.data.Created_by,Lsign:response.data.Lsign,LName:response.data.LName,LDate:response.data.LDate,LPosition:response.data.LPosition,Chest:response.data.Chest,Last_updated_by:response.data.Last_updated_by,CalId:response.data.CalId,DocId:response.data.DocId},oriInfo=angular.copy($scope.info),$scope.totalComment()):"error"==response.status&&toastr.error("Fail","Error")}),$scope.submitGorgonFA=function(gorgonFAForm){if($scope.showClickedValidation=!0,gorgonFAForm.$invalid)toastr.error("Please Input All Required Information!","Error");else if(1==insert){var info=$scope.info;DocumentService.insertGorgonFA(info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonFA",null,{reload:!0})):toastr.error("Fail","Error")})}else DocumentService.editGorgonFA($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonFA",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.gorgonMA.controllers",[]).controller("gorgonMAController",function($scope,$filter,DocumentService,ConfigService,$http,$cookieStore,$state,toastr,$stateParams,localStorageService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.patientInfo=localStorageService.get("tempPatient");var CalID=$stateParams.cal_id,Patient_ID=$scope.patientInfo.Patient_id;$scope.checkAudiogram=function(){1==$scope.info.AUDIOGRAM&&($scope.info.RIGHT_EAR_500=null,$scope.info.RIGHT_EAR_1000=null,$scope.info.RIGHT_EAR_1500=null,$scope.info.RIGHT_EAR_2000=null,$scope.info.RIGHT_EAR_3000=null,$scope.info.RIGHT_EAR_4000=null,$scope.info.RIGHT_EAR_6000=null,$scope.info.RIGHT_EAR_8000=null,$scope.info.LEFT_EAR_500=null,$scope.info.LEFT_EAR_1000=null,$scope.info.LEFT_EAR_1500=null,$scope.info.LEFT_EAR_2000=null,$scope.info.LEFT_EAR_3000=null,$scope.info.LEFT_EAR_4000=null,$scope.info.LEFT_EAR_6000=null,$scope.info.LEFT_EAR_8000=null)},$scope.checkSpirometry=function(){1==$scope.info.SPIROMETRY&&($scope.info.PRE_BR1_V1=null,$scope.info.PRE_BR1_V2=null,$scope.info.PRE_BR1_V3=null,$scope.info.PRE_BR1_V4=null,$scope.info.PRE_BR1_V5=null,$scope.info.PRE_BR1_V6=null,$scope.info.PRE_BR1_V7=null,$scope.info.PRE_BR2_V1=null,$scope.info.PRE_BR2_V2=null,$scope.info.PRE_BR2_V3=null,$scope.info.PRE_BR2_V4=null,$scope.info.PRE_BR2_V5=null,$scope.info.PRE_BR2_V6=null,$scope.info.PRE_BR2_V7=null)};{var date=new Date;$filter("date")(date,"dd/MM/yyyy")}$scope.maxDate=new Date(date.getFullYear()-1,date.getMonth(),date.getDate()),$scope.info={GORGON_ID:null,PATIENT_ID:Patient_ID,PHOTO_ID:null,HAND_DOR:null,HEIGHT:null,WEIGHT:null,PROTEIN:null,GLUCOSE:null,BLOOD:null,CANNABIS:null,OPIATES:null,AMPHETS:null,ANCOHOL:null,BENZOS:null,COCAIN:null,METHAMPH:null,AUDIOGRAM:0,SPIROMETRY:0,SPIROMETRY_STATIS:null,CANDIDATE_EVER:null,YES_TO_EITHER:null,SPI_EXAMINERS_COMMENTS:null,VA_UNCORRECTED_LEFT:null,VA_UNCORRECTED_RIGHT:null,VA_CORRECTED_LEFT:null,VA_CORRECTED_RIGHT:null,NV_UNCORRECTED_LEFT:null,NV_UNCORRECTED_RIGHT:null,NV_CORRECTED_LEFT:null,NV_CORRECTED_RIGHT:null,VF_LEFT:null,VF_RIGHT:null,ISHIHARA_RESPONSE:null,AS_Nil:0,AS_Wide:0,AS_Basal:0,AS_Wheezes:0,AS_Rub:0,EC_normal:0,EC_dermatitis:0,EC_fungal:0,EC_structural:0,EC_wax:0,TM_normal:0,TM_effusion:0,TM_wet:0,TM_dry:0,SYSTOLIC_BP:null,DIASTOLIC_BP:null,PULSE:null,HEART_RHYTHM:null,HEART_SOUNDS:null,PACEMAKER:null,CHEST:null,UPPER_ZONES:null,LOWER_ZONES:null,ECZEMA:null,PSORIASIS:null,TINEA:null,SOLAR_DAMAGE:null,FOLLICULITIS:null,EC_OTHER:null,SKIN_EXAMINERS_COMMENTS:null,SCARS_NIL:0,SCARS_APPENDIX:0,SCARS_GALLBLADDER:0,SCARS_HERNIA:0,SCARS_OTHER:0,HERNIAL:null,HERNIAL_LEFT:0,HERNIAL_RIGHT:0,RECTUS:null,MUSCLE_TONE:null,MUSCLE_POWER:null,MUSCLE_WASTING:null,TREMOR:null,GAIT:null,LOWER_LEFT:null,LOWER_RIGHT:null,CNS_COMMENTS:null,NECK_POSTURE:null,NECK_RHYTHM:null,NECK_FLEXION:null,NECK_EXTENSION:null,NECK_LATERAL:null,NECK_ROTATION:null,BACK_POSTURE:null,BACK_RHYTHM:null,BACK_FLEXION:null,BACK_EXTENSION:null,BACK_LATERAL:null,BACK_ROTATION:null,BACK_EXAMINERS_COMMENTS:null,SHOULDER:null,ELBOWS:null,WRISTS:null,KNEES:null,ANKLES:null,GRIP_STRENGTH:null,EPICONDYLES:null,HEEL_WALK:null,DUCK_WALK:null,TOE_WALK:null,RHOMBERGS:null,FUTHER_COMMENTS:null,LIMB_EXAMINERS_COMMENTS:null,GORGON_DATE:null,SIGNATURE:null,Created_by:null,Last_updated_by:null,CalId:CalID,EXAMINER_NAME:null,EXAMINER_ADDRESS:null,RIGHT_EAR_500:null,RIGHT_EAR_1000:null,RIGHT_EAR_1500:null,RIGHT_EAR_2000:null,RIGHT_EAR_3000:null,RIGHT_EAR_4000:null,RIGHT_EAR_6000:null,RIGHT_EAR_8000:null,LEFT_EAR_500:null,LEFT_EAR_1000:null,LEFT_EAR_1500:null,LEFT_EAR_2000:null,LEFT_EAR_3000:null,LEFT_EAR_4000:null,LEFT_EAR_6000:null,LEFT_EAR_8000:null,PRE_BR1_V1:null,PRE_BR1_V2:null,PRE_BR1_V3:null,PRE_BR1_V4:null,PRE_BR1_V5:null,PRE_BR1_V6:null,PRE_BR1_V7:null,PRE_BR2_V1:null,PRE_BR2_V2:null,PRE_BR2_V3:null,PRE_BR2_V4:null,PRE_BR2_V5:null,PRE_BR2_V6:null,PRE_BR2_V7:null,PROTEIN_COMMENT:null,GLUCOSE_COMMENT:null,BLOOD_COMMENT:null,DocId:null,docName:null,docSign:null};var oriInfo;$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonMAForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)};var len,str,totalCom="";$scope.collectComment=function(){$scope.info.BLOOD_COMMENT=1==$scope.info.BLOOD?"":$scope.info.BLOOD_COMMENT,$scope.info.GLUCOSE_COMMENT=1==$scope.info.GLUCOSE?"":$scope.info.GLUCOSE_COMMENT,$scope.info.PROTEIN_COMMENT=1==$scope.info.PROTEIN?"":$scope.info.PROTEIN_COMMENT,$scope.info.SPI_EXAMINERS_COMMENTS=(null!=$scope.info.PROTEIN_COMMENT&&""!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT+"\n":"")+(null!=$scope.info.GLUCOSE_COMMENT&&""!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT+"\n":"")+(null!=$scope.info.BLOOD_COMMENT&&""!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT+"\n":"")+totalCom},$scope.totalComment=function(){"undefined"==typeof $scope.info.SPI_EXAMINERS_COMMENTS&&($scope.info.SPI_EXAMINERS_COMMENTS=(null!=$scope.info.PROTEIN_COMMENT&&""!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT+"\n":"")+(null!=$scope.info.GLUCOSE_COMMENT&&""!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT+"\n":"")+(null!=$scope.info.BLOOD_COMMENT&&""!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT+"\n":"")),len=(null!=$scope.info.PROTEIN_COMMENT?$scope.info.PROTEIN_COMMENT.length:0)+(null!=$scope.info.GLUCOSE_COMMENT?$scope.info.GLUCOSE_COMMENT.length:0)+(null!=$scope.info.BLOOD_COMMENT?$scope.info.BLOOD_COMMENT.length:0),str=$scope.info.SPI_EXAMINERS_COMMENTS.replace("\n",""),str=str.replace("\n",""),str=str.replace("\n",""),totalCom=str.substr(len)};var insert=!0;DocumentService.checkGorgonMA(Patient_ID,CalID).then(function(response){"insert"===response.status?(insert=!0,$scope.isNew=!0,$scope.info.DocId=response.DocId,$scope.info.docName=response.docName,$scope.info.docSign=response.docSign,oriInfo=angular.copy($scope.info),console.log($scope.info)):"update"==response.status?(insert=!1,$scope.isNew=!1,console.log(response.data),$scope.info=angular.copy(response.data),$scope.info.docName=response.docName,$scope.info.docSign=response.docSign,oriInfo=angular.copy($scope.info),$scope.totalComment()):"error"==response.status&&toastr.error("Fail","Error")}),$scope.submitGorgonMA=function(gorgonMAForm){$scope.showClickedValidation=!0,gorgonMAForm.$invalid?(toastr.error("Please Input All Required Information!","Error"),ConfigService.focus_input(gorgonMAForm)):1==insert?DocumentService.insertGorgonMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.gorgonMA",null,{reload:!0})):toastr.error("Add new fail!","Error")}):DocumentService.editGorgonMA($scope.info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.gorgonMA",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}),angular.module("app.loggedIn.document.gorgonMH.controllers",[]).controller("gorgonMHController",function($filter,DocumentService,$scope,$rootScope,$http,$cookieStore,toastr,$state,$stateParams,localStorageService,ConfigService){$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.today=new Date;var userInfo=$cookieStore.get("userInfo");if(void 0===userInfo)console.log("ERROR: Cookies not exist"),$state.go("loggedIn.home",null,{reload:!0});else{var tempSignature;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature=tempSignature},$scope.clearClick=function(){$scope.info.Signature=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature};var tempPatient=localStorageService.get("tempPatient")||[];if(null===tempPatient||"undefined"===tempPatient)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load some information fail, please try again!","Error");else{var patient_id=tempPatient.Patient_id,cal_id=$stateParams.cal_id;$scope.info={Gorgon_Id:null,Patient_Id:patient_id,JobNo:null,Occupation:null,JobLocation:null,SpecificLocation:null,PhoneNumber:null,Q1_YearFrom1:new Date,Q1_YearFrom2:new Date,Q1_YearTo1:new Date,Q1_YearTo2:new Date,Q1_Job1:null,Q1_Job2:null,Q1_Employer1:null,Q1_Employer2:null,Q1_TypeOfWork:null,Q1_WorkPast:null,Q1_WorkEnvironment:null,Q1_AnyProblems:null,Q1_CauseProblems:null,Q1_Underground:null,Q1_GrainDust:null,Q1_RemoteEnv:null,Q1_AtHeights:null,Q1_WetConditions:null,Q1_Nickel:null,Q1_HumidConditions:null,Q1_FIFO:null,Q1_FIFODone:null,Q1_FIFOProblems:null,Q1_ShiftWork:null,Q1_ShiftWorkDone:null,Q1_ShiftWorkProblems:null,Q1_SafetyEquipment:null,Q1_ExaminersComments:null,Q2_Operation:null,Q2_Accident:null,Q2_SportsInjury:null,Q2_YesWhen:null,Q2_TimeOfWork:null,Q2_HowLongOff:null,Q2_HowLongModified:null,Q2_HowLongTreatment:null,Q2_NormalDuties:null,Q2_Compensation:null,Q2_PsychologicalProblems:null,Q2_ExaminersComments:null,Q2_DentalHealth:null,Q2_Diabetic:null,Q2_Seizure:null,Q2_Epileptic:null,Q2_Asthmatic:null,Q2_AnyScars:null,Q2_MedicAlert:null,Q3_NeckInjury:null,Q3_DiskInjury:null,Q3_Backache:null,Q3_Physio:null,Q3_BackInjury:null,Q3_Sciatica:null,Q3_BackSurgery:null,Q3_SwollenJoints:null,Q3_ArthriticKnee:null,Q3_Arm:null,Q3_HandInjury:null,Q3_LegInjury:null,Q3_KneeCartilage:null,Q3_KneeReconstruction:null,Q3_FootProblems:null,Q3_OtherBone:null,Q3_Rheumatism:null,Q3_RSI:null,Q3_Hernia:null,Q4_MentalHealth:null,Q4_Psychologist:null,Q4_DrugsProblems:null,Q4_Depression:null,Q4_PanicAttacks:null,Q4_NervousProblem:null,Q4_Anxiety:null,Q4_Insomnia:null,Q5_Eczema:null,Q5_Psoriasis:null,Q5_SkinProblem:null,Q5_Dermatitis:null,Q5_SkinCancers:null,Q6_Asthma:null,Q6_LungDisease:null,Q6_Artery:null,Q6_HighBloodPressure:null,Q6_DVT:null,Q6_UsedPuffer:null,Q6_CardiacPacemaker:null,Q6_Emphysema:null,Q6_HeartDisease:null,Q6_Bronchitis:null,Q6_CollapsedLung:null,Q6_HeartAttack:null,Q7_HeadInjury:null,Q7_Epilepsy:null,Q7_SevereHeadaches:null,Q7_NeurologicalDisorder:null,Q8_DOInsulin:null,Q8_DOMedication:null,Q8_DietControl:null,Q8_KidneyProblems:null,Q8_LiverDisease:null,Q8_HearingLoss:null,Q8_Exhaustion:null,Q8_Arthritis:null,Q8_BloodDisorder:null,Q8_Cancer:null,Q8_BowelProblems:null,Q8_Hepatitis:null,Q8_VisionProblem:null,Q8_ChronicIllness:null,Q9_Pregnant:null,Q9_BreastFeeding:null,Q9_ExaminersComments:null,Q10_Disabilities:null,Q11_Climb:null,Q11_Bend:null,Q11_WorkOverhead:null,Q11_WorkHeights:null,Q11_WorkIsolation:null,Q11_Instruments:null,Q11_WorkAwkward:null,Q11_Squat:null,Q11_Push:null,Q11_WorkUnderground:null,Q11_WorkDusty:null,Q11_WorkConfined:null,Q11_WorkGround:null,Q11_WorkVibration:null,Q12_LossFullBack:null,Q12_LossFullLeg:null,Q12_DifficultyHearing:null,Q12_LossEye:null,Q12_Glasses:null,Q12_OtherLoss:null,Q12_LossFullMovements:null,Q12_OtherProblem:null,Q12_LossFullArm:null,Q12_Psychological:null,Q12_Breathing:null,Q12_ChronicSkin:null,Q12_AlcoholMisuse:null,Q12_LossMobility:null,Q12_LossFullNeck:null,Q12_ExaminersComments:null,Q13_AdvisedToChange:null,Q13_AdvisedToChangeComment:null,Q13_AdvisedToLimit:null,Q13_AdvisedToLimitComment:null,Q13_OffInjury:null,Q13_OffInjuryComment:null,Q13_WhatWas:null,Q13_Medi_Vac:null,Q13_Details:null,Q13_ExaminersComments:null,Q14_WorkRelatedDisease:null,Q14_Year:null,Q14_HowLongOff:null,Q14_HowLongModified:null,Q14_HowLongTreatment:null,Q14_NormalDuties:null,Q14_Compensation:null,Q14_Psychological:null,Q14_Details:null,Q14_WCClaim:null,Q14_ExaminersComments:null,Q15_TakeMedications:null,Q15_ListMedication:null,Q16_HayFever:null,Q16_Eczema:null,Q16_Allergic:null,Q16_Adrenaline:null,Q16_Epipen:null,Q16_Asthma:null,Q17_QFever:null,Q17_HepatitisA:null,Q17_Tetanus:null,Q17_HepatitisB:null,Q17_ExaminersComments:null,Q18_IncreasedCough:null,Q18_ChestIllness:null,Q18_SOBHurrying:null,Q18_SOBwalking:null,Q18_SOBWakeUp:null,Q18_CESWheezy:null,Q18_CEFTight:null,Q18_GivenPuffer:null,Q18_LastTimePuffer:null,Q19_Smoke:null,Q19_SmokeDay:null,Q19_SmokeWeek:null,Q19_SmokeYear:null,Q20_DrinkWeek:null,Q20_DrinkMax:null,Q21_Exercise:null,Q21_PlaySport:null,Q21_SportDetails:null,Q21_IsFootball:null,Q21_IsGolf:null,Q21_IsTennis:null,Q21_IsSquash:null,Q21_IsBowls:null,Q21_IsGym:null,Q21_IsOther:null,Q22_SleepDisorder:null,Q22_Choking:null,Q22_UseCPAP:null,Q23_SittingReading:null,Q23_WatchingTV:null,Q23_Inactive:null,Q23_Passenger:null,Q23_LyingDown:null,Q23_SittingTalking:null,Q23_SittingQuietly:null,Q23_InACar:null,Q23_TotalScore:null,Signature:null,GorgonDate:new Date,Created_by:null,Last_updated_by:null,CalId:cal_id,DocId:null,Q21_IsComment:null,Q21Other1Comment:null,PATIENT_SIGNATURE:null};var oriInfo;$scope.totals=[{id:0},{id:1},{id:2},{id:3}],$scope.maxDate=new Date;var info=$scope.info;DocumentService.loadGGMH(info).then(function(response){if("fail"===response.status)$state.go("loggedIn.home",null,{reload:!0});else if("findNull"===response[0].status)$scope.isNew=!0,$scope.info.patient=response[0].patient,$scope.info.Created_by=userInfo.id,oriInfo=angular.copy($scope.info);else if("findFound"===response[0].status){$scope.isNew=!1;var data=response[0].data;$scope.info={patient:response[0].patient,Gorgon_Id:data.Gorgon_Id,Patient_Id:patient_id,JobNo:data.JobNo,Occupation:data.Occupation,JobLocation:data.JobLocation,SpecificLocation:data.SpecificLocation,PhoneNumber:data.PhoneNumber,Q1_YearFrom1:data.Q1_YearFrom1,Q1_YearFrom2:data.Q1_YearFrom2,Q1_YearTo1:data.Q1_YearTo1,Q1_YearTo2:data.Q1_YearTo2,Q1_Job1:data.Q1_Job1,Q1_Job2:data.Q1_Job2,Q1_Employer1:data.Q1_Employer1,Q1_Employer2:data.Q1_Employer2,Q1_TypeOfWork:data.Q1_TypeOfWork,Q1_WorkPast:data.Q1_WorkPast,Q1_WorkEnvironment:data.Q1_WorkEnvironment,Q1_AnyProblems:data.Q1_AnyProblems,Q1_CauseProblems:data.Q1_CauseProblems,Q1_Underground:data.Q1_Underground,Q1_GrainDust:data.Q1_GrainDust,Q1_RemoteEnv:data.Q1_RemoteEnv,Q1_AtHeights:data.Q1_AtHeights,Q1_WetConditions:data.Q1_WetConditions,Q1_Nickel:data.Q1_Nickel,Q1_HumidConditions:data.Q1_HumidConditions,Q1_FIFO:data.Q1_FIFO,Q1_FIFODone:data.Q1_FIFODone,Q1_FIFOProblems:data.Q1_FIFOProblems,Q1_ShiftWork:data.Q1_ShiftWork,Q1_ShiftWorkDone:data.Q1_ShiftWorkDone,Q1_ShiftWorkProblems:data.Q1_ShiftWorkProblems,Q1_SafetyEquipment:data.Q1_SafetyEquipment,Q1_ExaminersComments:data.Q1_ExaminersComments,Q2_Operation:data.Q2_Operation,Q2_Accident:data.Q2_Accident,Q2_SportsInjury:data.Q2_SportsInjury,Q2_YesWhen:data.Q2_YesWhen,Q2_TimeOfWork:data.Q2_TimeOfWork,Q2_HowLongOff:data.Q2_HowLongOff,Q2_HowLongModified:data.Q2_HowLongModified,Q2_HowLongTreatment:data.Q2_HowLongTreatment,Q2_NormalDuties:data.Q2_NormalDuties,Q2_Compensation:data.Q2_Compensation,Q2_PsychologicalProblems:data.Q2_PsychologicalProblems,Q2_ExaminersComments:data.Q2_ExaminersComments,Q2_DentalHealth:data.Q2_DentalHealth,Q2_Diabetic:data.Q2_Diabetic,Q2_Seizure:data.Q2_Seizure,Q2_Epileptic:data.Q2_Epileptic,Q2_Asthmatic:data.Q2_Asthmatic,Q2_AnyScars:data.Q2_AnyScars,Q2_MedicAlert:data.Q2_MedicAlert,Q3_NeckInjury:data.Q3_NeckInjury,Q3_DiskInjury:data.Q3_DiskInjury,Q3_Backache:data.Q3_Backache,Q3_Physio:data.Q3_Physio,Q3_BackInjury:data.Q3_BackInjury,Q3_Sciatica:data.Q3_Sciatica,Q3_BackSurgery:data.Q3_BackSurgery,Q3_SwollenJoints:data.Q3_SwollenJoints,Q3_ArthriticKnee:data.Q3_ArthriticKnee,Q3_Arm:data.Q3_Arm,Q3_HandInjury:data.Q3_HandInjury,Q3_LegInjury:data.Q3_LegInjury,Q3_KneeCartilage:data.Q3_KneeCartilage,Q3_KneeReconstruction:data.Q3_KneeReconstruction,Q3_FootProblems:data.Q3_FootProblems,Q3_OtherBone:data.Q3_OtherBone,Q3_Rheumatism:data.Q3_Rheumatism,Q3_RSI:data.Q3_RSI,Q3_Hernia:data.Q3_Hernia,Q4_MentalHealth:data.Q4_MentalHealth,Q4_Psychologist:data.Q4_Psychologist,Q4_DrugsProblems:data.Q4_DrugsProblems,Q4_Depression:data.Q4_Depression,Q4_PanicAttacks:data.Q4_PanicAttacks,Q4_NervousProblem:data.Q4_NervousProblem,Q4_Anxiety:data.Q4_Anxiety,Q4_Insomnia:data.Q4_Insomnia,Q5_Eczema:data.Q5_Eczema,Q5_Psoriasis:data.Q5_Psoriasis,Q5_SkinProblem:data.Q5_SkinProblem,Q5_Dermatitis:data.Q5_Dermatitis,Q5_SkinCancers:data.Q5_SkinCancers,Q6_Asthma:data.Q6_Asthma,Q6_LungDisease:data.Q6_LungDisease,Q6_Artery:data.Q6_Artery,Q6_HighBloodPressure:data.Q6_HighBloodPressure,Q6_DVT:data.Q6_DVT,Q6_UsedPuffer:data.Q6_UsedPuffer,Q6_CardiacPacemaker:data.Q6_CardiacPacemaker,Q6_Emphysema:data.Q6_Emphysema,Q6_HeartDisease:data.Q6_HeartDisease,Q6_Bronchitis:data.Q6_Bronchitis,Q6_CollapsedLung:data.Q6_CollapsedLung,Q6_HeartAttack:data.Q6_HeartAttack,Q7_HeadInjury:data.Q7_HeadInjury,Q7_Epilepsy:data.Q7_Epilepsy,Q7_SevereHeadaches:data.Q7_SevereHeadaches,Q7_NeurologicalDisorder:data.Q7_NeurologicalDisorder,Q8_DOInsulin:data.Q8_DOInsulin,Q8_DOMedication:data.Q8_DOMedication,Q8_DietControl:data.Q8_DietControl,Q8_KidneyProblems:data.Q8_KidneyProblems,Q8_LiverDisease:data.Q8_LiverDisease,Q8_HearingLoss:data.Q8_HearingLoss,Q8_Exhaustion:data.Q8_Exhaustion,Q8_Arthritis:data.Q8_Arthritis,Q8_BloodDisorder:data.Q8_BloodDisorder,Q8_Cancer:data.Q8_Cancer,Q8_BowelProblems:data.Q8_BowelProblems,Q8_Hepatitis:data.Q8_Hepatitis,Q8_VisionProblem:data.Q8_VisionProblem,Q8_ChronicIllness:data.Q8_ChronicIllness,Q9_Pregnant:data.Q9_Pregnant,Q9_BreastFeeding:data.Q9_BreastFeeding,Q9_ExaminersComments:data.Q9_ExaminersComments,Q10_Disabilities:data.Q10_Disabilities,Q11_Climb:data.Q11_Climb,Q11_Bend:data.Q11_Bend,Q11_WorkOverhead:data.Q11_WorkOverhead,Q11_WorkHeights:data.Q11_WorkHeights,Q11_WorkIsolation:data.Q11_WorkIsolation,Q11_Instruments:data.Q11_Instruments,Q11_WorkAwkward:data.Q11_WorkAwkward,Q11_Squat:data.Q11_Squat,Q11_Push:data.Q11_Push,Q11_WorkUnderground:data.Q11_WorkUnderground,Q11_WorkDusty:data.Q11_WorkDusty,Q11_WorkConfined:data.Q11_WorkConfined,Q11_WorkGround:data.Q11_WorkGround,Q11_WorkVibration:data.Q11_WorkVibration,Q12_LossFullBack:data.Q12_LossFullBack,Q12_LossFullLeg:data.Q12_LossFullLeg,Q12_DifficultyHearing:data.Q12_DifficultyHearing,Q12_LossEye:data.Q12_LossEye,Q12_Glasses:data.Q12_Glasses,Q12_OtherLoss:data.Q12_OtherLoss,Q12_LossFullMovements:data.Q12_LossFullMovements,Q12_OtherProblem:data.Q12_OtherProblem,Q12_LossFullArm:data.Q12_LossFullArm,Q12_Psychological:data.Q12_Psychological,Q12_Breathing:data.Q12_Breathing,Q12_ChronicSkin:data.Q12_ChronicSkin,Q12_AlcoholMisuse:data.Q12_AlcoholMisuse,Q12_LossMobility:data.Q12_LossMobility,Q12_LossFullNeck:data.Q12_LossFullNeck,Q12_ExaminersComments:data.Q12_ExaminersComments,Q13_AdvisedToChange:data.Q13_AdvisedToChange,Q13_AdvisedToChangeComment:data.Q13_AdvisedToChangeComment,Q13_AdvisedToLimit:data.Q13_AdvisedToLimit,Q13_AdvisedToLimitComment:data.Q13_AdvisedToLimitComment,Q13_OffInjury:data.Q13_OffInjury,Q13_OffInjuryComment:data.Q13_OffInjuryComment,Q13_WhatWas:data.Q13_WhatWas,Q13_Medi_Vac:data.Q13_Medi_Vac,Q13_Details:data.Q13_Details,Q13_ExaminersComments:data.Q13_ExaminersComments,Q14_WorkRelatedDisease:data.Q14_WorkRelatedDisease,Q14_Year:data.Q14_Year,Q14_HowLongOff:data.Q14_HowLongOff,Q14_HowLongModified:data.Q14_HowLongModified,Q14_HowLongTreatment:data.Q14_HowLongTreatment,Q14_NormalDuties:data.Q14_NormalDuties,Q14_Compensation:data.Q14_Compensation,Q14_Psychological:data.Q14_Psychological,Q14_Details:data.Q14_Details,Q14_WCClaim:data.Q14_WCClaim,Q14_ExaminersComments:data.Q14_ExaminersComments,Q15_TakeMedications:data.Q15_TakeMedications,Q15_ListMedication:data.Q15_ListMedication,Q16_HayFever:data.Q16_HayFever,Q16_Eczema:data.Q16_Eczema,Q16_checkAllergic:data.Q16_checkAllergic,Q16_Allergic:data.Q16_Allergic,Q16_Adrenaline:data.Q16_Adrenaline,Q16_Epipen:data.Q16_Epipen,Q16_Asthma:data.Q16_Asthma,Q17_QFever:data.Q17_QFever,Q17_HepatitisA:data.Q17_HepatitisA,Q17_Tetanus:data.Q17_Tetanus,Q17_HepatitisB:data.Q17_HepatitisB,Q17_ExaminersComments:data.Q17_ExaminersComments,Q18_IncreasedCough:data.Q18_IncreasedCough,Q18_ChestIllness:data.Q18_ChestIllness,Q18_SOBHurrying:data.Q18_SOBHurrying,Q18_SOBwalking:data.Q18_SOBwalking,Q18_SOBWakeUp:data.Q18_SOBWakeUp,Q18_CESWheezy:data.Q18_CESWheezy,Q18_CEFTight:data.Q18_CEFTight,Q18_GivenPuffer:data.Q18_GivenPuffer,Q18_LastTimePuffer:data.Q18_LastTimePuffer,Q19_Smoke:data.Q19_Smoke,Q19_SmokeDay:data.Q19_SmokeDay,Q19_SmokeWeek:data.Q19_SmokeWeek,Q19_SmokeYear:data.Q19_SmokeYear,
Q20_DrinkWeek:data.Q20_DrinkWeek,Q20_DrinkMax:data.Q20_DrinkMax,Q21_Exercise:data.Q21_Exercise,Q21_PlaySport:data.Q21_PlaySport,Q21_SportDetails:data.Q21_SportDetails,Q21_IsFootball:data.Q21_IsFootball,Q21_IsGolf:data.Q21_IsGolf,Q21_IsTennis:data.Q21_IsTennis,Q21_IsSquash:data.Q21_IsSquash,Q21_IsBowls:data.Q21_IsBowls,Q21_IsGym:data.Q21_IsGym,Q21_IsOther:data.Q21_IsOther,Q22_SleepDisorder:data.Q22_SleepDisorder,Q22_Choking:data.Q22_Choking,Q22_UseCPAP:data.Q22_UseCPAP,Q23_SittingReading:data.Q23_SittingReading,Q23_WatchingTV:data.Q23_WatchingTV,Q23_Inactive:data.Q23_Inactive,Q23_Passenger:data.Q23_Passenger,Q23_LyingDown:data.Q23_LyingDown,Q23_SittingTalking:data.Q23_SittingTalking,Q23_SittingQuietly:data.Q23_SittingQuietly,Q23_InACar:data.Q23_InACar,Q23_TotalScore:data.Q23_TotalScore,Signature:data.Signature,GorgonDate:data.GorgonDate,Created_by:data.Created_by,Last_updated_by:userInfo.id,CalId:data.CalId,DocId:data.DocId,Q21_IsComment:data.Q21Other1Comment,Q21Other1Comment:data.Q21Other1Comment,PATIENT_SIGNATURE:data.PATIENT_SIGNATURE};for(var Examiner_Comments=$scope.info.Q9_ExaminersComments,temp=[],i=0;""!=Examiner_Comments&&null!=Examiner_Comments&&"undefined"!=Examiner_Comments;){var location=Examiner_Comments.search("\r\n");-1==location?(temp[i]=Examiner_Comments,Examiner_Comments=""):(temp[i]=Examiner_Comments.substring(0,location),Examiner_Comments=Examiner_Comments.substring(temp[i].length+2,Examiner_Comments.length)),i++}$scope.info.Q3_ExaminersComments=temp[0],$scope.info.Q4_ExaminersComments=temp[1],$scope.info.Q5_ExaminersComments=temp[2],$scope.info.Q6_ExaminersComments=temp[3],$scope.info.Q7_ExaminersComments=temp[4],$scope.info.Q8_ExaminersComments=temp[5],$scope.info.Q9_ExaminersComments_details=temp[6],oriInfo=angular.copy($scope.info)}else $state.go("loggedIn.home",null,{reload:!0})}),$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonMHForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.submit=function(gorgonMHForm){if($scope.info.Q23_TotalScore=$scope.info.Q23_SittingReading+$scope.info.Q23_WatchingTV+$scope.info.Q23_Inactive+$scope.info.Q23_Passenger+$scope.info.Q23_LyingDown+$scope.info.Q23_SittingTalking+$scope.info.Q23_SittingQuietly+$scope.info.Q23_InACar+0,$scope.info.Q9_ExaminersComments=(null!=$scope.info.Q3_ExaminersComments&&""!=$scope.info.Q3_ExaminersComments&&"undefined"!=$scope.info.Q3_ExaminersComments?$scope.info.Q3_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q4_ExaminersComments&&""!=$scope.info.Q4_ExaminersComments&&"undefined"!=$scope.info.Q4_ExaminersComments?$scope.info.Q4_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q5_ExaminersComments&&""!=$scope.info.Q5_ExaminersComments&&"undefined"!=$scope.info.Q5_ExaminersComments?$scope.info.Q5_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q6_ExaminersComments&&""!=$scope.info.Q6_ExaminersComments&&"undefined"!=$scope.info.Q6_ExaminersComments?$scope.info.Q6_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q7_ExaminersComments&&""!=$scope.info.Q7_ExaminersComments&&"undefined"!=$scope.info.Q7_ExaminersComments?$scope.info.Q7_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q8_ExaminersComments&&""!=$scope.info.Q8_ExaminersComments&&"undefined"!=$scope.info.Q8_ExaminersComments?$scope.info.Q8_ExaminersComments:"")+"\r\n"+(null!=$scope.info.Q9_ExaminersComments_details&&""!=$scope.info.Q9_ExaminersComments_details&&"undefined"!=$scope.info.Q9_ExaminersComments_details?$scope.info.Q9_ExaminersComments_details:""),gorgonMHForm.$error.maxlength||gorgonMHForm.$error.required)toastr.error("Please Input All Required Information!","Error"),ConfigService.focus_input(gorgonMHForm);else{var info=$scope.info;$scope.isNew===!0?DocumentService.insertGGMH(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$state.go("loggedIn.gorgonMH",null,{reload:!0})):"fail"===response.status&&toastr.error("Add new fail!","Error")}):$scope.isNew===!1&&DocumentService.editGGMH(info).then(function(response){"success"===response.status?(toastr.success("Update success!","Success"),$state.go("loggedIn.gorgonMH",null,{reload:!0})):"fail"===response.status&&toastr.error("Update fail!","Error")})}}}}}),angular.module("app.loggedIn.document.gorgonUQ.controllers",[]).controller("gorgonUQController",function($scope,$filter,DocumentService,$http,$cookieStore,localStorageService,$state,toastr,$window,$stateParams){function getAge(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();return(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,age}$scope.dateOptions={formatYear:"yy",startingDay:1};"undefined"!==$cookieStore.get("userInfo")?$cookieStore.get("userInfo"):"fail";$scope.patientInfo=localStorageService.get("tempPatient");var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id;$scope.info={Patient_Id:Patient_ID,CalId:CalID};var oriInfo=angular.copy($scope.info);$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.gorgonUQForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},$scope.checkUseRespirator=function(value){1==value&&($scope.info.isEyeIrritation=null,$scope.info.isSkinAllergies=null,$scope.info.isAnxiety=null,$scope.info.isGeneralWeakness=null,$scope.info.isOtherProblem=null)},DocumentService.checkUser(Patient_ID,CalID).then(function(response){if("fail"===response[0].status)$state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error");else if("findNull"===response[0].status){var date=new Date;$scope.isNew=!0,$scope.maxDate=new Date(date.getFullYear()-1,date.getMonth(),date.getDate())}else"findFound"===response[0].status?$scope.isNew=!1:($state.go("loggedIn.home",null,{reload:!0}),toastr.error("Load fail!","Error"));var data=response[0].data;$scope.info={Quest_Id:data.Quest_Id,Patient_Id:Patient_ID,age:getAge($scope.patientInfo.DOB),sex:$scope.patientInfo.Sex,TodayDate:data.TodayDate||new Date,Height:data.Height,Weight:data.Weight,JobTitle:data.JobTitle,PhoneNumber:data.PhoneNumber,BestTime:data.BestTime,isReviewQuest:data.isReviewQuest,isNRP:data.isNRP,isOtherType:data.isOtherType,isRespirator:data.isRespirator,RespiratorType:data.RespiratorType,isSmoke:data.isSmoke,isSeizuresCondition:data.isSeizuresCondition,isDiabetes:data.isDiabetes,isAllergicReactions:data.isAllergicReactions,isClaustrophobia:data.isClaustrophobia,isTrouble:data.isTrouble,isAsbestosis:data.isAsbestosis,isAsthma:data.isAsthma,isBronchitis:data.isBronchitis,isEmphysema:data.isEmphysema,isPneumonia:data.isPneumonia,isTuberculosis:data.isTuberculosis,isSilicosis:data.isSilicosis,isPneumothorax:data.isPneumothorax,isLungCancer:data.isLungCancer,isBrokenRibs:data.isBrokenRibs,isInjuries:data.isInjuries,isOtherLung:data.isOtherLung,OtherLungComment:data.OtherLungComment,isSOB:data.isSOB,isSOBWalkingFast:data.isSOBWalkingFast,isSOBWalkingOther:data.isSOBWalkingOther,isStopForBreath:data.isStopForBreath,isSOBWashing:data.isSOBWashing,isSOBInterferes:data.isSOBInterferes,isCoughingPhlegm:data.isCoughingPhlegm,isCoughingMorning:data.isCoughingMorning,isCoughingLyingDown:data.isCoughingLyingDown,isCoughingUpBlood:data.isCoughingUpBlood,isWheezing:data.isWheezing,isWheezingInterferes:data.isWheezingInterferes,isChestPain:data.isChestPain,isOtherSymptomsPulmonary:data.isOtherSymptomsPulmonary,isHeartAttack:data.isHeartAttack,isStroke:data.isStroke,isAngina:data.isAngina,isHeartFailure:data.isHeartFailure,isSwelling:data.isSwelling,isHeartArrhythmia:data.isHeartArrhythmia,isBloodPressureHeart:data.isBloodPressureHeart,isOtherHeart:data.isOtherHeart,OtherHeartComment:data.OtherHeartComment,isFrequentPain:data.isFrequentPain,isPOTPhysical:data.isPOTPhysical,isPOTInterferes:data.isPOTInterferes,isMissingBeat:data.isMissingBeat,isHeartburn:data.isHeartburn,isOtherSymptomsHeart:data.isOtherSymptomsHeart,isBreathing:data.isBreathing,isHeartTrouble:data.isHeartTrouble,isBloodPressureMedication:data.isBloodPressureMedication,isSeizuresMedication:data.isSeizuresMedication,isEyeIrritation:data.isEyeIrritation,isSkinAllergies:data.isSkinAllergies,isAnxiety:data.isAnxiety,isGeneralWeakness:data.isGeneralWeakness,isOtherProblem:data.isOtherProblem,isTalk:data.isTalk,isLostVision:data.isLostVision,isContactLenses:data.isContactLenses,isWearGlasses:data.isWearGlasses,isColourBlind:data.isColourBlind,isOtherEye:data.isOtherEye,isInjuryEars:data.isInjuryEars,isHearingProblems:data.isHearingProblems,isDifficultyHearing:data.isDifficultyHearing,isHearingAid:data.isHearingAid,isOtherHearing:data.isOtherHearing,isBackInjury:data.isBackInjury,isWeaknessAny:data.isWeaknessAny,isBackPain:data.isBackPain,isDFMArmsLegs:data.isDFMArmsLegs,isDFMHead:data.isDFMHead,isPOSLeanForward:data.isPOSLeanForward,isPODHead:data.isPODHead,isDifficultyBending:data.isDifficultyBending,isDifficultySquatting:data.isDifficultySquatting,isClimbing:data.isClimbing,isOtherMuscle:data.isOtherMuscle,Department:data.Department,SocialSecurity:data.SocialSecurity,Supervisor:data.Supervisor,isAtmosphere:data.isAtmosphere,isContinuous:data.isContinuous,isOpen:data.isOpen,isClose:data.isClose,isSupplied:data.isSupplied,isCombination:data.isCombination,isAir_NonPow:data.isAir_NonPow,isAir_Pow:data.isAir_Pow,LevelOfWE:data.LevelOfWE,ExtentUsage:data.ExtentUsage,LengthOfTime:data.LengthOfTime,WorkCons:data.WorkCons,Safety:data.Safety,HealthCare:data.HealthCare,Class:data.Class,Restrictions:data.Restrictions,UQDate:data.UQDate||new Date,Created_by:data.Created_by,Creation_date:data.Creation_date,Last_updated_by:data.Last_updated_by,Last_update_date:data.Last_update_date,CalId:CalID,DocId:response[0].doctor.doctor_id,SIGNATURE:data.SIGNATURE,isUseRespirator:data.isUseRespirator,patient:response[0].patient,doctor:response[0].doctor},oriInfo=angular.copy($scope.info)}),$scope.submitGorgonUQ=function(gorgonUQForm){$scope.showClickedValidation=!0,gorgonUQForm.$error.required||gorgonUQForm.$error.pattern?toastr.error("Please Input All Required Information!","Error"):1==$scope.isNew?DocumentService.insertUQ($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonUQ",null,{reload:!0})):toastr.error("Fail","Error")}):0==$scope.isNew&&DocumentService.updateUQ($scope.info).then(function(response){"success"===response.status?(toastr.success("Successfully","Success"),$state.go("loggedIn.gorgonUQ",null,{reload:!0})):toastr.error("Fail","Error")})}}),angular.module("app.loggedIn.document.demo.controllers",[]).controller("demoController",function($scope,MODE_ROW,$filter,DocumentService,$http,$cookieStore,$state,toastr,localStorageService){$scope.setPage=function(){$scope.searchObjectMap.offset=($scope.searchObjectMap.currentPage-1)*$scope.searchObjectMap.limit,$scope.loadList()},$scope.reset=function(){$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.loadList()},$scope.loadList=function(){DocumentService.loadPatient($scope.searchObjectMap).then(function(response){"fail"!=response[status]?$scope.list=response:toastr.error("loading fail")})},$scope.goToTimetableDetail=function(list){localStorageService.set("tempPatient",list),$state.go("loggedIn.Detail")};var init=function(){$scope.searchObject={limit:10,offset:0,maxSize:5,currentPage:1,data:{NAME:"",Email:"",Phone:null}},$scope.rows=MODE_ROW,$scope.searchPatientsObject={doctor_id:0,limit:10,offset:0,maxSize:5,currentPage:1,data:{First_name:"",Sur_name:"",Middle_name:"",Post_code:null}},$scope.searchObjectMap=angular.copy($scope.searchPatientsObject),$scope.list={},$scope.loadList(),$scope.dateOptions={formatYear:"yy",startingDay:1}};init()}),angular.module("app.loggedIn.document.detail.controllers",[]).controller("detailController",function($scope,$filter,DocumentService,$http,$cookieStore,$state,localStorageService){$scope.patient=localStorageService.get("tempPatient")}),angular.module("app.loggedIn.document.addPatient.controllers",[]).controller("addPatientController",function($scope,$filter,PatientService,ReceptionistService,toastr,$http,$cookieStore,$state,ConfigService){$scope.params={permission:{create:!0,edit:!1}},$scope.modelObjectMap={},$scope.modelObject={Title:"Mr",First_name:"",Sur_name:"",Middle_name:"",Known_as:"",Address1:"",Address2:"",Post_code:null,Country:"AU",DOB:"",Sex:"Male",Home_phone:null,Work_phone:null,Mobile:null,No_SMS:"0",Account_type:"",Account_holder:"",Account_Seft:null,Medicare_no:null,Ref:null,Exp_medicare:"",Private_fund_id:"",MemberShip_no:null,UPI:null,HCC_Pension_No:null,Exp_pension:"",DVA_No:null,Balance:null,Pays_Gap_Only:"1",Email:"",Suburb:"",Alias_First_name:"",Alias_Sur_name:"",Phone_ext:null},$scope.options={titles:ConfigService.title_option(),sexes:ConfigService.sex_option(),sms:ConfigService.yes_no_option(),countries:ConfigService.country_option(),gaps:ConfigService.yes_no_option(),acc_types:ConfigService.acc_type_option(),app_types:ConfigService.app_type_option()};var init=function(){$scope.modelObjectMap=angular.copy($scope.modelObject)};init(),$scope.insert_step=1,$scope.isSubmit=!1;var reset=function(){$scope.insert_step=1,$scope.modelObjectMap=angular.copy($scope.modelObject)};$scope.insertNextStep=function(form){switch($scope.isSubmit=!0,$scope.insert_step){case 1:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 2:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.insert_step++,$scope.isSubmit=!1);break;case 3:form.$invalid?toastr.error("You got errors to fix","Error"):($scope.modelObjectMap.DOB=ConfigService.getCommonDateDatabase($scope.modelObjectMap.DOB),$scope.modelObjectMap.Exp_medicare=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_medicare),$scope.modelObjectMap.Exp_pension=ConfigService.getCommonDateDatabase($scope.modelObjectMap.Exp_pension),PatientService.insertPatient({patient:$scope.modelObjectMap}).then(function(data){return"success"!=data.status?void toastr.error("Cannot Insert!","Error"):(reset(),toastr.success("Insert Successfully !!!","Success"),void $state.go("loggedIn.demo"))}),$scope.isSubmit=!1)}},$scope.insertBackStep=function(){$scope.insert_step>1&&$scope.insert_step--}}),angular.module("app.loggedIn.document.COE.controllers",[]).controller("COEController",function($scope,$state,DocumentService,$http,$stateParams,$cookieStore,toastr,localStorageService,$filter){var tempSignature,insert=!0;$scope.isSignature=!1,$scope.showSignature=function(){$scope.isSignature=!$scope.isSignature},$scope.cancelClick=function(){$scope.isSignature=!$scope.isSignature,$scope.info.Signature1=tempSignature},$scope.clearClick=function(){$scope.info.Signature1=""},$scope.okClick=function(){$scope.isSignature=!$scope.isSignature,tempSignature=$scope.info.Signature1};var tempSignature1;$scope.isSignature1=!1,$scope.showSignature1=function(){$scope.isSignature1=!$scope.isSignature1},$scope.cancelClick1=function(){$scope.isSignature1=!$scope.isSignature1,$scope.info.Signature2=tempSignature1},$scope.clearClick1=function(){$scope.info.Signature2=""},$scope.okClick1=function(){$scope.isSignature1=!$scope.isSignature1,tempSignature1=$scope.info.Signature2},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.patientInfo=localStorageService.get("tempPatient");{var Patient_ID=$scope.patientInfo.Patient_id,CalID=$stateParams.cal_id,date=new Date;$filter("date")(date,"dd/MM/yyyy")}$scope.info={coe_id:null,DocId:null,DOCTOR_ID:null,CalId:CalID,PatientId:Patient_ID,isEmployed:null,dateEmployed:date,inPosition:null,Signature1:null,coeName:null,coeTitle:null,coeDate:date,Signature2:null};var oriInfo=angular.copy($scope.info);$scope.resetForm=function(){$scope.info=angular.copy(oriInfo),$scope.COEForm.$setPristine()},$scope.infoChanged=function(){return!angular.equals(oriInfo,$scope.info)},DocumentService.checkCOE(Patient_ID,CalID).then(function(response){"fail"===response.status?(insert=!0,$scope.isNew=!0):(insert=!1,$scope.isNew=!1,$scope.info=response,console.log($scope.info),oriInfo=angular.copy($scope.info))}),$scope.submitCOE=function(COEForm){if($scope.showClickedValidation=!0,COEForm.$invalid)toastr.error("Please Input All Required Information!","Error");else{var info=$scope.info;if(1==insert)DocumentService.insertCOE(info).then(function(response){"success"===response.status?(toastr.success("Add new success!","Success"),$scope.isNew=!1,$state.go("loggedIn.COE",null,{reload:!0})):toastr.error("Add new fail!","Error")});else{var info=$scope.info;DocumentService.updateCOE(info).then(function(response){"success"===response.status?(toastr.success("Edit success!","Success"),$state.go("loggedIn.COE",null,{reload:!0})):toastr.error("Edit fail!","Error")})}}}}),angular.module("app.loggedIn.document.newFA.controllers",[]).controller("newFAController",function($scope,$stateParams,$cookieStore,DocumentService,PatientService,toastr,moment){$scope.editMode=null;var fa_id=1*$stateParams.fa_id,patient_id=1*$stateParams.patient_id,cal_id=1*$stateParams.cal_id;$scope.print_fa_id=fa_id,$scope.print_patient_id=patient_id,$scope.print_cal_id=cal_id,$scope.patient_age=null,$scope.header={},$scope.header.Comments="Met all manual handling requirements with good technique.",$scope.header.ASSESSED_DATE=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.patient_info={},$scope.isSignatureShow=!1,$scope.clickedValidation=!1;var getNewFA=function(fa_id){var getHeaderId=fa_id;DocumentService.loadNewHeaderSections(getHeaderId).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.PATIENT_ID=patient_id,$scope.header.CAL_ID=cal_id,$scope.header.ASSESSED_SIGN="",$scope.header.ASSESSED_DATE=moment().format("YYYY-MM-DD hh:mm:ss"),$scope.header.Comments="Met all manual handling requirements with good technique.",getDoctorInfo(cal_id,patient_id),$scope.header.sections.forEach(function(section){section.PATIENT_ID=patient_id,section.CAL_ID=cal_id,DocumentService.loadNewLines(section.SECTION_ID,getHeaderId).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){if(line.PATIENT_ID=patient_id,line.CAL_ID=cal_id,null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}DocumentService.loadNewCommentsAndDetails(line.LINE_ID).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,line.details.forEach(function(detail){if(detail.PATIENT_ID=patient_id,detail.CAL_ID=cal_id,null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}(7===line.SCORE_TYPE1||9===line.SCORE_TYPE1)&&$scope.autoCalculationVal1(line,detail)}),line.comments.forEach(function(comment){comment.PATIENT_ID=patient_id,comment.CAL_ID=cal_id}))})}))})}))})},getExistFA=function(fa_id,patient_id,cal_id){var getHeaderId=fa_id;DocumentService.loadExistHeaderSections(getHeaderId,patient_id,cal_id).then(function(headerAndSectionRes){"error"===headerAndSectionRes.status?toastr.error("Unexpected error","Error!"):($scope.header=headerAndSectionRes.data,$scope.header.ASSESSED_DATE=moment($scope.header.ASSESSED_DATE).format("YYYY-MM-DD hh:mm:ss"),$scope.header.sections.forEach(function(section){DocumentService.loadExistLines(section.SECTION_ID,getHeaderId,patient_id,cal_id).then(function(lineRes){"error"===lineRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(section.lines=lineRes.data,section.lines.forEach(function(line){if(null!==line.PICTURE){var strarr=line.PICTURE.split("\\"),fileName=strarr[strarr.length-1];line.previewPath="https://"+location.host+"/document/fa/images/"+fileName}DocumentService.loadExistCommentsAndDetails(line.LINE_ID,patient_id,cal_id).then(function(detailAndCommentRes){"error"===detailAndCommentRes.status?($scope.header={},toastr.error("Unexpected error","Error!")):(line.details=detailAndCommentRes.data.details,line.comments=detailAndCommentRes.data.comments,line.details.forEach(function(detail){if(null!==detail.PICTURE){var strarr=detail.PICTURE.split("\\"),fileName=strarr[strarr.length-1];detail.previewPath="https://"+location.host+"/document/fa/images/"+fileName}}))})}))})}))})},getPatientInfo=function(patient_id){PatientService.getById(patient_id).then(function(result){null!==result&&(console.log("this is patient info",result),result.Sex="0"===result.Sex?"Male":"Female",$scope.patient_info=result,getPatientAge($scope.patient_info.DOB))})},getDoctorInfo=function(cal_id,patient_id){var userInfo=$cookieStore.get("userInfo"),apptInfo={user_id:userInfo.id};DocumentService.getDoctor(apptInfo).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error"):"no doctor"===result.status?toastr.error("The account treating this assessment have no doctor link with it","Error!"):($scope.header.ASSESSED_NAME=result.data[0].Booking_Person,$scope.header.ASSESSED_SIGN=result.data[0].Signature)})},getPatientAge=function(dateString){var now=new Date,birthDate=new Date(dateString),age=now.getFullYear()-birthDate.getFullYear(),m=now.getMonth()-birthDate.getMonth();(0>m||0===m&&now.getDate()<birthDate.getDate())&&age--,console.log("this is patient age",age),$scope.patient_age=age},checkExistFA=function(fa_id,patient_id,cal_id){DocumentService.checkExistFA(fa_id,patient_id,cal_id).then(function(result){"error"===result.status?toastr.error("Unexpected error!","Error!"):"not existed"===result.status?(getNewFA(fa_id),$scope.editMode=!1):(getExistFA(fa_id,patient_id,cal_id),$scope.editMode=!0)})},init=function(){checkExistFA(fa_id,patient_id,cal_id),getPatientInfo(patient_id)};init();var calculateFunctionsVal1={calAvg:function(line){for(var sum=0,numberOfValue=0,i=0;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&(sum+=1*line.details[i].VAL1_VALUE,numberOfValue++);line.SCORE1=sum/numberOfValue,20!==line.SCORE_TYPE1&&autoRatingVal1(line,line.SCORE1,0)},calMax:function(line){for(var max=1*line.details[0].VAL1_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&1*line.details[i].VAL1_VALUE>max&&(max=1*line.details[i].VAL1_VALUE);line.SCORE1=max,autoRatingVal1(line,line.SCORE1,0)},calMin:function(line){for(var min=1*line.details[0].VAL1_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL1_VALUE&&""!==line.details[i].VAL1_VALUE&&1===line.details[i].VAL1_VALUE_IS_NUMBER&&1*line.details[i].VAL1_VALUE<min&&(min=1*line.details[i].VAL1_VALUE);line.SCORE1=min,autoRatingVal1(line,line.SCORE1,0)}};$scope.autoCalculationVal1=function(line,detail){if(void 0!==detail&&(4===detail.VAL1_ISCHECKBOX||5===detail.VAL1_ISCHECKBOX)){line.RATING_VALUE1=0;for(var i=0;i<line.details.length;i++)if(4===line.details[i].VAL1_ISCHECKBOX)switch(line.details[i].VAL1_CHECKBOX){default:case"0":case"1":line.RATING_VALUE1+=0;break;case"2":line.RATING_VALUE1+=1}else if(5===line.details[i].VAL1_ISCHECKBOX)switch(line.details[i].VAL1_CHECKBOX){default:case"0":line.RATING_VALUE1+=0;break;case"1":line.RATING_VALUE1+=1;break;case"2":line.RATING_VALUE1+=2}switch(line.RATING_VALUE1){default:case 0:line.RATE1="";break;case 1:line.RATE1="Poor";break;case 2:line.RATE1="Fair";break;case 3:line.RATE1="Good";break;case 4:line.RATE1="Excellent"}autoSummary(line)}if(9!==line.SCORE_TYPE1||7!==detail.VAL1_ISVALUE&&8!==detail.VAL1_ISVALUE&&9!==detail.VAL1_ISVALUE&&10!==detail.VAL1_ISVALUE){if(7===line.SCORE_TYPE1&&(7===detail.VAL1_ISVALUE||8===detail.VAL1_ISVALUE||9===detail.VAL1_ISVALUE||10===detail.VAL1_ISVALUE)){var default_details_value=line.details[0].VAL1_VALUE,start_value=5;7!==line.details[0].VAL1_ISVALUE&&8!==line.details[0].VAL1_ISVALUE&&9!==line.details[0].VAL1_ISVALUE&&10!==line.details[0].VAL1_ISVALUE||2!==line.details.length||(line.details[1].VAL1_VALUE=angular.copy(default_details_value))}}else{var default_details_value=line.details[0].VAL1_VALUE,start_value=5;if(2===line.details)line.details[1].VAL1_VALUE=angular.copy(default_details_value);else for(var i=1;i<line.details.length;i++)line.details[i].VAL1_VALUE=angular.copy(start_value),default_details_value>start_value&&(start_value+=5)}if(1===line.ISSCORE1)switch(line.SCORE_TYPE1){case 20:case 3:calculateFunctionsVal1.calAvg(line);break;case 9:line.SCORE1=line.details[line.details.length-1].VAL1_VALUE;break;case 10:calculateFunctionsVal1.calMax(line);break;case 11:calculateFunctionsVal1.calMin(line);break;case 8:autoRatingVal1(line,1*line.SCORE1,0);break;case 12:break;default:line.SCORE1=line.details[line.details.length-1].VAL1_VALUE,autoRatingVal1(line,line.SCORE1,0)}};var calculateFunctionsVal2={calAvg:function(line){for(var sum=0,numberOfValue=0,i=0;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&(sum+=1*line.details[i].VAL2_VALUE,numberOfValue++);line.SCORE2=sum/numberOfValue,20!==line.SCORE_TYPE2&&autoRatingVal2(line,line.SCORE2)},calMax:function(line){for(var max=1*line.details[0].VAL2_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&1*line.details[i].VAL2_VALUE>max&&(max=1*line.details[i].VAL2_VALUE);line.SCORE2=max,autoRatingVal2(line,line.SCORE2)},calMin:function(line){for(var min=1*line.details[0].VAL2_VALUE,i=1;i<line.details.length;i++)null!==line.details[i].VAL2_VALUE&&""!==line.details[i].VAL2_VALUE&&1===line.details[i].VAL2_VALUE_IS_NUMBER&&1*line.details[i].VAL2_VALUE<min&&(min=1*line.details[i].VAL2_VALUE);line.SCORE2=min,autoRatingVal2(line,line.SCORE2)}};$scope.autoCalculationVal2=function(line){if(1===line.ISSCORE2)switch(line.SCORE_TYPE2){case 20:case 3:calculateFunctionsVal2.calAvg(line);break;case 9:line.SCORE2=line.details[line.details.length-1].VAL2_VALUE;break;case 10:calculateFunctionsVal2.calMax(line);break;case 11:calculateFunctionsVal2.calMin(line);break;case 8:autoRatingVal2(line,line.SCORE2);break;default:line.SCORE2=line.details[line.details.length-1].VAL2_VALUE,autoRatingVal2(line,1*line.SCORE2)}};var autoRatingVal1=function(line,valueToRate,totalMode){if(null!==line.RATING_ID1&&""!==line.RATING_ID1){var ratingData={patient_age:$scope.patient_age,patient_gender:$scope.patient_info.Sex,valueToRate:valueToRate,rating_id:line.RATING_ID1};DocumentService.autoRating(ratingData).then(function(result){console.log("this is result",result),"error"===result.status?toastr.error("Something wrong with auto rating function.","Error!"):"unrated"===result.status?(line.RATE1="UNRATED",1!==totalMode&&(line.RATING_VALUE1=null,autoSummary(line))):3===line.SCORE_TYPE1?(console.log("rating result",result),line.RATE1=result.data[0].RATE,line.RATING_VALUE1=line.SCORE1<result.data[0].FROM_VALUE?1:line.SCORE1>result.data[0].TO_VALUE?3:2):(line.RATE1=result.data[0].RATE,1!==totalMode&&(line.RATING_VALUE1=result.data[0].VALUE,autoSummary(line)))})}else if(8===line.SCORE_TYPE1)switch(valueToRate){case 4:line.RATE1="Excellent",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 3:line.RATE1="Good",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 2:line.RATE1="Fair",line.RATING_VALUE1=valueToRate,autoSummary(line);break;case 1:line.RATE1="Poor",line.RATING_VALUE1=valueToRate,autoSummary(line)}},autoRatingVal2=function(line,valueToRate){if(null!==line.RATING_ID2&&""!==line.RATING_ID2){var ratingData={patient_age:$scope.patient_age,patient_gender:$scope.patient_info.Sex,valueToRate:line.SCORE2,rating_id:line.RATING_ID2};DocumentService.autoRating(ratingData).then(function(result){"error"===result.status?toastr.error("Something wrong with auto rating function.","Error!"):"unrated"===result.status?(line.RATE2="UNRATED",line.RATING_VALUE2=null):3===line.SCORE_TYPE1?(console.log("rating result",result),line.RATE2=result.data[0].RATE,line.RATING_VALUE2=line.SCORE2<result.data[0].FROM_VALUE?1:line.SCORE2>result.data[0].TO_VALUE?3:2):(line.RATE2=result.data[0].RATE,line.RATING_VALUE2=result.data[0].VALUE)})}else if(8===line.SCORE_TYPE2)switch(valueToRate){case 4:line.RATE2="Excellent",line.RATING_VALUE2=4;break;case 3:line.RATE2="Good",line.RATING_VALUE2=3;break;case 2:line.RATE2="Fair",line.RATING_VALUE2=2;break;case 1:line.RATE2="Poor",line.RATING_VALUE2=1}},autoSummary=function(line){for(var sectionId=line.SECTION_ID,lineId=line.LINE_ID,detailNeedChanged={},lineTotalInSummary={},i=0;i<$scope.header.sections.length;i++)if($scope.header.sections[i].SECTION_ID===sectionId){for(var j=0;j<$scope.header.sections[i].lines.length;j++)if(1===$scope.header.sections[i].lines[j].LineType){lineTotalInSummary=$scope.header.sections[i].lines[j];for(var k=0;k<$scope.header.sections[i].lines[j].details.length;k++)if($scope.header.sections[i].lines[j].details[k].LineTestRefer===lineId){detailNeedChanged=$scope.header.sections[i].lines[j].details[k];break}break}break}detailNeedChanged.VAL1_VALUE=line.RATING_VALUE1,detailNeedChanged.VAL2_VALUE=line.RATE1;for(var lineTotal=0,m=0;m<lineTotalInSummary.details.length;m++)lineTotal+=null!==lineTotalInSummary.details[m].VAL1_VALUE&&""!==lineTotalInSummary.details[m].VAL1_VALUE?1*lineTotalInSummary.details[m].VAL1_VALUE:0;lineTotalInSummary.RATING_VALUE1=lineTotal;var totalMode=1;console.log("this is lineTotalInSummary",lineTotalInSummary),autoRatingVal1(lineTotalInSummary,1*lineTotalInSummary.RATING_VALUE1,totalMode)};$scope.showSignature=function(){$scope.isSignatureShow=!0},$scope.okClick=function(){$scope.isSignatureShow=!1},$scope.cancelClick=function(){$scope.isSignatureShow=!1},$scope.clearClick=function(){$scope.header.PATIENT_SIGN=""},$scope.newFASubmit=function(){if($scope.clickedValidation=!0,$scope.FAForm.$invalid)toastr.error("Invalid fields!","Error!");else{var insertInfo=getInsertInformation($scope.header);console.log("this is insert info",insertInfo),DocumentService.insertNewFA(insertInfo).then(function(result){"success"===result.status?($scope.editMode=!0,toastr.success("Functional Assessment Submitted!","Success!"),init()):toastr.error("Failed to submit functional assessment!","Error!")})}},$scope.faUpdate=function(){if($scope.clickedValidation=!0,$scope.FAForm.$invalid)toastr.error("Invalid fields!","Error!");else{var updateInfo=getInsertInformation($scope.header);DocumentService.updateNewFA(updateInfo,patient_id,cal_id).then(function(result){"success"===result.status?toastr.success("Functional assessment updated!","Success!"):toastr.error("Failed to update functional assessment!","Error!")})}};var getInsertInformation=function(header){var insertHeader={},insertSections=[],insertLines=[],insertDetails=[],insertComments=[],dateFormatString="YYYY-MM-DD hh:mm:ss",tmpHeader=angular.copy(header);delete tmpHeader.sections,tmpHeader.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpHeader.Creation_date).format(dateFormatString),tmpHeader.Last_update_date=moment().format(dateFormatString),insertHeader=tmpHeader;for(var i=0;i<header.sections.length;i++){var tmpSection=angular.copy(header.sections[i]);delete tmpSection.lines,tmpSection.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpSection.Creation_date).format(dateFormatString),tmpSection.Last_update_date=moment().format(dateFormatString),insertSections.push(tmpSection);for(var j=0;j<header.sections[i].lines.length;j++){var tmpLine=angular.copy(header.sections[i].lines[j]);delete tmpLine.details,delete tmpLine.comments,delete tmpLine.previewPath,
tmpLine.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpLine.Creation_date).format(dateFormatString),tmpLine.Last_update_date=moment().format(dateFormatString),insertLines.push(tmpLine);for(var k=0;k<header.sections[i].lines[j].details.length;k++){var tmpDetail=angular.copy(header.sections[i].lines[j].details[k]);delete tmpDetail.previewPath,tmpDetail.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpDetail.Creation_date).format(dateFormatString),tmpDetail.Last_update_date=moment().format(dateFormatString),insertDetails.push(tmpDetail)}for(var m=0;m<header.sections[i].lines[j].comments.length;m++){var tmpComment=angular.copy(header.sections[i].lines[j].comments[m]);tmpComment.Creation_date=$scope.editMode===!1?moment().format(dateFormatString):moment(tmpComment.Creation_date).format(dateFormatString),tmpComment.Last_update_date=moment().format(dateFormatString),insertComments.push(tmpComment)}}}var submitInformations={insertHeader:insertHeader,insertSections:insertSections,insertLines:insertLines,insertDetails:insertDetails,insertComments:insertComments};return submitInformations}});