angular.module("app.loggedIn.patient.problem",["app.loggedIn.patient.problem.list.controller","app.loggedIn.patient.problem.directive","app.loggedIn.patient.problem.service"]).config(function($stateProvider){$stateProvider.state("loggedIn.patient.problem_list",{url:"/problem",views:{"main-content":{templateUrl:"modules/problem/views/list.html",controller:"ProblemListController"}}})}),angular.module("app.loggedIn.problem.controller",["app.loggedIn.problem.list.controller"]).controller("ProblemController",function(){}),angular.module("app.loggedIn.patient.problem.list.controller",[]).controller("ProblemListController",function($scope,$stateParams,ConfigService){$scope.problem_panel={};console.log("this is patient id",$stateParams),$scope.problem={select:0,scope:$scope.problem_panel,options:{api:"api/erm/v2/problem/search",method:"post",scope:$scope.problem_panel,columns:[{field:"Problem_id",is_hide:!0},{field:"Notes",label:"Problem description"},{field:"From_date",label:"From",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.From_date)}},{field:"To_date",label:"To",type:"custom",fn:function(item){return ConfigService.getCommonDateDefault(item.To_date)}}],search:{Patient_id:$stateParams.patient_id},use_filters:!0,filters:{Notes:{type:"text"}},use_actions:!0,actions:[{"class":"fa fa-info",title:"Edit",callback:function(item){console.log("this is selected item",item),$scope.problem.id=item.Problem_id,$scope.problemEditForm.open()}}]}},$scope.problemAddForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.problem_panel.reload(),$scope.problemAddForm.close()}},$scope.problemEditForm={is_show:!1,open:function(){this.is_show=!0},close:function(){this.is_show=!1},success:function(response){"success"==response.status&&$scope.problem_panel.reload(),$scope.problemEditForm.close()}}}),angular.module("app.loggedIn.patient.problem.directive",["app.loggedIn.patient.problem.detail.directive"]),angular.module("app.loggedIn.patient.problem.detail.directive",[]).directive("problemDetail",function(ProblemModel,ProblemService,ConfigService,toastr,$stateParams){return{restrict:"EA",scope:{data:"@",options:"=",onsuccess:"=onsuccess"},templateUrl:"modules/problem/directives/templates/detail.html",link:function(scope,element,attrs){var patient_id=$stateParams.patient_id,loadData=function(id){ProblemService.detail(id).then(function(data){angular.extend(scope.modelObjectMap,data.data),ConfigService.autoConvertData(scope.modelObjectMap)})};if(scope.modelObjectMap=angular.copy(ProblemModel),scope.mode={type:"add",text:"Add problem"},scope.modelObjectMap.From_date=new Date,scope.data){var data=scope.$eval(scope.data);data.id&&(loadData(data.id),scope.mode={type:"edit",text:"Edit problem"})}var addProcess=function(postData){postData.Patient_id=patient_id,ProblemService.insert(postData).then(function(response){"success"===response.status&&(toastr.success("Problem added","Success"),scope.modelObjectMap=angular.copy(ProblemModel),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})},editProcess=function(postData){ProblemService.update(postData).then(function(response){"success"===response.status&&(toastr.success("Edit problem Successfully","Success"),scope.isSubmit=!1,scope.onsuccess&&scope.onsuccess(response))})};scope.clickAction=function(option){if("view"!=option.type&&(scope.isSubmit=!0,!scope.mainForm.$invalid)){var postData=angular.copy(scope.modelObjectMap);for(var key in postData)postData[key]instanceof Date&&(postData[key]=ConfigService.getCommonDate(postData[key]));"add"==option.type?addProcess(postData):"edit"==option.type&&editProcess(postData)}}}}}),angular.module("app.loggedIn.patient.problem.service",[]).factory("ProblemService",function(Restangular,ConfigService,$state){var instanceService={},v2_api=Restangular.all("api/erm/v2");return instanceService.insert=function(postData){var detailApi=v2_api.all("problem/insert");return detailApi.post(postData)},instanceService.detail=function(postData){var detailApi=v2_api.all("problem/detail");return detailApi.post({ID:postData})},instanceService.update=function(postData){var detailApi=v2_api.all("problem/update");return detailApi.post(postData)},instanceService});