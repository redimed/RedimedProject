angular.module("app.loggedIn.booking.admin",["app.loggedIn.booking.admin.services","app.loggedIn.booking.admin.booking.controller","app.loggedIn.booking.admin.assessment.controller","app.loggedIn.booking.admin.company.controller","app.loggedIn.booking.admin.user.controller","app.loggedIn.booking.admin.site.controller","app.loggedIn.booking.admin.requiment.controller","app.loggedIn.booking.admin.requirement.directive"]).config(function($stateProvider){$stateProvider.state("loggedIn.admin_booking",{url:"/admin/booking/booking",templateUrl:"modules/onlineBooking_Admin/views/booking.html",controller:"AdminBookingController"}).state("loggedIn.admin_assessment",{url:"/admin/booking/assessment",templateUrl:"modules/onlineBooking_Admin/views/assessment.html",controller:"AdminAssessmentController"}).state("loggedIn.admin_company",{url:"/admin/booking/companies",templateUrl:"modules/onlineBooking_Admin/views/companies.html",controller:"AdminCompanyController"}).state("loggedIn.admin_company_new",{url:"/admin/booking/company/new/:id",templateUrl:"modules/onlineBooking_Admin/views/addNewCompany.html",controller:"AdminNewCompanyController"}).state("loggedIn.admin_company_edit",{url:"/admin/booking/company/edit/:fatherId/:subId",templateUrl:"modules/onlineBooking_Admin/views/addNewCompany.html",controller:"AdminEditCompanyController"}).state("loggedIn.admin_user",{url:"/admin/booking/user",templateUrl:"modules/onlineBooking_Admin/views/user.html",controller:"AdminUserController"}).state("loggedIn.admin_user_new",{url:"/admin/booking/user/new",templateUrl:"modules/onlineBooking_Admin/views/newUser.html",controller:"AdminNewUserController"}).state("loggedIn.admin_user_edit",{url:"/admin/booking/user/:id",templateUrl:"modules/onlineBooking_Admin/views/newUser.html",controller:"AdminEditUserController"}).state("loggedIn.admin_sites",{url:"/admin/booking/sites",templateUrl:"modules/onlineBooking_Admin/views/sites.html",controller:"AdminSiteController"}).state("loggedIn.admin_sites_new",{url:"/admin/booking/sites/new",templateUrl:"modules/onlineBooking_Admin/views/newSite.html",controller:"AdminNewSiteController"}).state("loggedIn.admin_sites_edit",{url:"/admin/booking/sites/:id",templateUrl:"modules/onlineBooking_Admin/views/newSite.html",controller:"AdminEditSiteController"})}),angular.module("app.loggedIn.booking.admin.booking.controller",[]).controller("AdminBookingController",function($scope,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.data=[],$scope.isSelected=!1,$scope.selectedCanId=null,$scope.selectedBookId=null,$scope.isChangeFile=!1,$scope.info={},$scope.dateOptions={formatYear:"yy",startingDay:1};var uploader=$scope.uploader=new FileUploader({url:"/api/booking/upload"});uploader.onAfterAddingFile=function(fileItem){fileItem.formData[0]={Booking_id:$scope.info.Booking_id,Candidate_id:$scope.info.Candidate_id,fileName:uploader.queue[0].file.name},console.info("onAfterAddingFile",fileItem)},OnlineBookingAdminService.getList().then(function(data){"success"===data.status&&($scope.data=data.rs,$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}))}),$scope.openDetail=function(b){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/bookingDetailModal.html",controller:"AdminBookingDetailController",size:"lg",resolve:{bookingId:function(){return b.Booking_id},candidateId:function(){return b.Candidate_id}}})},$scope.showDetail=function(b){$scope.selectedCanId=b.Candidate_id,$scope.selectedBookId=b.Booking_id,$scope.isSelected=!0,uploader.clearQueue(),OnlineBookingService.getBookingDetail(b.Booking_id,b.Candidate_id).then(function(data){var arrAss=[];$scope.info=data.rs[0],OnlineBookingService.getSite().then(function(rs){$scope.siteList=rs});var from=$filter("date")(data.rs[0].from_date,"yyyy-MM-dd"),to=$filter("date")(data.rs[0].to_date,"yyyy-MM-dd");OnlineBookingService.getCalendar(data.rs[0].site_id,from,to).then(function(data){$scope.calList=data}),OnlineBookingService.getPackageAssById(data.rs[0].package_id).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.packAss=_.groupBy(arrAss,"head_name")}})})},$scope.saveInfo=function(){uploader.filters.push({name:"customFilter",fn:function(item,options){return this.queue.length<10}}),uploader.uploadAll(),console.log(uploader),uploader.onCompleteAll=function(){console.info("onCompleteAll")},OnlineBookingAdminService.editBookingInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Successfully!","Success"):toastr.error("Edit Failed!","Error")})},$scope.sendEmail=function(){OnlineBookingAdminService.confirmBooking($scope.info).then(function(data){"success"===data.status?toastr.success("Send Mail Successfully! Please check your email!","Success"):toastr.error("Send Mail Failed!","Error")})},$scope.searchModal=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking/views/searchBookingModal.html",controller:"SearchAdminBookingController",size:"md",resolve:{companyId:function(){return null}}});modalInstance.result.then(function(data){$scope.data=data,$scope.$watch("data",function(data){$scope.data=data,$scope.tableParams.reload()})})}}).controller("SearchAdminBookingController",function($scope,$modalInstance,OnlineBookingService,OnlineBookingAdminService,companyId){$scope.minDate=new Date,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.info={companyId:companyId,companyName:null,candidateName:null,fromDate:null,toDate:null,bookingPerson:null,status:null,siteName:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.search=function(){OnlineBookingService.searchBooking($scope.info).then(function(data){$modalInstance.close(data)})},$scope.reset=function(){OnlineBookingAdminService.getList().then(function(data){$modalInstance.close(data.rs)})}}).controller("AdminBookingDetailController",function($scope,$modalInstance,OnlineBookingService,bookingId,candidateId){$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingService.getBookingDetail(bookingId,candidateId).then(function(data){var arrAss=[];$scope.detail=data.rs[0],"undefined"!=typeof data.rs[0].package_id&&OnlineBookingService.getPackageAssById(data.rs[0].package_id).then(function(data){if("success"===data.status){for(var i=0;i<data.rs.length;i++)arrAss.push({head_name:data.rs[i].HeaderName,ass_name:data.rs[i].ass_name});$scope.detail.ass=_.groupBy(arrAss,"head_name")}})})}),angular.module("app.loggedIn.booking.admin.assessment.controller",[]).controller("AdminAssessmentController",function($scope,$state,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.data=[],$scope.data1=[],$scope.selectedHeader="",$scope.ass=[],$scope.isSelected=!1,$scope.selectedId=null,OnlineBookingAdminService.getAssHeader().then(function(data){$scope.data=data,$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data,$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.showChild=function(p){$scope.selectedId=p.id,$scope.data1=[],$scope.isSelected=!0,$scope.selectedHeader=p.id;for(var i=0;i<$scope.ass.length;i++)p.id===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()},$scope.removeHeaderAssessment=function(p){var headerId=p.id;OnlineBookingAdminService.deleteHeaderAssessment(headerId).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Delete Failed!","Error")})},$scope.removeAssessment=function(a){var id=a.id;OnlineBookingAdminService.deleteAssessment(id).then(function(data){"success"===data.status?(toastr.success("Delete Successfully!","Success"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Delete Failed!","Error")})},$scope.addHeader=function(){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentHeaderModal.html",controller:"AddAssHeaderController",size:"md"})},$scope.addAssessment=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentModal.html",controller:"AddAssessmentController",size:"md",resolve:{headId:function(){return $scope.selectedHeader}}});modalInstance.result.then(function(headId){$scope.ass=[],$scope.data1=[],OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data}),$scope.$watch("ass",function(ass){for(var i=0;i<$scope.ass.length;i++)headId===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()})})},$scope.editAssessment=function(b){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/assessmentModal.html",controller:"EditAssessmentController",size:"md",resolve:{headId:function(){return $scope.selectedHeader},assId:function(){return b.id}}});modalInstance.result.then(function(headId){$scope.ass=[],$scope.data1=[],OnlineBookingAdminService.getAssessment().then(function(data){$scope.ass=data}),$scope.$watch("ass",function(ass){for(var i=0;i<$scope.ass.length;i++)headId===$scope.ass[i].HEADER_ID&&$scope.data1.push($scope.ass[i]);$scope.tableParams2.reload()})})}}).controller("AddAssHeaderController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr){$scope.info={name:""},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){OnlineBookingAdminService.addNewHeaderAssessment($scope.info).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.dismiss("cancel"),$state.go("loggedIn.admin_assessment",null,{reload:!0})):"error"===data.status&&toastr.error("Insert Failed!","Error")})}}).controller("AddAssessmentController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr,headId){$scope.info={headId:headId,name:null,itemCode:null,itemName:null,price:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.submit=function(){OnlineBookingAdminService.addNewAssessment($scope.info).then(function(data){"success"===data.status?(OnlineBookingAdminService.updatePrice(),toastr.success("Insert Successfully!","Success"),$modalInstance.close(headId)):"error"===data.status&&toastr.error("Insert Failed!","Error")})}}).controller("EditAssessmentController",function($scope,$state,$modalInstance,OnlineBookingAdminService,toastr,headId,assId){$scope.info={headId:headId,assId:assId,name:null,itemCode:null,itemName:null,price:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingAdminService.getAssessmentInfo(assId).then(function(data){$scope.info.headId=data[0].HEADER_ID,$scope.info.assId=data[0].id,$scope.info.name=data[0].ass_name,$scope.info.itemCode=data[0].item_code,$scope.info.itemName=data[0].item_name,$scope.info.price=data[0].price}),$scope.submit=function(){OnlineBookingAdminService.updateAssessment($scope.info).then(function(data){"success"===data.status?(OnlineBookingAdminService.updatePrice(),toastr.success("Edit Successfully!","Success"),$modalInstance.close(headId)):"error"===data.status&&toastr.error("Edit Failed!","Error")})}}),angular.module("app.loggedIn.booking.admin.company.controller",[]).controller("AdminCompanyController",function($scope,$state,$modal,$filter,ngTableParams,$cookieStore,FileUploader,OnlineBookingAdminService,toastr){$scope.data=[];var comArr=[];$scope.data1=[],$scope.patientData=[],$scope.isSelected=!1,$scope.selectedId=null,void 0!=$cookieStore.get("companyInfo")&&($scope.companyInfo=$cookieStore.get("companyInfo")),OnlineBookingAdminService.getCompanyList().then(function(data){comArr=data;for(var i=0;i<comArr.length;i++)null===comArr[i].father_id&&$scope.data.push(comArr[i]);$scope.tableParams=new ngTableParams({page:1,count:10},{total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.patientData.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.patientData,params.filter()):$scope.patientData,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.patientData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.showSubCompany=function(b){$scope.selectedId=b.id,$scope.selectedComp=b.Company_name,$scope.data1=[],$scope.patientData=[],$scope.isSelected=!0;for(var i=0;i<comArr.length;i++)comArr[i].father_id===b.id&&$scope.data1.push(comArr[i]);OnlineBookingAdminService.getCompanyPatients(b.id).then(function(rs){if("success"==rs.status){$scope.patientData=rs.data;for(var i=0;i<$scope.patientData.length;i++){var nameArr=[];nameArr.push($scope.patientData[i].Title),nameArr.push($scope.patientData[i].First_name),nameArr.push($scope.patientData[i].Sur_name),nameArr.push($scope.patientData[i].Middle_name),$scope.patientData[i].fullName=nameArr.join(" ")}$scope.tableParams3.reload()}}),$scope.tableParams2.reload()},$scope.addNewCompany=function(){$state.go("loggedIn.admin_company_new")},$scope.editCompany=function(b){$state.go("loggedIn.admin_company_edit",{fatherId:b.id},{reload:!0})},$scope.addSubCompany=function(){$state.go("loggedIn.admin_company_new",{id:$scope.selectedId},{reload:!0})},$scope.editSubCompany=function(a){$state.go("loggedIn.admin_company_edit",{fatherId:$scope.selectedId,subId:a.id},{reload:!0})},$scope.viewPatient=function(a){$state.go("loggedIn.patient.appointment",{patient_id:a.Patient_id,cal_id:1},{reload:!0})},$scope.showRequirement=function(){$modal.open({templateUrl:"Requirements",controller:"RequirementController",size:"lg",resolve:{idr:function(){return $scope.selectedId}}}).result.then(function(response){console.log(response)})}}).controller("AdminNewCompanyController",function($scope,$state,ngTableParams,$stateParams,toastr,$cookieStore,OnlineBookingAdminService){$scope.isEdit=!1;var comId=null;(null!==$stateParams.id||""!==$stateParams.id||"undefined"!=typeof $stateParams.id)&&(comId=$stateParams.id),$scope.info={companyName:null,industry:null,addr:null,postCode:null,state:null,country:null,description:null,poNum:null,isInvoice:null,invoiceEmail:null,isResult:null,resultEmail:null,reportEmail:null,status:null,isProject:null,isPO:null,isExtra:null,phone:null,fatherId:comId},$scope.submitCompany=function(companyForm){$scope.showClickedValidation=!0,companyForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.checkCompanyName($scope.info.companyName).then(function(data){"error"==data.status?(toastr.error("Company Name is already exists!"),$scope.isExist=!0):($scope.isExist=!1,OnlineBookingAdminService.insertNewCompany($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New Company Successfully!","Success"),$state.go("loggedIn.admin_company",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New Company Failed!","Error")}))})}}).controller("AdminEditCompanyController",function($scope,$filter,ngTableParams,$state,$stateParams,OnlineBookingService,toastr,$cookieStore,OnlineBookingAdminService){$scope.isEdit=!0,$scope.fatherId=null!=$stateParams.fatherId||void 0!=$stateParams.fatherId?$stateParams.fatherId:null,$scope.subId=null!=$stateParams.subId||void 0!=$stateParams.subId?$stateParams.subId:null,$scope.patientData=[],$scope.data1=[],$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.data1.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data1,params.filter()):$scope.data1,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data1;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.patientData.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.patientData,params.filter()):$scope.patientData,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.patientData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),OnlineBookingAdminService.getCompanyList().then(function(data){for(var i=0;i<data.length;i++)data[i].father_id==$scope.fatherId&&$scope.data1.push(data[i]);$scope.tableParams2.reload()}),OnlineBookingAdminService.getCompanyPatients(null==$scope.fatherId?$scope.subId:$scope.fatherId).then(function(rs){if("success"==rs.status){$scope.patientData=rs.data;for(var i=0;i<$scope.patientData.length;i++){var nameArr=[];nameArr.push($scope.patientData[i].Title),nameArr.push($scope.patientData[i].First_name),nameArr.push($scope.patientData[i].Sur_name),nameArr.push($scope.patientData[i].Middle_name),$scope.patientData[i].fullName=nameArr.join(" ")}$scope.tableParams3.reload()}}),$scope.addSubCompany=function(){$state.go("loggedIn.admin_company_new",{id:$scope.fatherId},{reload:!0})},$scope.editSubCompany=function(a){$state.go("loggedIn.admin_company_edit",{fatherId:$scope.fatherId,subId:a.id},{reload:!0})},$scope.viewPatient=function(a){$state.go("loggedIn.patient.appointment",{patient_id:a.Patient_id,cal_id:1},{reload:!0})},$scope.info={id:null==$scope.fatherId?$scope.subId:$scope.fatherId,companyName:null,industry:null,addr:null,postCode:null,state:null,country:null,description:null,poNum:null,isInvoice:null,invoiceEmail:null,isResult:null,resultEmail:null,reportEmail:null,status:null,isProject:null,isPO:null,isExtra:null,phone:null},OnlineBookingAdminService.getCompanyInfo(null==$scope.fatherId?$scope.subId:$scope.fatherId).then(function(data){$scope.info={id:null==$scope.fatherId?$scope.subId:$scope.fatherId,companyName:data.Company_name,industry:data.Industry,addr:data.Addr,postCode:data.postcode,state:data.State,country:data.country,description:data.Description,poNum:data.PO_number,isInvoice:1!=data.isInvoiceEmailToUser?"0":"1",invoiceEmail:data.invoice_email,isResult:1!=data.isAddContactEmailToResult?"0":"1",resultEmail:data.result_email,reportEmail:data.report_to_email,status:data.default_status,phone:data.Phone,isProject:1!=data.isProject?"0":"1",isPO:1!=data.isPO?"0":"1",isExtra:1!=data.isExtra?"0":"1"}}),$scope.submitCompany=function(companyForm){$scope.showClickedValidation=!0,companyForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.checkCompanyName($scope.info.companyName).then(function(data){"error"==data.status?($scope.isExist=!0,toastr.error("Company Name is already exists!")):($scope.isExist=!1,OnlineBookingAdminService.editCompanyInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Company Successfully!","Success"):"error"===data.status&&toastr.error("Edit Company Failed!","Error")}))})}}),angular.module("app.loggedIn.booking.admin.user.controller",[]).controller("AdminUserController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingAdminService,toastr){$scope.selectedId=null,$scope.selectedRow=null,$scope.arr=[],$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null},OnlineBookingAdminService.getListUser().then(function(data){$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")(data,params.filter()):data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.arr.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arr,params.filter()):$scope.arr,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arr;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.addNewUser=function(){$state.go("loggedIn.admin_user_new")},$scope.editUser=function(b){$state.go("loggedIn.admin_user_edit",{id:b.id})},$scope.showMenu=function(b){$scope.selectedId=b.id,$scope.selectedRow=null,$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null},$scope.showClickedValidation=!1,$scope.arr=[],$scope.rs=[],OnlineBookingAdminService.getUserMenu(b.id).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})},$scope.showMenuDetails=function(b){$scope.selectedRow=b.id,OnlineBookingAdminService.getMenuList().then(function(data){$scope.menuList=[];for(var i=0;i<data.length;i++)1==data[i].isEnable&&$scope.menuList.push(data[i])}),OnlineBookingAdminService.getUserMenuDetails(b.id).then(function(data){$scope.info.id=data[0].id,$scope.info.user_id=data[0].user_id,$scope.info.user_name=data[0].user_name,$scope.info.menu_id=data[0].menu_id,$scope.info.isEnable=1==data[0].isEnable?"1":"0"})},$scope.submitUserMenu=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editUserMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Edit Successfully!","Success"),OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})):toastr.success("Edit Failed!","Error")})},$scope.addNewUserMenu=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newSubMenu.html",controller:"AddNewUserMenuController",size:"md",resolve:{userId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})})},$scope.deleteUserMenu=function(b){OnlineBookingAdminService.delUserMenu(b.id).then(function(data){"success"==data.status?(toastr.success("Delete Successfully!","Success"),OnlineBookingAdminService.getUserMenu($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()}),$scope.info={id:null,user_id:null,user_name:null,menu_id:null,isEnable:null}):toastr.error("Delete Failed","Error")})}}).controller("AddNewUserMenuController",function($scope,$state,$modal,$modalInstance,$filter,ngTableParams,OnlineBookingAdminService,UserService,userId,toastr){$scope.info={user_id:userId,menu_id:null,isEnable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},OnlineBookingAdminService.getMenuList().then(function(data){$scope.menuList=[];for(var i=0;i<data.length;i++)1==data[i].isEnable&&$scope.menuList.push(data[i])}),$scope.addNew=function(menuForm){$scope.showClickedValidation=!0,menuForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertUserMenu($scope.info).then(function(data){"success"===data.status?(toastr.success("Insert Successfully!","Success"),$modalInstance.close()):toastr.success("Insert Failed!","Error")})}}).controller("AdminNewUserController",function($scope,$state,$modal,$filter,ngTableParams,OnlineBookingAdminService,UserService,toastr,SecurityService){$scope.isEdit=!1,$scope.isCompany=!1,$scope.usernameExist=!1,$scope.emailExist=!1,$scope.typeList=[],$scope.userTypeChange=function(b){console.log("type change");for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&($scope.isCompany=$scope.typeList[i].ID==b?!0:!1)},$scope.checkUsername=function(username){SecurityService.checkUserName(username).then(function(data){$scope.usernameExist=null==data||data.length<=0?!1:!0})},$scope.checkEmail=function(email){SecurityService.checkEmail(email).then(function(data){$scope.emailExist=null==data||data.length<=0?!1:!0})},UserService.getUserType().then(function(data){$scope.typeList=data}),$scope.info={bookPerson:null,email:null,isDownload:null,isEnable:"1",isMakeBooking:null,isPackage:null,isPosition:null,isSetting:null,isShowAll:null,isShowBooking:null,isViewAllData:null,password:null,phone:null,username:null,userType:null,companyId:null,poNum:null,invoiceEmail:null,resultEmail:null,reportEmail:null,function_id:null,function_mobile:null,empId:null,isCalendar:null,isProject:null,isAdmin:null,isReceiveEmail:null},OnlineBookingAdminService.getListCompany().then(function(data){$scope.companyList=data}),OnlineBookingAdminService.getListFunction().then(function(data){for(var listWeb=[],listMobile=[],i=0;i<data.length;i++)1==data[i].isWeb&&listWeb.push(data[i]),1==data[i].isMobile&&listMobile.push(data[i]);$scope.functionList=listWeb,$scope.functionMobList=listMobile}),OnlineBookingAdminService.getListEmployee().then(function(data){$scope.empList=data}),$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertNewUser($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New User Successfully!","Success"),$state.go("loggedIn.admin_user_new",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})}}).controller("AdminEditUserController",function($scope,$state,$stateParams,$modal,OnlineBookingService,OnlineBookingAdminService,toastr,UserService,$cookieStore){$scope.typeList=[],$scope.isEdit=!0,$scope.isCompany=!1,UserService.getUserType().then(function(data){$scope.typeList=data}),$scope.userTypeChange=function(b){for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&($scope.isCompany=$scope.typeList[i].ID==b?!0:!1)},$scope.info={userId:$stateParams.id,bookPerson:null,email:null,isDownload:null,isEnable:null,isMakeBooking:null,isPackage:null,isPosition:null,isSetting:null,isShowAll:null,isShowBooking:null,isViewAllData:null,password:null,phone:null,username:null,userType:null,companyId:null,poNum:null,invoiceEmail:null,resultEmail:null,reportEmail:null,function_id:null,function_mobile:null,empId:null,isCalendar:null,isProject:null,isAdmin:null,isReceiveEmail:null},OnlineBookingAdminService.getListCompany().then(function(data){$scope.companyList=data}),OnlineBookingAdminService.getListFunction().then(function(data){for(var listWeb=[],listMobile=[],i=0;i<data.length;i++)1==data[i].isWeb&&listWeb.push(data[i]),1==data[i].isMobile&&listMobile.push(data[i]);$scope.functionList=listWeb,$scope.functionMobList=listMobile}),OnlineBookingAdminService.getListEmployee().then(function(data){$scope.empList=data}),OnlineBookingService.getUserInfo($stateParams.id).then(function(data){$scope.info.bookPerson=data.Booking_Person,$scope.info.email=data.Contact_email,$scope.info.isDownload=1==data.isDownloadResult?"1":"0",$scope.info.isEnable=1==data.isEnable?"1":"0",$scope.info.isMakeBooking=1==data.isMakeBooking?"1":"0",$scope.info.isPackage=1==data.isPackage?"1":"0",$scope.info.isPosition=1==data.isPosition?"1":"0",$scope.info.isSetting=1==data.isSetting?"1":"0",$scope.info.isShowAll=1==data.isAll?"1":"0",$scope.info.isShowBooking=1==data.isBooking?"1":"0",$scope.info.isViewAllData=1==data.isAllCompanyData?"1":"0",$scope.info.phone=data.Contact_number,$scope.info.username=data.user_name,$scope.info.userType=data.UserType.id,$scope.info.companyId=data.company_id,$scope.info.poNum=data.PO_number,$scope.info.invoiceEmail=data.invoiceemail,$scope.info.resultEmail=data.result_email,$scope.info.reportEmail=data.Report_To_email,$scope.info.function_id=data.function_id,$scope.info.function_mobile=data.function_mobile,$scope.info.empId=data.employee_id,$scope.info.isCalendar=1==data.isCalendar?"1":"0",$scope.info.isProject=1==data.isProject?"1":"0",$scope.info.isAdmin=1==data.isAdmin?"1":"0",$scope.isReceiveEmail=1==data.isReceiveEmailAfterHour?"1":"0";for(var i=0;i<$scope.typeList.length;i++)"Company"==$scope.typeList[i].user_type&&$scope.typeList[i].ID==$scope.info.userType&&($scope.isCompany=!0)}),$scope.submitUser=function(userForm){$scope.showClickedValidation=!0,userForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingService.editUserInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Submit New User Successfully!","Success"):"error"===data.status&&toastr.error("Submit New User Failed!","Error")})},$scope.changePass=function(){$modal.open({templateUrl:"modules/onlineBooking_Admin/views/changePassModal.html",controller:"AdminChangePassController",size:"md",resolve:{userId:function(){return $stateParams.id}}})}}).controller("AdminChangePassController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,userId,toastr){$scope.info={oldPass:null,newPass:null,id:userId},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.okClick=function(){OnlineBookingService.changeUserPassword($scope.info).then(function(data){"success"===data.status?(toastr.success("Change Password Successfully","Success"),$modalInstance.dismiss("cancel")):"error"===data.status&&toastr.error("Change Password Failed","Error")})}}),angular.module("app.loggedIn.booking.admin.site.controller",[]).controller("AdminSiteController",function($scope,$state,$modal,$filter,ngTableParams,FileUploader,OnlineBookingAdminService,OnlineBookingService,$http,toastr,$cookieStore){$scope.selectedId=null,$scope.selectedCal=null,$scope.selectedState=null,$scope.selectedSuburb=null,$scope.selectedSite=null,$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.arr=[],$scope.arrState=[],$scope.arrSuburb=[],$scope.dataRooms=[],$scope.info={site_id:null,cal_id:null,From_time:null,to_time:null,available:null,booking:null},$scope.stateInfo={
state_id:null,site_id:null,state_name:null,isenable:null},$scope.suburbInfo={suburb_id:null,state_id:null,site_id:null,suburb_name:null,isenable:null},OnlineBookingAdminService.getSiteList().then(function(data){$scope.tableParams=new ngTableParams({page:1,count:10},{total:data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")(data,params.filter()):data,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):data;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams2=new ngTableParams({page:1,count:10},{total:$scope.arr.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arr,params.filter()):$scope.arr,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arr;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams3=new ngTableParams({page:1,count:10},{total:$scope.arrState.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arrState,params.filter()):$scope.arrState,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arrState;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams4=new ngTableParams({page:1,count:10},{total:$scope.arrSuburb.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.arrSuburb,params.filter()):$scope.arrSuburb,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.arrSuburb;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}}),$scope.tableParams5=new ngTableParams({page:1,count:10},{total:$scope.dataRooms.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.dataRooms,params.filter()):$scope.dataRooms,orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.dataRooms;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}),$scope.editRoom=function(roomInfo,isEdit){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/modals/roomModal.html",controller:"RoomController",size:"md",resolve:{site:function(){return $scope.selectedSite},isEdit:function(){return isEdit},room:function(){return roomInfo}}});modalInstance.result.then(function(){OnlineBookingAdminService.getSiteRoom($scope.selectedId).then(function(data){$scope.rsRoom=data}),$scope.$watch("rsRoom",function(rs){$scope.dataRooms=rs,$scope.tableParams5.reload()})})},$scope.addNewSite=function(){$state.go("loggedIn.admin_sites_new")},$scope.editSite=function(b){$state.go("loggedIn.admin_sites_edit",{id:b.id})},$scope.showSiteCalendar=function(b){$scope.selectedSite=b,$scope.selectedId=b.id,$scope.selectedCal=null,$scope.arr=[],$scope.arrState=[],$scope.arrSuburb=[],$scope.rs=[],$scope.rsState=[],$scope.rsSuburb=[],$scope.rsRoom=[],OnlineBookingAdminService.getCalendarBySiteId(b.id).then(function(data){$scope.rs=data}),OnlineBookingService.getSiteState(b.id).then(function(data){$scope.rsState=data}),OnlineBookingAdminService.getSiteRoom(b.id).then(function(data){$scope.rsRoom=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()}),$scope.$watch("rsRoom",function(rs){$scope.dataRooms=rs,$scope.tableParams5.reload()})},$scope.showStateDetail=function(b){$scope.selectedState=b.state_id,$scope.arrSuburb=[],$scope.rsSuburb=[],OnlineBookingService.getStateSuburb(b.state_id).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()}),OnlineBookingAdminService.getStateById(b.state_id).then(function(data){$scope.stateInfo=data[0],$scope.stateInfo.isenable=1==data[0].isenable?"1":"0"})},$scope.showSuburbDetail=function(b){$scope.selectedSuburb=b.suburb_id,OnlineBookingAdminService.getSuburbById(b.suburb_id).then(function(data){$scope.suburbInfo=data[0],$scope.suburbInfo.isenable=1==data[0].isenable?"1":"0"})},$scope.showCalendarDetail=function(b){$scope.selectedCal=b.cal_id,OnlineBookingAdminService.getCalendarById(b.cal_id).then(function(data){$scope.info=data})},$scope.submitState=function(stateForm){$scope.showStateValidation=!0,stateForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editStateInfo($scope.stateInfo).then(function(data){"success"===data.status?(toastr.success("Edit State Successfully!","Success"),OnlineBookingService.getSiteState($scope.selectedId).then(function(data){$scope.rsState=data}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()})):"error"===data.status&&toastr.error("Edit State Failed!","Error")})},$scope.submitSuburb=function(suburbForm){$scope.showSuburbValidation=!0,suburbForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editSuburbInfo($scope.suburbInfo).then(function(data){"success"===data.status?(toastr.success("Edit Suburb Successfully!","Success"),OnlineBookingService.getStateSuburb($scope.selectedState).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()})):"error"===data.status&&toastr.error("Edit Suburb Failed!","Error")})},$scope.submitCalendar=function(calendarForm){$scope.showClickedValidation=!0,calendarForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.submitNewCalendar($scope.info).then(function(data){"success"===data.status?(toastr.success("Edit Calendar Successfully!","Success"),OnlineBookingAdminService.getCalendarBySiteId($scope.selectedId).then(function(data){$scope.rs=data}),$scope.$watch("rs",function(rs){$scope.arr=rs,$scope.tableParams2.reload()})):"error"===data.status&&toastr.error("Edit Calendar Failed!","Error")})},$scope.addNewState=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newStateModal.html",controller:"NewStateController",size:"md",resolve:{siteId:function(){return $scope.selectedId}}});modalInstance.result.then(function(){OnlineBookingService.getSiteState($scope.selectedId).then(function(data){$scope.rsState=data}),$scope.$watch("rsState",function(rs){$scope.arrState=rs,$scope.tableParams3.reload()})})},$scope.addNewSuburb=function(){var modalInstance=$modal.open({templateUrl:"modules/onlineBooking_Admin/views/newSuburbModal.html",controller:"NewSuburbController",size:"md",resolve:{siteId:function(){return $scope.selectedId},stateId:function(){return $scope.selectedState}}});modalInstance.result.then(function(){OnlineBookingService.getStateSuburb($scope.selectedState).then(function(data){$scope.rsSuburb=data}),$scope.$watch("rsSuburb",function(rs){$scope.arrSuburb=rs,$scope.tableParams4.reload()})})}}).controller("RoomController",function($scope,toastr,$filter,$state,site,isEdit,room,$modalInstance,OnlineBookingAdminService){$scope.siteObj=null!=site?site:null,$scope.isEdit=null!=isEdit?isEdit:!1,$scope.roomObj=null!=room?room:null,$scope.roomInfo={room_name:null,description:null,site_id:$scope.siteObj.id,isEnable:"1"},$scope.isEdit&&null!=room&&OnlineBookingAdminService.getRoom(room.id).then(function(rs){"success"==rs.status?($scope.roomInfo=rs.data,$scope.roomInfo.isEnable=1==rs.data.isEnable?"1":"0"):toast.error("Cannot Get Room Data")}),$scope.cancelClick=function(){$modalInstance.close()},$scope.okClick=function(roomForm){$scope.isSubmit=!0,roomForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editRoom($scope.roomInfo,$scope.isEdit).then(function(rs){"success"==rs.status.toLowerCase()?(toastr.success("Success"),$modalInstance.close()):toastr.error("Error")})}}).controller("NewStateController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,OnlineBookingAdminService,siteId,toastr){$scope.stateInfo={state_id:null,site_id:siteId,state_name:null,isenable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.addState=function(stateForm){$scope.showStateValidation=!0,stateForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertState($scope.stateInfo).then(function(data){"success"===data.status?(toastr.success("Insert State Successfully!","Success"),$modalInstance.close()):"error"===data.status&&toastr.error("Insert State Failed!","Error")})}}).controller("NewSuburbController",function($scope,$filter,$state,$modalInstance,OnlineBookingService,OnlineBookingAdminService,siteId,stateId,toastr){$scope.suburbInfo={suburb_id:null,state_id:stateId,site_id:siteId,suburb_name:null,isenable:null},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.addSuburb=function(suburbForm){$scope.showSuburbValidation=!0,suburbForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertSuburb($scope.suburbInfo).then(function(data){"success"===data.status?(toastr.success("Insert Suburb Successfully!","Success"),$modalInstance.close()):"error"===data.status&&toastr.error("Insert Suburb Failed!","Error")})}}).controller("AdminNewSiteController",function($scope,$state,OnlineBookingAdminService,toastr){$scope.isEdit=!1,$scope.info={Site_name:null,Site_addr:null,postcode:null,State:null,latitude:null,longitude:null,country:null,Available_def:null,booking_status:null,isPreEmpBK:null},$scope.submitSite=function(siteForm){$scope.showClickedValidation=!0,siteForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.insertNewSite($scope.info).then(function(data){"success"===data.status?(toastr.success("Submit New Site Successfully!","Success"),$state.go("loggedIn.admin_sites_new",null,{reload:!0})):"error"===data.status&&toastr.error("Submit New Site Failed!","Error")})}}).controller("AdminEditSiteController",function($scope,$state,$stateParams,OnlineBookingAdminService,toastr,$cookieStore){$scope.isEdit=!0;var id=$stateParams.id;$scope.info={id:id,Site_name:null,Site_addr:null,postcode:null,State:null,latitude:null,longitude:null,country:null,Available_def:null,booking_status:null,isPreEmpBK:null},OnlineBookingAdminService.getSiteInfo(id).then(function(data){$scope.info=data,$scope.info.isPreEmpBK=1==data.isPreEmpBK?"1":"0"}),$scope.submitSite=function(siteForm){$scope.showClickedValidation=!0,siteForm.$invalid?toastr.error("Please Input All Required Information!","Error"):OnlineBookingAdminService.editSiteInfo($scope.info).then(function(data){"success"===data.status?toastr.success("Edit Site Successfully!","Success"):"error"===data.status&&toastr.error("Edit Site Failed!","Error")})}}),angular.module("app.loggedIn.booking.admin.requiment.controller",[]).controller("RequirementController",function($scope,$state,$modalInstance,idr){$scope.reqmt={idr:idr,success:!1},$scope.$watch("success",function(success){success&&$modalInstance.close($scope.reqmt)})}),angular.module("app.loggedIn.booking.admin.services",[]).factory("OnlineBookingAdminService",function(Restangular){var adminBooking={},api=Restangular.all("api");return adminBooking.getList=function(){var list=api.one("booking/list");return list.get()},adminBooking.editBookingInfo=function(info){var edit=api.all("booking/edit");return edit.post({info:info})},adminBooking.confirmBooking=function(info){var confirm=api.all("booking/confirm");return confirm.post({info:info})},adminBooking.getAssHeader=function(){var head=api.one("assessment/header/list");return head.get()},adminBooking.getAssessment=function(){var a=api.one("assessment/list");return a.get()},adminBooking.deleteHeaderAssessment=function(id){var del=api.all("assessment/header/delete");return del.post({id:id})},adminBooking.addNewHeaderAssessment=function(info){var add=api.all("assessment/header/new");return add.post({info:info})},adminBooking.deleteAssessment=function(id){var del=api.all("assessment/delete");return del.post({id:id})},adminBooking.addNewAssessment=function(info){var add=api.all("assessment/new");return add.post({info:info})},adminBooking.updateAssessment=function(info){var add=api.all("assessment/edit");return add.post({info:info})},adminBooking.getAssessmentInfo=function(id){var a=api.all("assessment/info");return a.post({id:id})},adminBooking.updatePrice=function(){var a=api.all("package/updateFee");return a.post()},adminBooking.getCompanyList=function(){var list=api.one("company/list");return list.get()},adminBooking.getSubCompany=function(id){var sub=api.all("company/sub");return sub.post({id:id})},adminBooking.getCompanyPatients=function(id){return api.all("company/patients").post({companyId:id})},adminBooking.getCompanyInfo=function(id){var sub=api.all("company/info");return sub.post({comId:id})},adminBooking.checkCompanyName=function(name){return api.all("company/checkName").post({name:name})},adminBooking.insertNewCompany=function(info){var add=api.all("company/new");return add.post({info:info})},adminBooking.editCompanyInfo=function(info){var edit=api.all("company/edit");return edit.post({info:info})},adminBooking.getListUser=function(){var list=api.one("users/list");return list.get()},adminBooking.getListCompany=function(){var list=api.one("company/list");return list.get()},adminBooking.getListFunction=function(){var list=api.one("function/list");return list.get()},adminBooking.getListEmployee=function(){var list=api.one("users/employee/list");return list.get()},adminBooking.insertNewUser=function(info){var user=api.all("users/insert");return user.post({info:info,isReg:!1})},adminBooking.getSiteList=function(){var list=api.one("redimedsite/list");return list.get()},adminBooking.getSiteInfo=function(id){var info=api.all("redimedsite/info");return info.post({id:id})},adminBooking.insertNewSite=function(info){var insert=api.all("redimedsite/insert");return insert.post({info:info})},adminBooking.editSiteInfo=function(info){var edit=api.all("redimedsite/edit");return edit.post({info:info})},adminBooking.getCalendarBySiteId=function(id){var info=api.all("calendar/siteId");return info.post({id:id})},adminBooking.getCalendarById=function(id){var info=api.all("calendar/info");return info.post({id:id})},adminBooking.submitNewCalendar=function(info){var submit=api.all("calendar/submit");return submit.post({info:info})},adminBooking.getUserMenu=function(id){var list=api.all("users/menu");return list.post({id:id})},adminBooking.getMenuList=function(){var list=api.one("menu/list/root");return list.get()},adminBooking.getUserMenuDetails=function(id){var detail=api.all("users/menu/details");return detail.post({id:id})},adminBooking.editUserMenu=function(info){var edit=api.all("users/menu/edit");return edit.post({info:info})},adminBooking.insertUserMenu=function(info){var insert=api.all("users/menu/insert");return insert.post({info:info})},adminBooking.getStateById=function(id){var state=api.all("redimedsite/state/id");return state.post({id:id})},adminBooking.getSuburbById=function(id){var suburb=api.all("redimedsite/state/suburb/id");return suburb.post({id:id})},adminBooking.editStateInfo=function(info){var edit=api.all("redimedsite/state/edit");return edit.post({info:info})},adminBooking.editSuburbInfo=function(info){var edit=api.all("redimedsite/state/suburb/edit");return edit.post({info:info})},adminBooking.insertState=function(info){var insert=api.all("redimedsite/state/insert");return insert.post({info:info})},adminBooking.insertSuburb=function(info){var insert=api.all("redimedsite/state/suburb/insert");return insert.post({info:info})},adminBooking.getSiteRoom=function(site_id){return api.all("redimedsite/room").post({site_id:site_id})},adminBooking.delUserMenu=function(id){var del=api.all("users/menu/delete");return del.post({id:id})},adminBooking.getAlert=function(data){var get=api.all("booking/getalert");return get.post({data:data})},adminBooking.updateAlert=function(data){var get=api.all("booking/updatealert");return get.post({data:data})},adminBooking.getDisable=function(data){var get=api.all("booking/getdisable");return get.post({data:data})},adminBooking.editRoom=function(roomInfo,isEdit){return api.all("redimedsite/room/edit").post({info:roomInfo,isEdit:isEdit})},adminBooking.getRoom=function(id){return api.all("redimedsite/room/details").post({room_id:id})},adminBooking.getAvailableRoom=function(siteId,doctorId){return api.all("redimedsite/room/available").post({site_id:siteId,doctor_id:doctorId})},adminBooking}),angular.module("app.loggedIn.booking.admin.requirement.directive",[]).directive("requirementList",function(OnlineBookingAdminService,$filter,$modal,$state,$stateParams,toastr){return{restrict:"EA",templateUrl:"modules/onlineBooking_Admin/directives/templates/requirements.html",scope:{options:"=",idr:"=",success:"="},link:function(scope,ele,attrs){var search={limit:5,offset:0,max_size:5,page:1,company_id:scope.idr},load=function(){OnlineBookingAdminService.getAlert(search).then(function(response){scope.req.list=angular.copy(response.data),scope.req.count=response.count},function(error){})};scope.setPage=function(page){scope.req.search.offset=(page-1)*scope.req.search.limit,scope.req.load()};var add=function(){$modal.open({templateUrl:"ReAlertAdd_R",controller:function($scope,alert_id,$modalInstance){$scope.alerts={success:!1,alert_id:alert_id},$scope.$watch("alerts.success",function(success){success&&$modalInstance.close("success")})},resolve:{alert_id:function(){return scope.idr}}}).result.then(function(response){scope.req.load(),scope.success="success"})},disable=function(d){OnlineBookingAdminService.getDisable(d).then(function(response){scope.req.load()},function(error){})},edit=function(g){$modal.open({templateUrl:"ReAlertEdit_R",controller:function($scope,alert_id,$modalInstance){$scope.alertedit={success:!1,alert_id:alert_id},$scope.$watch("alertedit.success",function(success){success&&$modalInstance.close("success")})},resolve:{alert_id:function(){return g.id}}}).result.then(function(response){scope.req.load()})};scope.req={search:search,list:{id:0,name:"",description:"",company_id:0},loading:!1,error:[],count:0,load:function(){load()},add:function(){add()},edit:function(g){edit(g)},disable:function(d){disable(d)}},scope.req.load()}}});