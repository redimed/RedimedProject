<style type="text/css">
    .form-group .help-block {
      display: none;
    }
     
    .form-group.has-error .help-block {
      display: block;
    }
</style>
<h2 id="demo1">REDiMED QMS</h2>
<div>
    R:Read. C:Create. U:Update. D:Delete. G: Grant Permission
</div>      
<!-- <button ng-click="testHierarchy();">TEst</button> -->
<div class="tree well">

    <script type="text/ng-template" id="nodes_renderer.html">
        <span >
                <i ng-if="node.nodes" class="fa fa-minus"></i>
                <i ng-if="node.NODE_TYPE==nodeType.folder" class="fa fa-folder-open"></i>
                <i ng-if="node.NODE_TYPE==nodeType.document" class="fa fa-leaf"></i>
                {{node.NODE_NAME}}
                <!-- ____{{node.relativePath}} -->
        </span>
        <div ng-show='node.PERMISSION<isoPermission.notPermission' style="color:#800000;display:inline;font-size:11px">
           {{node.ACCESSIBLE_USER_ID?'(':''}}
           {{node.PERMISSION==0?'A':''}}
           {{node.PERMISSION==1?'C':''}}
           {{node.PERMISSION==2?'U':''}}
           {{node.PERMISSION==3?'R':''}}
           {{node.ACCESSIBLE_USER_ID?')':''}}  
        </div>
        <a ng-show="node.ACCESSIBLE_USER_ID && node.PERMISSION<isoPermission.notPermission" ng-click="showTreeActionsMenuPopup(node);">actions </a>    
        
        <ul>
            <li ng-show='node.ISENABLE==1 || isIsoAdminSystem==1' ng-class="{node_accessible:node.ACCESSIBLE_USER_ID && node.PERMISSION<isoPermission.notPermission,iso_node_deleted:node.ISENABLE==0}" ng-repeat="(key,node) in node.nodes" iso-notice-finish-render-directory-tree ng-include="'nodes_renderer.html'">
            </li>
        </ul>
    </script>

    <ul>
        <li ng-show='node.ISENABLE==1 || isIsoAdminSystem==1' ng-class="{node_accessible:node.ACCESSIBLE_USER_ID && node.PERMISSION<isoPermission.notPermission,iso_node_deleted:node.ISENABLE==0}" ng-repeat="(key,node) in treeData"  ng-include="'nodes_renderer.html'">
        </li>
    </ul>

    
</div>


<div  id="iso-tree-actions-menu-popup" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">{{selectedTreeNode.NODE_TYPE==nodeType.folder?'Folder Actions':'File Actions'}}</h4>
            </div>  
            <div class="modal-body">
                <div ng-show='selectedTreeNode.ISENABLE==1 && selectedTreeNode.NODE_TYPE==nodeType.folder'>
                    <div class='iso-action-group'>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].createFolder"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.createFolder.name);">
                            Create Folder
                        </button>

                        <button
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].deleteFolder"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="deleteNode();">
                            Delete Folder
                        </button>

                        <button
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].cloneToPC && selectedTreeNode.NODE_ID!==0"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="downloadFolderSelected()">
                            Clone to PC
                        </button>

                    </div>

                    <div class='iso-action-group'>
                        <button
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].grantFolderPermission"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.grantNodePermission.name);">
                            Grant Permission
                        </button>
                    </div>

                    <div class='iso-action-group'>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].createDocument"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.createDocument.name);">
                            Create Document
                        </button>
                    </div>
                    
                </div>


                <div ng-show='selectedTreeNode.ISENABLE==1 && selectedTreeNode.NODE_TYPE==nodeType.document'>
                    <div class='iso-action-group'>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].checkOut && selectedTreeNode.CHECK_IN_STATUS==checkInStatus.unlock"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="checkOutDocument();">
                            Check out
                        </button>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].checkIn && selectedTreeNode.CHECK_IN_STATUS==checkInStatus.lock && selectedTreeNode.CHECK_IN_NO==null"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="beforeCheckIn();">
                            Check in
                        </button>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].submitDocument && (selectedTreeNode.SUBMIT_STATUS==null || selectedTreeNode.SUBMIT_STATUS==submitStatus.cancel) && selectedTreeNode.CHECK_IN_STATUS==checkInStatus.unlock"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="SubmitDocument()">
                            Submit Document
                        </button>

                       <button
                            ng-show="selectedTreeNode.SUBMIT_STATUS==submitStatus.pending && selectedTreeNode.CHECK_IN_STATUS==checkInStatus.lock"
                            type="button"
                            class="btn btn-default iso_action_button"
                            ng-click="cancelSubmitDocument();">
                            Cancel Submit Document
                        </button>
                    </div>

                    <div class='iso-action-group'>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].deleteDocument"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="deleteNode();">
                            Delete Document
                        </button>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].grantDocumentPermission"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.grantNodePermission.name);">
                            Grant Permission
                        </button>

                    </div>

                    <div class='iso-action-group'>
                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].getFullVersionDoccument"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.getFullVersionDocument.name);">
                            Show Version History
                        </button>

                        <button 
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].getFullCheckinDoccument"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="showTreeActionContentPopup(treeActions.getFullCheckinDocument.name);">
                            Show Check In History
                        </button>
                    </div>

                    <div class='iso-action-group'>
                        <button
                            ng-show="permissionFunction[selectedTreeNode.PERMISSION].downloadNewestVersion && selectedTreeNode.CURRENT_VERSION_ID!=null"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="downloadNewestVersionDocument()">Download Current Version
                        </button>
                    </div>
                </div>

                <div ng-show='selectedTreeNode.ISENABLE==0 && selectedTreeNode.NODE_TYPE==nodeType.folder'>
                    <div class='iso-action-group'>
                        <button 
                            ng-show="isoAdminFunction.restoreFolder"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="restoreNode();">
                            Restore Folder
                        </button>
                    </div>
                </div>

                <div ng-show='selectedTreeNode.ISENABLE==0 && selectedTreeNode.NODE_TYPE==nodeType.document'>
                    <div class='iso-action-group'>
                        <button 
                            ng-show="isoAdminFunction.restoreDocument"
                            type="button" 
                            class="btn btn-default iso_action_button"
                            ng-click="restoreNode();">
                            Restore Document
                        </button>
                    </div>
                </div>
            </div>

            
            
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>


<div  id="iso-tree-action-content-popup" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Run</h4>
            </div>
            <div class="modal-body">
                <form name='actionContentForm' novalidate>
                    <div ng-include='currentTreeAction.url'>
                </div>

                </form>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div ng-include="'modules/iso/views/templates/iso.html/iso_page_template.html'">

</div>

