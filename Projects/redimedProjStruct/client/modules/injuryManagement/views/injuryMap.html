<style type="text/css">
    .rowWaiting {
        background-color: rgba(255, 220, 96, 0.44);
    }

    .rowDone {
        background-color: rgba(117, 255, 186, 0.35);
    }

    .img-image-name{
        width: 50px;
        height: 50px;
        border-radius: 50%;
        text-align: center;
        vertical-align: middle;
        display: table-cell;
        color: white;
        font-size: 40px;
        font-weight: lighter;
    }

    table {
        table-layout:fixed;
    }

    .div-table-content {
        height:600px;
        overflow-y:auto;
    }

</style>
<h3 class="page-title">Injury Map</h3>
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="fa fa-home"></i>
            <a ui-sref="loggedIn.home">Home</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="javascript:;">Injury Management</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a>Injury Map</a>
        </li>
    </ul>
</div>
<div class="tabbable-custom nav-justified">
    <ul class="nav nav-tabs nav-justified">
        <li class="active">
            <a href="injuryMap.html#tab_1_1_1" data-toggle="tab">
                <i class="icon-map"></i> &nbsp;&nbsp;&nbsp;
                Injury Map </a>
        </li>
        <li>
            <a href="injuryMap.html#tab_1_1_2" data-toggle="tab">
                <i class="icon-list"></i>&nbsp;&nbsp;&nbsp;
                Injury List</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="tab_1_1_1">
            <map  center="current-location" zoom="15">
                <custom-control  id="refresh" position="TOP_RIGHT" index="1" on-click="refreshMap()">
                    <div style="width: 75px;background-color: white;border-style: solid;border-width: 2px;cursor: pointer;text-align: center; margin-top: 5px">
                        Refresh Map
                    </div>
                </custom-control>
                <marker data-position="{{im.position}}" icon="{{im.icon}}" ng-repeat="im in injuryMarker" data-on-click="showInfoWindow(event, 'info')">
                    <info-window max-width="500" id="info">
                        <div class="portlet grey-cascade box">
                            <div class="portlet-title">
                                <div class="caption ">
                                    <span class="caption-subject uppercase">{{im.FullName}}</span>
                                </div>
                                <div class="actions">
                                    <a  ng-click="showDetails(im.id)"  href="javascript:;" class="btn green btn-sm">
                                        <i class="fa fa-pencil"></i>&nbsp;&nbsp;
                                        Details </a>
                                </div>

                            </div>
                            <div class="portlet-body">
                            <div ng-non-bindable="">
                            <div class="row">
                                <div class="col-md-3"> <label class="bold">Pickup At</label></div>
                                <div class="col-md-9">
                                    <label>{{im.pickupAddr}}</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3"> <label class="bold">Gender</label></div>
                                <div class="col-md-9">
                                    <label>{{im.gender}}</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3"> <label class="bold">Injury Desc</label></div>
                                <div class="col-md-9">
                                    <label>{{im.injuryDesc}}</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3"> <label class="bold">Status</label></div>
                                <div class="col-md-9">
                                    <span ng-show="im.status == 'New'" class="label label-md label-success">New </span>
                                    <span ng-show="im.status == 'Waiting'" class="label label-md label-warning">Waiting </span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3"> <label class="bold">Driver</label></div>
                                <div class="col-md-9">
                                    <label ng-show="im.status == 'Waiting'">{{im.driverUser}}</label>
                                    <select ng-model="map.driverId" ng-show="im.status == 'New'" ng-options="a.id as a.user_name for a in driverListTemp | unique:'id'">
                                        <option value="">--Select Driver--</option>
                                    </select>

                                </div>
                            </div>
                                <br/>
                            <div class="clearfix">
                                <a  ng-class="{disabled:map.driverId == null}" ng-show="im.status == 'New'"  ng-click="allocateDriver(im)"  href="javascript:;" class="btn blue btn-block">
                                    Send Notification </a>
                                </div>
                            </div>
                                </div>
                        </div>
                    </info-window>
                </marker>
                <marker  data-position="{{d.position}}" icon="{{d.icon}}" ng-repeat="d in driverMarker" data-on-click="showInfoWindow(event, 'infoDriver')">
                    <info-window max-width="500" id="infoDriver">
                        <div class="portlet red-flamingo box">
                            <div class="portlet-title">
                                <div class="caption ">
                                    <span class="caption-subject uppercase">{{d.username}}</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                        <div ng-non-bindable="">
                            <div class="row" >
                                <div class="col-md-5"> <label class="bold">Picking: </label></div>
                                <div class="col-md-7" >
                                    <label>{{d.patientList.length}} Patient(s)</label>
                                </div>
                            </div>
                            <div class="row" ng-repeat="p in d.patientList">
                                <div class="col-md-2">{{$index + 1}}.</div>
                                <div class="col-md-10" >
                                    <label>{{p.FullName}}</label>
                                </div>
                            </div>

                        </div>
                                </div>
                            </div>
                    </info-window>
                </marker>
            </map>

        </div>
        <div class="tab-pane" id="tab_1_1_2">
            <div class="panel panel-default">
                <table class="table table-condensed" >
                    <thead>
                    <tr>
                        <th width="100px">
                        </th>
                        <th>
                            <label style="font-size: 17px;">Patient Name</label>
                        </th>
                        <th style="text-align:center">
                            <label style="font-size: 17px;">Injury Date</label>
                        </th>
                        <th style="text-align:center">
                            <label style="font-size: 17px;">Driver</label>
                        </th>
                        <th style="text-align:center">
                            <label style="font-size: 17px;">Status</label>
                        </th>
                    </tr>
                    <tr>
                        <th width="100px">
                        </th>
                        <th>
                            <input ng-change="searchInjury(search)" ng-model="search.patient" class="form-control" type="text" />
                        </th>
                        <th style="text-align:center">
                            <date-range-picker style="width:200px;" ng-model="search.dateRange" ranged="true" callback="getDateRange(search.dateRange)"></date-range-picker>
                            <!--<input class="form-control" type="text" />-->
                        </th>
                        <th style="text-align:center">
                            <input ng-model="search.driver" ng-change="searchInjury(search)" class="form-control" type="text" />
                        </th>
                        <th style="text-align:center">
                            <!--<input type="checkbox" ng-change="searchInjury(search)" ng-model="search.isNew"/> New-->
                            <!--<input type="checkbox" ng-change="searchInjury(search)" ng-model="search.isWaiting"/> Waiting-->
                            <!--<input type="checkbox" ng-change="searchInjury(search)" ng-model="search.isDone" /> Done-->
                        </th>
                    </tr>
                    </thead>
                </table>
            </div>
            <div class="div-table-content">
                <table class="table table-hover table-condensed">
                    <tbody>
                    <tr style="white-space: nowrap; cursor: pointer;"  ng-repeat="im in injuryList" ng-class="{rowWaiting : im.STATUS == 'Waiting', rowDone : im.STATUS == 'Done'}">
                        <td width="100px" ng-click="showDetails(im.injury_id)" style="vertical-align:middle" align="center">
                            <div class="img-image-name" ng-style={"background-color":im.background} >
                                {{im.First_name | limitTo: 1 | uppercase}}
                            </div>
                        </td>
                        <td ng-click="showDetails(im.injury_id)" style="vertical-align:middle" >
                            <label class="bold">
                                {{im.FullName}}
                            </label>
                        </td>
                        <td style="vertical-align:middle" align="center">
                            {{im.injury_date | date:'dd/MM/yyyy'}}
                        </td>
                        <td style="vertical-align:middle" align="center">
                            <label class="bold">{{im.driverUser}}</label>
                        </td>
                        <td ng-click="showDetails(im.injury_id)" style="vertical-align:middle" align="center">
                            <a ng-show="im.STATUS == 'New'" href="javascript:;" class="btn btn-primary btn-md" style="width:100px">
                                {{im.STATUS}}
                            </a>
                            <a ng-show="im.STATUS == 'Waiting'" href="javascript:;" class="btn btn-warning btn-md" style="width:100px">
                                {{im.STATUS}}
                            </a>
                            <a ng-show="im.STATUS == 'Done'" href="javascript:;" class="btn btn-success btn-md" style="width:100px">
                                {{im.STATUS}}
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



